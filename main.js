/*! For license information please see main.js.LICENSE.txt */
(()=>{var __webpack_modules__={9141:e=>{"use strict";for(var t=/[\\\"\x00-\x1F]/g,n={},i=0;i<32;++i)n[String.fromCharCode(i)]="\\U"+("0000"+i.toString(16)).slice(-4).toUpperCase();function r(e){return t.lastIndex=0,e.replace(t,(function(e){return n[e]}))}n["\b"]="\\b",n["\t"]="\\t",n["\n"]="\\n",n["\f"]="\\f",n["\r"]="\\r",n['"']='\\"',n["\\"]="\\\\",e.exports={stringify:function e(t){switch(typeof t){case"string":return'"'+r(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return null===t?"null":Array.isArray(t)?function(t){for(var n="[",i="",r=0;r<t.length;++r)i+=n,n=",",i+=e(t[r]);return","!=n?"[]":i+"]"}(t):function(t){var n="{",i="",s=Object.keys(t);s.sort();for(var o=0;o<s.length;++o){var a=s[o];i+=n+'"'+r(a)+'":',n=",",i+=e(t[a])}return","!=n?"{}":i+"}"}(t);default:throw new Error("Cannot stringify: "+typeof t)}}}},8162:e=>{"use strict";e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<e.length;i++){var r=e.charAt(i),s=r.charCodeAt(0);if(255!==t[s])throw new TypeError(r+" is ambiguous");t[s]=i}var o=e.length,a=e.charAt(0),l=Math.log(o)/Math.log(256),c=Math.log(256)/Math.log(o);function d(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var n=0,i=0,r=0;e[n]===a;)i++,n++;for(var s=(e.length-n)*l+1>>>0,c=new Uint8Array(s);e[n];){var d=t[e.charCodeAt(n)];if(255===d)return;for(var h=0,u=s-1;(0!==d||h<r)&&-1!==u;u--,h++)d+=o*c[u]>>>0,c[u]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");r=h,n++}for(var p=s-r;p!==s&&0===c[p];)p++;for(var m=new Uint8Array(i+(s-p)),g=i;p!==s;)m[g++]=c[p++];return m}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,i=0,r=0,s=t.length;r!==s&&0===t[r];)r++,n++;for(var l=(s-r)*c+1>>>0,d=new Uint8Array(l);r!==s;){for(var h=t[r],u=0,p=l-1;(0!==h||u<i)&&-1!==p;p--,u++)h+=256*d[p]>>>0,d[p]=h%o>>>0,h=h/o>>>0;if(0!==h)throw new Error("Non-zero carry");i=u,r++}for(var m=l-i;m!==l&&0===d[m];)m++;for(var g=a.repeat(n);m<l;++m)g+=e.charAt(d[m]);return g},decodeUnsafe:d,decode:function(e){var t=d(e);if(t)return t;throw new Error("Non-base"+o+" character")}}}},4770:function(e,t){var n,i;n=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");t.log={trace:i,debug:i,info:i,warn:i,error:i};function t(s,o){if("function"!=typeof o)throw new Error("Bad callback given: "+o);if(!s)throw new Error("No options given");var a=s.onResponse;if((s="string"==typeof s?{uri:s}:JSON.parse(JSON.stringify(s))).onResponse=a,s.verbose&&(t.log=function(){var e,t,n={},s=["trace","debug","info","warn","error"];for(t=0;t<s.length;t++)n[e=s[t]]=i,"undefined"!=typeof console&&console&&console[e]&&(n[e]=r(console,e));return n}()),s.url&&(s.uri=s.url,delete s.url),!s.uri&&""!==s.uri)throw new Error("options.uri is a required argument");if("string"!=typeof s.uri)throw new Error("options.uri must be a string");for(var l=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],c=0;c<l.length;c++)if(s[l[c]])throw new Error("options."+l[c]+" is not supported");if(s.callback=o,s.method=s.method||"GET",s.headers=s.headers||{},s.body=s.body||null,s.timeout=s.timeout||t.DEFAULT_TIMEOUT,s.headers.host)throw new Error("Options.headers.host is not supported");s.json&&(s.headers.accept=s.headers.accept||"application/json","GET"!==s.method&&(s.headers["content-type"]="application/json"),"boolean"!=typeof s.json?s.body=JSON.stringify(s.json):"string"!=typeof s.body&&(s.body=JSON.stringify(s.body)));var d=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};if(s.qs){var h="string"==typeof s.qs?s.qs:d(s.qs);-1!==s.uri.indexOf("?")?s.uri=s.uri+"&"+h:s.uri=s.uri+"?"+h}if(s.form){if("string"==typeof s.form)throw"form name unsupported";if("POST"===s.method){var u=(s.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(s.headers["content-type"]=u,u){case"application/x-www-form-urlencoded":s.body=d(s.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+i+'"\n\n'+e[i]+"\n");return n.push("--"+t.boundry+"--"),t.body=n.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t}(s.form);s.body=p.body,s.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+u)}}}return s.onResponse=s.onResponse||i,!0===s.onResponse&&(s.onResponse=o,s.callback=i),!s.headers.authorization&&s.auth&&(s.headers.authorization="Basic "+function(e){var t,n,i,r,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",d=[];if(!e)return e;do{t=(s=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=s>>12&63,i=s>>6&63,r=63&s,d[l++]=o.charAt(t)+o.charAt(n)+o.charAt(i)+o.charAt(r)}while(a<e.length);switch(c=d.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}(s.auth.username+":"+s.auth.password)),function(i){var r=new e,s=!1,o=function(e){var t,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(e){(t=document.createElement("a")).href="",t=t.href}var i=n.exec(t.toLowerCase())||[],r=n.exec(e.toLowerCase());return!(!r||r[1]==i[1]&&r[2]==i[2]&&(r[3]||("http:"===r[1]?80:443))==(i[3]||("http:"===i[1]?80:443)))}(i.uri),a="withCredentials"in r;if(n+=1,r.seq_id=n,r.id=n+": "+i.method+" "+i.uri,r._id=r.id,o&&!a){var l=new Error("Browser does not support cross-origin request: "+i.uri);return l.cors="unsupported",i.callback(l,r)}function c(){s=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=i.timeout,t.log.error("Timeout",{id:r._id,milliseconds:i.timeout}),i.callback(e,r)}r.timeoutTimer=setTimeout(c,i.timeout);var d={response:!1,loading:!1,end:!1};return r.onreadystatechange=h,r.open(i.method,i.uri,!0),o&&(r.withCredentials=!!i.withCredentials),r.send(i.body),r;function h(n){if(s)return t.log.debug("Ignoring timed out state change",{state:r.readyState,id:r.id});if(t.log.debug("State change",{state:r.readyState,id:r.id,timed_out:s}),r.readyState===e.OPENED)for(var o in t.log.debug("Request started",{id:r.id}),i.headers)r.setRequestHeader(o,i.headers[o]);else r.readyState===e.HEADERS_RECEIVED?u():r.readyState===e.LOADING?(u(),p()):r.readyState===e.DONE&&(u(),p(),m())}function u(){if(!d.response){if(d.response=!0,t.log.debug("Got response",{id:r.id,status:r.status}),clearTimeout(r.timeoutTimer),r.statusCode=r.status,o&&0==r.statusCode){var e=new Error("CORS request rejected: "+i.uri);return e.cors="rejected",d.loading=!0,d.end=!0,i.callback(e,r)}i.onResponse(null,r)}}function p(){d.loading||(d.loading=!0,t.log.debug("Response body loading",{id:r.id}))}function m(){if(!d.end){if(d.end=!0,t.log.debug("Request done",{id:r.id}),r.body=r.responseText,i.json)try{r.body=JSON.parse(r.responseText)}catch(e){return i.callback(e,r)}i.callback(null,r,r.body)}}}(s)}var n=0;function i(){}function r(e,t){return function(n,i){return"object"==typeof i&&(n+=" "+JSON.stringify(i)),e[t].call(e,n)}}return t.withCredentials=!1,t.DEFAULT_TIMEOUT=18e4,t.defaults=function(e,n){var i=function(t){return function(n,i){for(var r in n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n)),e)void 0===n[r]&&(n[r]=e[r]);return t(n,i)}},r=i(t);return r.get=i(t.get),r.post=i(t.post),r.put=i(t.put),r.head=i(t.head),r},["get","put","post","head"].forEach((function(e){var n=e.toUpperCase();t[e.toLowerCase()]=function(e){"string"==typeof e?e={method:n,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=n;var i=[e].concat(Array.prototype.slice.apply(arguments,[1]));return t.apply(this,i)}})),t.couch=function(e,n){return"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,n=n||i,t(e,(function(e,t,i){if(e)return n(e,t,i);if((t.statusCode<200||t.statusCode>299)&&i.error){for(var r in e=new Error("CouchDB error: "+(i.error.reason||i.error.error)),i)e[r]=i[r];return n(e,t,i)}return n(e,t,i)}))},t},void 0===(i=n.apply(t,[]))||(e.exports=i)},7191:(e,t,n)=>{const i=n(8162);e.exports=i("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},1924:(e,t,n)=>{"use strict";var i=n(210),r=n(5559),s=r(i("String.prototype.indexOf"));e.exports=function(e,t){var n=i(e,!!t);return"function"==typeof n&&s(e,".prototype.")>-1?r(n):n}},5559:(e,t,n)=>{"use strict";var i=n(8612),r=n(210),s=r("%Function.prototype.apply%"),o=r("%Function.prototype.call%"),a=r("%Reflect.apply%",!0)||i.call(o,s),l=r("%Object.getOwnPropertyDescriptor%",!0),c=r("%Object.defineProperty%",!0),d=r("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=a(i,o,arguments);if(l&&c){var n=l(t,"length");n.configurable&&c(t,"length",{value:1+d(0,e.length-(arguments.length-1))})}return t};var h=function(){return a(i,s,arguments)};c?c(e.exports,"apply",{value:h}):e.exports.apply=h},7811:(e,t)=>{"use strict";var n=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,i=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,r=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,o=/([\\"])/g,a=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function l(e){var t=String(e);if(r.test(t))return t;if(t.length>0&&!i.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(o,"\\$1")+'"'}function c(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,n=e.type;if(!n||!a.test(n))throw new TypeError("invalid type");var i=n;if(t&&"object"==typeof t)for(var s,o=Object.keys(t).sort(),c=0;c<o.length;c++){if(s=o[c],!r.test(s))throw new TypeError("invalid parameter name");i+="; "+s+"="+l(t[s])}return i},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var i=t.indexOf(";"),r=-1!==i?t.substr(0,i).trim():t.trim();if(!a.test(r))throw new TypeError("invalid media type");var o=new c(r.toLowerCase());if(-1!==i){var l,d,h;for(n.lastIndex=i;d=n.exec(t);){if(d.index!==i)throw new TypeError("invalid parameter format");i+=d[0].length,l=d[1].toLowerCase(),'"'===(h=d[2])[0]&&(h=h.substr(1,h.length-2).replace(s,"$1")),o.parameters[l]=h}if(i!==t.length)throw new TypeError("invalid parameter format")}return o}},4606:(e,t)=>{var n;n=function(e){e.version="0.3.0";var t=function(){for(var e=0,t=new Array(256),n=0;256!=n;++n)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=n)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[n]=e;return"undefined"!=typeof Int32Array?new Int32Array(t):t}(),n="undefined"!=typeof Buffer;function i(e){for(var n=-1,i=0,r=e.length-7;i<r;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])];for(;i<r+7;)n=n>>>8^t[255&(n^e[i++])];return-1^n}e.table=t,e.bstr=function(e){if(e.length>32768&&n)return i(new Buffer(e));for(var r=-1,s=e.length-1,o=0;o<s;)r=t[255&(r^e.charCodeAt(o++))]^r>>>8,r=t[255&(r^e.charCodeAt(o++))]^r>>>8;return o===s&&(r=r>>>8^t[255&(r^e.charCodeAt(o))]),-1^r},e.buf=function(e){if(e.length>1e4)return i(e);for(var n=-1,r=0,s=e.length-3;r<s;)n=(n=(n=(n=n>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])];for(;r<s+3;)n=n>>>8^t[255&(n^e[r++])];return-1^n},e.str=function(e){for(var n,i,r=-1,s=0,o=e.length;s<o;)(n=e.charCodeAt(s++))<128?r=r>>>8^t[255&(r^n)]:n<2048?r=(r=r>>>8^t[255&(r^(192|n>>6&31))])>>>8^t[255&(r^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),i=1023&e.charCodeAt(s++),r=(r=(r=(r=r>>>8^t[255&(r^(240|n>>8&7))])>>>8^t[255&(r^(128|n>>2&63))])>>>8^t[255&(r^(128|i>>6&15|3&n))])>>>8^t[255&(r^(128|63&i))]):r=(r=(r=r>>>8^t[255&(r^(224|n>>12&15))])>>>8^t[255&(r^(128|n>>6&63))])>>>8^t[255&(r^(128|63&n))];return-1^r}},"undefined"==typeof DO_NOT_EXPORT_CRC?n(t):n({})},9129:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"\n\n#create-collection {\n    margin-top:20px;\n    display:grid;\n    grid-template-columns: 180px 1fr;\n}\n\n#create-collection > label {\n    grid-column: 1 / 2 ;\n}\n\n#create-collection > input, #create-collection > textarea {\n    grid-column: 2 / 3 ;\n    margin-bottom:.5em;\n    resize:none;\n}\n\n\n#create-collection label {\n  margin:5px;\n  margin-left:0px;\n}\n\n.name-validation-detail {\n    color:var(--content-text-dimmed);\n    grid-column: 2 / 3 ;\n    font-size:10pt;\n    position:relative;\n    top:-8px;\n}\n\n#create-collection-submit {\n    grid-column: 1 / 2 ;\n}\n\n#add-collection-unarchive-list {\n  margin-top:20px;\n}\n\n.unarchive-collection svg {\n  height:1.2em;\n  vertical-align:bottom;\n}\n\n.unarchive-collection {\n  display: grid;\n  height:28px;\n  grid-template-columns: 2em 1fr;\n  background: none;\n  border: none;\n  font-weight: bold;\n  cursor: pointer;\n  position: relative;\n  text-align:left;\n}\n\n.unarchive-collection > span {\n  padding-bottom:10px;\n  white-space:pre;\n  overflow-x:auto;\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\n.unarchive-collection > span::-webkit-scrollbar { display: none; }\n\n.unarchive-collection[data-change-pending] {\n  color:var(--content-text-dimmed);\n}\n\n.unarchive-collection:hover {\n  left:5px\n}\n\n@media only screen and (max-width: 600px) {\n    #create-collection { grid-template-columns: 1fr; }\n\n    .name-validation-detail,\n    #create-collection > input, \n    #create-collection > textarea { \n        grid-column: 1 / 2;\n        min-width: 0px; /* helps prevent overflow on very narrow viewports */\n    }\n}\n",""]);const a=o},5047:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s),a=n(1667),l=n.n(a),c=new URL(n(8211),n.b),d=o()(r()),h=l()(c);d.push([e.id,".annotation-layer { \n    transform-origin : top left;\n    transform : scale(var(--pdfFitRatio));\n    position: absolute;\n    width: calc(var(--pdfWidthPx) / var(--pdfFitRatio)) ;\n    height: calc(var(--pdfHeightPx) / var(--pdfFitRatio));\n    line-height:1;\n    user-select:none;\n    overflow:visible;\n    left: 0;\n    top: 0;\n}\n\n.annotation-layer span {\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    transform-origin: 0% 0%;\n    pointer-events: auto !important;\n}\n\n.annotation-layer span.annotation-pindrop { \n    cursor: pointer;\n    padding:2px;\n    border-radius:30px;\n    border: 2px solid transparent;\n}\n\n.annotation-layer span.annotation-pindrop svg {\n  height:14px;\n  width:16px;\n}\n\n.annotation-layer span.annotation-pindrop[data-focused] { \n    border: 2px solid var(--user_light);\n}\n\n.annotation-layer span.annotation-pindrop[data-annotation-typing] {\n    animation: pulse-color 1s infinite;\n}\n\n.annotation-layer span.annotation-pindrop-preview { \n    animation: pulse-opacity 1s infinite;\n}\n\n.annotation-layer .inline-annotations {\n    opacity:0.2;\n    transition: opacity 0.25s ease;\n}\n\n.annotation-layer[data-annotation-focused] .inline-annotations {\n  opacity:0.1\n}\n\n.annotation-layer .inline-annotations span {\n    background-color:var(--user_solid);\n}\n\n.annotation-layer .annotation-bartab {\n    opacity:0.5;\n    background-color:var(--user_solid);\n}\n\n.annotation-layer .annotation-bartab:hover {\n    opacity:1;\n}\n\n.annotation-layer > div[data-focused] > .inline-annotations,\n.annotation-layer .annotation-bartab:hover + .inline-annotations {\n    opacity:0.3;\n}\n\n.annotation-layer > div[data-annotation-typing] > .inline-annotations {\n    animation: pulse-half-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n[data-annotations-hidden] .annotation-bartab,\n[data-annotations-hidden] .inline-annotations {\n    visibility: hidden;\n}\n\n.annotation-layer > div[data-focused] > .annotation-bartab,\n.annotation-layer > div[data-focused] > .inline-annotations {\n    visibility:visible;\n}\n\n[data-pindrop-mode] .annotation-layer * {\n    cursor:unset !important;\n}\n\n[data-pindrop-mode] .annotation-layer { \n    cursor: url("+h+") 16 16, pointer !important;\n}\n",""]);const u=d},1444:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#annotation-panel {\n    position:relative;\n    flex-direction: column;\n}\n\n#annotation-panel .empty-marker { padding:10px }\n\n#annotation-entries-wrapper {\n    overflow-y:scroll;\n    padding-bottom:40px;\n}\n\nhtml[data-scrollbars="hidden"] #annotation-entries-wrapper {\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n}\n\nhtml[data-scrollbars="hidden"] #annotation-entries-wrapper::-webkit-scrollbar { display: none; }\n\n#annotation-controls {\n    user-select:none;\n    display:flex;\n    align-items:center;\n    margin-top: .5em;\n    padding-bottom: .5em;\n    padding-left: .5em;\n    border-bottom: 1px solid var(--content-border);\n}\n\n#annotation-controls button {\n    margin-left: 1em;\n}\n\n#annotation-controls button:first-child {\n    margin-left: 0em;\n}\n\n#annotation-panel .annotation-listing-entry {\n    cursor: pointer;\n    position:relative;\n    width:calc(100% - 20px);\n    padding:20px 10px 20px 10px;\n    display: flex;\n    align-items:center;\n    justify-content: right;\n    flex-wrap:wrap;\n    transition: background-color 0.5s ease;\n}\n\n/* Medium devices (landscape tablets, 768px and up) */\n@media only screen and (min-width: 768px) {\n  #annotation-panel .annotation-listing-entry {\n      width:calc(100% - 50px);\n      padding:20px 25px 20px 25px;\n\n  } \n}\n\n#annotation-panel .annotation-listing-divider {\n    border-bottom: 1px solid var(--content-border);\n    margin: 20px 60px 20px 60px;\n    text-align:center;\n    position:relative;\n}\n\n#annotation-panel .annotation-listing-divider > span {\n    white-space:pre;\n    max-width:100%;\n    overflow:hidden;\n    display:inline-block;\n    text-overflow:ellipsis;\n    color: var(--content-text-dimmed);\n    font-size:10pt;\n    background:var(--content-background);\n    position:relative;\n    padding:0px 10px 0px 10px;\n    top:.75em;\n}\n\n#annotation-panel .annotation-listing-entry[data-annotation-entry-typing] {\n    animation: pulse-color 2s infinite; \n    animation-timing-function:ease;\n}\n\n#annotation-panel .annotation-listing-entry:hover {\n    background: var(--user_ultralight);\n    transition: background-color 0.5s ease;\n}\n\n#annotation-panel .annotation-listing-entry[data-annotation-entry-focused] {\n    background: var(--user_ultralight);\n}\n\n.annotation-listing-entry .preview-quote,\n.annotation-listing-entry .preview-pin,\n.annotation-listing-entry .preview-media-fragment {\n  width:100%;\n}\n\n.annotation-listing-pending {\n  width:100%;\n  padding-top:10px;\n  padding-left:5px;\n  font-size:10pt;\n  color:var(--content-secondary-text);\n}\n\n.annotation-listing-comment, .annotation-listing-comment-unread {\n    width:calc(100%);\n    padding:0px 10px 0px 10px;\n    border: 2px solid var(--user_light);\n    margin-bottom:10px;\n    margin-top:10px;\n    overflow-wrap: anywhere;\n    word-break: break-word;\n    hyphens: auto;\n    background:var(--content-background);\n}\n\n.annotation-listing-comment a, .annotation-listing-comment-unread a {\n  color:var(--content-text);\n}\n\n.annotation-listing-comment a:hover, .annotation-listing-comment-unread a:hover {\n  text-underline-offset: 0.1em;\n  text-decoration-thickness: 0.125em;\n}\n\n.annotation-listing-comment-unread { border: 5px solid var(--user_light); }\n\n.annotation-listing-info {\n  display: flex;\n  justify-content: space-between;\n  align-content:center;\n  width:100%;\n}\n\n.annotation-listing-features > svg {\n  height:24px;\n  width:24px;\n  padding-right:5px;\n}\n\n.annotation-listing-features {\n  height:24px;\n  padding-left:5px;\n  color:var(--content-secondary-text);\n}\n\n.annotation-listing-creator::before {\n  content: "";\n  position: absolute;\n  bottom:21px;\n  left:-25px;\n  border-right: 10px solid var(--user_light);\n  border-top: 10px solid var(--user_light);\n  border-left: 10px solid transparent;\n  border-bottom: 10px solid transparent;\n}\n\n.annotation-listing-creator::after {\n  content: "";\n  position: absolute;\n  bottom:26px;\n  left:-25px;\n  border-right: 9px solid white;\n  border-top: 9px solid white;\n  border-left: 9px solid transparent;\n  border-bottom: 9px solid transparent;\n}\n\n.annotation-listing-comment-unread + .annotation-listing-info .annotation-listing-creator::before {\n  bottom:13px;\n  left:-35px;\n  border-right: 15px solid var(--user_light);\n  border-top: 15px solid var(--user_light);\n  border-left: 15px solid transparent;\n  border-bottom: 15px solid transparent;\n}\n\n.annotation-listing-comment-unread + .annotation-listing-info .annotation-listing-creator::after {\n  bottom:27px;\n  left:-28px;\n}\n\n.annotation-listing-comment pre, .annotation-listing-comment-unread pre{\n  overflow-y: scroll;\n  max-width: calc(var(--widget-2-width) - 50px);\n  text-overflow:ellipsis;\n}\n\nhtml[data-scrollbars="hidden"] .annotation-listing-comment-unread pre,\nhtml[data-scrollbars="hidden"] .annotation-listing-comment pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] .annotation-listing-comment pre::-webkit-scrollbar,\nhtml[data-scrollbars="hidden"] .annotation-listing-comment-unread pre::-webkit-scrollbar { \n  display: none; \n}\n\n.annotation-listing-creator {\n    position:relative;\n    font-size:10pt;\n    padding-right:10px;\n    user-select: none;\n}\n\n.annotation-listing-fallback {\n  color:var(--content-secondary-text);\n  text-align:center;\n}\n\n#annotation-panel-button-wrapper {\n  position:absolute;\n  bottom:0px;\n  width:100%;\n}\n\n#annotation-panel-button-wrapper .search-bar {\n  height:36px;\n  border: 2px solid black;\n  background: var(--content-background);\n}\n\n#annotation-panel-button-wrapper[data-mode="search"] .search-bar > input {\n  opacity:1;\n  width:100%;\n  height:100%;\n  margin:0px;\n  padding-top:0px;\n  padding-bottom:0px;\n  outline:none;\n}\n\n#annotation-panel-button-wrapper[data-mode="navigation"] .search-bar > input {\n  background-color:var(--content-background);\n}\n\n#annotation-panel-button-wrapper .search-bar > .clear-icon,\n#annotation-panel-button-wrapper .search-bar > .search-icon {\n  right:6px;\n}\n',""]);const a=o},7230:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#select-avatar-wrapper {\n  position:relative;\n}\n\n#select-avatar-selector {\n    cursor: pointer;\n    display:block;\n    height:180px;\n    max-height:180px;\n    width:100%;\n    object-fit:cover;\n    border-radius:10px;\n    margin:auto;\n    margin-bottom:10px;\n}\n\n#select-avatar-change-avatar {\n  position: absolute;\n  bottom:20px;\n  right:10px;\n  border:none;\n  background:rgba(255,255,255,.5);\n  border-radius:5px;\n  transition:background .25s ease;\n  cursor: pointer;\n}\n\n#select-avatar-change-avatar:hover {\n  background:rgba(255,255,255,.8);\n}\n\ndiv#select-avatar-selector {\n    background : #ababab;\n}\n\n#select-avatar-selector-hidden {\n    display:none;\n}\n\n",""]);const a=o},5789:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#chat-wrapper {\n    flex-direction: column-reverse;\n    overflow-x: hidden;\n}\n\n#chat-panel {\n    display:inline-flex;\n    flex-direction: column-reverse;\n}\n\n#chat-drop-overlay {\n  position:absolute;\n  height:100%;\n  width:100%;\n  opacity:.2;\n  z-index:10;\n  background:black;\n}\n\n#anchor-preview-wrapper {\n  padding:10px;\n}\n\n#scroll-anchor, #scroll-done {\n    user-select:none;\n    padding:10px;\n    font-weight:bold;\n}\n\n#scroll-anchor svg * {\n  fill:var(--low-contrast-background);\n}\n\n#anchor-chat-flags svg {\n  opacity:0;\n}\n\n#anchor-chat-flags:hover button svg {\n  opacity:1;\n}\n\n#anchor-chat-flags button[data-active-flag] svg {\n  color:var(--content-secondary-text);\n  opacity:1;\n}\n\n#anchor-chat-flags {\n  padding:0px 10px 0px 10px;\n}\n\n#messageComposer > textarea,\n.replyComposer > textarea,\n.messageEditor > textarea {\n    display:block;\n    overflow: hidden;\n    min-height:100px;\n    width:100%;\n    margin:0px;\n    border:none;\n    padding:5px;\n    resize:none;\n    border-top: 1px solid #adadad;\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\n    -moz-box-sizing: border-box; /* Firefox, other Gecko */\n    box-sizing: border-box; /* Opera/IE 8+ */\n}\n\n.typing-indicator {\n  user-select:none;\n}\n\n#messageComposer > textarea:focus,\n.replyComposer > textarea:focus,\n.messageEditor > textarea:focus {\n    outline: none;\n    border: 1px solid black;\n    border-bottom: none;\n}\n\n#submit-button-wrapper {\n  background: var(--max-contrast-background);\n}\n\n#submit-button-wrapper > button,\n.replyComposer > button,\n.messageEditor > button {\n    cursor:pointer;\n    outline:none;\n    border:2px solid black;\n    border-left:none;\n    font-weight:bold;\n    transition: background-color 0.5s ease;\n    background:var(--content-background);\n}\n\n#submit-button-wrapper > button:focus,\n.replyComposer > button:focus,\n.messageEditor > button:focus {\n    border:3px solid black;\n    border-left:1px solid black;\n}\n\n#submit-button-wrapper > button:first-child,\n.replyComposer > button:first-of-type,\n.messageEditor > button:first-of-type {\n    border:2px solid black;\n}\n\n#submit-button-wrapper > button:first-child:focus,\n.replyComposer > button:first-child:focus,\n.messageEditor > button:first-child:focus {\n    border:3px solid black;\n}\n\n.replyComposer > button,\n.messageEditor > button {\n    width:50%;\n    height:30px;\n}\n\n#submit-button-wrapper {\n    display:grid;\n    column-gap: 0px;\n    grid-template-columns: repeat(6,1fr) ;\n}\n\n#submit-button-wrapper > button {\n    height:40px;\n    font-size:14pt;\n    margin:0px;\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n}\n\n#submitButton { grid-column:1/4; }\n\n#quote-button > svg  {\n  width:20px;\n}\n\n#cancelButton { grid-column:4/7; }\n\n#submit-button-wrapper > button:hover,\n.replyComposer > button:hover,\n.messageEditor > button:hover {\n    transition: background-color 0.5s ease;\n    background-color: var(--user_light);\n}\n\n#submit-button-wrapper > button:disabled {\n  background-color: white;\n  cursor: not-allowed;\n  color:var(--content-text-dimmed);\n}\n\n#messageComposer > button:active {\n    background-color:var(--user_dark);\n}\n\n#message-panel-disabled { \n  padding: 5px;\n  padding-left: 15px;\n  font-size:10pt;\n  color: var(--contrast-text);\n  font-weight: bold;\n  background: var(--contrast-background);\n  border-top: 1px var(--contrast-background) solid;\n}\n\n#file-uploader-progress {\n    display:grid;\n    grid-template-columns: auto 1fr;\n    animation: pulse-opacity 2s infinite; \n    animation-timing-function:ease;\n    margin:5px 10px 5px 10px;\n    font-size:10pt;\n}\n\n#file-uploader-input {\n  display:none;\n}\n\n#file-uploader-preview {\n  display:grid;\n  grid-template-columns:30px 1fr;\n  margin:0px 10px 10px 10px;\n  padding:10px 10px 10px 10px;\n  border: 1px solid var(--content-border);\n  border-radius:10px;\n  align-items:center;\n}\n\n#file-uploader-preview span:nth-child(1) {\n  grid-row:1/3;\n}\n\n#file-uploader-preview span:nth-child(2) {\n  font-weight:bold;\n}\n\n#file-uploader-preview span:nth-child(3) {\n  font-size:10pt;\n  color:var(--content-text-dimmed)\n}\n\n#file-uploader-progress > progress {\n    margin-left:10px;\n}\n\n#audioRecordingWrapper, #videoRecordingWrapper {\n  position:relative;\n  cursor:pointer;\n}\n\n#audioRecordingWrapper {\n  display:flex;\n  background:black;\n  justify-content: center;\n  align-items: center;\n  height:150px;\n}\n\n#audioRecordingWrapper .audioVisualizer {\n    width:100%;\n    height:100%;\n}\n\n#audioCaption, #videoCaption {\n    pointer-events:none;\n    display:flex;\n    color: black;\n    font-weight: bold;\n    background: white;\n    border-radius: 30px;\n    padding: 5px;\n    justify-content: center;\n    align-items: center;\n    width:25px;  \n    height:25px;\n    position: absolute;\n}\n\n#videoCaption {\n    bottom: 30px;\n    left: 25px;\n}\n\n#audioCaption {\n    bottom: 20px;\n    left: 20px;\n}\n\n#audioCaption[data-recording-state=started], #videoCaption[data-recording-state=started] {\n    animation: pulse-color 2s infinite; \n    animation-timing-function:ease;\n}\n\n#audioCaption[data-recording-state=countdown] {\n    color:white;\n    justify-content:center;\n    animation: reverse-pulse-color 1.5s infinite;\n    animation-timing-function:ease;\n}\n",""]);const a=o},1386:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"html {\n  --light-red:#ff9394;\n  --light-gray: #ededed;\n  --mid-gray: #cdcdcd;\n  --solid-gray: #ababab;\n  --dark-gray: #555555;\n\n  /* backdrop to content, behind cards and annotatable resources */\n  --content-backdrop: var(--light-gray);\n  --backdrop-text: var(--dark-gray);\n  /* backdrop of content, e.g. cards and annotatable resources */\n  --content-background: white;\n  --content-border: rgba(0,0,0,.2);\n  --content-dimmed-element: var(--mid-gray);\n  --content-disabled-element: var(--dark-gray);\n  --content-text: black;\n  --content-text-dimmed: var(--solid-gray);\n  --content-secondary-text: var(--dark-gray);\n  /* background to text inputs */\n  --input-background: var(--light-gray);\n  --input-text: black;\n  --input-invalid: var(--light-red);\n  /* background to contrast text */\n  --low-contrast-background: var(--light-gray);\n  --contrast-background: var(--solid-gray);\n  --high-contrast-background: var(--dark-gray);\n  --max-contrast-background: black;\n  --contrast-text: white;\n  --contrast-text-dimmed: var(--dark-gray);\n  \n}\n",""]);const a=o},8046:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#content-container {\n    position: relative;\n    overflow: auto;\n    height: calc(100% - var(--navHeight));\n    --contentWidth: calc(100%);\n    width: var(--contentWidth);\n    transition: var(--transitionSizing);\n    background: var(--content-backdrop);\n}\n\n#content-container[data-touches="1"]\n#content-container[data-touches="2"] {\n  touch-action: "none"\n}\n\nhtml[data-scrollbars="hidden"] #content-container {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] #content-container::-webkit-scrollbar { display: none; }\n\n#image-view,\n#document-view {\n    position:relative;\n    display: flex;\n    /* the below forces chrome to recalculate overflow on zoom It\'s not\n     * necessary for Firefox or Webkit ... Not seeing an effect any more, so\n     * this bug may be fixed on newer chromium */\n    height: var(--contentHeightPx);\n    width: var(--contentWidthPx); \n    transform-origin : top left;\n    transform: scale(var(--zoomFactor));\n}\n\n#document-view {\n    left: max(0px, calc(50% - (var(--contentWidthPx) * var(--zoomFactor)) / 2));\n  }\n\n#image-view-wrapper {\n    position:relative;\n    left: max(0px, calc(50% - (var(--contentWidthPx) * var(--zoomFactor)) / 2));\n}\n\n.page-wrapper { position:relative; }\n\n.page-wrapper canvas {\n    position:relative;\n    z-index:-1; /* prevents an apparent stacking bug in chromium */\n    width: var(--pdfWidthPx);\n    height: var(--pdfHeightPx);\n}\n\n#document-view-loading {\n    height:100%;\n    display:flex;\n    flex-direction:column;\n    justify-content: center;\n    align-items: center;\n    animation-timing-function:ease;\n    background: var(--content-background)\n}\n\n#document-view-loading * {\n  animation: pulse-opacity 2s infinite; \n}\n\n#content-mobile-buttons {\n    position:fixed;\n    z-index:7;\n    top:0px;\n    transition: var(--transitionSizing);\n    right:0px;\n    width: calc(var(--sidepanelWidth));\n    margin-top:5px;\n    font-size:24px;\n    pointer-events:none;\n}\n\n#content-mobile-buttons[data-hide-buttons] {\n    top:-50px;\n    transition: var(--transitionSizing);\n}\n\n#panel-toggle {\n    pointer-events:all;\n    border:none;\n    outline:none;\n    font-size:24px;\n    text-align:center;\n    vertical-align:middle;\n    background:transparent;\n    cursor:pointer;\n    float:right;\n    color:var(--mobileButtonColor);\n}\n\n#show-annotations {\n    pointer-events:all;\n}\n\n/* Extra small devices (phones, 600px and down) */\n@media only screen and (max-width: 600px), only screen and (max-height: 600px) {\n    #content-container {\n        height: calc(100% - (0.8 * var(--navHeight)));\n    }\n} \n\n/* Small devices (portrait tablets and large phones, 600px and up) */\n@media only screen and (min-width: 600px) {\n} \n\n/* Medium devices (landscape tablets, 768px and up) */\n@media only screen and (min-width: 768px) {\n    #content-mobile-buttons {\n      display:none;\n    }\n\n    #content-container {\n        --contentWidth: calc(max(475px, 100% - var(--sidepanelWidth)));\n    }\n} \n\n/* Large devices (laptops/desktops, 992px and up) */\n@media only screen and (min-width: 992px) {\n} \n\n/* standard DPI */\n@media only screen and (min-width: 1280px) {\n    #panel-toggle {\n        visibility:hidden;\n    }\n}\n\n/* high DPI laptop */\n@media only screen and (min-width: 1400px) {\n}\n\n/* larger monitor */\n@media only screen and (min-width: 1800px) {\n}\n',""]);const a=o},2667:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,".copy-button {\n  margin:7px;\n  padding:0px;\n  background: unset;\n  border: none;\n  cursor: pointer;\n}\n",""]);const a=o},1913:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#file-upload {\n  max-width:calc(min(800px, 100% - (2 * var(--margin-unit))))  ;\n  width:100%;\n  margin:var(--margin-unit);\n  padding-top:calc(.5 * var(--margin-unit));\n  background:var(--content-background);\n  height:fit-content;\n  border: 1px solid var(--content-border);\n  padding: var(--margin-unit);\n  padding-top: calc(.5 * var(--margin-unit));\n}\n\n#file-upload-form {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n    margin-top: calc(.75 * var(--margin-unit));\n    align-items:center;\n}\n\n#file-upload-form label {\n    grid-column: 1 / 2 ;\n}\n\n #file-upload-form input, #file-upload-form textarea {\n    grid-column: 2 / 3 ;\n    margin-bottom:.5em;\n}\n\n#file-upload-form details {\n    grid-column: 1 / 3 ;\n    margin-bottom:.5em;\n}\n\n#file-upload-chooser input {\n  display: none;\n}\n\n#file-upload-chooser {\n  display:grid;\n  align-items:center;\n  justify-items:right;\n  grid-template-columns:auto 1fr ;\n  min-height:2em;\n}\n\n#file-upload-chooser span {\n  font-weight:bold;\n}\n\n#file-upload-chooser .small-icon {\n}\n\n.file-upload-details-wrapper {\n  padding-top:.5em;\n  display:grid;\n  grid-template-columns: 180px 1fr;\n}\n\n#file-upload-form > textarea {\n    resize: none;\n    min-height:50px;\n}\n\n#file-upload-form-submit {\n    grid-column: 1 / 2 ;\n}\n\n#file-upload-form-progress {\n    text-align:right;\n    grid-column: 2 / 3 ;\n}\n\n.file-upload-form-detail {\n    color:var(--content-text-dimmed);\n    grid-column: 2 / 3 ;\n    font-size:10pt;\n    position:relative;\n    top:-8px;\n}\n\n#file-upload-form-progress progress {\n  width: 100%;\n  height: 80%;\n}\n\n#pdf-upload-preview canvas {\n  width: var(--pdfWidthPx);\n  height: var(--pdfHeightPx);\n}\n\n#pdf-upload-preview {\n  position:relative;\n}\n\n#pdf-upload-preview-outer-wrapper {\n  display:flex;\n  position:relative;\n  justify-content:center;\n  padding:10px;\n  background: var(--contrast-background);\n  max-height:50vh;\n  overflow:auto;\n}\n\n#pdf-upload-preview-wrapper {\n  position:relative;\n}\n\n#generic-upload-preview {\n  display:flex;\n  align-items:center;\n}\n\n#media-upload-preview {\n  padding:10px;\n  position:relative;\n}\n\n#image-upload-preview img,\n#media-upload-preview video {\n  width:100%;\n}\n\n#pdf-upload-preview {\n  overflow:hidden;\n}\n\n#media-upload-preview-controls button, #pdf-upload-preview-controls button {\n  cursor: pointer;\n  display:flex;\n  align-content:center;\n  justify-content:center;\n  background: rgba(255,255,255,0.6);\n  border: 2px solid var(--content-text);\n  border-radius:30px;\n  margin:0px; \n  padding:6px;\n  backdrop-filter: blur(6px);\n}\n\n#pdf-upload-preview-controls, #media-upload-preview-controls {\n  display:flex;\n  position:absolute;\n  bottom:15px;\n  left:15px;\n  right:15px;\n  justify-content: space-between;\n  z-index:3;\n}\n\n#generic-upload-preview svg {\n  padding-right: 5px;\n}\n\n\n@media only screen and (max-width: 600px) {\n    #file-upload-form,\n    .file-upload-details-wrapper {\n      grid-template-columns: 1fr;\n    }\n\n    #file-upload-form details, \n    #file-upload-form-progress, \n    .file-upload-form-detail,\n    #file-upload-form input, \n    #file-upload-form textarea { \n        grid-column: 1 / 2;\n        min-width: 0px; /* helps prevent overflow on very narrow viewports */\n    }\n} \n",""]);const a=o},5812:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s),a=n(1667),l=n.n(a),c=new URL(n(7129),n.b),d=o()(r());d.push([e.id,"@import url(https://rsms.me/inter/inter.css);"]);var h=l()(c);d.push([e.id,"html[data-scrollbars=\"hidden\"] {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars=\"hidden\"]::-webkit-scrollbar { display: none; }\n\ncode { font-family: 'IBM Plex Mono', monospace; }\n\npre { font-family: 'IBM Plex Mono', monospace; }\n\n* { font-family: 'Inter', sans-serif; }\n\n@supports (font-variation-settings: normal) {\n  * { font-family: 'Inter var', sans-serif; }\n}\n\n.katex * { font-family: unset }\n\nbody { \n  margin:0px; \n  height:100vh;\n}\n\nbody[data-modal-visible] { \n  overflow:hidden;\n}\n\n@keyframes reverse-pulse-color{\n  0% { color: white }\n  50% { color: black }\n  100% { color: white}\n}\n\n@keyframes pulse-opacity {\n  0% { opacity:1 }\n  50% { opacity:.2 }\n  100% { opacity:1 }\n}\n\n@keyframes pulse-scale {\n  0% { transform: scale(1) }\n  50% { transform: scale(1.1) }\n  100% { transform: scale(1) }\n}\n\n@keyframes delayed-fade {\n  0% { opacity:0 }\n  50% { opacity:0 }\n  100% { opacity:1 }\n}\n\n@keyframes pulse-half-opacity {\n  0% { opacity:.5 }\n  50% { opacity:.2 }\n  100% { opacity:.5 }\n}\n\n@keyframes pulse-color {\n  0% { background-color: white; }\n  50% { background-color: var(--user_light); }\n  100% { background-color: white; }\n}\n\n.select-view {\n  display:flex;\n  gap:10px;\n  overflow-y:auto;\n}\n\n.select-view > button {\n  cursor:pointer;\n  outline:none;\n  border:none;\n  padding:5px;\n  font-weight:bold;\n  background:none;\n  user-select:none;\n  border-bottom:2px solid transparent;\n  transition:border .25s;\n  flex-grow: 1;\n}\n\n.select-view > button[data-current-button] {\n  border-bottom:2px solid var(--max-contrast-background);\n}\n\n.select-view > button[disabled] {\n  color:var(--content-dimmed-element);\n  cursor:not-allowed;\n}\n\n.styled-button {\n  cursor:pointer;\n  outline:none;\n  border:2px solid var(--max-contrast-background);\n  padding:2px 4px 2px 4px;\n  font-weight:bold;\n  background:var(--content-background);\n  user-select:none;\n}\n\n.styled-button:disabled {\n  color:var(--content-disabled-element);\n  border:2px solid var(--content-disabled-element);\n  cursor:not-allowed;\n}\n\n.styled-button:focus {\n  border:3px solid black;\n  padding:1px 3px 1px 3px;\n}\n\n.styled-progress {\n  appearance: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  border: none;\n}\n\n.styled-input {\n  font-size:10pt;\n  padding:7px;\n  border:none;\n  background:var(--input-background);\n  outline-offset: -2px;\n}\n\n.styled-rule {\n  border-top:none;\n  border-left:none;\n  border-right:none;\n  border-bottom:1px solid var(--content-border);\n}\n\n.top-aligned-label {\n  height:100%;\n  padding-top:7px;\n  margin-top:1px;\n}\n\n.select-sort-icon {\n  height:1.5em;\n  content: url("+h+");\n}\n\n.styled-button[data-current-button]{\n  color:var(--contrast-text);\n  background:var(--max-contrast-background);\n}\n\n.styled-progress::-webkit-progress-bar {\n  background: var(--input-background);\n  padding: 5px;\n}\n\n.styled-progress::-moz-progress-bar {\n  background: var(--input-text);\n  padding: 5px;\n}\n\n.styled-progress::-webkit-progress-value {\n  background: var(--max-contrast-background);\n}\n\n.small-icon {\n  height: 20px;\n  width: 20px;\n  border:none;\n  background:none;\n  padding:0px;\n}\n\nbutton.small-icon { cursor:pointer }\n\n.small-icon-badge {\n  background:var(--max-contrast-background);\n  position:relative;\n  bottom:10px;\n  display:inline-flex;\n  align-items: center;\n  border:none;\n  justify-content: space-around;\n  color:var(--contrast-text);\n  font-size:8pt;\n  font-weight:bold;\n  min-width:18px;\n  height:18px;\n  border-radius:10px;\n}\n\n.small-icon-badge > span {\n  margin-left:3px;\n  margin-right:3px;\n}\n\n.small-icon > svg {\n  height: 20px;\n  width: 20px;\n}\n",""]);const u=d},8816:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#image-view[data-image-selecting] {\n  touch-action:none;\n}\n\n#image-view img { \n  pointer-events:none;\n}\n\n#image-view-wrapper {\n  height: calc(var(--zoomFactor) * var(--contentHeightPx));\n  width: calc(var(--zoomFactor) * var(--contentWidthPx)); \n  overflow:hidden;\n}\n\n#image-overlay {\n  position:absolute;\n  height:100%;\n  width:100%;\n  opacity:0.4;\n  cursor:crosshair;\n}\n\n.image-annotation-rect { cursor: pointer; }\n\n[data-annotations-hidden] #image-overlay {\n  display:none;\n}\n\n.image-annotation-rect-drag {\n  cursor: grab;\n}\n\n.image-annotation-rect-resize-w {\n  cursor: ew-resize;\n}\n\n.image-annotation-rect-resize-h {\n  cursor: ns-resize;\n}\n",""]);const a=o},5440:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,".invite-candidate,\n.disinvite-candidate,\n.ban-candidate,\n.unban-candidate,\n.removal-candidate {\n  display:grid;\n  grid-template-columns:30px 1fr;\n  position:relative;\n  background:none;\n  border:none;\n  font-size:unset;\n  cursor:pointer;\n  align-items:center;\n  justify-items:left;\n  max-width:100%;\n}\n\n.disinvite-candidate {\n  opacity:.5\n}\n\n.invite-candidate:hover,\n.disinvite-candidate:hover,\n.ban-candidate:hover\n.unban-candidate:hover\n.removal-candidate:hover {\n  left:5px;\n}\n\n.invite-candidate .small-icon,\n.disinvite-candidate .small-icon,\n.ban-candidate .small-icon,\n.unban-candidate .small-icon,\n.removal-candidate .small-icon{\n  padding-right: 10px;\n}\n\n.invite-candidate-knocked {\n  grid-column: 1/3;\n  font-size:10pt;\n  color:var(--content-text-dimmed);\n  margin-bottom:5px;\n}\n\n#invite-search-divider {\n  margin-top:20px;\n  margin-bottom:20px;\n}\n\n#invite-select-view {\n  margin-top:20px;\n}\n\n#invite-search-directory {\n  margin-top:20px;\n}\n\n#invite-join-members,\n#invite-kick-members,\n#invite-ban-members,\n#invite-unban-members {\n  padding-top:10px;\n}\n\n#invite-select-wrapper {\n  transition:height .25s ease;\n  overflow-y: auto;\n  max-height:60vh;\n}\n",""]);const a=o},4050:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,".preview-quote {\n  /* padding:10px; */\n  color:var(--content-secondary-text);\n}\n\n.preview-quote svg {\n  padding-right: .25em;\n  height: 1em;\n}\n\n.preview-media-fragment,\n.preview-pin {\n  color:var(--content-secondary-text);\n}\n\n.preview-media-fragment-position, \n.preview-pin {\n  display:flex;\n  align-items:center;\n}\n\n.preview-media-fragment svg,\n.preview-pin svg {\n  height: 1em;\n}\n\n.preview-media-fragment img,\n.preview-media-fragment video {\n  display:none;\n}\n\n.preview-media-fragment canvas {\n  max-width:100%;\n  display:block;\n  border-radius:20px;\n  margin-top:10px;\n  background: var(--content-dimmed-element);\n}\n\n.preview-quote {\n  margin-top:10px;\n}\n\n.preview-media-fragment audio {\n  margin-top:10px;\n}\n",""]);const a=o},2462:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#login-container {\n  display:grid;\n  position:absolute;\n  align-items:center;\n  justify-items:center;\n  bottom:0px;\n  top:0px;\n  left:0px;\n  right:0;\n  background: var(--content-backdrop);\n  overflow:hidden;\n  --margin-unit: 17px\n}\n\n#login-backdrop {\n  position:absolute;\n  width:120vw;\n  transform: translateX(-10vw);\n}\n\n#login-backdrop rect {\n  transition:opacity 1s ease, fill 1s ease;\n}\n\n#login-wrapper {\n  position:relative;\n  padding: calc(3 * var(--margin-unit)) calc(4 * var(--margin-unit)) calc(4 * var(--margin-unit)) calc(4 * var(--margin-unit));\n  min-width:450px;\n  background: var(--content-background);\n  display: inline-block;\n  border: 1px solid var(--content-border);\n  transition: height .25s ease;\n  overflow-y:auto;\n  z-index:2;\n}\n\n#login, #registration {\n  overflow-y:auto;\n}\n\n#login h3, #registration h3 {\n  font-size:18pt;\n  margin-top:0px;\n}\n\n#login h4, #registration h4 {\n  margin:0px;\n}\n\n#login form, #registration form {\n  margin: calc(2 * var(--margin-unit)) 0 calc(2 * var(--margin-unit)) 0;\n}\n\n#login hr, #registration hr {\n  width:100%;\n  margin-bottom:15px;\n  margin-top:0px;\n}\n\n#login input:invalid, #registration input:invalid {\n    background:var(--input-invalid);\n}\n\n#login form, #registration form {\n    display:grid;\n    grid-template-columns: 90px 1fr;\n    align-items: center;\n}\n\n#login label, #registration label {\n    grid-column: 1 / 2 ;\n    margin:5px;\n    margin-left:0px;\n}\n\n#login div, #registration div { grid-column: 1 / 3 ; }\n\n#login-options {\n  background:var(--content-background);\n  color: var(--content-text-dimmed);\n  position:absolute;\n  bottom:0px;\n  font-size:10pt;\n  display:block;\n  left: calc(4 * var(--margin-unit));\n  right: calc(4 * var(--margin-unit));\n  padding:0px 0px 20px 0px;\n}\n\n#login-options a {\n  display:inline-block;\n  text-decoration: underline;\n  cursor: pointer;\n}\n\n#login-sso-providers {\n  margin:0px 0px 5px 0px;\n  padding-right:50px;\n  display:flex;\n  overflow:auto;\n  animation: delayed-fade .5s 1; \n  animation-timing-function:ease;\n  -webkit-mask-image: linear-gradient(to right, rgba(0, 0, 0, 1) 50%, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));\n  mask-image: linear-gradient(to right, rgba(0, 0, 0, 1) 50%, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));\n}\n\n.login-sso-listing {\n  display: grid;\n  grid-template-columns:1fr;\n  align-items: center;\n  justify-items: center;\n  cursor: pointer;\n  font-size:10pt;\n  padding:10px;\n}\n\n.login-sso-listing:hover img {\n  transition: transform ease .2s;\n}\n\n.login-sso-listing:hover img {\n  transform: scale(1.1);\n}\n\n#registration div.userdata-form-info,\n#login div.userdata-form-info {\n  grid-column: 2/3;\n  padding-top:0px;\n  padding-bottom:5px;\n  font-size:10pt;\n  min-height: 1.2em;\n}\n\n.sso-name {\n  color:var(--content-text);\n  text-decoration:none;\n  transition: font-weight ease .2s;\n}\n\n#registration button, #login button { \n    /* margin-top:10px; */ \n    margin-right:10px;\n}\n\n#theRecaptcha {\n    padding:1em;\n}\n\n#registeringFeedback {\n  text-align: center;\n  animation: pulse-opacity 2s infinite;\n}\n\n#server-loading-message {\n    animation: pulse-opacity 2s infinite; \n}\n\n@media only screen and (max-height: 450px), only screen and (max-width: 600px) {\n    #login-wrapper {\n      min-width:100vw;\n      overflow:visible;\n      border:unset;\n      padding: calc(3 * var(--margin-unit)) 0 calc(4 * var(--margin-unit)) 0;\n      display:grid;\n      justify-items:center;\n      align-items:center;\n    }\n\n    #login-container {\n      overflow:visible;\n    }\n\n    #login-options {\n      position:fixed;\n      left:calc(2 * var(--margin-unit));\n      right:calc(2 * var(--margin-unit));\n    }\n\n    #login, #registration {\n      width:100%;\n    }\n\n    #login-container {\n      background: var(--content-background)\n    }\n\n    #login-backdrop {\n      display:none;\n    }\n\n    #login, #registration { \n      border:none;\n      width:80%;\n    }\n\n    #login form, \n    #registration form { \n      border: 0px;\n      grid-template-columns: 1fr; \n    }\n\n    #registration div.userdata-form-info,\n    #login div.userdata-form-info {\n      grid-column: 1/3;\n    }\n\n    #login input,\n    #registration input { \n      margin-left:0px;\n      grid-column: 1 / 2 \n    }\n} \n",""]);const a=o},8809:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#media-view {\n    position:relative;\n    display: grid;\n    justify-content:center;\n    width:100%;\n}\n\n#media-view:not([data-media-is-video]) {\n    height:100%;\n    align-items:center;\n    grid-template-columns:1fr;\n    --wave-margin:100px;\n    --wave-bars:128px;\n    --wave-tab-offset:140px;\n}\n\n#media-view[data-media-is-video] {\n    grid-template-rows: minmax(50vh, 1fr) var(--wave-total);\n    grid-template-columns:1fr;\n    --wave-margin:50px;\n    --wave-bars:64px;\n    --wave-tab-offset:80px;\n    --wave-total:calc(var(--wave-margin) * 2 + var(--wave-bars))\n}\n\n@media only screen and (max-height: 400px) {\n    #media-view[data-media-is-video] {\n        --wave-margin:25px;\n        --wave-bars:32px;\n    }\n} \n\n#media-view-video {\n    position:relative;\n    background:black;\n    height:100%;\n    display: grid;\n    align-items:center;\n    justify-content:center;\n}\n\n#media-view-video-wrapper {\n  width:fit-content;\n  position:relative;\n}\n\n#media-view-video-overlay {\n  /* prevents mobile from taking over touch actions used for resize */\n  touch-action: none; \n  position:absolute;\n  --spotlightHandle:20px;\n  grid-template-areas: "header header header header header"\n    "leftcol over over right rightcol"\n    "leftcol left spot right rightcol"\n    "leftcol under under under rightcol"\n    "footer footer footer footer footer";\n  grid-template-columns: calc(var(--spotlightScale) * var(--spotlightX)) var(--spotlightHandle) calc(var(--spotlightScale) * var(--spotlightWidth) - (2 * var(--spotlightHandle))) var(--spotlightHandle) 1fr;\n  grid-template-rows: calc(var(--spotlightScale) * var(--spotlightY)) var(--spotlightHandle) calc(var(--spotlightScale) * var(--spotlightHeight) - (2 * var(--spotlightHandle))) var(--spotlightHandle) 1fr;\n  display: grid;\n  top:0;\n  bottom:0;\n  left:0;\n  right:0;\n}\n\n#media-view-video-overlay div {\n  background: black\n}\n\n#media-view-video-overlay:not([data-media-selection-mutable]) {\n  pointer-events:none;\n}\n\n#media-view-video-overlay-spotlight { grid-area:spot; }\n#media-view-video-overlay-header {grid-area:header}\n#media-view-video-overlay-left {grid-area:leftcol}\n#media-view-video-overlay-overlight { grid-area:over }\n#media-view-video-overlay-leftlight { grid-area:left; }\n#media-view-video-overlay-right { grid-area:rightcol; }\n#media-view-video-overlay-footer { grid-area:footer; }\n#media-view-video-overlay-rightlight {\n  grid-area:right;\n  z-index:1;\n}\n\n#media-view-video-overlay-underlight {\n  grid-area:under;\n  z-index:1;\n}\n\n#media-view-video-overlay-header,\n#media-view-video-overlay-left,\n#media-view-video-overlay-right,\n#media-view-video-overlay-footer {\n  opacity:0.3;\n}\n\n#media-view-video-overlay-spotlight,\n#media-view-video-overlay-overlight,\n#media-view-video-overlay-underlight,\n#media-view-video-overlay-rightlight,\n#media-view-video-overlay-leftlight {\n  opacity:0\n}\n\n[data-media-selection-mutable] > #media-view-video-overlay-spotlight,\n[data-media-selection-mutable] > #media-view-video-overlay-overlight,\n[data-media-selection-mutable] > #media-view-video-overlay-leftlight {\n  cursor:grab;\n}\n\n[data-media-selection-mutable] > #media-view-video-overlay-rightlight {\n  cursor:ew-resize;\n}\n\n[data-media-selection-mutable] > #media-view-video-overlay-underlight {\n  cursor:ns-resize;\n}\n\n[data-media-selection-mutable] > #media-view-video-overlay-rightlight,\n[data-media-selection-mutable] > #media-view-video-overlay-underlight {\n  opacity:0.1;\n}\n\n\n#media-view video {\n    max-width:100%;\n    max-height:calc(100vh - var(--navHeight) - var(--wave-total)) ;\n    cursor:crosshair;\n}\n\n\n@media only screen and (max-width: 600px), only screen and (max-height: 600px) {\n    #media-view video {\n        max-height:calc(100vh - (var(--navHeight) * .8) - var(--wave-total)) ;\n    }\n}\n\n#waveform {\n  width: 100%;\n  background: var(--content-background)\n}\n\nhtml[data-scrollbars="hidden"] wave {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] wave::-webkit-scrollbar { display: none; }\n\n.wavesurfer-region::before{\n  background:var(--user_solid);\n  content:"";\n  top:0px;\n  right:0px;\n  left:0px;\n  bottom:0px;\n  position:absolute;\n  opacity:0.2;\n  transition: opacity 0.25s ease;\n  cursor:pointer;\n}\n\n#waveform[data-annotations-focused] .wavesurfer-region::before {\n  opacity: 0.1;\n}\n\n\n#waveform[data-annotations-focused] .wavesurfer-region[data-focused]::before {\n  opacity: 0.3;\n}\n\n.wavesurfer-region[data-id="active-selection"] {\n  opacity: 0.3;\n}\n\n[data-annotations-hidden] .wavesurfer-region:not([data-id="active-selection"]) {\n  display:none;\n}\n\n.wavesurfer-region::after {\n  background:var(--user_solid);\n  opacity:0.5;\n  content:"";\n  height:5px;\n  right:0px;\n  left:0px;\n  position:absolute;\n  top:calc(var(--wave-tab-offset) + (10px * var(--gutter_level)));\n  max-width:100%;\n  cursor:pointer; \n}\n\n.wavesurfer-handle {\n  width:10px !important;\n}\n\n#waveform {\n    overflow:hidden;\n}\n\n\nwave {\n  margin-top:var(--wave-margin);\n  padding-bottom:var(--wave-margin);\n}\n\nwave wave,\nwave canvas,\nwave region {\n  margin:0px;\n  padding:0px;\n  max-height:var(--wave-bars);\n  height:var(--wave-bars)\n}\n',""]);const a=o},8151:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#media-modal {\n  position: fixed;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  display:flex;\n  justify-content:center;\n  align-content:center;\n  z-index:20;\n  overflow-y:auto;\n}\n\n#media-modal-background {\n  position: fixed;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  background:black;\n  opacity:0.5;\n  overscroll-behavior:none;\n}\n\n#media-modal-close > svg {\n  vertical-align:middle;\n}\n\n#media-modal-download,\n#media-modal-close {\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  color:black;\n  position: fixed;\n  left: 10px;\n  height:36px;\n  width:36px;\n  cursor:pointer;\n  border-radius:30px;\n  background:rgba(255,255,255,.5);\n  border:none;\n  z-index:22;\n}\n\n#media-modal-close {\n  top: 10px;\n}\n\n#media-modal-download {\n  top: 56px;\n}\n\n#media-modal-content{\n  position: relative;\n  opacity:1;\n  margin:auto;\n  max-width:calc(100vw);\n  overscroll-behavior:contain;\n}\n\nhtml[data-scrollbars="hidden"] #media-modal-content {\n  scrollbar-width: none;\n}\n\nhtml[data-scrollbars="hidden"] #media-modal-content::-webkit-scrollbar {\n  display: none;\n}\n',""]);const a=o},3062:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,".member-pill {\n    border-radius:5px;\n    padding:5px;\n    white-space: nowrap;\n    color:var(--user_dark);\n    font-weight:500;\n    display:inline-block;\n    overflow-x:hidden;\n    text-overflow:ellipsis;\n    background: var(--user_light);\n}\n",""]);const a=o},9688:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'.redacted {\n    font-size:10pt;\n    color:var(--content-text-dimmed);\n}\n\n/* should DRY with #file-uploader-preview */\n\n.file-upload {\n  display:grid;\n  grid-template-columns:30px 1fr;\n  margin:0px 10px 10px 0px;\n  padding:10px 10px 10px 10px;\n  border: 1px solid var(--content-border);\n  border-radius:10px;\n  align-items:center;\n}\n\n.file-upload span:nth-child(1) {\n  grid-row:1/3;\n}\n\n.file-upload a:nth-child(2) {\n  font-weight:bold;\n}\n\n.file-upload span:nth-child(3) {\n  font-size:10pt;\n  color:var(--content-text-dimmed)\n}\n\n.message-frame > .message-body {\n    display: inline-block;\n    text-align:left;\n    margin-top:5px;\n    margin-bottom:5px;\n    margin-right:5px;\n    grid-area: content;\n    overflow-wrap: anywhere;\n    /* XXX: depreciated, but needed until webkit adds overflow-wrap: anywhere */\n    word-break: break-word;\n    hyphens:auto;\n}\n\n.message-body p:first-child {\n  margin-top:5px;\n}\n\n.message-body p:last-child {\n  margin-bottom:5px;\n}\n\n.message-body blockquote {\n  margin-left: 1em;\n}\n\n.message-body [data-mx-maths],\n.message-body pre {\n  overflow-y: scroll;\n  max-width: calc(var(--widget-1-width) - 55px);\n}\n\n/* allows max-width on inline math */\nspan[data-mx-maths] { \n  display:inline-block; \n  vertical-align:middle;\n}\n\nhtml[data-scrollbars="hidden"] .message-body [data-mx-maths],\nhtml[data-scrollbars="hidden"] .message-body pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] .message-body [data-mx-maths]::-webkit-scrollbar,\nhtml[data-scrollbars="hidden"] .message-body pre::-webkit-scrollbar { display: none; }\n\n\n.message-body a {\n  color:var(--content-text);\n}\n\n.message-body a:hover {\n  text-underline-offset: 0.1em;\n  text-decoration-thickness: 0.125em;\n}\n\n.message-body a[href^="https://matrix.to/#/@"] {\n  font-weight: bold;\n  color:var(--user_dark);\n  cursor: unset;\n  text-decoration: none;\n}\n\n.message-body a[href^="https://matrix.to/#/@"]::before {\n  content:"@"\n}\n\n.emote-banner {\n  color: var(--user_dark);\n  font-weight:bold;\n}\n\n.annotation-banner {\n  font-size:10pt;\n  font-weight: bold;\n}\n\n.message-frame div[data-mx-maths] {\n    min-width:300px;\n}\n\n.message-reactions {\n    position:relative;\n    width:0px;\n    top:0px;\n    right:10px;\n    height:100%;\n}\n\n.message-reactions > div {\n  position: absolute;\n  max-height:100%;\n  display:flex;\n  flex-direction:column;\n  font-size:8pt;\n  padding:2px;\n  background:var(--content-background);\n  border-radius:25px;\n  user-select:none;\n  border:2px solid var(--user_light);\n  overflow: scroll;\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width: none;  /* Firefox */\n}\n\n.message-reactions > div::-webkit-scrollbar { display: none; }\n\n.emoji-badge {\n  white-space: nowrap;\n  padding-top:1px;\n  padding-bottom:1px;\n  cursor: pointer;\n}\n\n.reply-sender-info,\n.user-info-message {\n    display:flex;\n    align-items: center;\n    font-size:10pt;\n    font-weight:bold;\n    color: var(--user_dark);\n    margin-bottom:10px;\n}\n\n.user-info-message {\n    padding-left:10px;\n    padding-right:10px;\n    margin-top:10px;\n}\n\n.reply-sender-info > img,\n.user-info-message > img {\n    width:20px;\n    height:20px;\n    border-radius:30px;\n    position:relative;\n    left:-5px;\n    object-fit:cover;\n    user-select: none;\n}\n\n.large-emoji-display { font-size: 36pt }\n\n.reply-preface {\n    position:relative;\n    color:var(--content-text-dimmed);\n    font-size:10pt;\n    padding-bottom:5px;\n}\n\n.reply-preface a {\n    color:var(--content-text-dimmed);\n    cursor:pointer;\n}\n\n.reply-preview {\n    border-left:5px solid var(--user_light);\n    padding-left:15px;\n    position:relative;\n    margin-bottom:15px;\n}\n\n.reply-preview video,\n.reply-preview img {\n  position:absolute;\n  opacity:0;\n  transition: opacity .25s ease;\n  /* need a greater max-width here because absolutely positioned elements use\n   * the padding of the parent they\'re relative to when computing width*/ \n  max-width:calc(100% - 35px)\n}\n\n.redacted-preview {\n    padding-top:5px;\n    font-size:10pt;\n    color:var(--content-text-dimmed);\n}\n\n.reply-fallback blockquote{\n    margin:0px\n}\n\n[data-truncate-reply] {\n  max-height:150px;\n  overflow:hidden;\n  -webkit-mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 100px, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));\n  mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 100px, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));\n  cursor:pointer;\n}\n\n.message-from-user > img {\n   left: 5px;\n}\n\n.message-from-user .message-reactions {\n    right:-10px;\n}\n\n.message-from-user .message-reactions div{\n    right:0px;\n}\n\n.media-message {\n  position:relative;\n  display:flex;\n  justify-content:center;\n  align-items:center;\n}\n\n.media-message video, \n.media-message img {\n  position:absolute;\n  opacity:0;\n  transition: opacity .25s ease;\n  /* need a greater max-width here because absolutely positioned elements use\n   * the padding of the parent they\'re relative to when computing width*/ \n  max-width:calc(100% - 35px)\n}\n\n\n[data-media-message-loaded] video, \n[data-media-message-loaded] img {\n  opacity:1;\n}\n\n.reply-preview canvas,\n.media-message canvas {\n  background: var(--content-backdrop)\n}\n\n[data-media-message-loaded] canvas {\n  opacity:0;\n}\n\n.media-message-blurhash {\n  border-radius:20px;\n  transition: opacity .25s ease;\n  pointer-events:none;\n}\n\n.media-message-thumbnail {\n  border-radius:20px;\n  max-width:calc(100% - 20px);\n  overflow:hidden;\n}\n\nimg.media-message-thumbnail {\n  cursor: pointer;\n}\n\n.image-message-preview,\n.audio-message-preview,\n.video-message-preview {\n  margin:10px;\n  width: calc(100% - 30px);\n}\n\n.media-message-thumbnail.awaiting {\n  height:200px;\n  margin:10px;\n  border:3px dashed black;\n  width: calc(100% - 30px);\n}\n',""]);const a=o},5282:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'.message-frame {\n    position:relative;\n    display: grid;\n    width:100%;\n    justify-items: left;\n    grid-template-areas: "ident content";\n    grid-template-columns: fit-content(10%) auto;\n    transition: background-color .2s ease;\n}\n\n.message-from-user {\n    grid-template-columns: auto fit-content(10%);\n    grid-template-areas: "content ident";\n    text-align:right;\n    flex-direction:row-reverse;\n}\n\n.message-decoration {\n    position:relative;\n    grid-area: ident;\n    width:0px;\n    padding-top:10px;\n    padding-bottom:10px;\n    padding-left:12px;\n    margin-right:20px;\n    border-right: 5px solid var(--user_light);\n    background: var(--content-background);\n}\n\n.message-from-user > .message-decoration {\n    padding-left:0px;\n    margin-right:0px;\n    padding-right:12px;\n    margin-left:15px;\n    border-right: none;\n    border-left: 5px solid var(--user_light);\n}\n\n.message-actions {\n    width:calc(var(--widget-1-width) - 25px);\n    padding:5px;\n    visibility:hidden;\n    position:absolute;\n    text-align:right;\n    top:-38px;\n}\n\n.message-actions > button {\n    cursor: pointer;\n    margin:0px;\n    margin-left:5px;\n    border:2px solid var(--user_light);\n    padding-left:4px;\n    padding-right:4px;\n    background:var(--content-background);\n    min-height:30px;\n    vertical-align:bottom;\n}\n\n.message-actions > button:hover {\n    background-color: var(--user_light);\n}\n\n.message-actions > button > svg {\n  height:16px;\n  width:16px;\n}\n\n.message-actions > button:first-child {\n    margin-left:0px;\n}\n\n.message-actions > button:last-child {\n    margin-right:0px;\n}\n\n.message-actions > emoji-picker {\n  position:absolute;\n  bottom: 0px;\n  right:0px;\n  --num-columns: 6;\n  width:250px;\n}\n\n.message-from-user .message-actions {\n    left:unset;\n    right: 14px;\n    text-align:left;\n}\n\n.message-frame .message-actions[data-active],\n.message-frame:hover .message-actions  {\n    visibility:visible;\n}\n\n/* status vanishes on sent. We probably want a warning for a "not_sent" status,\n * whuch means that sending has failed */\n.message-frame[data-event-status] {\n    color:var(--content-text-dimmed);\n}\n\n.message-frame .message-frame-status {\n  position: absolute;\n  right: 25px;\n  bottom: 5px;\n  width:300px;\n  font-size:10pt;\n  color:var(--content-text-dimmed);\n}\n\n.message-frame .message-frame-status a {\n  text-decoration:underline;\n  cursor:pointer;\n}\n\n.message-frame:hover {\n    background-color: var(--user_ultralight);\n}\n\n.message-from-user .message-body  {\n    padding-left:15px;\n}\n',""]);const a=o},7724:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#modal-popup {\n  position: fixed;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  display:flex;\n  padding:25px;\n  justify-content:center;\n  z-index:20;\n  overflow-y:auto;\n  overflow-x:hidden;\n}\n\n#modal-background {\n  position: fixed;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  background:black;\n  opacity:0.15;\n  overscroll-behavior:none;\n}\n\n#modal-content {\n  position: relative;\n  background:var(--content-background);\n  opacity:1;\n  width:400px;\n  min-height:150px;\n  max-width:70vw;\n  margin:auto;\n  border-radius:30px;\n  padding:30px;\n  padding-right:30px;\n  z-index:21;\n  overscroll-behavior:contain;\n  animation: slide-in .5s ease-out;\n}\n\n#modal-content textarea, #modal-content input {\n  outline-offset:-2px\n}\n\nhtml[data-scrollbars="hidden"] #modal-content {\n  scrollbar-width: none;\n}\n\nhtml[data-scrollbars="hidden"] #modal-content::-webkit-scrollbar {\n  display: none;\n}\n\n@keyframes slide-in {\n    0% { \n      top: -30px; \n      opacity:0;\n    }\n    100% { \n      top: 0px; \n      opacity:1;\n    }\n}\n\n#modal-header {\n  display:grid;\n  margin-top:-10px;\n  margin-bottom:20px;\n  grid-template-columns:1fr 24px;\n  align-items:center;\n}\n\n#modal-title {\n  padding:0px;\n  margin:0px;\n  display:inline;\n}\n\n#modal-subtitle {\n  grid-column:1/3;\n  font-size:10pt;\n  color:var(--content-disabled-element);\n}\n\n#dismiss-modal {\n  cursor:pointer;\n  background:none;\n  border:none;\n}\n',""]);const a=o},6145:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s),a=n(1667),l=n.n(a),c=new URL(n(5685),n.b),d=o()(r()),h=l()(c);d.push([e.id,'#page-nav {\n    position:fixed;\n    bottom:0px;\n    width:100%;\n    height:var(--navHeight);\n    z-index:5;\n    transition: height 0.5s ease;\n}\n\n#nav-background{\n    background: var(--max-contrast-background);\n    position:absolute;\n    width:100%;\n    top:0px;\n    bottom:0px;\n}\n\n#nav-pages {\n    display:flex;\n    position:absolute;\n    bottom: var(--navHeight);\n    align-items: center;\n    height:50px;\n    width: var(--contentWidth);\n    overflow-y:scroll;\n    transition: bottom 0.5s ease-in-out;\n}\n\nhtml[data-scrollbars="hidden"] #nav-pages {\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n}\n\nhtml[data-scrollbars="hidden"] #nav-pages::-webkit-scrollbar { display: none; }\n\n.nav-hidden {\n    bottom:0px !important;\n}\n\n#nav-pages > button:first-child {\n    margin-left:auto\n}\n\n#nav-pages > button:last-child {\n    margin-right:auto\n}\n\n#nav-pages > button {\n    cursor:pointer;\n    background:var(--content-background);\n    border:2px solid black;\n    min-width:40px;\n    min-height:40px;\n    border-radius:30px;\n    margin-left:5px;\n    margin-right:5px;\n    text-align:center;\n}\n\n#nav-pages > button.typing {\n    animation: pulse-color 2s infinite; \n    animation-timing-function:ease;\n}\n\n#nav-pages > button:focus {\n  font-weight: bold;\n}\n\n.nav-button-wrapper {\n    position:relative;\n    display: flex;\n    height:75px;\n    align-items: center;\n    justify-content:center;\n    max-width: var(--contentWidth);\n    transition: var(--transitionSizing)\n}\n\n@media only screen and (max-width: 600px), only screen and (max-height: 600px) {\n    .nav-button-wrapper {\n        display: grid;\n        grid-template-columns: repeat(9,1fr);\n        transform: scale(0.8);\n        transform-origin: left;\n        min-width: calc((var(--contentWidth)/0.8));\n        justify-content:space-around;\n    }\n\n    #page-nav {\n      height:calc(0.8 * var(--navHeight));\n    }\n\n    #nav-pages {\n      bottom: calc(0.8 * var(--navHeight));\n    }\n\n    .nav-button-wrapper {\n      height:calc(0.8 * 75px);\n    }\n}\n\n@media only screen and (min-width: 600px) and (min-height:600px) {\n    .nav-button-wrapper > button:first-child {\n        position: absolute;\n        left:10px;\n    }\n\n    .nav-button-wrapper > button:last-child {\n        position: absolute;\n        right:10px;\n    }\n}\n\n.nav-button-wrapper button {\n    cursor:pointer;\n    outline:none;\n    color:var(--contrast-text);\n    background:none;\n    border:none;\n    margin:2px;\n}\n\n.nav-button-wrapper button:focus {\n  outline: 1px solid white;\n}\n\n.nav-button-tip-wrapper {\n  display:flex;\n  justify-content:center;\n}\n\n.nav-button-wrapper button[disabled] {\n    color: var(--contrast-text-dimmed);\n    cursor:not-allowed;\n}\n\n.nav-position {\n    position: relative;\n    display:flex;\n    align-items: center;\n    justify-content: center;\n    background:var(--content-background);\n    font-size: 1em;\n    border-radius:50px;\n    height:45px;\n}\n\n#nav-page-input {\n    width:20px; /*this is going to need to be adjusted in JS*/\n    font-size: 1em;\n    border:none;\n    text-align:right;\n}\n\n#nav-total-pages {\n    padding-right:5px;\n}\n\n#nav-time-elapsed {\n    text-align:right;\n}\n\n@media only screen and (max-width: 600px) {\n    .nav-position > input { display:none }\n    .nav-position > span { display:none }\n    #nav-time-elapsed { \n      display:inline-block;\n      text-align:center;\n    }\n}\n\n.nav-position > button {\n    cursor:pointer;\n    outline:none;\n    margin:5px;\n    padding:5px;\n    height:35px;\n    border-radius:50px;\n    border:none;\n    color:var(--content-text);\n    background:var(--content-background);\n    transition: background 0.5s ease;\n}\n\n.nav-position > button:hover {\n    color:var(--contrast-text);\n    background:var(--contrast-background);\n    transition: background 0.5s ease;\n}\n\n.nav-position > button.nav-toggled {\n    color:var(--contrast-text);\n    background:var(--contrast-background);\n    transition: background 0.5s ease;\n}\n\n#nav-total-pages {\n    font-size: 1em;\n    text-align:left;\n    min-width:20px;\n    margin:3px;\n}\n\n.currentpage {\n  background:var(--max-contrast-background) !important;\n  color: var(--contrast-text);\n}\n\n[data-pindrop-mode="unplaced"] #page-nav * { \n  cursor:unset;\n}\n\n[data-pindrop-mode="unplaced"] #page-nav { \n  cursor: url('+h+") 16 16, pointer !important;\n}\n",""]);const u=d},3519:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#notifications-listing {\n  width: 100%;\n  margin: 0px var(--margin-unit) 0 var(--margin-unit);\n  max-width: calc(800px + (2 * var(--margin-unit)));\n}\n\n.notification, .invite-entry {\n  margin-top:calc(.5 * var(--margin-unit));\n  border: 1px solid var(--content-border);\n  background:var(--content-background);\n}\n\n.unread-notification, .invite-entry {\n  border: 2px solid black;\n}\n\n.invite-entry {\n    padding: 1em; \n}\n\n.notification-contents {\n  padding-bottom:10px;\n}\n\n.discussion-intro {\n  padding:10px;\n  font-size:10pt;\n}\n\n.discussion-topic {\n  padding:10px;\n  padding-left:20px;\n}\n\n.discussion-topic .non-text-topic{\n  color:var(--content-secondary-text);\n  display:flex;\n  align-items:center;\n}\n\n.discussion-topic .non-text-topic svg{\n  height: 1em;\n}\n\n.notification-header > img {\n    width:20px;\n    height:20px;\n    border-radius:30px;\n    position:relative;\n    left:-5px;\n    object-fit:cover;\n    user-select:none;\n}\n\n.notification-header {\n    padding:10px;\n    display:flex;\n    align-items: center;\n    font-size:10pt;\n}\n\n.notification-date-indicator {\n  margin-top:calc(.5 * var(--margin-unit));\n  font-size:10pt;\n  color:var(--backdrop-text)\n}\n\n.notification-header .sender {\n    font-weight:bold;\n    color: var(--user_dark);\n}\n\n.notification-body {\n    padding:20px;\n    padding-top:10px;\n    border-left: 5px solid var(--user_light);\n    margin-left:13px;\n    margin-bottom:13px;\n}\n",""]);const a=o},3723:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#content-container {\n  --dragOffset-1: 0px;\n  --dragOffset-2: 0px;\n  --sidepanelWidth: 100%; \n  --widget-1-width: calc(100vw - var(--widget-control-width));\n  /* 1px to compensate for border */\n  --widget-2-width: calc(100vw - var(--widget-control-width) + 1px);\n  --widget-control-width:40px;\n  --transitionSizing: height 0.5s ease, max-width 0.5s ease, width 0.5s ease,  left 0.5s ease, right 0.5s ease, padding 0.5s ease;\n}\n\n#sidepanel {\n    display:flex;\n    position:fixed;\n    right: 0px;\n    top:0px;\n    bottom:0px;\n    box-shadow: -2px 0 4px 0 rgba(0,0,0,.2);\n    background:var(--content-background);\n    z-index:6;\n    /*  for mobile, override below */\n    left: calc(\n      (100% + 5px) * (1 - max(var(--chatVisible), var(--listingVisible)))\n    );\n    width: calc(\n      max(\n        var(--widget-control-width),\n        var(--sidepanelWidth) * min(1,var(--chatVisible) + var(--listingVisible))\n      )\n    );\n    transition: var(--transitionSizing)\n}\n\n.panel-handle {\n  opacity:0;\n  position:absolute;\n  left:-10px;\n  width: 10px;\n  height:100%;\n  display:flex;\n  align-items:center;\n  cursor:ew-resize;\n  font-size:16pt;\n  user-select:none;\n  touch-action:none;\n}\n\n.panel-handle > div {\n  position:relative;\n  right:10px\n}\n\n.panel-handle:hover {\n  opacity:1;\n}\n\n#panel-handle-2 {\n  left: calc((var(--chatVisible) * var(--widget-1-width)) - 10px);\n}\n\n/* workaround for chrome bug with resizing the chat panel itself */\n.panel-widget-1, .panel-widget-2 {\n    position:absolute;\n    display:inline-flex;\n    height:100%;\n    overflow-y:auto;\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\n    -moz-box-sizing: border-box; /* Firefox, other Gecko */\n    box-sizing: border-box; /* Opera/IE 8+ */\n    transition: var(--transitionSizing)\n}\n\n.panel-widget-1 {\n    width: var(--widget-1-width);\n    min-width: var(--widget-1-width);\n}\n\n.panel-widget-2 {\n    left: calc(\n      var(--chatVisible) * (var(--widget-1-width) + var(--widget-control-width)) \n      + (var(--listingVisible) * -1px) /* 1px to compensate for border */\n    );\n    width: var(--widget-2-width);\n    min-width: var(--widget-2-width);\n    border-left:1px solid #adadad;\n    background:var(--content-background);\n}\n\nhtml[data-scrollbars="hidden"] .panel-widget-2,\nhtml[data-scrollbars="hidden"] .panel-widget-1 {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width: none;  /* Firefox */\n}\n\n/*chrome, safari, opera*/\nhtml[data-scrollbars="hidden"] .panel-widget-2::-webkit-scrollbar,\nhtml[data-scrollbars="hidden"] .panel-widget-1::-webkit-scrollbar {\n  display: none;\n}\n\n.panel-widget-controls {\n  box-sizing:border-box;\n  height:100%;\n  position:fixed;\n  right:calc(-1 * (1 - min(1,var(--chatVisible) + var(--listingVisible))) * var(--widget-control-width));\n  background:white;\n  width:var(--widget-control-width); \n  border-left:1px solid #adadad;\n  display:flex;\n  flex-direction:column;\n  gap:10px;\n  align-items:center;\n  transition: right .25s ease;\n}\n\n.panel-widget-controls > button {\n    border:none;\n    outline:none;\n    font-size:24px;\n    height:24px;\n    text-align:center;\n    vertical-align:middle;\n    background:transparent;\n    cursor:pointer;\n}\n\n.panel-widget-controls > button::after {\n  position:absolute;\n  right: -8px;\n  display:inline-block;\n  border-left: 8px solid black;\n  content:"";\n  height:24px;\n  border-radius:24px;\n  transition: right .5s;\n}\n\n.panel-widget-controls > button[data-active]::after {\n  right: -4px;\n  transition: right .5s;\n}\n\n.panel-widget-controls > hr {\n  border: none;\n  border-top: 1px solid #dedede;\n  width:24px;\n}\n\n@media only screen and (max-width: 600px) {\n  .panel-widget-controls .room-icon {\n    transform: scale(0.7)\n  }\n}\n\n/* Small devices (portrait tablets and large phones, 600px and up) */\n@media only screen and (min-width: 600px) {\n  .panel-widget-controls {\n    padding-top:10px;\n  }\n    #content-container {\n      --widget-control-width:80px;\n    }\n}\n\n/* Medium devices (landscape tablets, 768px and up) */\n@media only screen and (min-width: 768px) {\n\n    .panel-widget-controls {\n      right: 0px;\n    }\n\n    .panel-widget-2 {\n      left: calc(var(--chatVisible) * var(--widget-1-width));\n    }\n\n    #sidepanel {\n      left:unset;\n    }\n\n    #content-container {\n        --sidepanelWidth: calc(\n            (var(--widget-1-width) * var(--chatVisible))\n            + (var(--widget-2-width) * var(--listingVisible))\n            + (var(--widget-control-width))\n        );\n        --widget-1-width:calc(350px + var(--dragOffset-1));\n        --widget-2-width:calc(350px + var(--dragOffset-2));\n    }\n}\n\n/* standard DPI */\n@media only screen and (min-width: 1280px) {\n    #content-container {\n        --widget-1-width:calc(400px + var(--dragOffset-1));\n        --widget-2-width:calc(400px + var(--dragOffset-2));\n    }\n\n    .panel-widget-1 {\n        padding:0px;\n        border: none;\n    }\n}\n\n/* high DPI laptop */\n@media only screen and (min-width: 1400px) {\n}\n    \n@media only screen and (min-width: 1800px) {\n    #content-container {\n        --widget-1-width:calc(400px + var(--dragOffset-1));\n        --widget-2-width:calc(500px + var(--dragOffset-2));\n    }\n}\n',""]);const a=o},8244:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#popup-wrapper {\n  position:sticky;\n  z-index:10;\n}\n\n#popup-menu {\n  position:absolute;\n  left:0px;\n  right:0px;\n  border-top: 1px solid #adadad;\n  border-bottom: 1px solid #adadad;\n}\n\n.popup-menu-item {\n  padding:10px;\n  height:20px;\n  background:var(--content-background);\n  cursor: pointer;\n  overflow-x:hidden;\n  white-space:pre;\n}\n\n.popup-menu-item-selected-user {\n  background:var(--user_ultralight);\n}\n\n.popup-menu-item-selected-flag,\n.popup-menu-item-selected-emoji {\n  background:var(--low-contrast-background)\n}\n\n.popup-menu-item-username {\n  font-weight:bold;\n  color:var(--user_dark)\n}\n",""]);const a=o},3734:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#profile-information {\n  max-width:800px;\n  width:100%;\n  margin:var(--margin-unit);\n  padding-top:calc(.5 * var(--margin-unit));\n  border: 1px solid var(--content-border);\n  height:fit-content;\n  background: var(--content-background);\n  padding: var(--margin-unit);\n  padding-top: calc(.5 * var(--margin-unit));\n}\n\n#profileInformationForm {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n    margin-top: calc(.75 * var(--margin-unit));\n    align-items:center;\n}\n\n#profile-display-options,\n#profile-advanced-options {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n    padding:10px;\n    padding-right:0px;\n    align-items:center;\n}\n\n#profile-advanced-options > pre {\n  margin:0px;\n  font-size:10pt;\n  overflow-y:scroll;\n  user-select:all;\n}\n\nhtml[data-scrollbars="hidden"] #profile-advanced-options > pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width: none;  /* Firefox */\n}\n\nhtml[data-scrollbars="hidden"] #profile-advanced-options > div::-webkit-scrollbar { display: none; }\n\n#profileInformationForm label {\n    grid-column: 1 / 2 ;\n}\n\n#profileInformationForm details {\n    grid-column: 1 / 3 ;\n}\n\n#profileInformationForm input,\n#profile-information-userid {\n    grid-column: 2 / 3 ;\n    margin-bottom:.5em;\n    overflow-y:auto;\n}\n\n#profileInformationForm input {\n    border:none;\n    background:var(--input-background);\n}\n\n#profileSelector {\n    cursor: pointer;\n    display:block;\n    height:180px;\n    max-height:180px;\n    width:180px;\n    object-fit:cover;\n    border-radius:90px;\n    grid-column: 2 / 3 ;\n    margin:auto;\n}\n\ndiv#profileSelector {\n    background : #ababab;\n}\n\n#profileSelector:hover {\n    filter: brightness(80%);\n    transition: filter 0.5s ease;\n}\n\n#profileInformationFormSubmit {\n    grid-column: 1 / 3 ;\n}\n\n#profileInformationFormSubmit > button {\n    margin-top:10px;\n    margin-right:10px;\n}\n\n#profileInformationFormProgress {\n    grid-column: 1 / 3 ;\n    padding-top: 10px;\n    animation: pulse-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n#profileInformationFormProgress > progress {\n  width: 100%\n}\n\n#profileInformationFormHidden {\n    display:none;\n}\n\n@media only screen and (max-width: 600px) {\n\n    #profileInformationForm,\n    #profile-advanced-options,\n    #profile-display-options {\n      grid-template-columns: 1fr \n    }\n\n    #profileInformationFormProgress,\n    #profile-information-userid,\n    #profileInformationForm > input { \n      grid-column: 1 / 2;\n    }\n\n    #profile-advanced-options > pre {\n      padding: 5px\n    }\n\n    #profileSelector {\n      grid-column: 1 / 2;\n    }\n} \n',""]);const a=o},1737:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,".room-icon {\n  display:inline-block;\n  border-radius:5px;\n  overflow:hidden;\n  vertical-align:bottom;\n  transition: opacity 0.5s ease;\n  user-select:none;\n}\n\n.room-icon img {\n  object-fit:cover;\n  transition: opacity 0.5s ease;\n}\n\n.room-icon[data-placeholder], .room-icon[data-has-avatar] {\n  background : var(--low-contrast-background)\n}\n\n.room-icon:not([data-has-avatar]) {\n  background: var(--room_light);\n  color: var(--room_dark);\n  font-size:24pt;\n  text-align:center;\n}\n\n.room-icon:not([data-joined]) {\n  opacity: 0.5;\n}\n\n.room-icon[data-placeholder] img {\n  opacity: 0\n}\n\n.room-icon:hover {\n  opacity: 1\n}\n",""]);const a=o},8316:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#select-sort {\n    user-select:none;\n    display:flex;\n    align-items:center;\n    padding: calc(.5 * var(--margin-unit));\n    background: var(--content-background);\n    border: 1px solid var(--content-border);\n}\n\n#room-filters {\n    border: 1px solid var(--content-border);\n    background: var(--content-background);\n    margin-top: var(--margin-unit);\n    padding: calc(.5 * var(--margin-unit));\n}\n\n.room-filter-listing:first-child {\n    padding-left:calc(.5 * var(--margin-unit));\n}\n\n.room-filter-listing {\n    position:relative;\n    font-weight: bold;\n}\n\n.room-filter-content .small-icon {\n    vertical-align: sub;\n    padding-right:5px;\n}\n\n.room-filter-content::after {\n    content: ","\n}\n\n.room-filter-listing > .small-icon-badge {\n  visibility:hidden;\n  cursor: pointer;\n  padding:0px;\n}\n\n.room-filter-listing > .small-icon-badge > svg {\n  height:10px;\n  width:10px;\n  stroke-width:4px;\n}\n\n.room-filter-listing:hover > .small-icon-badge {\n  visibility:visible;\n}\n\n#select-sort > button {\n    margin-left: 15px;\n}\n\n#select-sort > .small-icon {\n    margin-left: 0em;\n}\n\n.room-listing-entry {\n    margin-top: var(--margin-unit);\n    border: 1px var(--content-border) solid;\n    background: var(--content-background);\n}\n\n.invite-buttons button {\n  margin-right:10px;\n}\n\n.room-listing-avatar {\n  width:100%;\n  background:var(--high-contrast-background);\n  display:flex;\n  justify-content: center;\n  overflow:hidden;\n  position:relative;\n}\n\n.room-listing-avatar-img {\n  object-fit:cover;\n  max-width:100%;\n  opacity: 0;\n  transition: opacity .25s ease;\n  z-index:1;\n}\n\n.room-listing-avatar-canvas {\n  object-fit:cover;\n  position:absolute;\n  max-width:100%;\n}\n\n.room-listing-avatar-img[data-avatar-loaded] {\n  opacity: 1;\n}\n\n.room-listing-body {\n    padding: var(--margin-unit);\n    display: grid;\n    grid-template-columns: minmax(0, 1fr) 40px;\n}\n\n.room-listing-body[data-room-entry-buttons-visible] > div {\n    grid-column: 1 / 2;\n}\n\n.room-listing-entry-buttons {\n    grid-column: 1 / 2 !important;\n}\n\n.invite-heading, .room-listing-heading {\n    grid-column: 1 / 2 !important;\n    margin-bottom:var(--margin-unit);\n    display:flex;\n    align-items:center;\n}\n\n.room-listing-heading a {\n  color:var(--content-text);\n}\n\n.room-listing-data {\n    padding-bottom:5px;\n}\n\n.room-listing-data-row {\n    display: flex;\n    padding-bottom:5px;\n    flex-wrap:wrap;\n    gap:5px;\n    align-items: center;\n}\n\n.room-listing-data-row .room-data-icon { \n  display:grid;\n  align-items:center;\n  margin-right:10px;\n}\n\n.room-listing-data .invite-pill { \n  opacity:.5; \n  display:flex; /* necessary for alignment with other pills */\n}\n\n.room-listing-heading > a {\n  font-size:16pt;\n  font-weight:bold;\n  text-decoration: underline;\n  text-decoration-thickness: 2px;\n  cursor: pointer;\n}\n\n.room-toggle-members {\n  border-radius:5px;\n  margin-right:5px;\n  border:none;\n  background:none;\n  font-size:12pt;\n  cursor:pointer;\n  padding:5px;\n  white-space: nowrap;\n  color:var(--content-text);\n  transition:background .5s ease;\n}\n\n.room-toggle-members:hover {\n  background:var(--low-contrast-background);\n  transition:background .5s ease;\n}\n\n.room-listing-entry .fav-star {\n    height:24px;\n    padding-right:5px;\n}\n\n.room-listing-entry .fav-star svg {\n    transform: scale(1);\n}\n\n.room-listing-entry-buttons  {\n    grid-column: 2 / 3 !important;\n    grid-row: 1 / 50 !important;\n    padding:5px;\n    margin-left:5px;\n}\n\n.room-listing-body[data-room-entry-buttons-visible] .room-listing-entry-buttons {\n    background: var(--input-background);\n    border-radius: 15px;\n}\n\n.room-listing-entry-buttons > button {\n    padding: 0px;\n    margin: 0px;\n    background: none;\n    border: none;\n    cursor: pointer;\n}\n\n.room-listing-avatar:not([data-has-avatar]) .room-annotation-data {\n  position:relative;\n  width:100%;\n}\n\n.room-listing-avatar[data-has-avatar] .room-annotation-data {\n  position:absolute;\n  left:0px;\n  top:0px;\n  z-index:1;\n}\n\n.room-annotation-data > span {\n  margin:10px;\n}\n\n.room-annotation-data > span {\n  display:grid;\n  background: rgba(255,255,255,0.6);\n  backdrop-filter: blur(6px);\n  padding:10px;\n  width:20px;\n  border-radius:30px;\n  grid-template-columns: 20px 0px;\n  cursor:pointer;\n  transition:background .25s ease;\n}\n\n.room-annotation-data > span:hover {\n  background: rgba(255,255,255,1);\n}\n\n\n#settings-loading {\n  animation: pulse-opacity 2s infinite; \n  animation-timing-function:ease;\n}\n',""]);const a=o},5255:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#room-settings-form {\n  display: grid;\n  grid-template-columns: 100px 1fr;\n  align-items: center;\n}\n\n#room-settings-form-wrapper {\n  transition: height .25s ease;\n}\n\n.room-settings-role-list h5 {\n  margin-top:0px;\n  margin-bottom:5px;\n}\n\n.room-settings-role-list {\n  grid-column: 1/3;\n  margin-bottom:20px;\n}\n\n#room-settings-select-view {\n  padding-bottom:20px;\n}\n\n#room-settings-form label {\n  margin:5px;\n  margin-left:0px;\n}\n\n#room-settings-form textarea{\n  resize:none;\n}\n\n#room-settings-form #select-avatar-wrapper {\n  position:relative;\n  grid-column: 1 / 3;\n}\n\n.room-settings-info {\n  grid-column: 2/3;\n  padding-top:5px;\n  font-size:10pt;\n}\n\n.room-settings-role-empty {\n  font-size: 12pt;\n  margin-top:10px;\n  margin-bottom:10px;\n}\n\n.room-settings-role-listing {\n  background:unset;\n  position: relative;\n  border:none;\n  font-size: 12pt;\n  cursor:pointer;\n  display:grid;\n  grid-template-columns: 30px 1fr;\n  align-items:center;\n  justify-items:left;\n  padding:0px;\n  margin-top:10px;\n  margin-bottom:10px;\n}\n\n.room-settings-role-listing:not([data-role-toggleable]) .small-icon {\n  color:var(--content-text-dimmed);\n}\n\n.room-settings-role-user {\n  text-align:left;\n  display:inline-block;\n  overflow:hidden;\n  width:100%;\n  text-overflow:ellipsis;\n}\n\n.room-settings-role-change-info {\n  grid-column: 2/3;\n  color:var(--content-text-dimmed);\n  font-size:10pt;\n  text-align:left;\n}\n\n.room-settings-role-listing:hover {\n  left:5px;\n}\n\n.room-settings-add-role {\n  position: relative;\n  display:flex;\n  align-items:center;\n}\n\n.room-settings-add-role-input-wrapper { \n  position: relative;\n  width:calc(100% - 40px);\n}\n\n.room-settings-add-role-input-wrapper #popup-menu { \n  border:1px solid #adadad;\n}\n\n.room-settings-add-role input { \n  width:calc(100% - 14px);\n}\n\n.room-settings-add-role .small-icon {\n  margin-right:10px;\n}\n\n.room-settings-link-group {\n  grid-column: 2/3;\n  display:grid;\n  grid-template-columns: 1fr 31px;\n  align-items:center;\n}\n\n#room-settings-join-link {\n  font-size:10pt;\n  overflow-x:auto;\n  user-select:all;\n  background:var(--input-background);\n  padding:7px;\n  margin:0px;\n}\n\nhtml[data-scrollbars="hidden"] #room-settings-join-link {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] #room-settings-join-link::-webkit-scrollbar { display: none; }\n\n.room-settings-info {\n  padding-bottom:15px;\n}\n\n#room-settings-submit-wrapper {\n  grid-column: 1/3;\n}\n\n#room-settings-submit-wrapper button:not(:last-child) {\n  margin-right:10px;\n  margin-bottom:10px;\n}\n\n#room-settings-progress {\n    grid-column: 1/3 ;\n    padding-top: 10px;\n    animation: pulse-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n#room-settings-progress progress {\n    width:100%;\n  }\n\n@media only screen and (max-width: 600px) {\n  #room-settings-form {\n    grid-template-columns: 1fr;\n  }\n\n  .room-settings-info,\n  #room-settings-submit-wrapper,\n  #room-settings-avatar-wrapper,\n  #room-settings-progress,\n  #room-settings-progress,\n  .room-settings-link-group {\n    grid-column: 1/2;\n  }\n}\n',""]);const a=o},592:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,".search-bar { \n    position:relative; \n    display:flex;\n    align-items:center;\n}\n\n.search-bar > .search-icon {\n    pointer-events:none;\n}\n\n.search-bar > .clear-icon {\n    cursor: pointer;\n}\n\n.search-bar > .search-icon {\n    position:absolute;\n    left:5px;\n    align-items:center;\n    display:flex;\n}\n\n\n.search-bar > .right-decoration {\n    position:absolute;\n    right:5px;\n    align-items:center;\n    display:flex;\n}\n\n.search-bar > .right-decoration > .search-hint {\n  border-radius:5px;\n  border: solid 1px rgba(0,0,0,.15);\n  padding-left:5px;\n  padding-right:5px;\n  color:rgba(0,0,0,.25);;\n}\n\n.search-bar > input {\n    width:100%;\n    margin:auto;\n    padding:7px;\n    padding-left:35px;\n    border:none;\n    background: var(--input-background);\n}\n",""]);const a=o},6213:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#pdf-search-result-panel {\n  flex-direction: column;\n  position:relative;\n}\n\n#pdf-search-term {\n  padding:10px;\n  border-bottom: 1px solid #ababab;\n}\n\n#pdf-search-term .search-bar {\n  margin-top:5px;\n}\n\n#pdf-search-term .small-icon {\n  position:absolute;\n  right:10px;\n  cursor:pointer;\n}\n\n#pdf-search-warn {\n  padding:10px;\n}\n\n#pdf-search-result-panel .pdf-search-result:hover {\n    background: var(--input-background);\n    transition: background-color 0.5s ease;\n}\n\n.pdf-search-result[data-focused-result] {\n    background: var(--input-background);\n}\n\n#pdf-search-result-panel .pdf-search-result {\n  cursor: pointer;\n  position:relative;\n  width:calc(100% - 20px);\n  padding:10px;\n  border-bottom: 1px solid #ababab;\n  transition: background-color 0.5s ease;\n}\n\n.result-context {\n  white-space:pre;\n  text-overflow:ellipsis;\n  overflow:hidden;\n  text-align:center;\n  padding-bottom:5px;\n}\n\n#pdf-search-result-panel .page-data {\n  font-size:10pt;\n  color:var(--secondary-text);\n}\n",""]);const a=o},5620:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#spaces-manager {\n  padding-top:calc(.5 * var(--margin-unit));\n  padding-bottom:var(--margin-unit);\n  padding-left:var(--margin-unit);\n  padding-right:var(--margin-unit);\n  background: var(--content-background);\n  border: 1px solid var(--content-border);\n  height:fit-content;\n}\n\n#spaces-list {\n  margin-left: 16px;\n}\n\n#spaces-manager h1 {\n  margin:0px\n}\n\n#add-space {\n  display:flex;\n  align-items:center;\n  background:none;\n  border:none;\n  padding:0px;\n  border-radius:15px;\n  font-size:14pt;\n  font-weight:bold;\n  color: var(--content-dimmed-element);\n  margin-top:5px;\n  margin-left:16px;\n  cursor:pointer;\n  transition: color .5s ease;\n}\n\n#add-space:hover {\n  color: var(--content-text);\n}\n\n.space-listing h3 {\n  cursor:pointer;\n  margin:5px 0px 10px 0px;\n  display:inline-flex;\n  align-content:center;\n}\n\n.space-listing h3 button {\n  visibility:hidden;\n  background:none;\n  border:none;\n  cursor: pointer;\n}\n.space-listing h3 button[data-narrow-view],\n.space-listing h3:hover button {\n  visibility: visible;\n}\n\n.space-listing h3 svg {\n  height:20px;\n}\n\n.space-listing-actions {\n  position:relative;\n  top:-7px;\n}\n\n.space-listing-actions button {\n  margin-left:10px;\n}\n\n.space-listing-children .room-icon {\n  margin-left:10px;\n  margin-bottom:10px;\n}\n\n.space-listing-more {\n  margin-left:10px;\n  background:var(--content-background);\n  display:inline-block;\n  border-radius:5px;\n  font-size:14pt;\n  font-weight:bold;\n  height:50px;\n  color: var(--content-dimmed-element);\n  cursor:pointer;\n  transition: color .5s ease;\n}\n\n.space-listing-more:hover {\n  color:var(--content-text);\n}\n\n#manage-discussion-select-view {\n  margin-top:20px;\n}\n\n#current-discussions-list,\n#available-discussions-list {\n  padding-top:20px;\n  overflow:auto;\n}\n\n#manage-discussion-list-wrapper {\n  transition: height .25s ease;\n  overflow:auto;\n  max-height:60vh;\n}\n\n\nhtml[data-scrollbars="hidden"] #current-discussions-list,\nhtml[data-scrollbars="hidden"] #available-discussions-list {\n  scrollbar-width: none;\n}\n\nhtml[data-scrollbars="hidden"] #current-discussions-list::-webkit-scrollbar,\nhtml[data-scrollbars="hidden"] #available-discussions-list::-webkit-scrollbar {\n  display: none;\n}\n\n.discussion-listing svg {\n  height:1.2em;\n  vertical-align:bottom;\n}\n\n.discussion-listing {\n  display: grid;\n  height:28px;\n  grid-template-columns: 2em 1fr;\n  background: none;\n  border: none;\n  font-weight: bold;\n  cursor: pointer;\n  position: relative;\n  text-align:left;\n}\n\n.discussion-listing > span {\n  padding-bottom:10px;\n  white-space:pre;\n  overflow-x:auto;\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\n.discussion-listing > span::-webkit-scrollbar { display: none; }\n\n.discussion-listing[data-change-pending] {\n  color:var(--content-text-dimmed);\n}\n\n.discussion-listing:hover {\n  left:5px\n}\n\n@media only screen and (max-width: 600px) {\n    .space-listing h3 {\n      display:grid;\n      grid-template-columns: 1fr auto;\n    }\n} \n',""]);const a=o},5578:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#splash-logo {\n    height: 200px;\n    width: 200px;\n}\n\n#splash-logo-back {\n  fill:var(--content-border);\n  position:relative;\n  transform-box:fill-box;\n  transform-origin:center;\n  animation: pulse-scale 2s infinite; \n  animation-timing-function:ease;\n}\n\n#splash-loader{\n    padding-top:20px;\n    color:var(--backdrop-text);\n    font-weight:600;\n}\n\n#splash-wrapper {\n    display:flex;\n    flex-direction:column;\n    justify-content:center;\n    align-items:center;\n    height:100%;\n    width:100%;\n    background:var(--content-backdrop);\n}\n\n#splash-logo-backdrop {\n  background:var(--content-background);\n}\n",""]);const a=o},7384:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"#sync-indicator {\n  position:fixed;\n  bottom:0px;\n  right:0px;\n  margin:5px;\n  font-size:8pt;\n  background:var(--content-background);\n  z-index:15;\n  padding:0px 3px 0px 3px;\n  border-radius:5px;\n}\n\n@media only screen and (max-width: 1280px) {\n  .sync-hidden { visibility: hidden }\n}\n",""]);const a=o},8477:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,".tag-input {\n  width:55px;\n}\n\n.tag-input:focus {\n  width:120px;\n}\n\n.tag-editor {\n    display: flex;\n    padding-bottom:5px;\n    flex-wrap:wrap;\n    align-items: center;\n}\n\n.room-tag {\n  padding-right:5px;\n}\n\n.room-tag::after {\n  content:',';\n}\n\n.room-tag:last-child::after {\n  content:'';\n}\n\n.room-tag-delete-icon svg {\n  height:15px;\n  cursor: pointer;\n}\n",""]);const a=o},145:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'.text-layer { \n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    overflow: hidden;\n    line-height:1;\n    opacity: 0.2;\n    width: calc(var(--pdfWidthPx) / var(--pdfFitRatio)) ;\n    height: calc(var(--pdfHeightPx) / var(--pdfFitRatio));\n    pointer-events:none;\n    user-select:none;\n    transform-origin : top left;\n    transform: scale(var(--pdfFitRatio)) translate(-4px,-4px) !important;\n    /* a slight skootch here to make up for span padding */\n}\n\n[data-touches="2"] .text-layer,\n[data-pindrop-mode] .text-layer { display:none; }\n\n[data-touches="2"] .text-layer > span,\n[data-touches="1"] .text-layer > span {\n    touch-action:none;\n  }\n\n.text-layer > span {\n    color:transparent;\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    pointer-events:auto;\n    transform-origin: 0% 0%;\n    user-select:text;\n    /* a little padding seems to help with text selection */\n    padding:4px; \n}\n\n.text-layer > br {\n  color: transparent;\n  position: absolute;\n  white-space: pre;\n  cursor: text;\n  transform-origin: 0% 0%;\n  user-select:text;\n}\n\n.text-layer mark {\n    color:transparent;\n    background:var(--max-contrast-background);\n    padding:2px;\n    position:relative;\n}\n\n.text-layer span::selection {\n    color:transparent;\n    background:var(--selectColor);\n}\n',""]);const a=o},9631:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'#toast-popup {\n  position: fixed;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  z-index:25;\n}\n\n@media only screen and (min-width: 600px) {\n  #toast-popup {\n    top: 40px;\n    left: 40px;\n    animation: slide-from-left .5s ease-out;\n  }\n\n  #toast-content {\n    width:400px;\n    min-height:100px;\n    border-radius:10px;\n  }\n}\n\n@media only screen and (max-width: 600px) {\n  #toast-popup {\n    animation: slide-from-top .5s ease-out;\n    width:100%;\n    top: 0px;\n  }\n\n  #toast-content {\n    width:100%;\n    min-height:80px;\n  }\n}\n\n@keyframes slide-from-top {\n    0% { \n      top: -150px; \n      opacity:0;\n    }\n    100% { \n      top: 0px; \n      opacity:1;\n    }\n}\n\n@keyframes slide-from-left {\n    0% { \n      left: -400px; \n      opacity:0;\n    }\n    100% { \n      left: 40px; \n      opacity:1;\n    }\n}\n\n#toast-content {\n  position: relative;\n  background:var(--content-background);\n  box-shadow: 0px 2px 4px 1px rgba(0,0,0,.25);\n\n  padding:10px;\n  z-index:21;\n}\n\nhtml[data-scrollbars="hidden"] #toast-content { scrollbar-width: none; }\n\nhtml[data-scrollbars="hidden"] #toast-content::-webkit-scrollbar { display: none; }\n\n#toast-content pre {\n  overflow-y: scroll;\n  text-overflow:ellipsis;\n}\n\nhtml[data-scrollbars="hidden"] #toast-content pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] #toast-content pre::-webkit-scrollbar { display: none; }\n\n#toast-header{ margin-top:-3px; }\n\n#dismiss-toast {\n  cursor:pointer;\n  position:absolute;\n  right:5px;\n  top:5px;\n  background:none;\n  border:none;\n}\n',""]);const a=o},6894:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,'.tippy-box {\n  color:var(--contrast-text);\n  background:var(--max-contrast-background);\n  padding:5px;\n  font-weight:bold;\n  border-radius:5px;\n}\n\n.tippy-box[data-theme="bordered"] {\n  border: 1px solid white;\n}\n\n.tippy-box[data-theme="small"] {\n  font-size:10pt;\n}\n\n.tippy-box[data-theme="info"] {\n  font-size:10pt;\n  font-weight:unset;\n}\n\n.tippy-box[data-theme="info"] h3 {\n  margin:0px;\n}\n\n\n.tippy-box[data-theme="info"] svg{\n  height:15px;\n  vertical-align:bottom;\n}\n',""]);const a=o},5188:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(8081),r=n.n(i),s=n(3645),o=n.n(s)()(r());o.push([e.id,"body {\n  --welcome-header-height:50px;\n}\n\n#welcome-header {\n    user-select:none;\n    position:fixed;\n    width:100%;\n    display:flex;\n    justify-content:flex-end;\n    align-items:center;\n    top:0px;\n    background: var(--content-background);\n    z-index:2;\n    height:var(--welcome-header-height);\n    box-shadow: 0px 2px 4px 0 rgba(0,0,0,.2);\n}\n\n#welcome-header-content {\n    width:100%;\n    display:flex;\n    justify-content:flex-end;\n    align-items:center;\n}\n\n#welcome-header-content button {\n  border:none;\n  border-bottom: 2px solid white;\n  background:none;\n  padding:0px;\n}\n\n#welcome-collection, #welcome-upload, #welcome-notifications {\n    margin-right:15px; \n}\n\n#welcome-collection > svg, \n#welcome-notifications > svg, \n#welcome-upload > svg {\n    cursor: pointer;\n    vertical-align:top;\n    margin-bottom:5px;\n}\n\n#welcome-notifications > .small-icon-badge {\n  position:absolute;\n  bottom:19px;\n  left:12px;\n}\n\n#welcome-notifications, \n#welcome-upload, \n#welcome-collection, \n#welcome-profile {\n  flex-shrink: 0;\n  position:relative;\n  top: 2px;\n  border-bottom: 2px solid white;\n  transition: border .25s ease;\n}\n\n#welcome-collection[data-active], \n#welcome-notifications[data-active], \n#welcome-upload[data-active], \n#welcome-profile[data-active] {\n  border-bottom: 2px solid black;\n}\n\n#welcome-profile {\n    cursor: pointer;\n    width: 31px;\n    height: 31px;\n    margin-right: 13px; \n}\n\n#welcome-initial {\n    display:inline-block;\n    position:relative;\n    bottom:2px;\n    width:22px;\n    height:22px;\n    text-align:center;\n    font-weight: bold;\n    line-height:22px;\n    border:2px solid black;\n    border-radius:35px;\n    background-color: var(--user_light);\n}\n\n#welcome-profile img {\n    height:28px;\n    width:28px;\n    border-radius:35px;\n    position:relative;\n    bottom:2px;\n    object-fit:cover;\n}\n\n#welcome-profile button {\n  margin-bottom:5px;\n}\n\n#welcome-container {\n    margin-top:var(--welcome-header-height);\n    width: 100%;\n    min-height:calc(100vh - var(--welcome-header-height));\n    position: absolute;\n    display:flex;\n    justify-content:center;\n    background:var(--content-backdrop);\n    --margin-unit: 17px\n}\n\n\n#welcome-split {\n  display:grid;\n  margin-top:var(--margin-unit);\n  gap:var(--margin-unit);\n  width:calc(max(90vw, min(1100px,100%)));\n  grid-template-columns: minmax(400px,800px) minmax(calc(max(300px,min(450px,35vw))), 1fr);\n  max-width:calc(min(1600px, 100% - (2 * var(--margin-unit))))  ;\n}\n\n#welcome-about-card {\n  background: var(--content-background);\n  border: 1px solid var(--content-border);\n  margin-top: var(--margin-unit);\n  padding: var(--margin-unit);\n  font-size:10pt;\n  width: calc(298px - (2 * var(--margin-unit)));\n  color:var(--content-text-dimmed);\n  position:sticky;\n  top: calc(var(--welcome-header-height) + var(--margin-unit))\n}\n\n#welcome-about-card-icons div {\n  display:flex;\n  align-items:center;\n  margin-bottom:5px;\n}\n\n#welcome-about-card-icons a {\n  text-decoration: none;\n  color:var(--content-text-dimmed);\n  cursor: pointer;\n}\n\n\n#welcome-about-card-icons .small-icon{\n  padding-right:5px;\n}\n\n.welcome-column {\n  margin-top: var(--margin-unit);\n  width: 100%;\n  max-width:calc(min(800px, 100% - (2 * var(--margin-unit))))  ;\n}\n\n#welcome-container hr {\n  margin-top: calc(.5 * var(--margin-unit));\n  margin-bottom: calc(.5 * var(--margin-unit));\n}\n\n#welcome-container h2 {\n  margin:0px;\n}\n\n#welcome-search-wrapper {\n    flex-shrink:2;\n    flex-grow:1;\n    margin-right:15px; \n    margin-left:13px; \n}\n\n#welcome-search-wrapper #popup-menu { \n  border:1px solid #adadad;\n}\n\n@media only screen and (min-width: 600px) {\n  #welcome-header-content #welcome-search-wrapper {\n    flex-grow:unset;\n    margin-right:auto;\n  }\n\n  #welcome-header-content .search-bar input {\n    transition: width .25s;\n    width:200px;\n  }\n\n  #welcome-header-content .search-bar input:focus {\n    width:400px;\n  }\n} \n",""]);const a=o},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);i&&o[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},1667:e=>{"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},9996:e=>{"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)},n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?a((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function r(e,t,n){return e.concat(t).map((function(e){return i(e,n)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function o(e,t){try{return t in e}catch(e){return!1}}function a(e,n,l){(l=l||{}).arrayMerge=l.arrayMerge||r,l.isMergeableObject=l.isMergeableObject||t,l.cloneUnlessOtherwiseSpecified=i;var c=Array.isArray(n);return c===Array.isArray(e)?c?l.arrayMerge(e,n,l):function(e,t,n){var r={};return n.isMergeableObject(e)&&s(e).forEach((function(t){r[t]=i(e[t],n)})),s(t).forEach((function(s){(function(e,t){return o(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(o(e,s)&&n.isMergeableObject(t[s])?r[s]=function(e,t){if(!t.customMerge)return a;var n=t.customMerge(e);return"function"==typeof n?n:a}(s,n)(e[s],t[s],n):r[s]=i(t[s],n))})),r}(e,n,l):i(n,l)}a.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return a(e,n,t)}),{})};var l=a;e.exports=l},7837:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attributeNames=t.elementNames=void 0,t.elementNames=new Map([["altglyph","altGlyph"],["altglyphdef","altGlyphDef"],["altglyphitem","altGlyphItem"],["animatecolor","animateColor"],["animatemotion","animateMotion"],["animatetransform","animateTransform"],["clippath","clipPath"],["feblend","feBlend"],["fecolormatrix","feColorMatrix"],["fecomponenttransfer","feComponentTransfer"],["fecomposite","feComposite"],["feconvolvematrix","feConvolveMatrix"],["fediffuselighting","feDiffuseLighting"],["fedisplacementmap","feDisplacementMap"],["fedistantlight","feDistantLight"],["fedropshadow","feDropShadow"],["feflood","feFlood"],["fefunca","feFuncA"],["fefuncb","feFuncB"],["fefuncg","feFuncG"],["fefuncr","feFuncR"],["fegaussianblur","feGaussianBlur"],["feimage","feImage"],["femerge","feMerge"],["femergenode","feMergeNode"],["femorphology","feMorphology"],["feoffset","feOffset"],["fepointlight","fePointLight"],["fespecularlighting","feSpecularLighting"],["fespotlight","feSpotLight"],["fetile","feTile"],["feturbulence","feTurbulence"],["foreignobject","foreignObject"],["glyphref","glyphRef"],["lineargradient","linearGradient"],["radialgradient","radialGradient"],["textpath","textPath"]]),t.attributeNames=new Map([["definitionurl","definitionURL"],["attributename","attributeName"],["attributetype","attributeType"],["basefrequency","baseFrequency"],["baseprofile","baseProfile"],["calcmode","calcMode"],["clippathunits","clipPathUnits"],["diffuseconstant","diffuseConstant"],["edgemode","edgeMode"],["filterunits","filterUnits"],["glyphref","glyphRef"],["gradienttransform","gradientTransform"],["gradientunits","gradientUnits"],["kernelmatrix","kernelMatrix"],["kernelunitlength","kernelUnitLength"],["keypoints","keyPoints"],["keysplines","keySplines"],["keytimes","keyTimes"],["lengthadjust","lengthAdjust"],["limitingconeangle","limitingConeAngle"],["markerheight","markerHeight"],["markerunits","markerUnits"],["markerwidth","markerWidth"],["maskcontentunits","maskContentUnits"],["maskunits","maskUnits"],["numoctaves","numOctaves"],["pathlength","pathLength"],["patterncontentunits","patternContentUnits"],["patterntransform","patternTransform"],["patternunits","patternUnits"],["pointsatx","pointsAtX"],["pointsaty","pointsAtY"],["pointsatz","pointsAtZ"],["preservealpha","preserveAlpha"],["preserveaspectratio","preserveAspectRatio"],["primitiveunits","primitiveUnits"],["refx","refX"],["refy","refY"],["repeatcount","repeatCount"],["repeatdur","repeatDur"],["requiredextensions","requiredExtensions"],["requiredfeatures","requiredFeatures"],["specularconstant","specularConstant"],["specularexponent","specularExponent"],["spreadmethod","spreadMethod"],["startoffset","startOffset"],["stddeviation","stdDeviation"],["stitchtiles","stitchTiles"],["surfacescale","surfaceScale"],["systemlanguage","systemLanguage"],["tablevalues","tableValues"],["targetx","targetX"],["targety","targetY"],["textlength","textLength"],["viewbox","viewBox"],["viewtarget","viewTarget"],["xchannelselector","xChannelSelector"],["ychannelselector","yChannelSelector"],["zoomandpan","zoomAndPan"]])},7220:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(9960)),l=n(5863),c=n(7837),d=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]),h=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function u(e,t){void 0===t&&(t={});for(var n=("length"in e?e:[e]),i="",r=0;r<n.length;r++)i+=p(n[r],t);return i}function p(e,t){switch(e.type){case a.Root:return u(e.children,t);case a.Directive:case a.Doctype:return"<"+e.data+">";case a.Comment:return"\x3c!--"+e.data+"--\x3e";case a.CDATA:return function(e){return"<![CDATA["+e.children[0].data+"]]>"}(e);case a.Script:case a.Style:case a.Tag:return function(e,t){var n;"foreign"===t.xmlMode&&(e.name=null!==(n=c.elementNames.get(e.name))&&void 0!==n?n:e.name,e.parent&&m.has(e.parent.name)&&(t=i(i({},t),{xmlMode:!1}))),!t.xmlMode&&g.has(e.name)&&(t=i(i({},t),{xmlMode:"foreign"}));var r="<"+e.name,s=function(e,t){if(e)return Object.keys(e).map((function(n){var i,r,s=null!==(i=e[n])&&void 0!==i?i:"";return"foreign"===t.xmlMode&&(n=null!==(r=c.attributeNames.get(n))&&void 0!==r?r:n),t.emptyAttrs||t.xmlMode||""!==s?n+'="'+(!1!==t.decodeEntities?l.encodeXML(s):s.replace(/"/g,"&quot;"))+'"':n})).join(" ")}(e.attribs,t);return s&&(r+=" "+s),0===e.children.length&&(t.xmlMode?!1!==t.selfClosingTags:t.selfClosingTags&&h.has(e.name))?(t.xmlMode||(r+=" "),r+="/>"):(r+=">",e.children.length>0&&(r+=u(e.children,t)),!t.xmlMode&&h.has(e.name)||(r+="</"+e.name+">")),r}(e,t);case a.Text:return function(e,t){var n=e.data||"";return!1===t.decodeEntities||!t.xmlMode&&e.parent&&d.has(e.parent.name)||(n=l.encodeXML(n)),n}(e,t)}}t.default=u;var m=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),g=new Set(["svg","math"])},9960:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Doctype=t.CDATA=t.Tag=t.Style=t.Script=t.Comment=t.Directive=t.Text=t.Root=t.isTag=t.ElementType=void 0,function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"}(n=t.ElementType||(t.ElementType={})),t.isTag=function(e){return e.type===n.Tag||e.type===n.Script||e.type===n.Style},t.Root=n.Root,t.Text=n.Text,t.Directive=n.Directive,t.Comment=n.Comment,t.Script=n.Script,t.Style=n.Style,t.Tag=n.Tag,t.CDATA=n.CDATA,t.Doctype=n.Doctype},7915:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.DomHandler=void 0;var s=n(9960),o=n(7790);r(n(7790),t);var a=/\s+/g,l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1,xmlMode:!1},c=function(){function e(e,t,n){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof t&&(n=t,t=l),"object"==typeof e&&(t=e,e=void 0),this.callback=null!=e?e:null,this.options=null!=t?t:l,this.elementCB=null!=n?n:null}return e.prototype.onparserinit=function(e){this.parser=e},e.prototype.onreset=function(){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},e.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},e.prototype.onerror=function(e){this.handleCallback(e)},e.prototype.onclosetag=function(){this.lastNode=null;var e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)},e.prototype.onopentag=function(e,t){var n=this.options.xmlMode?s.ElementType.Tag:void 0,i=new o.Element(e,t,void 0,n);this.addNode(i),this.tagStack.push(i)},e.prototype.ontext=function(e){var t=this.options.normalizeWhitespace,n=this.lastNode;if(n&&n.type===s.ElementType.Text)t?n.data=(n.data+e).replace(a," "):n.data+=e,this.options.withEndIndices&&(n.endIndex=this.parser.endIndex);else{t&&(e=e.replace(a," "));var i=new o.Text(e);this.addNode(i),this.lastNode=i}},e.prototype.oncomment=function(e){if(this.lastNode&&this.lastNode.type===s.ElementType.Comment)this.lastNode.data+=e;else{var t=new o.Comment(e);this.addNode(t),this.lastNode=t}},e.prototype.oncommentend=function(){this.lastNode=null},e.prototype.oncdatastart=function(){var e=new o.Text(""),t=new o.NodeWithChildren(s.ElementType.CDATA,[e]);this.addNode(t),e.parent=t,this.lastNode=e},e.prototype.oncdataend=function(){this.lastNode=null},e.prototype.onprocessinginstruction=function(e,t){var n=new o.ProcessingInstruction(e,t);this.addNode(n)},e.prototype.handleCallback=function(e){if("function"==typeof this.callback)this.callback(e,this.dom);else if(e)throw e},e.prototype.addNode=function(e){var t=this.tagStack[this.tagStack.length-1],n=t.children[t.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),t.children.push(e),n&&(e.prev=n,n.next=e),e.parent=t,this.lastNode=null},e}();t.DomHandler=c,t.default=c},7790:function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.cloneNode=t.hasChildren=t.isDocument=t.isDirective=t.isComment=t.isText=t.isCDATA=t.isTag=t.Element=t.Document=t.NodeWithChildren=t.ProcessingInstruction=t.Comment=t.Text=t.DataNode=t.Node=void 0;var o=n(9960),a=new Map([[o.ElementType.Tag,1],[o.ElementType.Script,1],[o.ElementType.Style,1],[o.ElementType.Directive,1],[o.ElementType.Text,3],[o.ElementType.CDATA,4],[o.ElementType.Comment,8],[o.ElementType.Root,9]]),l=function(){function e(e){this.type=e,this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(e.prototype,"nodeType",{get:function(){var e;return null!==(e=a.get(this.type))&&void 0!==e?e:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(e){return void 0===e&&(e=!1),_(this,e)},e}();t.Node=l;var c=function(e){function t(t,n){var i=e.call(this,t)||this;return i.data=n,i}return r(t,e),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.data},set:function(e){this.data=e},enumerable:!1,configurable:!0}),t}(l);t.DataNode=c;var d=function(e){function t(t){return e.call(this,o.ElementType.Text,t)||this}return r(t,e),t}(c);t.Text=d;var h=function(e){function t(t){return e.call(this,o.ElementType.Comment,t)||this}return r(t,e),t}(c);t.Comment=h;var u=function(e){function t(t,n){var i=e.call(this,o.ElementType.Directive,n)||this;return i.name=t,i}return r(t,e),t}(c);t.ProcessingInstruction=u;var p=function(e){function t(t,n){var i=e.call(this,t)||this;return i.children=n,i}return r(t,e),Object.defineProperty(t.prototype,"firstChild",{get:function(){var e;return null!==(e=this.children[0])&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.children},set:function(e){this.children=e},enumerable:!1,configurable:!0}),t}(l);t.NodeWithChildren=p;var m=function(e){function t(t){return e.call(this,o.ElementType.Root,t)||this}return r(t,e),t}(p);t.Document=m;var g=function(e){function t(t,n,i,r){void 0===i&&(i=[]),void 0===r&&(r="script"===t?o.ElementType.Script:"style"===t?o.ElementType.Style:o.ElementType.Tag);var s=e.call(this,r,i)||this;return s.name=t,s.attribs=n,s}return r(t,e),Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name},set:function(e){this.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){var e=this;return Object.keys(this.attribs).map((function(t){var n,i;return{name:t,value:e.attribs[t],namespace:null===(n=e["x-attribsNamespace"])||void 0===n?void 0:n[t],prefix:null===(i=e["x-attribsPrefix"])||void 0===i?void 0:i[t]}}))},enumerable:!1,configurable:!0}),t}(p);function f(e){return(0,o.isTag)(e)}function v(e){return e.type===o.ElementType.CDATA}function y(e){return e.type===o.ElementType.Text}function b(e){return e.type===o.ElementType.Comment}function w(e){return e.type===o.ElementType.Directive}function S(e){return e.type===o.ElementType.Root}function _(e,t){var n;if(void 0===t&&(t=!1),y(e))n=new d(e.data);else if(b(e))n=new h(e.data);else if(f(e)){var i=t?E(e.children):[],r=new g(e.name,s({},e.attribs),i);i.forEach((function(e){return e.parent=r})),null!=e.namespace&&(r.namespace=e.namespace),e["x-attribsNamespace"]&&(r["x-attribsNamespace"]=s({},e["x-attribsNamespace"])),e["x-attribsPrefix"]&&(r["x-attribsPrefix"]=s({},e["x-attribsPrefix"])),n=r}else if(v(e)){i=t?E(e.children):[];var a=new p(o.ElementType.CDATA,i);i.forEach((function(e){return e.parent=a})),n=a}else if(S(e)){i=t?E(e.children):[];var l=new m(i);i.forEach((function(e){return e.parent=l})),e["x-mode"]&&(l["x-mode"]=e["x-mode"]),n=l}else{if(!w(e))throw new Error("Not implemented yet: ".concat(e.type));var c=new u(e.name,e.data);null!=e["x-name"]&&(c["x-name"]=e["x-name"],c["x-publicId"]=e["x-publicId"],c["x-systemId"]=e["x-systemId"]),n=c}return n.startIndex=e.startIndex,n.endIndex=e.endIndex,null!=e.sourceCodeLocation&&(n.sourceCodeLocation=e.sourceCodeLocation),n}function E(e){for(var t=e.map((function(e){return _(e,!0)})),n=1;n<t.length;n++)t[n].prev=t[n-1],t[n-1].next=t[n];return t}t.Element=g,t.isTag=f,t.isCDATA=v,t.isText=y,t.isComment=b,t.isDirective=w,t.isDocument=S,t.hasChildren=function(e){return Object.prototype.hasOwnProperty.call(e,"children")},t.cloneNode=_},6996:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFeed=void 0;var i=n(3346),r=n(3905);t.getFeed=function(e){var t=l(h,e);return t?"feed"===t.name?function(e){var t,n=e.children,i={type:"atom",items:(0,r.getElementsByTagName)("entry",n).map((function(e){var t,n=e.children,i={media:a(n)};d(i,"id","id",n),d(i,"title","title",n);var r=null===(t=l("link",n))||void 0===t?void 0:t.attribs.href;r&&(i.link=r);var s=c("summary",n)||c("content",n);s&&(i.description=s);var o=c("updated",n);return o&&(i.pubDate=new Date(o)),i}))};d(i,"id","id",n),d(i,"title","title",n);var s=null===(t=l("link",n))||void 0===t?void 0:t.attribs.href;s&&(i.link=s),d(i,"description","subtitle",n);var o=c("updated",n);return o&&(i.updated=new Date(o)),d(i,"author","email",n,!0),i}(t):function(e){var t,n,i=null!==(n=null===(t=l("channel",e.children))||void 0===t?void 0:t.children)&&void 0!==n?n:[],s={type:e.name.substr(0,3),id:"",items:(0,r.getElementsByTagName)("item",e.children).map((function(e){var t=e.children,n={media:a(t)};d(n,"id","guid",t),d(n,"title","title",t),d(n,"link","link",t),d(n,"description","description",t);var i=c("pubDate",t);return i&&(n.pubDate=new Date(i)),n}))};d(s,"title","title",i),d(s,"link","link",i),d(s,"description","description",i);var o=c("lastBuildDate",i);return o&&(s.updated=new Date(o)),d(s,"author","managingEditor",i,!0),s}(t):null};var s=["url","type","lang"],o=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function a(e){return(0,r.getElementsByTagName)("media:content",e).map((function(e){for(var t=e.attribs,n={medium:t.medium,isDefault:!!t.isDefault},i=0,r=s;i<r.length;i++)t[c=r[i]]&&(n[c]=t[c]);for(var a=0,l=o;a<l.length;a++){var c;t[c=l[a]]&&(n[c]=parseInt(t[c],10))}return t.expression&&(n.expression=t.expression),n}))}function l(e,t){return(0,r.getElementsByTagName)(e,t,!0,1)[0]}function c(e,t,n){return void 0===n&&(n=!1),(0,i.textContent)((0,r.getElementsByTagName)(e,t,n,1)).trim()}function d(e,t,n,i,r){void 0===r&&(r=!1);var s=c(n,i,r);s&&(e[t]=s)}function h(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}},4975:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniqueSort=t.compareDocumentPosition=t.removeSubsets=void 0;var i=n(7915);function r(e,t){var n=[],r=[];if(e===t)return 0;for(var s=(0,i.hasChildren)(e)?e:e.parent;s;)n.unshift(s),s=s.parent;for(s=(0,i.hasChildren)(t)?t:t.parent;s;)r.unshift(s),s=s.parent;for(var o=Math.min(n.length,r.length),a=0;a<o&&n[a]===r[a];)a++;if(0===a)return 1;var l=n[a-1],c=l.children,d=n[a],h=r[a];return c.indexOf(d)>c.indexOf(h)?l===t?20:4:l===e?10:2}t.removeSubsets=function(e){for(var t=e.length;--t>=0;){var n=e[t];if(t>0&&e.lastIndexOf(n,t-1)>=0)e.splice(t,1);else for(var i=n.parent;i;i=i.parent)if(e.includes(i)){e.splice(t,1);break}}return e},t.compareDocumentPosition=r,t.uniqueSort=function(e){return(e=e.filter((function(e,t,n){return!n.includes(e,t+1)}))).sort((function(e,t){var n=r(e,t);return 2&n?-1:4&n?1:0})),e}},9432:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.hasChildren=t.isDocument=t.isComment=t.isText=t.isCDATA=t.isTag=void 0,r(n(3346),t),r(n(5010),t),r(n(6765),t),r(n(8043),t),r(n(3905),t),r(n(4975),t),r(n(6996),t);var s=n(7915);Object.defineProperty(t,"isTag",{enumerable:!0,get:function(){return s.isTag}}),Object.defineProperty(t,"isCDATA",{enumerable:!0,get:function(){return s.isCDATA}}),Object.defineProperty(t,"isText",{enumerable:!0,get:function(){return s.isText}}),Object.defineProperty(t,"isComment",{enumerable:!0,get:function(){return s.isComment}}),Object.defineProperty(t,"isDocument",{enumerable:!0,get:function(){return s.isDocument}}),Object.defineProperty(t,"hasChildren",{enumerable:!0,get:function(){return s.hasChildren}})},3905:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementsByTagType=t.getElementsByTagName=t.getElementById=t.getElements=t.testElement=void 0;var i=n(7915),r=n(8043),s={tag_name:function(e){return"function"==typeof e?function(t){return(0,i.isTag)(t)&&e(t.name)}:"*"===e?i.isTag:function(t){return(0,i.isTag)(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return(0,i.isText)(t)&&e(t.data)}:function(t){return(0,i.isText)(t)&&t.data===e}}};function o(e,t){return"function"==typeof t?function(n){return(0,i.isTag)(n)&&t(n.attribs[e])}:function(n){return(0,i.isTag)(n)&&n.attribs[e]===t}}function a(e,t){return function(n){return e(n)||t(n)}}function l(e){var t=Object.keys(e).map((function(t){var n=e[t];return Object.prototype.hasOwnProperty.call(s,t)?s[t](n):o(t,n)}));return 0===t.length?null:t.reduce(a)}t.testElement=function(e,t){var n=l(e);return!n||n(t)},t.getElements=function(e,t,n,i){void 0===i&&(i=1/0);var s=l(e);return s?(0,r.filter)(s,t,n,i):[]},t.getElementById=function(e,t,n){return void 0===n&&(n=!0),Array.isArray(t)||(t=[t]),(0,r.findOne)(o("id",e),t,n)},t.getElementsByTagName=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=1/0),(0,r.filter)(s.tag_name(e),t,n,i)},t.getElementsByTagType=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=1/0),(0,r.filter)(s.tag_type(e),t,n,i)}},6765:(e,t)=>{"use strict";function n(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}}Object.defineProperty(t,"__esModule",{value:!0}),t.prepend=t.prependChild=t.append=t.appendChild=t.replaceElement=t.removeElement=void 0,t.removeElement=n,t.replaceElement=function(e,t){var n=t.prev=e.prev;n&&(n.next=t);var i=t.next=e.next;i&&(i.prev=t);var r=t.parent=e.parent;if(r){var s=r.children;s[s.lastIndexOf(e)]=t}},t.appendChild=function(e,t){if(n(t),t.next=null,t.parent=e,e.children.push(t)>1){var i=e.children[e.children.length-2];i.next=t,t.prev=i}else t.prev=null},t.append=function(e,t){n(t);var i=e.parent,r=e.next;if(t.next=r,t.prev=e,e.next=t,t.parent=i,r){if(r.prev=t,i){var s=i.children;s.splice(s.lastIndexOf(r),0,t)}}else i&&i.children.push(t)},t.prependChild=function(e,t){if(n(t),t.parent=e,t.prev=null,1!==e.children.unshift(t)){var i=e.children[1];i.prev=t,t.next=i}else t.next=null},t.prepend=function(e,t){n(t);var i=e.parent;if(i){var r=i.children;r.splice(r.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=i,t.prev=e.prev,t.next=e,e.prev=t}},8043:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=t.existsOne=t.findOne=t.findOneChild=t.find=t.filter=void 0;var i=n(7915);function r(e,t,n,s){for(var o=[],a=0,l=t;a<l.length;a++){var c=l[a];if(e(c)&&(o.push(c),--s<=0))break;if(n&&(0,i.hasChildren)(c)&&c.children.length>0){var d=r(e,c.children,n,s);if(o.push.apply(o,d),(s-=d.length)<=0)break}}return o}t.filter=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=1/0),Array.isArray(t)||(t=[t]),r(e,t,n,i)},t.find=r,t.findOneChild=function(e,t){return t.find(e)},t.findOne=function e(t,n,r){void 0===r&&(r=!0);for(var s=null,o=0;o<n.length&&!s;o++){var a=n[o];(0,i.isTag)(a)&&(t(a)?s=a:r&&a.children.length>0&&(s=e(t,a.children)))}return s},t.existsOne=function e(t,n){return n.some((function(n){return(0,i.isTag)(n)&&(t(n)||n.children.length>0&&e(t,n.children))}))},t.findAll=function(e,t){for(var n,r,s=[],o=t.filter(i.isTag);r=o.shift();){var a=null===(n=r.children)||void 0===n?void 0:n.filter(i.isTag);a&&a.length>0&&o.unshift.apply(o,a),e(r)&&s.push(r)}return s}},3346:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.innerText=t.textContent=t.getText=t.getInnerHTML=t.getOuterHTML=void 0;var r=n(7915),s=i(n(7220)),o=n(9960);function a(e,t){return(0,s.default)(e,t)}t.getOuterHTML=a,t.getInnerHTML=function(e,t){return(0,r.hasChildren)(e)?e.children.map((function(e){return a(e,t)})).join(""):""},t.getText=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,r.isTag)(t)?"br"===t.name?"\n":e(t.children):(0,r.isCDATA)(t)?e(t.children):(0,r.isText)(t)?t.data:""},t.textContent=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,r.hasChildren)(t)&&!(0,r.isComment)(t)?e(t.children):(0,r.isText)(t)?t.data:""},t.innerText=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,r.hasChildren)(t)&&(t.type===o.ElementType.Tag||(0,r.isCDATA)(t))?e(t.children):(0,r.isText)(t)?t.data:""}},5010:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prevElementSibling=t.nextElementSibling=t.getName=t.hasAttrib=t.getAttributeValue=t.getSiblings=t.getParent=t.getChildren=void 0;var i=n(7915),r=[];function s(e){var t;return null!==(t=e.children)&&void 0!==t?t:r}function o(e){return e.parent||null}t.getChildren=s,t.getParent=o,t.getSiblings=function(e){var t=o(e);if(null!=t)return s(t);for(var n=[e],i=e.prev,r=e.next;null!=i;)n.unshift(i),i=i.prev;for(;null!=r;)n.push(r),r=r.next;return n},t.getAttributeValue=function(e,t){var n;return null===(n=e.attribs)||void 0===n?void 0:n[t]},t.hasAttrib=function(e,t){return null!=e.attribs&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&null!=e.attribs[t]},t.getName=function(e){return e.name},t.nextElementSibling=function(e){for(var t=e.next;null!==t&&!(0,i.isTag)(t);)t=t.next;return t},t.prevElementSibling=function(e){for(var t=e.prev;null!==t&&!(0,i.isTag)(t);)t=t.prev;return t}},4076:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeHTML=t.decodeHTMLStrict=t.decodeXML=void 0;var r=i(n(9323)),s=i(n(9591)),o=i(n(2586)),a=i(n(26));function l(e){var t=Object.keys(e).join("|"),n=d(e),i=new RegExp("&(?:"+(t+="|#[xX][\\da-fA-F]+|#\\d+")+");","g");return function(e){return String(e).replace(i,n)}}t.decodeXML=l(o.default),t.decodeHTMLStrict=l(r.default);var c=function(e,t){return e<t?1:-1};function d(e){return function(t){if("#"===t.charAt(1)){var n=t.charAt(2);return"X"===n||"x"===n?a.default(parseInt(t.substr(3),16)):a.default(parseInt(t.substr(2),10))}return e[t.slice(1,-1)]}}t.decodeHTML=function(){for(var e=Object.keys(s.default).sort(c),t=Object.keys(r.default).sort(c),n=0,i=0;n<t.length;n++)e[i]===t[n]?(t[n]+=";?",i++):t[n]+=";";var o=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=d(r.default);function l(e){return";"!==e.substr(-1)&&(e+=";"),a(e)}return function(e){return String(e).replace(o,l)}}()},26:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(3600));t.default=function(e){if(e>=55296&&e<=57343||e>1114111)return"";e in r.default&&(e=r.default[e]);var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},7322:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.escape=t.encodeHTML=t.encodeXML=void 0;var r=l(i(n(2586)).default),s=c(r);t.encodeXML=u(r,s);var o=l(i(n(9323)).default),a=c(o);function l(e){return Object.keys(e).sort().reduce((function(t,n){return t[e[n]]="&"+n+";",t}),{})}function c(e){for(var t=[],n=[],i=0,r=Object.keys(e);i<r.length;i++){var s=r[i];1===s.length?t.push("\\"+s):n.push(s)}t.sort();for(var o=0;o<t.length-1;o++){for(var a=o;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var l=1+a-o;l<3||t.splice(o,l,t[o]+"-"+t[a])}return n.unshift("["+t.join("")+"]"),new RegExp(n.join("|"),"g")}t.encodeHTML=u(o,a);var d=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g;function h(e){return"&#x"+e.codePointAt(0).toString(16).toUpperCase()+";"}function u(e,t){return function(n){return n.replace(t,(function(t){return e[t]})).replace(d,h)}}var p=c(r);t.escape=function(e){return e.replace(p,h).replace(d,h)}},5863:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decodeStrict=t.decode=void 0;var i=n(4076),r=n(7322);t.decode=function(e,t){return(!t||t<=0?i.decodeXML:i.decodeHTML)(e)},t.decodeStrict=function(e,t){return(!t||t<=0?i.decodeXML:i.decodeHTMLStrict)(e)},t.encode=function(e,t){return(!t||t<=0?r.encodeXML:r.encodeHTML)(e)};var s=n(7322);Object.defineProperty(t,"encodeXML",{enumerable:!0,get:function(){return s.encodeXML}}),Object.defineProperty(t,"encodeHTML",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"escape",{enumerable:!0,get:function(){return s.escape}}),Object.defineProperty(t,"encodeHTML4",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"encodeHTML5",{enumerable:!0,get:function(){return s.encodeHTML}});var o=n(4076);Object.defineProperty(t,"decodeXML",{enumerable:!0,get:function(){return o.decodeXML}}),Object.defineProperty(t,"decodeHTML",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTMLStrict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML4",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML5",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML4Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML5Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeXMLStrict",{enumerable:!0,get:function(){return o.decodeXML}})},7187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,s),i(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,r)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,s,o,c;if(a(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=l(e))>0&&o.length>r&&!o.warned){o.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=o.length,c=d,console&&console.warn&&console.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=d.bind(i);return r.listener=n,i.wrapFn=r,r}function u(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):m(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function g(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){i.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,d=m(l,c);for(n=0;n<c;++n)i(d[n],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,r,s,o;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return u(this,e,!0)},s.prototype.rawListeners=function(e){return u(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,i=Object.prototype.toString,r="[object Function]";e.exports=function(e){var s=this;if("function"!=typeof s||i.call(s)!==r)throw new TypeError(t+s);for(var o,a=n.call(arguments,1),l=function(){if(this instanceof o){var t=s.apply(this,a.concat(n.call(arguments)));return Object(t)===t?t:this}return s.apply(e,a.concat(n.call(arguments)))},c=Math.max(0,s.length-a.length),d=[],h=0;h<c;h++)d.push("$"+h);if(o=Function("binder","return function ("+d.join(",")+"){ return binder.apply(this,arguments); }")(l),s.prototype){var u=function(){};u.prototype=s.prototype,o.prototype=new u,u.prototype=null}return o}},8612:(e,t,n)=>{"use strict";var i=n(7648);e.exports=Function.prototype.bind||i},210:(e,t,n)=>{"use strict";var i,r=SyntaxError,s=Function,o=TypeError,a=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},d=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,h=n(1405)(),u=Object.getPrototypeOf||function(e){return e.__proto__},p={},m="undefined"==typeof Uint8Array?i:u(Uint8Array),g={"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":h?u([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?u(u([][Symbol.iterator]())):i,"%JSON%":"object"==typeof JSON?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?u((new Map)[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?u((new Set)[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?u(""[Symbol.iterator]()):i,"%Symbol%":h?Symbol:i,"%SyntaxError%":r,"%ThrowTypeError%":d,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet},f=function e(t){var n;if("%AsyncFunction%"===t)n=a("async function () {}");else if("%GeneratorFunction%"===t)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=a("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(n=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&(n=u(r.prototype))}return g[t]=n,n},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=n(8612),b=n(7642),w=y.call(Function.call,Array.prototype.concat),S=y.call(Function.apply,Array.prototype.splice),_=y.call(Function.call,String.prototype.replace),E=y.call(Function.call,String.prototype.slice),k=y.call(Function.call,RegExp.prototype.exec),x=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T=/\\(\\)?/g,C=function(e){var t=E(e,0,1),n=E(e,-1);if("%"===t&&"%"!==n)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new r("invalid intrinsic syntax, expected opening `%`");var i=[];return _(e,x,(function(e,t,n,r){i[i.length]=n?_(r,T,"$1"):t||e})),i},A=function(e,t){var n,i=e;if(b(v,i)&&(i="%"+(n=v[i])[0]+"%"),b(g,i)){var s=g[i];if(s===p&&(s=f(i)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new r("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===k(/^%?[^%]*%?$/g,e))throw new r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=C(e),i=n.length>0?n[0]:"",s=A("%"+i+"%",t),a=s.name,c=s.value,d=!1,h=s.alias;h&&(i=h[0],S(n,w([0,1],h)));for(var u=1,p=!0;u<n.length;u+=1){var m=n[u],f=E(m,0,1),v=E(m,-1);if(('"'===f||"'"===f||"`"===f||'"'===v||"'"===v||"`"===v)&&f!==v)throw new r("property names with quotes must have matching quotes");if("constructor"!==m&&p||(d=!0),b(g,a="%"+(i+="."+m)+"%"))c=g[a];else if(null!=c){if(!(m in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&u+1>=n.length){var y=l(c,m);c=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[m]}else p=b(c,m),c=c[m];p&&!d&&(g[a]=c)}}return c}},1405:(e,t,n)=>{"use strict";var i="undefined"!=typeof Symbol&&Symbol,r=n(5419);e.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==typeof i("foo")&&"symbol"==typeof Symbol("bar")&&r()}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(e,t);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},7642:(e,t,n)=>{"use strict";var i=n(8612);e.exports=i.call(Function.call,Object.prototype.hasOwnProperty)},3870:function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return o(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseFeed=t.FeedHandler=void 0;var c,d,h=l(n(7915)),u=a(n(9432)),p=n(763);!function(e){e[e.image=0]="image",e[e.audio=1]="audio",e[e.video=2]="video",e[e.document=3]="document",e[e.executable=4]="executable"}(c||(c={})),function(e){e[e.sample=0]="sample",e[e.full=1]="full",e[e.nonstop=2]="nonstop"}(d||(d={}));var m=function(e){function t(t,n){return"object"==typeof t&&(n=t=void 0),e.call(this,t,n)||this}return r(t,e),t.prototype.onend=function(){var e,t,n=v(S,this.dom);if(n){var i={};if("feed"===n.name){var r=n.children;i.type="atom",w(i,"id","id",r),w(i,"title","title",r);var s=b("href",v("link",r));s&&(i.link=s),w(i,"description","subtitle",r),(o=y("updated",r))&&(i.updated=new Date(o)),w(i,"author","email",r,!0),i.items=f("entry",r).map((function(e){var t={},n=e.children;w(t,"id","id",n),w(t,"title","title",n);var i=b("href",v("link",n));i&&(t.link=i);var r=y("summary",n)||y("content",n);r&&(t.description=r);var s=y("updated",n);return s&&(t.pubDate=new Date(s)),t.media=g(n),t}))}else{var o;r=null!==(t=null===(e=v("channel",n.children))||void 0===e?void 0:e.children)&&void 0!==t?t:[],i.type=n.name.substr(0,3),i.id="",w(i,"title","title",r),w(i,"link","link",r),w(i,"description","description",r),(o=y("lastBuildDate",r))&&(i.updated=new Date(o)),w(i,"author","managingEditor",r,!0),i.items=f("item",n.children).map((function(e){var t={},n=e.children;w(t,"id","guid",n),w(t,"title","title",n),w(t,"link","link",n),w(t,"description","description",n);var i=y("pubDate",n);return i&&(t.pubDate=new Date(i)),t.media=g(n),t}))}this.feed=i,this.handleCallback(null)}else this.handleCallback(new Error("couldn't find root of feed"))},t}(h.default);function g(e){return f("media:content",e).map((function(e){var t={medium:e.attribs.medium,isDefault:!!e.attribs.isDefault};return e.attribs.url&&(t.url=e.attribs.url),e.attribs.fileSize&&(t.fileSize=parseInt(e.attribs.fileSize,10)),e.attribs.type&&(t.type=e.attribs.type),e.attribs.expression&&(t.expression=e.attribs.expression),e.attribs.bitrate&&(t.bitrate=parseInt(e.attribs.bitrate,10)),e.attribs.framerate&&(t.framerate=parseInt(e.attribs.framerate,10)),e.attribs.samplingrate&&(t.samplingrate=parseInt(e.attribs.samplingrate,10)),e.attribs.channels&&(t.channels=parseInt(e.attribs.channels,10)),e.attribs.duration&&(t.duration=parseInt(e.attribs.duration,10)),e.attribs.height&&(t.height=parseInt(e.attribs.height,10)),e.attribs.width&&(t.width=parseInt(e.attribs.width,10)),e.attribs.lang&&(t.lang=e.attribs.lang),t}))}function f(e,t){return u.getElementsByTagName(e,t,!0)}function v(e,t){return u.getElementsByTagName(e,t,!0,1)[0]}function y(e,t,n){return void 0===n&&(n=!1),u.getText(u.getElementsByTagName(e,t,n,1)).trim()}function b(e,t){return t?t.attribs[e]:null}function w(e,t,n,i,r){void 0===r&&(r=!1);var s=y(n,i,r);s&&(e[t]=s)}function S(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}t.FeedHandler=m,t.parseFeed=function(e,t){void 0===t&&(t={xmlMode:!0});var n=new m(t);return new p.Parser(n,t).end(e),n.feed}},763:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var r=i(n(9889)),s=new Set(["input","option","optgroup","select","button","datalist","textarea"]),o=new Set(["p"]),a={tr:new Set(["tr","th","td"]),th:new Set(["th"]),td:new Set(["thead","th","td"]),body:new Set(["head","link","script"]),li:new Set(["li"]),p:o,h1:o,h2:o,h3:o,h4:o,h5:o,h6:o,select:s,input:s,output:s,button:s,datalist:s,textarea:s,option:new Set(["option"]),optgroup:new Set(["optgroup","option"]),dd:new Set(["dt","dd"]),dt:new Set(["dt","dd"]),address:o,article:o,aside:o,blockquote:o,details:o,div:o,dl:o,fieldset:o,figcaption:o,figure:o,footer:o,form:o,header:o,hr:o,main:o,nav:o,ol:o,pre:o,section:o,table:o,ul:o,rt:new Set(["rt","rp"]),rp:new Set(["rt","rp"]),tbody:new Set(["thead","tbody"]),tfoot:new Set(["thead","tbody"])},l=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),c=new Set(["math","svg"]),d=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),h=/\s|\//,u=function(){function e(e,t){var n,i,s,o,a;void 0===t&&(t={}),this.startIndex=0,this.endIndex=null,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.options=t,this.cbs=null!=e?e:{},this.lowerCaseTagNames=null!==(n=t.lowerCaseTags)&&void 0!==n?n:!t.xmlMode,this.lowerCaseAttributeNames=null!==(i=t.lowerCaseAttributeNames)&&void 0!==i?i:!t.xmlMode,this.tokenizer=new(null!==(s=t.Tokenizer)&&void 0!==s?s:r.default)(this.options,this),null===(a=(o=this.cbs).onparserinit)||void 0===a||a.call(o,this)}return e.prototype.updatePosition=function(e){null===this.endIndex?this.tokenizer.sectionStart<=e?this.startIndex=0:this.startIndex=this.tokenizer.sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this.tokenizer.getAbsoluteIndex()},e.prototype.ontext=function(e){var t,n;this.updatePosition(1),this.endIndex--,null===(n=(t=this.cbs).ontext)||void 0===n||n.call(t,e)},e.prototype.onopentagname=function(e){var t,n;if(this.lowerCaseTagNames&&(e=e.toLowerCase()),this.tagname=e,!this.options.xmlMode&&Object.prototype.hasOwnProperty.call(a,e))for(var i=void 0;this.stack.length>0&&a[e].has(i=this.stack[this.stack.length-1]);)this.onclosetag(i);!this.options.xmlMode&&l.has(e)||(this.stack.push(e),c.has(e)?this.foreignContext.push(!0):d.has(e)&&this.foreignContext.push(!1)),null===(n=(t=this.cbs).onopentagname)||void 0===n||n.call(t,e),this.cbs.onopentag&&(this.attribs={})},e.prototype.onopentagend=function(){var e,t;this.updatePosition(1),this.attribs&&(null===(t=(e=this.cbs).onopentag)||void 0===t||t.call(e,this.tagname,this.attribs),this.attribs=null),!this.options.xmlMode&&this.cbs.onclosetag&&l.has(this.tagname)&&this.cbs.onclosetag(this.tagname),this.tagname=""},e.prototype.onclosetag=function(e){if(this.updatePosition(1),this.lowerCaseTagNames&&(e=e.toLowerCase()),(c.has(e)||d.has(e))&&this.foreignContext.pop(),!this.stack.length||!this.options.xmlMode&&l.has(e))this.options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this.closeCurrentTag());else{var t=this.stack.lastIndexOf(e);if(-1!==t)if(this.cbs.onclosetag)for(t=this.stack.length-t;t--;)this.cbs.onclosetag(this.stack.pop());else this.stack.length=t;else"p"!==e||this.options.xmlMode||(this.onopentagname(e),this.closeCurrentTag())}},e.prototype.onselfclosingtag=function(){this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?this.closeCurrentTag():this.onopentagend()},e.prototype.closeCurrentTag=function(){var e,t,n=this.tagname;this.onopentagend(),this.stack[this.stack.length-1]===n&&(null===(t=(e=this.cbs).onclosetag)||void 0===t||t.call(e,n),this.stack.pop())},e.prototype.onattribname=function(e){this.lowerCaseAttributeNames&&(e=e.toLowerCase()),this.attribname=e},e.prototype.onattribdata=function(e){this.attribvalue+=e},e.prototype.onattribend=function(e){var t,n;null===(n=(t=this.cbs).onattribute)||void 0===n||n.call(t,this.attribname,this.attribvalue,e),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribname="",this.attribvalue=""},e.prototype.getInstructionName=function(e){var t=e.search(h),n=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n},e.prototype.ondeclaration=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("!"+t,"!"+e)}},e.prototype.onprocessinginstruction=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("?"+t,"?"+e)}},e.prototype.oncomment=function(e){var t,n,i,r;this.updatePosition(4),null===(n=(t=this.cbs).oncomment)||void 0===n||n.call(t,e),null===(r=(i=this.cbs).oncommentend)||void 0===r||r.call(i)},e.prototype.oncdata=function(e){var t,n,i,r,s,o;this.updatePosition(1),this.options.xmlMode||this.options.recognizeCDATA?(null===(n=(t=this.cbs).oncdatastart)||void 0===n||n.call(t),null===(r=(i=this.cbs).ontext)||void 0===r||r.call(i,e),null===(o=(s=this.cbs).oncdataend)||void 0===o||o.call(s)):this.oncomment("[CDATA["+e+"]]")},e.prototype.onerror=function(e){var t,n;null===(n=(t=this.cbs).onerror)||void 0===n||n.call(t,e)},e.prototype.onend=function(){var e,t;if(this.cbs.onclosetag)for(var n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n]));null===(t=(e=this.cbs).onend)||void 0===t||t.call(e)},e.prototype.reset=function(){var e,t,n,i;null===(t=(e=this.cbs).onreset)||void 0===t||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack=[],null===(i=(n=this.cbs).onparserinit)||void 0===i||i.call(n,this)},e.prototype.parseComplete=function(e){this.reset(),this.end(e)},e.prototype.write=function(e){this.tokenizer.write(e)},e.prototype.end=function(e){this.tokenizer.end(e)},e.prototype.pause=function(){this.tokenizer.pause()},e.prototype.resume=function(){this.tokenizer.resume()},e.prototype.parseChunk=function(e){this.write(e)},e.prototype.done=function(e){this.end(e)},e}();t.Parser=u},9889:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(26)),s=i(n(9323)),o=i(n(9591)),a=i(n(2586));function l(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function c(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function d(e,t,n){var i=e.toLowerCase();return e===i?function(e,r){r===i?e._state=t:(e._state=n,e._index--)}:function(r,s){s===i||s===e?r._state=t:(r._state=n,r._index--)}}function h(e,t){var n=e.toLowerCase();return function(i,r){r===n||r===e?i._state=t:(i._state=3,i._index--)}}var u=d("C",24,16),p=d("D",25,16),m=d("A",26,16),g=d("T",27,16),f=d("A",28,16),v=h("R",35),y=h("I",36),b=h("P",37),w=h("T",38),S=d("R",40,1),_=d("I",41,1),E=d("P",42,1),k=d("T",43,1),x=h("Y",45),T=h("L",46),C=h("E",47),A=d("Y",49,1),I=d("L",50,1),R=d("E",51,1),P=h("I",54),O=h("T",55),M=h("L",56),D=h("E",57),L=d("I",58,1),F=d("T",59,1),N=d("L",60,1),j=d("E",61,1),B=d("#",63,64),U=d("X",66,65),q=function(){function e(e,t){var n;this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1,this.cbs=t,this.xmlMode=!!(null==e?void 0:e.xmlMode),this.decodeEntities=null===(n=null==e?void 0:e.decodeEntities)||void 0===n||n}return e.prototype.reset=function(){this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1},e.prototype.write=function(e){this.ended&&this.cbs.onerror(Error(".write() after done!")),this.buffer+=e,this.parse()},e.prototype.end=function(e){this.ended&&this.cbs.onerror(Error(".end() after done!")),e&&this.write(e),this.ended=!0,this.running&&this.finish()},e.prototype.pause=function(){this.running=!1},e.prototype.resume=function(){this.running=!0,this._index<this.buffer.length&&this.parse(),this.ended&&this.finish()},e.prototype.getAbsoluteIndex=function(){return this.bufferOffset+this._index},e.prototype.stateText=function(e){"<"===e?(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this._state=2,this.sectionStart=this._index):!this.decodeEntities||"&"!==e||1!==this.special&&4!==this.special||(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this.baseState=1,this._state=62,this.sectionStart=this._index)},e.prototype.isTagStartChar=function(e){return c(e)||this.xmlMode&&!l(e)&&"/"!==e&&">"!==e},e.prototype.stateBeforeTagName=function(e){"/"===e?this._state=5:"<"===e?(this.cbs.ontext(this.getSection()),this.sectionStart=this._index):">"===e||1!==this.special||l(e)?this._state=1:"!"===e?(this._state=15,this.sectionStart=this._index+1):"?"===e?(this._state=17,this.sectionStart=this._index+1):this.isTagStartChar(e)?(this._state=this.xmlMode||"s"!==e&&"S"!==e?this.xmlMode||"t"!==e&&"T"!==e?3:52:32,this.sectionStart=this._index):this._state=1},e.prototype.stateInTagName=function(e){("/"===e||">"===e||l(e))&&(this.emitToken("onopentagname"),this._state=8,this._index--)},e.prototype.stateBeforeClosingTagName=function(e){l(e)||(">"===e?this._state=1:1!==this.special?4===this.special||"s"!==e&&"S"!==e?4!==this.special||"t"!==e&&"T"!==e?(this._state=1,this._index--):this._state=53:this._state=33:this.isTagStartChar(e)?(this._state=6,this.sectionStart=this._index):(this._state=20,this.sectionStart=this._index))},e.prototype.stateInClosingTagName=function(e){(">"===e||l(e))&&(this.emitToken("onclosetag"),this._state=7,this._index--)},e.prototype.stateAfterClosingTagName=function(e){">"===e&&(this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeAttributeName=function(e){">"===e?(this.cbs.onopentagend(),this._state=1,this.sectionStart=this._index+1):"/"===e?this._state=4:l(e)||(this._state=9,this.sectionStart=this._index)},e.prototype.stateInSelfClosingTag=function(e){">"===e?(this.cbs.onselfclosingtag(),this._state=1,this.sectionStart=this._index+1,this.special=1):l(e)||(this._state=8,this._index--)},e.prototype.stateInAttributeName=function(e){("="===e||"/"===e||">"===e||l(e))&&(this.cbs.onattribname(this.getSection()),this.sectionStart=-1,this._state=10,this._index--)},e.prototype.stateAfterAttributeName=function(e){"="===e?this._state=11:"/"===e||">"===e?(this.cbs.onattribend(void 0),this._state=8,this._index--):l(e)||(this.cbs.onattribend(void 0),this._state=9,this.sectionStart=this._index)},e.prototype.stateBeforeAttributeValue=function(e){'"'===e?(this._state=12,this.sectionStart=this._index+1):"'"===e?(this._state=13,this.sectionStart=this._index+1):l(e)||(this._state=14,this.sectionStart=this._index,this._index--)},e.prototype.handleInAttributeValue=function(e,t){e===t?(this.emitToken("onattribdata"),this.cbs.onattribend(t),this._state=8):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateInAttributeValueDoubleQuotes=function(e){this.handleInAttributeValue(e,'"')},e.prototype.stateInAttributeValueSingleQuotes=function(e){this.handleInAttributeValue(e,"'")},e.prototype.stateInAttributeValueNoQuotes=function(e){l(e)||">"===e?(this.emitToken("onattribdata"),this.cbs.onattribend(null),this._state=8,this._index--):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateBeforeDeclaration=function(e){this._state="["===e?23:"-"===e?18:16},e.prototype.stateInDeclaration=function(e){">"===e&&(this.cbs.ondeclaration(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateInProcessingInstruction=function(e){">"===e&&(this.cbs.onprocessinginstruction(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeComment=function(e){"-"===e?(this._state=19,this.sectionStart=this._index+1):this._state=16},e.prototype.stateInComment=function(e){"-"===e&&(this._state=21)},e.prototype.stateInSpecialComment=function(e){">"===e&&(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index)),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateAfterComment1=function(e){this._state="-"===e?22:19},e.prototype.stateAfterComment2=function(e){">"===e?(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"-"!==e&&(this._state=19)},e.prototype.stateBeforeCdata6=function(e){"["===e?(this._state=29,this.sectionStart=this._index+1):(this._state=16,this._index--)},e.prototype.stateInCdata=function(e){"]"===e&&(this._state=30)},e.prototype.stateAfterCdata1=function(e){this._state="]"===e?31:29},e.prototype.stateAfterCdata2=function(e){">"===e?(this.cbs.oncdata(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"]"!==e&&(this._state=29)},e.prototype.stateBeforeSpecialS=function(e){"c"===e||"C"===e?this._state=34:"t"===e||"T"===e?this._state=44:(this._state=3,this._index--)},e.prototype.stateBeforeSpecialSEnd=function(e){2!==this.special||"c"!==e&&"C"!==e?3!==this.special||"t"!==e&&"T"!==e?this._state=1:this._state=48:this._state=39},e.prototype.stateBeforeSpecialLast=function(e,t){("/"===e||">"===e||l(e))&&(this.special=t),this._state=3,this._index--},e.prototype.stateAfterSpecialLast=function(e,t){">"===e||l(e)?(this.special=1,this._state=6,this.sectionStart=this._index-t,this._index--):this._state=1},e.prototype.parseFixedEntity=function(e){if(void 0===e&&(e=this.xmlMode?a.default:s.default),this.sectionStart+1<this._index){var t=this.buffer.substring(this.sectionStart+1,this._index);Object.prototype.hasOwnProperty.call(e,t)&&(this.emitPartial(e[t]),this.sectionStart=this._index+1)}},e.prototype.parseLegacyEntity=function(){for(var e=this.sectionStart+1,t=Math.min(this._index-e,6);t>=2;){var n=this.buffer.substr(e,t);if(Object.prototype.hasOwnProperty.call(o.default,n))return this.emitPartial(o.default[n]),void(this.sectionStart+=t+1);t--}},e.prototype.stateInNamedEntity=function(e){";"===e?(this.parseFixedEntity(),1===this.baseState&&this.sectionStart+1<this._index&&!this.xmlMode&&this.parseLegacyEntity(),this._state=this.baseState):(e<"0"||e>"9")&&!c(e)&&(this.xmlMode||this.sectionStart+1===this._index||(1!==this.baseState?"="!==e&&this.parseFixedEntity(o.default):this.parseLegacyEntity()),this._state=this.baseState,this._index--)},e.prototype.decodeNumericEntity=function(e,t,n){var i=this.sectionStart+e;if(i!==this._index){var s=this.buffer.substring(i,this._index),o=parseInt(s,t);this.emitPartial(r.default(o)),this.sectionStart=n?this._index+1:this._index}this._state=this.baseState},e.prototype.stateInNumericEntity=function(e){";"===e?this.decodeNumericEntity(2,10,!0):(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(2,10,!1),this._index--)},e.prototype.stateInHexEntity=function(e){";"===e?this.decodeNumericEntity(3,16,!0):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(3,16,!1),this._index--)},e.prototype.cleanup=function(){this.sectionStart<0?(this.buffer="",this.bufferOffset+=this._index,this._index=0):this.running&&(1===this._state?(this.sectionStart!==this._index&&this.cbs.ontext(this.buffer.substr(this.sectionStart)),this.buffer="",this.bufferOffset+=this._index,this._index=0):this.sectionStart===this._index?(this.buffer="",this.bufferOffset+=this._index,this._index=0):(this.buffer=this.buffer.substr(this.sectionStart),this._index-=this.sectionStart,this.bufferOffset+=this.sectionStart),this.sectionStart=0)},e.prototype.parse=function(){for(;this._index<this.buffer.length&&this.running;){var e=this.buffer.charAt(this._index);1===this._state?this.stateText(e):12===this._state?this.stateInAttributeValueDoubleQuotes(e):9===this._state?this.stateInAttributeName(e):19===this._state?this.stateInComment(e):20===this._state?this.stateInSpecialComment(e):8===this._state?this.stateBeforeAttributeName(e):3===this._state?this.stateInTagName(e):6===this._state?this.stateInClosingTagName(e):2===this._state?this.stateBeforeTagName(e):10===this._state?this.stateAfterAttributeName(e):13===this._state?this.stateInAttributeValueSingleQuotes(e):11===this._state?this.stateBeforeAttributeValue(e):5===this._state?this.stateBeforeClosingTagName(e):7===this._state?this.stateAfterClosingTagName(e):32===this._state?this.stateBeforeSpecialS(e):21===this._state?this.stateAfterComment1(e):14===this._state?this.stateInAttributeValueNoQuotes(e):4===this._state?this.stateInSelfClosingTag(e):16===this._state?this.stateInDeclaration(e):15===this._state?this.stateBeforeDeclaration(e):22===this._state?this.stateAfterComment2(e):18===this._state?this.stateBeforeComment(e):33===this._state?this.stateBeforeSpecialSEnd(e):53===this._state?L(this,e):39===this._state?S(this,e):40===this._state?_(this,e):41===this._state?E(this,e):34===this._state?v(this,e):35===this._state?y(this,e):36===this._state?b(this,e):37===this._state?w(this,e):38===this._state?this.stateBeforeSpecialLast(e,2):42===this._state?k(this,e):43===this._state?this.stateAfterSpecialLast(e,6):44===this._state?x(this,e):29===this._state?this.stateInCdata(e):45===this._state?T(this,e):46===this._state?C(this,e):47===this._state?this.stateBeforeSpecialLast(e,3):48===this._state?A(this,e):49===this._state?I(this,e):50===this._state?R(this,e):51===this._state?this.stateAfterSpecialLast(e,5):52===this._state?P(this,e):54===this._state?O(this,e):55===this._state?M(this,e):56===this._state?D(this,e):57===this._state?this.stateBeforeSpecialLast(e,4):58===this._state?F(this,e):59===this._state?N(this,e):60===this._state?j(this,e):61===this._state?this.stateAfterSpecialLast(e,5):17===this._state?this.stateInProcessingInstruction(e):64===this._state?this.stateInNamedEntity(e):23===this._state?u(this,e):62===this._state?B(this,e):24===this._state?p(this,e):25===this._state?m(this,e):30===this._state?this.stateAfterCdata1(e):31===this._state?this.stateAfterCdata2(e):26===this._state?g(this,e):27===this._state?f(this,e):28===this._state?this.stateBeforeCdata6(e):66===this._state?this.stateInHexEntity(e):65===this._state?this.stateInNumericEntity(e):63===this._state?U(this,e):this.cbs.onerror(Error("unknown _state"),this._state),this._index++}this.cleanup()},e.prototype.finish=function(){this.sectionStart<this._index&&this.handleTrailingData(),this.cbs.onend()},e.prototype.handleTrailingData=function(){var e=this.buffer.substr(this.sectionStart);29===this._state||30===this._state||31===this._state?this.cbs.oncdata(e):19===this._state||21===this._state||22===this._state?this.cbs.oncomment(e):64!==this._state||this.xmlMode?65!==this._state||this.xmlMode?66!==this._state||this.xmlMode?3!==this._state&&8!==this._state&&11!==this._state&&10!==this._state&&9!==this._state&&13!==this._state&&12!==this._state&&14!==this._state&&6!==this._state&&this.cbs.ontext(e):(this.decodeNumericEntity(3,16,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.decodeNumericEntity(2,10,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.parseLegacyEntity(),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData()))},e.prototype.getSection=function(){return this.buffer.substring(this.sectionStart,this._index)},e.prototype.emitToken=function(e){this.cbs[e](this.getSection()),this.sectionStart=-1},e.prototype.emitPartial=function(e){1!==this.baseState?this.cbs.onattribdata(e):this.cbs.ontext(e)},e}();t.default=q},3719:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RssHandler=t.DefaultHandler=t.DomUtils=t.ElementType=t.Tokenizer=t.createDomStream=t.parseDOM=t.parseDocument=t.DomHandler=t.Parser=void 0;var l=n(763);Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return l.Parser}});var c=n(7915);function d(e,t){var n=new c.DomHandler(void 0,t);return new l.Parser(n,t).end(e),n.root}Object.defineProperty(t,"DomHandler",{enumerable:!0,get:function(){return c.DomHandler}}),Object.defineProperty(t,"DefaultHandler",{enumerable:!0,get:function(){return c.DomHandler}}),t.parseDocument=d,t.parseDOM=function(e,t){return d(e,t).children},t.createDomStream=function(e,t,n){var i=new c.DomHandler(e,t,n);return new l.Parser(i,t)};var h=n(9889);Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return a(h).default}});var u=s(n(9960));t.ElementType=u,o(n(3870),t),t.DomUtils=s(n(9432));var p=n(3870);Object.defineProperty(t,"RssHandler",{enumerable:!0,get:function(){return p.FeedHandler}})},6057:(e,t)=>{"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPlainObject=function(e){var t,i;return!1!==n(e)&&(void 0===(t=e.constructor)||!1!==n(i=t.prototype)&&!1!==i.hasOwnProperty("isPrototypeOf"))}},2043:function(e,t,n){var i,r;!function(s,o){"use strict";i=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}function a(t,n){for(var r=0;r<i.length;r++){var s=i[r];this[s]=r<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function l(e,n,i){return function(){typeof console!==t&&(a.call(this,n,i),this[e].apply(this,arguments))}}function c(e,t,n){return o(e)||l.apply(this,arguments)}function d(e,n,r){var s,o=this;n=null==n?"WARN":n;var l="loglevel";function d(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(l)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=r||c,o.getLevel=function(){return s},o.setLevel=function(n,r){if("string"==typeof n&&void 0!==o.levels[n.toUpperCase()]&&(n=o.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==r&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(e){}}}(n),a.call(o,n,e),typeof console===t&&n<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){n=e,d()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(n,!1),function(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var h=d();null==h&&(h=n),o.setLevel(h,!1)}var h=new d,u={};h.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new d(e,h.getLevel(),h.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return h.noConflict=function(){return typeof window!==t&&window.log===h&&(window.log=p),h},h.getLoggers=function(){return u},h.default=h,h},void 0===(r=i.call(t,n,t,e))||(e.exports=r)}()},686:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensibleEvents=void 0;var i=n(5998),r=n(1940),s=n(5617),o=n(4600),a=n(6931),l=n(3637),c=n(5492);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"interpreters",new i.NamespacedMap([[s.LEGACY_M_ROOM_MESSAGE,s.parseMRoomMessage],[a.M_MESSAGE,o.parseMMessage],[a.M_EMOTE,o.parseMMessage],[a.M_NOTICE,o.parseMMessage],[l.M_POLL_START,c.parseMPoll],[l.M_POLL_RESPONSE,c.parseMPoll],[l.M_POLL_END,c.parseMPoll]])),u(this,"_unknownInterpretOrder",[a.M_MESSAGE])}var t,n,p;return t=e,p=[{key:"defaultInstance",get:function(){return e._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return e.defaultInstance.unknownInterpretOrder},set:function(t){e.defaultInstance.unknownInterpretOrder=t}},{key:"registerInterpreter",value:function(t,n){e.defaultInstance.registerInterpreter(t,n)}},{key:"parse",value:function(t){return e.defaultInstance.parse(t)}}],(n=[{key:"unknownInterpretOrder",get:function(){var e;return null!==(e=this._unknownInterpretOrder)&&void 0!==e?e:[]},set:function(e){this._unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){this.interpreters.set(e,t)}},{key:"parse",value:function(e){try{if(this.interpreters.hasNamespaced(e.type))return this.interpreters.getNamespaced(e.type)(e);var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}(this.unknownInterpretOrder);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this.interpreters.has(i)){var s=this.interpreters.get(i)(e);if(s)return s}}}catch(e){n.e(e)}finally{n.f()}return null}catch(e){if(e instanceof r.InvalidEventError)return null;throw e}}}])&&h(t.prototype,n),p&&h(t,p),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.ExtensibleEvents=p,u(p,"_defaultInstance",new p)},2508:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1940:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function r(e){var t="function"==typeof Map?new Map:void 0;return r=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return s(e,arguments,l(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),a(i,e)},r(e)}function s(e,t,n){return s=o()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&a(r,n.prototype),r},s.apply(null,arguments)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidEventError=void 0;var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(c,e);var t,n,r,s=(t=c,n=o(),function(){var e,r=l(t);if(n){var s=l(this).constructor;e=Reflect.construct(r,arguments,s)}else e=r.apply(this,arguments);return i(this,e)});function c(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),s.call(this,e)}return r=c,Object.defineProperty(r,"prototype",{writable:!1}),r}(r(Error));t.InvalidEventError=c},5998:(e,t)=>{"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.NamespacedMap=void 0;var r=function(){function e(t){var i,r,s;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=this,r="internalMap",s=new Map,r in i?Object.defineProperty(i,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[r]=s,t){var o,a=function(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,s=function(){};return{s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==i.return||i.return()}finally{if(l)throw o}}}}(t);try{for(a.s();!(o=a.n()).done;){var l=o.value;this.set(l[0],l[1])}}catch(e){a.e(e)}finally{a.f()}}}var t,r;return t=e,(r=[{key:"get",value:function(e){return e.name&&this.internalMap.has(e.name)?this.internalMap.get(e.name):e.altName&&this.internalMap.has(e.altName)?this.internalMap.get(e.altName):null}},{key:"set",value:function(e,t){e.name&&this.internalMap.set(e.name,t),e.altName&&this.internalMap.set(e.altName,t)}},{key:"has",value:function(e){return!!this.get(e)}},{key:"delete",value:function(e){e.name&&this.internalMap.delete(e.name),e.altName&&this.internalMap.delete(e.altName)}},{key:"hasNamespaced",value:function(e){return this.internalMap.has(e)}},{key:"getNamespaced",value:function(e){return this.internalMap.get(e)}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.NamespacedMap=r},4355:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function r(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableValue=t.NamespacedValue=void 0;var c=function(){function e(t,n){if(o(this,e),this.stable=t,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return l(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return!!this.name&&this.name===e||!!this.altName&&this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();t.NamespacedValue=c;var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,n,a=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=s(t);if(n){var o=s(this).constructor;e=Reflect.construct(i,arguments,o)}else e=i.apply(this,arguments);return r(this,e)});function c(e,t){var n;if(o(this,c),!(n=a.call(this,e,t)).unstable)throw new Error("Unstable value must be supplied");return n}return l(c,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),c}(c);t.UnstableValue=d},4449:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EmoteEvent=void 0;var r=n(3240),s=n(6931),o=n(8472);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=d(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},c.apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function u(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(g,e);var t,n,i,r,d,m=(r=g,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(r);if(d){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function g(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),m.call(this,e)}return t=g,i=[{key:"from",value:function(e,t){var n;return new g({type:s.M_EMOTE.name,content:(n={},a(n,s.M_TEXT.name,e),a(n,s.M_HTML.name,t),n)})}}],(n=[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,s.M_EMOTE)||c(p(g.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=c(p(g.prototype),"serialize",this).call(this);return e.content.msgtype="m.emote",e}}])&&l(t.prototype,n),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),g}(r.MessageEvent);t.EmoteEvent=m},2869:(e,t)=>{"use strict";function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensibleEvent=void 0;var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wireFormat=t}var t,i;return t=e,(i=[{key:"wireContent",get:function(){return this.wireFormat.content}}])&&n(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.ExtensibleEvent=i},3240:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageEvent=void 0;var r=n(2869),s=n(2932),o=n(1940),a=n(6931),l=n(8472);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function p(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(y,e);var t,n,i,r,c,v=(r=y,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(c){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function y(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),f(m(t=v.call(this,e)),"text",void 0),f(m(t),"html",void 0),f(m(t),"renderings",void 0);var n=a.M_MESSAGE.findIn(t.wireContent),i=a.M_TEXT.findIn(t.wireContent),r=a.M_HTML.findIn(t.wireContent);if((0,s.isProvided)(n)){if(!Array.isArray(n))throw new o.InvalidEventError("m.message contents must be an array");var l=n.find((function(e){return!(0,s.isProvided)(e.mimetype)||"text/plain"===e.mimetype})),c=n.find((function(e){return"text/html"===e.mimetype}));if(!l)throw new o.InvalidEventError("m.message is missing a plain text representation");t.text=l.body,t.html=null==c?void 0:c.body,t.renderings=n}else{if(!(0,s.isOptionalAString)(i))throw new o.InvalidEventError("Missing textual representation for event");t.text=i,t.html=r,t.renderings=[{body:i,mimetype:"text/plain"}],t.html&&t.renderings.push({body:t.html,mimetype:"text/html"})}return t}return t=y,i=[{key:"from",value:function(e,t){var n;return new y({type:a.M_MESSAGE.name,content:(n={},f(n,a.M_TEXT.name,e),f(n,a.M_HTML.name,t),n)})}}],(n=[{key:"isEmote",get:function(){return a.M_EMOTE.matches(this.wireFormat.type)||(0,s.isProvided)(a.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return a.M_NOTICE.matches(this.wireFormat.type)||(0,s.isProvided)(a.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,a.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var e=f({},a.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var t=this.renderings[0].mimetype;void 0!==t&&"text/plain"!==t||(e=f({},a.M_TEXT.name,this.renderings[0].body))}return e}},{key:"serialize",value:function(){var e;return{type:"m.room.message",content:d(d({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(e=this.html)&&void 0!==e?e:void 0})}}}])&&h(t.prototype,n),i&&h(t,i),Object.defineProperty(t,"prototype",{writable:!1}),y}(r.ExtensibleEvent);t.MessageEvent=v},4808:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeEvent=void 0;var r=n(3240),s=n(6931),o=n(8472);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=d(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},c.apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function u(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(g,e);var t,n,i,r,d,m=(r=g,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(r);if(d){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function g(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),m.call(this,e)}return t=g,i=[{key:"from",value:function(e,t){var n;return new g({type:s.M_NOTICE.name,content:(n={},a(n,s.M_TEXT.name,e),a(n,s.M_HTML.name,t),n)})}}],(n=[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,s.M_NOTICE)||c(p(g.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=c(p(g.prototype),"serialize",this).call(this);return e.content.msgtype="m.notice",e}}])&&l(t.prototype,n),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),g}(r.MessageEvent);t.NoticeEvent=m},5510:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollEndEvent=void 0;var r=n(3637),s=n(1940),o=n(1210),a=n(3240),l=n(6931),c=n(8472);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function m(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(w,e);var t,n,i,d,y,b=(d=w,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(d);if(y){var n=f(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function w(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),v(g(t=b.call(this,e)),"pollEventId",void 0),v(g(t),"closingMessage",void 0);var n=t.wireContent["m.relates_to"];if(!o.REFERENCE_RELATION.matches(null==n?void 0:n.rel_type)||"string"!=typeof(null==n?void 0:n.event_id))throw new s.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=n.event_id,t.closingMessage=new a.MessageEvent(t.wireFormat),t}return t=w,i=[{key:"from",value:function(e,t){var n;return new w({type:r.M_POLL_END.name,content:(n={"m.relates_to":{rel_type:o.REFERENCE_RELATION.name,event_id:e}},v(n,r.M_POLL_END.name,{}),v(n,l.M_TEXT.name,t),n)})}}],(n=[{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,r.M_POLL_END)}},{key:"serialize",value:function(){return{type:r.M_POLL_END.name,content:h(v({"m.relates_to":{rel_type:o.REFERENCE_RELATION.name,event_id:this.pollEventId}},r.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}])&&u(t.prototype,n),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),w}(n(2869).ExtensibleEvent);t.PollEndEvent=y},4648:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollResponseEvent=void 0;var r=n(2869),s=n(3637),o=n(1940),a=n(1210),l=n(8472);function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function h(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(v,e);var t,n,i,r,g,f=(r=v,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(r);if(g){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function v(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),m(u(t=f.call(this,e)),"internalAnswerIds",void 0),m(u(t),"internalSpoiled",void 0),m(u(t),"pollEventId",void 0);var n=t.wireContent["m.relates_to"];if(!a.REFERENCE_RELATION.matches(null==n?void 0:n.rel_type)||"string"!=typeof(null==n?void 0:n.event_id))throw new o.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=n.event_id,t.validateAgainst(null),t}return t=v,i=[{key:"from",value:function(e,t){return new v({type:s.M_POLL_RESPONSE.name,content:m({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:t}},s.M_POLL_RESPONSE.name,{answers:e})})}}],(n=[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(e){var t=s.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(null==t?void 0:t.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var n=t.answers;if(n.some((function(e){return"string"!=typeof e}))||0===n.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(e){if(n.some((function(t){return!e.answers.some((function(e){return e.id===t}))})))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);n=n.slice(0,e.maxSelections)}this.internalAnswerIds=n,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,s.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:s.M_POLL_RESPONSE.name,content:m({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:this.pollEventId}},s.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}])&&c(t.prototype,n),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),v}(r.ExtensibleEvent);t.PollResponseEvent=g},8267:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollStartEvent=t.PollAnswerSubevent=void 0;var r=n(3637),s=n(3240),o=n(6931),a=n(1940),l=n(4355),c=n(8472),d=n(2869);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=_(e);if(t){var r=_(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return w(this,n)}}function w(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(e){v(n,e);var t=b(n);function n(e){var i;m(this,n),E(S(i=t.call(this,e)),"id",void 0);var r=e.content.id;if(!r||"string"!=typeof r)throw new a.InvalidEventError("Answer ID must be a non-empty string");return i.id=r,i}return f(n,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:p({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(e,t){return new n({type:"org.matrix.sdk.poll.answer",content:E({id:e},o.M_TEXT.name,t)})}}]),n}(s.MessageEvent);t.PollAnswerSubevent=k;var x=function(e){v(n,e);var t=b(n);function n(e){var i;m(this,n),E(S(i=t.call(this,e)),"question",void 0),E(S(i),"kind",void 0),E(S(i),"rawKind",void 0),E(S(i),"maxSelections",void 0),E(S(i),"answers",void 0);var o=r.M_POLL_START.findIn(i.wireContent);if(!o.question)throw new a.InvalidEventError("A question is required");if(i.question=new s.MessageEvent({type:"org.matrix.sdk.poll.question",content:o.question}),i.rawKind=o.kind,r.M_POLL_KIND_DISCLOSED.matches(i.rawKind)?i.kind=r.M_POLL_KIND_DISCLOSED:i.kind=r.M_POLL_KIND_UNDISCLOSED,i.maxSelections=Number.isFinite(o.max_selections)&&o.max_selections>0?o.max_selections:1,!Array.isArray(o.answers))throw new a.InvalidEventError("Poll answers must be an array");var l=o.answers.slice(0,20).map((function(e){return new k({type:"org.matrix.sdk.poll.answer",content:e})}));if(l.length<=0)throw new a.InvalidEventError("No answers available");return i.answers=l,i}return f(n,[{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,r.M_POLL_START)}},{key:"serialize",value:function(){var e;return{type:r.M_POLL_START.name,content:(e={},E(e,r.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map((function(e){return e.serialize().content}))}),E(e,o.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map((function(e,t){return"".concat(t+1,". ").concat(e.text)})).join("\n"))),e)}}}],[{key:"from",value:function(e,t,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new n({type:r.M_POLL_START.name,content:(s={},E(s,o.M_TEXT.name,e),E(s,r.M_POLL_START.name,{question:E({},o.M_TEXT.name,e),kind:i instanceof l.NamespacedValue?i.name:i,max_selections:a,answers:t.map((function(e){return E({id:C()},o.M_TEXT.name,e)}))}),s)})}}]),n}(d.ExtensibleEvent);t.PollStartEvent=x;var T="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function C(){return(e=Array(16),function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(){return T.charAt(Math.floor(Math.random()*T.length))})).join("");var e}},6931:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_TEXT=t.M_NOTICE=t.M_MESSAGE=t.M_HTML=t.M_EMOTE=void 0;var i=n(4355),r=new i.UnstableValue("m.message","org.matrix.msc1767.message");t.M_MESSAGE=r;var s=new i.UnstableValue("m.text","org.matrix.msc1767.text");t.M_TEXT=s;var o=new i.UnstableValue("m.html","org.matrix.msc1767.html");t.M_HTML=o;var a=new i.UnstableValue("m.emote","org.matrix.msc1767.emote");t.M_EMOTE=a;var l=new i.UnstableValue("m.notice","org.matrix.msc1767.notice");t.M_NOTICE=l},3637:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_POLL_START=t.M_POLL_RESPONSE=t.M_POLL_KIND_UNDISCLOSED=t.M_POLL_KIND_DISCLOSED=t.M_POLL_END=void 0;var i=n(4355),r=new i.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");t.M_POLL_KIND_DISCLOSED=r;var s=new i.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");t.M_POLL_KIND_UNDISCLOSED=s;var o=new i.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");t.M_POLL_START=o;var a=new i.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");t.M_POLL_RESPONSE=a;var l=new i.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");t.M_POLL_END=l},1210:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REFERENCE_RELATION=void 0;var i=new(n(4355).NamespacedValue)("m.reference");t.REFERENCE_RELATION=i},1333:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(686);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var r=n(2508);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var s=n(1940);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var o=n(4355);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(5998);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var l=n(2932);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(2117);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=n(8472);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var h=n(5617);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var u=n(4600);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var p=n(5492);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var m=n(1210);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var g=n(2869);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var f=n(6931);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var v=n(3240);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var y=n(4449);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var b=n(4808);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var w=n(3637);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var S=n(8267);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var _=n(4648);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var E=n(5510);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}))},5617:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LEGACY_M_ROOM_MESSAGE=void 0,t.parseMRoomMessage=function(e){var t,n,o;if(a.M_MESSAGE.findIn(e.content)||a.M_TEXT.findIn(e.content))return new i.MessageEvent(e);var l,h,u,p=null===(t=e.content)||void 0===t?void 0:t.msgtype,m=null===(n=e.content)||void 0===n?void 0:n.body,g="org.matrix.custom.html"===(null===(o=e.content)||void 0===o?void 0:o.format)?e.content.formatted_body:null;return"m.text"===p?new i.MessageEvent(c(c({},e),{},{content:c(c({},e.content),{},(l={},d(l,a.M_TEXT.name,m),d(l,a.M_HTML.name,g),l))})):"m.notice"===p?new r.NoticeEvent(c(c({},e),{},{content:c(c({},e.content),{},(h={},d(h,a.M_TEXT.name,m),d(h,a.M_HTML.name,g),h))})):"m.emote"===p?new s.EmoteEvent(c(c({},e),{},{content:c(c({},e.content),{},(u={},d(u,a.M_TEXT.name,m),d(u,a.M_HTML.name,g),u))})):null};var i=n(3240),r=n(4808),s=n(4449),o=n(4355),a=n(6931);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=new o.NamespacedValue("m.room.message");t.LEGACY_M_ROOM_MESSAGE=h},4600:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMMessage=function(e){return r.M_EMOTE.matches(e.type)?new s.EmoteEvent(e):r.M_NOTICE.matches(e.type)?new o.NoticeEvent(e):new i.MessageEvent(e)};var i=n(3240),r=n(6931),s=n(4449),o=n(4808)},5492:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMPoll=function(e){return i.M_POLL_START.matches(e.type)?new r.PollStartEvent(e):i.M_POLL_RESPONSE.matches(e.type)?new s.PollResponseEvent(e):i.M_POLL_END.matches(e.type)?new o.PollEndEvent(e):null};var i=n(3637),r=n(8267),s=n(4648),o=n(5510)},2932:(e,t)=>{"use strict";function n(e){return null!=e}Object.defineProperty(t,"__esModule",{value:!0}),t.isOptionalAString=function(e){return n(e)&&"string"==typeof e},t.isProvided=n},2117:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyMsgType=void 0,t.isEventLike=function(e,t){var n=e.content;return t===i.Text?r.M_MESSAGE.matches(e.type)||"m.room.message"===e.type&&"m.text"===(null==n?void 0:n.msgtype):t===i.Emote?r.M_EMOTE.matches(e.type)||"m.room.message"===e.type&&"m.emote"===(null==n?void 0:n.msgtype):t===i.Notice&&(r.M_NOTICE.matches(e.type)||"m.room.message"===e.type&&"m.notice"===(null==n?void 0:n.msgtype))};var i,r=n(6931);t.LegacyMsgType=i,function(e){e.Text="m.text",e.Notice="m.notice",e.Emote="m.emote"}(i||(t.LegacyMsgType=i={}))},8472:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,i=e;return n.matches(i.name)||n.matches(i.altName)}},1470:(e,t)=>{"use strict";let n,i,r,s,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.TweakName=t.RuleId=t.PushRuleKind=t.PushRuleActionName=t.DMMemberCountCondition=t.ConditionOperator=t.ConditionKind=void 0,t.isDmMemberCountCondition=function(e){return"==2"===e||"2"===e},t.PushRuleActionName=n,function(e){e.DontNotify="dont_notify",e.Notify="notify",e.Coalesce="coalesce"}(n||(t.PushRuleActionName=n={})),t.TweakName=i,function(e){e.Highlight="highlight",e.Sound="sound"}(i||(t.TweakName=i={})),t.ConditionOperator=r,function(e){e.ExactEquals="==",e.LessThan="<",e.GreaterThan=">",e.GreaterThanOrEqual=">=",e.LessThanOrEqual="<="}(r||(t.ConditionOperator=r={})),t.DMMemberCountCondition="2",t.ConditionKind=s,function(e){e.EventMatch="event_match",e.ContainsDisplayName="contains_display_name",e.RoomMemberCount="room_member_count",e.SenderNotificationPermission="sender_notification_permission"}(s||(t.ConditionKind=s={})),t.PushRuleKind=o,function(e){e.Override="override",e.ContentSpecific="content",e.RoomSpecific="room",e.SenderSpecific="sender",e.Underride="underride"}(o||(t.PushRuleKind=o={})),t.RuleId=a,function(e){e.Master=".m.rule.master",e.ContainsDisplayName=".m.rule.contains_display_name",e.ContainsUserName=".m.rule.contains_user_name",e.AtRoomNotification=".m.rule.roomnotif",e.DM=".m.rule.room_one_to_one",e.EncryptedDM=".m.rule.encrypted_room_one_to_one",e.Message=".m.rule.message",e.EncryptedMessage=".m.rule.encrypted",e.InviteToSelf=".m.rule.invite_for_me",e.MemberEvent=".m.rule.member_event",e.IncomingCall=".m.rule.call",e.SuppressNotices=".m.rule.suppress_notices",e.Tombstone=".m.rule.tombstone"}(a||(t.RuleId=a={}))},5699:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_BEACON_INFO=t.M_BEACON=void 0;var i=n(7048);const r=new i.UnstableValue("m.beacon_info","org.matrix.msc3672.beacon_info");t.M_BEACON_INFO=r;const s=new i.UnstableValue("m.beacon","org.matrix.msc3672.beacon");t.M_BEACON=s},2481:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTABLE_MSC3089_TREE_SUBTYPE=t.UNSTABLE_MSC3089_LEAF=t.UNSTABLE_MSC3089_BRANCH=t.UNSTABLE_MSC3088_PURPOSE=t.UNSTABLE_MSC3088_ENABLED=t.UNSTABLE_MSC2716_MARKER=t.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=t.RoomType=t.RoomCreateTypeField=t.RelationType=t.PUSHER_ENABLED=t.PUSHER_DEVICE_ID=t.MsgType=t.LOCAL_NOTIFICATION_SETTINGS_PREFIX=t.EventType=t.EVENT_VISIBILITY_CHANGE_TYPE=void 0;var i=n(7048);let r,s,o,a;t.EventType=r,function(e){e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomAliases="m.room.aliases",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",e.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.SpaceOrder="org.matrix.msc3230.space_order",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy"}(r||(t.EventType=r={})),t.RelationType=s,function(e){e.Annotation="m.annotation",e.Replace="m.replace",e.Reference="m.reference",e.Thread="m.thread"}(s||(t.RelationType=s={})),t.MsgType=o,function(e){e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video",e.KeyVerificationRequest="m.key.verification.request"}(o||(t.MsgType=o={})),t.RoomCreateTypeField="type",t.RoomType=a,function(e){e.Space="m.space",e.UnstableCall="org.matrix.msc3417.call",e.ElementVideo="io.element.video"}(a||(t.RoomType=a={}));const l=new i.UnstableValue("m.room.purpose","org.matrix.msc3088.purpose");t.UNSTABLE_MSC3088_PURPOSE=l;const c=new i.UnstableValue("m.enabled","org.matrix.msc3088.enabled");t.UNSTABLE_MSC3088_ENABLED=c;const d=new i.UnstableValue("m.data_tree","org.matrix.msc3089.data_tree");t.UNSTABLE_MSC3089_TREE_SUBTYPE=d;const h=new i.UnstableValue("m.leaf","org.matrix.msc3089.leaf");t.UNSTABLE_MSC3089_LEAF=h;const u=new i.UnstableValue("m.branch","org.matrix.msc3089.branch");t.UNSTABLE_MSC3089_BRANCH=u;const p=new i.UnstableValue("m.room.marker","org.matrix.msc2716.marker");t.UNSTABLE_MSC2716_MARKER=p;const m=new i.UnstableValue("io.element.functional_members","io.element.functional_members");t.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=m;const g=new i.UnstableValue("m.visibility","org.matrix.msc3531.visibility");t.EVENT_VISIBILITY_CHANGE_TYPE=g;const f=new i.UnstableValue("enabled","org.matrix.msc3881.enabled");t.PUSHER_ENABLED=f;const v=new i.UnstableValue("device_id","org.matrix.msc3881.device_id");t.PUSHER_DEVICE_ID=v;const y=new i.UnstableValue("m.local_notification_settings","org.matrix.msc3890.local_notification_settings");t.LOCAL_NOTIFICATION_SETTINGS_PREFIX=y},6548:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_NODE_TYPE=void 0;const i=new(n(7048).UnstableValue)("m.text","org.matrix.msc1767.text");t.TEXT_NODE_TYPE=i},6709:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_TIMESTAMP=t.M_LOCATION=t.M_ASSET=t.LocationAssetType=void 0;var i=n(7048);let r;n(6548),t.LocationAssetType=r,function(e){e.Self="m.self",e.Pin="m.pin"}(r||(t.LocationAssetType=r={}));const s=new i.UnstableValue("m.asset","org.matrix.msc3488.asset");t.M_ASSET=s;const o=new i.UnstableValue("m.ts","org.matrix.msc3488.ts");t.M_TIMESTAMP=o;const a=new i.UnstableValue("m.location","org.matrix.msc3488.location");t.M_LOCATION=a},4702:(e,t)=>{"use strict";let n,i,r,s,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.Visibility=t.RestrictedAllowType=t.Preset=t.JoinRule=t.HistoryVisibility=t.GuestAccess=void 0,t.Visibility=n,function(e){e.Public="public",e.Private="private"}(n||(t.Visibility=n={})),t.Preset=i,function(e){e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat"}(i||(t.Preset=i={})),t.JoinRule=r,function(e){e.Public="public",e.Invite="invite",e.Private="private",e.Knock="knock",e.Restricted="restricted"}(r||(t.JoinRule=r={})),t.RestrictedAllowType=s,function(e){e.RoomMembership="m.room_membership"}(s||(t.RestrictedAllowType=s={})),t.GuestAccess=o,function(e){e.CanJoin="can_join",e.Forbidden="forbidden"}(o||(t.GuestAccess=o={})),t.HistoryVisibility=a,function(e){e.Invited="invited",e.Joined="joined",e.Shared="shared",e.WorldReadable="world_readable"}(a||(t.HistoryVisibility=a={}))},5550:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.ReceiptType=void 0,t.ReceiptType=n,function(e){e.Read="m.read",e.FullyRead="m.fully_read",e.ReadPrivate="m.read.private"}(n||(t.ReceiptType=n={}))},6513:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9162:(e,t)=>{"use strict";var n;let i;Object.defineProperty(t,"__esModule",{value:!0}),t.SearchOrderBy=void 0,function(e){e.RoomId="room_id",e.Sender="sender"}(n||(n={})),t.SearchOrderBy=i,function(e){e.Recent="recent",e.Rank="rank"}(i||(t.SearchOrderBy=i={}))},9953:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_TOPIC=void 0;const i=new(n(7048).UnstableValue)("m.topic","org.matrix.msc3765.topic");t.M_TOPIC=i},7048:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableValue=t.ServerControlledNamespacedValue=t.NamespacedValue=void 0;var r=i(n(8416));class s{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){const e=[this.name],t=this.altName;return t&&e.push(t),e}matches(e){return this.name===e||this.altName===e}findIn(e){let t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}includedIn(e){let t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}t.NamespacedValue=s,t.ServerControlledNamespacedValue=class extends s{constructor(...e){super(...e),(0,r.default)(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}},t.UnstableValue=class extends s{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}},771:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.TypedReEmitter=t.ReEmitter=void 0;var r=i(n(8416));class s{constructor(e){this.target=e,(0,r.default)(this,"reEmitters",new Map)}reEmit(e,t){let n=this.reEmitters.get(e);n||(n=new Map,this.reEmitters.set(e,n));for(const i of t){const t=(...t)=>{"error"===i&&0===this.target.listenerCount("error")||this.target.emit(i,...t,e)};e.on(i,t),n.set(i,t)}}stopReEmitting(e,t){const n=this.reEmitters.get(e);if(n){for(const i of t)e.off(i,n.get(i)),n.delete(i);0===n.size&&this.reEmitters.delete(e)}}}t.ReEmitter=s,t.TypedReEmitter=class extends s{constructor(e){super(e)}reEmit(e,t){super.reEmit(e,t)}stopReEmitting(e,t){super.stopReEmitting(e,t)}}},3210:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceMessageQueue=void 0;var r=i(n(8416)),s=n(7434),o=n(9443);t.ToDeviceMessageQueue=class{constructor(e){this.client=e,(0,r.default)(this,"sending",!1),(0,r.default)(this,"running",!0),(0,r.default)(this,"retryTimeout",null),(0,r.default)(this,"retryAttempts",0),(0,r.default)(this,"sendQueue",(async()=>{if(null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.sending||!this.running)return;let e;s.logger.debug("Attempting to send queued to-device messages"),this.sending=!0;try{for(;this.running&&(e=await this.client.store.getOldestToDeviceBatch(),null!==e);)await this.sendBatch(e),await this.client.store.removeToDeviceBatch(e.id),this.retryAttempts=0;if(!this.running)return;s.logger.debug("All queued to-device messages sent")}catch(t){++this.retryAttempts;const n=o.MatrixScheduler.RETRY_BACKOFF_RATELIMIT(null,this.retryAttempts,t);if(-1===n)return void(4===Math.floor(t.httpStatus/100)?(s.logger.error("Fatal error when sending to-device message - dropping to-device batch!",t),await this.client.store.removeToDeviceBatch(e.id)):s.logger.info("Automatic retry limit reached for to-device messages."));s.logger.info(`Failed to send batch of to-device messages. Will retry in ${n}ms`,t),this.retryTimeout=setTimeout(this.sendQueue,n)}finally{this.sending=!1}}))}start(){this.running=!0,this.sendQueue()}stop(){this.running=!1,null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null}async queueBatch(e){const t=[];for(let n=0;n<e.batch.length;n+=20)t.push({eventType:e.eventType,batch:e.batch.slice(n,n+20),txnId:this.client.makeTxnId()});await this.client.store.saveToDeviceBatches(t),this.sendQueue()}async sendBatch(e){const t={};for(const n of e.batch)t[n.userId]||(t[n.userId]={}),t[n.userId][n.deviceId]=n.payload;s.logger.info(`Sending batch of ${e.batch.length} to-device messages with ID ${e.id}`),await this.client.sendToDevice(e.eventType,t,e.txnId)}}},9118:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDiscoveryAction=t.AutoDiscovery=void 0;var r=i(n(8416)),s=n(7434);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let l;t.AutoDiscoveryAction=l,function(e){e.SUCCESS="SUCCESS",e.IGNORE="IGNORE",e.PROMPT="PROMPT",e.FAIL_PROMPT="FAIL_PROMPT",e.FAIL_ERROR="FAIL_ERROR"}(l||(t.AutoDiscoveryAction=l={}));class c{static async fromDiscoveryConfig(e){const t={"m.homeserver":{state:c.FAIL_ERROR,error:c.ERROR_INVALID,base_url:null},"m.identity_server":{state:c.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return s.logger.error("No m.homeserver key in config"),t["m.homeserver"].state=c.FAIL_PROMPT,t["m.homeserver"].error=c.ERROR_INVALID,Promise.resolve(t);if(!e["m.homeserver"].base_url)return s.logger.error("No m.homeserver base_url in config"),t["m.homeserver"].state=c.FAIL_PROMPT,t["m.homeserver"].error=c.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const n=this.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!n)return s.logger.error("Invalid base_url for m.homeserver"),t["m.homeserver"].error=c.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const i=await this.fetchWellKnownObject(`${n}/_matrix/client/versions`);if(!i||!i.raw.versions)return s.logger.error("Invalid /versions response"),t["m.homeserver"].error=c.ERROR_INVALID_HOMESERVER,t["m.homeserver"].base_url=n,Promise.resolve(t);t["m.homeserver"]={state:c.SUCCESS,error:null,base_url:n};let r="";if(e["m.identity_server"]){const n={"m.homeserver":t["m.homeserver"],"m.identity_server":{state:c.FAIL_PROMPT,error:c.ERROR_INVALID_IS,base_url:null}};if(r=this.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!r)return s.logger.error("Invalid base_url for m.identity_server"),n["m.identity_server"].error=c.ERROR_INVALID_IS_BASE_URL,Promise.resolve(n);const i=await this.fetchWellKnownObject(`${r}/_matrix/identity/api/v1`);if(!i||!i.raw||i.action!==l.SUCCESS)return s.logger.error("Invalid /api/v1 response"),n["m.identity_server"].error=c.ERROR_INVALID_IDENTITY_SERVER,n["m.identity_server"].base_url=r,Promise.resolve(n)}return r&&r.toString().length>0&&(t["m.identity_server"]={state:c.SUCCESS,error:null,base_url:r}),Object.keys(e).forEach((n=>{if("m.homeserver"===n||"m.identity_server"===n){const i=["error","state","base_url"];for(const r of Object.keys(e[n]))i.includes(r)||(t[n][r]=e[n][r])}else t[n]=e[n]})),Promise.resolve(t)}static async findClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:c.FAIL_ERROR,error:c.ERROR_INVALID,base_url:null},"m.identity_server":{state:c.PROMPT,error:null,base_url:null}},n=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return n&&n.action===l.SUCCESS?c.fromDiscoveryConfig(n.raw):(s.logger.error("No response or error when parsing .well-known"),n.reason&&s.logger.error(n.reason),n.action===l.IGNORE?t["m.homeserver"]={state:c.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=c.FAIL_PROMPT,t["m.homeserver"].error=c.ERROR_INVALID),Promise.resolve(t))}static async getRawClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t&&t.raw||{}}static sanitizeWellKnownUrl(e){if(!e)return!1;try{let t=null;try{t=new URL(e)}catch(e){s.logger.error("Could not parse url",e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;const n=t.port?`:${t.port}`:"",i=t.pathname?t.pathname:"";let r=`${t.protocol}//${t.hostname}${n}${i}`;return r.endsWith("/")&&(r=r.substring(0,r.length-1)),r}catch(e){return s.logger.error(e),!1}}static fetchWellKnownObject(e){return new Promise((t=>{const i=n(8070).getRequest();if(!i)throw new Error("No request library available");i({method:"GET",uri:e,timeout:5e3},((e,n,i)=>{if(e||(null==n?void 0:n.statusCode)<200||(null==n?void 0:n.statusCode)>=300){const i={error:e,raw:{}};return t(404===(null==n?void 0:n.statusCode)?a(a({},i),{},{action:l.IGNORE,reason:c.ERROR_MISSING_WELLKNOWN}):a(a({},i),{},{action:l.FAIL_PROMPT,reason:(null==e?void 0:e.message)||"General failure"}))}try{return t({raw:JSON.parse(i),action:l.SUCCESS})}catch(e){return t({error:e,raw:{},action:l.FAIL_PROMPT,reason:"SyntaxError"===(null==e?void 0:e.name)?c.ERROR_INVALID_JSON:c.ERROR_INVALID})}}))}))}}t.AutoDiscovery=c,(0,r.default)(c,"ERROR_INVALID","Invalid homeserver discovery response"),(0,r.default)(c,"ERROR_GENERIC_FAILURE","Failed to get autodiscovery configuration from server"),(0,r.default)(c,"ERROR_INVALID_HS_BASE_URL","Invalid base_url for m.homeserver"),(0,r.default)(c,"ERROR_INVALID_HOMESERVER","Homeserver URL does not appear to be a valid Matrix homeserver"),(0,r.default)(c,"ERROR_INVALID_IS_BASE_URL","Invalid base_url for m.identity_server"),(0,r.default)(c,"ERROR_INVALID_IDENTITY_SERVER","Identity server URL does not appear to be a valid identity server"),(0,r.default)(c,"ERROR_INVALID_IS","Invalid identity server discovery response"),(0,r.default)(c,"ERROR_MISSING_WELLKNOWN","No .well-known JSON file found"),(0,r.default)(c,"ERROR_INVALID_JSON","Invalid JSON"),(0,r.default)(c,"ALL_ERRORS",[c.ERROR_INVALID,c.ERROR_GENERIC_FAILURE,c.ERROR_INVALID_HS_BASE_URL,c.ERROR_INVALID_HOMESERVER,c.ERROR_INVALID_IS_BASE_URL,c.ERROR_INVALID_IDENTITY_SERVER,c.ERROR_INVALID_IS,c.ERROR_MISSING_WELLKNOWN,c.ERROR_INVALID_JSON]),(0,r.default)(c,"FAIL_ERROR",l.FAIL_ERROR),(0,r.default)(c,"FAIL_PROMPT",l.FAIL_PROMPT),(0,r.default)(c,"PROMPT",l.PROMPT),(0,r.default)(c,"SUCCESS",l.SUCCESS)},8743:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=void 0;var s=i(n(4770)),o=i(n(129)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(8070));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}if(Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))})),a.getRequest())throw new Error("Multiple matrix-js-sdk entrypoints detected!");let c;a.request((function(e,t){return e.qs=o.default.stringify(e.qs||{},e.qsStringifyOptions),(0,s.default)(e,t)}));try{c=n.g.indexedDB}catch(e){}c&&a.setCryptoStoreFactory((function(){return new a.IndexedDBCryptoStore(c,"matrix-js-sdk:crypto")}));var d=a;t.default=d,n.g.matrixcs=a},2168:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomVersionStability=t.PendingEventOrdering=t.MatrixClient=t.M_AUTHENTICATION=t.ClientEvent=t.CRYPTO_ENABLED=void 0;var r=i(n(8416)),s=n(1333),o=n(4551),a=n(4369),l=n(5641),c=n(9679),d=n(7906),h=n(2931),u=Z(n(3102)),p=n(8910),m=n(1707),g=n(9118),f=Z(n(2772)),v=n(771),y=n(635),b=n(7434),w=n(1415),S=n(7715),_=n(2600),E=n(4077),k=n(1597),x=n(3998),T=n(3667),C=n(1398),A=n(4830),I=n(8070),R=n(764),P=Z(n(4656)),O=n(2481),M=n(4702),D=n(1166),L=n(8401),F=n(5537),N=n(6170),j=n(9162),B=n(1470),U=n(7626),q=n(5861),z=n(5550),V=n(11),K=n(6969),H=n(5699),W=n(7048),$=n(3210),G=n(2958),Y=n(8515);function X(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(X=function(e){return e?n:t})(e)}function Z(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=X(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const ee=(0,_.isCryptoAvailable)();t.CRYPTO_ENABLED=ee;const te=6e5;let ne,ie;var re;t.PendingEventOrdering=ne,function(e){e.Chronological="chronological",e.Detached="detached"}(ne||(t.PendingEventOrdering=ne={})),t.RoomVersionStability=ie,function(e){e.Stable="stable",e.Unstable="unstable"}(ie||(t.RoomVersionStability=ie={})),function(e){e.MasterKey="master_key",e.SelfSigningKey="self_signing_key",e.UserSigningKey="user_signing_key"}(re||(re={}));const se=new W.UnstableValue("m.authentication","org.matrix.msc2965.authentication");t.M_AUTHENTICATION=se;const oe="$";let ae;t.ClientEvent=ae,function(e){e.Sync="sync",e.Event="event",e.ToDeviceEvent="toDeviceEvent",e.AccountData="accountData",e.Room="Room",e.DeleteRoom="deleteRoom",e.SyncUnexpectedError="sync.unexpectedError",e.ClientWellKnown="WellKnown.client",e.TurnServers="turnServers",e.TurnServersError="turnServers.error"}(ae||(t.ClientEvent=ae={}));const le=new W.UnstableValue("action","org.matrix.msc3824.action");class ce extends q.TypedEventEmitter{constructor(e){super(),(0,r.default)(this,"reEmitter",new v.TypedReEmitter(this)),(0,r.default)(this,"olmVersion",null),(0,r.default)(this,"usingExternalCrypto",!1),(0,r.default)(this,"store",void 0),(0,r.default)(this,"deviceId",void 0),(0,r.default)(this,"credentials",void 0),(0,r.default)(this,"pickleKey",void 0),(0,r.default)(this,"scheduler",void 0),(0,r.default)(this,"clientRunning",!1),(0,r.default)(this,"timelineSupport",!1),(0,r.default)(this,"urlPreviewCache",{}),(0,r.default)(this,"identityServer",void 0),(0,r.default)(this,"http",void 0),(0,r.default)(this,"crypto",void 0),(0,r.default)(this,"cryptoCallbacks",void 0),(0,r.default)(this,"callEventHandler",void 0),(0,r.default)(this,"supportsCallTransfer",!1),(0,r.default)(this,"forceTURN",!1),(0,r.default)(this,"iceCandidatePoolSize",0),(0,r.default)(this,"idBaseUrl",void 0),(0,r.default)(this,"baseUrl",void 0),(0,r.default)(this,"canSupportVoip",!1),(0,r.default)(this,"peekSync",null),(0,r.default)(this,"isGuestAccount",!1),(0,r.default)(this,"ongoingScrollbacks",{}),(0,r.default)(this,"notifTimelineSet",null),(0,r.default)(this,"cryptoStore",void 0),(0,r.default)(this,"verificationMethods",void 0),(0,r.default)(this,"fallbackICEServerAllowed",!1),(0,r.default)(this,"roomList",void 0),(0,r.default)(this,"syncApi",void 0),(0,r.default)(this,"roomNameGenerator",void 0),(0,r.default)(this,"pushRules",void 0),(0,r.default)(this,"syncLeftRoomsPromise",void 0),(0,r.default)(this,"syncedLeftRooms",!1),(0,r.default)(this,"clientOpts",void 0),(0,r.default)(this,"clientWellKnownIntervalID",void 0),(0,r.default)(this,"canResetTimelineCallback",void 0),(0,r.default)(this,"pushProcessor",new m.PushProcessor(this)),(0,r.default)(this,"serverVersionsPromise",void 0),(0,r.default)(this,"cachedCapabilities",void 0),(0,r.default)(this,"clientWellKnown",void 0),(0,r.default)(this,"clientWellKnownPromise",void 0),(0,r.default)(this,"turnServers",[]),(0,r.default)(this,"turnServersExpiry",0),(0,r.default)(this,"checkTurnServersIntervalID",null),(0,r.default)(this,"exportedOlmDeviceToImport",void 0),(0,r.default)(this,"txnCtr",0),(0,r.default)(this,"mediaHandler",new U.MediaHandler(this)),(0,r.default)(this,"pendingEventEncryption",new Map),(0,r.default)(this,"toDeviceMessageQueue",void 0),(0,r.default)(this,"ignoredInvites",void 0),(0,r.default)(this,"startCallEventHandler",(()=>{this.isInitialSyncComplete()&&(this.callEventHandler.start(),this.off(ae.Sync,this.startCallEventHandler))})),e.baseUrl=u.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=u.ensureNoTrailingSlash(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=e.usingExternalCrypto,this.store=e.store||new l.StubStore,this.deviceId=e.deviceId||null;const t=e.userId||null;this.credentials={userId:t},this.http=new S.MatrixHttpApi(this,{baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:S.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader}),e.deviceToImport?this.deviceId?b.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?b.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):b.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction((async e=>{const t=this.getRoom(e.getRoomId());e.status!==a.EventStatus.SENDING&&this.updatePendingEventStatus(t,e,a.EventStatus.SENDING);const n=await this.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,a.EventStatus.SENT,n.event_id),n})),(0,c.supportsMatrixCall)()&&(this.callEventHandler=new h.CallEventHandler(this),this.canSupportVoip=!0,this.on(ae.Sync,this.startCallEventHandler)),this.timelineSupport=Boolean(e.timelineSupport),this.cryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.roomList=new y.RoomList(this.cryptoStore),this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new $.ToDeviceMessageQueue(this),this.on(a.MatrixEventEvent.Decrypted,(e=>{var t,n;const i=e.getPushActions(),r=this.getPushActionsForEvent(e,!0),s=this.getRoom(e.getRoomId());if(!s)return;const o=s.getUnreadNotificationCount(I.NotificationCountType.Highlight),a=!(null==i||null===(t=i.tweaks)||void 0===t||!t.highlight),l=!(null==r||null===(n=r.tweaks)||void 0===n||!n.highlight);if((a!==l||o>0)&&!s.hasUserReadEvent(this.getUserId(),e.getId())){let e=o;l&&!a&&e++,!l&&a&&e--,s.setUnreadNotificationCount(I.NotificationCountType.Highlight,e),s.getUnreadNotificationCount(I.NotificationCountType.Total)<e&&s.setUnreadNotificationCount(I.NotificationCountType.Total,e)}})),this.on(I.RoomEvent.Receipt,((e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const n=e.getContent();if(!(Object.keys(n).filter((e=>{for(const[t,i]of Object.entries(n[e]))if(u.isSupportedReceiptType(t)&&i&&Object.keys(i).includes(this.getUserId()))return!0;return!1})).length>0))return;const i=20,r=t.getLiveTimeline().getEvents();let s=0;for(let e=r.length-1;e>=0;e--){if(e===r.length-i)return;const n=r[e];if(t.hasUserReadEvent(this.getUserId(),n.getId()))break;const o=this.getPushActionsForEvent(n);s+=o.tweaks&&o.tweaks.highlight?1:0}t.setUnreadNotificationCount(I.NotificationCountType.Highlight,s)}})),this.ignoredInvites=new Y.IgnoredInvites(this)}async startClient(e){if(this.clientRunning)return;this.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e});const t=this.getUserId();t&&this.store.storeUser(new x.User(t)),this.crypto&&(this.crypto.uploadDeviceKeys(),this.crypto.start()),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval((()=>{this.checkTurnServers()}),te),this.checkTurnServers()),this.syncApi&&(b.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop());try{const{serverSupport:e,stable:t}=await this.doesServerSupportThread();K.Thread.setServerSideSupport(e,t)}catch(e){K.Thread.setServerSideSupport(!1,!0)}this.clientOpts=Object.assign({},e),this.clientOpts.crypto=this.crypto,this.clientOpts.canResetEntireTimeline=e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e),this.clientOpts.slidingSync?this.syncApi=new V.SlidingSyncSdk(this.clientOpts.slidingSync,this,this.clientOpts):this.syncApi=new o.SyncApi(this,this.clientOpts),this.syncApi.sync(),void 0!==this.clientOpts.clientWellKnownPollPeriod&&(this.clientWellKnownIntervalID=setInterval((()=>{this.fetchClientWellKnown()}),1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown()),this.toDeviceMessageQueue.start()}stopClient(){var e,t,i,r;null===(e=this.crypto)||void 0===e||e.stop(),this.clientRunning&&(b.logger.log("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=null,null===(i=this.peekSync)||void 0===i||i.stopPeeking(),null===(r=this.callEventHandler)||void 0===r||r.stop(),this.callEventHandler=null,n.g.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=null,void 0!==this.clientWellKnownIntervalID&&n.g.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop())}async rehydrateDevice(){if(this.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this.cryptoCallbacks.getDehydrationKey)return;const e=await this.getDehydratedDevice();if(!e)return;if(!e.device_data||!e.device_id)return void b.logger.info("no dehydrated device found");const t=new n.g.Olm.Account;try{const n=e.device_data;if(n.algorithm!==A.DEHYDRATION_ALGORITHM)return void b.logger.warn("Wrong algorithm for dehydrated device");b.logger.log("unpickling dehydrated device");const i=await this.cryptoCallbacks.getDehydrationKey(n,(e=>{t.unpickle(new Uint8Array(e),n.account)}));if(t.unpickle(i,n.account),b.logger.log("unpickled device"),!0===(await this.http.authedRequest(void 0,S.Method.Post,"/dehydrated_device/claim",void 0,{device_id:e.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=e.device_id,b.logger.info("using dehydrated device");const n=this.pickleKey||"DEFAULT_KEY";return this.exportedOlmDeviceToImport={pickledAccount:t.pickle(n),sessions:[],pickleKey:n},t.free(),this.deviceId}return t.free(),void b.logger.info("not using dehydrated device")}catch(e){t.free(),b.logger.warn("could not unpickle",e)}}async getDehydratedDevice(){try{return await this.http.authedRequest(void 0,S.Method.Get,"/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){return void b.logger.info("could not get dehydrated device",e.toString())}}setDehydrationKey(e,t,n){if(this.crypto)return this.crypto.dehydrationManager.setKeyAndQueueDehydration(e,t,n);b.logger.warn("not dehydrating device if crypto is not enabled")}async createDehydratedDevice(e,t,n){if(this.crypto)return await this.crypto.dehydrationManager.setKey(e,t,n),this.crypto.dehydrationManager.dehydrateDevice();b.logger.warn("not dehydrating device if crypto is not enabled")}async exportDevice(){if(this.crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:await this.crypto.olmDevice.export()};b.logger.warn("not exporting device if crypto is not enabled")}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];return e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData()),Promise.all(e).then()}getUserId(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}getDomain(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}getDeviceId(){return this.deviceId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}createCall(e){return(0,c.createNewMatrixCall)(this,e)}getSyncState(){return this.syncApi?this.syncApi.getSyncState():null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const e=this.getSyncState();return!!e&&(e===o.SyncState.Prepared||e===o.SyncState.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){return this.toDeviceMessageQueue.sendQueue(),this.syncApi.retryImmediately()}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(e=!1){const t=(new Date).getTime();return this.cachedCapabilities&&!e&&t<this.cachedCapabilities.expiration?(b.logger.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(void 0,S.Method.Get,"/capabilities").catch((e=>{b.logger.error(e)})).then(((e={})=>{const n=e.capabilities||{},i=Object.keys(n).length?216e5:6e4+5e3*Math.random();return this.cachedCapabilities={capabilities:n,expiration:t+i},b.logger.log("Caching capabilities: ",n),n}))}async initCrypto(){if(!(0,_.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this.crypto)return void b.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");b.logger.log("Crypto: Starting up crypto store..."),await this.cryptoStore.startup(),b.logger.log("Crypto: initialising roomlist..."),await this.roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new _.Crypto(this,e,this.deviceId,this.store,this.cryptoStore,this.roomList,this.verificationMethods);this.reEmitter.reEmit(t,[_.CryptoEvent.KeyBackupFailed,_.CryptoEvent.KeyBackupSessionsRemaining,_.CryptoEvent.RoomKeyRequest,_.CryptoEvent.RoomKeyRequestCancellation,_.CryptoEvent.Warning,_.CryptoEvent.DevicesUpdated,_.CryptoEvent.WillUpdateDevices,_.CryptoEvent.DeviceVerificationChanged,_.CryptoEvent.UserTrustStatusChanged,_.CryptoEvent.KeysChanged]),b.logger.log("Crypto: initialising crypto object..."),await t.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this.exportedOlmDeviceToImport,this.olmVersion=_.Crypto.getOlmVersion(),t.registerEventHandlers(this),this.crypto=t}isCryptoEnabled(){return!!this.crypto}getDeviceEd25519Key(){return this.crypto?this.crypto.getDeviceEd25519Key():null}getDeviceCurve25519Key(){return this.crypto?this.crypto.getDeviceCurve25519Key():null}async uploadKeys(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.uploadDeviceKeys()}downloadKeys(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}getStoredDevice(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}setDeviceVerified(e,t,n=!0){const i=this.setDeviceVerification(e,t,n,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),i}setDeviceBlocked(e,t,n=!0){return this.setDeviceVerification(e,t,null,n,null)}setDeviceKnown(e,t,n=!0){return this.setDeviceVerification(e,t,null,null,n)}async setDeviceVerification(e,t,n,i,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.setDeviceVerification(e,t,n,i,r)}requestVerificationDM(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}findVerificationRequestDMInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}getVerificationRequestsToDeviceInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}requestVerification(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}beginKeyVerification(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,n)}checkSecretStorageKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(e,t)}setGlobalBlacklistUnverifiedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalBlacklistUnverifiedDevices(e)}getGlobalBlacklistUnverifiedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalBlacklistUnverifiedDevices()}setGlobalErrorOnUnknownDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalErrorOnUnknownDevices(e)}getGlobalErrorOnUnknownDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalErrorOnUnknownDevices()}getCrossSigningId(e=R.CrossSigningKey.Master){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}getStoredCrossSigningForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(e)}checkUserTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkUserTrust(e)}checkDeviceTrust(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,t)}checkIfOwnDeviceCrossSigned(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkIfOwnDeviceCrossSigned(e)}checkOwnCrossSigningTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(e)}checkCrossSigningPrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}legacyDeviceVerification(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,n)}prepareToEncrypt(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.prepareToEncrypt(e)}isCrossSigningReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}bootstrapCrossSigning(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(e)}getCryptoTrustCrossSignedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setCryptoTrustCrossSignedDevices(e)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getEventEncryptionInfo(e)}createRecoveryKeyFromPassphrase(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(e)}isSecretStorageReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}bootstrapSecretStorage(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(e)}addSecretStorageKey(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(e,t,n)}hasSecretStorageKey(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(e)}storeSecret(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(e,t,n)}getSecret(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(e)}isSecretStored(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(e)}requestSecret(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}getDefaultSecretStorageKeyId(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}setDefaultSecretStorageKeyId(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(e)}checkSecretStoragePrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}async getEventSenderDeviceInfo(e){return this.crypto?this.crypto.getEventSenderDeviceInfo(e):null}async isEventSenderVerified(e){const t=await this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()}cancelAndResendEventRoomKeyRequest(e){return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}isRoomEncrypted(e){const t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents(O.EventType.RoomEncryption,"")||this.roomList.isRoomEncrypted(e))}encryptAndSendToDevices(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.encryptAndSendToDevices(e,t)}forceDiscardSession(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(e)}exportRoomKeys(){return this.crypto?this.crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(e,t)}checkKeyBackup(){return this.crypto.backupManager.checkKeyBackup()}async getKeyBackupVersion(){let e;try{e=await this.http.authedRequest(void 0,S.Method.Get,"/room_keys/version",void 0,void 0,{prefix:S.PREFIX_UNSTABLE})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}return F.BackupManager.checkBackupVersion(e),e}isKeyBackupTrusted(e){return this.crypto.backupManager.isKeyBackupTrusted(e)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}enableKeyBackup(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}async prepareKeyBackupVersion(e,t={secureSecretStorage:!1}){if(!this.crypto)throw new Error("End-to-end encryption disabled");const{algorithm:n,auth_data:i,recovery_key:r,privateKey:s}=await this.crypto.backupManager.prepareKeyBackupVersion(e);return t.secureSecretStorage&&(await this.storeSecret("m.megolm_backup.v1",(0,f.encodeBase64)(s)),b.logger.info("Key backup private key stored in secret storage")),{algorithm:n,auth_data:i,recovery_key:r}}isKeyBackupKeyStored(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1"))}async createKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.createKeyBackupVersion(e);const t={algorithm:e.algorithm,auth_data:e.auth_data};await this.crypto.signObject(t.auth_data),this.cryptoCallbacks.getCrossSigningKey&&this.crypto.crossSigningInfo.getId()&&await this.crypto.crossSigningInfo.signObject(t.auth_data,"master");const n=await this.http.authedRequest(void 0,S.Method.Post,"/room_keys/version",void 0,t,{prefix:S.PREFIX_UNSTABLE});return await this.checkKeyBackup(),this.getKeyBackupEnabled()||b.logger.error("Key backup not usable even though we just created it"),n}deleteKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.version&&this.crypto.backupManager.disableKeyBackup();const t=u.encodeUri("/room_keys/version/$version",{$version:e});return this.http.authedRequest(void 0,S.Method.Delete,t,void 0,void 0,{prefix:S.PREFIX_UNSTABLE})}makeKeyBackupPath(e,t,n){let i;return i=void 0!==t?u.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?u.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",{path:i,queryData:void 0===n?void 0:{version:n}}}sendKeyBackup(e,t,n,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");const r=this.makeKeyBackupPath(e,t,n);return this.http.authedRequest(void 0,S.Method.Put,r.path,r.queryData,i,{prefix:S.PREFIX_UNSTABLE})}async scheduleAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.scheduleAllGroupSessionsForBackup()}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(e){try{return(0,E.decodeRecoveryKey)(e),!0}catch(e){return!1}}keyBackupKeyFromPassword(e,t){return(0,k.keyFromAuthData)(t.auth_data,e)}keyBackupKeyFromRecoveryKey(e){return(0,E.decodeRecoveryKey)(e)}async restoreKeyBackupWithPassword(e,t,n,i,r){const s=await(0,k.keyFromAuthData)(i.auth_data,e);return this.restoreKeyBackup(s,t,n,i,r)}async restoreKeyBackupWithSecretStorage(e,t,n,i){const r=await this.getSecret("m.megolm_backup.v1"),s=(0,_.fixBackupKey)(r);if(s){const[e]=await this.crypto.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",s,[e])}const o=(0,f.decodeBase64)(s||r);return this.restoreKeyBackup(o,t,n,e,i)}restoreKeyBackupWithRecoveryKey(e,t,n,i,r){const s=(0,E.decodeRecoveryKey)(e);return this.restoreKeyBackup(s,t,n,i,r)}async restoreKeyBackupWithCache(e,t,n,i){const r=await this.crypto.getSessionBackupPrivateKey();if(!r)throw new Error("Couldn't get key");return this.restoreKeyBackup(r,e,t,n,i)}async restoreKeyBackup(e,t,n,i,r){const s=null==r?void 0:r.cacheCompleteCallback,o=null==r?void 0:r.progressCallback;if(!this.crypto)throw new Error("End-to-end encryption disabled");let a=0,l=[];const c=this.makeKeyBackupPath(t,n,i.version),d=await F.BackupManager.makeAlgorithm(i,(async()=>e)),h=d.untrusted;try{if(!await d.keyMatches(e))return Promise.reject(new S.MatrixError({errcode:ce.RESTORE_BACKUP_ERROR_BAD_KEY}));this.crypto.storeSessionBackupPrivateKey(e).catch((e=>{b.logger.warn("Error caching session backup key:",e)})).then(s),o&&o({stage:"fetch"});const i=await this.http.authedRequest(void 0,S.Method.Get,c.path,c.queryData,void 0,{prefix:S.PREFIX_UNSTABLE});if(i.rooms){const e=i.rooms;for(const[t,n]of Object.entries(e)){if(!n.sessions)continue;a+=Object.keys(n.sessions).length;const e=await d.decryptSessions(n.sessions);for(const n of e)n.room_id=t,l.push(n)}}else if(i.sessions){const e=i.sessions;a=Object.keys(e).length,l=await d.decryptSessions(e);for(const e of l)e.room_id=t}else{a=1;try{const[e]=await d.decryptSessions({[n]:i});e.room_id=t,e.session_id=n,l.push(e)}catch(e){b.logger.log("Failed to decrypt megolm session from backup",e)}}}finally{d.free()}return await this.importRoomKeys(l,{progressCallback:o,untrusted:h,source:"backup"}),await this.checkKeyBackup(),{total:a,imported:l.length}}deleteKeysFromBackup(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");const i=this.makeKeyBackupPath(e,t,n);return this.http.authedRequest(void 0,S.Method.Delete,i.path,i.queryData,void 0,{prefix:S.PREFIX_UNSTABLE})}async sendSharedHistoryKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");const n=this.roomList.getRoomEncryption(e);if(!n)return void b.logger.error("Unknown room.  Not sharing decryption keys");const i=await this.crypto.downloadKeys(t),r={};for(const[e,t]of Object.entries(i))r[e]=Object.values(t);const s=this.crypto.getRoomDecryptor(e,n.algorithm);s.sendSharedHistoryInboundSessions?await s.sendSharedHistoryInboundSessions(r):b.logger.warn("Algorithm does not support sharing previous keys",n.algorithm)}getMediaConfig(e){return this.http.authedRequest(e,S.Method.Get,"/config",void 0,void 0,{prefix:S.PREFIX_MEDIA_R0})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){const e=this.store.getRooms(),t=new Set;for(const n of e){const e=n.currentState.getStateEvents(O.EventType.RoomCreate,"");if(e){const n=e.getContent().predecessor;n&&n.room_id&&t.add(n.room_id)}}return e.filter((e=>!e.currentState.getStateEvents(O.EventType.RoomTombstone,"")||!t.has(e.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t,n){const i=u.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),r=(0,S.retryNetworkOperation)(5,(()=>this.http.authedRequest(void 0,S.Method.Put,i,void 0,t)));return n&&r.then((e=>n(null,e)),n),r}getAccountData(e){return this.store.getAccountData(e)}async getAccountDataFromServer(e){if(this.isInitialSyncComplete()){const t=this.store.getAccountData(e);return t?t.getContent():null}const t=u.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this.http.authedRequest(void 0,S.Method.Get,t)}catch(e){var n;if("M_NOT_FOUND"===(null===(n=e.data)||void 0===n?void 0:n.errcode))return null;throw e}}getIgnoredUsers(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e,t){const n={ignored_users:{}};return e.forEach((e=>{n.ignored_users[e]={}})),this.setAccountData("m.ignored_user_list",n,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}async joinRoom(e,t,n){if(u.isFunction(t))throw new Error("Expected 'opts' object, got function.");void 0===(t=t||{}).syncRoom&&(t.syncRoom=!0);const i=this.getRoom(e);if(i&&i.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(i);let r=Promise.resolve();t.inviteSignUrl&&(r=this.http.requestOtherUrl(void 0,S.Method.Post,t.inviteSignUrl,{mxid:this.credentials.userId}));const s={};t.viaServers&&(s.server_name=t.viaServers);const a={qsStringifyOptions:{arrayFormat:"repeat"}};try{const i={},l=await r;l&&(i.third_party_signed=l);const c=u.encodeUri("/join/$roomid",{$roomid:e}),d=(await this.http.authedRequest(void 0,S.Method.Post,c,s,i,a)).room_id,h=new o.SyncApi(this,this.clientOpts).createRoom(d);return t.syncRoom,null==n||n(null,h),h}catch(e){throw null==n||n(e),e}}resendEvent(e,t){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(t,e,a.EventStatus.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if(![a.EventStatus.QUEUED,a.EventStatus.NOT_SENT,a.EventStatus.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===a.EventStatus.ENCRYPTING?this.pendingEventEncryption.delete(e.getId()):this.scheduler&&e.status===a.EventStatus.QUEUED&&this.scheduler.removeEventFromQueue(e);const t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,a.EventStatus.CANCELLED)}setRoomName(e,t,n){return this.sendStateEvent(e,O.EventType.RoomName,{name:t},void 0,n)}setRoomTopic(e,t,n){const i="function"==typeof n,r=i?void 0:n,s=i?n:void 0,o=P.makeTopicContent(t,r);return this.sendStateEvent(e,O.EventType.RoomTopic,o,void 0,s)}getRoomTags(e,t){const n=u.encodeUri("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(t,S.Method.Get,n)}setRoomTag(e,t,n,i){const r=u.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(i,S.Method.Put,r,void 0,n)}deleteRoomTag(e,t,n){const i=u.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(n,S.Method.Delete,i)}setRoomAccountData(e,t,n,i){const r=u.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(i,S.Method.Put,r,void 0,n)}setPowerLevel(e,t,n,i,r){let s={users:{}};(null==i?void 0:i.getType())===O.EventType.RoomPowerLevels&&(s=u.deepCopy(i.getContent())),s.users[t]=n;const o=u.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this.http.authedRequest(r,S.Method.Put,o,void 0,s)}async unstable_createLiveBeacon(e,t){return this.unstable_setLiveBeacon(e,t)}async unstable_setLiveBeacon(e,t){const n=this.getUserId();return this.sendStateEvent(e,H.M_BEACON_INFO.name,t,n)}sendEvent(e,t,n,i,r,s){var o,a;if(null!==(o=t)&&void 0!==o&&o.startsWith(oe)||null===t||(s=r,r=i,i=n,n=t,t=null),t&&(null===(a=i["m.relates_to"])||void 0===a||!a.rel_type)){var l,c;const n=!(null===(l=i["m.relates_to"])||void 0===l||!l["m.in_reply_to"]);i["m.relates_to"]=Q(Q({},i["m.relates_to"]),{},{rel_type:K.THREAD_RELATION_TYPE.name,event_id:t,is_falling_back:!n});const r=null===(c=this.getRoom(e))||void 0===c?void 0:c.getThread(t);var d,h;r&&!n&&(i["m.relates_to"]["m.in_reply_to"]={event_id:null!==(d=null===(h=r.lastReply((e=>e.isRelation(K.THREAD_RELATION_TYPE.name)&&!e.status)))||void 0===h?void 0:h.getId())&&void 0!==d?d:t})}return this.sendCompleteEvent(e,t,{type:n,content:i},r,s)}sendCompleteEvent(e,t,n,i,r){u.isFunction(i)&&(r=i,i=void 0),i||(i=this.makeTxnId());const s=new a.MatrixEvent(Object.assign(n,{event_id:"~"+e+":"+i,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),o=this.getRoom(e),l=null==o?void 0:o.getThread(t);l&&s.setThread(l),this.reEmitter.reEmit(s,[a.MatrixEventEvent.Replaced,a.MatrixEventEvent.VisibilityChange]),null==o||o.reEmitter.reEmit(s,[a.MatrixEventEvent.BeforeRedaction]);const c=s.getAssociatedId();if(null!=c&&c.startsWith("~")){const e=o.getPendingEvents().find((e=>e.getId()===c));e.once(a.MatrixEventEvent.LocalEventIdReplaced,(()=>{s.updateAssociatedId(e.getId())}))}const d=s.getType();return b.logger.log(`sendEvent of type ${d} in ${e} with txnId ${i}`),s.setTxnId(i),s.setStatus(a.EventStatus.SENDING),null==o||o.addPendingEvent(s,i),s.status===a.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(o,s,r)}encryptAndSendEvent(e,t,n){let i=!1;return Promise.resolve().then((()=>{const n=this.encryptEventIfNeeded(t,e);return n?(this.pendingEventEncryption.set(t.getId(),n),this.updatePendingEventStatus(e,t,a.EventStatus.ENCRYPTING),n.then((()=>{this.pendingEventEncryption.has(t.getId())?this.updatePendingEventStatus(e,t,a.EventStatus.SENDING):i=!0}))):null})).then((()=>{if(i)return{};let n;return this.scheduler&&(n=this.scheduler.queueEvent(t),n&&this.scheduler.getQueueForEvent(t).length>1&&this.updatePendingEventStatus(e,t,a.EventStatus.QUEUED)),n||(n=this.sendEventHttpRequest(t),e&&(n=n.then((n=>(e.updatePendingEvent(t,a.EventStatus.SENT,n.event_id),n))))),n})).then((e=>(null==n||n(null,e),e))).catch((i=>{b.logger.error("Error sending event",i.stack||i);try{t.error=i,this.updatePendingEventStatus(e,t,a.EventStatus.NOT_SENT),i.event=t,null==n||n(i)}catch(e){b.logger.error("Exception in error handler!",e.stack||i)}throw i}))}encryptEventIfNeeded(e,t){if(e.isEncrypted())return null;if(e.isRedaction())return null;if(!this.isRoomEncrypted(e.getRoomId()))return null;if(!this.crypto&&this.usingExternalCrypto)return null;if(e.getType()===O.EventType.Reaction)return null;if(!this.crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.crypto.encryptEvent(e,t)}getEncryptedIfNeededEventType(e,t){return t===O.EventType.Reaction?t:this.isRoomEncrypted(e)?O.EventType.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}sendEventHttpRequest(e){let t=e.getTxnId();t||(t=this.makeTxnId(),e.setTxnId(t));const n={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:t};let i;if(e.isState()){let t="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(t="/rooms/$roomId/state/$eventType/$stateKey"),i=u.encodeUri(t,n)}else if(e.isRedaction()){const t="/rooms/$roomId/redact/$redactsEventId/$txnId";i=u.encodeUri(t,Object.assign({$redactsEventId:e.event.redacts},n))}else i=u.encodeUri("/rooms/$roomId/send/$eventType/$txnId",n);return this.http.authedRequest(void 0,S.Method.Put,i,void 0,e.getWireContent()).then((t=>(b.logger.log(`Event sent to ${e.getRoomId()} with event id ${t.event_id}`),t)))}redactEvent(e,t,n,i,r){var s;null!==(s=n)&&void 0!==s&&s.startsWith(oe)||(r=i,i=n,n=t,t=null);const o=("object"==typeof r?r:{}).reason,a="function"==typeof r?r:void 0;return this.sendCompleteEvent(e,t,{type:O.EventType.RoomRedaction,content:{reason:o},redacts:n},i,a)}sendMessage(e,t,n,i,r){"string"!=typeof t&&null!==t&&(r=i,i=n,n=t,t=null),u.isFunction(i)&&(r=i,i=void 0);let o=O.EventType.RoomMessage,a=n;const l=(e={},t=!0)=>{let n=null;if(e.msgtype===O.MsgType.Text?n=s.MessageEvent.from(e.body,e.formatted_body).serialize():e.msgtype===O.MsgType.Emote?n=s.EmoteEvent.from(e.body,e.formatted_body).serialize():e.msgtype===O.MsgType.Notice&&(n=s.NoticeEvent.from(e.body,e.formatted_body).serialize()),n&&e["m.new_content"]&&t){const t=l(e["m.new_content"],!1);t&&(n.content["m.new_content"]=t.content)}if(n)for(const[t,i]of Object.entries(e))n.content.hasOwnProperty(t)||(n.content[t]=i);return n},c=l(a);return c&&(o=c.type,a=c.content),this.sendEvent(e,t,o,a,i,r)}sendTextMessage(e,t,n,i,r){var s;null!==(s=t)&&void 0!==s&&s.startsWith(oe)||null===t||(r=i,i=n,n=t,t=null);const o=P.makeTextMessage(n);return this.sendMessage(e,t,o,i,r)}sendNotice(e,t,n,i,r){var s;null!==(s=t)&&void 0!==s&&s.startsWith(oe)||null===t||(r=i,i=n,n=t,t=null);const o=P.makeNotice(n);return this.sendMessage(e,t,o,i,r)}sendEmoteMessage(e,t,n,i,r){var s;null!==(s=t)&&void 0!==s&&s.startsWith(oe)||null===t||(r=i,i=n,n=t,t=null);const o=P.makeEmoteMessage(n);return this.sendMessage(e,t,o,i,r)}sendImageMessage(e,t,n,i,r="Image",s){var o;null!==(o=t)&&void 0!==o&&o.startsWith(oe)||null===t||(s=r,r=i||"Image",i=n,n=t,t=null),u.isFunction(r)&&(s=r,r=void 0);const a={msgtype:O.MsgType.Image,url:n,info:i,body:r};return this.sendMessage(e,t,a,void 0,s)}sendStickerMessage(e,t,n,i,r="Sticker",s){var o;null!==(o=t)&&void 0!==o&&o.startsWith(oe)||null===t||(s=r,r=i||"Sticker",i=n,n=t,t=null),u.isFunction(r)&&(s=r,r=void 0);const a={url:n,info:i,body:r};return this.sendEvent(e,t,O.EventType.Sticker,a,void 0,s)}sendHtmlMessage(e,t,n,i,r){var s;null!==(s=t)&&void 0!==s&&s.startsWith(oe)||null===t||(r=i,i=n,n=t,t=null);const o=P.makeHtmlMessage(n,i);return this.sendMessage(e,t,o,void 0,r)}sendHtmlNotice(e,t,n,i,r){var s;null!==(s=t)&&void 0!==s&&s.startsWith(oe)||null===t||(r=i,i=n,n=t,t=null);const o=P.makeHtmlNotice(n,i);return this.sendMessage(e,t,o,void 0,r)}sendHtmlEmote(e,t,n,i,r){var s;null!==(s=t)&&void 0!==s&&s.startsWith(oe)||null===t||(r=i,i=n,n=t,t=null);const o=P.makeHtmlEmote(n,i);return this.sendMessage(e,t,o,void 0,r)}async sendReceipt(e,t,n,i){if("function"==typeof n&&(i=n,n={}),this.isGuest())return Promise.resolve({});const r=u.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()});if(await this.doesServerSupportUnstableFeature("org.matrix.msc3771")){const t=!!e.threadRootId;n.thread_id=t?e.threadRootId:G.MAIN_ROOM_TIMELINE}const s=this.http.authedRequest(i,S.Method.Post,r,void 0,n||{}),o=this.getRoom(e.getRoomId());return o&&this.credentials.userId&&o.addLocalEchoReceipt(this.credentials.userId,e,t),s}async sendReadReceipt(e,t=z.ReceiptType.Read,n){if(!e)return;const i=e.getId(),r=this.getRoom(e.getRoomId());if(r&&r.hasPendingEvent(i))throw new Error(`Cannot set read receipt to a pending event (${i})`);return this.sendReceipt(e,t,{},n)}async setRoomReadMarkers(e,t,n,i){const r=this.getRoom(e);if(r&&r.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let s,o;if(n){if(s=n.getId(),null!=r&&r.hasPendingEvent(s))throw new Error(`Cannot set read receipt to a pending event (${s})`);null==r||r.addLocalEchoReceipt(this.credentials.userId,n,z.ReceiptType.Read)}if(i){if(o=i.getId(),null!=r&&r.hasPendingEvent(o))throw new Error(`Cannot set read receipt to a pending event (${o})`);null==r||r.addLocalEchoReceipt(this.credentials.userId,i,z.ReceiptType.ReadPrivate)}return await this.setRoomReadMarkersHttpRequest(e,t,s,o)}getUrlPreview(e,t,n){t=6e4*Math.floor(t/6e4);const i=new URL(e);i.hash="";const r=t+"_"+(e=i.toString()),s=this.urlPreviewCache[r];if(s)return n&&s.then(n).catch(n),s;const o=this.http.authedRequest(n,S.Method.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:S.PREFIX_MEDIA_R0});return this.urlPreviewCache[r]=o,o}sendTyping(e,t,n,i){if(this.isGuest())return Promise.resolve({});const r=u.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),s={typing:t};return t&&(s.timeout=n||2e4),this.http.authedRequest(i,S.Method.Put,r,void 0,s)}getRoomUpgradeHistory(e,t=!1){let n=this.getRoom(e);if(!n)return[];const i=[n];let r=n.currentState.getStateEvents(O.EventType.RoomCreate,"");for(;r;){const e=r.getContent().predecessor;if(!e||!e.room_id)break;{const n=this.getRoom(e.room_id);if(!n)break;if(t){const e=n.currentState.getStateEvents(O.EventType.RoomTombstone,"");if(!e||e.getContent().replacement_room!==n.roomId)break}i.splice(0,0,n),r=n.currentState.getStateEvents(O.EventType.RoomCreate,"")}}let s=n.currentState.getStateEvents(O.EventType.RoomTombstone,"");for(;s;){const e=this.getRoom(s.getContent().replacement_room);if(!e)break;if(e.roomId===n.roomId)break;if(t){if(r=e.currentState.getStateEvents(O.EventType.RoomCreate,""),!r||!r.getContent().predecessor)break;if(r.getContent().predecessor.room_id!==n.roomId)break}if(i.push(e),new Set(i.map((e=>e.roomId))).size<i.length)return i.slice(0,i.length-1);n=e,s=n.currentState.getStateEvents(O.EventType.RoomTombstone,"")}return i}invite(e,t,n,i){return this.membershipChange(e,t,"invite",i,n)}inviteByEmail(e,t,n){return this.inviteByThreePid(e,"email",t,n)}async inviteByThreePid(e,t,n,i){var r;const s=u.encodeUri("/rooms/$roomId/invite",{$roomId:e}),o=this.getIdentityServerUrl(!0);if(!o)return Promise.reject(new S.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const a={id_server:o,medium:t,address:n};if(null!==(r=this.identityServer)&&void 0!==r&&r.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(a.id_access_token=e)}return this.http.authedRequest(i,S.Method.Post,s,void 0,a)}leave(e,t){return this.membershipChange(e,void 0,"leave",void 0,t)}leaveRoomChain(e,t=!0){const n=this.getRoomUpgradeHistory(e);let i=n;if(!t){i=[];for(const t of n)if(i.push(t),t.roomId===e)break}const r={},s=[],o=e=>this.leave(e).then((()=>{r[e]=null})).catch((t=>(r[e]=t,null)));for(const e of i)s.push(o(e.roomId));return Promise.all(s).then((()=>r))}ban(e,t,n,i){return this.membershipChange(e,t,"ban",n,i)}forget(e,t,n){void 0===t&&(t=!0);const i=this.membershipChange(e,void 0,"forget",void 0,n);return t?i.then((t=>(this.store.removeRoom(e),this.emit(ae.DeleteRoom,e),t))):i}unban(e,t,n){const i=u.encodeUri("/rooms/$roomId/unban",{$roomId:e}),r={user_id:t};return this.http.authedRequest(n,S.Method.Post,i,void 0,r)}kick(e,t,n,i){const r=u.encodeUri("/rooms/$roomId/kick",{$roomId:e}),s={user_id:t,reason:n};return this.http.authedRequest(i,S.Method.Post,r,void 0,s)}membershipChange(e,t,n,i,r){u.isFunction(i)&&(r=i,i=void 0);const s=u.encodeUri("/rooms/$room_id/$membership",{$room_id:e,$membership:n});return this.http.authedRequest(r,S.Method.Post,s,void 0,{user_id:t,reason:i})}getPushActionsForEvent(e,t=!1){return e.getPushActions()&&!t||e.setPushActions(this.pushProcessor.actionsForEvent(e)),e.getPushActions()}setProfileInfo(e,t,n){const i=u.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(n,S.Method.Put,i,void 0,t)}async setDisplayName(e,t){const n=await this.setProfileInfo("displayname",{displayname:e},t),i=this.getUser(this.getUserId());return i&&(i.displayName=e,i.emit(x.UserEvent.DisplayName,i.events.presence,i)),n}async setAvatarUrl(e,t){const n=await this.setProfileInfo("avatar_url",{avatar_url:e},t),i=this.getUser(this.getUserId());return i&&(i.avatarUrl=e,i.emit(x.UserEvent.AvatarUrl,i.events.presence,i)),n}mxcUrlToHttp(e,t,n,i,r){return(0,T.getHttpUriForMxc)(this.baseUrl,e,t,n,i,r)}setPresence(e,t){const n=u.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});if("string"==typeof e&&(e={presence:e}),-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this.http.authedRequest(t,S.Method.Put,n,void 0,e)}getPresence(e,t){const n=u.encodeUri("/presence/$userId/status",{$userId:e});return this.http.authedRequest(t,S.Method.Get,n)}scrollback(e,t=30,n){u.isFunction(t)&&(n=t,t=void 0);let i=0,r=this.ongoingScrollbacks[e.roomId]||{};if(r.promise)return r.promise;if(r.errorTs){const e=Date.now()-r.errorTs;i=Math.max(3e3-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const s=this.store.scrollback(e,t).length;if(s===t)return Promise.resolve(e);t-=s;const o=new Promise(((r,s)=>{(0,u.sleep)(i).then((()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,p.Direction.Backward))).then((t=>{var i;const s=t.chunk.map(this.getEventMapper());if(t.state){const n=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(n)}const[o,a]=e.partitionThreadedEvents(s);this.processBeaconEvents(e,o),e.addEventsToTimeline(o,!0,e.getLiveTimeline()),this.processThreadEvents(e,a,!0),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,s,t.end,!0),this.ongoingScrollbacks[e.roomId]=null,null===(i=n)||void 0===i||i(null,e),r(e)})).catch((t=>{var i;this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},null===(i=n)||void 0===i||i(t),s(t)}))}));return r={promise:o,errorTs:null},this.ongoingScrollbacks[e.roomId]=r,o}getEventMapper(e){return(0,D.eventMapperFor)(this,e||{})}async getEventTimeline(e,t){var n,i,r;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);const s=u.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let o;this.clientOpts.lazyLoadMembers&&(o={filter:JSON.stringify(d.Filter.LAZY_LOADING_MESSAGES_FILTER)});const a=await this.http.authedRequest(void 0,S.Method.Get,s,o);if(!a.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);const l=this.getEventMapper(),c=l(a.event),h=[...a.events_after.reverse().map(l),c,...a.events_before.map(l)];if(this.supportsExperimentalThreads()){if(!e.canContain(c))return;if(K.Thread.hasServerSideSupport&&e.thread){const n=e.thread,i={direction:p.Direction.Backward,limit:50};await n.fetchInitialEvents();let r=n.liveTimeline.getPaginationToken(p.Direction.Backward);for(;!n.findEventById(t)&&(r&&(i.from=r),({nextBatch:r}=await n.fetchEvents(i)),r););return n.liveTimeline}}let m=e.getTimelineForEvent(h[0].getId());m?m.getState(p.EventTimeline.BACKWARDS).setUnknownStateEvents(a.state.map(l)):(m=e.addTimeline(),m.initialiseState(a.state.map(l)),m.getState(p.EventTimeline.FORWARDS).paginationToken=a.end);const[g,f]=e.room.partitionThreadedEvents(h);return e.addEventsToTimeline(g,!0,m,a.start),this.processThreadEvents(e.room,f,!0),this.processBeaconEvents(e.room,g),null!==(n=null!==(i=e.getTimelineForEvent(t))&&void 0!==i?i:null===(r=e.room.findThreadForEvent(c))||void 0===r?void 0:r.liveTimeline)&&void 0!==n?n:m}async getLatestTimeline(e){var t;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const n=u.encodeUri("/rooms/$roomId/messages",{$roomId:e.room.roomId}),i={dir:"b"};this.clientOpts.lazyLoadMembers&&(i.filter=JSON.stringify(d.Filter.LAZY_LOADING_MESSAGES_FILTER));const r=null===(t=(await this.http.authedRequest(void 0,S.Method.Get,n,i)).chunk)||void 0===t?void 0:t[0];if(!r)throw new Error("No message returned from /messages when trying to construct getLatestTimeline");return this.getEventTimeline(e,r.event_id)}createMessagesRequest(e,t,n=30,i,r){const s=u.encodeUri("/rooms/$roomId/messages",{$roomId:e}),o={limit:n.toString(),dir:i};t&&(o.from=t);let a=null;var l;return this.clientOpts.lazyLoadMembers&&(a=Object.assign({},d.Filter.LAZY_LOADING_MESSAGES_FILTER)),r&&(a=a||{},Object.assign(a,null===(l=r.getRoomTimelineFilterComponent())||void 0===l?void 0:l.toJSON())),a&&(o.filter=JSON.stringify(a)),this.http.authedRequest(void 0,S.Method.Get,s,o)}paginateEventTimeline(e,t){const n=e.getTimelineSet()===this.notifTimelineSet,i=(t=t||{}).backwards||!1;if(n&&!i)throw new Error("paginateNotifTimeline can only paginate backwards");const r=i?p.EventTimeline.BACKWARDS:p.EventTimeline.FORWARDS,s=e.getPaginationToken(r),o=e.paginationRequests[r];if(o)return o;let a,l,c;if(n){var d;a="/notifications",l={limit:(null!==(d=t.limit)&&void 0!==d?d:30).toString(),only:"highlight"},"end"!==s&&(l.from=s),c=this.http.authedRequest(void 0,S.Method.Get,"/notifications",l).then((async t=>{const n=t.next_token,s=[];for(let e=0;e<t.notifications.length;e++){const n=t.notifications[e],i=this.getEventMapper()(n.event);i.setPushActions(m.PushProcessor.actionListToActionsObject(n.actions)),i.event.room_id=n.room_id,s[e]=i}const o=e.getTimelineSet();return o.addEventsToTimeline(s,i,e,n),this.processBeaconEvents(o.room,s),i&&!t.next_token&&e.setPaginationToken(null,r),!!t.next_token})).finally((()=>{e.paginationRequests[r]=null})),e.paginationRequests[r]=c}else{const n=this.getRoom(e.getRoomId());if(!n)throw new Error("Unknown room "+e.getRoomId());c=this.createMessagesRequest(e.getRoomId(),s,t.limit,r,e.getFilter()).then((t=>{if(t.state){const n=e.getState(r),i=t.state.map(this.getEventMapper());n.setUnknownStateEvents(i)}const s=t.end,o=t.chunk.map(this.getEventMapper()),a=e.getTimelineSet(),[l,c]=a.room.partitionThreadedEvents(o);a.addEventsToTimeline(l,i,e,s),this.processBeaconEvents(a.room,l),this.processThreadEvents(n,c,i);const d=void 0===t.end||t.end===t.start;return i&&d&&e.setPaginationToken(null,r),!d})).finally((()=>{e.paginationRequests[r]=null})),e.paginationRequests[r]=c}return c}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end",null)}peekInRoom(e){return this.peekSync&&this.peekSync.stopPeeking(),this.peekSync=new o.SyncApi(this,this.clientOpts),this.peekSync.peek(e)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){const n=this.sendStateEvent(e,O.EventType.RoomGuestAccess,{guest_access:t.allowJoin?"can_join":"forbidden"},"");let i=Promise.resolve(void 0);return t.allowRead&&(i=this.sendStateEvent(e,O.EventType.RoomHistoryVisibility,{history_visibility:"world_readable"},"")),Promise.all([i,n]).then()}requestRegisterEmailToken(e,t,n,i){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:i})}requestRegisterMsisdnToken(e,t,n,i,r){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:i,next_link:r})}requestAdd3pidEmailToken(e,t,n,i){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:i})}requestAdd3pidMsisdnToken(e,t,n,i,r){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:i,next_link:r})}requestPasswordEmailToken(e,t,n,i){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:i})}requestPasswordMsisdnToken(e,t,n,i,r){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:i,next_link:r})}async requestTokenFromEndpoint(e,t){const n=Object.assign({},t);if(!await this.doesServerSupportSeparateAddAndBind()&&this.idBaseUrl){var i;const e=new URL(this.idBaseUrl);if(n.id_server=e.host,null!==(i=this.identityServer)&&void 0!==i&&i.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(n.id_access_token=e)}}return this.http.request(void 0,S.Method.Post,e,void 0,n)}getRoomPushRule(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");if(this.pushRules[e]&&this.pushRules[e].room)for(let n=0;n<this.pushRules[e].room.length;n++){const i=this.pushRules[e].room[n];if(i.rule_id===t)return i}}setRoomMutePushRule(e,t,n){let i,r=!1;const s=this.getRoomPushRule(e,t);if(null!=s&&s.actions.includes(I.PushRuleActionName.DontNotify)&&(r=!0),n)if(s){if(!r){const n=u.defer();this.deletePushRule(e,B.PushRuleKind.RoomSpecific,s.rule_id).then((()=>{this.addPushRule(e,B.PushRuleKind.RoomSpecific,t,{actions:[I.PushRuleActionName.DontNotify]}).then((()=>{n.resolve()})).catch((e=>{n.reject(e)}))})).catch((e=>{n.reject(e)})),i=n.promise}}else i=this.addPushRule(e,B.PushRuleKind.RoomSpecific,t,{actions:[I.PushRuleActionName.DontNotify]});else r&&(i=this.deletePushRule(e,B.PushRuleKind.RoomSpecific,s.rule_id));if(i)return new Promise(((e,t)=>{i.then((()=>{this.getPushRules().then((t=>{this.pushRules=t,e()})).catch((e=>{t(e)}))})).catch((e=>{this.getPushRules().then((n=>{this.pushRules=n,t(e)})).catch((n=>{t(e)}))}))}))}searchMessageText(e,t){const n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}},t)}searchRoomEvents(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:j.SearchOrderBy.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then((e=>this.processRoomEventsSearch(n,e)))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},n=this.search(t).then((t=>this.processRoomEventsSearch(e,t))).finally((()=>{e.pendingRequest=null}));return e.pendingRequest=n,n}processRoomEventsSearch(e,t){var n,i;const r=t.search_categories.room_events;e.count=r.count,e.next_batch=r.next_batch;const s=new Set(r.highlights);e.highlights.forEach((e=>{s.add(e)})),e.highlights=Array.from(s);const o=this.getEventMapper(),a=null!==(n=null===(i=r.results)||void 0===i?void 0:i.length)&&void 0!==n?n:0;for(let t=0;t<a;t++){const n=C.SearchResult.fromJson(r.results[t],o),i=this.getRoom(n.context.getEvent().getRoomId());if(i)for(const e of n.context.getTimeline()){const t=i.getMember(e.getSender());!e.sender&&t&&(e.sender=t)}e.results.push(n)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const e=new o.SyncApi(this,this.clientOpts);return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then((()=>{b.logger.log("Marking success of sync left room request"),this.syncedLeftRooms=!0})).finally((()=>{this.syncLeftRoomsPromise=null})),this.syncLeftRoomsPromise}createFilter(e){const t=u.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,S.Method.Post,t,void 0,e).then((t=>{const n=d.Filter.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(n),n}))}getFilter(e,t,n){if(n){const n=this.store.getFilter(e,t);if(n)return Promise.resolve(n)}const i=u.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(void 0,S.Method.Get,i).then((n=>{const i=d.Filter.fromJson(e,t,n);return this.store.storeFilter(i),i}))}async getOrCreateFilter(e,t){const n=this.store.getFilterIdByName(e);let i;if(n){try{const e=await this.getFilter(this.credentials.userId,n,!0);if(e){const r=e.getDefinition(),s=t.getDefinition();u.deepCompare(r,s)&&(i=n)}}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}i||this.store.setFilterIdByName(e,void 0)}if(i)return i;const r=await this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,r.filterId),r.filterId}getOpenIdToken(){const e=u.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,S.Method.Post,e,void 0,{})}turnServer(e){return this.http.authedRequest(e,S.Method.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return null!==this.checkTurnServersIntervalID}async checkTurnServers(){if(!this.canSupportVoip)return;let e=!1;const t=this.turnServersExpiry-Date.now();if(t>te)b.logger.debug("TURN creds are valid for another "+t+" ms: not fetching new ones."),e=!0;else{b.logger.debug("Fetching new TURN credentials");try{const t=await this.turnServer();if(t.uris){b.logger.log("Got TURN URIs: "+t.uris+" refresh in "+t.ttl+" secs");const n={urls:t.uris,username:t.username,credential:t.password};this.turnServers=[n],this.turnServersExpiry=Date.now()+1e3*t.ttl,e=!0,this.emit(ae.TurnServers,this.turnServers)}}catch(e){b.logger.error("Failed to get TURN URIs",e),403===e.httpStatus?(b.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this.checkTurnServersIntervalID&&n.g.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=null,this.emit(ae.TurnServersError,e,!0)):this.emit(ae.TurnServersError,e,!1)}}return e}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const e=u.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(void 0,S.Method.Get,e,void 0,void 0,{prefix:""}).then((e=>e.admin))}whoisSynapseUser(e){const t=u.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(void 0,S.Method.Get,t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){const t=u.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(void 0,S.Method.Post,t,void 0,void 0,{prefix:""})}async fetchClientWellKnown(){this.clientWellKnownPromise=g.AutoDiscovery.getRawClientConfig(this.getDomain()),this.clientWellKnown=await this.clientWellKnownPromise,this.emit(ae.ClientWellKnown,this.clientWellKnown)}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){return this.clientWellKnownPromise}storeClientOptions(){const e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((([t,n])=>e.includes(typeof n))).reduce(((e,[t,n])=>(e[t]=n,e)),{});return this.store.storeClientOptions(t)}async _unstable_getSharedRooms(e){const t=await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666"),n=await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666.mutual_rooms");if(!t&&!n)throw Error("Server does not support mutual_rooms API");const i=u.encodeUri(`/uk.half-shot.msc2666/user/${n?"mutual_rooms":"shared_rooms"}/$userId`,{$userId:e});return(await this.http.authedRequest(void 0,S.Method.Get,i,void 0,void 0,{prefix:S.PREFIX_UNSTABLE})).joined}getVersions(){return this.serverVersionsPromise||(this.serverVersionsPromise=this.http.request(void 0,S.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((e=>{throw this.serverVersionsPromise=null,e}))),this.serverVersionsPromise}async isVersionSupported(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)}async doesServerSupportLazyLoading(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,n=e.unstable_features;return t&&t.includes("r0.5.0")||n&&n["m.lazy_load_members"]}async doesServerRequireIdServerParam(){const e=await this.getVersions();if(!e)return!0;const t=e.versions;if(t&&t.includes("r0.6.0"))return!1;const n=e.unstable_features;return!n||void 0===n["m.require_identity_server"]||n["m.require_identity_server"]}async doesServerAcceptIdentityAccessToken(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,n=e.unstable_features;return t&&t.includes("r0.6.0")||n&&n["m.id_access_token"]}async doesServerSupportSeparateAddAndBind(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,n=e.unstable_features;return(null==t?void 0:t.includes("r0.6.0"))||(null==n?void 0:n["m.separate_add_and_bind"])}async doesServerSupportUnstableFeature(e){const t=await this.getVersions();if(!t)return!1;const n=t.unstable_features;return n&&!!n[e]}async doesServerForceEncryptionForPreset(e){const t=await this.getVersions();if(!t)return!1;const n=t.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return n&&!!n[`io.element.e2ee_forced.${i}`]}async doesServerSupportThread(){try{const e=await this.doesServerSupportUnstableFeature("org.matrix.msc3440"),t=await this.doesServerSupportUnstableFeature("org.matrix.msc3440.stable");return{serverSupport:e||t,stable:t}}catch(e){return null}}doesServerSupportLogoutDevices(){return this.isVersionSupported("r0.6.1")}hasLazyLoadMembersEnabled(){return!!this.clientOpts.lazyLoadMembers}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}async relations(e,t,n,i,r={direction:p.Direction.Backward}){const s=this.getEncryptedIfNeededEventType(e,i),o=await this.fetchRelations(e,t,n,s,r),a=this.getEventMapper(),l=o.original_event?a(o.original_event):void 0;let c=o.chunk.map(a);if(s===O.EventType.RoomMessageEncrypted){const e=l?c.concat(l):c;await Promise.all(e.map((e=>this.decryptEventIfNeeded(e)))),null!==i&&(c=c.filter((e=>e.getType()===i)))}return l&&n===O.RelationType.Replace&&(c=c.filter((e=>e.getSender()===l.getSender()))),{originalEvent:l,events:c,nextBatch:o.next_batch,prevBatch:o.prev_batch}}getCrossSigningCacheCallbacks(){var e;return null===(e=this.crypto)||void 0===e?void 0:e.crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return(0,L.randomString)(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&e.attemptDecryption(this.crypto,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case w.SERVICE_TYPES.IS:return t+S.PREFIX_IDENTITY_V2+"/terms";case w.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(e=!1){return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=u.ensureNoTrailingSlash(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}setAccessToken(e){this.http.opts.accessToken=e}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(void 0,S.Method.Get,"/register/available",{username:e}).then((e=>e.available)).catch((e=>"M_USER_IN_USE"!==e.errcode&&Promise.reject(e)))}register(e,t,n,i,r,s,o,a){!0===r?r={email:!0}:null!=r&&!1!==r||(r={}),"function"==typeof o&&(a=o,o=void 0),n&&(i.session=n);const l={auth:i,refresh_token:!0};return null!=e&&(l.username=e),null!=t&&(l.password=t),r.email&&(l.bind_email=!0),r.msisdn&&(l.bind_msisdn=!0),null!=s&&(l.guest_access_token=s),null!=o&&(l.inhibit_login=o),null!=t&&(l.x_show_msisdn=!0),this.registerRequest(l,void 0,a)}registerGuest(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)}registerRequest(e,t,n){const i={};return t&&(i.kind=t),this.http.request(n,S.Method.Post,"/register",i,e)}refreshToken(e){return this.http.authedRequest(void 0,S.Method.Post,"/refresh",void 0,{refresh_token:e},{prefix:S.PREFIX_V1,inhibitLogoutEmit:!0})}loginFlows(e){return this.http.request(e,S.Method.Get,"/login")}login(e,t,n){const i={type:e};return Object.assign(i,t),this.http.authedRequest(((e,t)=>{t&&t.access_token&&t.user_id&&(this.http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),n&&n(e,t)}),S.Method.Post,"/login",void 0,i)}loginWithPassword(e,t,n){return this.login("m.login.password",{user:e,password:t},n)}loginWithSAML2(e,t){return this.login("m.login.saml2",{relay_state:e},t)}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e,t="sso",n,i){let r="/login/"+t+"/redirect";n&&(r+="/"+n);const s={redirectUrl:e,[le.unstable]:i};return this.http.getUrl(r,s,S.PREFIX_R0)}loginWithToken(e,t){return this.login("m.login.token",{token:e},t)}async logout(e,t=!1){var n,i;if(null!==(n=this.crypto)&&void 0!==n&&null!==(i=n.backupManager)&&void 0!==i&&i.getKeyBackupEnabled())try{for(;await this.crypto.backupManager.backupPendingKeys(200)>0;);}catch(e){b.logger.error("Key backup request failed when logging out. Some keys may be missing from backup",e)}return t&&this.stopClient(),this.http.authedRequest(e,S.Method.Post,"/logout")}deactivateAccount(e,t){if("function"==typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");const n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this.http.authedRequest(void 0,S.Method.Post,"/account/deactivate",void 0,n)}requestLoginToken(e){const t={auth:e};return this.http.authedRequest(void 0,S.Method.Post,"/org.matrix.msc3882/login/token",void 0,t,{prefix:S.PREFIX_UNSTABLE})}getFallbackAuthUrl(e,t){const n=u.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(n,{session:t},S.PREFIX_R0)}async createRoom(e,t){var n;const i=(e.invite_3pid||[]).filter((e=>!e.id_access_token));if(i.length>0&&null!==(n=this.identityServer)&&void 0!==n&&n.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();if(e)for(const t of i)t.id_access_token=e}return this.http.authedRequest(t,S.Method.Post,"/createRoom",void 0,e)}fetchRelations(e,t,n,i,r={direction:p.Direction.Backward}){const s=u.encodeParams(r);let o="/rooms/$roomId/relations/$eventId";null!==n?(o+="/$relationType",null!==i&&(o+="/$eventType")):null!==i&&(b.logger.warn(`eventType: ${i} ignored when fetching\n            relations as relationType is null`),i=null);const a=u.encodeUri(o+"?"+s,{$roomId:e,$eventId:t,$relationType:n,$eventType:i});return this.http.authedRequest(void 0,S.Method.Get,a,void 0,void 0,{prefix:S.PREFIX_UNSTABLE})}roomState(e,t){const n=u.encodeUri("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(t,S.Method.Get,n)}fetchRoomEvent(e,t,n){const i=u.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(n,S.Method.Get,i)}members(e,t,n,i,r){const s={};t&&(s.membership=t),n&&(s.not_membership=n),i&&(s.at=i);const o=u.encodeParams(s),a=u.encodeUri("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(r,S.Method.Get,a)}upgradeRoom(e,t){const n=u.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(void 0,S.Method.Post,n,void 0,{new_version:t})}getStateEvent(e,t,n,i){const r={$roomId:e,$eventType:t,$stateKey:n};let s=u.encodeUri("/rooms/$roomId/state/$eventType",r);return void 0!==n&&(s=u.encodeUri(s+"/$stateKey",r)),this.http.authedRequest(i,S.Method.Get,s)}sendStateEvent(e,t,n,i="",r){const s={$roomId:e,$eventType:t,$stateKey:i};let o=u.encodeUri("/rooms/$roomId/state/$eventType",s);return void 0!==i&&(o=u.encodeUri(o+"/$stateKey",s)),this.http.authedRequest(r,S.Method.Put,o,void 0,n)}roomInitialSync(e,t,n){var i,r;u.isFunction(t)&&(n=t,t=void 0);const s=u.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(n,S.Method.Get,s,{limit:null!==(i=null===(r=t)||void 0===r?void 0:r.toString())&&void 0!==i?i:"30"})}async setRoomReadMarkersHttpRequest(e,t,n,i){const r=u.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),s={[z.ReceiptType.FullyRead]:t,[z.ReceiptType.Read]:n};return(await this.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")||await this.isVersionSupported("v1.4"))&&(s[z.ReceiptType.ReadPrivate]=i),this.http.authedRequest(void 0,S.Method.Post,r,void 0,s)}getJoinedRooms(){const e=u.encodeUri("/joined_rooms",{});return this.http.authedRequest(void 0,S.Method.Get,e)}getJoinedRoomMembers(e){const t=u.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(void 0,S.Method.Get,t)}publicRooms(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});const n={};return e.server&&(n.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(n).length?this.http.authedRequest(t,S.Method.Get,"/publicRooms"):this.http.authedRequest(t,S.Method.Post,"/publicRooms",n,e)}createAlias(e,t,n){const i=u.encodeUri("/directory/room/$alias",{$alias:e}),r={room_id:t};return this.http.authedRequest(n,S.Method.Put,i,void 0,r)}deleteAlias(e,t){const n=u.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,S.Method.Delete,n)}getLocalAliases(e){const t=u.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),n=S.PREFIX_V3;return this.http.authedRequest(void 0,S.Method.Get,t,void 0,void 0,{prefix:n})}getRoomIdForAlias(e,t){const n=u.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,S.Method.Get,n)}resolveRoomAlias(e,t){const n=u.encodeUri("/directory/room/$alias",{$alias:e});return this.http.request(t,S.Method.Get,n)}getRoomDirectoryVisibility(e,t){const n=u.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(t,S.Method.Get,n)}setRoomDirectoryVisibility(e,t,n){const i=u.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(n,S.Method.Put,i,void 0,{visibility:t})}setRoomDirectoryVisibilityAppService(e,t,n,i){const r=u.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this.http.authedRequest(i,S.Method.Put,r,void 0,{visibility:n})}searchUserDirectory(e){const t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this.http.authedRequest(void 0,S.Method.Post,"/user_directory/search",void 0,t)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t,n){u.isFunction(t)&&(n=t,t=void 0);const i=t?u.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):u.encodeUri("/profile/$userId",{$userId:e});return this.http.authedRequest(n,S.Method.Get,i)}getThreePids(e){return this.http.authedRequest(e,S.Method.Get,"/account/3pid")}addThreePid(e,t,n){const i={threePidCreds:e,bind:t};return this.http.authedRequest(n,S.Method.Post,"/account/3pid",void 0,i)}async addThreePidOnly(e){const t=await this.isVersionSupported("r0.6.0")?S.PREFIX_R0:S.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,S.Method.Post,"/account/3pid/add",void 0,e,{prefix:t})}async bindThreePid(e){const t=await this.isVersionSupported("r0.6.0")?S.PREFIX_R0:S.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,S.Method.Post,"/account/3pid/bind",void 0,e,{prefix:t})}async unbindThreePid(e,t){const n={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},i=await this.isVersionSupported("r0.6.0")?S.PREFIX_R0:S.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,S.Method.Post,"/account/3pid/unbind",void 0,n,{prefix:i})}deleteThreePid(e,t){return this.http.authedRequest(void 0,S.Method.Post,"/account/3pid/delete",void 0,{medium:e,address:t})}setPassword(e,t,n,i){"function"==typeof n&&(i=n),"boolean"!=typeof n&&(n=void 0);const r={auth:e,new_password:t,logout_devices:n};return this.http.authedRequest(i,S.Method.Post,"/account/password",void 0,r)}getDevices(){return this.http.authedRequest(void 0,S.Method.Get,"/devices")}getDevice(e){const t=u.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,S.Method.Get,t)}setDeviceDetails(e,t){const n=u.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,S.Method.Put,n,void 0,t)}deleteDevice(e,t){const n=u.encodeUri("/devices/$device_id",{$device_id:e}),i={};return t&&(i.auth=t),this.http.authedRequest(void 0,S.Method.Delete,n,void 0,i)}deleteMultipleDevices(e,t){const n={devices:e};return t&&(n.auth=t),this.http.authedRequest(void 0,S.Method.Post,"/delete_devices",void 0,n)}async getPushers(e){const t=await this.http.authedRequest(e,S.Method.Get,"/pushers");return await this.doesServerSupportUnstableFeature("org.matrix.msc3881")||(t.pushers=t.pushers.map((e=>(e.hasOwnProperty(O.PUSHER_ENABLED.name)||(e[O.PUSHER_ENABLED.name]=!0),e)))),t}setPusher(e,t){return this.http.authedRequest(t,S.Method.Post,"/pushers/set",void 0,e)}setLocalNotificationSettings(e,t){const n=`${O.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name}.${e}`;return this.setAccountData(n,t)}getPushRules(e){return this.http.authedRequest(e,S.Method.Get,"/pushrules/").then((e=>m.PushProcessor.rewriteDefaultRules(e)))}addPushRule(e,t,n,i,r){const s=u.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(r,S.Method.Put,s,void 0,i)}deletePushRule(e,t,n,i){const r=u.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(i,S.Method.Delete,r)}setPushRuleEnabled(e,t,n,i,r){const s=u.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this.http.authedRequest(r,S.Method.Put,s,void 0,{enabled:i})}setPushRuleActions(e,t,n,i,r){const s=u.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this.http.authedRequest(r,S.Method.Put,s,void 0,{actions:i})}search(e,t){const n={};return e.next_batch&&(n.next_batch=e.next_batch),this.http.authedRequest(t,S.Method.Post,"/search",n,e.body)}uploadKeysRequest(e,t,n){return this.http.authedRequest(n,S.Method.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(void 0,S.Method.Post,"/keys/signatures/upload",void 0,e,{prefix:S.PREFIX_UNSTABLE})}downloadKeysForUsers(e,t){if(u.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");const n={device_keys:{}};return"token"in(t=t||{})&&(n.token=t.token),e.forEach((e=>{n.device_keys[e]=[]})),this.http.authedRequest(void 0,S.Method.Post,"/keys/query",void 0,n)}claimOneTimeKeys(e,t="signed_curve25519",n){const i={};void 0===t&&(t="signed_curve25519");for(let n=0;n<e.length;++n){const r=e[n][0],s=e[n][1],o=i[r]||{};i[r]=o,o[s]=t}const r={one_time_keys:i};return n&&(r.timeout=n),this.http.authedRequest(void 0,S.Method.Post,"/keys/claim",void 0,r)}getKeyChanges(e,t){const n={from:e,to:t};return this.http.authedRequest(void 0,S.Method.Get,"/keys/changes",n)}uploadDeviceSigningKeys(e,t){const n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this.http.authedRequest(void 0,S.Method.Post,"/keys/device_signing/upload",void 0,n,{prefix:S.PREFIX_UNSTABLE})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");const t=this.idBaseUrl+S.PREFIX_IDENTITY_V2+"/account/register";return this.http.requestOtherUrl(void 0,S.Method.Post,t,null,e)}requestEmailToken(e,t,n,i,r,s){const o={client_secret:t,email:e,send_attempt:null==n?void 0:n.toString(),next_link:i};return this.http.idServerRequest(r,S.Method.Post,"/validate/email/requestToken",o,S.PREFIX_IDENTITY_V2,s)}requestMsisdnToken(e,t,n,i,r,s,o){const a={client_secret:n,country:e,phone_number:t,send_attempt:null==i?void 0:i.toString(),next_link:r};return this.http.idServerRequest(s,S.Method.Post,"/validate/msisdn/requestToken",a,S.PREFIX_IDENTITY_V2,o)}submitMsisdnToken(e,t,n,i){const r={sid:e,client_secret:t,token:n};return this.http.idServerRequest(void 0,S.Method.Post,"/validate/msisdn/submitToken",r,S.PREFIX_IDENTITY_V2,i)}submitMsisdnTokenOtherUrl(e,t,n,i){const r={sid:t,client_secret:n,token:i};return this.http.requestOtherUrl(void 0,S.Method.Post,e,void 0,r)}getIdentityHashDetails(e){return this.http.idServerRequest(void 0,S.Method.Get,"/hash_details",null,S.PREFIX_IDENTITY_V2,e)}async identityHashedLookup(e,t){const i={},r=await this.getIdentityHashDetails(t);if(!r||!r.lookup_pepper||!r.algorithms)throw new Error("Unsupported identity server: bad response");i.pepper=r.lookup_pepper;const s={};if(r.algorithms.includes("sha256")){const t=new n.g.Olm.Utility;i.addresses=e.map((e=>{const n=e[0].toLowerCase(),r=e[1].toLowerCase(),o=t.sha256(`${n} ${r} ${i.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return s[o]=e[0],o})),i.algorithm="sha256"}else{if(!r.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");i.addresses=e.map((e=>{const t=`${e[0].toLowerCase()} ${e[1].toLowerCase()}`;return s[t]=e[0],t})),i.algorithm="none"}const o=await this.http.idServerRequest(void 0,S.Method.Post,"/lookup",i,S.PREFIX_IDENTITY_V2,t);if(!o||!o.mappings)return[];const a=[];for(const e of Object.keys(o.mappings)){const t=o.mappings[e],n=s[e];if(!n)throw new Error("Identity server returned more results than expected");a.push({address:n,mxid:t})}return a}async lookupThreePid(e,t,n,i){const r=(await this.identityHashedLookup([[t,e]],i)).find((e=>e.address===t));if(!r)return n&&n(null,{}),{};const s={address:t,medium:e,mxid:r.mxid};return n&&n(null,s),s}async bulkLookupThreePids(e,t){const n=await this.identityHashedLookup(e.map((e=>[e[1],e[0]])),t),i=[];for(const t of n){const n=e.find((e=>e[1]===t.address));if(!n)throw new Error("Identity sever returned unexpected results");i.push([n[0],t.address,t.mxid])}return{threepids:i}}getIdentityAccount(e){return this.http.idServerRequest(void 0,S.Method.Get,"/account",void 0,S.PREFIX_IDENTITY_V2,e)}sendToDevice(e,t,n){const i=u.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),r={messages:t},s=Object.keys(t).reduce(((e,n)=>(e[n]=Object.keys(t[n]),e)),{});return b.logger.log(`PUT ${i}`,s),this.http.authedRequest(void 0,S.Method.Put,i,void 0,r)}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(void 0,S.Method.Get,"/thirdparty/protocols").then((e=>{if(!e||"object"!=typeof e)throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e}))}getThirdpartyLocation(e,t){const n=u.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(void 0,S.Method.Get,n,t)}getThirdpartyUser(e,t){const n=u.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(void 0,S.Method.Get,n,t)}getTerms(e,t){const n=this.termsUrlForService(e,t);return this.http.requestOtherUrl(void 0,S.Method.Get,n)}agreeToTerms(e,t,n,i){const r=this.termsUrlForService(e,t),s={Authorization:"Bearer "+n};return this.http.requestOtherUrl(void 0,S.Method.Post,r,null,{user_accepts:i},{headers:s})}reportEvent(e,t,n,i){const r=u.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(void 0,S.Method.Post,r,void 0,{score:n,reason:i})}getRoomHierarchy(e,t,n,i=!1,r){const s=u.encodeUri("/rooms/$roomId/hierarchy",{$roomId:e}),o={suggested_only:String(i),max_depth:null==n?void 0:n.toString(),from:r,limit:null==t?void 0:t.toString()};return this.http.authedRequest(void 0,S.Method.Get,s,o,void 0,{prefix:S.PREFIX_V1}).catch((e=>{if("M_UNRECOGNIZED"===e.errcode)return this.http.authedRequest(void 0,S.Method.Get,s,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw e}))}async unstableCreateFileTree(e){const{room_id:t}=await this.createRoom({name:e,preset:M.Preset.PrivateChat,power_level_content_override:Q(Q({},N.DEFAULT_TREE_POWER_LEVELS_TEMPLATE),{},{users:{[this.getUserId()]:100}}),creation_content:{[O.RoomCreateTypeField]:O.RoomType.Space},initial_state:[{type:O.UNSTABLE_MSC3088_PURPOSE.name,state_key:O.UNSTABLE_MSC3089_TREE_SUBTYPE.name,content:{[O.UNSTABLE_MSC3088_ENABLED.name]:!0}},{type:O.EventType.RoomEncryption,state_key:"",content:{algorithm:f.MEGOLM_ALGORITHM}}]});return new N.MSC3089TreeSpace(this,t)}unstableGetFileTreeSpace(e){var t,n;const i=this.getRoom(e);if("join"!==(null==i?void 0:i.getMyMembership()))return null;const r=i.currentState.getStateEvents(O.EventType.RoomCreate,""),s=i.currentState.getStateEvents(O.UNSTABLE_MSC3088_PURPOSE.name,O.UNSTABLE_MSC3089_TREE_SUBTYPE.name);if(!r)throw new Error("Expected single room create event");return null!=s&&null!==(t=s.getContent())&&void 0!==t&&t[O.UNSTABLE_MSC3088_ENABLED.name]?(null===(n=r.getContent())||void 0===n?void 0:n[O.RoomCreateTypeField])!==O.RoomType.Space?null:new N.MSC3089TreeSpace(this,e):null}slidingSync(e,t){const n={};e.pos&&(n.pos=e.pos,delete e.pos),e.timeout&&(n.timeout=e.timeout,delete e.timeout);const i=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(void 0,S.Method.Post,"/sync",n,e,{prefix:"/_matrix/client/unstable/org.matrix.msc3575",baseUrl:t,localTimeoutMs:i})}supportsExperimentalThreads(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.experimentalThreadSupport)||!1}async getRoomSummary(e,t){const n=u.encodeUri("/rooms/$roomid/summary",{$roomid:e});return this.http.authedRequest(void 0,S.Method.Get,n,{via:t},void 0,{qsStringifyOptions:{arrayFormat:"repeat"},prefix:"/_matrix/client/unstable/im.nheko.summary"})}processThreadEvents(e,t,n){e.processThreadedEvents(t,n)}processBeaconEvents(e,t){null!=t&&t.length&&e&&e.currentState.processBeaconEvents(t,this)}async whoami(){return this.http.authedRequest(void 0,S.Method.Get,"/account/whoami")}timestampToEvent(e,t,n){const i=u.encodeUri("/rooms/$roomId/timestamp_to_event",{$roomId:e});return this.http.authedRequest(void 0,S.Method.Get,i,{ts:t.toString(),dir:n},void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"})}}t.MatrixClient=ce,(0,r.default)(ce,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")},4656:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.makeBeaconInfoContent=t.makeBeaconContent=t.getTextForLocationEvent=void 0,t.makeEmoteMessage=function(e){return{msgtype:o.MsgType.Emote,body:e}},t.makeHtmlEmote=function(e,t){return{msgtype:o.MsgType.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlMessage=function(e,t){return{msgtype:o.MsgType.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlNotice=function(e,t){return{msgtype:o.MsgType.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeLocationContent=void 0,t.makeNotice=function(e){return{msgtype:o.MsgType.Notice,body:e}},t.makeTextMessage=function(e){return{msgtype:o.MsgType.Text,body:e}},t.parseTopicContent=t.parseLocationEvent=t.parseBeaconInfoContent=t.parseBeaconContent=t.makeTopicContent=void 0;var r=i(n(8416)),s=n(1333),o=n(2481),a=n(6548),l=n(6709),c=n(9953);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const h=(e,t,n,i)=>{const r=`at ${new Date(n).toISOString()}`;return[t===l.LocationAssetType.Self?"User":void 0,"Location",i?`"${i}"`:void 0,e,r].filter(Boolean).join(" ")};t.getTextForLocationEvent=h;const u=(e,t,n,i,s)=>{const c=null!=e?e:h(t,s||l.LocationAssetType.Self,n,i),u=n?{[l.M_TIMESTAMP.name]:n}:{};return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({msgtype:o.MsgType.Location,body:c,geo_uri:t,[l.M_LOCATION.name]:{description:i,uri:t},[l.M_ASSET.name]:{type:s||l.LocationAssetType.Self},[a.TEXT_NODE_TYPE.name]:c},u)};t.makeLocationContent=u,t.parseLocationEvent=e=>{var t,n;const i=l.M_LOCATION.findIn(e),r=l.M_ASSET.findIn(e),s=l.M_TIMESTAMP.findIn(e),o=a.TEXT_NODE_TYPE.findIn(e),c=null!==(t=null==i?void 0:i.uri)&&void 0!==t?t:null==e?void 0:e.geo_uri,d=null==i?void 0:i.description,h=null!==(n=null==r?void 0:r.type)&&void 0!==n?n:l.LocationAssetType.Self,p=null!=o?o:e.body;return u(p,c,s,d,h)},t.makeTopicContent=(e,t)=>{const n=[{body:e,mimetype:"text/plain"}];return(0,s.isProvided)(t)&&n.push({body:t,mimetype:"text/html"}),{topic:e,[c.M_TOPIC.name]:n}},t.parseTopicContent=e=>{var t,n,i;const r=c.M_TOPIC.findIn(e);return{text:null!==(t=null==r||null===(n=r.find((e=>!(0,s.isProvided)(e.mimetype)||"text/plain"===e.mimetype)))||void 0===n?void 0:n.body)&&void 0!==t?t:e.topic,html:null==r||null===(i=r.find((e=>"text/html"===e.mimetype)))||void 0===i?void 0:i.body}},t.makeBeaconInfoContent=(e,t,n,i,r)=>({description:n,timeout:e,live:t,[l.M_TIMESTAMP.name]:r||Date.now(),[l.M_ASSET.name]:{type:null!=i?i:l.LocationAssetType.Self}}),t.parseBeaconInfoContent=e=>{const{description:t,timeout:n,live:i}=e,r=l.M_TIMESTAMP.findIn(e),s=l.M_ASSET.findIn(e);return{description:t,timeout:n,live:i,assetType:null==s?void 0:s.type,timestamp:r}},t.makeBeaconContent=(e,t,n,i)=>({[l.M_LOCATION.name]:{description:i,uri:e},[l.M_TIMESTAMP.name]:t,"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:n}}),t.parseBeaconContent=e=>{const t=l.M_LOCATION.findIn(e),n=l.M_TIMESTAMP.findIn(e);return{description:null==t?void 0:t.description,uri:null==t?void 0:t.uri,timestamp:n}}},3667:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=function(e,t,n,r,s,o=!1){if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return o?t:"";let a=t.slice(6),l="/_matrix/media/r0/download/";const c={};n&&(c.width=Math.round(n).toString()),r&&(c.height=Math.round(r).toString()),s&&(c.method=s),Object.keys(c).length>0&&(l="/_matrix/media/r0/thumbnail/");const d=a.indexOf("#");let h="";d>=0&&(h=a.slice(d),a=a.slice(0,d));return e+l+a+(0===Object.keys(c).length?"":"?"+i.encodeParams(c))+h};var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(n(3102));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}},3075:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.UserTrustLevel=t.DeviceTrustLevel=t.CrossSigningLevel=t.CrossSigningInfo=void 0,t.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:async function(n,i){const r=await new Promise((t=>e.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(i=>{e.getSecretStorePrivateKey(i,t,n)}))));if(r&&r.ciphertext){const e=Buffer.from(t.pickleKey),i=await(0,l.decryptAES)(r,e,n);return(0,s.decodeBase64)(i)}return r},storeCrossSigningKeyCache:async function(n,i){if(!(i instanceof Uint8Array))throw new Error(`storeCrossSigningKeyCache expects Uint8Array, got ${i}`);const r=Buffer.from(t.pickleKey),o=await(0,l.encryptAES)((0,s.encodeBase64)(i),r,n);return e.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.storeSecretStorePrivateKey(t,n,o)}))}}},t.requestKeysDuringVerification=function(e,t,n){if(e.getUserId()===t)return o.logger.log("Cross-signing: Self-verification done; requesting keys"),new Promise(((t,i)=>{const r=e,a=r.crypto.crossSigningInfo,l=new d(a.userId,{getCrossSigningKey:async e=>{o.logger.debug("Cross-signing: requesting secret",e,n);const{promise:t}=r.requestSecret(`m.cross_signing.${e}`,[n]),i=await t,a=(0,s.decodeBase64)(i);return Uint8Array.from(a)}},a.getCacheCallbacks());l.keys=a.keys;const c=new Promise((e=>{setTimeout(e,6e4,new Error("Timeout"))})),h=(async()=>{if(!await r.crypto.getSessionBackupPrivateKey()){o.logger.info("No cached backup key found. Requesting...");const e=r.requestSecret("m.megolm_backup.v1",[n]),t=await e.promise;o.logger.info("Got key backup key, decoding...");const i=(0,s.decodeBase64)(t);o.logger.info("Decoded backup key, storing..."),await r.crypto.storeSessionBackupPrivateKey(Uint8Array.from(i)),o.logger.info("Backup key stored. Starting backup restore...");const a=await r.getKeyBackupVersion();r.restoreKeyBackupWithCache(void 0,void 0,a).then((()=>{o.logger.info("Backup restored.")}))}})();return Promise.race([Promise.all([l.getCrossSigningKey("master"),l.getCrossSigningKey("self_signing"),l.getCrossSigningKey("user_signing"),h]),c]).then(t,i)})).catch((e=>{o.logger.warn("Cross-signing: failure while requesting keys:",e)}))};var r=i(n(8416)),s=n(2772),o=n(7434),a=n(7585),l=n(2611);function c(e){return Object.values(e.keys)[0]}class d{constructor(e,t={},n={}){this.userId=e,this.callbacks=t,this.cacheCallbacks=n,(0,r.default)(this,"keys",{}),(0,r.default)(this,"firstUse",!0),(0,r.default)(this,"crossSigningVerifiedBefore",!1)}static fromStorage(e,t){const n=new d(t);for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}async getCrossSigningKey(e,t){const i=["master","self_signing","user_signing"].indexOf(e)>=0;if(!this.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function r(e){if(!e)return;const i=new n.g.Olm.PkSigning,r=i.init_with_seed(e);if(r===t)return[r,i];i.free()}let s;void 0===t&&(t=this.getId(e)),this.cacheCallbacks.getCrossSigningKeyCache&&i&&(s=await this.cacheCallbacks.getCrossSigningKeyCache(e,t));const o=r(s);if(o)return o;s=await this.callbacks.getCrossSigningKey(e,t);const a=r(s);if(a)return this.cacheCallbacks.storeCrossSigningKeyCache&&i&&await this.cacheCallbacks.storeCrossSigningKeyCache(e,s),a;if(!s)throw new Error("getCrossSigningKey callback for "+e+" returned falsey");throw new Error("Key type "+e+" from getCrossSigningKey callback did not match")}async isStoredInSecretStorage(e){const t=await e.isStored("m.cross_signing.master")||{};function n(e){for(const n of Object.keys(t))e[n]||delete t[n]}for(const t of["self_signing","user_signing"])n(await e.isStored(`m.cross_signing.${t}`)||{});return Object.keys(t).length?t:null}static async storeInSecretStorage(e,t){for(const[n,i]of e){const e=(0,s.encodeBase64)(i);await t.store(`m.cross_signing.${n}`,e)}}static async getFromSecretStorage(e,t){const n=await t.get(`m.cross_signing.${e}`);return n?(0,s.decodeBase64)(n):null}async isStoredInKeyCache(e){const t=this.cacheCallbacks;if(!t)return!1;const n=e?[e]:["master","self_signing","user_signing"];for(const e of n)if(!await t.getCrossSigningKeyCache(e))return!1;return!0}async getCrossSigningKeysFromCache(){const e=new Map,t=this.cacheCallbacks;if(!t)return e;for(const n of["master","self_signing","user_signing"]){const i=await t.getCrossSigningKeyCache(n);i&&e.set(n,i)}return e}getId(e="master"){return this.keys[e]?c(this.keys[e]):null}async resetKeys(e){if(!this.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===e||e&h.MASTER||!this.keys.master)e=h.MASTER|h.USER_SIGNING|h.SELF_SIGNING;else if(0===e)return;const t={},i={};let r,o;try{if(e&h.MASTER?(r=new n.g.Olm.PkSigning,t.master=r.generate_seed(),o=r.init_with_seed(t.master),i.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+o]:o}}):[o,r]=await this.getCrossSigningKey("master"),e&h.SELF_SIGNING){const e=new n.g.Olm.PkSigning;try{t.self_signing=e.generate_seed();const n=e.init_with_seed(t.self_signing);i.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+n]:n}},(0,s.pkSign)(i.self_signing,r,this.userId,o)}finally{e.free()}}if(e&h.USER_SIGNING){const e=new n.g.Olm.PkSigning;try{t.user_signing=e.generate_seed();const n=e.init_with_seed(t.user_signing);i.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+n]:n}},(0,s.pkSign)(i.user_signing,r,this.userId,o)}finally{e.free()}}Object.assign(this.keys,i),this.callbacks.saveCrossSigningKeys(t)}finally{r&&r.free()}}clearKeys(){this.keys={}}setKeys(e){const t={};if(e.master){if(e.master.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw o.logger.error(t),new Error(t)}this.keys.master?c(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}const n=c(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw o.logger.error(t),new Error(t)}try{(0,s.pkVerify)(e.user_signing,n,this.userId)}catch(e){throw o.logger.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw o.logger.error(t),new Error(t)}try{(0,s.pkVerify)(e.self_signing,n,this.userId)}catch(e){throw o.logger.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}async signObject(e,t){if(!this.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");const[n,i]=await this.getCrossSigningKey(t);try{return(0,s.pkSign)(e,i,this.userId,n),e}finally{i.free()}}async signUser(e){if(this.keys.user_signing)return this.signObject(e.keys.master,"user_signing");o.logger.info("No user signing key: not signing user")}async signDevice(e,t){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing");o.logger.info("No self signing key: not signing device")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new u(!0,!0,this.firstUse);if(!this.keys.user_signing)return new u(!1,!1,e.firstUse);let t;const n=e.keys.master,i=this.getId("user_signing");try{(0,s.pkVerify)(n,i,this.userId),t=!0}catch(e){t=!1}return new u(t,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,t,n,i){const r=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new p(!1,!1,n,i);const a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,s.pkVerify)(o,e.getId(),e.userId),(0,s.pkVerify)(a,c(o),e.userId),p.fromUserTrustLevel(r,n,i)}catch(e){return new p(!1,!1,n,i)}}getCacheCallbacks(){return this.cacheCallbacks}}let h;t.CrossSigningInfo=d,t.CrossSigningLevel=h,function(e){e[e.MASTER=4]="MASTER",e[e.USER_SIGNING=2]="USER_SIGNING",e[e.SELF_SIGNING=1]="SELF_SIGNING"}(h||(t.CrossSigningLevel=h={}));class u{constructor(e,t,n){this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=n}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}t.UserTrustLevel=u;class p{constructor(e,t,n,i){this.crossSigningVerified=e,this.tofu=t,this.localVerified=n,this.trustCrossSignedDevices=i}static fromUserTrustLevel(e,t,n){return new p(e.isCrossSigningVerified(),e.isTofu(),t,n)}isVerified(){return Boolean(this.isLocallyVerified()||this.trustCrossSignedDevices&&this.isCrossSigningVerified())}isCrossSigningVerified(){return this.crossSigningVerified}isLocallyVerified(){return this.localVerified}isTofu(){return this.tofu}}t.DeviceTrustLevel=p},6670:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingStatus=t.DeviceList=void 0;var r=i(n(8416)),s=n(7434),o=n(3272),a=n(3075),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(2772)),c=n(7585),d=n(3102),h=n(5861),u=n(2600);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}let m;t.TrackingStatus=m,function(e){e[e.NotTracked=0]="NotTracked",e[e.PendingDownload=1]="PendingDownload",e[e.DownloadInProgress=2]="DownloadInProgress",e[e.UpToDate=3]="UpToDate"}(m||(t.TrackingStatus=m={}));class g extends h.TypedEventEmitter{constructor(e,t,n,i=250){super(),this.cryptoStore=t,this.keyDownloadChunkSize=i,(0,r.default)(this,"devices",{}),(0,r.default)(this,"crossSigningInfo",{}),(0,r.default)(this,"userByIdentityKey",{}),(0,r.default)(this,"deviceTrackingStatus",{}),(0,r.default)(this,"syncToken",null),(0,r.default)(this,"keyDownloadsInProgressByUser",{}),(0,r.default)(this,"dirty",!1),(0,r.default)(this,"savePromise",null),(0,r.default)(this,"resolveSavePromise",null),(0,r.default)(this,"savePromiseTime",null),(0,r.default)(this,"saveTimer",null),(0,r.default)(this,"hasFetched",null),(0,r.default)(this,"serialiser",void 0),this.serialiser=new f(e,n,this)}async load(){await this.cryptoStore.doTxn("readonly",[c.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this.cryptoStore.getEndToEndDeviceData(e,(e=>{this.hasFetched=Boolean(e&&e.devices),this.devices=e?e.devices:{},this.crossSigningInfo=e&&e.crossSigningInfo||{},this.deviceTrackingStatus=e?e.trackingStatus:{},this.syncToken=e?e.syncToken:null,this.userByIdentityKey={};for(const e of Object.keys(this.devices)){const t=this.devices[e];for(const n of Object.keys(t)){const i=t[n].keys["curve25519:"+n];void 0!==i&&(this.userByIdentityKey[i]=e)}}}))}));for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]==m.DownloadInProgress&&(this.deviceTrackingStatus[e]=m.PendingDownload)}stop(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}async saveIfDirty(e=500){if(!this.dirty)return Promise.resolve(!1);const t=Date.now()+e;this.savePromiseTime&&t<this.savePromiseTime&&(clearTimeout(this.saveTimer),this.saveTimer=null,this.savePromiseTime=null);let n=this.savePromise;if(null===n&&(n=new Promise((e=>{this.resolveSavePromise=e})),this.savePromise=n),null===this.saveTimer){const n=this.resolveSavePromise;this.savePromiseTime=t,this.saveTimer=setTimeout((()=>{s.logger.log("Saving device tracking data",this.syncToken),this.savePromiseTime=null,this.saveTimer=null,this.savePromise=null,this.resolveSavePromise=null,this.cryptoStore.doTxn("readwrite",[c.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this.cryptoStore.storeEndToEndDeviceData({devices:this.devices,crossSigningInfo:this.crossSigningInfo,trackingStatus:this.deviceTrackingStatus,syncToken:this.syncToken},e)})).then((()=>{this.dirty=!1,n(!0)}),(e=>{s.logger.error("Failed to save device tracking data",this.syncToken),s.logger.error(e)}))}),e)}return n}getSyncToken(){return this.syncToken}setSyncToken(e){this.syncToken=e}downloadKeys(e,t){const n=[],i=[];if(e.forEach((e=>{const r=this.deviceTrackingStatus[e];this.keyDownloadsInProgressByUser[e]?(s.logger.log(`downloadKeys: already have a download in progress for ${e}: awaiting its result`),i.push(this.keyDownloadsInProgressByUser[e])):(t||r!=m.UpToDate)&&n.push(e)})),0!=n.length){s.logger.log("downloadKeys: downloading for",n);const e=this.doKeyDownload(n);i.push(e)}return 0===i.length&&s.logger.log("downloadKeys: already have all necessary keys"),Promise.all(i).then((()=>this.getDevicesFromStore(e)))}getDevicesFromStore(e){const t={};return e.forEach((e=>{t[e]={},(this.getStoredDevicesForUser(e)||[]).forEach((function(n){t[e][n.deviceId]=n}))})),t}getKnownUserIds(){return Object.keys(this.devices)}getStoredDevicesForUser(e){const t=this.devices[e];if(!t)return null;const n=[];for(const e in t)t.hasOwnProperty(e)&&n.push(o.DeviceInfo.fromStorage(t[e],e));return n}getRawStoredDevicesForUser(e){return this.devices[e]}getStoredCrossSigningForUser(e){return this.crossSigningInfo[e]?a.CrossSigningInfo.fromStorage(this.crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this.crossSigningInfo[e]=t,this.dirty=!0}getStoredDevice(e,t){const n=this.devices[e];if(n&&n[t])return o.DeviceInfo.fromStorage(n[t],t)}getUserByIdentityKey(e,t){return e!==l.OLM_ALGORITHM&&e!==l.MEGOLM_ALGORITHM?null:this.userByIdentityKey[t]}getDeviceByIdentityKey(e,t){const n=this.getUserByIdentityKey(e,t);if(!n)return null;const i=this.devices[n];if(!i)return null;for(const e in i){if(!i.hasOwnProperty(e))continue;const n=i[e];for(const i in n.keys)if(n.keys.hasOwnProperty(i)&&0===i.indexOf("curve25519:")&&n.keys[i]==t)return o.DeviceInfo.fromStorage(n,e)}return null}storeDevicesForUser(e,t){this.setRawStoredDevicesForUser(e,t),this.dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(s.logger.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=m.PendingDownload,this.dirty=!0)}stopTrackingDeviceList(e){this.deviceTrackingStatus[e]&&(s.logger.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=m.NotTracked,this.dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]=m.NotTracked;this.dirty=!0}invalidateUserDeviceList(e){this.deviceTrackingStatus[e]&&(s.logger.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=m.PendingDownload,this.dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const t of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[t]==m.PendingDownload&&e.push(t);return this.doKeyDownload(e)}setRawStoredDevicesForUser(e,t){if(void 0!==this.devices[e])for(const[t,n]of Object.entries(this.devices[e])){const e=n.keys["curve25519:"+t];delete this.userByIdentityKey[e]}this.devices[e]=t;for(const[n,i]of Object.entries(t)){const t=i.keys["curve25519:"+n];this.userByIdentityKey[t]=e}}setRawStoredCrossSigningForUser(e,t){this.crossSigningInfo[e]=t}doKeyDownload(e){if(0===e.length)return Promise.resolve();const t=this.serialiser.updateDevicesForUsers(e,this.syncToken).then((()=>{n(!0)}),(t=>{throw s.logger.error("Error downloading keys for "+e+":",t),n(!1),t}));e.forEach((e=>{this.keyDownloadsInProgressByUser[e]=t,this.deviceTrackingStatus[e]==m.PendingDownload&&(this.deviceTrackingStatus[e]=m.DownloadInProgress)}));const n=n=>{this.emit(u.CryptoEvent.WillUpdateDevices,e,!this.hasFetched),e.forEach((e=>{this.dirty=!0,this.keyDownloadsInProgressByUser[e]===t?(delete this.keyDownloadsInProgressByUser[e],this.deviceTrackingStatus[e]==m.DownloadInProgress&&(n?(this.deviceTrackingStatus[e]=m.UpToDate,s.logger.log("Device list for",e,"now up to date")):this.deviceTrackingStatus[e]=m.PendingDownload)):s.logger.log("Another update in the queue for",e,"- not marking up-to-date")})),this.saveIfDirty(),this.emit(u.CryptoEvent.DevicesUpdated,e,!this.hasFetched),this.hasFetched=!0};return t}}t.DeviceList=g;class f{constructor(e,t,n){this.baseApis=e,this.olmDevice=t,this.deviceList=n,(0,r.default)(this,"downloadInProgress",!1),(0,r.default)(this,"keyDownloadsQueuedByUser",{}),(0,r.default)(this,"queuedQueryDeferred",null),(0,r.default)(this,"syncToken",null)}updateDevicesForUsers(e,t){return e.forEach((e=>{this.keyDownloadsQueuedByUser[e]=!0})),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,d.defer)()),this.syncToken=t,this.downloadInProgress?(s.logger.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}doQueuedQueries(){if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");const e=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};const t=this.queuedQueryDeferred;this.queuedQueryDeferred=null,s.logger.log("Starting key download for",e),this.downloadInProgress=!0;const n={};this.syncToken&&(n.token=this.syncToken);const i=[];for(let t=0;t<e.length;t+=this.deviceList.keyDownloadChunkSize){const r=e.slice(t,t+this.deviceList.keyDownloadChunkSize);i.push((()=>this.baseApis.downloadKeysForUsers(r,n)))}return(0,d.chunkPromises)(i,3).then((async t=>{const n=Object.assign({},...t.map((e=>e.device_keys||{}))),i=Object.assign({},...t.map((e=>e.master_keys||{}))),r=Object.assign({},...t.map((e=>e.self_signing_keys||{}))),o=Object.assign({},...t.map((e=>e.user_signing_keys||{})));for(const t of e){await(0,d.sleep)(5);try{await this.processQueryResponseForUser(t,n[t],{master:i[t],self_signing:r[t],user_signing:o[t]})}catch(e){s.logger.error(`Error processing keys for ${t}:`,e)}}})).then((()=>{s.logger.log("Completed key download for "+e),this.downloadInProgress=!1,t.resolve(),this.queuedQueryDeferred&&this.doQueuedQueries()}),(n=>{s.logger.warn("Error downloading keys for "+e+":",n),this.downloadInProgress=!1,t.reject(n)})),t.promise}async processQueryResponseForUser(e,t,n){s.logger.log("got device keys for "+e+":",t),s.logger.log("got cross-signing keys for "+e+":",n);{const n={},i=this.deviceList.getRawStoredDevicesForUser(e);i&&Object.keys(i).forEach((e=>{const t=o.DeviceInfo.fromStorage(i[e],e);n[e]=t})),await async function(e,t,n,i,r,o){let a=!1;for(const e in n)if(n.hasOwnProperty(e)&&!(e in i)){if(t===r&&e===o){s.logger.warn(`Local device ${e} missing from sync, skipping removal`);continue}s.logger.log("Device "+t+":"+e+" has been removed"),delete n[e],a=!0}for(const r in i){if(!i.hasOwnProperty(r))continue;const o=i[r];o.user_id===t?o.device_id===r?await v(e,n,o)&&(a=!0):s.logger.warn("Mismatched device_id "+o.device_id+" in keys from "+t+":"+r):s.logger.warn("Mismatched user_id "+o.user_id+" in keys from "+t+":"+r)}return a}(this.olmDevice,e,n,t||{},this.baseApis.getUserId(),this.baseApis.deviceId);const r={};Object.keys(n).forEach((e=>{r[e]=n[e].toStorage()})),this.deviceList.setRawStoredDevicesForUser(e,r)}if(n&&(n.master||n.self_signing||n.user_signing)){const t=this.deviceList.getStoredCrossSigningForUser(e)||new a.CrossSigningInfo(e);t.setKeys(n),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage()),this.deviceList.emit(u.CryptoEvent.UserCrossSigningUpdated,e)}}}async function v(e,t,n){if(!n.keys)return!1;const i=n.device_id,r=n.user_id,a="ed25519:"+i,c=n.keys[a];if(!c)return s.logger.warn("Device "+r+":"+i+" has no ed25519 key"),!1;const d=n.unsigned||{},h=n.signatures||{};try{await l.verifySignature(e,n,r,i,c)}catch(e){return s.logger.warn("Unable to verify signature on device "+r+":"+i+":"+e),!1}let u;if(i in t){if(u=t[i],u.getFingerprint()!=c)return s.logger.warn("Ed25519 key for device "+r+":"+i+" has changed"),!1}else t[i]=u=new o.DeviceInfo(i);return u.keys=n.keys||{},u.algorithms=n.algorithms||[],u.unsigned=d,u.signatures=h,!0}},636:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionSetupOperation=t.EncryptionSetupBuilder=void 0;var r=i(n(8416)),s=n(7434),o=n(4369),a=n(3075),l=n(7585),c=n(7715),d=n(8070),h=n(5861);t.EncryptionSetupBuilder=class{constructor(e,t){(0,r.default)(this,"accountDataClientAdapter",void 0),(0,r.default)(this,"crossSigningCallbacks",void 0),(0,r.default)(this,"ssssCryptoCallbacks",void 0),(0,r.default)(this,"crossSigningKeys",null),(0,r.default)(this,"keySignatures",null),(0,r.default)(this,"keyBackupInfo",null),(0,r.default)(this,"sessionBackupPrivateKey",void 0),this.accountDataClientAdapter=new p(e),this.crossSigningCallbacks=new m,this.ssssCryptoCallbacks=new g(t)}addCrossSigningKeys(e,t){this.crossSigningKeys={authUpload:e,keys:t}}addSessionBackup(e){this.keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this.sessionBackupPrivateKey=e}addKeySignature(e,t,n){this.keySignatures||(this.keySignatures={});const i=this.keySignatures[e]||{};this.keySignatures[e]=i,i[t]=n}async setAccountData(e,t){await this.accountDataClientAdapter.setAccountData(e,t)}buildOperation(){const e=this.accountDataClientAdapter.values;return new u(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}async persist(e){if(this.crossSigningKeys){const t=(0,a.createCryptoStoreCacheCallbacks)(e.cryptoStore,e.olmDevice);for(const e of["master","self_signing","user_signing"]){s.logger.log(`Cache ${e} cross-signing private key locally`);const n=this.crossSigningCallbacks.privateKeys.get(e);await t.storeCrossSigningKeyCache(e,n)}await e.cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.cryptoStore.storeCrossSigningKeys(t,this.crossSigningKeys.keys)}))}this.sessionBackupPrivateKey&&await e.storeSessionBackupPrivateKey(this.sessionBackupPrivateKey)}};class u{constructor(e,t,n,i){this.accountData=e,this.crossSigningKeys=t,this.keyBackupInfo=n,this.keySignatures=i}async apply(e){const t=e.baseApis;if(this.crossSigningKeys){const n={};for(const[e,t]of Object.entries(this.crossSigningKeys.keys))n[e+"_key"]=t;await this.crossSigningKeys.authUpload((e=>t.uploadDeviceSigningKeys(e,n))),e.crossSigningInfo.setKeys(this.crossSigningKeys.keys)}if(this.accountData)for(const[e,n]of this.accountData)await t.setAccountData(e,n);this.keySignatures&&await t.uploadKeySignatures(this.keySignatures),this.keyBackupInfo&&(this.keyBackupInfo.version?await t.http.authedRequest(void 0,c.Method.Put,"/room_keys/version/"+this.keyBackupInfo.version,void 0,{algorithm:this.keyBackupInfo.algorithm,auth_data:this.keyBackupInfo.auth_data},{prefix:c.PREFIX_UNSTABLE}):await t.http.authedRequest(void 0,c.Method.Post,"/room_keys/version",void 0,this.keyBackupInfo,{prefix:c.PREFIX_UNSTABLE}))}}t.EncryptionSetupOperation=u;class p extends h.TypedEventEmitter{constructor(e){super(),this.existingValues=e,(0,r.default)(this,"values",new Map)}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){const t=this.values.get(e);if(t)return t;const n=this.existingValues[e];return n?n.getContent():null}setAccountData(e,t){const n=this.values.get(e);return this.values.set(e,t),Promise.resolve().then((()=>{const i=new o.MatrixEvent({type:e,content:t});return this.emit(d.ClientEvent.AccountData,i,n),{}}))}}class m{constructor(){(0,r.default)(this,"privateKeys",new Map)}getCrossSigningKeyCache(e,t){return this.getCrossSigningKey(e,t)}storeCrossSigningKeyCache(e,t){return this.privateKeys.set(e,t),Promise.resolve()}getCrossSigningKey(e,t){return Promise.resolve(this.privateKeys.get(e))}saveCrossSigningKeys(e){for(const[t,n]of Object.entries(e))this.privateKeys.set(t,n)}}class g{constructor(e){this.delegateCryptoCallbacks=e,(0,r.default)(this,"privateKeys",new Map)}async getSecretStorageKey({keys:e},t){var n;for(const t of Object.keys(e)){const e=this.privateKeys.get(t);if(e)return[t,e]}if(null!=this&&null!==(n=this.delegateCryptoCallbacks)&&void 0!==n&&n.getSecretStorageKey){const n=await this.delegateCryptoCallbacks.getSecretStorageKey({keys:e},t);if(n){const[e,t]=n;this.privateKeys.set(e,t)}return n}return null}addPrivateKey(e,t,n){var i,r;this.privateKeys.set(e,n),null===(i=this.delegateCryptoCallbacks)||void 0===i||null===(r=i.cacheSecretStorageKey)||void 0===r||r.call(i,e,t,n)}}},2573:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.WITHHELD_MESSAGES=t.OlmDevice=void 0;var r=i(n(8416)),s=n(7434),o=n(7585),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(1994));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function c(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152){const t=new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is 49152 bytes.");throw t.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"},t}}t.OlmDevice=class{constructor(e){this.cryptoStore=e,(0,r.default)(this,"pickleKey","DEFAULT_KEY"),(0,r.default)(this,"deviceCurve25519Key",null),(0,r.default)(this,"deviceEd25519Key",null),(0,r.default)(this,"maxOneTimeKeys",null),(0,r.default)(this,"outboundGroupSessionStore",{}),(0,r.default)(this,"inboundGroupSessionMessageIndexes",{}),(0,r.default)(this,"sessionsInProgress",{}),(0,r.default)(this,"olmPrekeyPromise",Promise.resolve())}static getOlmVersion(){return n.g.Olm.get_library_version()}async init({pickleKey:e,fromExportedDevice:t}={}){let i;const r=new n.g.Olm.Account;try{t?(e&&s.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this.pickleKey=t.pickleKey,await this.initialiseFromExportedDevice(t,r)):(e&&(this.pickleKey=e),await this.initialiseAccount(r)),i=JSON.parse(r.identity_keys()),this.maxOneTimeKeys=r.max_number_of_one_time_keys()}finally{r.free()}this.deviceCurve25519Key=i.curve25519,this.deviceEd25519Key=i.ed25519}async initialiseFromExportedDevice(e,t){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.storeAccount(t,e.pickledAccount),e.sessions.forEach((e=>{const{deviceKey:n,sessionId:i}=e,r={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};this.cryptoStore.storeEndToEndSession(n,i,r,t)}))})),t.unpickle(this.pickleKey,e.pickledAccount)}async initialiseAccount(e){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.cryptoStore.getAccount(t,(n=>{null!==n?e.unpickle(this.pickleKey,n):(e.create(),n=e.pickle(this.pickleKey),this.cryptoStore.storeAccount(t,n))}))}))}getAccount(e,t){this.cryptoStore.getAccount(e,(e=>{const i=new n.g.Olm.Account;try{i.unpickle(this.pickleKey,e),t(i)}finally{i.free()}}))}storeAccount(e,t){this.cryptoStore.storeAccount(e,t.pickle(this.pickleKey))}async export(){const e={pickleKey:this.pickleKey};return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getAccount(t,(t=>{e.pickledAccount=t})),e.sessions=[],this.cryptoStore.getAllEndToEndSessions(t,(t=>{e.sessions.push(t)}))})),e}getSession(e,t,n,i){this.cryptoStore.getEndToEndSession(e,t,n,(e=>{this.unpickleSession(e,i)}))}unpickleSession(e,t){const i=new n.g.Olm.Session;try{i.unpickle(this.pickleKey,e.session),t(Object.assign({},e,{session:i}))}finally{i.free()}}saveSession(e,t,n){const i=t.session.session_id(),r=Object.assign(t,{session:t.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(e,i,r,n)}getUtility(e){const t=new n.g.Olm.Utility;try{return e(t)}finally{t.free()}}async sign(e){let t;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(n=>{this.getAccount(n,(n=>{t=n.sign(e)}))})),t}async getOneTimeKeys(){let e;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(t=>{e=JSON.parse(t.one_time_keys())}))})),e}maxNumberOfOneTimeKeys(){return this.maxOneTimeKeys}async markKeysAsPublished(){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.mark_keys_as_published(),this.storeAccount(e,t)}))}))}generateOneTimeKeys(e){return this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(n=>{n.generate_one_time_keys(e),this.storeAccount(t,n)}))}))}async generateFallbackKey(){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.generate_fallback_key(),this.storeAccount(e,t)}))}))}async getFallbackKey(){let e;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(t=>{e=JSON.parse(t.unpublished_fallback_key())}))})),e}async forgetOldFallbackKey(){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.forget_old_fallback_key(),this.storeAccount(e,t)}))}))}async createOutboundSession(e,t){let i;return await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(r=>{this.getAccount(r,(s=>{const o=new n.g.Olm.Session;try{o.create_outbound(s,e,t),i=o.session_id(),this.storeAccount(r,s);const n={session:o,lastReceivedMessageTs:Date.now()};this.saveSession(e,n,r)}finally{o.free()}}))}),s.logger.withPrefix("[createOutboundSession]")),i}async createInboundSession(e,t,i){if(0!==t)throw new Error("Need messageType == 0 to create inbound session");let r;return await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(s=>{this.getAccount(s,(o=>{const a=new n.g.Olm.Session;try{a.create_inbound_from(o,e,i),o.remove_one_time_keys(a),this.storeAccount(s,o);const n=a.decrypt(t,i),l={session:a,lastReceivedMessageTs:Date.now()};this.saveSession(e,l,s),r={payload:n,session_id:a.session_id()}}finally{a.free()}}))}),s.logger.withPrefix("[createInboundSession]")),r}async getSessionIdsForDevice(e){const t=s.logger.withPrefix("[getSessionIdsForDevice]");if(this.sessionsInProgress[e]){t.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch(e){}}let n;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getEndToEndSessions(e,t,(e=>{n=Object.keys(e)}))}),t),n}async getSessionIdForDevice(e,t=!1,n){const i=await this.getSessionInfoForDevice(e,t,n);if(0===i.length)return null;let r=0;for(let e=1;e<i.length;e++){const t=i[e],n=void 0===t.lastReceivedMessageTs?0:t.lastReceivedMessageTs,s=i[r],o=void 0===s.lastReceivedMessageTs?0:s.lastReceivedMessageTs;(n>o||n===o&&t.sessionId<s.sessionId)&&(r=e)}return i[r].sessionId}async getSessionInfoForDevice(e,t=!1,n=s.logger){if(n=n.withPrefix("[getSessionInfoForDevice]"),this.sessionsInProgress[e]&&!t){n.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch(e){}}const i=[];return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getEndToEndSessions(e,t,(e=>{const t=Object.keys(e).sort();for(const n of t)this.unpickleSession(e[n],(e=>{i.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:n})}))}))}),n),i}async encryptMessage(e,t,n){let i;return c(n),await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_SESSIONS],(r=>{this.getSession(e,t,r,(o=>{const a=o.session.describe();s.logger.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+a),i=o.session.encrypt(n),this.saveSession(e,o,r)}))}),s.logger.withPrefix("[encryptMessage]")),i}async decryptMessage(e,t,n,i){let r;return await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_SESSIONS],(o=>{this.getSession(e,t,o,(a=>{const l=a.session.describe();s.logger.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+l),r=a.session.decrypt(n,i),a.lastReceivedMessageTs=Date.now(),this.saveSession(e,a,o)}))}),s.logger.withPrefix("[decryptMessage]")),r}async matchesSession(e,t,n,i){if(0!==n)return!1;let r;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SESSIONS],(n=>{this.getSession(e,t,n,(e=>{r=e.session.matches_inbound(i)}))}),s.logger.withPrefix("[matchesSession]")),r}async recordSessionProblem(e,t,n){await this.cryptoStore.storeEndToEndSessionProblem(e,t,n)}sessionMayHaveProblems(e,t){return this.cryptoStore.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this.cryptoStore.filterOutNotifiedErrorDevices(e)}saveOutboundGroupSession(e){this.outboundGroupSessionStore[e.session_id()]=e.pickle(this.pickleKey)}getOutboundGroupSession(e,t){const i=this.outboundGroupSessionStore[e];if(void 0===i)throw new Error("Unknown outbound group session "+e);const r=new n.g.Olm.OutboundGroupSession;try{return r.unpickle(this.pickleKey,i),t(r)}finally{r.free()}}createOutboundGroupSession(){const e=new n.g.Olm.OutboundGroupSession;try{return e.create(),this.saveOutboundGroupSession(e),e.session_id()}finally{e.free()}}encryptGroupMessage(e,t){return s.logger.log(`encrypting msg with megolm session ${e}`),c(t),this.getOutboundGroupSession(e,(e=>{const n=e.encrypt(t);return this.saveOutboundGroupSession(e),n}))}getOutboundGroupSessionKey(e){return this.getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))}unpickleInboundGroupSession(e,t){const i=new n.g.Olm.InboundGroupSession;try{return i.unpickle(this.pickleKey,e.session),t(i)}finally{i.free()}}getInboundGroupSession(e,t,n,i,r){this.cryptoStore.getEndToEndInboundGroupSession(t,n,i,((t,n)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this.unpickleInboundGroupSession(t,(e=>{r(e,t,n)}))}else r(null,null,n)}))}async addInboundGroupSession(e,t,i,r,a,l,c,d={}){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,o.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(o=>{this.getInboundGroupSession(e,t,r,o,((h,u)=>{const p=new n.g.Olm.InboundGroupSession;try{if(c?p.import_session(a):p.create(a),r!=p.session_id())throw new Error("Mismatched group session ID from senderKey: "+t);if(h&&(s.logger.log("Update for megolm session "+t+"/"+r),h.first_known_index()<=p.first_known_index())){if(!u.untrusted||d.untrusted)return void s.logger.log(`Keeping existing megolm session ${r}`);if(h.first_known_index()<p.first_known_index())return void(h.export_session(p.first_known_index())===p.export_session(p.first_known_index())?(s.logger.info("Upgrading trust of existing megolm session "+r+" based on newly-received trusted session"),u.untrusted=!1,this.cryptoStore.storeEndToEndInboundGroupSession(t,r,u,o)):s.logger.warn("Newly-received megolm session "+r+" does not match existing session! Keeping existing session"))}s.logger.info("Storing megolm session "+t+"/"+r+" with first index "+p.first_known_index());const n=Object.assign({},d,{room_id:e,session:p.pickle(this.pickleKey),keysClaimed:l,forwardingCurve25519KeyChain:i});this.cryptoStore.storeEndToEndInboundGroupSession(t,r,n,o),!h&&d.sharedHistory&&this.cryptoStore.addSharedHistoryInboundGroupSession(e,t,r,o)}finally{p.free()}}))}),s.logger.withPrefix("[addInboundGroupSession]"))}async addInboundGroupSessionWithheld(e,t,n,i,r){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this.cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,n,{room_id:e,code:i,reason:r},s)}))}async decryptGroupMessage(e,t,n,i,r,l){let c,d;if(await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this.getInboundGroupSession(e,t,n,s,((e,o,u)=>{if(null===e)return u&&(d=new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",h(u),{session:t+"|"+n})),void(c=null);let p;try{p=e.decrypt(i)}catch(e){return void(d=e&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.message&&u?new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",h(u),{session:t+"|"+n}):e)}let m=p.plaintext;if(void 0===m)m=p;else{const e=t+"|"+n+"|"+p.message_index;if(e in this.inboundGroupSessionMessageIndexes){const t=this.inboundGroupSessionMessageIndexes[e];if(t.id!==r||t.timestamp!==l)return void(d=new Error("Duplicate message index, possible replay attack: "+e))}this.inboundGroupSessionMessageIndexes[e]={id:r,timestamp:l}}o.session=e.pickle(this.pickleKey),this.cryptoStore.storeEndToEndInboundGroupSession(t,n,o,s),c={result:m,keysClaimed:o.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:o.forwardingCurve25519KeyChain||[],untrusted:o.untrusted}}))}),s.logger.withPrefix("[decryptGroupMessage]")),d)throw d;return c}async hasInboundSessionKeys(e,t,n){let i;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(r=>{this.cryptoStore.getEndToEndInboundGroupSession(t,n,r,(r=>{null!==r?e!==r.room_id?(s.logger.warn(`requested keys for inbound group session ${t}|${n}, with incorrect room_id (expected ${r.room_id}, was ${e})`),i=!1):i=!0:i=!1}))}),s.logger.withPrefix("[hasInboundSessionKeys]")),i}async getInboundGroupSessionKey(e,t,n,i){let r;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this.getInboundGroupSession(e,t,n,s,((e,t)=>{if(null===e)return void(r=null);void 0===i&&(i=e.first_known_index());const n=e.export_session(i),s=(t.keysClaimed||{}).ed25519||null,o=t.forwardingCurve25519KeyChain||[],a="untrusted"in t?t.untrusted:o.length>0;r={chain_index:i,key:n,forwarding_curve25519_key_chain:o,sender_claimed_ed25519_key:s,shared_history:t.sharedHistory||!1,untrusted:a}}))}),s.logger.withPrefix("[getInboundGroupSessionKey]")),r}exportInboundGroupSession(e,t,n){return this.unpickleInboundGroupSession(n,(i=>{const r=i.first_known_index();return{sender_key:e,sender_claimed_keys:n.keysClaimed,room_id:n.room_id,session_id:t,session_key:i.export_session(r),forwarding_curve25519_key_chain:n.forwardingCurve25519KeyChain||[],first_known_index:i.first_known_index(),"org.matrix.msc3061.shared_history":n.sharedHistory||!1}}))}async getSharedHistoryInboundGroupSessions(e){let t;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(n=>{t=this.cryptoStore.getSharedHistoryInboundGroupSessions(e,n)}),s.logger.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]")),t}verifySignature(e,t,n){this.getUtility((function(i){i.ed25519_verify(e,t,n)}))}};const d={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function h(e){return e.code&&e.code in d?d[e.code]:e.reason?e.reason:"decryption key withheld"}t.WITHHELD_MESSAGES=d},6617:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomKeyRequestState=t.OutgoingRoomKeyRequestManager=void 0;var r=i(n(8416)),s=n(7434),o=n(2481);let a;function l(e){return e.room_id+" / "+e.session_id}function c(e){return"["+e.map((e=>`${e.userId}:${e.deviceId}`)).join(",")+"]"}t.RoomKeyRequestState=a,function(e){e[e.Unsent=0]="Unsent",e[e.Sent=1]="Sent",e[e.CancellationPending=2]="CancellationPending",e[e.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend"}(a||(t.RoomKeyRequestState=a={})),t.OutgoingRoomKeyRequestManager=class{constructor(e,t,n){this.baseApis=e,this.deviceId=t,this.cryptoStore=n,(0,r.default)(this,"sendOutgoingRoomKeyRequestsTimer",null),(0,r.default)(this,"sendOutgoingRoomKeyRequestsRunning",!1),(0,r.default)(this,"clientRunning",!1)}start(){this.clientRunning=!0}stop(){s.logger.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}sendQueuedRequests(){this.startTimer()}async queueRoomKeyRequest(e,t,n=!1){const i=await this.cryptoStore.getOutgoingRoomKeyRequest(e);if(i)switch(i.state){case a.CancellationPendingAndWillResend:case a.Unsent:return;case a.CancellationPending:{const e=n?a.CancellationPendingAndWillResend:a.Sent;await this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,a.CancellationPending,{state:e,cancellationTxnId:this.baseApis.makeTxnId()});break}case a.Sent:if(n){const r=a.CancellationPendingAndWillResend,o=await this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,a.Sent,{state:r,cancellationTxnId:this.baseApis.makeTxnId(),requestTxnId:this.baseApis.makeTxnId()});if(!o)return this.queueRoomKeyRequest(e,t,n);try{await this.sendOutgoingRoomKeyRequestCancellation(o,!0)}catch(e){s.logger.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+i.state)}else await this.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:this.baseApis.makeTxnId(),state:a.Unsent})}cancelRoomKeyRequest(e){return this.cryptoStore.getOutgoingRoomKeyRequest(e).then((t=>{if(t)switch(t.state){case a.CancellationPending:case a.CancellationPendingAndWillResend:return;case a.Unsent:return s.logger.log("deleting unnecessary room key request for "+l(e)),this.cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,a.Unsent);case a.Sent:return this.cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,a.Sent,{state:a.CancellationPending,cancellationTxnId:this.baseApis.makeTxnId()}).then((t=>{t?this.sendOutgoingRoomKeyRequestCancellation(t).catch((e=>{s.logger.error("Error sending room key request cancellation; will retry later.",e),this.startTimer()})):s.logger.log("Tried to cancel room key request for "+l(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+t.state)}}))}getOutgoingSentRoomKeyRequest(e,t){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[a.Sent])}async cancelAndResendAllOutgoingRequests(){const e=await this.cryptoStore.getAllOutgoingRoomKeyRequestsByState(a.Sent);return Promise.all(e.map((({requestBody:e,recipients:t})=>this.queueRoomKeyRequest(e,t,!0))))}startTimer(){this.sendOutgoingRoomKeyRequestsTimer||(this.sendOutgoingRoomKeyRequestsTimer=setTimeout((()=>{if(this.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this.sendOutgoingRoomKeyRequestsRunning=!0,this.sendOutgoingRoomKeyRequests().finally((()=>{this.sendOutgoingRoomKeyRequestsRunning=!1})).catch((e=>{s.logger.warn(`error in OutgoingRoomKeyRequestManager: ${e}`)}))}),500))}sendOutgoingRoomKeyRequests(){return this.clientRunning?this.cryptoStore.getOutgoingRoomKeyRequestByState([a.CancellationPending,a.CancellationPendingAndWillResend,a.Unsent]).then((e=>{if(!e)return void(this.sendOutgoingRoomKeyRequestsTimer=null);let t;switch(e.state){case a.Unsent:t=this.sendOutgoingRoomKeyRequest(e);break;case a.CancellationPending:t=this.sendOutgoingRoomKeyRequestCancellation(e);break;case a.CancellationPendingAndWillResend:t=this.sendOutgoingRoomKeyRequestCancellation(e,!0)}return t.then((()=>this.sendOutgoingRoomKeyRequests())).catch((e=>{s.logger.error("Error sending room key request; will retry later.",e),this.sendOutgoingRoomKeyRequestsTimer=null}))})):(this.sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}sendOutgoingRoomKeyRequest(e){s.logger.log(`Requesting keys for ${l(e.requestBody)} from ${c(e.recipients)}(id ${e.requestId})`);const t={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then((()=>this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.Unsent,{state:a.Sent})))}sendOutgoingRoomKeyRequestCancellation(e,t=!1){s.logger.log(`Sending cancellation for key request for ${l(e.requestBody)} to ${c(e.recipients)} (cancellation id ${e.cancellationTxnId})`);const n={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(n,e.recipients,e.cancellationTxnId).then((()=>t?this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.CancellationPendingAndWillResend,{state:a.Unsent}):this.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,a.CancellationPending)))}sendMessageToDevices(e,t,n){const i={};for(const n of t)i[n.userId]||(i[n.userId]={}),i[n.userId][n.deviceId]=e;return this.baseApis.sendToDevice(o.EventType.RoomKeyRequest,i,n)}}},635:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var r=i(n(8416)),s=n(7585);t.RoomList=class{constructor(e){this.cryptoStore=e,(0,r.default)(this,"roomEncryption",{})}async init(){await this.cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ROOMS],(e=>{this.cryptoStore.getEndToEndRooms(e,(e=>{this.roomEncryption=e}))}))}getRoomEncryption(e){return this.roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}async setRoomEncryption(e,t){this.roomEncryption[e]=t,await this.cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ROOMS],(n=>{this.cryptoStore.storeEndToEndRoom(e,t,n)}))}}},4823:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SecretStorage=t.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var r=i(n(8416)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(2772)),a=n(8401),l=n(2611),c=n(8070);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const h="m.secret_storage.v1.aes-hmac-sha2";t.SECRET_STORAGE_ALGORITHM_V1_AES=h,t.SecretStorage=class{constructor(e,t,n){this.accountDataAdapter=e,this.cryptoCallbacks=t,this.baseApis=n,(0,r.default)(this,"requests",new Map)}async getDefaultKeyId(){const e=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise(((t,n)=>{const i=n=>{"m.secret_storage.default_key"===n.getType()&&n.getContent().key===e&&(this.accountDataAdapter.removeListener(c.ClientEvent.AccountData,i),t())};this.accountDataAdapter.on(c.ClientEvent.AccountData,i),this.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:e}).catch((e=>{this.accountDataAdapter.removeListener(c.ClientEvent.AccountData,i),n(e)}))}))}async addKey(e,t,n){const i={algorithm:e};if(t||(t={}),t.name&&(i.name=t.name),e!==h)throw new Error(`Unknown key algorithm ${e}`);if(t.passphrase&&(i.passphrase=t.passphrase),t.key){const{iv:e,mac:n}=await(0,l.calculateKeyCheck)(t.key);i.iv=e,i.mac=n}if(!n)do{n=(0,a.randomString)(32)}while(await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${n}`));return await this.accountDataAdapter.setAccountData(`m.secret_storage.key.${n}`,i),{keyId:n,keyInfo:i}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const t=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);return t?[e,t]:null}async hasKey(e){return Boolean(await this.getKey(e))}async checkKey(e,t){if(t.algorithm===h){if(t.mac){const{mac:n}=await(0,l.calculateKeyCheck)(e,t.iv);return t.mac.replace(/=+$/g,"")===n.replace(/=+$/g,"")}return!0}throw new Error("Unknown algorithm")}async store(e,t,n){const i={};if(!n){const e=await this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");n=[e]}if(0===n.length)throw new Error("Zero keys given to encrypt with!");for(const r of n){const n=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+r);if(!n)throw new Error("Unknown key: "+r);if(n.algorithm===h){const s={[r]:n},[,o]=await this.getSecretStorageKey(s,e);i[r]=await o.encrypt(t)}else s.logger.warn("unknown algorithm for secret storage key "+r+": "+n.algorithm)}await this.accountDataAdapter.setAccountData(e,{encrypted:i})}async get(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted)throw new Error("Content is not encrypted!");const n={};for(const e of Object.keys(t.encrypted)){const i=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e),r=t.encrypted[e];i.algorithm===h&&r.iv&&r.ciphertext&&r.mac&&(n[e]=i)}if(0===Object.keys(n).length)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);let i,r;try{[i,r]=await this.getSecretStorageKey(n,e);const s=t.encrypted[i];return s.passthrough?(0,o.encodeBase64)(r.get_private_key()):r.decrypt(s)}finally{r&&r.free&&r.free()}}async isStored(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(null==t||!t.encrypted)return null;const n={};for(const e of Object.keys(t.encrypted)){const i=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);if(!i)continue;const r=t.encrypted[e];i.algorithm===h&&r.iv&&r.ciphertext&&r.mac&&(n[e]=i)}return Object.keys(n).length?n:null}request(e,t){const n=this.baseApis.makeTxnId();let i,r;const o=new Promise(((e,t)=>{i=e,r=t}));this.requests.set(n,{name:e,devices:t,resolve:i,reject:r});const a={name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:n},l={};for(const e of t)l[e]=a;return s.logger.info(`Request secret ${e} from ${t}, id ${n}`),this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:l}),{requestId:n,promise:o,cancel:e=>{const i={action:"request_cancellation",requesting_device_id:this.baseApis.deviceId,request_id:n},s={};for(const e of t)s[e]=i;this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:s}),r(new Error(e||"Cancelled"))}}}async onRequestReceived(e){const t=e.getSender(),n=e.getContent();if(t!==this.baseApis.getUserId()||!(n.name&&n.action&&n.requesting_device_id&&n.request_id))return;const i=n.requesting_device_id;if("request_cancellation"===n.action);else if("request"===n.action){if(i===this.baseApis.deviceId)return;if(s.logger.info("received request for secret ("+t+", "+i+", "+n.request_id+")"),!this.cryptoCallbacks.onSecretRequested)return;const e=await this.cryptoCallbacks.onSecretRequested(t,i,n.request_id,n.name,this.baseApis.checkDeviceTrust(t,i));if(e){s.logger.info(`Preparing ${n.name} secret for ${i}`);const r={type:"m.secret.send",content:{request_id:n.request_id,secret:e}},a={algorithm:o.OLM_ALGORITHM,sender_key:this.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{}};await o.ensureOlmSessionsForDevices(this.baseApis.crypto.olmDevice,this.baseApis,{[t]:[this.baseApis.getStoredDevice(t,i)]}),await o.encryptMessageForDevice(a.ciphertext,this.baseApis.getUserId(),this.baseApis.deviceId,this.baseApis.crypto.olmDevice,t,this.baseApis.getStoredDevice(t,i),r);const l={[t]:{[i]:a}};s.logger.info(`Sending ${n.name} secret for ${i}`),this.baseApis.sendToDevice("m.room.encrypted",l)}else s.logger.info(`Request denied for ${n.name} secret for ${i}`)}}onSecretReceived(e){if(e.getSender()!==this.baseApis.getUserId())return;if(!o.isOlmEncrypted(e))return void s.logger.error("secret event not properly encrypted");const t=e.getContent();if(this.baseApis.crypto.deviceList.getUserByIdentityKey(o.OLM_ALGORITHM,e.getSenderKey()||"")!==e.getSender())return void s.logger.error("sending device does not belong to the user it claims to be from");s.logger.log("got secret share for request",t.request_id);const n=this.requests.get(t.request_id);if(n){const i=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(o.OLM_ALGORITHM,e.getSenderKey());if(!i)return void s.logger.log("secret share from unknown device with key",e.getSenderKey());if(!n.devices.includes(i.deviceId))return void s.logger.log("unsolicited secret share from device",i.deviceId);if(!this.baseApis.crypto.checkDeviceInfoTrust(e.getSender(),i).isVerified())return void s.logger.log("secret share from unverified device");s.logger.log(`Successfully received secret ${n.name} from ${i.deviceId}`),n.resolve(t.secret)}}async getSecretStorageKey(e,t){if(!this.cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const n=await this.cryptoCallbacks.getSecretStorageKey({keys:e},t);if(!n)throw new Error("getSecretStorageKey callback returned falsey");if(n.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[i,r]=n;if(!e[i])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[i].algorithm===h)return[i,{encrypt:function(e){return(0,l.encryptAES)(e,r,t)},decrypt:function(e){return(0,l.decryptAES)(e,r,t)}}];throw new Error("Unknown key type: "+e[i].algorithm)}}},2611:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateKeyCheck=function(e,t){return c("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",e,"",t)},t.decryptAES=function(e,t,n){return s?async function(e,t,n){const[i,o]=await l(t,n),a=(0,r.decodeBase64)(e.ciphertext);if(!await s.verify({name:"HMAC"},o,(0,r.decodeBase64)(e.mac),a))throw new Error(`Error decrypting secret ${n}: bad MAC`);const c=await s.decrypt({name:"AES-CTR",counter:(0,r.decodeBase64)(e.iv),length:64},i,a);return(new TextDecoder).decode(new Uint8Array(c))}(e,t,n):async function(e,t,n){const s=(0,i.getCrypto)();if(!s)throw new Error("No usable crypto implementation");const[o,l]=a(t,n);if(s.createHmac("sha256",l).update(Buffer.from(e.ciphertext,"base64")).digest("base64").replace(/=+$/g,"")!==e.mac.replace(/=+$/g,""))throw new Error(`Error decrypting secret ${n}: bad MAC`);const c=s.createDecipheriv("aes-256-ctr",o,(0,r.decodeBase64)(e.iv));return c.update(e.ciphertext,"base64","utf8")+c.final("utf8")}(e,t,n)},t.encryptAES=c;var i=n(3102),r=n(2772);const s="undefined"!=typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,o=new Uint8Array(8);function a(e,t){const n=(0,i.getCrypto)(),r=n.createHmac("sha256",o).update(e).digest(),s=Buffer.alloc(1,1),a=n.createHmac("sha256",r).update(t,"utf8").update(s).digest();return s[0]=2,[a,n.createHmac("sha256",r).update(a).update(t,"utf8").update(s).digest()]}async function l(e,t){const n=await s.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),i=await s.deriveBits({name:"HKDF",salt:o,info:(new TextEncoder).encode(t),hash:"SHA-256"},n,512),r=i.slice(0,32),a=i.slice(32),l=s.importKey("raw",r,{name:"AES-CTR"},!1,["encrypt","decrypt"]),c=s.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([l,c])}function c(e,t,n,o){return s?async function(e,t,n,i){let o;i?o=(0,r.decodeBase64)(i):(o=new Uint8Array(16),window.crypto.getRandomValues(o),o[8]&=127);const[a,c]=await l(t,n),d=(new TextEncoder).encode(e),h=await s.encrypt({name:"AES-CTR",counter:o,length:64},a,d),u=await s.sign({name:"HMAC"},c,h);return{iv:(0,r.encodeBase64)(o),ciphertext:(0,r.encodeBase64)(h),mac:(0,r.encodeBase64)(u)}}(e,t,n,o):async function(e,t,n,s){const o=(0,i.getCrypto)();if(!o)throw new Error("No usable crypto implementation");let l;s?l=(0,r.decodeBase64)(s):(l=o.randomBytes(16),l[8]&=127);const[c,d]=a(t,n),h=o.createCipheriv("aes-256-ctr",c,l),u=Buffer.concat([h.update(e,"utf8"),h.final()]),p=o.createHmac("sha256",d).update(u).digest("base64");return{iv:(0,r.encodeBase64)(l),ciphertext:u.toString("base64"),mac:p}}(e,t,n,o)}},1897:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownDeviceError=t.EncryptionAlgorithm=t.ENCRYPTION_CLASSES=t.DecryptionError=t.DecryptionAlgorithm=t.DECRYPTION_CLASSES=void 0,t.registerAlgorithm=function(e,t,n){s.set(e,t),o.set(e,n)};var r=i(n(8416));const s=new Map;t.ENCRYPTION_CLASSES=s;const o=new Map;t.DECRYPTION_CLASSES=o,t.EncryptionAlgorithm=class{constructor(e){(0,r.default)(this,"userId",void 0),(0,r.default)(this,"deviceId",void 0),(0,r.default)(this,"crypto",void 0),(0,r.default)(this,"olmDevice",void 0),(0,r.default)(this,"baseApis",void 0),(0,r.default)(this,"roomId",void 0),this.userId=e.userId,this.deviceId=e.deviceId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}prepareToEncrypt(e){}onRoomMembership(e,t,n){}},t.DecryptionAlgorithm=class{constructor(e){(0,r.default)(this,"userId",void 0),(0,r.default)(this,"crypto",void 0),(0,r.default)(this,"olmDevice",void 0),(0,r.default)(this,"baseApis",void 0),(0,r.default)(this,"roomId",void 0),this.userId=e.userId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}async onRoomKeyEvent(e){}async importRoomKey(e,t){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){return!1}};class a extends Error{constructor(e,t,n){super(t),this.code=e,(0,r.default)(this,"detailedString",void 0),this.code=e,this.name="DecryptionError",this.detailedString=function(e,t){let n=e.name+"[msg: "+e.message;return t&&(n+=", "+Object.keys(t).map((e=>e+": "+t[e])).join(", ")),n+="]",n}(this,n)}}t.DecryptionError=a;class l extends Error{constructor(e,t){super(e),this.devices=t,this.name="UnknownDeviceError",this.devices=t}}t.UnknownDeviceError=l},1994:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(3072),n(7125);var i=n(1897);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},7125:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.isRoomSharedHistory=h;var r=i(n(8416)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(2772)),a=n(1897),l=n(2573),c=n(6617);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function h(e){var t,n;const i=null==e||null===(t=e.currentState)||void 0===t?void 0:t.getStateEvents("m.room.history_visibility",""),r=null==i||null===(n=i.getContent())||void 0===n?void 0:n.history_visibility;return["world_readable","shared"].includes(r)}class u{constructor(e,t=!1){this.sessionId=e,this.sharedHistory=t,(0,r.default)(this,"useCount",0),(0,r.default)(this,"creationTime",void 0),(0,r.default)(this,"sharedWithDevices",{}),(0,r.default)(this,"blockedDevicesNotified",{}),this.creationTime=(new Date).getTime()}needsRotation(e,t){const n=(new Date).getTime()-this.creationTime;return(this.useCount>=e||n>=t)&&(s.logger.log("Rotating megolm session after "+this.useCount+" messages, "+n+"ms"),!0)}markSharedWithDevice(e,t,n,i){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]={deviceKey:n,messageIndex:i}}markNotifiedBlockedDevice(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0}sharedWithTooManyDevices(e){for(const t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return s.logger.log("Starting new megolm session because we shared with "+t),!0;for(const n in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(n)&&!e[t].hasOwnProperty(n))return s.logger.log("Starting new megolm session because we shared with "+t+":"+n),!0}return!1}}class p extends a.EncryptionAlgorithm{constructor(e){var t,n,i,s;super(e),(0,r.default)(this,"setupPromise",Promise.resolve(null)),(0,r.default)(this,"outboundSessions",{}),(0,r.default)(this,"sessionRotationPeriodMsgs",void 0),(0,r.default)(this,"sessionRotationPeriodMs",void 0),(0,r.default)(this,"encryptionPreparation",void 0),this.sessionRotationPeriodMsgs=null!==(t=null===(n=e.config)||void 0===n?void 0:n.rotation_period_msgs)&&void 0!==t?t:100,this.sessionRotationPeriodMs=null!==(i=null===(s=e.config)||void 0===s?void 0:s.rotation_period_ms)&&void 0!==i?i:6048e5}async ensureOutboundSession(e,t,n,i=!1){const r=this.setupPromise.then((async r=>{const o=h(e),a=await this.prepareSession(t,o,r);try{await this.shareSession(t,o,i,n,a)}catch(e){s.logger.error(`Failed to ensure outbound session in ${this.roomId}`,e)}return a}));return r.catch((e=>{s.logger.error(`Failed to setup outbound session in ${this.roomId}`,e)})),this.setupPromise=r,r}async prepareSession(e,t,n){var i,r;return n&&t!==n.sharedHistory&&(n=null),null!==(i=n)&&void 0!==i&&i.needsRotation(this.sessionRotationPeriodMsgs,this.sessionRotationPeriodMs)&&(s.logger.log("Starting new megolm session because we need to rotate."),n=null),null!==(r=n)&&void 0!==r&&r.sharedWithTooManyDevices(e)&&(n=null),n||(s.logger.log(`Starting new megolm session for room ${this.roomId}`),n=await this.prepareNewSession(t),s.logger.log(`Started new megolm session ${n.sessionId} for room ${this.roomId}`),this.outboundSessions[n.sessionId]=n),n}async shareSession(e,t,n,i,r){const a={};for(const[t,n]of Object.entries(e))for(const[e,i]of Object.entries(n))i.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(r.sharedWithDevices[t]&&void 0!==r.sharedWithDevices[t][e]||(a[t]=a[t]||[],a[t].push(i)));const l=this.olmDevice.getOutboundGroupSessionKey(r.sessionId),c={type:"m.room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:r.sessionId,session_key:l.key,chain_index:l.chain_index,"org.matrix.msc3061.shared_history":t}},[d,h]=await o.getExistingOlmSessions(this.olmDevice,this.baseApis,a);await Promise.all([(async()=>{s.logger.debug(`Sharing keys with existing Olm sessions in ${this.roomId}`,h),await this.shareKeyWithOlmSessions(r,l,c,h),s.logger.debug(`Shared keys with existing Olm sessions in ${this.roomId}`)})(),(async()=>{s.logger.debug(`Sharing keys (start phase 1) with new Olm sessions in ${this.roomId}`,d);const e=[],t=Date.now(),i=[];await this.shareKeyWithDevices(r,l,c,d,e,n?1e4:2e3,i),s.logger.debug(`Shared keys (end phase 1) with new Olm sessions in ${this.roomId}`),!n&&Date.now()-t<1e4?(async()=>{const t={},n=new Set;for(const e of i)n.add(e);const o=[];for(const{userId:i,deviceInfo:r}of e){const e=i.slice(i.indexOf(":")+1);n.has(e)?(t[i]=t[i]||[],t[i].push(r)):o.push({userId:i,deviceInfo:r})}s.logger.debug(`Sharing keys (start phase 2) with new Olm sessions in ${this.roomId}`),await this.shareKeyWithDevices(r,l,c,t,o,3e4),s.logger.debug(`Shared keys (end phase 2) with new Olm sessions in ${this.roomId}`),await this.notifyFailedOlmDevices(r,l,o)})():await this.notifyFailedOlmDevices(r,l,e),s.logger.debug(`Shared keys (all phases done) with new Olm sessions in ${this.roomId}`)})(),(async()=>{s.logger.debug(`There are ${Object.entries(i).length} blocked devices in ${this.roomId}`,Object.entries(i)),s.logger.debug(`Notifying newly blocked devices in ${this.roomId}`);const e={};let t=0;for(const[n,s]of Object.entries(i))for(const[i,o]of Object.entries(s))r.blockedDevicesNotified[n]&&void 0!==r.blockedDevicesNotified[n][i]||(e[n]=e[n]||{},e[n][i]={device:o},t++);await this.notifyBlockedDevices(r,e),s.logger.debug(`Notified ${t} newly blocked devices in ${this.roomId}`,e)})()])}async prepareNewSession(e){const t=this.olmDevice.createOutboundGroupSession(),n=this.olmDevice.getOutboundGroupSessionKey(t);return await this.olmDevice.addInboundGroupSession(this.roomId,this.olmDevice.deviceCurve25519Key,[],t,n.key,{ed25519:this.olmDevice.deviceEd25519Key},!1,{sharedHistory:e}),this.crypto.backupManager.backupGroupSession(this.olmDevice.deviceCurve25519Key,t),new u(t,e)}getDevicesWithoutSessions(e,t,n=[]){for(const[i,r]of Object.entries(t)){const t=e[i];for(const e of r){const r=e.deviceId;t[r].sessionId||(n.push({userId:i,deviceInfo:e}),delete t[r])}}return n}splitDevices(e){let t=[];const n=[t];for(const[i,r]of Object.entries(e)){for(const e of Object.values(r))t.push({userId:i,deviceInfo:e.device});t.length>20&&(t=[],n.push(t))}return 0===t.length&&n.pop(),n}encryptAndSendKeysToDevices(e,t,n,i){return this.crypto.encryptAndSendToDevices(n,i).then((()=>{for(const i of n)e.markSharedWithDevice(i.userId,i.deviceInfo.deviceId,i.deviceInfo.getIdentityKey(),t)})).catch((e=>{throw s.logger.error("failed to encryptAndSendToDevices",e),e}))}async sendBlockedNotificationsToDevices(e,t,n){const i={};for(const e of t){const t=e.userId,r=e.deviceInfo,s=r.deviceInfo.deviceId,o=Object.assign({},n);o.code=r.code,o.reason=r.reason,"m.no_olm"===o.code&&(delete o.room_id,delete o.session_id),i[t]||(i[t]={}),i[t][s]=o}await this.baseApis.sendToDevice("m.room_key.withheld",i);for(const t of Object.keys(i))for(const n of Object.keys(i[t]))e.markNotifiedBlockedDevice(t,n)}async reshareKeyWithDevice(e,t,n,i){const r=this.outboundSessions[t];if(!r)return void s.logger.debug(`megolm session ${t} not found: not re-sharing keys`);if(void 0===r.sharedWithDevices[n])return void s.logger.debug(`megolm session ${t} never shared with user ${n}`);const a=r.sharedWithDevices[n][i.deviceId];if(void 0===a)return void s.logger.debug("megolm session ID "+t+" never shared with device "+n+":"+i.deviceId);if(a.deviceKey!==i.getIdentityKey())return void s.logger.warn(`Session has been shared with device ${i.deviceId} but with identity key ${a.deviceKey}. Key is now ${i.getIdentityKey()}!`);const l=await this.olmDevice.getInboundGroupSessionKey(this.roomId,e,t,a.messageIndex);if(!l)return void s.logger.warn(`No inbound session key found for megolm ${t}: not re-sharing keys`);await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[n]:[i]});const c={type:"m.forwarded_room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:t,session_key:l.key,chain_index:l.chain_index,sender_key:e,sender_claimed_ed25519_key:l.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:l.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":l.shared_history||!1}},d={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await o.encryptMessageForDevice(d.ciphertext,this.userId,this.deviceId,this.olmDevice,n,i,c),await this.baseApis.sendToDevice("m.room.encrypted",{[n]:{[i.deviceId]:d}}),s.logger.debug(`Re-shared key for megolm session ${t} with ${n}:${i.deviceId}`)}async shareKeyWithDevices(e,t,n,i,r,a,l){var c;s.logger.debug(`Ensuring Olm sessions for devices in ${this.roomId}`);const d=await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,i,!1,a,l,null===(c=s.logger.withPrefix)||void 0===c?void 0:c.call(s.logger,`[${this.roomId}]`));s.logger.debug(`Ensured Olm sessions for devices in ${this.roomId}`),this.getDevicesWithoutSessions(d,i,r),s.logger.debug(`Sharing keys with newly created Olm sessions in ${this.roomId}`),await this.shareKeyWithOlmSessions(e,t,n,d),s.logger.debug(`Shared keys with newly created Olm sessions in ${this.roomId}`)}async shareKeyWithOlmSessions(e,t,n,i){const r=this.splitDevices(i);for(let i=0;i<r.length;i++){const o=`megolm keys for ${e.sessionId} in ${this.roomId} (slice ${i+1}/${r.length})`;try{s.logger.debug(`Sharing ${o}`,r[i].map((e=>`${e.userId}/${e.deviceInfo.deviceId}`))),await this.encryptAndSendKeysToDevices(e,t.chain_index,r[i],n),s.logger.debug(`Shared ${o}`)}catch(e){throw s.logger.error(`Failed to share ${o}`),e}}}async notifyFailedOlmDevices(e,t,n){s.logger.debug(`Notifying ${n.length} devices we failed to create Olm sessions in ${this.roomId}`);for(const{userId:i,deviceInfo:r}of n){const n=r.deviceId;e.markSharedWithDevice(i,n,r.getIdentityKey(),t.chain_index)}const i=await this.olmDevice.filterOutNotifiedErrorDevices(n);s.logger.debug(`Need to notify ${i.length} failed devices which haven't been notified before in ${this.roomId}`);const r={};for(const{userId:e,deviceInfo:t}of i)r[e]=r[e]||{},r[e][t.deviceId]={device:{code:"m.no_olm",reason:l.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:t}};await this.notifyBlockedDevices(e,r),s.logger.debug(`Notified ${i.length} devices we failed to create Olm sessions in ${this.roomId}`)}async notifyBlockedDevices(e,t){const n={room_id:this.roomId,session_id:e.sessionId,algorithm:o.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key},i=this.splitDevices(t);for(let t=0;t<i.length;t++)try{await this.sendBlockedNotificationsToDevices(e,i[t],n),s.logger.log(`Completed blacklist notification for ${e.sessionId} in ${this.roomId} (slice ${t+1}/${i.length})`)}catch(n){throw s.logger.log(`blacklist notification for ${e.sessionId} in ${this.roomId} (slice ${t+1}/${i.length}) failed`),n}}prepareToEncrypt(e){if(null==this.encryptionPreparation)s.logger.debug(`Preparing to encrypt events for ${this.roomId}`),this.encryptionPreparation={startTime:Date.now(),promise:(async()=>{try{s.logger.debug(`Getting devices in ${this.roomId}`);const[t,n]=await this.getDevicesInRoom(e);this.crypto.getGlobalErrorOnUnknownDevices()&&this.removeUnknownDevices(t),s.logger.debug(`Ensuring outbound session in ${this.roomId}`),await this.ensureOutboundSession(e,t,n,!0),s.logger.debug(`Ready to encrypt events for ${this.roomId}`)}catch(e){s.logger.error(`Failed to prepare to encrypt events for ${this.roomId}`,e)}finally{delete this.encryptionPreparation}})()};else{const e=Date.now()-this.encryptionPreparation.startTime;s.logger.debug(`Already started preparing to encrypt for ${this.roomId} ${e} ms ago, skipping`)}}async encryptMessage(e,t,n){if(s.logger.log(`Starting to encrypt event for ${this.roomId}`),null!=this.encryptionPreparation)try{await this.encryptionPreparation.promise}catch(e){}const[i,r]=await this.getDevicesInRoom(e);this.crypto.getGlobalErrorOnUnknownDevices()&&this.checkForUnknownDevices(i);const a=await this.ensureOutboundSession(e,i,r),l={room_id:this.roomId,type:t,content:n},c=this.olmDevice.encryptGroupMessage(a.sessionId,JSON.stringify(l)),d={algorithm:o.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:c,session_id:a.sessionId,device_id:this.deviceId};return a.useCount++,d}forceDiscardSession(){this.setupPromise=this.setupPromise.then((()=>null))}checkForUnknownDevices(e){const t={};if(Object.keys(e).forEach((n=>{Object.keys(e[n]).forEach((i=>{const r=e[n][i];r.isUnverified()&&!r.isKnown()&&(t[n]||(t[n]={}),t[n][i]=r)}))})),Object.keys(t).length)throw new a.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)}removeUnknownDevices(e){for(const[t,n]of Object.entries(e)){for(const[e,t]of Object.entries(n))t.isUnverified()&&!t.isKnown()&&delete n[e];0===Object.keys(n).length&&delete e[t]}}async getDevicesInRoom(e){const t=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));let n=this.crypto.getGlobalBlacklistUnverifiedDevices();"boolean"==typeof e.getBlacklistUnverifiedDevices()&&(n=e.getBlacklistUnverifiedDevices());const i=await this.crypto.downloadKeys(t,!1),r={};for(const e in i){if(!i.hasOwnProperty(e))continue;const t=i[e];for(const i in t){if(!t.hasOwnProperty(i))continue;const s=this.crypto.checkDeviceTrust(e,i);if(t[i].isBlocked()||!s.isVerified()&&n){r[e]||(r[e]={});const n=t[i].isBlocked();r[e][i]={code:n?"m.blacklisted":"m.unverified",reason:l.WITHHELD_MESSAGES[n?"m.blacklisted":"m.unverified"],deviceInfo:t[i]},delete t[i]}}}return[i,r]}}class m extends a.DecryptionAlgorithm{constructor(...e){super(...e),(0,r.default)(this,"pendingEvents",new Map),(0,r.default)(this,"olmlib",o)}async decryptEvent(e){const t=e.getWireContent();if(!t.sender_key||!t.session_id||!t.ciphertext)throw new a.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");let n;this.addEventToPendingList(e);try{n=await this.olmDevice.decryptGroupMessage(e.getRoomId(),t.sender_key,t.session_id,t.ciphertext,e.getId(),e.getTs())}catch(n){if("DecryptionError"===n.name)throw n;let i="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw n&&"OLM.UNKNOWN_MESSAGE_INDEX"===n.message&&(this.requestKeysForEvent(e),i="OLM_UNKNOWN_MESSAGE_INDEX"),new a.DecryptionError(i,n?n.toString():"Unknown Error: Error is undefined",{session:t.sender_key+"|"+t.session_id})}if(null===n){this.crypto.backupManager.queryKeyBackupRateLimited(e.getRoomId(),t.session_id).catch((()=>{})),this.requestKeysForEvent(e);const n=await this.olmDevice.sessionMayHaveProblems(t.sender_key,e.getTs()-12e4);if(n){let e=g[n.type]||g.unknown;throw n.fixed&&(e+=" Trying to create a new secure channel and re-requesting the keys."),new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e,{session:t.sender_key+"|"+t.session_id})}throw new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:t.sender_key+"|"+t.session_id})}n.untrusted||this.removeEventFromPendingList(e);const i=JSON.parse(n.result);if(i.room_id!==e.getRoomId())throw new a.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+i.room_id);return{clearEvent:i,senderCurve25519Key:n.senderKey,claimedEd25519Key:n.keysClaimed.ed25519,forwardingCurve25519KeyChain:n.forwardingCurve25519KeyChain,untrusted:n.untrusted}}requestKeysForEvent(e){const t=e.getWireContent(),n=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},n)}addEventToPendingList(e){var t;const n=e.getWireContent(),i=n.sender_key,r=n.session_id;this.pendingEvents.has(i)||this.pendingEvents.set(i,new Map);const s=this.pendingEvents.get(i);s.has(r)||s.set(r,new Set),null===(t=s.get(r))||void 0===t||t.add(e)}removeEventFromPendingList(e){const t=e.getWireContent(),n=t.sender_key,i=t.session_id,r=this.pendingEvents.get(n),s=null==r?void 0:r.get(i);s&&(s.delete(e),0===s.size&&r.delete(i),0===r.size&&this.pendingEvents.delete(n))}async onRoomKeyEvent(e){const t=e.getContent();let n,i=e.getSenderKey(),r=[],a=!1;const l={};if(t.room_id&&t.session_key&&t.session_id&&t.algorithm)if(o.isOlmEncrypted(e)){if(t["org.matrix.msc3061.shared_history"]&&(l.sharedHistory=!0),"m.forwarded_room_key"==e.getType()){var d,h,u;const p=this.crypto.deviceList.getDeviceByIdentityKey(o.OLM_ALGORITHM,i);if(this.baseApis.crypto.deviceList.getUserByIdentityKey(o.OLM_ALGORITHM,i)!==e.getSender())return void s.logger.error("sending device does not belong to the user it claims to be from");const m=(p?await this.crypto.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e.getSender(),p.deviceId,[c.RoomKeyRequestState.Sent]):[]).some((e=>e.requestBody.room_id===t.room_id&&e.requestBody.session_id===t.session_id)),g=this.baseApis.getRoom(t.room_id),f=null==g||null===(d=g.getMember(this.userId))||void 0===d?void 0:d.events.member,v=(null==f?void 0:f.getSender())===e.getSender()||(null==f||null===(h=f.getUnsigned())||void 0===h?void 0:h.prev_sender)===e.getSender()&&"invite"===(null==f||null===(u=f.getPrevContent())||void 0===u?void 0:u.membership),y=e.getSender()===this.baseApis.getUserId();if(!m&&!y){if(!l.sharedHistory)return void s.logger.log("forwarded key not shared history - ignoring");if(g&&!v)return void s.logger.log("forwarded key not from inviter or from us - ignoring")}if(a=!0,r=Array.isArray(t.forwarding_curve25519_key_chain)?t.forwarding_curve25519_key_chain:[],r=r.slice(),r.push(i),!t.sender_key)return void s.logger.error("forwarded_room_key event is missing sender_key field");const b=t.sender_claimed_ed25519_key;if(!b)return void s.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");if(n={ed25519:b},!g){const i={senderId:e.getSender(),senderKey:t.sender_key,sessionId:t.session_id,sessionKey:t.session_key,keysClaimed:n,forwardingCurve25519KeyChain:r};return void await this.crypto.cryptoStore.doTxn("readwrite",["parked_shared_history"],(e=>this.crypto.cryptoStore.addParkedSharedHistory(t.room_id,i,e)),s.logger.withPrefix("[addParkedSharedHistory]"))}const w=this.crypto.deviceList.getDeviceByIdentityKey(o.OLM_ALGORITHM,i),S=this.crypto.checkDeviceInfoTrust(e.getSender(),w);if(y&&!S.isVerified())return;l.untrusted=!0,i=t.sender_key}else n=e.getKeysClaimed();t["org.matrix.msc3061.shared_history"]&&(l.sharedHistory=!0);try{await this.olmDevice.addInboundGroupSession(t.room_id,i,r,t.session_id,t.session_key,n,a,l),await this.retryDecryption(i,t.session_id,!l.untrusted)&&this.crypto.cancelRoomKeyRequest({algorithm:t.algorithm,room_id:t.room_id,session_id:t.session_id,sender_key:i}),await this.crypto.backupManager.backupGroupSession(i,t.session_id)}catch(e){s.logger.error(`Error handling m.room_key_event: ${e}`)}}else s.logger.error("key event not properly encrypted");else s.logger.error("key event is missing fields")}async onRoomKeyWithheldEvent(e){const t=e.getContent(),n=t.sender_key;if("m.no_olm"===t.code){const i=e.getSender();if(s.logger.warn(`${i}:${n} was unable to establish an olm session with us`),await this.olmDevice.getSessionIdForDevice(n))return s.logger.debug("New session already created.  Not creating a new one."),await this.olmDevice.recordSessionProblem(n,"no_olm",!0),void this.retryDecryptionFromSender(n);let r=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,n);if(!r&&(await this.crypto.downloadKeys([i],!1),r=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,n),!r))return s.logger.info("Couldn't find device for identity key "+n+": not establishing session"),await this.olmDevice.recordSessionProblem(n,"no_olm",!1),void this.retryDecryptionFromSender(n);await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[i]:[r]},!1);const a={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await o.encryptMessageForDevice(a.ciphertext,this.userId,void 0,this.olmDevice,i,r,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(n,"no_olm",!0),this.retryDecryptionFromSender(n),await this.baseApis.sendToDevice("m.room.encrypted",{[i]:{[r.deviceId]:a}})}else await this.olmDevice.addInboundGroupSessionWithheld(t.room_id,n,t.session_id,t.code,t.reason)}hasKeysForKeyRequest(e){const t=e.requestBody;return this.olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)}shareKeysWithDevice(e){const t=e.userId,n=e.deviceId,i=this.crypto.getStoredDevice(t,n),r=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[t]:[i]}).then((e=>e[t][n].sessionId?(s.logger.log("sharing keys for session "+r.sender_key+"|"+r.session_id+" with device "+t+":"+n),this.buildKeyForwardingMessage(r.room_id,r.sender_key,r.session_id)):null)).then((e=>{const r={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};return this.olmlib.encryptMessageForDevice(r.ciphertext,this.userId,void 0,this.olmDevice,t,i,e).then((()=>{const e={[t]:{[n]:r}};return this.baseApis.sendToDevice("m.room.encrypted",e)}))}))}async buildKeyForwardingMessage(e,t,n){const i=await this.olmDevice.getInboundGroupSessionKey(e,t,n);return{type:"m.forwarded_room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:i.sender_claimed_ed25519_key,session_id:n,session_key:i.key,chain_index:i.chain_index,forwarding_curve25519_key_chain:i.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":i.shared_history||!1}}}importRoomKey(e,t={}){const n={};return(t.untrusted||e.untrusted)&&(n.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(n.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,n).then((()=>{"backup"!==t.source&&this.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch((e=>{s.logger.log("Failed to back up megolm session",e)})),this.retryDecryption(e.sender_key,e.session_id,!n.untrusted)}))}async retryDecryption(e,t,n){var i;const r=this.pendingEvents.get(e);if(!r)return!0;const o=r.get(t);return!(o&&(s.logger.debug("Retrying decryption on events",[...o]),await Promise.all([...o].map((async e=>{try{await e.attemptDecryption(this.crypto,{isRetry:!0,forceRedecryptIfUntrusted:n})}catch(e){}}))),null!==(i=this.pendingEvents.get(e))&&void 0!==i&&i.has(t)))}async retryDecryptionFromSender(e){const t=this.pendingEvents.get(e);return!t||(this.pendingEvents.delete(e),await Promise.all([...t].map((async([e,t])=>{await Promise.all([...t].map((async e=>{try{await e.attemptDecryption(this.crypto)}catch(e){}})))}))),!this.pendingEvents.has(e))}async sendSharedHistoryInboundSessions(e){await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,e),s.logger.log("sendSharedHistoryInboundSessions to users",Object.keys(e));const t=await this.olmDevice.getSharedHistoryInboundGroupSessions(this.roomId);s.logger.log("shared-history sessions",t);for(const[n,i]of t){const t=await this.buildKeyForwardingMessage(this.roomId,n,i),r=[],a={};for(const[n,i]of Object.entries(e)){a[n]={};for(const e of i){const i={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};a[n][e.deviceId]=i,r.push(o.encryptMessageForDevice(i.ciphertext,this.userId,void 0,this.olmDevice,n,e,t))}}await Promise.all(r);for(const e of Object.keys(a)){for(const t of Object.keys(a[e]))0===Object.keys(a[e][t].ciphertext).length&&(s.logger.log("No ciphertext for device "+e+":"+t+": pruning"),delete a[e][t]);0===Object.keys(a[e]).length&&(s.logger.log("Pruned all devices for user "+e),delete a[e])}if(0===Object.keys(a).length)return void s.logger.log("No users left to send to: aborting");await this.baseApis.sendToDevice("m.room.encrypted",a)}}}const g={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};(0,a.registerAlgorithm)(o.MEGOLM_ALGORITHM,p,m)},3072:(e,t,n)=>{"use strict";var i=n(4836)(n(8416)),r=n(7434),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(2772)),o=n(3272),a=n(1897);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const c=o.DeviceInfo.DeviceVerification;class d extends a.EncryptionAlgorithm{constructor(...e){super(...e),(0,i.default)(this,"sessionPrepared",!1),(0,i.default)(this,"prepPromise",null)}ensureSession(e){return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then((()=>this.crypto.ensureOlmSessionsForUsers(e))).then((()=>{this.sessionPrepared=!0})).finally((()=>{this.prepPromise=null})),this.prepPromise)}async encryptMessage(e,t,n){const i=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));await this.ensureSession(i);const r={room_id:e.roomId,type:t,content:n},o={algorithm:s.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},a=[];for(let e=0;e<i.length;++e){const t=i[e],n=this.crypto.getStoredDevicesForUser(t)||[];for(let e=0;e<n.length;++e){const i=n[e];i.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&i.verified!=c.BLOCKED&&a.push(s.encryptMessageForDevice(o.ciphertext,this.userId,this.deviceId,this.olmDevice,t,i,r))}}return Promise.all(a).then((()=>o))}}class h extends a.DecryptionAlgorithm{async decryptEvent(e){const t=e.getWireContent(),n=t.sender_key,i=t.ciphertext;if(!i)throw new a.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this.olmDevice.deviceCurve25519Key in i))throw new a.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const r=i[this.olmDevice.deviceCurve25519Key];let o;try{o=await this.decryptMessage(n,r)}catch(e){throw new a.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:n,err:e})}const l=JSON.parse(o);if(l.recipient!=this.userId)throw new a.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+l.recipient);if(l.recipient_keys.ed25519!=this.olmDevice.deviceEd25519Key)throw new a.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:l.recipient_keys.ed25519,our_key:this.olmDevice.deviceEd25519Key});await this.crypto.deviceList.downloadKeys([e.getSender()],!1);const c=this.crypto.deviceList.getUserByIdentityKey(s.OLM_ALGORITHM,n);if(c!==e.getSender()&&void 0!==c)throw new a.DecryptionError("OLM_BAD_SENDER","Message claimed to be from "+e.getSender(),{real_sender:c});if(l.sender!=e.getSender())throw new a.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+l.sender,{reported_sender:e.getSender()});if(l.room_id!==e.getRoomId())throw new a.DecryptionError("OLM_BAD_ROOM","Message intended for room "+l.room_id,{reported_room:e.getRoomId()||"ROOM_ID_UNDEFINED"});return{clearEvent:l,senderCurve25519Key:n,claimedEd25519Key:(l.keys||{}).ed25519||null}}decryptMessage(e,t){if(0!==t.type)return this.reallyDecryptMessage(e,t);{const n=this.olmDevice.olmPrekeyPromise.then((()=>this.reallyDecryptMessage(e,t)));return this.olmDevice.olmPrekeyPromise=n.catch((()=>{})),n}}async reallyDecryptMessage(e,t){const n=await this.olmDevice.getSessionIdsForDevice(e),i={};for(let s=0;s<n.length;s++){const o=n[s];try{const n=await this.olmDevice.decryptMessage(e,o,t.type,t.body);return r.logger.log("Decrypted Olm message from "+e+" with session "+o),n}catch(n){if(await this.olmDevice.matchesSession(e,o,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+o+": "+n.message);i[o]=n.message}}if(0!==t.type){if(0===n.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(i))}let s;try{s=await this.olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw i["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(i))}return r.logger.log("created new inbound Olm session ID "+s.session_id+" with "+e),s.payload}}(0,a.registerAlgorithm)(s.OLM_ALGORITHM,d,h)},764:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.CrossSigningKey=void 0,t.CrossSigningKey=n,function(e){e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing"}(n||(t.CrossSigningKey=n={}))},5537:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.algorithmsByName=t.DefaultAlgorithm=t.Curve25519=t.BackupManager=t.Aes256=void 0;var r=i(n(8416)),s=n(2168),o=n(7434),a=n(2772),l=n(1597),c=n(3102),d=n(7585),h=n(4077),u=n(2611),p=n(7048),m=n(2600);class g{constructor(e,t){this.baseApis=e,this.getKey=t,(0,r.default)(this,"algorithm",void 0),(0,r.default)(this,"backupInfo",void 0),(0,r.default)(this,"checkedForBackup",void 0),(0,r.default)(this,"sendingBackups",void 0),(0,r.default)(this,"sessionLastCheckAttemptedTime",{}),this.checkedForBackup=!1,this.sendingBackups=!1}get version(){return this.backupInfo&&this.backupInfo.version}static checkBackupVersion(e){const t=b[e.algorithm];if(!t)throw new Error("Unknown backup algorithm: "+e.algorithm);if("object"!=typeof e.auth_data)throw new Error("Invalid backup data returned");return t.checkBackupVersion(e)}static makeAlgorithm(e,t){const n=b[e.algorithm];if(!n)throw new Error("Unknown backup algorithm");return n.init(e.auth_data,t)}async enableKeyBackup(e){this.backupInfo=e,this.algorithm&&this.algorithm.free(),this.algorithm=await g.makeAlgorithm(e,this.getKey),this.baseApis.emit(m.CryptoEvent.KeyBackupStatus,!0),this.scheduleKeyBackupSend()}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit(m.CryptoEvent.KeyBackupStatus,!1)}getKeyBackupEnabled(){return this.checkedForBackup?Boolean(this.algorithm):null}async prepareKeyBackupVersion(e,t){const n=t?b[t]:w;if(!n)throw new Error("Unknown backup algorithm");const[i,r]=await n.prepare(e),s=(0,h.encodeRecoveryKey)(i);return{algorithm:n.algorithmName,auth_data:r,recovery_key:s,privateKey:i}}async createKeyBackupVersion(e){this.algorithm=await g.makeAlgorithm(e,this.getKey)}async checkAndStart(){if(o.logger.log("Checking key backup status..."),this.baseApis.isGuest())return o.logger.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,null;let e;try{e=await this.baseApis.getKeyBackupVersion()}catch(e){return o.logger.log("Error checking for active key backup",e),404===e.httpStatus&&(this.checkedForBackup=!0),null}this.checkedForBackup=!0;const t=await this.isKeyBackupTrusted(e);return t.usable&&!this.backupInfo?(o.logger.log("Found usable key backup v"+e.version+": enabling key backups"),await this.enableKeyBackup(e)):!t.usable&&this.backupInfo?(o.logger.log("No usable key backup: disabling key backup"),this.disableKeyBackup()):t.usable||this.backupInfo?t.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(o.logger.log("On backup version "+this.backupInfo.version+" but found version "+e.version+": switching."),this.disableKeyBackup(),await this.enableKeyBackup(e),await this.scheduleAllGroupSessionsForBackup()):o.logger.log("Backup version "+e.version+" still current")):o.logger.log("No usable key backup: not enabling key backup"),{backupInfo:e,trustInfo:t}}async checkKeyBackup(){return this.checkedForBackup=!1,this.checkAndStart()}async queryKeyBackupRateLimited(e,t){if(!this.backupInfo)return;const n=(new Date).getTime();(!this.sessionLastCheckAttemptedTime[t]||n-this.sessionLastCheckAttemptedTime[t]>5e3)&&(this.sessionLastCheckAttemptedTime[t]=n,await this.baseApis.restoreKeyBackupWithCache(e,t,this.backupInfo,{}))}async isKeyBackupTrusted(e){const t={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.signatures))return o.logger.info("Key backup is absent or missing required data"),t;const n=await this.baseApis.crypto.getSessionBackupPrivateKey();if(n){let i;try{i=await g.makeAlgorithm(e,(async()=>n)),await i.keyMatches(n)&&(o.logger.info("Backup is trusted locally"),t.trusted_locally=!0)}catch{}finally{i&&i.free()}}const i=e.auth_data.signatures[this.baseApis.getUserId()]||{};for(const n of Object.keys(i)){const i=n.split(":");if("ed25519"!==i[0]){o.logger.log("Ignoring unknown signature type: "+i[0]);continue}const r={deviceId:i[1]},s=this.baseApis.crypto.crossSigningInfo.getId();if(s===r.deviceId){r.crossSigningId=!0;try{await(0,a.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,this.baseApis.getUserId(),r.deviceId,s),r.valid=!0}catch(e){o.logger.warn("Bad signature from cross signing key "+s,e),r.valid=!1}t.sigs.push(r);continue}const l=this.baseApis.crypto.deviceList.getStoredDevice(this.baseApis.getUserId(),r.deviceId);if(l){r.device=l,r.deviceTrust=this.baseApis.checkDeviceTrust(this.baseApis.getUserId(),r.deviceId);try{await(0,a.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,this.baseApis.getUserId(),l.deviceId,l.getFingerprint()),r.valid=!0}catch(t){o.logger.info("Bad signature from key ID "+n+" userID "+this.baseApis.getUserId()+" device ID "+l.deviceId+" fingerprint: "+l.getFingerprint(),e.auth_data,t),r.valid=!1}}else r.valid=null,o.logger.info("Ignoring signature from unknown key "+n);t.sigs.push(r)}return t.usable=t.sigs.some((e=>e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId))),t}async scheduleKeyBackupSend(e=1e4){if(!this.sendingBackups){this.sendingBackups=!0;try{const t=Math.random()*e;await(0,c.sleep)(t);let n=0;for(;;){if(!this.algorithm)return;try{if(0===await this.backupPendingKeys(200))return;n=0}catch(e){if(n++,o.logger.log("Key backup request failed",e),e.data&&("M_NOT_FOUND"==e.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==e.data.errcode))throw await this.checkKeyBackup(),this.baseApis.crypto.emit(m.CryptoEvent.KeyBackupFailed,e.data.errcode),e}n&&await(0,c.sleep)(1e3*Math.pow(2,Math.min(n-1,4)))}}finally{this.sendingBackups=!1}}}async backupPendingKeys(e){const t=await this.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(e);if(!t.length)return 0;let n=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();this.baseApis.crypto.emit(m.CryptoEvent.KeyBackupSessionsRemaining,n);const i={};for(const e of t){const t=e.sessionData.room_id;void 0===i[t]&&(i[t]={sessions:{}});const n=this.baseApis.crypto.olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);n.algorithm=a.MEGOLM_ALGORITHM;const r=(n.forwarding_curve25519_key_chain||[]).length,s=this.baseApis.crypto.deviceList.getUserByIdentityKey(a.MEGOLM_ALGORITHM,e.senderKey),o=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(a.MEGOLM_ALGORITHM,e.senderKey),l=this.baseApis.crypto.checkDeviceInfoTrust(s,o).isVerified();i[t].sessions[e.sessionId]={first_message_index:n.first_known_index,forwarded_count:r,is_verified:l,session_data:await this.algorithm.encryptSession(n)}}return await this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:i}),await this.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(t),n=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup(),this.baseApis.crypto.emit(m.CryptoEvent.KeyBackupSessionsRemaining,n),t.length}async backupGroupSession(e,t){await this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:t}]),this.backupInfo&&this.scheduleKeyBackupSend()}async scheduleAllGroupSessionsForBackup(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)}async flagAllGroupSessionsForBackup(){await this.baseApis.crypto.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,d.IndexedDBCryptoStore.STORE_BACKUP],(e=>{this.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(e,(t=>{null!==t&&this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([t],e)}))}));const e=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();return this.baseApis.emit(m.CryptoEvent.KeyBackupSessionsRemaining,e),e}countSessionsNeedingBackup(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}t.BackupManager=g;class f{constructor(e,t,n){this.authData=e,this.publicKey=t,this.getKey=n}static async init(e,t){if(!e||!("public_key"in e))throw new Error("auth_data missing required information");const i=new n.g.Olm.PkEncryption;return i.set_recipient_key(e.public_key),new f(e,i,t)}static async prepare(e){const t=new n.g.Olm.PkDecryption;try{const i={};if(e)if(e instanceof Uint8Array)i.public_key=t.init_with_private_key(e);else{const n=await(0,l.keyFromPassphrase)(e);i.private_key_salt=n.salt,i.private_key_iterations=n.iterations,i.public_key=t.init_with_private_key(n.key)}else i.public_key=t.generate_key();return(new n.g.Olm.PkEncryption).set_recipient_key(i.public_key),[t.get_private_key(),i]}finally{t.free()}}static checkBackupVersion(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!0}async encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,this.publicKey.encrypt(JSON.stringify(t))}async decryptSessions(e){const t=await this.getKey(),i=new n.g.Olm.PkDecryption;try{if(i.init_with_private_key(t)!==this.authData.public_key)throw{errcode:s.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY};const n=[];for(const[t,r]of Object.entries(e))try{const e=JSON.parse(i.decrypt(r.session_data.ephemeral,r.session_data.mac,r.session_data.ciphertext));e.session_id=t,n.push(e)}catch(e){o.logger.log("Failed to decrypt megolm session from backup",e,r)}return n}finally{i.free()}}async keyMatches(e){const t=new n.g.Olm.PkDecryption;let i;try{i=t.init_with_private_key(e)}finally{t.free()}return i===this.authData.public_key}free(){this.publicKey.free()}}t.Curve25519=f,(0,r.default)(f,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");const v=new p.UnstableValue(null,"org.matrix.msc3270.v1.aes-hmac-sha2");class y{constructor(e,t){this.authData=e,this.key=t}static async init(e,t){if(!e)throw new Error("auth_data missing");const n=await t();if(e.mac){const{mac:t}=await(0,u.calculateKeyCheck)(n,e.iv);if(e.mac.replace(/=+$/g,"")!==t.replace(/=+/g,""))throw new Error("Key does not match")}return new y(e,n)}static async prepare(e){let t;const n={};if(e)if(e instanceof Uint8Array)t=new Uint8Array(e);else{const i=await(0,l.keyFromPassphrase)(e);n.private_key_salt=i.salt,n.private_key_iterations=i.iterations,t=i.key}else t=function(e){var t;const n=(0,c.getCrypto)();if(n)return n.randomBytes(32);if(null!==(t=window)&&void 0!==t&&t.crypto){const e=new Uint8Array(32);return window.crypto.getRandomValues(e),e}throw new Error("No usable crypto implementation")}();const{iv:i,mac:r}=await(0,u.calculateKeyCheck)(t);return n.iv=i,n.mac=r,[t,n]}static checkBackupVersion(e){if(!("iv"in e.auth_data)||!("mac"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!1}encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,(0,u.encryptAES)(JSON.stringify(t),this.key,e.session_id)}async decryptSessions(e){const t=[];for(const[n,i]of Object.entries(e))try{const e=JSON.parse(await(0,u.decryptAES)(i.session_data,this.key,n));e.session_id=n,t.push(e)}catch(e){o.logger.log("Failed to decrypt megolm session from backup",e,i)}return t}async keyMatches(e){if(this.authData.mac){const{mac:t}=await(0,u.calculateKeyCheck)(e,this.authData.iv);return this.authData.mac.replace(/=+$/g,"")===t.replace(/=+/g,"")}return!0}free(){this.key.fill(0)}}t.Aes256=y,(0,r.default)(y,"algorithmName",v.name);const b={[f.algorithmName]:f,[y.algorithmName]:y};t.algorithmsByName=b;const w=f;t.DefaultAlgorithm=w},4830:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.DehydrationManager=t.DEHYDRATION_ALGORITHM=void 0;var r=i(n(8416)),s=i(n(9141)),o=n(2772),a=n(7585),l=n(2611),c=n(7434),d=n(7715);const h="org.matrix.msc2697.v1.olm.libolm_pickle";t.DEHYDRATION_ALGORITHM=h;const u=6048e5;t.DehydrationManager=class{constructor(e){this.crypto=e,(0,r.default)(this,"inProgress",!1),(0,r.default)(this,"timeoutId",void 0),(0,r.default)(this,"key",void 0),(0,r.default)(this,"keyInfo",void 0),(0,r.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}getDehydrationKeyFromCache(){return this.crypto.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.getSecretStorePrivateKey(e,(async e=>{if(e){const{key:t,keyInfo:i,deviceDisplayName:r,time:s}=e,a=Buffer.from(this.crypto.olmDevice.pickleKey),c=await(0,l.decryptAES)(t,a,h);this.key=(0,o.decodeBase64)(c),this.keyInfo=i,this.deviceDisplayName=r;const d=Date.now(),p=Math.max(1,s+u-d);this.timeoutId=n.g.setTimeout(this.dehydrateDevice.bind(this),p)}}),"dehydration")}))}async setKeyAndQueueDehydration(e,t={},n){await this.setKey(e,t,n)||this.dehydrateDevice()}async setKey(e,t={},i){if(!e)return this.timeoutId&&(n.g.clearTimeout(this.timeoutId),this.timeoutId=void 0),await this.crypto.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)})),this.key=void 0,void(this.keyInfo=void 0);let r=this.key&&e.length==this.key.length;for(let t=0;r&&t<e.length;t++)e[t]!=this.key[t]&&(r=!1);return r||(this.key=e,this.keyInfo=t,this.deviceDisplayName=i),r}async dehydrateDevice(){if(this.inProgress)c.logger.log("Dehydration already in progress -- not starting new dehydration");else{this.inProgress=!0,this.timeoutId&&(n.g.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const e=Buffer.from(this.crypto.olmDevice.pickleKey),t=await(0,l.encryptAES)((0,o.encodeBase64)(this.key),e,h);await this.crypto.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:this.keyInfo,key:t,deviceDisplayName:this.deviceDisplayName,time:Date.now()})})),c.logger.log("Attempting to dehydrate device"),c.logger.log("Creating account");const i=new n.g.Olm.Account;i.create();const r=JSON.parse(i.identity_keys()),p=i.max_number_of_one_time_keys();i.generate_one_time_keys(p/2),i.generate_fallback_key();const m=JSON.parse(i.one_time_keys()),g=JSON.parse(i.fallback_key());i.mark_keys_as_published();const f=i.pickle(new Uint8Array(this.key)),v={algorithm:h,account:f};this.keyInfo.passphrase&&(v.passphrase=this.keyInfo.passphrase),c.logger.log("Uploading account to server");const y=(await this.crypto.baseApis.http.authedRequest(void 0,d.Method.Put,"/dehydrated_device",void 0,{device_data:v,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;c.logger.log("Preparing device keys",y);const b={algorithms:this.crypto.supportedAlgorithms,device_id:y,user_id:this.crypto.userId,keys:{[`ed25519:${y}`]:r.ed25519,[`curve25519:${y}`]:r.curve25519}},w=i.sign(s.default.stringify(b));b.signatures={[this.crypto.userId]:{[`ed25519:${y}`]:w}},this.crypto.crossSigningInfo.getId("self_signing")&&await this.crypto.crossSigningInfo.signObject(b,"self_signing"),c.logger.log("Preparing one-time keys");const S={};for(const[e,t]of Object.entries(m.curve25519)){const n={key:t},r=i.sign(s.default.stringify(n));n.signatures={[this.crypto.userId]:{[`ed25519:${y}`]:r}},S[`signed_curve25519:${e}`]=n}c.logger.log("Preparing fallback keys");const _={};for(const[e,t]of Object.entries(g.curve25519)){const n={key:t,fallback:!0},r=i.sign(s.default.stringify(n));n.signatures={[this.crypto.userId]:{[`ed25519:${y}`]:r}},_[`signed_curve25519:${e}`]=n}return c.logger.log("Uploading keys to server"),await this.crypto.baseApis.http.authedRequest(void 0,d.Method.Post,"/keys/upload/"+encodeURI(y),void 0,{device_keys:b,one_time_keys:S,"org.matrix.msc2732.fallback_keys":_}),c.logger.log("Done dehydrating"),this.timeoutId=n.g.setTimeout(this.dehydrateDevice.bind(this),u),y}finally{this.inProgress=!1}}}stop(){this.timeoutId&&(n.g.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}},3272:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=void 0;var r,s=i(n(8416));!function(e){e[e.Blocked=-1]="Blocked",e[e.Unverified=0]="Unverified",e[e.Verified=1]="Verified"}(r||(r={}));class o{static fromStorage(e,t){const n=new o(t);for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}constructor(e){this.deviceId=e,(0,s.default)(this,"algorithms",void 0),(0,s.default)(this,"keys",{}),(0,s.default)(this,"verified",r.Unverified),(0,s.default)(this,"known",!1),(0,s.default)(this,"unsigned",{}),(0,s.default)(this,"signatures",{})}toStorage(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}getFingerprint(){return this.keys["ed25519:"+this.deviceId]}getIdentityKey(){return this.keys["curve25519:"+this.deviceId]}getDisplayName(){return this.unsigned.device_display_name||null}isBlocked(){return this.verified==r.Blocked}isVerified(){return this.verified==r.Verified}isUnverified(){return this.verified==r.Unverified}isKnown(){return!0===this.known}}t.DeviceInfo=o,(0,s.default)(o,"DeviceVerification",{VERIFIED:r.Verified,UNVERIFIED:r.Unverified,BLOCKED:r.Blocked})},2600:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.IncomingRoomKeyRequest=t.CryptoEvent=t.Crypto=void 0,t.fixBackupKey=K,t.isCryptoAvailable=function(){return Boolean(n.g.Olm)},t.verificationMethods=void 0;var r=i(n(8416)),s=i(n(9141)),o=n(2481),a=n(771),l=n(7434),c=n(2573),d=N(n(2772)),h=n(6670),u=n(3272),p=N(n(1994)),m=n(3075),g=n(636),f=n(4823),v=n(6617),y=n(7585),b=n(1696),w=n(6381),S=n(1597),_=n(4077),E=n(5279),k=n(2842),x=n(9588),T=n(4028),C=n(9489),A=n(2611),I=n(4830),R=n(5537),P=n(7366),O=n(2848),M=n(4369),D=n(2168),L=n(5861);function F(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(F=function(e){return e?n:t})(e)}function N(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=F(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const B=u.DeviceInfo.DeviceVerification,U={[b.ReciprocateQRCode.NAME]:b.ReciprocateQRCode,[w.SAS.NAME]:w.SAS,[b.SHOW_QR_CODE_METHOD]:T.IllegalMethod,[b.SCAN_QR_CODE_METHOD]:T.IllegalMethod},q={RECIPROCATE_QR_CODE:b.ReciprocateQRCode.NAME,SAS:w.SAS.NAME};let z;t.verificationMethods=q,t.CryptoEvent=z,function(e){e.DeviceVerificationChanged="deviceVerificationChanged",e.UserTrustStatusChanged="userTrustStatusChanged",e.UserCrossSigningUpdated="userCrossSigningUpdated",e.RoomKeyRequest="crypto.roomKeyRequest",e.RoomKeyRequestCancellation="crypto.roomKeyRequestCancellation",e.KeyBackupStatus="crypto.keyBackupStatus",e.KeyBackupFailed="crypto.keyBackupFailed",e.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",e.KeySignatureUploadFailure="crypto.keySignatureUploadFailure",e.VerificationRequest="crypto.verification.request",e.Warning="crypto.warning",e.WillUpdateDevices="crypto.willUpdateDevices",e.DevicesUpdated="crypto.devicesUpdated",e.KeysChanged="crossSigning.keysChanged"}(z||(t.CryptoEvent=z={}));class V extends L.TypedEventEmitter{static getOlmVersion(){return c.OlmDevice.getOlmVersion()}constructor(e,t,n,i,s,o,u){if(super(),this.baseApis=e,this.userId=t,this.deviceId=n,this.clientStore=i,this.cryptoStore=s,this.roomList=o,(0,r.default)(this,"backupManager",void 0),(0,r.default)(this,"crossSigningInfo",void 0),(0,r.default)(this,"olmDevice",void 0),(0,r.default)(this,"deviceList",void 0),(0,r.default)(this,"dehydrationManager",void 0),(0,r.default)(this,"secretStorage",void 0),(0,r.default)(this,"reEmitter",void 0),(0,r.default)(this,"verificationMethods",void 0),(0,r.default)(this,"supportedAlgorithms",void 0),(0,r.default)(this,"outgoingRoomKeyRequestManager",void 0),(0,r.default)(this,"toDeviceVerificationRequests",void 0),(0,r.default)(this,"inRoomVerificationRequests",void 0),(0,r.default)(this,"trustCrossSignedDevices",!0),(0,r.default)(this,"lastOneTimeKeyCheck",null),(0,r.default)(this,"oneTimeKeyCheckInProgress",!1),(0,r.default)(this,"roomEncryptors",new Map),(0,r.default)(this,"roomDecryptors",new Map),(0,r.default)(this,"deviceKeys",{}),(0,r.default)(this,"globalBlacklistUnverifiedDevices",!1),(0,r.default)(this,"globalErrorOnUnknownDevices",!0),(0,r.default)(this,"receivedRoomKeyRequests",[]),(0,r.default)(this,"receivedRoomKeyRequestCancellations",[]),(0,r.default)(this,"processingRoomKeyRequests",!1),(0,r.default)(this,"lazyLoadMembers",!1),(0,r.default)(this,"roomDeviceTrackingState",{}),(0,r.default)(this,"lastNewSessionForced",{}),(0,r.default)(this,"sendKeyRequestsImmediately",!1),(0,r.default)(this,"oneTimeKeyCount",void 0),(0,r.default)(this,"needsNewFallback",void 0),(0,r.default)(this,"fallbackCleanup",void 0),(0,r.default)(this,"onDeviceListUserCrossSigningUpdated",(async e=>{if(e===this.userId){const t=this.deviceList.getStoredCrossSigningForUser(e),n=t?t.getId():null,i=this.crossSigningInfo.getId(),r=i!==n;i&&n&&!r?await this.checkOwnCrossSigningTrust():(this.storeTrustedSelfKeys(null),this.emit(z.KeysChanged,{}),this.emit(z.UserTrustStatusChanged,this.userId,this.checkUserTrust(e)))}else{await this.checkDeviceVerifications(e);const t=this.deviceList.getStoredCrossSigningForUser(e);t&&(t.updateCrossSigningVerifiedBefore(this.checkUserTrust(e).isCrossSigningVerified()),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage())),this.emit(z.UserTrustStatusChanged,e,this.checkUserTrust(e))}})),(0,r.default)(this,"onMembership",((e,t,n)=>{try{this.onRoomMembership(e,t,n)}catch(e){l.logger.error("Error handling membership change:",e)}})),(0,r.default)(this,"onToDeviceEvent",(e=>{try{l.logger.log(`received to_device ${e.getType()} from: ${e.getSender()} id: ${e.getId()}`),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this.onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this.onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this.secretStorage.onRequestReceived(e):"m.secret.send"===e.getType()?this.secretStorage.onSecretReceived(e):"m.room_key.withheld"===e.getType()?this.onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this.onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this.onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption(this),e.once(M.MatrixEventEvent.Decrypted,(e=>{this.onToDeviceEvent(e)})))}catch(e){l.logger.error("Error handling toDeviceEvent:",e)}})),(0,r.default)(this,"onTimelineEvent",((e,t,n,i,{liveEvent:r=!0}={})=>{k.InRoomChannel.validateEvent(e,this.baseApis)&&this.handleVerificationEvent(e,this.inRoomVerificationRequests,(e=>{const t=new k.InRoomChannel(this.baseApis,e.getRoomId());return new E.VerificationRequest(t,this.verificationMethods,this.baseApis)}),r)})),this.reEmitter=new a.TypedReEmitter(this),u){this.verificationMethods=new Map;for(const e of u)"string"==typeof e?U[e]&&this.verificationMethods.set(e,U[e]):e.NAME?this.verificationMethods.set(e.NAME,e):l.logger.warn(`Excluding unknown verification method ${e}`)}else this.verificationMethods=new Map(Object.entries(U));this.backupManager=new R.BackupManager(e,(async()=>{const e=await this.getSessionBackupPrivateKey();if(e)return e;const t=await this.getSecret("m.megolm_backup.v1");if(t){const e=K(t);if(e){const[t]=await this.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",e,[t])}return d.decodeBase64(e||t)}if(this.baseApis.cryptoCallbacks&&this.baseApis.cryptoCallbacks.getBackupKey)return this.baseApis.cryptoCallbacks.getBackupKey();throw new Error("Unable to get private key")})),this.olmDevice=new c.OlmDevice(s),this.deviceList=new h.DeviceList(e,s,this.olmDevice),this.deviceList.on(z.UserCrossSigningUpdated,this.onDeviceListUserCrossSigningUpdated),this.reEmitter.reEmit(this.deviceList,[z.DevicesUpdated,z.WillUpdateDevices]),this.supportedAlgorithms=Array.from(p.DECRYPTION_CLASSES.keys()),this.outgoingRoomKeyRequestManager=new v.OutgoingRoomKeyRequestManager(e,this.deviceId,this.cryptoStore),this.toDeviceVerificationRequests=new x.ToDeviceRequests,this.inRoomVerificationRequests=new k.InRoomRequests;const g=this.baseApis.cryptoCallbacks||{},y=(0,m.createCryptoStoreCacheCallbacks)(s,this.olmDevice);this.crossSigningInfo=new m.CrossSigningInfo(t,g,y),this.secretStorage=new f.SecretStorage(e,g,e),this.dehydrationManager=new I.DehydrationManager(this),!g.getCrossSigningKey&&g.getSecretStorageKey&&(g.getCrossSigningKey=async e=>m.CrossSigningInfo.getFromSecretStorage(e,this.secretStorage))}async init({exportedOlmDevice:e,pickleKey:t}={}){l.logger.log("Crypto: initialising Olm..."),await n.g.Olm.init(),l.logger.log(e?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),await this.olmDevice.init({fromExportedDevice:e,pickleKey:t}),l.logger.log("Crypto: loading device list..."),await this.deviceList.load(),this.deviceKeys["ed25519:"+this.deviceId]=this.olmDevice.deviceEd25519Key,this.deviceKeys["curve25519:"+this.deviceId]=this.olmDevice.deviceCurve25519Key,l.logger.log("Crypto: fetching own devices...");let i=this.deviceList.getRawStoredDevicesForUser(this.userId);if(i||(i={}),!i[this.deviceId]){l.logger.log("Crypto: adding this device to the store...");const e={keys:this.deviceKeys,algorithms:this.supportedAlgorithms,verified:B.VERIFIED,known:!0};i[this.deviceId]=e,this.deviceList.storeDevicesForUser(this.userId,i),this.deviceList.saveIfDirty()}await this.cryptoStore.doTxn("readonly",[y.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.getCrossSigningKeys(e,(e=>{e&&0!==Object.keys(e).length&&(l.logger.log("Loaded cross-signing public keys from crypto store"),this.crossSigningInfo.setKeys(e))}))})),this.deviceList.startTrackingDeviceList(this.userId),l.logger.log("Crypto: checking for key backup..."),this.backupManager.checkAndStart()}getCryptoTrustCrossSignedDevices(){return this.trustCrossSignedDevices}setCryptoTrustCrossSignedDevices(e){this.trustCrossSignedDevices=e;for(const e of this.deviceList.getKnownUserIds()){const t=this.deviceList.getRawStoredDevicesForUser(e);for(const n of Object.keys(t)){const t=this.checkDeviceTrust(e,n);if(!t.isLocallyVerified()&&t.isCrossSigningVerified()){const t=this.deviceList.getStoredDevice(e,n);this.emit(z.DeviceVerificationChanged,e,n,t)}}}}async createRecoveryKeyFromPassphrase(e){const t=new n.g.Olm.PkDecryption;try{const n={};if(e){const i=await(0,S.keyFromPassphrase)(e);n.passphrase={algorithm:"m.pbkdf2",iterations:i.iterations,salt:i.salt},n.pubkey=t.init_with_private_key(i.key)}else n.pubkey=t.generate_key();const i=t.get_private_key();return{keyInfo:n,encodedPrivateKey:(0,_.encodeRecoveryKey)(i),privateKey:i}}finally{t&&t.free()}}async isCrossSigningReady(){const e=this.crossSigningInfo.getId(),t=await this.crossSigningInfo.isStoredInKeyCache()||await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);return!(!e||!t)}async isSecretStorageReady(){const e=await this.secretStorage.hasKey(),t=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),n=!this.backupManager.getKeyBackupEnabled()||await this.baseApis.isKeyBackupKeyStored();return!!(e&&t&&n)}async bootstrapCrossSigning({authUploadDeviceSigningKeys:e,setupNewCrossSigning:t}={}){l.logger.log("Bootstrapping cross-signing");const n=this.baseApis.cryptoCallbacks,i=new g.EncryptionSetupBuilder(this.baseApis.store.accountData,n),r=new m.CrossSigningInfo(this.userId,i.crossSigningCallbacks,i.crossSigningCallbacks),s=this.crossSigningInfo.getId(),o=await this.crossSigningInfo.isStoredInKeyCache(),a=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),c=o||a;l.logger.log({setupNewCrossSigning:t,publicKeysOnDevice:s,privateKeysInCache:o,privateKeysInStorage:a,privateKeysExistSomewhere:c}),!c||t?(l.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),await(async()=>{r.resetKeys(),await this.signObject(r.keys.master),i.addCrossSigningKeys(e,r.keys);const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),n=await r.signDevice(this.userId,t);i.addKeySignature(this.userId,this.deviceId,n),this.backupManager.backupInfo&&(await r.signObject(this.backupManager.backupInfo.auth_data,"master"),i.addSessionBackup(this.backupManager.backupInfo))})()):s&&o?l.logger.log("Cross-signing public keys trusted and private keys found locally"):a&&(l.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),await this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));const d=i.crossSigningCallbacks.privateKeys;if(d.size&&!this.baseApis.cryptoCallbacks.saveCrossSigningKeys){const e=new f.SecretStorage(i.accountDataClientAdapter,i.ssssCryptoCallbacks);await e.hasKey()&&(l.logger.log("Storing new cross-signing private keys in secret storage"),await m.CrossSigningInfo.storeInSecretStorage(d,e))}const h=i.buildOperation();await h.apply(this),await i.persist(this),l.logger.log("Cross-signing ready")}async bootstrapSecretStorage({createSecretStorageKey:e=(async()=>({})),keyBackupInfo:t,setupNewKeyBackup:n,setupNewSecretStorage:i,getKeyBackupPassphrase:r}={}){l.logger.log("Bootstrapping Secure Secret Storage");const s=this.baseApis.cryptoCallbacks,o=new g.EncryptionSetupBuilder(this.baseApis.store.accountData,s),a=new f.SecretStorage(o.accountDataClientAdapter,o.ssssCryptoCallbacks);let c=null;const h=async(e,t)=>{t&&(e.key=t);const{keyId:n,keyInfo:i}=await a.addKey(f.SECRET_STORAGE_ALGORITHM_V1_AES,e);return t&&o.ssssCryptoCallbacks.addPrivateKey(n,i,t),await a.setDefaultKeyId(n),n},u=async e=>{if(this.crossSigningInfo.getId()&&await this.crossSigningInfo.isStoredInKeyCache("master"))try{l.logger.log("Adding cross-signing signature to key backup"),await this.crossSigningInfo.signObject(e,"master")}catch(e){l.logger.error("Signing key backup with cross-signing keys failed",e)}else l.logger.warn("Cross-signing keys not available, skipping signature on key backup")},p=await this.getSecretStorageKey(),[v,y]=p||[null,null],b=!i&&y&&y.algorithm===f.SECRET_STORAGE_ALGORITHM_V1_AES;if(l.logger.log({keyBackupInfo:t,setupNewKeyBackup:n,setupNewSecretStorage:i,storageExists:b,oldKeyInfo:y}),b||t)if(!b&&t){l.logger.log("Secret storage does not exist, using key backup key");const e=await this.getSessionBackupPrivateKey()||await r(),n={};t.auth_data.private_key_salt&&t.auth_data.private_key_iterations&&(n.passphrase={algorithm:"m.pbkdf2",iterations:t.auth_data.private_key_iterations,salt:t.auth_data.private_key_salt,bits:256}),c=await h(n,e),await a.store("m.megolm_backup.v1",d.encodeBase64(e),[c]),await u(t.auth_data),o.addSessionBackup(t)}else l.logger.log("Secret storage exists"),y&&y.algorithm===f.SECRET_STORAGE_ALGORITHM_V1_AES&&await(async(e,t)=>{if(!t.mac){const n=await this.baseApis.cryptoCallbacks.getSecretStorageKey({keys:{[e]:t}},"");if(n){const i=n[1];o.ssssCryptoCallbacks.addPrivateKey(e,t,i);const{iv:r,mac:s}=await(0,A.calculateKeyCheck)(i);t.iv=r,t.mac=s,await o.setAccountData(`m.secret_storage.key.${e}`,t)}}})(v,y);else{l.logger.log("Secret storage does not exist, creating new storage key");const{keyInfo:t={},privateKey:n}=await e();c=await h(t,n)}if(!this.baseApis.cryptoCallbacks.saveCrossSigningKeys&&await this.isCrossSigningReady()&&(c||!await this.crossSigningInfo.isStoredInSecretStorage(a))){l.logger.log("Copying cross-signing private keys from cache to secret storage");const e=await this.crossSigningInfo.getCrossSigningKeysFromCache();await m.CrossSigningInfo.storeInSecretStorage(e,a)}if(n&&!t){l.logger.log("Creating new message key backup version");const e=await this.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),t=(0,_.decodeRecoveryKey)(e.recovery_key);await a.store("m.megolm_backup.v1",d.encodeBase64(t));const n={algorithm:e.algorithm,auth_data:e.auth_data};await u(n.auth_data),await this.signObject(n.auth_data),o.addSessionBackup(n)}const w=await a.get("m.megolm_backup.v1");if(w){l.logger.info("Got session backup key from secret storage: caching");const e=K(w);e&&await a.store("m.megolm_backup.v1",e,[c||v]);const t=new Uint8Array(d.decodeBase64(e||w));o.addSessionBackupPrivateKeyToCache(t)}else if(this.backupManager.getKeyBackupEnabled()){const e=await this.getSessionBackupPrivateKey()||await r();if(!e)return void l.logger.error("Key backup is enabled but couldn't get key backup key!");l.logger.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),await a.store("m.megolm_backup.v1",d.encodeBase64(e))}const S=o.buildOperation();await S.apply(this),await o.persist(this),l.logger.log("Secure Secret Storage ready")}addSecretStorageKey(e,t,n){return this.secretStorage.addKey(e,t,n)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}getSecretStorageKey(e){return this.secretStorage.getKey(e)}storeSecret(e,t,n){return this.secretStorage.store(e,t,n)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e){return this.secretStorage.isStored(e)}requestSecret(e,t){return t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,t)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStorageKey(e,t){return this.secretStorage.checkKey(e,t)}checkSecretStoragePrivateKey(e,t){let i=null;try{return i=new n.g.Olm.PkDecryption,i.init_with_private_key(e)===t}finally{i&&i.free()}}async getSessionBackupPrivateKey(){let e=await new Promise((e=>{this.cryptoStore.doTxn("readonly",[y.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")}))}));if(e&&"string"==typeof e&&(e=new Uint8Array(d.decodeBase64(K(e)||e)),await this.storeSessionBackupPrivateKey(e)),e&&e.ciphertext){const t=Buffer.from(this.olmDevice.pickleKey),n=await(0,A.decryptAES)(e,t,"m.megolm_backup.v1");e=d.decodeBase64(n)}return e}async storeSessionBackupPrivateKey(e){if(!(e instanceof Uint8Array))throw new Error(`storeSessionBackupPrivateKey expects Uint8Array, got ${e}`);const t=Buffer.from(this.olmDevice.pickleKey),n=await(0,A.encryptAES)(d.encodeBase64(e),t,"m.megolm_backup.v1");return this.cryptoStore.doTxn("readwrite",[y.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",n)}))}checkCrossSigningPrivateKey(e,t){let i=null;try{return i=new n.g.Olm.PkSigning,i.init_with_seed(e)===t}finally{i&&i.free()}}async afterCrossSigningLocalKeyChange(){l.logger.info("Starting cross-signing key change post-processing");const e=this.deviceList.getStoredDevice(this.userId,this.deviceId),t=await this.crossSigningInfo.signDevice(this.userId,e);l.logger.info(`Starting background key sig upload for ${this.deviceId}`);const n=({shouldEmit:e=!1})=>this.baseApis.uploadKeySignatures({[this.userId]:{[this.deviceId]:t}}).then((t=>{const{failures:i}=t||{};if(Object.keys(i||[]).length>0)throw e&&this.baseApis.emit(z.KeySignatureUploadFailure,i,"afterCrossSigningLocalKeyChange",n),new C.KeySignatureUploadError("Key upload failed",{failures:i});l.logger.info(`Finished background key sig upload for ${this.deviceId}`)})).catch((e=>{l.logger.error(`Error during background key sig upload for ${this.deviceId}`,e)}));n({shouldEmit:!0});const i=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(i){l.logger.info("Starting device verification upgrade");const e={};for(const[t,n]of Object.entries(this.deviceList.crossSigningInfo)){const i=await this.checkForDeviceVerificationUpgrade(t,m.CrossSigningInfo.fromStorage(n,t));i&&(e[t]=i)}if(Object.keys(e).length>0){l.logger.info(`Found ${Object.keys(e).length} verif users to upgrade`);try{const t=await i({users:e});if(t)for(const n of t)n in e&&await this.baseApis.setDeviceVerified(n,e[n].crossSigningInfo.getId())}catch(e){l.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}}l.logger.info("Finished device verification upgrade")}l.logger.info("Finished cross-signing key change post-processing")}async checkForDeviceVerificationUpgrade(e,t){const n=this.crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!n.isVerified()){const n=this.deviceList.getRawStoredDevicesForUser(e),i=await this.checkForValidDeviceSignature(e,t.keys.master,n);if(i.length)return{devices:i.map((e=>u.DeviceInfo.fromStorage(n[e],e))),crossSigningInfo:t}}}async checkForValidDeviceSignature(e,t,n){const i=[];if(n&&t.signatures&&t.signatures[e])for(const r of Object.keys(t.signatures[e])){const[,s]=r.split(":",2);if(s in n&&n[s].verified===B.VERIFIED)try{await d.verifySignature(this.olmDevice,t,e,s,n[s].keys[r]),i.push(s)}catch(e){}}return i}getCrossSigningId(e){return this.crossSigningInfo.getId(e)}getStoredCrossSigningForUser(e){return this.deviceList.getStoredCrossSigningForUser(e)}checkUserTrust(e){const t=this.deviceList.getStoredCrossSigningForUser(e);return t?this.crossSigningInfo.checkUserTrust(t):new m.UserTrustLevel(!1,!1,!1)}checkDeviceTrust(e,t){const n=this.deviceList.getStoredDevice(e,t);return this.checkDeviceInfoTrust(e,n)}checkDeviceInfoTrust(e,t){const n=!(!t||!t.isVerified()),i=this.deviceList.getStoredCrossSigningForUser(e);if(t&&i){const r=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(i,t,n,r)}return new m.DeviceTrustLevel(!1,!1,n,!1)}checkIfOwnDeviceCrossSigned(e){const t=this.deviceList.getStoredDevice(this.userId,e),n=this.deviceList.getStoredCrossSigningForUser(this.userId);return n.checkDeviceTrust(n,t,!1,!0).isCrossSigningVerified()}async checkOwnCrossSigningTrust({allowPrivateKeyRequests:e=!1}={}){const t=this.userId;await this.downloadKeys([this.userId]);const n=await this.crossSigningInfo.getCrossSigningKeysFromCache(),i=this.deviceList.getStoredCrossSigningForUser(t);if(!i)return void l.logger.error("Got cross-signing update event for user "+t+" but no new cross-signing information found!");const r=i.getId(),s=this.crossSigningInfo.getId()!==r,o=i.getId()&&!n.has("master");if(s&&l.logger.info("Got new master public key",r),e&&(s||o)){l.logger.info("Attempting to retrieve cross-signing master private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("master",r))[1],l.logger.info("Got cross-signing master private key")}finally{e&&e.free()}}const a=this.crossSigningInfo.getId("self_signing"),c=this.crossSigningInfo.getId("user_signing");this.storeTrustedSelfKeys(i.keys);const d=a!==i.getId("self_signing"),h=c!==i.getId("user_signing"),u=i.getId("self_signing")&&!n.has("self_signing"),p=i.getId("user_signing")&&!n.has("user_signing"),m={};if(d&&l.logger.info("Got new self-signing key",i.getId("self_signing")),e&&(d||u)){l.logger.info("Attempting to retrieve cross-signing self-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("self_signing",i.getId("self_signing")))[1],l.logger.info("Got cross-signing self-signing private key")}finally{e&&e.free()}const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),n=await this.crossSigningInfo.signDevice(this.userId,t);m[this.deviceId]=n}if(h&&l.logger.info("Got new user-signing key",i.getId("user_signing")),e&&(h||p)){l.logger.info("Attempting to retrieve cross-signing user-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("user_signing",i.getId("user_signing")))[1],l.logger.info("Got cross-signing user-signing private key")}finally{e&&e.free()}}if(s){const e=this.crossSigningInfo.keys.master;await this.signObject(e);const t=e.signatures[this.userId]["ed25519:"+this.deviceId];m[this.crossSigningInfo.getId()]=Object.assign({},e,{signatures:{[this.userId]:{["ed25519:"+this.deviceId]:t}}})}const g=Object.keys(m);if(g.length){const e=({shouldEmit:t=!1})=>(l.logger.info(`Starting background key sig upload for ${g}`),this.baseApis.uploadKeySignatures({[this.userId]:m}).then((n=>{const{failures:i}=n||{};if(l.logger.info(`Finished background key sig upload for ${g}`),Object.keys(i||[]).length>0)throw t&&this.baseApis.emit(z.KeySignatureUploadFailure,i,"checkOwnCrossSigningTrust",e),new C.KeySignatureUploadError("Key upload failed",{failures:i})})).catch((e=>{l.logger.error(`Error during background key sig upload for ${g}`,e)})));e({shouldEmit:!0})}this.emit(z.UserTrustStatusChanged,t,this.checkUserTrust(t)),s&&(this.emit(z.KeysChanged,{}),await this.afterCrossSigningLocalKeyChange()),await this.backupManager.checkKeyBackup()}async storeTrustedSelfKeys(e){e?this.crossSigningInfo.setKeys(e):this.crossSigningInfo.clearKeys(),await this.cryptoStore.doTxn("readwrite",[y.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeCrossSigningKeys(e,this.crossSigningInfo.keys)}))}async checkDeviceVerifications(e){const t=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(t){if(l.logger.info(`Starting device verification upgrade for ${e}`),this.crossSigningInfo.keys.user_signing){const n=this.deviceList.getStoredCrossSigningForUser(e);if(n){const i=await this.checkForDeviceVerificationUpgrade(e,n);i&&(await t({users:{[e]:i}})).includes(e)&&await this.baseApis.setDeviceVerified(e,n.getId())}}l.logger.info(`Finished device verification upgrade for ${e}`)}}enableLazyLoading(){this.lazyLoadMembers=!0}registerEventHandlers(e){e.on(O.RoomMemberEvent.Membership,this.onMembership),e.on(D.ClientEvent.ToDeviceEvent,this.onToDeviceEvent),e.on(P.RoomEvent.Timeline,this.onTimelineEvent),e.on(M.MatrixEventEvent.Decrypted,this.onTimelineEvent)}start(){this.outgoingRoomKeyRequestManager.start()}stop(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop()}getDeviceEd25519Key(){return this.olmDevice.deviceEd25519Key}getDeviceCurve25519Key(){return this.olmDevice.deviceCurve25519Key}setGlobalBlacklistUnverifiedDevices(e){this.globalBlacklistUnverifiedDevices=e}getGlobalBlacklistUnverifiedDevices(){return this.globalBlacklistUnverifiedDevices}setGlobalErrorOnUnknownDevices(e){this.globalErrorOnUnknownDevices=e}getGlobalErrorOnUnknownDevices(){return this.globalErrorOnUnknownDevices}uploadDeviceKeys(){const e={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(e).then((()=>this.baseApis.uploadKeysRequest({device_keys:e})))}updateOneTimeKeyCount(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=e}setNeedsNewFallback(e){this.needsNewFallback=!!e}getNeedsNewFallback(){return this.needsNewFallback}maybeUploadOneTimeKeys(){if(this.oneTimeKeyCheckInProgress)return;const e=Date.now();if(null!==this.lastOneTimeKeyCheck&&e-this.lastOneTimeKeyCheck<6e4)return;this.lastOneTimeKeyCheck=e;const t=this.olmDevice.maxNumberOfOneTimeKeys(),n=Math.floor(t/2),i=async e=>{for(;n>e||this.getNeedsNewFallback();){if(n>e){l.logger.info("generating oneTimeKeys");const t=Math.min(n-e,5);await this.olmDevice.generateOneTimeKeys(t)}if(this.getNeedsNewFallback()){const e=await this.olmDevice.getFallbackKey();e.curve25519&&0!=Object.keys(e.curve25519).length||(l.logger.info("generating fallback key"),this.fallbackCleanup&&(clearTimeout(this.fallbackCleanup),delete this.fallbackCleanup),await this.olmDevice.generateFallbackKey())}l.logger.info("calling uploadOneTimeKeys");const t=await this.uploadOneTimeKeys();if(!t.one_time_key_counts||!t.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");e=t.one_time_key_counts.signed_curve25519}};this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then((()=>void 0!==this.oneTimeKeyCount?Promise.resolve(this.oneTimeKeyCount):this.baseApis.uploadKeysRequest({}).then((e=>e.one_time_key_counts.signed_curve25519||0)))).then((e=>i(e))).catch((e=>{l.logger.error("Error uploading one-time keys",e.stack||e)})).finally((()=>{this.oneTimeKeyCount=void 0,this.oneTimeKeyCheckInProgress=!1}))}async uploadOneTimeKeys(){const e=[];let t;if(this.getNeedsNewFallback()){t={};const n=await this.olmDevice.getFallbackKey();for(const[i,r]of Object.entries(n.curve25519)){const n={key:r,fallback:!0};t["signed_curve25519:"+i]=n,e.push(this.signObject(n))}this.setNeedsNewFallback(!1)}const n=await this.olmDevice.getOneTimeKeys(),i={};for(const t in n.curve25519)if(n.curve25519.hasOwnProperty(t)){const r={key:n.curve25519[t]};i["signed_curve25519:"+t]=r,e.push(this.signObject(r))}await Promise.all(e);const r={one_time_keys:i};t&&(r["org.matrix.msc2732.fallback_keys"]=t,r.fallback_keys=t);const s=await this.baseApis.uploadKeysRequest(r);return t&&(this.fallbackCleanup=setTimeout((()=>{delete this.fallbackCleanup,this.olmDevice.forgetOldFallbackKey()}),36e5)),await this.olmDevice.markKeysAsPublished(),s}downloadKeys(e,t){return this.deviceList.downloadKeys(e,t)}getStoredDevicesForUser(e){return this.deviceList.getStoredDevicesForUser(e)}getStoredDevice(e,t){return this.deviceList.getStoredDevice(e,t)}saveDeviceList(e){return this.deviceList.saveIfDirty(e)}async setDeviceVerification(e,t,n,i,r,s){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null);const o=this.deviceList.getStoredCrossSigningForUser(e);if(o&&o.getId()===t){if(null!==i||null!==r)throw new Error("Cannot set blocked or known for a cross-signing key");if(!n)throw new Error("Cannot set a cross-signing key as unverified");const a=s?Object.values(s)[0]:null;if(s&&(1!==Object.values(s).length||a!==o.getId()))throw new Error(`Key did not match expected value: expected ${o.getId()}, got ${a}`);if(this.crossSigningInfo.getId()||e!==this.crossSigningInfo.userId||(this.storeTrustedSelfKeys(o.keys),this.emit(z.UserTrustStatusChanged,this.userId,this.checkUserTrust(e))),e!==this.userId){l.logger.info("Master key "+o.getId()+" for "+e+" marked verified. Signing...");const n=await this.crossSigningInfo.signUser(o);if(n){const i=async({shouldEmit:r=!1})=>{l.logger.info("Uploading signature for "+e+"...");const s=await this.baseApis.uploadKeySignatures({[e]:{[t]:n}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw r&&this.baseApis.emit(z.KeySignatureUploadFailure,o,"setDeviceVerification",i),new C.KeySignatureUploadError("Key upload failed",{failures:o})};await i({shouldEmit:!0})}return n}return o}const a=this.deviceList.getRawStoredDevicesForUser(e);if(!a||!a[t])throw new Error("Unknown device "+e+":"+t);const c=a[t];let d=c.verified;if(n){if(s)for(const[e,t]of Object.entries(s))if(c.keys[e]!==t)throw new Error(`Key did not match expected value: expected ${t}, got ${c.keys[e]}`);d=B.VERIFIED}else null!==n&&d==B.VERIFIED&&(d=B.UNVERIFIED);i?d=B.BLOCKED:null!==i&&d==B.BLOCKED&&(d=B.UNVERIFIED);let h=c.known;if(null!==r&&(h=r),c.verified===d&&c.known===h||(c.verified=d,c.known=h,this.deviceList.storeDevicesForUser(e,a),this.deviceList.saveIfDirty()),n&&e===this.userId){let n;if(l.logger.info("Own device "+t+" marked verified: signing"),this.checkDeviceTrust(e,t).isCrossSigningVerified()?l.logger.log(`Own device ${t} already cross-signing verified`):n=await this.crossSigningInfo.signDevice(e,u.DeviceInfo.fromStorage(c,t)),n){const i=async({shouldEmit:r=!1})=>{l.logger.info("Uploading signature for "+t);const s=await this.baseApis.uploadKeySignatures({[e]:{[t]:n}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw r&&this.baseApis.emit(z.KeySignatureUploadFailure,o,"setDeviceVerification",i),new C.KeySignatureUploadError("Key upload failed",{failures:o})};await i({shouldEmit:!0})}}const p=u.DeviceInfo.fromStorage(c,t);return this.emit(z.DeviceVerificationChanged,e,t,p),p}findVerificationRequestDMInProgress(e){return this.inRoomVerificationRequests.findRequestInProgress(e)}getVerificationRequestsToDeviceInProgress(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}requestVerificationDM(e,t){const n=this.inRoomVerificationRequests.findRequestInProgress(t);if(n)return Promise.resolve(n);const i=new k.InRoomChannel(this.baseApis,t,e);return this.requestVerificationWithChannel(e,i,this.inRoomVerificationRequests)}requestVerification(e,t){t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));const n=this.toDeviceVerificationRequests.findRequestInProgress(e,t);if(n)return Promise.resolve(n);const i=new x.ToDeviceChannel(this.baseApis,e,t,x.ToDeviceChannel.makeTransactionId());return this.requestVerificationWithChannel(e,i,this.toDeviceVerificationRequests)}async requestVerificationWithChannel(e,t,n){let i=new E.VerificationRequest(t,this.verificationMethods,this.baseApis);t.transactionId&&n.setRequestByChannel(t,i),await i.sendRequest();const r=n.getRequestByChannel(t);return r?i=r:(l.logger.log(`Crypto: adding new request to requestsByTxnId with id ${t.transactionId} ${t.roomId}`),n.setRequestByChannel(t,i)),i}beginKeyVerification(e,t,n,i=null){let r;if(i){if(r=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,i),!r)throw new Error(`No request found for user ${t} with transactionId ${i}`)}else{i=x.ToDeviceChannel.makeTransactionId();const e=new x.ToDeviceChannel(this.baseApis,t,[n],i,n);r=new E.VerificationRequest(e,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,r)}return r.beginKeyVerification(e,{userId:t,deviceId:n})}async legacyDeviceVerification(e,t,n){const i=x.ToDeviceChannel.makeTransactionId(),r=new x.ToDeviceChannel(this.baseApis,e,[t],i,t),s=new E.VerificationRequest(r,this.verificationMethods,this.baseApis);this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,i,s);const o=s.beginKeyVerification(n,{userId:e,deviceId:t});return await Promise.race([o.verify(),s.waitFor((e=>e.started))]),s}async getOlmSessionsForUser(e){const t=this.getStoredDevicesForUser(e)||[],n={};for(let e=0;e<t.length;++e){const i=t[e],r=i.getIdentityKey(),s=await this.olmDevice.getSessionInfoForDevice(r);n[i.deviceId]={deviceIdKey:r,sessions:s}}return n}getEventSenderDeviceInfo(e){const t=e.getSenderKey(),n=e.getWireContent().algorithm;if(!t||!n)return null;if(e.isKeySourceUntrusted())return null;const i=this.deviceList.getDeviceByIdentityKey(n,t);if(null===i)return null;const r=e.getClaimedEd25519Key();return r?r!==i.getFingerprint()?(l.logger.warn("Event "+e.getId()+" claims ed25519 key "+r+" but sender device has key "+i.getFingerprint()),null):i:(l.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}getEventEncryptionInfo(e){const t={};if(t.senderKey=e.getSenderKey(),t.algorithm=e.getWireContent().algorithm,!t.senderKey||!t.algorithm)return t.encrypted=!1,t;t.encrypted=!0,e.isKeySourceUntrusted()?t.authenticated=!1:t.authenticated=!0,t.sender=this.deviceList.getDeviceByIdentityKey(t.algorithm,t.senderKey);const n=e.getClaimedEd25519Key();return n||(l.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),t.mismatchedSender=!0),t.sender&&n!==t.sender.getFingerprint()&&(l.logger.warn("Event "+e.getId()+" claims ed25519 key "+n+"but sender device has key "+t.sender.getFingerprint()),t.mismatchedSender=!0),t}forceDiscardSession(e){const t=this.roomEncryptors.get(e);if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()}async setRoomEncryption(e,t,n){if(!t.algorithm)return void l.logger.log("Ignoring setRoomEncryption with no algorithm");const i=this.roomList.getRoomEncryption(e);if(i&&JSON.stringify(i)!=JSON.stringify(t))return void l.logger.error("Ignoring m.room.encryption event which requests a change of config in "+e);if(this.roomEncryptors.get(e))return;let r=null;i||(r=this.roomList.setRoomEncryption(e,t));const s=p.ENCRYPTION_CLASSES.get(t.algorithm);if(!s)throw new Error("Unable to encrypt with "+t.algorithm);const o=new s({userId:this.userId,deviceId:this.deviceId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e,config:t});this.roomEncryptors.set(e,o),r&&await r,this.lazyLoadMembers?l.logger.log("Enabling encryption in "+e):(l.logger.log("Enabling encryption in "+e+"; starting to track device lists for all users therein"),await this.trackRoomDevices(e),n||this.deviceList.refreshOutdatedDeviceLists())}trackRoomDevices(e){let t=this.roomDeviceTrackingState[e];return t||(t=(async()=>{if(!this.roomEncryptors.has(e))return;const t=this.clientStore.getRoom(e);if(!t)throw new Error(`Unable to start tracking devices in unknown room ${e}`);l.logger.log(`Starting to track devices for room ${e} ...`),(await t.getEncryptionTargetMembers()).forEach((e=>{this.deviceList.startTrackingDeviceList(e.userId)}))})(),this.roomDeviceTrackingState[e]=t.catch((t=>{throw this.roomDeviceTrackingState[e]=null,t}))),t}ensureOlmSessionsForUsers(e,t){const n={};for(let t=0;t<e.length;++t){const i=e[t];n[i]=[];const r=this.getStoredDevicesForUser(i)||[];for(let e=0;e<r.length;++e){const t=r[e];t.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&t.verified!=B.BLOCKED&&n[i].push(t)}}return d.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,n,t)}async exportRoomKeys(){const e=[];return await this.cryptoStore.doTxn("readonly",[y.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(t=>{this.cryptoStore.getAllEndToEndInboundGroupSessions(t,(t=>{if(null===t)return;const n=this.olmDevice.exportInboundGroupSession(t.senderKey,t.sessionId,t.sessionData);delete n.first_known_index,n.algorithm=d.MEGOLM_ALGORITHM,e.push(n)}))})),e}importRoomKeys(e,t={}){let n=0,i=0;const r=e.length;function s(){t.progressCallback({stage:"load_keys",successes:n,failures:i,total:r})}return Promise.all(e.map((e=>e.room_id&&e.algorithm?this.getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally((()=>{n++,t.progressCallback&&s()})):(l.logger.warn("ignoring room key entry with missing fields",e),i++,t.progressCallback&&s(),null)))).then()}countSessionsNeedingBackup(){return this.backupManager.countSessionsNeedingBackup()}prepareToEncrypt(e){const t=this.roomEncryptors.get(e.roomId);t&&t.prepareToEncrypt(e)}async encryptEvent(e,t){if(!t)throw new Error("Cannot send encrypted messages in unknown rooms");const n=e.getRoomId(),i=this.roomEncryptors.get(n);if(!i)throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");this.roomDeviceTrackingState[n]||this.trackRoomDevices(n),await this.roomDeviceTrackingState[n];let r=e.getContent();const s=r["m.relates_to"];s&&(r=Object.assign({},r),delete r["m.relates_to"]);const o=r["io.element.performance_metrics"];o&&(r=Object.assign({},r),delete r["io.element.performance_metrics"]);const a=await i.encryptMessage(t,e.getType(),r);s&&(a["m.relates_to"]=s),o&&(a["io.element.performance_metrics"]=o),e.makeEncrypted("m.room.encrypted",a,this.olmDevice.deviceCurve25519Key,this.olmDevice.deviceEd25519Key)}async decryptEvent(e){if(e.isRedacted()){const t=new M.MatrixEvent(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({room_id:e.getRoomId()},e.getUnsigned().redacted_because)),n=await this.decryptEvent(t);return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:n.clearEvent}}}}{const t=e.getWireContent();return this.getRoomDecryptor(e.getRoomId(),t.algorithm).decryptEvent(e)}}async handleDeviceListChanges(e,t){e.oldSyncToken&&await this.evalDeviceListChanges(t)}requestRoomKey(e,t,n=!1){return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,n).then((()=>{this.sendKeyRequestsImmediately&&this.outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((e=>{l.logger.error("Error requesting key for event",e)}))}cancelRoomKeyRequest(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((e=>{l.logger.warn("Error clearing pending room key requests",e)}))}async cancelAndResendAllOutgoingKeyRequests(){await this.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()}async onCryptoEvent(e){const t=e.getRoomId(),n=e.getContent();try{await this.setRoomEncryption(t,n,!0)}catch(e){l.logger.error("Error configuring encryption in room "+t+":",e)}}async onSyncWillProcess(e){e.oldSyncToken||(l.logger.log("Initial sync performed - resetting device tracking state"),this.deviceList.stopTrackingAllDeviceLists(),this.deviceList.startTrackingDeviceList(this.userId),this.roomDeviceTrackingState={}),this.sendKeyRequestsImmediately=!1}async onSyncCompleted(e){this.deviceList.setSyncToken(e.nextSyncToken),this.deviceList.saveIfDirty(),this.deviceList.startTrackingDeviceList(this.userId),this.deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(this.maybeUploadOneTimeKeys(),this.processReceivedRoomKeyRequests(),this.outgoingRoomKeyRequestManager.sendQueuedRequests(),this.sendKeyRequestsImmediately=!0)}async evalDeviceListChanges(e){if(e.changed&&Array.isArray(e.changed)&&e.changed.forEach((e=>{this.deviceList.invalidateUserDeviceList(e)})),e.left&&Array.isArray(e.left)&&e.left.length){const t=new Set(await this.getTrackedE2eUsers());e.left.forEach((e=>{t.has(e)||this.deviceList.stopTrackingDeviceList(e)}))}}async getTrackedE2eUsers(){const e=[];for(const t of this.getTrackedE2eRooms()){const n=await t.getEncryptionTargetMembers();for(const t of n)e.push(t.userId)}return e}getTrackedE2eRooms(){return this.clientStore.getRooms().filter((e=>{if(!this.roomEncryptors.get(e.roomId))return!1;if(!this.roomDeviceTrackingState[e.roomId])return!1;const t=e.getMyMembership();return"join"===t||"invite"===t}))}async encryptAndSendToDevices(e,t){const n={eventType:o.EventType.RoomMessageEncrypted,batch:[]};try{await Promise.all(e.map((async({userId:e,deviceInfo:i})=>{const r=i.deviceId,s={algorithm:d.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};n.batch.push({userId:e,deviceId:r,payload:s}),await d.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[e]:[i]}),await d.encryptMessageForDevice(s.ciphertext,this.userId,this.deviceId,this.olmDevice,e,i,t)}))),n.batch=n.batch.filter((e=>Object.keys(e.payload.ciphertext).length>0||(l.logger.log(`No ciphertext for device ${e.userId}:${e.deviceId}: pruning`),!1)));try{await this.baseApis.queueToDevice(n)}catch(e){throw l.logger.error("sendToDevice failed",e),e}}catch(e){throw l.logger.error("encryptAndSendToDevices promises failed",e),e}}onRoomKeyEvent(e){const t=e.getContent();t.room_id&&t.algorithm?(this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):l.logger.error("key event is missing fields")}onRoomKeyWithheldEvent(e){const t=e.getContent();if(!(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key))return void l.logger.error("key withheld event is missing fields");l.logger.info(`Got room key withheld event from ${e.getSender()} (${t.sender_key}) for ${t.algorithm}/${t.room_id}/${t.session_id} with reason ${t.code} (${t.reason})`);const n=this.getRoomDecryptor(t.room_id,t.algorithm);if(n.onRoomKeyWithheldEvent&&n.onRoomKeyWithheldEvent(e),!t.room_id){const e=this.getRoomDecryptors(t.algorithm);for(const n of e)n.retryDecryptionFromSender(t.sender_key)}}onKeyVerificationMessage(e){x.ToDeviceChannel.validateEvent(e,this.baseApis)&&this.handleVerificationEvent(e,this.toDeviceVerificationRequests,(e=>{if(!x.ToDeviceChannel.canCreateRequest(x.ToDeviceChannel.getEventType(e)))return;const t=e.getContent(),n=t&&t.from_device;if(!n)return;const i=e.getSender(),r=new x.ToDeviceChannel(this.baseApis,i,[n]);return new E.VerificationRequest(r,this.verificationMethods,this.baseApis)}))}async handleVerificationEvent(e,t,n,i=!0){if(e.isSending()&&e.status!=M.EventStatus.SENT){let t,n;try{await new Promise(((i,r)=>{t=i,n=()=>{e.status==M.EventStatus.CANCELLED&&r(new Error("Event status set to CANCELLED."))},e.once(M.MatrixEventEvent.LocalEventIdReplaced,t),e.on(M.MatrixEventEvent.Status,n)}))}catch(e){return void l.logger.error("error while waiting for the verification event to be sent: ",e)}finally{e.removeListener(M.MatrixEventEvent.LocalEventIdReplaced,t),e.removeListener(M.MatrixEventEvent.Status,n)}}let r=t.getRequest(e),s=!1;if(!r){if(r=n(e),!r)return void l.logger.log(`Crypto: could not find VerificationRequest for ${e.getType()}, and could not create one, so ignoring.`);s=!0,t.setRequest(e,r)}e.setVerificationRequest(r);try{await r.channel.handleEvent(e,r,i)}catch(e){l.logger.error("error while handling verification event",e)}s&&!r.initiatedByMe&&!r.invalid&&!r.observeOnly&&this.baseApis.emit(z.VerificationRequest,r)}async onToDeviceBadEncrypted(e){const t=e.getWireContent(),n=e.getSender(),i=t.algorithm,r=t.sender_key,s=()=>{const e=this.getRoomDecryptors(d.MEGOLM_ALGORITHM);for(const t of e)t.retryDecryptionFromSender(r)};if(void 0===n||void 0===r||void 0===r)return;this.lastNewSessionForced[n]=this.lastNewSessionForced[n]||{};const o=this.lastNewSessionForced[n][r]||0;if(o+36e5>Date.now())return l.logger.debug("New session already forced with device "+n+":"+r+" at "+o+": not forcing another"),await this.olmDevice.recordSessionProblem(r,"wedged",!0),void s();let a=this.deviceList.getDeviceByIdentityKey(i,r);if(!a&&(await this.downloadKeys([n],!1),a=this.deviceList.getDeviceByIdentityKey(i,r),!a))return l.logger.info("Couldn't find device for identity key "+r+": not re-establishing session"),await this.olmDevice.recordSessionProblem(r,"wedged",!1),void s();const c={};c[n]=[a],await d.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,c,!0),this.lastNewSessionForced[n][r]=Date.now();const h={algorithm:d.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await d.encryptMessageForDevice(h.ciphertext,this.userId,this.deviceId,this.olmDevice,n,a,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(r,"wedged",!0),s(),await this.baseApis.sendToDevice("m.room.encrypted",{[n]:{[a.deviceId]:h}});const u=await this.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(n,a.deviceId);for(const e of u)this.requestRoomKey(e.requestBody,e.recipients,!0)}onRoomMembership(e,t,n){const i=t.roomId,r=this.roomEncryptors.get(i);r&&(this.roomDeviceTrackingState[i]&&("join"==t.membership?(l.logger.log("Join event for "+t.userId+" in "+i),this.deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this.clientStore.getRoom(i).shouldEncryptForInvitedMembers()&&(l.logger.log("Invite event for "+t.userId+" in "+i),this.deviceList.startTrackingDeviceList(t.userId))),r.onRoomMembership(e,t,n))}onRoomKeyRequestEvent(e){const t=e.getContent();if("request"===t.action){const t=new H(e);this.receivedRoomKeyRequests.push(t)}else if("request_cancellation"===t.action){const t=new W(e);this.receivedRoomKeyRequestCancellations.push(t)}}async processReceivedRoomKeyRequests(){if(!this.processingRoomKeyRequests){this.processingRoomKeyRequests=!0;try{const e=this.receivedRoomKeyRequests;this.receivedRoomKeyRequests=[];const t=this.receivedRoomKeyRequestCancellations;this.receivedRoomKeyRequestCancellations=[],await Promise.all(e.map((e=>this.processReceivedRoomKeyRequest(e)))),await Promise.all(t.map((e=>this.processReceivedRoomKeyRequestCancellation(e))))}catch(e){l.logger.error(`Error processing room key requsts: ${e}`)}finally{this.processingRoomKeyRequests=!1}}}async processReceivedRoomKeyRequest(e){const t=e.userId,n=e.deviceId,i=e.requestBody,r=i.room_id,s=i.algorithm;if(l.logger.log(`m.room_key_request from ${t}:${n} for ${r} / ${i.session_id} (id ${e.requestId})`),t!==this.userId){if(!this.roomEncryptors.get(r))return void l.logger.debug(`room key request for unencrypted room ${r}`);const e=this.roomEncryptors.get(r),s=this.deviceList.getStoredDevice(t,n);if(!s)return void l.logger.debug(`Ignoring keyshare for unknown device ${t}:${n}`);try{await e.reshareKeyWithDevice(i.sender_key,i.session_id,t,s)}catch(e){l.logger.warn("Failed to re-share keys for session "+i.session_id+" with device "+t+":"+s.deviceId,e)}return}if(n===this.deviceId)return void l.logger.log("Ignoring room key request from ourselves");if(!this.roomDecryptors.has(r))return void l.logger.log(`room key request for unencrypted room ${r}`);const o=this.roomDecryptors.get(r).get(s);if(o)if(await o.hasKeysForKeyRequest(e)){if(e.share=()=>{o.shareKeysWithDevice(e)},this.checkDeviceTrust(t,n).isVerified())return l.logger.log("device is already verified: sharing keys"),void e.share();this.emit(z.RoomKeyRequest,e)}else l.logger.log(`room key request for unknown session ${r} / `+i.session_id);else l.logger.log(`room key request for unknown alg ${s} in room ${r}`)}async processReceivedRoomKeyRequestCancellation(e){l.logger.log(`m.room_key_request cancellation for ${e.userId}:${e.deviceId} (id ${e.requestId})`),this.emit(z.RoomKeyRequestCancellation,e)}getRoomDecryptor(e,t){let n,i;if((e=e||null)&&(n=this.roomDecryptors.get(e),n||(n=new Map,this.roomDecryptors.set(e,n)),i=n.get(t),i))return i;const r=p.DECRYPTION_CLASSES.get(t);if(!r)throw new p.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return i=new r({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e}),n&&n.set(t,i),i}getRoomDecryptors(e){const t=[];for(const n of this.roomDecryptors.values())n.has(e)&&t.push(n.get(e));return t}async signObject(e){const t=e.signatures||{},n=e.unsigned;delete e.signatures,delete e.unsigned,t[this.userId]=t[this.userId]||{},t[this.userId]["ed25519:"+this.deviceId]=await this.olmDevice.sign(s.default.stringify(e)),e.signatures=t,void 0!==n&&(e.unsigned=n)}}function K(e){if("string"!=typeof e||e.indexOf(",")<0)return null;const t=Uint8Array.from(e.split(","),(e=>parseInt(e)));return d.encodeBase64(t)}t.Crypto=V;class H{constructor(e){(0,r.default)(this,"userId",void 0),(0,r.default)(this,"deviceId",void 0),(0,r.default)(this,"requestId",void 0),(0,r.default)(this,"requestBody",void 0),(0,r.default)(this,"share",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}t.IncomingRoomKeyRequest=H;class W{constructor(e){(0,r.default)(this,"userId",void 0),(0,r.default)(this,"deviceId",void 0),(0,r.default)(this,"requestId",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}},1597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deriveKey=a,t.keyFromAuthData=function(e,t){if(!n.g.Olm)throw new Error("Olm is not available");if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return a(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits||256)},t.keyFromPassphrase=async function(e){if(!n.g.Olm)throw new Error("Olm is not available");const t=(0,i.randomString)(32);return{key:await a(e,t,o,256),salt:t,iterations:o}};var i=n(8401),r=n(3102);const s="undefined"!=typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,o=5e5;async function a(e,t,i,o=256){return s?async function(e,t,i,r){const s=n.g.crypto.subtle,o=n.g.TextEncoder;if(!s||!o)throw new Error("Password-based backup is not avaiable on this platform");const a=await s.importKey("raw",(new o).encode(e),{name:"PBKDF2"},!1,["deriveBits"]),l=await s.deriveBits({name:"PBKDF2",salt:(new o).encode(t),iterations:i,hash:"SHA-512"},a,r);return new Uint8Array(l)}(e,t,i,o):async function(e,t,n,i){const s=(0,r.getCrypto)();if(!s)throw new Error("No usable crypto implementation");return s.pbkdf2Sync(e,Buffer.from(t,"binary"),n,i,"sha512")}(e,t,i,o)}},2772:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.OLM_ALGORITHM=t.MEGOLM_BACKUP_ALGORITHM=t.MEGOLM_ALGORITHM=void 0,t.decodeBase64=function(e){return Buffer.from(e,"base64")},t.encodeBase64=p,t.encodeUnpaddedBase64=function(e){return p(e).replace(/=+$/g,"")},t.encryptMessageForDevice=async function(e,t,n,i,r,s,a){const l=s.getIdentityKey(),c=await i.getSessionIdForDevice(l);if(null===c)return;o.logger.log("Using sessionid "+c+" for device "+r+":"+s.deviceId);const d={sender:t,sender_device:n,keys:{ed25519:i.deviceEd25519Key},recipient:r,recipient_keys:{ed25519:s.getFingerprint()}};Object.assign(d,a),e[l]=await i.encryptMessage(l,c,JSON.stringify(d))},t.ensureOlmSessionsForDevices=async function(e,t,n,i=!1,r,s,a=o.logger){"number"==typeof i&&(a=s,s=r,r=i,i=!1);const l=[],c={},d={};for(const[,t]of Object.entries(n))for(const n of t){const t=n.getIdentityKey();t!==e.deviceCurve25519Key&&(e.sessionsInProgress[t]||(e.sessionsInProgress[t]=new Promise((n=>{d[t]=i=>{delete e.sessionsInProgress[t],n(i)}}))))}for(const[t,r]of Object.entries(n)){c[t]={};for(const n of r){const r=n.deviceId,s=n.getIdentityKey();if(s===e.deviceCurve25519Key){a.info("Attempted to start session with ourself! Ignoring"),c[t][r]={device:n,sessionId:null};continue}const o=`for ${s} (${t}:${r})`,h=await e.getSessionIdForDevice(s,!!d[s],a);null!==h&&d[s]&&d[s](),(null===h||i)&&(i?a.info(`Forcing new Olm session ${o}`):a.info(`Making new Olm session ${o}`),l.push([t,r])),c[t][r]={device:n,sessionId:h}}}if(0===l.length)return c;let u,p=`one-time keys for ${l.length} devices`;try{a.debug(`Claiming ${p}`),u=await t.claimOneTimeKeys(l,"signed_curve25519",r),a.debug(`Claimed ${p}`)}catch(e){for(const e of Object.values(d))e();throw a.log(`Failed to claim ${p}`,e,l),e}s&&"failures"in u&&s.push(...Object.keys(u.failures));const m=u.one_time_keys||{},g=[];for(const[t,r]of Object.entries(n)){const n=m[t]||{};for(let s=0;s<r.length;s++){const o=r[s],l=o.deviceId,u=o.getIdentityKey();if(u===e.deviceCurve25519Key)continue;if(c[t][l].sessionId&&!i)continue;const p=n[l]||{};let m=null;for(const e in p)0===e.indexOf("signed_curve25519:")&&(m=p[e]);m?g.push(h(e,m,t,o).then((e=>{d[u]&&d[u](e),c[t][l].sessionId=e}),(e=>{throw d[u]&&d[u](),e}))):(a.warn(`No one-time keys (alg=signed_curve25519) for device ${t}:${l}`),d[u]&&d[u]())}}return p=`Olm sessions for ${g.length} devices`,a.debug(`Starting ${p}`),await Promise.all(g),a.debug(`Started ${p}`),c},t.getExistingOlmSessions=async function(e,t,n){const i={},r={},s=[];for(const[t,o]of Object.entries(n))for(const n of o){const o=n.deviceId,a=n.getIdentityKey();s.push((async()=>{const s=await e.getSessionIdForDevice(a,!0);null===s?(i[t]=i[t]||[],i[t].push(n)):(r[t]=r[t]||{},r[t][o]={device:n,sessionId:s})})())}return await Promise.all(s),[i,r]},t.isOlmEncrypted=function(e){return e.getSenderKey()?!(e.getWireType()!==a.EventType.RoomMessageEncrypted||!["m.olm.v1.curve25519-aes-sha2"].includes(e.getWireContent().algorithm))||(o.logger.error("Event was not encrypted using an appropriate algorithm"),!1):(o.logger.error("Event has no sender key (not encrypted?)"),!1)},t.pkSign=function(e,t,i,r){let o=!1;if(t instanceof Uint8Array){const e=new n.g.Olm.PkSigning;r=e.init_with_seed(t),t=e,o=!0}const a=e.signatures||{};delete e.signatures;const l=e.unsigned;e.unsigned&&delete e.unsigned;try{const n=a[i]||{};return a[i]=n,n["ed25519:"+r]=t.sign(s.default.stringify(e))}finally{e.signatures=a,l&&(e.unsigned=l),o&&t.free()}},t.pkVerify=function(e,t,i){const r="ed25519:"+t;if(!(e.signatures&&e.signatures[i]&&e.signatures[i][r]))throw new Error("No signature");const o=e.signatures[i][r],a=new n.g.Olm.Utility,l=e.signatures;delete e.signatures;const c=e.unsigned;e.unsigned&&delete e.unsigned;try{a.ed25519_verify(t,s.default.stringify(e),o)}finally{e.signatures=l,c&&(e.unsigned=c),a.free()}},t.verifySignature=u;var r,s=i(n(9141)),o=n(7434),a=n(2481);!function(e){e.Olm="m.olm.v1.curve25519-aes-sha2",e.Megolm="m.megolm.v1.aes-sha2",e.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2"}(r||(r={}));const l=r.Olm;t.OLM_ALGORITHM=l;const c=r.Megolm;t.MEGOLM_ALGORITHM=c;const d=r.MegolmBackup;async function h(e,t,n,i){const r=i.deviceId;try{await u(e,t,n,r,i.getFingerprint())}catch(e){return o.logger.error("Unable to verify signature on one-time key for device "+n+":"+r+":",e),null}let s;try{s=await e.createOutboundSession(i.getIdentityKey(),t.key)}catch(e){return o.logger.error("Error starting olm session with device "+n+":"+r+": "+e),null}return o.logger.log("Started new olm sessionid "+s+" for device "+n+":"+r),s}async function u(e,t,n,i,r){const o="ed25519:"+i,a=((t.signatures||{})[n]||{})[o];if(!a)throw Error("No signature");const l=Object.assign({},t);"unsigned"in l&&delete l.unsigned,delete l.signatures;const c=s.default.stringify(l);e.verifySignature(r,c,a)}function p(e){return Buffer.from(e).toString("base64")}t.MEGOLM_BACKUP_ALGORITHM=d},4077:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeRecoveryKey=function(e){const t=i.decode(e.replace(/ /g,""));let r=0;for(const e of t)r^=e;if(0!==r)throw new Error("Incorrect parity");for(let e=0;e<s.length;++e)if(t[e]!==s[e])throw new Error("Incorrect prefix");if(t.length!==s.length+n.g.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(s.length,s.length+n.g.Olm.PRIVATE_KEY_LENGTH))},t.encodeRecoveryKey=function(e){const t=Buffer.alloc(s.length+e.length+1);t.set(s,0),t.set(e,s.length);let n=0;for(let e=0;e<t.length-1;++e)n^=t[e];return t[t.length-1]=n,i.encode(t).match(/.{1,4}/g).join(" ")};var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(n(7191));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}const s=[139,1]},5251:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=t.Backend=void 0,t.upgradeDatabase=function(e,t){s.logger.log(`Upgrading IndexedDBCryptoStore from version ${t} to ${c}`),l.forEach(((n,i)=>{t<=i&&n(e)}))};var r=i(n(8416)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}t.Backend=class{constructor(e){this.db=e,(0,r.default)(this,"nextTxnId",0),e.onversionchange=()=>{s.logger.log(`versionchange for indexeddb ${this.db.name}: closing`),e.close()}}async startup(){return this}async deleteAllData(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise(((n,i)=>{const r=this.db.transaction("outgoingRoomKeyRequests","readwrite");r.onerror=i,this._getOutgoingRoomKeyRequest(r,t,(i=>{if(i)return s.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),void n(i);s.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),r.oncomplete=()=>{n(e)},r.objectStore("outgoingRoomKeyRequests").add(e)}))}))}getOutgoingRoomKeyRequest(e){return new Promise(((t,n)=>{const i=this.db.transaction("outgoingRoomKeyRequests","readonly");i.onerror=n,this._getOutgoingRoomKeyRequest(i,e,(e=>{t(e)}))}))}_getOutgoingRoomKeyRequest(e,t,n){const i=e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]);i.onsuccess=()=>{const e=i.result;if(!e)return void n(null);const r=e.value;o.deepCompare(r.requestBody,t)?n(r):e.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,n=0;const i=this.db.transaction("outgoingRoomKeyRequests","readonly"),r=i.objectStore("outgoingRoomKeyRequests"),s=e[n];return r.index("state").openCursor(s).onsuccess=function i(){const r=this.result;if(r)return void(t=r.value);if(n++,n>=e.length)return;const s=e[n];this.source.openCursor(s).onsuccess=i},h(i).then((()=>t))}getAllOutgoingRoomKeyRequestsByState(e){return new Promise(((t,n)=>{const i=this.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);i.onsuccess=()=>t(i.result),i.onerror=()=>n(i.error)}))}getOutgoingRoomKeyRequestsByTarget(e,t,n){let i=0;const r=[],s=this.db.transaction("outgoingRoomKeyRequests","readonly"),o=s.objectStore("outgoingRoomKeyRequests"),a=n[i];return o.index("state").openCursor(a).onsuccess=function s(){const o=this.result;if(o){const n=o.value;n.recipients.some((n=>n.userId===e&&n.deviceId===t))&&r.push(n),o.continue()}else{if(i++,i>=n.length)return;const e=n[i];this.source.openCursor(e).onsuccess=s}},h(s).then((()=>r))}updateOutgoingRoomKeyRequest(e,t,n){let i=null;const r=this.db.transaction("outgoingRoomKeyRequests","readwrite");return r.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(){const e=this.result;if(!e)return;const r=e.value;r.state==t?(Object.assign(r,n),e.update(r),i=r):s.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${r.state}`)},h(r).then((()=>i))}deleteOutgoingRoomKeyRequest(e,t){const n=this.db.transaction("outgoingRoomKeyRequests","readwrite"),i=n.objectStore("outgoingRoomKeyRequests").openCursor(e);return i.onsuccess=()=>{const e=i.result;if(!e)return;const n=e.value;n.state==t?e.delete():s.logger.warn(`Cannot delete room key request in state ${n.state} (expected ${t})`)},h(n)}getAccount(e,t){const n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){d(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(t){d(e,t)}}}getSecretStorePrivateKey(e,t,n){const i=e.objectStore("account").get(`ssss_cache:${n}`);i.onsuccess=function(){try{t(i.result||null)}catch(t){d(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,n){e.objectStore("account").put(n,`ssss_cache:${t}`)}countEndToEndSessions(e,t){const n=e.objectStore("sessions").count();n.onsuccess=function(){try{t(n.result)}catch(t){d(e,t)}}}getEndToEndSessions(e,t,n){const i=t.objectStore("sessions").index("deviceKey").openCursor(e),r={};i.onsuccess=function(){const e=i.result;if(e)r[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(r)}catch(e){d(t,e)}}}getEndToEndSession(e,t,n,i){const r=n.objectStore("sessions").get([e,t]);r.onsuccess=function(){try{r.result?i({session:r.result.session,lastReceivedMessageTs:r.result.lastReceivedMessageTs}):i(null)}catch(e){d(n,e)}}}getAllEndToEndSessions(e,t){const n=e.objectStore("sessions").openCursor();n.onsuccess=function(){try{const e=n.result;e?(t(e.value),e.continue()):t(null)}catch(t){d(e,t)}}}storeEndToEndSession(e,t,n,i){i.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,t,n){const i=this.db.transaction("session_problems","readwrite");return i.objectStore("session_problems").put({deviceKey:e,type:t,fixed:n,time:Date.now()}),h(i)}async getEndToEndSessionProblem(e,t){let n;const i=this.db.transaction("session_problems","readwrite"),r=i.objectStore("session_problems").index("deviceKey").getAll(e);return r.onsuccess=()=>{const e=r.result;if(!e.length)return void(n=null);e.sort(((e,t)=>e.time-t.time));const i=e[e.length-1];for(const r of e)if(r.time>t)return void(n=Object.assign({},r,{fixed:i.fixed}));n=i.fixed?null:i},await h(i),n}async filterOutNotifiedErrorDevices(e){const t=this.db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),n=[];return await Promise.all(e.map((e=>new Promise((i=>{const{userId:r,deviceInfo:s}=e,o=t.get([r,s.deviceId]);o.onsuccess=function(){o.result||(t.put({userId:r,deviceId:s.deviceId}),n.push(e)),i()}}))))),n}getEndToEndInboundGroupSession(e,t,n,i){let r=!1,s=!1;const o=n.objectStore("inbound_group_sessions").get([e,t]);o.onsuccess=function(){try{r=o.result?o.result.session:null,!1!==s&&i(r,s)}catch(e){d(n,e)}};const a=n.objectStore("inbound_group_sessions_withheld").get([e,t]);a.onsuccess=function(){try{s=a.result?a.result.session:null,!1!==r&&i(r,s)}catch(e){d(n,e)}}}getAllEndToEndInboundGroupSessions(e,t){const n=e.objectStore("inbound_group_sessions").openCursor();n.onsuccess=function(){const i=n.result;if(i){try{t({senderKey:i.value.senderCurve25519Key,sessionId:i.value.sessionId,sessionData:i.value.session})}catch(t){d(e,t)}i.continue()}else try{t(null)}catch(t){d(e,t)}}}addEndToEndInboundGroupSession(e,t,n,i){const r=i.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:n});r.onerror=n=>{"ConstraintError"===r.error.name?(n.stopPropagation(),n.preventDefault(),s.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):d(i,new Error("Failed to add inbound group session: "+r.error))}}storeEndToEndInboundGroupSession(e,t,n,i){i.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){i.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:n})}getEndToEndDeviceData(e,t){const n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){d(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,n){n.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){const n={},i=e.objectStore("rooms").openCursor();i.onsuccess=function(){const r=i.result;if(r)n[r.key]=r.value,r.continue();else try{t(n)}catch(t){d(e,t)}}}getSessionsNeedingBackup(e){return new Promise(((t,n)=>{const i=[],r=this.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");r.onerror=n,r.oncomplete=function(){t(i)};const s=r.objectStore("sessions_needing_backup"),o=r.objectStore("inbound_group_sessions"),a=s.openCursor();a.onsuccess=function(){const t=a.result;if(t){const n=o.get(t.key);n.onsuccess=function(){i.push({senderKey:n.result.senderCurve25519Key,sessionId:n.result.sessionId,sessionData:n.result.session})},(!e||i.length<e)&&t.continue()}}}))}countSessionsNeedingBackup(e){e||(e=this.db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise(((e,n)=>{const i=t.count();i.onerror=n,i.onsuccess=()=>e(i.result)}))}async unmarkSessionsNeedingBackup(e,t){t||(t=this.db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");await Promise.all(e.map((e=>new Promise(((t,i)=>{const r=n.delete([e.senderKey,e.sessionId]);r.onsuccess=t,r.onerror=i})))))}async markSessionsNeedingBackup(e,t){t||(t=this.db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");await Promise.all(e.map((e=>new Promise(((t,i)=>{const r=n.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});r.onsuccess=t,r.onerror=i})))))}addSharedHistoryInboundGroupSession(e,t,n,i){i||(i=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));const r=i.objectStore("shared_history_inbound_group_sessions"),s=r.get([e]);s.onsuccess=()=>{const{sessions:i}=s.result||{sessions:[]};i.push([t,n]),r.put({roomId:e,sessions:i})}}getSharedHistoryInboundGroupSessions(e,t){t||(t=this.db.transaction("shared_history_inbound_group_sessions","readonly"));const n=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise(((e,t)=>{n.onsuccess=()=>{const{sessions:t}=n.result||{sessions:[]};e(t)},n.onerror=t}))}addParkedSharedHistory(e,t,n){n||(n=this.db.transaction("parked_shared_history","readwrite"));const i=n.objectStore("parked_shared_history"),r=i.get([e]);r.onsuccess=()=>{const{parked:n}=r.result||{parked:[]};n.push(t),i.put({roomId:e,parked:n})}}takeParkedSharedHistory(e,t){t||(t=this.db.transaction("parked_shared_history","readwrite"));const n=t.objectStore("parked_shared_history").openCursor(e);return new Promise(((e,t)=>{n.onsuccess=()=>{const t=n.result;if(!t)return void e([]);const i=t.value;t.delete(),e(i)},n.onerror=t}))}doTxn(e,t,n,i=s.logger){const r=this.db.transaction(t,e),o=h(r),a=n(r);return o.then((()=>a))}};const l=[e=>{!function(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e)},e=>{e.createObjectStore("account")},e=>{e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},e=>{e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("device_data")},e=>{e.createObjectStore("rooms")},e=>{e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},e=>{e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},e=>{e.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],c=l.length;function d(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function h(e){return new Promise(((t,n)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&n(e._mx_abortexception),t(null)},e.onerror=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(s.logger.log("Error performing indexeddb txn",t),n(e.error))},e.onabort=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(s.logger.log("Error performing indexeddb txn",t),n(e.error))}}))}t.VERSION=c},7585:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var r=i(n(8416)),s=n(7434),o=n(4250),a=n(1045),l=u(n(5251)),c=n(9489),d=u(n(3415));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}class p{static exists(e,t){return d.exists(e,t)}constructor(e,t){this.indexedDB=e,this.dbName=t,(0,r.default)(this,"backendPromise",null),(0,r.default)(this,"backend",null)}startup(){return this.backendPromise||(this.backendPromise=new Promise(((e,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));s.logger.log(`connecting to indexeddb ${this.dbName}`);const n=this.indexedDB.open(this.dbName,l.VERSION);n.onupgradeneeded=e=>{const t=n.result,i=e.oldVersion;l.upgradeDatabase(t,i)},n.onblocked=()=>{s.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{s.logger.log("Error connecting to indexeddb",e),t(n.error)},n.onsuccess=()=>{const t=n.result;s.logger.log(`connected to indexeddb ${this.dbName}`),e(new l.Backend(t))}})).then((e=>e.doTxn("readonly",[p.STORE_INBOUND_GROUP_SESSIONS,p.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(t=>{e.getEndToEndInboundGroupSession("","",t,(()=>{}))})).then((()=>e)))).catch((e=>{if("VersionError"===e.name)throw s.logger.warn("Crypto DB is too new for us to use!",e),new c.InvalidCryptoStoreError(c.InvalidCryptoStoreError.TOO_NEW);s.logger.warn(`unable to connect to indexeddb ${this.dbName}: falling back to localStorage store: ${e}`);try{return new o.LocalStorageCryptoStore(n.g.localStorage)}catch(e){return s.logger.warn(`unable to open localStorage: falling back to in-memory store: ${e}`),new a.MemoryCryptoStore}})).then((e=>(this.backend=e,e)))),this.backendPromise}deleteAllData(){return new Promise(((e,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));s.logger.log(`Removing indexeddb instance: ${this.dbName}`);const n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{s.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{s.logger.log("Error deleting data from indexeddb",e),t(n.error)},n.onsuccess=()=>{s.logger.log(`Removed indexeddb instance: ${this.dbName}`),e()}})).catch((e=>{s.logger.warn(`unable to delete IndexedDBCryptoStore: ${e}`)}))}getOrAddOutgoingRoomKeyRequest(e){return this.backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this.backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this.backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this.backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,n){return this.backend.getOutgoingRoomKeyRequestsByTarget(e,t,n)}updateOutgoingRoomKeyRequest(e,t,n){return this.backend.updateOutgoingRoomKeyRequest(e,t,n)}deleteOutgoingRoomKeyRequest(e,t){return this.backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this.backend.getAccount(e,t)}storeAccount(e,t){this.backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this.backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,n){this.backend.getSecretStorePrivateKey(e,t,n)}storeCrossSigningKeys(e,t){this.backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,n){this.backend.storeSecretStorePrivateKey(e,t,n)}countEndToEndSessions(e,t){this.backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,n,i){this.backend.getEndToEndSession(e,t,n,i)}getEndToEndSessions(e,t,n){this.backend.getEndToEndSessions(e,t,n)}getAllEndToEndSessions(e,t){this.backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,n,i){this.backend.storeEndToEndSession(e,t,n,i)}storeEndToEndSessionProblem(e,t,n){return this.backend.storeEndToEndSessionProblem(e,t,n)}getEndToEndSessionProblem(e,t){return this.backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this.backend.filterOutNotifiedErrorDevices(e)}getEndToEndInboundGroupSession(e,t,n,i){this.backend.getEndToEndInboundGroupSession(e,t,n,i)}getAllEndToEndInboundGroupSessions(e,t){this.backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,n,i){this.backend.addEndToEndInboundGroupSession(e,t,n,i)}storeEndToEndInboundGroupSession(e,t,n,i){this.backend.storeEndToEndInboundGroupSession(e,t,n,i)}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){this.backend.storeEndToEndInboundGroupSessionWithheld(e,t,n,i)}storeEndToEndDeviceData(e,t){this.backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this.backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,n){this.backend.storeEndToEndRoom(e,t,n)}getEndToEndRooms(e,t){this.backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this.backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this.backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this.backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this.backend.markSessionsNeedingBackup(e,t)}addSharedHistoryInboundGroupSession(e,t,n,i){this.backend.addSharedHistoryInboundGroupSession(e,t,n,i)}getSharedHistoryInboundGroupSessions(e,t){return this.backend.getSharedHistoryInboundGroupSessions(e,t)}addParkedSharedHistory(e,t,n){this.backend.addParkedSharedHistory(e,t,n)}takeParkedSharedHistory(e,t){return this.backend.takeParkedSharedHistory(e,t)}doTxn(e,t,n,i){return this.backend.doTxn(e,t,n,i)}}t.IndexedDBCryptoStore=p,(0,r.default)(p,"STORE_ACCOUNT","account"),(0,r.default)(p,"STORE_SESSIONS","sessions"),(0,r.default)(p,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),(0,r.default)(p,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),(0,r.default)(p,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),(0,r.default)(p,"STORE_PARKED_SHARED_HISTORY","parked_shared_history"),(0,r.default)(p,"STORE_DEVICE_DATA","device_data"),(0,r.default)(p,"STORE_ROOMS","rooms"),(0,r.default)(p,"STORE_BACKUP","sessions_needing_backup")},4250:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageCryptoStore=void 0;var i=n(7434),r=n(1045);const s="crypto.account",o="crypto.cross_signing_keys",a="crypto.notified_error_devices",l="crypto.device_data",c="crypto.inboundgroupsessions/",d="crypto.sessionsneedingbackup";function h(e){return"crypto.sessions/"+e}function u(e){return"crypto.session.problems/"+e}function p(e,t){return c+e+"/"+t}function m(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function g(e){return"crypto.rooms/"+e}class f extends r.MemoryCryptoStore{static exists(e){const t=e.length;for(let n=0;n<t;n++)if(e.key(n).startsWith("crypto."))return!0;return!1}constructor(e){super(),this.store=e}countEndToEndSessions(e,t){let n=0;for(let e=0;e<this.store.length;++e)this.store.key(e).startsWith(h(""))&&++n;t(n)}_getEndToEndSessions(e){const t=v(this.store,h(e)),n={};for(const[e,i]of Object.entries(t||{}))n[e]="string"==typeof i?{session:i}:i;return n}getEndToEndSession(e,t,n,i){i(this._getEndToEndSessions(e)[t]||{})}getEndToEndSessions(e,t,n){n(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let e=0;e<this.store.length;++e)if(this.store.key(e).startsWith(h(""))){const n=this.store.key(e).split("/")[1];for(const e of Object.values(this._getEndToEndSessions(n)))t(e)}}storeEndToEndSession(e,t,n,i){const r=this._getEndToEndSessions(e)||{};r[t]=n,y(this.store,h(e),r)}async storeEndToEndSessionProblem(e,t,n){const i=u(e),r=v(this.store,i)||[];r.push({type:t,fixed:n,time:Date.now()}),r.sort(((e,t)=>e.time-t.time)),y(this.store,i,r)}async getEndToEndSessionProblem(e,t){const n=u(e),i=v(this.store,n)||[];if(!i.length)return null;const r=i[i.length-1];for(const e of i)if(e.time>t)return Object.assign({},e,{fixed:r.fixed});return r.fixed?null:r}async filterOutNotifiedErrorDevices(e){const t=v(this.store,a)||{},n=[];for(const i of e){const{userId:e,deviceInfo:r}=i;e in t?r.deviceId in t[e]||(n.push(i),t[e][r.deviceId]=!0):(n.push(i),t[e]={[r.deviceId]:!0})}return y(this.store,a,t),n}getEndToEndInboundGroupSession(e,t,n,i){i(v(this.store,p(e,t)),v(this.store,m(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let e=0;e<this.store.length;++e){const n=this.store.key(e);n.startsWith(c)&&t({senderKey:n.slice(c.length,c.length+43),sessionId:n.slice(c.length+44),sessionData:v(this.store,n)})}t(null)}addEndToEndInboundGroupSession(e,t,n,i){v(this.store,p(e,t))||this.storeEndToEndInboundGroupSession(e,t,n,i)}storeEndToEndInboundGroupSession(e,t,n,i){y(this.store,p(e,t),n)}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){y(this.store,m(e,t),n)}getEndToEndDeviceData(e,t){t(v(this.store,l))}storeEndToEndDeviceData(e,t){y(this.store,l,e)}storeEndToEndRoom(e,t,n){y(this.store,g(e),t)}getEndToEndRooms(e,t){const n={},i=g("");for(let e=0;e<this.store.length;++e){const t=this.store.key(e);t.startsWith(i)&&(n[t.slice(i.length)]=v(this.store,t))}t(n)}getSessionsNeedingBackup(e){const t=v(this.store,d)||{},n=[];for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const t=i.slice(0,43),r=i.slice(44);if(this.getEndToEndInboundGroupSession(t,r,null,(e=>{n.push({senderKey:t,sessionId:r,sessionData:e})})),e&&n.length>=e)break}return Promise.resolve(n)}countSessionsNeedingBackup(){const e=v(this.store,d)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=v(this.store,d)||{};for(const n of e)delete t[n.senderKey+"/"+n.sessionId];return y(this.store,d,t),Promise.resolve()}markSessionsNeedingBackup(e){const t=v(this.store,d)||{};for(const n of e)t[n.senderKey+"/"+n.sessionId]=!0;return y(this.store,d,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(s),Promise.resolve()}getAccount(e,t){t(v(this.store,s))}storeAccount(e,t){y(this.store,s,t)}getCrossSigningKeys(e,t){t(v(this.store,o))}getSecretStorePrivateKey(e,t,n){t(v(this.store,`crypto.ssss_cache.${n}`))}storeCrossSigningKeys(e,t){y(this.store,o,t)}storeSecretStorePrivateKey(e,t,n){y(this.store,`crypto.ssss_cache.${t}`,n)}doTxn(e,t,n){return Promise.resolve(n(null))}}function v(e,t){try{return JSON.parse(e.getItem(t))}catch(e){i.logger.log("Error: Failed to get key %s: %s",t,e.stack||e),i.logger.log(e.stack)}return null}function y(e,t,n){e.setItem(t,JSON.stringify(n))}t.LocalStorageCryptoStore=f},1045:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var r=i(n(8416)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.MemoryCryptoStore=class{constructor(){(0,r.default)(this,"outgoingRoomKeyRequests",[]),(0,r.default)(this,"account",null),(0,r.default)(this,"crossSigningKeys",null),(0,r.default)(this,"privateKeys",{}),(0,r.default)(this,"sessions",{}),(0,r.default)(this,"sessionProblems",{}),(0,r.default)(this,"notifiedErrorDevices",{}),(0,r.default)(this,"inboundGroupSessions",{}),(0,r.default)(this,"inboundGroupSessionsWithheld",{}),(0,r.default)(this,"deviceData",null),(0,r.default)(this,"rooms",{}),(0,r.default)(this,"sessionsNeedingBackup",{}),(0,r.default)(this,"sharedHistoryInboundGroupSessions",{}),(0,r.default)(this,"parkedSharedHistory",new Map)}async startup(){return this}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return o.promiseTry((()=>{const n=this._getOutgoingRoomKeyRequest(t);return n?(s.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),n):(s.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this.outgoingRoomKeyRequests.push(e),e)}))}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this.outgoingRoomKeyRequests)if(o.deepCompare(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this.outgoingRoomKeyRequests)for(const n of e)if(t.state===n)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this.outgoingRoomKeyRequests.filter((t=>t.state==e)))}getOutgoingRoomKeyRequestsByTarget(e,t,n){const i=[];for(const r of this.outgoingRoomKeyRequests)for(const s of n)r.state===s&&r.recipients.some((n=>n.userId===e&&n.deviceId===t))&&i.push(r);return Promise.resolve(i)}updateOutgoingRoomKeyRequest(e,t,n){for(const i of this.outgoingRoomKeyRequests)if(i.requestId===e)return i.state!==t?(s.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${i.state}`),Promise.resolve(null)):(Object.assign(i,n),Promise.resolve(i));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let n=0;n<this.outgoingRoomKeyRequests.length;n++){const i=this.outgoingRoomKeyRequests[n];if(i.requestId===e)return i.state!=t?(s.logger.warn(`Cannot delete room key request in state ${i.state} (expected ${t})`),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(n,1),Promise.resolve(i))}return Promise.resolve(null)}getAccount(e,t){t(this.account)}storeAccount(e,t){this.account=t}getCrossSigningKeys(e,t){t(this.crossSigningKeys)}getSecretStorePrivateKey(e,t,n){t(this.privateKeys[n]||null)}storeCrossSigningKeys(e,t){this.crossSigningKeys=t}storeSecretStorePrivateKey(e,t,n){this.privateKeys[t]=n}countEndToEndSessions(e,t){t(Object.keys(this.sessions).length)}getEndToEndSession(e,t,n,i){i((this.sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,n){n(this.sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this.sessions).forEach((([e,n])=>{Object.entries(n).forEach((([n,i])=>{t(c(c({},i),{},{deviceKey:e,sessionId:n}))}))}))}storeEndToEndSession(e,t,n,i){let r=this.sessions[e];void 0===r&&(r={},this.sessions[e]=r),r[t]=n}async storeEndToEndSessionProblem(e,t,n){const i=this.sessionProblems[e]=this.sessionProblems[e]||[];i.push({type:t,fixed:n,time:Date.now()}),i.sort(((e,t)=>e.time-t.time))}async getEndToEndSessionProblem(e,t){const n=this.sessionProblems[e]||[];if(!n.length)return null;const i=n[n.length-1];for(const e of n)if(e.time>t)return Object.assign({},e,{fixed:i.fixed});return i.fixed?null:i}async filterOutNotifiedErrorDevices(e){const t=this.notifiedErrorDevices,n=[];for(const i of e){const{userId:e,deviceInfo:r}=i;e in t?r.deviceId in t[e]||(n.push(i),t[e][r.deviceId]=!0):(n.push(i),t[e]={[r.deviceId]:!0})}return n}getEndToEndInboundGroupSession(e,t,n,i){const r=e+"/"+t;i(this.inboundGroupSessions[r]||null,this.inboundGroupSessionsWithheld[r]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const e of Object.keys(this.inboundGroupSessions))t({senderKey:e.slice(0,43),sessionId:e.slice(44),sessionData:this.inboundGroupSessions[e]});t(null)}addEndToEndInboundGroupSession(e,t,n,i){const r=e+"/"+t;void 0===this.inboundGroupSessions[r]&&(this.inboundGroupSessions[r]=n)}storeEndToEndInboundGroupSession(e,t,n,i){this.inboundGroupSessions[e+"/"+t]=n}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){const r=e+"/"+t;this.inboundGroupSessionsWithheld[r]=n}getEndToEndDeviceData(e,t){t(this.deviceData)}storeEndToEndDeviceData(e,t){this.deviceData=e}storeEndToEndRoom(e,t,n){this.rooms[e]=t}getEndToEndRooms(e,t){t(this.rooms)}getSessionsNeedingBackup(e){const t=[];for(const n in this.sessionsNeedingBackup)if(this.inboundGroupSessions[n]&&(t.push({senderKey:n.slice(0,43),sessionId:n.slice(44),sessionData:this.inboundGroupSessions[n]}),e&&n.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this.sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this.sessionsNeedingBackup[e]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,t,n){const i=this.sharedHistoryInboundGroupSessions[e]||[];i.push([t,n]),this.sharedHistoryInboundGroupSessions[e]=i}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this.sharedHistoryInboundGroupSessions[e]||[])}addParkedSharedHistory(e,t){var n;const i=null!==(n=this.parkedSharedHistory.get(e))&&void 0!==n?n:[];i.push(t),this.parkedSharedHistory.set(e,i)}takeParkedSharedHistory(e){var t;const n=null!==(t=this.parkedSharedHistory.get(e))&&void 0!==t?t:[];return this.parkedSharedHistory.delete(e),Promise.resolve(n)}doTxn(e,t,n){return Promise.resolve(n(null))}}},1631:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationEvent=t.VerificationBase=t.SwitchStartEventError=void 0;var r=i(n(8416)),s=n(4369),o=n(7434),a=n(3272),l=n(6702),c=n(3075),d=n(5861);const h=new Error("Verification timed out");class u extends Error{constructor(e){super(),this.startEvent=e}}let p;t.SwitchStartEventError=u,t.VerificationEvent=p,function(e){e.Cancel="cancel"}(p||(t.VerificationEvent=p={}));class m extends d.TypedEventEmitter{constructor(e,t,n,i,s,o){super(),this.channel=e,this.baseApis=t,this.userId=n,this.deviceId=i,this.startEvent=s,this.request=o,(0,r.default)(this,"cancelled",!1),(0,r.default)(this,"_done",!1),(0,r.default)(this,"promise",null),(0,r.default)(this,"transactionTimeoutTimer",null),(0,r.default)(this,"expectedEvent",void 0),(0,r.default)(this,"resolve",void 0),(0,r.default)(this,"reject",void 0),(0,r.default)(this,"resolveEvent",void 0),(0,r.default)(this,"rejectEvent",void 0),(0,r.default)(this,"started",void 0),(0,r.default)(this,"doVerification",void 0)}get initiatedByMe(){if(!this.startEvent)return!0;const e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this.baseApis.getUserId()&&t.from_device===this.baseApis.getDeviceId()}get hasBeenCancelled(){return this.cancelled}resetTimer(){o.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this.transactionTimeoutTimer&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout((()=>{this._done||this.cancelled||(o.logger.info("Triggering verification timeout"),this.cancel(h))}),6e5)}endTimer(){null!==this.transactionTimeoutTimer&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}send(e,t){return this.channel.send(e,t)}waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));const t=this.request.getEventFromOtherParty(e);return t?Promise.resolve(t):(this.expectedEvent=e,new Promise(((e,t)=>{this.resolveEvent=e,this.rejectEvent=t})))}canSwitchStartEvent(e){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(o.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){const t=this.rejectEvent;this.rejectEvent=void 0,t(new u(e))}else this.startEvent=e}handleEvent(e){if(!this._done)if(e.getType()===this.expectedEvent)"m.key.verification.done"!==this.expectedEvent&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),this.resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){const t=this.reject;if(this.reject=void 0,t){const n=e.getContent(),{reason:i,code:r}=n;t(new Error(`Other side cancelled verification because ${i} (${r})`))}}else if(this.expectedEvent){const t=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+e.getType());if(this.expectedEvent=void 0,this.rejectEvent){const e=this.rejectEvent;this.rejectEvent=void 0,e(t)}this.cancel(t)}}done(){if(this.endTimer(),!this._done)return this.request.onVerifierFinished(),this.resolve(),(0,c.requestKeysDuringVerification)(this.baseApis,this.userId,this.deviceId)}cancel(e){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===h){const e=(0,l.newTimeoutError)();this.send(e.getType(),e.getContent())}else if(e instanceof s.MatrixEvent){if(e.getSender()!==this.userId){const t=e.getContent();"m.key.verification.cancel"===e.getType()?(t.code=t.code||"m.unknown",t.reason=t.reason||t.body||"Unknown reason",this.send("m.key.verification.cancel",t)):this.send("m.key.verification.cancel",{code:"m.unknown",reason:t.body||"Unknown reason"})}}else this.send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this.promise?this.reject&&this.reject(e):this.promise=Promise.reject(e),this.emit(p.Cancel,e)}}verify(){return this.promise||(this.promise=new Promise(((e,t)=>{this.resolve=(...t)=>{this._done=!0,this.endTimer(),e(...t)},this.reject=e=>{this._done=!0,this.endTimer(),t(e)}})),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),new Promise(((e,t)=>{var n;(null===(n=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(this.userId))||void 0===n?void 0:n.getId())===this.deviceId&&t(new Error("Device ID is the same as the cross-signing ID")),e()})).then((()=>this.doVerification())).then(this.done.bind(this),this.cancel.bind(this)))),this.promise}async verifyKeys(e,t,n){const i=[];for(const[r,s]of Object.entries(t)){const t=r.split(":",2)[1],l=this.baseApis.getStoredDevice(e,t);if(l)n(r,l,s),i.push([t,r,l.keys[r]]);else{const l=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(e);l&&l.getId()===t?(n(r,a.DeviceInfo.fromStorage({keys:{[r]:t}},t),s),i.push([t,r,t])):o.logger.warn(`verification: Could not find device ${t} to verify`)}}if(!i.length)throw new Error("No devices could be verified");o.logger.info("Verification completed! Marking devices verified: ",i);for(const[t,n,r]of i)await this.baseApis.crypto.setDeviceVerification(e,t,!0,null,null,{[n]:r});e==this.baseApis.credentials.userId&&await this.baseApis.checkKeyBackup()}get events(){}}t.VerificationBase=m},6702:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorFactory=s,t.errorFromEvent=function(e){const t=e.getContent();if(t){const{code:e,reason:n}=t;return{code:e,reason:n}}return{code:"Unknown error",reason:"m.unknown"}},t.newUserCancelledError=t.newUnknownMethodError=t.newUnexpectedMessageError=t.newTimeoutError=t.newKeyMismatchError=t.newInvalidMessageError=void 0,t.newVerificationError=r;var i=n(4369);function r(e,t,n){const r=Object.assign({},{code:e,reason:t},n);return new i.MatrixEvent({type:"m.key.verification.cancel",content:r})}function s(e,t){return function(n){return r(e,t,n)}}const o=s("m.user","Cancelled by user");t.newUserCancelledError=o;const a=s("m.timeout","Timed out");t.newTimeoutError=a;const l=s("m.unknown_method","Unknown method");t.newUnknownMethodError=l;const c=s("m.unexpected_message","Unexpected message");t.newUnexpectedMessageError=c;const d=s("m.key_mismatch","Key mismatch");t.newKeyMismatchError=d;const h=s("m.invalid_message","Invalid message");t.newInvalidMessageError=h},4028:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.IllegalMethod=void 0;var r=i(n(8416)),s=n(1631);class o extends s.VerificationBase{constructor(...e){super(...e),(0,r.default)(this,"doVerification",(async()=>{throw new Error("Verification is not possible with this method")}))}static factory(e,t,n,i,r,s){return new o(e,t,n,i,r,s)}static get NAME(){return"org.matrix.illegal_method"}}t.IllegalMethod=o},1696:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SHOW_QR_CODE_METHOD=t.SCAN_QR_CODE_METHOD=t.ReciprocateQRCode=t.QrCodeEvent=t.QRCodeData=void 0;var r=i(n(8416)),s=n(1631),o=n(6702),a=n(2772),l=n(7434);let c;t.SHOW_QR_CODE_METHOD="m.qr_code.show.v1",t.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1",t.QrCodeEvent=c,function(e){e.ShowReciprocateQr="show_reciprocate_qr"}(c||(t.QrCodeEvent=c={}));class d extends s.VerificationBase{constructor(...e){super(...e),(0,r.default)(this,"reciprocateQREvent",void 0),(0,r.default)(this,"doVerification",(async()=>{if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:e}=this.request;if(this.startEvent.getContent().secret!==e.encodedSharedSecret)throw(0,o.newKeyMismatchError)();await new Promise(((e,t)=>{this.reciprocateQREvent={confirm:e,cancel:()=>t((0,o.newUserCancelledError)())},this.emit(c.ShowReciprocateQr,this.reciprocateQREvent)}));const t={};switch(e.mode){case h.VerifyOtherUser:{const n=e.otherUserMasterKey;t[`ed25519:${n}`]=n;break}case h.VerifySelfTrusted:{const n=this.request.targetDevice.deviceId;t[`ed25519:${n}`]=e.otherDeviceKey;break}case h.VerifySelfUntrusted:{const n=e.myMasterKey;t[`ed25519:${n}`]=n;break}}await this.verifyKeys(this.userId,t,((e,n,i)=>{const r=t[e];if(!r)throw(0,o.newKeyMismatchError)();if(i!==r)throw l.logger.error("key ID from key info does not match"),(0,o.newKeyMismatchError)();for(const e in n.keys){if(!e.startsWith("ed25519"))continue;const i=t[e];if(!i)throw(0,o.newKeyMismatchError)();if(n.keys[e]!==i)throw l.logger.error("master key does not match"),(0,o.newKeyMismatchError)()}}))}))}static factory(e,t,n,i,r,s){return new d(e,t,n,i,r,s)}static get NAME(){return"m.reciprocate.v1"}}var h;t.ReciprocateQRCode=d,function(e){e[e.VerifyOtherUser=0]="VerifyOtherUser",e[e.VerifySelfTrusted=1]="VerifySelfTrusted",e[e.VerifySelfUntrusted=2]="VerifySelfUntrusted"}(h||(h={}));class u{constructor(e,t,n,i,r,s){this.mode=e,this.sharedSecret=t,this.otherUserMasterKey=n,this.otherDeviceKey=i,this.myMasterKey=r,this.buffer=s}static async create(e,t){const n=u.generateSharedSecret(),i=u.determineMode(e,t);let r=null,s=null,o=null;if(i===h.VerifyOtherUser)r=t.getStoredCrossSigningForUser(e.otherUserId).getId("master");else if(i===h.VerifySelfTrusted)s=await u.getOtherDeviceKey(e,t);else if(i===h.VerifySelfUntrusted){const e=t.getUserId();o=t.getStoredCrossSigningForUser(e).getId("master")}const a=u.generateQrData(e,t,i,n,r,s,o),l=u.generateBuffer(a);return new u(i,n,r,s,o,l)}get encodedSharedSecret(){return this.sharedSecret}getBuffer(){return this.buffer}static generateSharedSecret(){const e=new Uint8Array(11);return n.g.crypto.getRandomValues(e),(0,a.encodeUnpaddedBase64)(e)}static async getOtherDeviceKey(e,t){const n=t.getUserId(),i=e.targetDevice,r=i?i.deviceId:null,s=t.getStoredDevice(n,r);if(!s)throw new Error("could not find device "+r);return s.getFingerprint()}static determineMode(e,t){const n=t.getUserId(),i=e.otherUserId;let r=h.VerifyOtherUser;return n===i&&(r=t.checkUserTrust(n).isCrossSigningVerified()?h.VerifySelfTrusted:h.VerifySelfUntrusted),r}static generateQrData(e,t,n,i,r,s,o){const a=t.getUserId(),l={prefix:"MATRIX",version:2,mode:n,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:i},c=t.getStoredCrossSigningForUser(a);return n===h.VerifyOtherUser?(l.firstKeyB64=c.getId("master"),l.secondKeyB64=r):n===h.VerifySelfTrusted?(l.firstKeyB64=c.getId("master"),l.secondKeyB64=s):n===h.VerifySelfUntrusted&&(l.firstKeyB64=t.getDeviceEd25519Key(),l.secondKeyB64=o),l}static generateBuffer(e){let t=Buffer.alloc(0);const n=e=>{const n=Buffer.from([e]);t=Buffer.concat([t,n])},i=(e,n,i=!0)=>{const r=Buffer.from(e,n);i&&(e=>{const n=Buffer.alloc(2);n.writeInt16BE(e,0),t=Buffer.concat([t,n])})(r.byteLength),t=Buffer.concat([t,r])},r=e=>{const n=(0,a.decodeBase64)(e),i=Buffer.from(n);t=Buffer.concat([t,i])};return i(e.prefix,"ascii",!1),n(e.version),n(e.mode),i(e.transactionId,"utf-8"),r(e.firstKeyB64),r(e.secondKeyB64),r(e.secretB64),t}}t.QRCodeData=u},6381:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SasEvent=t.SAS=void 0;var r=i(n(8416)),s=i(n(9141)),o=n(1631),a=n(6702),l=n(7434);const c="m.key.verification.start",d=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"];let h;const u=(0,a.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),p=(0,a.errorFactory)("m.mismatched_commitment","Mismatched commitment"),m=[["","dog"],["","cat"],["","lion"],["","horse"],["","unicorn"],["","pig"],["","elephant"],["","rabbit"],["","panda"],["","rooster"],["","penguin"],["","turtle"],["","fish"],["","octopus"],["","butterfly"],["","flower"],["","tree"],["","cactus"],["","mushroom"],["","globe"],["","moon"],["","cloud"],["","fire"],["","banana"],["","apple"],["","strawberry"],["","corn"],["","pizza"],["","cake"],["","heart"],["","smiley"],["","robot"],["","hat"],["","glasses"],["","spanner"],["","santa"],["","thumbs up"],["","umbrella"],["","hourglass"],["","clock"],["","gift"],["","light bulb"],["","book"],["","pencil"],["","paperclip"],["","scissors"],["","lock"],["","key"],["","hammer"],["","telephone"],["","flag"],["","train"],["","bicycle"],["","aeroplane"],["","rocket"],["","trophy"],["","ball"],["","guitar"],["","trumpet"],["","bell"],["","anchor"],["","headphones"],["","folder"],["","pin"]],g={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((e=>m[e]))}};function f(e,t){const n={};for(const i of t)i in g&&(n[i]=g[i](e));return n}const v={"hkdf-hmac-sha256":"calculate_mac","org.matrix.msc3783.hkdf-hmac-sha256":"calculate_mac_fixed_base64","hmac-sha256":"calculate_mac_long_kdf"};function y(e,t){return function(...n){const i=e[v[t]].apply(e,n);return l.logger.log("SAS calculateMAC:",t,n,i),i}}const b={"curve25519-hkdf-sha256":function(e,t,n){const i=`${e.baseApis.getUserId()}|${e.baseApis.deviceId}|${e.ourSASPubKey}|`,r=`${e.userId}|${e.deviceId}|${e.theirSASPubKey}|`,s="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?i+r:r+i)+e.channel.transactionId;return t.generate_bytes(s,n)},curve25519:function(e,t,n){const i=`${e.baseApis.getUserId()}${e.baseApis.deviceId}`,r=`${e.userId}${e.deviceId}`,s="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?i+r:r+i)+e.channel.transactionId;return t.generate_bytes(s,n)}},w=["curve25519-hkdf-sha256","curve25519"],S=["sha256"],_=["org.matrix.msc3783.hkdf-hmac-sha256","hkdf-hmac-sha256","hmac-sha256"],E=Object.keys(g),k=new Set(w),x=new Set(S),T=new Set(_),C=new Set(E);function A(e,t){return e instanceof Array?e.filter((e=>t.has(e))):[]}let I;t.SasEvent=I,function(e){e.ShowSas="show_sas"}(I||(t.SasEvent=I={}));class R extends o.VerificationBase{constructor(...e){super(...e),(0,r.default)(this,"waitingForAccept",void 0),(0,r.default)(this,"ourSASPubKey",void 0),(0,r.default)(this,"theirSASPubKey",void 0),(0,r.default)(this,"sasEvent",void 0),(0,r.default)(this,"doVerification",(async()=>{await n.g.Olm.init(),h=h||new n.g.Olm.Utility,await this.baseApis.downloadKeys([this.userId]);let e=!1;do{try{return this.initiatedByMe?await this.doSendVerification():await this.doRespondVerification()}catch(t){if(!(t instanceof o.SwitchStartEventError))throw t;this.startEvent=t.startEvent,e=!0}}while(e)}))}static get NAME(){return"m.sas.v1"}get events(){return d}canSwitchStartEvent(e){if(e.getType()!==c)return!1;const t=e.getContent();return t&&t.method===R.NAME&&this.waitingForAccept}async sendStart(){const e=this.channel.completeContent(c,{method:R.NAME,from_device:this.baseApis.deviceId,key_agreement_protocols:w,hashes:S,message_authentication_codes:_,short_authentication_string:E});return await this.channel.sendCompleted(c,e),e}async doSendVerification(){let e,t;if(this.waitingForAccept=!0,e=this.startEvent?this.channel.completedContentFromEvent(this.startEvent):await this.sendStart(),!this.initiatedByMe)throw new o.SwitchStartEventError(this.startEvent);try{t=await this.waitForEvent("m.key.verification.accept")}finally{this.waitingForAccept=!1}let i=t.getContent();const r=A(i.short_authentication_string,C);if(!(k.has(i.key_agreement_protocol)&&x.has(i.hash)&&T.has(i.message_authentication_code)&&r.length))throw(0,a.newUnknownMethodError)();if("string"!=typeof i.commitment)throw(0,a.newInvalidMessageError)();const l=i.key_agreement_protocol,c=i.message_authentication_code,d=i.commitment,m=new n.g.Olm.SAS;try{this.ourSASPubKey=m.get_pubkey(),await this.send("m.key.verification.key",{key:this.ourSASPubKey}),t=await this.waitForEvent("m.key.verification.key"),i=t.getContent();const n=i.key+s.default.stringify(e);if(h.sha256(n)!==d)throw p();this.theirSASPubKey=i.key,m.set_their_key(i.key);const o=b[l](this,m,6),g=new Promise(((e,t)=>{this.sasEvent={sas:f(o,r),confirm:async()=>{try{await this.sendMAC(m,c),e()}catch(e){t(e)}},cancel:()=>t((0,a.newUserCancelledError)()),mismatch:()=>t(u())},this.emit(I.ShowSas,this.sasEvent)}));[t]=await Promise.all([this.waitForEvent("m.key.verification.mac").then((e=>(this.expectedEvent="m.key.verification.done",e))),g]),i=t.getContent(),await this.checkMAC(m,i,c)}finally{m.free()}}async doRespondVerification(){let e=this.channel.completedContentFromEvent(this.startEvent);const t=A(w,new Set(e.key_agreement_protocols))[0],i=A(S,new Set(e.hashes))[0],r=A(_,new Set(e.message_authentication_codes))[0],o=A(e.short_authentication_string,C);if(void 0===t||void 0===i||void 0===r||!o.length)throw(0,a.newUnknownMethodError)();const l=new n.g.Olm.SAS;try{const n=l.get_pubkey()+s.default.stringify(e);await this.send("m.key.verification.accept",{key_agreement_protocol:t,hash:i,message_authentication_code:r,short_authentication_string:o,commitment:h.sha256(n)});let c=await this.waitForEvent("m.key.verification.key");e=c.getContent(),this.theirSASPubKey=e.key,l.set_their_key(e.key),this.ourSASPubKey=l.get_pubkey(),await this.send("m.key.verification.key",{key:this.ourSASPubKey});const d=b[t](this,l,6),p=new Promise(((e,t)=>{this.sasEvent={sas:f(d,o),confirm:async()=>{try{await this.sendMAC(l,r),e()}catch(e){t(e)}},cancel:()=>t((0,a.newUserCancelledError)()),mismatch:()=>t(u())},this.emit(I.ShowSas,this.sasEvent)}));[c]=await Promise.all([this.waitForEvent("m.key.verification.mac").then((e=>(this.expectedEvent="m.key.verification.done",e))),p]),e=c.getContent(),await this.checkMAC(l,e,r)}finally{l.free()}}sendMAC(e,t){const n={},i=[],r="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,s=`ed25519:${this.baseApis.deviceId}`;n[s]=y(e,t)(this.baseApis.getDeviceEd25519Key(),r+s),i.push(s);const o=this.baseApis.getCrossSigningId();if(o){const s=`ed25519:${o}`;n[s]=y(e,t)(o,r+s),i.push(s)}const a=y(e,t)(i.sort().join(","),r+"KEY_IDS");return this.send("m.key.verification.mac",{mac:n,keys:a})}async checkMAC(e,t,n){const i="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this.baseApis.getUserId()+this.baseApis.deviceId+this.channel.transactionId;if(t.keys!==y(e,n)(Object.keys(t.mac).sort().join(","),i+"KEY_IDS"))throw(0,a.newKeyMismatchError)();await this.verifyKeys(this.userId,t.mac,((t,r,s)=>{if(s!==y(e,n)(r.keys[t],i+t))throw(0,a.newKeyMismatchError)()}))}}t.SAS=R},2842:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.InRoomRequests=t.InRoomChannel=void 0;var r=i(n(8416)),s=n(5279),o=n(7434);const a=n(2481).EventType.RoomMessage,l="m.reference",c="m.relates_to";class d{constructor(e,t,n=null){this.client=e,this.roomId=t,this.userId=n,(0,r.default)(this,"requestEventId",null)}get receiveStartFromOtherDevices(){return!0}get transactionId(){return this.requestEventId}static getOtherPartyUserId(e,t){if(d.getEventType(e)!==s.REQUEST_TYPE)return;const n=t.getUserId(),i=e.getSender(),r=e.getContent().to;return i===n?r:r===n?i:void 0}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===s.REQUEST_TYPE}canCreateRequest(e){return d.canCreateRequest(e)}static getTransactionId(e){if(d.getEventType(e)===s.REQUEST_TYPE)return e.getId();{const t=e.getRelation();if(t&&t.rel_type===l)return t.event_id}}static validateEvent(e,t){const n=d.getTransactionId(e);if("string"!=typeof n||0===n.length)return!1;const i=d.getEventType(e),r=e.getContent();if(i===s.REQUEST_TYPE){if(!r||"string"!=typeof r.to||!r.to.length)return o.logger.log("InRoomChannel: validateEvent: no valid to "+(r&&r.to)),!1;if(!d.getOtherPartyUserId(e,t))return o.logger.log(`InRoomChannel: validateEvent: not directed to or sent by me: ${e.getSender()}, ${r&&r.to}`),!1}return s.VerificationRequest.validateEvent(i,e,t)}static getEventType(e){const t=e.getType();if(t===a){const t=e.getContent();if(t){const{msgtype:e}=t;if(e===s.REQUEST_TYPE)return s.REQUEST_TYPE}}return t&&t!==s.REQUEST_TYPE?t:""}handleEvent(e,t,n=!1){if(t.hasEventId(e.getId()))return;const i=d.getEventType(e);if(e.getRoomId()!==this.roomId)return;if(null===this.userId){const t=d.getOtherPartyUserId(e,this.client);t&&(this.userId=t)}const r=this.client.getUserId(),s=e.getSender();if(null!==this.userId&&s!==r&&s!==this.userId)return void o.logger.log(`InRoomChannel: ignoring verification event from non-participating sender ${s}`);null===this.requestEventId&&(this.requestEventId=d.getTransactionId(e));const a=!!e.getUnsigned().transaction_id,l=e.getSender()===this.client.getUserId();return t.handleEvent(i,e,n,a,l)}completedContentFromEvent(e){const t=Object.assign({},e.getContent());return t[c]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==s.REQUEST_TYPE&&e!==s.READY_TYPE&&e!==s.START_TYPE||(t.from_device=this.client.getDeviceId()),e===s.REQUEST_TYPE?t={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:s.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t[c]={rel_type:l,event_id:this.transactionId},t}send(e,t){const n=this.completeContent(e,t);return this.sendCompleted(e,n)}async sendCompleted(e,t){let n=e;e===s.REQUEST_TYPE&&(n=a);const i=await this.client.sendEvent(this.roomId,n,t);e===s.REQUEST_TYPE&&(this.requestEventId=i.event_id)}}t.InRoomChannel=d,t.InRoomRequests=class{constructor(){(0,r.default)(this,"requestsByRoomId",new Map)}getRequest(e){const t=e.getRoomId(),n=d.getTransactionId(e);return this.getRequestByTxnId(t,n)}getRequestByChannel(e){return this.getRequestByTxnId(e.roomId,e.transactionId)}getRequestByTxnId(e,t){const n=this.requestsByRoomId.get(e);if(n)return n.get(t)}setRequest(e,t){this.doSetRequest(e.getRoomId(),d.getTransactionId(e),t)}setRequestByChannel(e,t){this.doSetRequest(e.roomId,e.transactionId,t)}doSetRequest(e,t,n){let i=this.requestsByRoomId.get(e);i||(i=new Map,this.requestsByRoomId.set(e,i)),i.set(t,n)}removeRequest(e){const t=e.getRoomId(),n=this.requestsByRoomId.get(t);n&&(n.delete(d.getTransactionId(e)),0===n.size&&this.requestsByRoomId.delete(t))}findRequestInProgress(e){const t=this.requestsByRoomId.get(e);if(t)for(const e of t.values())if(e.pending)return e}}},9588:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceRequests=t.ToDeviceChannel=void 0;var r=i(n(8416)),s=n(8401),o=n(7434),a=n(5279),l=n(6702),c=n(4369);class d{constructor(e,t,n,i=null,s=null){this.client=e,this.userId=t,this.devices=n,this.transactionId=i,this.deviceId=s,(0,r.default)(this,"request",void 0)}isToDevices(e){if(e.length===this.devices.length){for(const t of e)if(!this.devices.includes(t))return!1;return!0}return!1}static getEventType(e){return e.getType()}static getTransactionId(e){const t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===a.REQUEST_TYPE||e===a.START_TYPE}canCreateRequest(e){return d.canCreateRequest(e)}static validateEvent(e,t){if(e.isCancelled())return o.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;const n=e.getContent();if(!n)return o.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!n.transaction_id)return o.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const i=e.getType();if(i===a.REQUEST_TYPE){if(!Number.isFinite(n.timestamp))return o.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&n.from_device==t.getDeviceId())return o.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return a.VerificationRequest.validateEvent(i,e,t)}getTimestamp(e){const t=e.getContent();return t&&t.timestamp}async handleEvent(e,t,n=!1){const i=e.getType(),r=e.getContent();if(i===a.REQUEST_TYPE||i===a.READY_TYPE||i===a.START_TYPE){this.transactionId||(this.transactionId=r.transaction_id);const e=r.from_device;if(!this.deviceId&&this.devices.includes(e)&&(this.deviceId=e),!this.deviceId||this.deviceId!==e){const t=this.completeContent(a.CANCEL_TYPE,(0,l.errorFromEvent)((0,l.newUnexpectedMessageError)()));return this.sendToDevices(a.CANCEL_TYPE,t,[e])}}const s=t.phase===a.PHASE_STARTED||t.phase===a.PHASE_READY;await t.handleEvent(e.getType(),e,n,!1,!1);const o=t.phase===a.PHASE_STARTED||t.phase===a.PHASE_READY;if((i===a.START_TYPE||i===a.READY_TYPE)&&!s&&o&&this.deviceId){const e=this.devices.filter((e=>e!==this.deviceId&&e!==this.client.getDeviceId()));if(e.length){const t=this.completeContent(a.CANCEL_TYPE,{code:"m.accepted",reason:"Verification request accepted by another device"});await this.sendToDevices(a.CANCEL_TYPE,t,e)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==a.REQUEST_TYPE&&e!==a.READY_TYPE&&e!==a.START_TYPE||(t.from_device=this.client.getDeviceId()),e===a.REQUEST_TYPE&&(t.timestamp=Date.now()),t}send(e,t={}){e!==a.REQUEST_TYPE&&e!==a.START_TYPE||this.transactionId||(this.transactionId=d.makeTransactionId());const n=this.completeContent(e,t);return this.sendCompleted(e,n)}async sendCompleted(e,t){let n;n=e===a.REQUEST_TYPE||e===a.CANCEL_TYPE&&!this.deviceId?await this.sendToDevices(e,t,this.devices):await this.sendToDevices(e,t,[this.deviceId]);const i=new c.MatrixEvent({sender:this.client.getUserId(),content:t,type:e});return await this.request.handleEvent(e,i,!0,!0,!0),n}async sendToDevices(e,t,n){if(n.length){const i={};for(const e of n)i[e]=t;await this.client.sendToDevice(e,{[this.userId]:i})}}static makeTransactionId(){return(0,s.randomString)(32)}}t.ToDeviceChannel=d,t.ToDeviceRequests=class{constructor(){(0,r.default)(this,"requestsByUserId",new Map)}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),d.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,t){const n=this.requestsByUserId.get(e);if(n)return n.get(t)}setRequest(e,t){this.setRequestBySenderAndTxnId(e.getSender(),d.getTransactionId(e),t)}setRequestByChannel(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}setRequestBySenderAndTxnId(e,t,n){let i=this.requestsByUserId.get(e);i||(i=new Map,this.requestsByUserId.set(e,i)),i.set(t,n)}removeRequest(e){const t=e.getSender(),n=this.requestsByUserId.get(t);n&&(n.delete(d.getTransactionId(e)),0===n.size&&this.requestsByUserId.delete(t))}findRequestInProgress(e,t){const n=this.requestsByUserId.get(e);if(n)for(const e of n.values())if(e.pending&&e.channel.isToDevices(t))return e}getRequestsInProgress(e){const t=this.requestsByUserId.get(e);return t?Array.from(t.values()).filter((e=>e.pending)):[]}}},5279:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationRequestEvent=t.VerificationRequest=t.START_TYPE=t.REQUEST_TYPE=t.READY_TYPE=t.Phase=t.PHASE_UNSENT=t.PHASE_STARTED=t.PHASE_REQUESTED=t.PHASE_READY=t.PHASE_DONE=t.PHASE_CANCELLED=t.EVENT_PREFIX=t.DONE_TYPE=t.CANCEL_TYPE=void 0;var r=i(n(8416)),s=n(7434),o=n(6702),a=n(1696),l=n(5861);const c="m.key.verification.";t.EVENT_PREFIX=c;const d=c+"request";t.REQUEST_TYPE=d;const h=c+"start";t.START_TYPE=h;const u=c+"cancel";t.CANCEL_TYPE=u;const p=c+"done";t.DONE_TYPE=p;const m=c+"ready";let g;t.READY_TYPE=m,t.Phase=g,function(e){e[e.Unsent=1]="Unsent",e[e.Requested=2]="Requested",e[e.Ready=3]="Ready",e[e.Started=4]="Started",e[e.Cancelled=5]="Cancelled",e[e.Done=6]="Done"}(g||(t.Phase=g={}));const f=g.Unsent;t.PHASE_UNSENT=f;const v=g.Requested;t.PHASE_REQUESTED=v;const y=g.Ready;t.PHASE_READY=y;const b=g.Started;t.PHASE_STARTED=b;const w=g.Cancelled;t.PHASE_CANCELLED=w;const S=g.Done;let _;t.PHASE_DONE=S,t.VerificationRequestEvent=_,function(e){e.Change="change"}(_||(t.VerificationRequestEvent=_={}));class E extends l.TypedEventEmitter{constructor(e,t,n){super(),this.channel=e,this.verificationMethods=t,this.client=n,(0,r.default)(this,"eventsByUs",new Map),(0,r.default)(this,"eventsByThem",new Map),(0,r.default)(this,"_observeOnly",!1),(0,r.default)(this,"timeoutTimer",null),(0,r.default)(this,"_accepting",!1),(0,r.default)(this,"_declining",!1),(0,r.default)(this,"verifierHasFinished",!1),(0,r.default)(this,"_cancelled",!1),(0,r.default)(this,"_chosenMethod",null),(0,r.default)(this,"_qrCodeData",null),(0,r.default)(this,"requestReceivedAt",null),(0,r.default)(this,"commonMethods",[]),(0,r.default)(this,"_phase",void 0),(0,r.default)(this,"_cancellingUserId",void 0),(0,r.default)(this,"_verifier",void 0),(0,r.default)(this,"cancelOnTimeout",(async()=>{try{this.initiatedByMe?await this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):await this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){s.logger.error("Error while cancelling verification request",e)}})),this.channel.request=this,this.setPhase(f,!1)}static validateEvent(e,t,n){const i=t.getContent();return!(!e||!e.startsWith(c))&&(i?e!==d&&e!==m||Array.isArray(i.methods)?e!==d&&e!==m&&e!==h||"string"==typeof i.from_device&&0!==i.from_device.length||(s.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(s.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(s.logger.log("VerificationRequest: validateEvent: no content"),!1))}get invalid(){return this.phase===f}get requested(){return this.phase===v}get cancelled(){return this.phase===w}get ready(){return this.phase===y}get started(){return this.phase===b}get done(){return this.phase===S}get methods(){return this.commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){let t=this.channel.getTimestamp(e)+6e5;if(this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=v){const e=this.requestReceivedAt+12e4;t=Math.min(t,e)}return Math.max(0,t-Date.now())}get timeout(){const e=this.getEventByEither(d);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this.getEventByEither(d)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return this.phase<y&&!this._accepting&&!this._declining}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&this._phase!==S&&this._phase!==w}get qrCodeData(){return this._qrCodeData}otherPartySupportsMethod(e,t=!1){if(!t&&!this.ready&&!this.started)return!1;const n=this.eventsByThem.get(d)||this.eventsByThem.get(m);if(!n){if(this.started&&this.initiatedByMe){const t=this.eventsByUs.get(h),n=t&&t.getContent();return e==(n&&n.method)}return!1}const i=n.getContent();if(!i)return!1;const{methods:r}=i;return!!Array.isArray(r)&&r.includes(e)}get initiatedByMe(){const e=this.eventsByUs.size+this.eventsByThem.size===0;if(this._phase===f&&e)return!0;const t=this.eventsByUs.has(d),n=this.eventsByThem.has(d);if(t&&!n)return!0;if(!t&&n)return!1;const i=this.eventsByUs.has(h),r=this.eventsByThem.has(h);return!(!i||r)}get requestingUserId(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}get otherUserId(){return this.channel.userId}get isSelfVerification(){return this.client.getUserId()===this.otherUserId}get cancellingUserId(){const e=this.eventsByUs.get(u),t=this.eventsByThem.get(u);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}get cancellationCode(){const e=this.getEventByEither(u);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const e=(this.eventsByThem.get(d)||this.eventsByThem.get(m)||this.eventsByThem.get(h)).getContent().from_device;return{userId:this.otherUserId,deviceId:e}}beginKeyVerification(e,t=null){if(!this.observeOnly&&!this._verifier&&(this.phase===v||this.phase===y||this.phase===f&&this.channel.canCreateRequest(h))){if(this.commonMethods.length&&!this.commonMethods.includes(e))throw(0,o.newUnknownMethodError)();if(this._verifier=this.createVerifier(e,null,t),!this._verifier)throw(0,o.newUnknownMethodError)();this._chosenMethod=e}return this._verifier}async sendRequest(){if(!this.observeOnly&&this._phase===f){const e=[...this.verificationMethods.keys()];await this.channel.send(d,{methods:e})}}async cancel({reason:e="User declined",code:t="m.user"}={}){if(!this.observeOnly&&this._phase!==w){if(this._declining=!0,this.emit(_.Change),this._verifier)return this._verifier.cancel((0,o.errorFactory)(t,e)());this._cancellingUserId=this.client.getUserId(),await this.channel.send(u,{code:t,reason:e})}}async accept(){if(!this.observeOnly&&this.phase===v&&!this.initiatedByMe){const e=[...this.verificationMethods.keys()];this._accepting=!0,this.emit(_.Change),await this.channel.send(m,{methods:e})}}waitFor(e){return new Promise(((t,n)=>{const i=()=>{let r=!1;return e(this)?(t(this),r=!0):this.cancelled&&(n(new Error("cancelled")),r=!0),r&&this.off(_.Change,i),r};i()||this.on(_.Change,i)}))}setPhase(e,t=!0){this._phase=e,t&&this.emit(_.Change)}getEventByEither(e){return this.eventsByThem.get(e)||this.eventsByUs.get(e)}getEventBy(e,t=!1){return t?this.eventsByThem.get(e):this.eventsByUs.get(e)}calculatePhaseTransitions(){const e=[{phase:f}],t=()=>e[e.length-1].phase,n=this.eventsByThem.has(d),i=this.getEventBy(d,n);i&&e.push({phase:v,event:i});const r=i&&this.getEventBy(m,!n);let s;if(r&&t()===v&&e.push({phase:y,event:r}),r||!i){const e=this.eventsByThem.get(h),t=this.eventsByUs.get(h);s=e&&t?e.getSender()<t.getSender()?e:t:e||t}else s=this.getEventBy(h,!n);if(s){const n=t()===v&&i.getSender()!==s.getSender(),r=t()===f&&this.channel.canCreateRequest(h);(n||t()===y||r)&&e.push({phase:b,event:s})}const o=this.eventsByUs.get(p);(this.verifierHasFinished||o&&t()===b)&&e.push({phase:S});const a=this.getEventByEither(u);return(this._cancelled||a)&&t()!==S?(e.push({phase:w,event:a}),e):e}transitionToPhase(e){const{phase:t,event:n}=e;if((t===v||t===y)&&!this.wasSentByOwnDevice(n)){const e=n.getContent();this.commonMethods=e.methods.filter((e=>this.verificationMethods.has(e)))}if(this.observeOnly||t!==v&&t!==b&&t!==y||this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(n)&&!this.wasSentByOwnDevice(n)&&(this._observeOnly=!0),t===b){const{method:e}=n.getContent();this._verifier||this.observeOnly||(this._verifier=this.createVerifier(e,n),this._verifier?this._chosenMethod=e:this.cancel({code:"m.unknown_method",reason:`Unknown method: ${e}`}))}}applyPhaseTransitions(){const e=this.calculatePhaseTransitions(),t=e.findIndex((e=>e.phase===this.phase)),n=e.slice(t+1);for(const e of n)this.transitionToPhase(e);return n}isWinningStartRace(e){if(e.getType()!==h)return!1;const t=this._verifier.startEvent;let n,i;if(this.isSelfVerification)if(t){const e=t.getContent();n=e&&e.from_device}else n=this.client.getDeviceId();else n=t?t.getSender():this.client.getUserId();if(this.isSelfVerification){const t=e.getContent();i=t&&t.from_device}else i=e.getSender();return i<n}hasEventId(e){for(const t of this.eventsByUs.values())if(t.getId()===e)return!0;for(const t of this.eventsByThem.values())if(t.getId()===e)return!0;return!1}async handleEvent(e,t,n,i,r){if(this.done||this.cancelled)return;const o=this._observeOnly;if(this.adjustObserveOnly(t,n),!this.observeOnly&&!i&&await this.cancelOnError(e,t))return;if(r?this.eventsByUs.has(e):this.eventsByThem.has(e))return;const l=this.phase;this.addEvent(e,t,r);const c=this.applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const n=this.isWinningStartRace(t);if(this._verifier.canSwitchStartEvent(t)&&n)this._verifier.switchStartEvent(t);else if(!i){var d;(e===u||null!==(d=this._verifier.events)&&void 0!==d&&d.includes(e))&&this._verifier.handleEvent(t)}}if(c.length){n&&c.some((e=>e.phase===y))&&this.otherPartySupportsMethod(a.SCAN_QR_CODE_METHOD,!0)&&(this._qrCodeData=await a.QRCodeData.create(this,this.client));const e=c[c.length-1],{phase:t}=e;this.setupTimeout(t),this.setPhase(t)}else this._observeOnly!==o&&this.emit(_.Change)}finally{s.logger.log(`Verification request ${this.channel.transactionId}: ${e} event with id:${t.getId()}, content:${JSON.stringify(t.getContent())} deviceId:${this.channel.deviceId}, sender:${t.getSender()}, isSentByUs:${r}, isLiveEvent:${n}, isRemoteEcho:${i}, phase:${l}=>${this.phase}, observeOnly:${o}=>${this._observeOnly}`)}}setupTimeout(e){!this.timeoutTimer&&!this.observeOnly&&e===v&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer&&(e===b||e===y||e===S||e===w)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)}async cancelOnError(e,t){if(e===h){const e=t.getContent().method;if(!this.verificationMethods.has(e))return await this.cancel((0,o.errorFromEvent)((0,o.newUnknownMethodError)())),!0}const n=e===d&&this.phase!==f,i=e===m&&this.phase!==v&&this.phase!==b;if(this.phase!==f&&(n||i)){s.logger.warn(`Cancelling, unexpected ${e} verification event from ${t.getSender()}`);const n=`Unexpected ${e} event in phase ${this.phase}`;return await this.cancel((0,o.errorFromEvent)((0,o.newUnexpectedMessageError)({reason:n}))),!0}return!1}adjustObserveOnly(e,t=!1){t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}addEvent(e,t,n=!1){if(n?this.eventsByUs.set(e,t):this.eventsByThem.set(e,t),e===d){for(const[e,t]of this.eventsByThem.entries())t.getSender()!==this.otherUserId&&this.eventsByThem.delete(e);this.requestReceivedAt=Date.now()}}createVerifier(e,t=null,n=null){n||(n=this.targetDevice);const{userId:i,deviceId:r}=n,o=this.verificationMethods.get(e);if(o)return new o(this.channel,this.client,i,r,t,this);s.logger.warn("could not find verifier constructor for method",e)}wasSentByOwnUser(e){return e.getSender()===this.client.getUserId()}wasSentByOwnDevice(e){if(!this.wasSentByOwnUser(e))return!1;const t=e.getContent();return!(!t||t.from_device!==this.client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send("m.key.verification.done",{}),this.verifierHasFinished=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this.eventsByThem.get(e)}}t.VerificationRequest=E},9489:(e,t)=>{"use strict";function n(e,t){const n=`Store is invalid because ${e}, please stop the client, delete all data and start the client again`,i=Reflect.construct(Error,[n]);return Reflect.setPrototypeOf(i,Reflect.getPrototypeOf(this)),i.reason=e,i.value=t,i}function i(e){const t=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`,n=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.name="InvalidCryptoStoreError",n}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidCryptoStoreError=i,t.InvalidStoreError=n,t.KeySignatureUploadError=void 0,n.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",n.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(n,Error),i.TOO_NEW="TOO_NEW",i.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(i,Error);class r extends Error{constructor(e,t){super(e),this.value=t}}t.KeySignatureUploadError=r},1166:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.eventMapperFor=function(e,t){let n=Boolean(t.preventReEmit);const i=!1!==t.decrypt;return function(r){t.toDevice&&delete r.room_id;const o=e.getRoom(r.room_id);let l;o&&void 0===r.state_key&&(l=o.findEventById(r.event_id)),!l||l.status?l=new s.MatrixEvent(r):(l.setUnsigned(a(a({},l.getUnsigned()),r.unsigned)),n=!0);const c=null==o?void 0:o.findThreadForEvent(l);return c&&l.setThread(c),l.isEncrypted()&&(n||e.reEmitter.reEmit(l,[s.MatrixEventEvent.Decrypted]),i&&e.decryptEventIfNeeded(l)),n||(e.reEmitter.reEmit(l,[s.MatrixEventEvent.Replaced,s.MatrixEventEvent.VisibilityChange]),null==o||o.reEmitter.reEmit(l,[s.MatrixEventEvent.BeforeRedaction])),l}};var r=i(n(8416)),s=n(4369);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},3564:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=void 0;var i=n(6969);t.FilterComponent=class{constructor(e,t){this.filterJson=e,this.userId=t}check(e){var t,n;const r=(null===(t=e.getUnsigned())||void 0===t?void 0:t["m.relations"])||{},s=Object.keys(r),o=[];return this.userId&&null!=r&&null!==(n=r[i.THREAD_RELATION_TYPE.name])&&void 0!==n&&n.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url,s,o)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[i.FILTER_RELATED_BY_SENDERS.name]:this.filterJson[i.FILTER_RELATED_BY_SENDERS.name]||[],[i.FILTER_RELATED_BY_REL_TYPES.name]:this.filterJson[i.FILTER_RELATED_BY_REL_TYPES.name]||[]}}checkFields(e,t,n,r,s,o){const a={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){const n=t.slice(0,-1);return e.slice(0,n.length)===n}return e===t}(n,e)}};for(let e=0;e<Object.keys(a).length;e++){const t=Object.keys(a)[e],n=a[t],i="not_"+t,r=this.filterJson[i];if(null!=r&&r.some(n))return!1;const s=this.filterJson[t];if(s&&!s.some(n))return!1}const l=this.filterJson.contains_url;if(void 0!==l&&l!==r)return!1;const c=this.filterJson[i.FILTER_RELATED_BY_REL_TYPES.name];if(void 0!==c&&!this.arrayMatchesFilter(c,s))return!1;const d=this.filterJson[i.FILTER_RELATED_BY_SENDERS.name];return!(void 0!==d&&!this.arrayMatchesFilter(d,o))}arrayMatchesFilter(e,t){return t.length>0&&e.every((e=>t.includes(e)))}filter(e){return e.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}},7906:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var r=i(n(8416)),s=n(3564);function o(e,t,n){const i=t.split(".");let r=e;for(let e=0;e<i.length-1;e++)r[i[e]]||(r[i[e]]={}),r=r[i[e]];r[i[i.length-1]]=n}class a{static fromJson(e,t,n){const i=new a(e,t);return i.setDefinition(n),i}constructor(e,t){this.userId=e,this.filterId=t,(0,r.default)(this,"definition",{}),(0,r.default)(this,"roomFilter",void 0),(0,r.default)(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;const t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms)),this.roomFilter=new s.FilterComponent(n,this.userId),this.roomTimelineFilter=new s.FilterComponent((null==t?void 0:t.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomTimelineFilter.filter(this.roomFilter.filter(e))}setTimelineLimit(e){o(this.definition,"room.timeline.limit",e)}setLazyLoadMembers(e){o(this.definition,"room.state.lazy_load_members",!!e)}setIncludeLeaveRooms(e){o(this.definition,"room.include_leave",e)}}t.Filter=a,(0,r.default)(a,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0})},7715:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.PREFIX_V3=t.PREFIX_V1=t.PREFIX_UNSTABLE=t.PREFIX_R0=t.PREFIX_MEDIA_R0=t.PREFIX_IDENTITY_V2=t.PREFIX_IDENTITY_V1=t.Method=t.MatrixHttpApi=t.MatrixError=t.HttpApiEvent=t.ConnectionError=t.AbortError=void 0,t.retryNetworkOperation=async function(e,t){let n=0,i=null;for(;n<e;)try{if(n>0){const e=1e3*Math.pow(2,n);l.logger.log(`network operation failed ${n} times, retrying in ${e}ms...`),await(0,a.sleep)(e)}return t()}catch(e){if(!(e instanceof y))throw e;n+=1,i=e}throw i};var r=i(n(8416)),s=n(7811),o=d(n(2731)),a=d(n(3102)),l=n(7434);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let p,m;function g(e){return e.status||e.statusCode}function f(e,t,n=!1,i){return function(r,o,a){r&&("AbortError"===r.name||"aborted"===r||r instanceof v||(r=new y("request failed",r)));let l=a;if(!r)try{g(o)>=400?r=function(e,t){const n=g(e),i=function(e){let t;if(e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null),!t)return null;try{return(0,s.parse)(t)}catch(e){throw new Error(`Error parsing Content-Type '${t}': ${e}`)}}(e);let r;if(i)if("application/json"===i.type){const e="object"==typeof t?t:JSON.parse(t);r=new v(e)}else"text/plain"===i.type&&(r=new Error(`Server returned ${n} error: ${t}`));return r||(r=new Error(`Server returned ${n} error`)),r.httpStatus=n,r}(o,a):i&&(l=i(a))}catch(e){r=new Error(`Error parsing server response: ${e}`)}if(r)e.reject(r),null==t||t(r);else if(n)e.resolve(l),null==t||t(null,l);else{const n={code:g(o),headers:o.headers,data:l};e.resolve(n),null==t||t(null,n)}}}t.PREFIX_R0="/_matrix/client/r0",t.PREFIX_V1="/_matrix/client/v1",t.PREFIX_V3="/_matrix/client/v3",t.PREFIX_UNSTABLE="/_matrix/client/unstable",t.PREFIX_IDENTITY_V1="/_matrix/identity/api/v1",t.PREFIX_IDENTITY_V2="/_matrix/identity/v2",t.PREFIX_MEDIA_R0="/_matrix/media/r0",t.Method=p,function(e){e.Get="GET",e.Put="PUT",e.Post="POST",e.Delete="DELETE"}(p||(t.Method=p={})),t.HttpApiEvent=m,function(e){e.SessionLoggedOut="Session.logged_out",e.NoConsent="no_consent"}(m||(t.HttpApiEvent=m={})),t.MatrixHttpApi=class{constructor(e,t){this.eventEmitter=e,this.opts=t,(0,r.default)(this,"uploads",[]),a.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=!!t.useAuthorizationHeader}setIdBaseUrl(e){this.opts.idBaseUrl=e}getContentUri(){return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:{access_token:this.opts.accessToken}}}uploadContent(e,t){a.isFunction(t)?t={callback:t}:t||(t={});const i=!1!==t.includeFilename,r=t.type||e.type||"application/octet-stream",s=t.name||e.name;let c=e;const d=c.stream;d&&"function"!=typeof d&&(l.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),c=d);let h=t.rawResponse;void 0===h&&(n.g.XMLHttpRequest?h=!1:(l.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),h=!0));let u=t.onlyContentUri;h||void 0!==u||(n.g.XMLHttpRequest?(l.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),u=!0):u=!1);const m={loaded:0,total:0};let g,v;if(h||(v=function(e){let t=JSON.parse(e);if(u&&(t=t.content_uri,void 0===t))throw Error("Bad response");return t}),n.g.XMLHttpRequest){const e=a.defer(),l=new n.g.XMLHttpRequest,d=f(e,t.callback,this.opts.onlyData),h=function(){l.abort(),d(new Error("Timeout"))};let u=o.setTimeout(h,3e4);l.onreadystatechange=function(){let e;if(l.readyState===n.g.XMLHttpRequest.DONE){o.clearTimeout(u);try{if(0===l.status)throw new b;if(!l.responseText)throw new Error("No response body.");e=l.responseText,v&&(e=v(e))}catch(e){return e.httpStatus=l.status,void d(e)}d(void 0,l,e)}},l.upload.addEventListener("progress",(function(e){o.clearTimeout(u),m.loaded=e.loaded,m.total=e.total,u=o.setTimeout(h,3e4),t.progressHandler&&t.progressHandler({loaded:e.loaded,total:e.total})}));let p=this.opts.baseUrl+"/_matrix/media/r0/upload";const y=[];i&&s&&y.push("filename="+encodeURIComponent(s)),this.opts.useAuthorizationHeader||y.push("access_token="+encodeURIComponent(this.opts.accessToken)),y.length>0&&(p+="?"+y.join("&")),l.open("POST",p),this.opts.useAuthorizationHeader&&l.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),l.setRequestHeader("Content-Type",r),l.send(c),g=e.promise,g.abort=l.abort.bind(l)}else{const e={};i&&s&&(e.filename=s);const n={"Content-Type":r};0===c.length&&(n["Content-Length"]="0"),g=this.authedRequest(t.callback,p.Post,"/upload",e,c,{prefix:"/_matrix/media/r0",headers:n,json:!1,bodyParser:v})}return m.promise=g.finally((()=>{for(let e=0;e<this.uploads.length;++e)if(this.uploads[e]===m)return void this.uploads.splice(e,1)})),m.promise.abort=g.abort,this.uploads.push(m),m.promise}cancelUpload(e){return!!e.abort&&(e.abort(),!0)}getCurrentUploads(){return this.uploads}idServerRequest(e,t,n,i,r,s){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");const o=this.opts.idBaseUrl+r+n;if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);const l={uri:o,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};t===p.Get?l.qs=i:"object"==typeof i&&(l.json=i),s&&(l.headers.Authorization=`Bearer ${s}`);const c=a.defer();return this.opts.request(l,f(c,e,this.opts.onlyData)),c.promise}authedRequest(e,t,n,i,r,s){i||(i={});let o=s||{};this.opts.useAuthorizationHeader?(isFinite(s)&&(o={localTimeoutMs:s}),o.headers||(o.headers={}),o.headers.Authorization||(o.headers.Authorization="Bearer "+this.opts.accessToken),i.access_token&&delete i.access_token):i.access_token||(i.access_token=this.opts.accessToken);const a=this.request(e,t,n,i,r,o);return a.catch((e=>{var t;"M_UNKNOWN_TOKEN"!=e.errcode||null!==(t=o)&&void 0!==t&&t.inhibitLogoutEmit?"M_CONSENT_NOT_GIVEN"==e.errcode&&this.eventEmitter.emit(m.NoConsent,e.message,e.data.consent_uri):this.eventEmitter.emit(m.SessionLoggedOut,e)})),a}request(e,t,n,i,r,s){var o,a;const l=null!==(o=null==s?void 0:s.prefix)&&void 0!==o?o:this.opts.prefix,c=(null!==(a=null==s?void 0:s.baseUrl)&&void 0!==a?a:this.opts.baseUrl)+l+n;return this.requestOtherUrl(e,t,c,i,r,s)}requestOtherUrl(e,t,n,i,r,s){let o=s||{};return isFinite(s)&&(o={localTimeoutMs:s}),this.doRequest(e,t,n,i,r,o)}getUrl(e,t,n){let i="";return t&&(i="?"+a.encodeParams(t)),this.opts.baseUrl+n+e+i}doRequest(e,t,n,i,r,s){var l;if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);this.opts.extraParams&&(i=u(u({},i||{}),this.opts.extraParams));const c=Object.assign({},s.headers||{});s||(s={});const d=null===(l=s.json)||void 0===l||l;let h=s.bodyParser;d&&(r&&(r=JSON.stringify(r),c["content-type"]="application/json"),c.accept||(c.accept="application/json"),void 0===h&&(h=function(e){return JSON.parse(e)}));const p=a.defer();let m,g,y=!1;const b=s.localTimeoutMs||this.opts.localTimeoutMs,w=()=>{b&&(m&&o.clearTimeout(m),m=o.setTimeout((function(){var e,t;y=!0,null===(e=g)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e),p.reject(new v({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:b}))}),b))};w();const S=p.promise;try{g=this.opts.request({uri:n,method:t,withCredentials:!1,qs:i,qsStringifyOptions:s.qsStringifyOptions,useQuerystring:!0,body:r,json:!1,timeout:b,headers:c||{},_matrix_opts:this.opts},((t,n,i)=>{b&&(o.clearTimeout(m),y)||f(p,e,this.opts.onlyData,h)(t,n,i)})),g&&("onprogress"in g&&(g.onprogress=e=>{w()}),g.abort&&(S.abort=g.abort.bind(g)))}catch(t){p.reject(t),e&&e(t)}return S}};class v extends Error{constructor(e={}){super(`MatrixError: ${e.errcode}`),(0,r.default)(this,"errcode",void 0),(0,r.default)(this,"data",void 0),(0,r.default)(this,"httpStatus",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.message=e.error||"Unknown message",this.data=e}}t.MatrixError=v;class y extends Error{constructor(e,t){super(e+(t?`: ${t.message}`:""))}get name(){return"ConnectionError"}}t.ConnectionError=y;class b extends Error{constructor(){super("Operation aborted")}get name(){return"AbortError"}}t.AbortError=b},3415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exists=function(e,t){return new Promise(((n,i)=>{let r=!0;const s=e.open(t);s.onupgradeneeded=()=>{r=!1},s.onblocked=()=>i(s.error),s.onsuccess=()=>{s.result.close(),r||e.deleteDatabase(t),n(r)},s.onerror=e=>i(s.error)}))}},8670:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveAuth=t.AuthType=void 0;var r=i(n(8416)),s=n(7434),o=n(3102);const a="m.login.email.identity",l="m.login.msisdn";let c;t.AuthType=c,function(e){e.Password="m.login.password",e.Recaptcha="m.login.recaptcha",e.Terms="m.login.terms",e.Email="m.login.email.identity",e.Msisdn="m.login.msisdn",e.Sso="m.login.sso",e.SsoUnstable="org.matrix.login.sso",e.Dummy="m.login.dummy",e.RegistrationToken="m.login.registration_token",e.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token"}(c||(t.AuthType=c={}));class d extends Error{constructor(e,t,n){super(e),this.required_stages=t,this.flows=n,(0,r.default)(this,"name","NoAuthFlowFoundError")}}t.InteractiveAuth=class{constructor(e){var t;(0,r.default)(this,"matrixClient",void 0),(0,r.default)(this,"inputs",void 0),(0,r.default)(this,"clientSecret",void 0),(0,r.default)(this,"requestCallback",void 0),(0,r.default)(this,"busyChangedCallback",void 0),(0,r.default)(this,"stateUpdatedCallback",void 0),(0,r.default)(this,"requestEmailTokenCallback",void 0),(0,r.default)(this,"data",void 0),(0,r.default)(this,"emailSid",void 0),(0,r.default)(this,"requestingEmailToken",!1),(0,r.default)(this,"attemptAuthDeferred",null),(0,r.default)(this,"chosenFlow",null),(0,r.default)(this,"currentStage",null),(0,r.default)(this,"emailAttempt",1),(0,r.default)(this,"submitPromise",null),(0,r.default)(this,"requestEmailToken",(async()=>{if(this.requestingEmailToken)s.logger.warn("Could not request email token: Already requesting");else{s.logger.trace("Requesting email token. Attempt: "+this.emailAttempt),this.requestingEmailToken=!0;try{const e=await this.requestEmailTokenCallback(this.inputs.emailAddress,this.clientSecret,this.emailAttempt++,this.data.session);this.emailSid=e.sid,s.logger.trace("Email token request succeeded")}finally{this.requestingEmailToken=!1}}})),this.matrixClient=e.matrixClient,this.data=e.authData||{},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=null!==(t=e.emailSid)&&void 0!==t?t:null}attemptAuth(){var e;this.attemptAuthDeferred=(0,o.defer)();const t=this.attemptAuthDeferred.promise;if(null!==(e=this.data)&&void 0!==e&&e.flows)this.startNextAuthStage();else{var n;null===(n=this.busyChangedCallback)||void 0===n||n.call(this,!0);const e=this.data.session?{session:this.data.session}:null;this.doRequest(e).finally((()=>{var e;null===(e=this.busyChangedCallback)||void 0===e||e.call(this,!1)}))}return t}async poll(){if(!this.data.session)return;if(!this.attemptAuthDeferred)return;if(this.submitPromise)return;let e={};if(this.currentStage==a&&this.emailSid){const t={sid:this.emailSid,client_secret:this.clientSecret};if(await this.matrixClient.doesServerRequireIdServerParam()){const e=new URL(this.matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:a,threepid_creds:t,threepidCreds:t}}this.submitAuthDict(e,!0)}getSessionId(){var e;return null===(e=this.data)||void 0===e?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var t;return null===(t=this.data.params)||void 0===t?void 0:t[e]}getChosenFlow(){return this.chosenFlow}async submitAuthDict(e,t=!1){if(!this.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");var n;for(t||null===(n=this.busyChangedCallback)||void 0===n||n.call(this,!0);this.submitPromise;)try{await this.submitPromise}catch(e){}let i;this.data.session?(i={session:this.data.session},Object.assign(i,e)):i=e;try{this.submitPromise=this.doRequest(i,t),await this.submitPromise}finally{var r;this.submitPromise=null,t||null===(r=this.busyChangedCallback)||void 0===r||r.call(this,!1)}}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}async doRequest(e,t=!1){try{const n=await this.requestCallback(e,t);this.attemptAuthDeferred.resolve(n),this.attemptAuthDeferred=null}catch(e){var n,i;const o=null!==(n=null===(i=e.data)||void 0===i?void 0:i.flows)&&void 0!==n?n:null,a=this.data.flows||Boolean(o);var r;401===e.httpStatus&&e.data&&a||(t?s.logger.log("Background poll request failed doing UI auth: ignoring",e):null===(r=this.attemptAuthDeferred)||void 0===r||r.reject(e)),e.data||(e.data={}),e.data.flows||e.data.completed||e.data.session||(e.data.flows=this.data.flows,e.data.completed=this.data.completed,e.data.session=this.data.session),this.data=e.data;try{this.startNextAuthStage()}catch(e){return this.attemptAuthDeferred.reject(e),void(this.attemptAuthDeferred=null)}if(!this.emailSid&&this.chosenFlow.stages.includes(c.Email))try{await this.requestEmailToken()}catch(e){this.attemptAuthDeferred.reject(e),this.attemptAuthDeferred=null}}}startNextAuthStage(){var e,t;const n=this.chooseStage();if(!n)throw new Error("No incomplete flows from the server");var i,r;this.currentStage=n,n!==c.Dummy?null!==(e=this.data)&&void 0!==e&&e.errcode||null!==(t=this.data)&&void 0!==t&&t.error?this.stateUpdatedCallback(n,{errcode:(null===(i=this.data)||void 0===i?void 0:i.errcode)||"",error:(null===(r=this.data)||void 0===r?void 0:r.error)||""}):this.stateUpdatedCallback(n,n===a?{emailSid:this.emailSid}:{}):this.submitAuthDict({type:"m.login.dummy"})}chooseStage(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),s.logger.log("Active flow => %s",JSON.stringify(this.chosenFlow));const e=this.firstUncompletedStage(this.chosenFlow);return s.logger.log("Next stage: %s",e),e}chooseFlow(){const e=this.data.flows||[],t=Boolean(this.inputs.emailAddress)||Boolean(this.emailSid),n=Boolean(this.inputs.phoneCountry)&&Boolean(this.inputs.phoneNumber);for(const i of e){let e=!1,r=!1;for(const t of i.stages)t===a?e=!0:t==l&&(r=!0);if(e==t&&r==n)return i}const i=[];throw t&&i.push(a),n&&i.push(l),new d("No appropriate authentication flow found",i,e)}firstUncompletedStage(e){const t=this.data.completed||[];for(let n=0;n<e.stages.length;++n){const i=e.stages[n];if(-1===t.indexOf(i))return i}}}},7434:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var r=i(n(2043));r.default.methodFactory=function(e,t,n){return function(...t){return this.prefix&&t.unshift(this.prefix),"error"===e||"warn"===e||"trace"===e||"info"===e?console[e](...t):console.log(...t)}};const s=r.default.getLogger("matrix");t.logger=s,s.setLevel(r.default.levels.DEBUG,!1),function e(t){t.withPrefix=function(t){return function(t){const n=r.default.getLogger(`matrix-${t}`);return n.prefix!==t&&(e(n),n.prefix=t,n.setLevel(r.default.levels.DEBUG,!1)),n}((this.prefix||"")+t)}}(s)},8070:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,ContentHelpers:!0,createNewMatrixCall:!0};t.ContentHelpers=void 0,t.createClient=function(e){return"string"==typeof e&&(e={baseUrl:e}),e.request=e.request||F,e.store=e.store||new s.MemoryStore({localStorage:n.g.localStorage}),e.scheduler=e.scheduler||new o.MatrixScheduler,e.cryptoStore=e.cryptoStore||N(),new a.MatrixClient(e)},Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return D.createNewMatrixCall}}),t.getRequest=function(){return F},t.request=function(e){F=e},t.setCryptoStoreFactory=function(e){N=e},t.wrapRequest=function(e){const t=F;F=function(n,i){return e(t,n,i)}};var r=n(1045);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var s=n(1703);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var o=n(9443);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(2168);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var l=n(7715);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(9118);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=n(2741);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var h=n(9489);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var u=n(6320);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var p=n(4369);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var m=n(7366);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var g=n(8910);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var f=n(3705);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var v=n(2848);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var y=n(6860);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var b=n(3998);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var w=n(7906);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var S=n(4969);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var _=n(8670);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var E=n(1415);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var k=n(9789);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var x=n(7585);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===x[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}}))}));var T=n(3667);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var C=n(2481);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var A=n(1470);Object.keys(A).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===A[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}}))}));var I=n(4702);Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===I[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}}))}));var R=n(6513);Object.keys(R).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===R[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}}))}));var P=n(9162);Object.keys(P).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===P[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}}))}));var O=n(5205);Object.keys(O).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===O[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}}))}));var M=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(4656));t.ContentHelpers=M;var D=n(9679);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}let F,N=()=>new r.MemoryCryptoStore},8807:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.MSC3089Branch=void 0;var r=i(n(8416)),s=n(2481),o=n(8910);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.MSC3089Branch=class{constructor(e,t,n){this.client=e,this.indexEvent=t,this.directory=n}get id(){const e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return!0===this.indexEvent.getContent().active}get version(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}get roomId(){return this.indexEvent.getRoomId()}async delete(){await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,{},this.id),await this.client.redactEvent(this.roomId,this.id);const e=(await this.getVersionHistory())[1];e&&await e.delete()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}async setName(e){await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,l(l({},this.indexEvent.getContent()),{},{name:e}),this.id)}isLocked(){return this.indexEvent.getContent().locked||!1}async setLocked(e){await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,l(l({},this.indexEvent.getContent()),{},{locked:e}),this.id)}async getFileInfo(){const e=(await this.getFileEvent()).getOriginalContent().file,t=this.client.mxcUrlToHttp(e.url);if(!t)throw new Error(`No HTTP URL available for ${e.url}`);return{info:e,httpUrl:t}}async getFileEvent(){const e=this.client.getRoom(this.roomId);if(!e)throw new Error("Unknown room");let t=e.getUnfilteredTimelineSet().findEventById(this.id);for(;!t&&e.getLiveTimeline().getState(o.EventTimeline.BACKWARDS).paginationToken;)await this.client.scrollback(e,100),t=e.getUnfilteredTimelineSet().findEventById(this.id);if(!t)throw new Error("Failed to find event");return await this.client.decryptEventIfNeeded(t,{emit:!0,isRetry:!0}),t}async createNewVersion(e,t,n,i){const r=await this.directory.createFile(e,t,n,l(l({},null!=i?i:{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:s.RelationType.Replace,event_id:this.id}}));return await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e,version:this.version+1},r.event_id),await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,l(l({},this.indexEvent.getContent()),{},{active:!1}),this.id),r}async getVersionHistory(){const e=[];e.push(this);const t=this.client.getRoom(this.roomId);if(!t)throw new Error("Invalid or unknown room");const n=[...t.getLiveTimeline().getEvents()].reverse();let i,r=await this.getFileEvent();do{if(i=n.find((e=>e.replacingEventId()===r.getId())),i){const t=this.directory.getFile(i.getId());if(!t)break;e.push(t),r=i}}while(i);return e}}},6170:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.TreePermissions=t.MSC3089TreeSpace=t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=void 0;var r=i(n(8416)),s=i(n(2693)),o=n(2481),a=n(7434),l=n(3102),c=n(8807),d=n(7125);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const p={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[o.EventType.RoomPowerLevels]:100,[o.EventType.RoomHistoryVisibility]:100,[o.EventType.RoomTombstone]:100,[o.EventType.RoomEncryption]:100,[o.EventType.RoomName]:50,[o.EventType.RoomMessage]:50,[o.EventType.RoomMessageEncrypted]:50,[o.EventType.Sticker]:50},users:{}};let m;t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=p,t.TreePermissions=m,function(e){e.Viewer="viewer",e.Editor="editor",e.Owner="owner"}(m||(t.TreePermissions=m={})),t.MSC3089TreeSpace=class{constructor(e,t){if(this.client=e,this.roomId=t,(0,r.default)(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){const e=this.room.currentState.getStateEvents(o.EventType.SpaceParent);return null==e||!e.length||e.every((e=>{var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}async setName(e){await this.client.sendStateEvent(this.roomId,o.EventType.RoomName,{name:e},"")}async invite(e,t=!0,n=!0){const i=[this.retryInvite(e)];return t&&i.push(...this.getDirectories().map((i=>i.invite(e,t,n)))),Promise.all(i).then((()=>{n&&(0,d.isRoomSharedHistory)(this.room)&&this.client.sendSharedHistoryKeys(this.roomId,[e])}))}retryInvite(e){return(0,l.simpleRetryOperation)((async()=>{await this.client.invite(this.roomId,e).catch((e=>{if("M_FORBIDDEN"===(null==e?void 0:e.errcode))throw new s.default.AbortError(e);throw e}))}))}async setPermissions(e,t){var n;const i=this.room.currentState.getStateEvents(o.EventType.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");const r=i.getContent()||{},s=r.users_default||0,a=r.events_default||50,l=(null===(n=r.events)||void 0===n?void 0:n[o.EventType.RoomPowerLevels])||100,c=r.users||{};switch(t){case m.Viewer:c[e]=s;break;case m.Editor:c[e]=a;break;case m.Owner:c[e]=l;break;default:throw new Error("Invalid role: "+t)}r.users=c,await this.client.sendStateEvent(this.roomId,o.EventType.RoomPowerLevels,r,"")}getPermissions(e){var t,n;const i=this.room.currentState.getStateEvents(o.EventType.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");const r=i.getContent()||{},s=r.users_default||0,a=r.events_default||50,l=(null===(t=r.events)||void 0===t?void 0:t[o.EventType.RoomPowerLevels])||100,c=(null===(n=r.users)||void 0===n?void 0:n[e])||s;return c>=l?m.Owner:c>=a?m.Editor:m.Viewer}async createDirectory(e){const t=await this.client.unstableCreateFileTree(e);return await this.client.sendStateEvent(this.roomId,o.EventType.SpaceChild,{via:[this.client.getDomain()]},t.roomId),await this.client.sendStateEvent(t.roomId,o.EventType.SpaceParent,{via:[this.client.getDomain()]},this.roomId),t}getDirectories(){const e=[],t=this.room.currentState.getStateEvents(o.EventType.SpaceChild);for(const n of t)try{const t=n.getStateKey();if(t){const n=this.client.unstableGetFileTreeSpace(t);n&&e.push(n)}}catch(e){a.logger.warn("Unable to create tree space instance for listing. Are we joined?",e)}return e}getDirectory(e){return this.getDirectories().find((t=>t.roomId===e))}async delete(){const e=this.getDirectories();for(const t of e)await t.delete();const t=["invite","knock","join"],n=this.room.currentState.getStateEvents(o.EventType.RoomMember);for(const e of n)if(e.getStateKey()!==this.client.getUserId()&&t.includes(e.getContent().membership)){const t=e.getStateKey();if(!t)throw new Error("State key not found for branch");await this.client.kick(this.roomId,t,"Room deleted")}await this.client.leave(this.roomId)}getOrderedChildren(e){const t=e.map((e=>({roomId:e.getStateKey(),order:e.getContent().order}))).filter((e=>e.roomId));return t.sort(((e,t)=>{if(e.order&&!t.order)return-1;if(!e.order&&t.order)return 1;if(e.order||t.order)return(0,l.lexicographicCompare)(e.order,t.order);{var n,i,r,s;const a=this.client.getRoom(e.roomId),c=this.client.getRoom(t.roomId);if(!a||!c)return(0,l.lexicographicCompare)(e.roomId,t.roomId);const d=null!==(n=null===(i=a.currentState.getStateEvents(o.EventType.RoomCreate,""))||void 0===i?void 0:i.getTs())&&void 0!==n?n:0,h=null!==(r=null===(s=c.currentState.getStateEvents(o.EventType.RoomCreate,""))||void 0===s?void 0:s.getTs())&&void 0!==r?r:0;return d===h?(0,l.lexicographicCompare)(e.roomId,t.roomId):d-h}})),t}getParentRoom(){const e=this.room.currentState.getStateEvents(o.EventType.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");const t=e.getStateKey();if(!t)throw new Error("No state key found for parent");const n=this.client.getRoom(t);if(!n)throw new Error("Unable to locate room for parent");return n}getOrder(){if(this.isTopLevel)return-1;const e=this.getParentRoom().currentState.getStateEvents(o.EventType.SpaceChild);return this.getOrderedChildren(e).findIndex((e=>e.roomId===this.roomId))}async setOrder(e){var t;if(this.isTopLevel)throw new Error("Cannot set order of top level spaces currently");const n=this.getParentRoom(),i=n.currentState.getStateEvents(o.EventType.SpaceChild),r=this.getOrderedChildren(i);e=Math.max(Math.min(e,r.length-1),0);const s=this.getOrder()<e;s&&e===r.length-1?e--:s||0!==e||e++;const a=r[s?e:e-1],c=r[s?e+1:e];let d=l.DEFAULT_ALPHABET[0],h=!1;if(a)if(e===r.length-1)null!=c&&c.order&&(d=(0,l.nextString)(c.order));else{const e=null==a?void 0:a.order,t=null==c?void 0:c.order;e&&t?d=e===t?(0,l.nextString)(e):(0,l.averageBetweenStrings)(e,t):e?d=(0,l.nextString)(e):t?d=(0,l.prevString)(t):h=!0}else null!=c&&c.order&&(d=(0,l.prevString)(c.order));if(h){let t;for(let i=0;i<=e;i++){const e=r[i];if(0===i&&(t=e.order),e.order)t=e.order;else{var p;t=t?(0,l.nextString)(t):l.DEFAULT_ALPHABET[0];const i=n.currentState.getStateEvents(o.EventType.SpaceChild,e.roomId),r=null!==(p=null==i?void 0:i.getContent())&&void 0!==p?p:{via:[this.client.getDomain()]};await this.client.sendStateEvent(n.roomId,o.EventType.SpaceChild,u(u({},r),{},{order:t}),e.roomId)}}t&&(d=(0,l.nextString)(t))}const m=n.currentState.getStateEvents(o.EventType.SpaceChild,this.roomId),g=null!==(t=null==m?void 0:m.getContent())&&void 0!==t?t:{via:[this.client.getDomain()]};await this.client.sendStateEvent(n.roomId,o.EventType.SpaceChild,u(u({},g),{},{order:d}),this.roomId)}async createFile(e,t,n,i){var r;const s=await this.client.uploadContent(t,{includeFilename:!1,onlyContentUri:!0,rawResponse:!1});n.url=s;const a={msgtype:o.MsgType.File,body:e,url:s,file:n};(i=null!==(r=i)&&void 0!==r?r:{})["m.new_content"]&&(i["m.new_content"]=a);const l=await this.client.sendMessage(this.roomId,u(u(u({},i),a),{},{[o.UNSTABLE_MSC3089_LEAF.name]:{}}));return await this.client.sendStateEvent(this.roomId,o.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e},l.event_id),l}getFile(e){const t=this.room.currentState.getStateEvents(o.UNSTABLE_MSC3089_BRANCH.name,e);return t?new c.MSC3089Branch(this.client,t,this):null}listFiles(){return this.listAllFiles().filter((e=>e.isActive))}listAllFiles(){var e;return(null!==(e=this.room.currentState.getStateEvents(o.UNSTABLE_MSC3089_BRANCH.name))&&void 0!==e?e:[]).map((e=>new c.MSC3089Branch(this.client,e,this)))}}},6320:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.isTimestampInDuration=t.getBeaconInfoIdentifier=t.BeaconEvent=t.Beacon=void 0;var r=i(n(8416)),s=n(4656),o=n(3102),a=n(5861);let l;t.BeaconEvent=l,function(e){e.New="Beacon.new",e.Update="Beacon.update",e.LivenessChange="Beacon.LivenessChange",e.Destroy="Beacon.Destroy",e.LocationUpdate="Beacon.LocationUpdate"}(l||(t.BeaconEvent=l={}));const c=(e,t,n)=>n>=e&&e+t>=n;t.isTimestampInDuration=c;const d=e=>`${e.getRoomId()}_${e.getStateKey()}`;t.getBeaconInfoIdentifier=d;class h extends a.TypedEventEmitter{constructor(e){super(),this.rootEvent=e,(0,r.default)(this,"roomId",void 0),(0,r.default)(this,"_beaconInfo",void 0),(0,r.default)(this,"_isLive",void 0),(0,r.default)(this,"livenessWatchTimeout",void 0),(0,r.default)(this,"_latestLocationEvent",void 0),(0,r.default)(this,"clearLatestLocation",(()=>{this._latestLocationEvent=void 0,this.emit(l.LocationUpdate,this.latestLocationState)})),this.setBeaconInfo(this.rootEvent),this.roomId=this.rootEvent.getRoomId()}get isLive(){return this._isLive}get identifier(){return d(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&(0,s.parseBeaconContent)(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(d(e)!==this.identifier)throw new Error("Invalid updating event");e.event.origin_server_ts<this.rootEvent.event.origin_server_ts||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(l.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(l.Destroy,this.identifier)}monitorLiveness(){var e;if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),this.isLive){var t,n;const e=(null===(t=this._beaconInfo)||void 0===t?void 0:t.timestamp)+(null===(n=this._beaconInfo)||void 0===n?void 0:n.timeout)-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),e))}else if((null===(e=this._beaconInfo)||void 0===e?void 0:e.timestamp)>Date.now()){var i;this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),(null===(i=this.beaconInfo)||void 0===i?void 0:i.timestamp)-Date.now())}}addLocations(e){var t;if(!this.isLive)return;const n=null===(t=e.filter((e=>{const t=e.getContent(),n=(0,s.parseBeaconContent)(t);if(!n.uri||!n.timestamp)return!1;const{timestamp:i}=n;return c(this._beaconInfo.timestamp,this._beaconInfo.timeout,i)&&(!this.latestLocationState||i>this.latestLocationState.timestamp)})).sort(o.sortEventsByLatestContentTimestamp))||void 0===t?void 0:t[0];n&&(this._latestLocationEvent=n,this.emit(l.LocationUpdate,this.latestLocationState))}setBeaconInfo(e){this._beaconInfo=(0,s.parseBeaconInfoContent)(e.getContent()),this.checkLiveness()}checkLiveness(){var e,t,n,i,r;const s=this.isLive,o=(null===(e=this._beaconInfo)||void 0===e?void 0:e.timestamp)>Date.now()?(null===(t=this._beaconInfo)||void 0===t?void 0:t.timestamp)-36e4:null===(n=this._beaconInfo)||void 0===n?void 0:n.timestamp;this._isLive=!(null===(i=this._beaconInfo)||void 0===i||!i.live)&&c(o,null===(r=this._beaconInfo)||void 0===r?void 0:r.timeout,Date.now()),s!==this.isLive&&this.emit(l.LivenessChange,this.isLive,this)}}t.Beacon=h},3558:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=void 0;var r=i(n(8416)),s=n(8910);t.EventContext=class{constructor(e){this.ourEvent=e,(0,r.default)(this,"timeline",void 0),(0,r.default)(this,"ourEventIndex",0),(0,r.default)(this,"paginateTokens",{[s.Direction.Backward]:null,[s.Direction.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(e=!1){return this.paginateTokens[e?s.Direction.Backward:s.Direction.Forward]}setPaginateToken(e,t=!1){this.paginateTokens[t?s.Direction.Backward:s.Direction.Forward]=e}addEvents(e,t=!1){t?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}},8881:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.EventStatus=void 0,t.EventStatus=n,function(e){e.NOT_SENT="not_sent",e.ENCRYPTING="encrypting",e.SENDING="sending",e.QUEUED="queued",e.SENT="sent",e.CANCELLED="cancelled"}(n||(t.EventStatus=n={}))},3705:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=t.DuplicateStrategy=void 0;var r=i(n(8416)),s=n(8910),o=n(7434),a=n(7366),l=n(5861),c=n(7286);let d,h;d=o.logger.log.bind(o.logger),t.DuplicateStrategy=h,function(e){e.Ignore="ignore",e.Replace="replace"}(h||(t.DuplicateStrategy=h={}));class u extends l.TypedEventEmitter{constructor(e,t={},n,i){var o,a,l;super(),this.room=e,this.thread=i,(0,r.default)(this,"relations",void 0),(0,r.default)(this,"timelineSupport",void 0),(0,r.default)(this,"displayPendingEvents",void 0),(0,r.default)(this,"liveTimeline",void 0),(0,r.default)(this,"timelines",void 0),(0,r.default)(this,"_eventIdToTimeline",new Map),(0,r.default)(this,"filter",void 0),this.timelineSupport=Boolean(t.timelineSupport),this.liveTimeline=new s.EventTimeline(this),this.displayPendingEvents=!1!==t.pendingEvents,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=t.filter,this.relations=null!==(o=null===(a=this.room)||void 0===a?void 0:a.relations)&&void 0!==o?o:new c.RelationsContainer(null!==(l=null==e?void 0:e.client)&&void 0!==l?l:n)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return this.room&&this.displayPendingEvents?this.room.getPendingEvents():[]}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,t){const n=this._eventIdToTimeline.get(e);n&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(t,n))}resetLiveTimeline(e,t){const n=!this.timelineSupport||!t,i=this.liveTimeline,r=n?i.forkLive(s.EventTimeline.FORWARDS):i.fork(s.EventTimeline.FORWARDS);n?(this.timelines=[r],this._eventIdToTimeline=new Map):this.timelines.push(r),t&&i.setPaginationToken(t,s.EventTimeline.FORWARDS),r.setPaginationToken(e,s.EventTimeline.BACKWARDS),this.liveTimeline=r,this.emit(a.RoomEvent.TimelineReset,this.room,this,n)}getTimelineForEvent(e){if(null===e)return null;const t=this._eventIdToTimeline.get(e);return void 0===t?null:t}findEventById(e){const t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new s.EventTimeline(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,n,i){if(!n)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&n==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this.filter&&!(e=this.filter.filterRoomTimeline(e)).length)return;const r=t?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS,a=t?s.EventTimeline.FORWARDS:s.EventTimeline.BACKWARDS;let l=!1,c=!1;for(let i=0;i<e.length;i++){const h=e[i],u=h.getId(),p=this._eventIdToTimeline.get(u);if(!p){this.addEventToTimeline(h,n,{toStartOfTimeline:t}),c=!0,l=!0;continue}if(c=!1,p==n){d("Event "+u+" already in timeline "+n);continue}const m=n.getNeighbouringTimeline(r);if(m){d(p==m?"Event "+u+" in neighbouring timeline - switching to "+p:"Event "+u+" already in a different timeline "+p),n=p;continue}o.logger.info("Already have timeline for "+u+" - joining timeline "+n+" to "+p);const g=p===this.liveTimeline,f=n===this.liveTimeline,v=r===s.EventTimeline.BACKWARDS&&g,y=r===s.EventTimeline.FORWARDS&&f;v||y?(v&&o.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+p+")"),y&&o.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+n+")")):(n.setNeighbouringTimeline(p,r),p.setNeighbouringTimeline(n,a),n=p,l=!0)}if(c||!l){if(r===s.EventTimeline.FORWARDS&&n===this.liveTimeline)return o.logger.warn({lastEventWasNew:c,didUpdate:l}),void o.logger.warn(`Refusing to set forwards pagination token of live timeline ${n} to ${i}`);n.setPaginationToken(i,r)}}addLiveEvent(e,t,n=!1,i){let r,a=t||h.Ignore;if("object"==typeof t?({duplicateStrategy:a=h.Ignore,fromCache:n=!1,roomState:i,timelineWasEmpty:r}=t):void 0!==t&&o.logger.warn("Overload deprecated: `EventTimelineSet.addLiveEvent(event, duplicateStrategy?, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addLiveEvent(event, IAddLiveEventOptions)`"),this.filter&&!this.filter.filterRoomTimeline([e]).length)return;const l=this._eventIdToTimeline.get(e.getId());if(l)if(a===h.Replace){d("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=l.getEvents();for(let n=0;n<t.length;n++)if(t[n].getId()===e.getId()){i||(i=l.getState(s.EventTimeline.FORWARDS)),s.EventTimeline.setEventMetadata(e,i,!1),t[n]=e;break}}else d("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:n,roomState:i,timelineWasEmpty:r})}addEventToTimeline(e,t,n,i=!1,r){let s,l=!!n;"object"==typeof n?({toStartOfTimeline:l,fromCache:i=!1,roomState:r,timelineWasEmpty:s}=n):void 0!==n&&o.logger.warn("Overload deprecated: `EventTimelineSet.addEventToTimeline(event, timeline, toStartOfTimeline, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addEventToTimeline(event, timeline, IAddEventToTimelineOptions)`");const c=e.getId();t.addEvent(e,{toStartOfTimeline:l,roomState:r,timelineWasEmpty:s}),this._eventIdToTimeline.set(c,t),this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this);const d={timeline:t,liveEvent:!l&&t==this.liveTimeline&&!i};this.emit(a.RoomEvent.Timeline,e,this.room,Boolean(l),!1,d)}handleRemoteEcho(e,t,n){const i=this._eventIdToTimeline.get(t);i?(this._eventIdToTimeline.delete(t),this._eventIdToTimeline.set(n,i)):this.filter&&!this.filter.filterRoomTimeline([e]).length||this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1})}removeEvent(e){const t=this._eventIdToTimeline.get(e);if(!t)return null;const n=t.removeEvent(e);if(n){this._eventIdToTimeline.delete(e);const i={timeline:t};this.emit(a.RoomEvent.Timeline,n,this.room,void 0,!0,i)}return n}compareEventOrdering(e,t){if(e==t)return 0;const n=this._eventIdToTimeline.get(e),i=this._eventIdToTimeline.get(t);if(void 0===n)return null;if(void 0===i)return null;if(n===i){let i,r;const s=n.getEvents();for(let n=0;n<s.length&&(void 0===i||void 0===r);n++){const o=s[n].getId();o==e&&(i=n),o==t&&(r=n)}return i-r}let r=n;for(;r;){if(r===i)return-1;r=r.getNeighbouringTimeline(s.EventTimeline.FORWARDS)}for(r=n;r;){if(r===i)return 1;r=r.getNeighbouringTimeline(s.EventTimeline.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");const{threadId:t,shouldLiveInRoom:n}=this.room.eventShouldLiveIn(e);return this.thread?this.thread.id===t:n}}t.EventTimelineSet=u},8910:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=t.Direction=void 0;var r=i(n(8416)),s=n(7434),o=n(6860),a=n(2481);let l;t.Direction=l,function(e){e.Backward="b",e.Forward="f"}(l||(t.Direction=l={}));class c{static setEventMetadata(e,t,n){var i,r,s,o;null!==(i=e.sender)&&void 0!==i&&null!==(r=i.events)&&void 0!==r&&r.member||(e.sender=t.getSentinelMember(e.getSender())),null!==(s=e.target)&&void 0!==s&&null!==(o=s.events)&&void 0!==o&&o.member||e.getType()!==a.EventType.RoomMember||(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&n&&(e.forwardLooking=!1)}constructor(e){var t,n;this.eventTimelineSet=e,(0,r.default)(this,"roomId",void 0),(0,r.default)(this,"name",void 0),(0,r.default)(this,"events",[]),(0,r.default)(this,"baseIndex",0),(0,r.default)(this,"startState",void 0),(0,r.default)(this,"endState",void 0),(0,r.default)(this,"prevTimeline",void 0),(0,r.default)(this,"nextTimeline",void 0),(0,r.default)(this,"paginationRequests",{[l.Backward]:null,[l.Forward]:null}),this.roomId=null!==(t=null===(n=e.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null,this.startState=new o.RoomState(this.roomId),this.startState.paginationToken=null,this.endState=new o.RoomState(this.roomId),this.endState.paginationToken=null,this.prevTimeline=null,this.nextTimeline=null,this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(e,{timelineWasEmpty:t}={}){if(this.events.length>0)throw new Error("Cannot initialise state after events are added");for(const t of e)Object.freeze(t);this.startState.setStateEvents(e,{timelineWasEmpty:t}),this.endState.setStateEvents(e,{timelineWasEmpty:t})}forkLive(e){const t=this.getState(e),n=new c(this.eventTimelineSet);return n.startState=t.clone(),n.endState=t,this.endState=t.clone(),n}fork(e){const t=this.getState(e),n=new c(this.eventTimelineSet);return n.startState=t.clone(),n.endState=t.clone(),n}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==c.BACKWARDS)return this.startState;if(e==c.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.getState(e).paginationToken}setPaginationToken(e,t){this.getState(t).paginationToken=e}getNeighbouringTimeline(e){if(e==c.BACKWARDS)return this.prevTimeline;if(e==c.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==c.BACKWARDS)this.prevTimeline=e;else{if(t!=c.FORWARDS)throw new Error("Invalid direction '"+t+"'");this.nextTimeline=e}this.setPaginationToken(null,t)}addEvent(e,t,n){let i,r=!!t;"object"==typeof t?({toStartOfTimeline:r,roomState:n,timelineWasEmpty:i}=t):void 0!==t&&s.logger.warn("Overload deprecated: `EventTimeline.addEvent(event, toStartOfTimeline, roomState?)` is deprecated in favor of the overload with `EventTimeline.addEvent(event, IAddEventOptions)`"),n||(n=r?this.startState:this.endState);const o=this.getTimelineSet();let a;o.room&&(c.setEventMetadata(e,n,r),e.isState()&&o.room.getUnfilteredTimelineSet()===o&&(n.setStateEvents([e],{timelineWasEmpty:i}),e.sender&&("m.room.member"!==e.getType()||r)||c.setEventMetadata(e,n,r))),a=r?0:this.events.length,this.events.splice(a,0,e),r&&this.baseIndex++}removeEvent(e){for(let t=this.events.length-1;t>=0;t--){const n=this.events[t];if(n.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,n}return null}toString(){return this.name}}t.EventTimeline=c,(0,r.default)(c,"BACKWARDS",l.Backward),(0,r.default)(c,"FORWARDS",l.Forward)},4369:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"EventStatus",{enumerable:!0,get:function(){return u.EventStatus}}),t.MatrixEventEvent=t.MatrixEvent=void 0;var r=i(n(8416)),s=n(1333),o=n(7434),a=n(2481),l=n(3102),c=n(6969),d=n(771),h=n(5861),u=n(8881);const p=Object.freeze({visible:!0});let m;t.MatrixEventEvent=m,function(e){e.Decrypted="Event.decrypted",e.BeforeRedaction="Event.beforeRedaction",e.VisibilityChange="Event.visibilityChange",e.LocalEventIdReplaced="Event.localEventIdReplaced",e.Status="Event.status",e.Replaced="Event.replaced",e.RelationsCreated="Event.relationsCreated"}(m||(t.MatrixEventEvent=m={}));class g extends h.TypedEventEmitter{constructor(e={}){var t;super(),this.event=e,(0,r.default)(this,"pushActions",null),(0,r.default)(this,"_replacingEvent",null),(0,r.default)(this,"_localRedactionEvent",null),(0,r.default)(this,"_isCancelled",!1),(0,r.default)(this,"clearEvent",void 0),(0,r.default)(this,"visibility",p),(0,r.default)(this,"_hasCachedExtEv",!1),(0,r.default)(this,"_cachedExtEv",void 0),(0,r.default)(this,"senderCurve25519Key",null),(0,r.default)(this,"claimedEd25519Key",null),(0,r.default)(this,"forwardingCurve25519KeyChain",[]),(0,r.default)(this,"untrusted",null),(0,r.default)(this,"_decryptionPromise",null),(0,r.default)(this,"retryDecryption",!1),(0,r.default)(this,"txnId",null),(0,r.default)(this,"thread",null),(0,r.default)(this,"threadId",void 0),(0,r.default)(this,"localTimestamp",void 0),(0,r.default)(this,"sender",null),(0,r.default)(this,"target",null),(0,r.default)(this,"status",null),(0,r.default)(this,"error",null),(0,r.default)(this,"forwardLooking",!0),(0,r.default)(this,"verificationRequest",null),(0,r.default)(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach((t=>{"string"==typeof e[t]&&(e[t]=(0,l.internaliseString)(e[t]))})),["membership","avatar_url","displayname"].forEach((t=>{var n;"string"==typeof(null===(n=e.content)||void 0===n?void 0:n[t])&&(e.content[t]=(0,l.internaliseString)(e.content[t]))})),["rel_type"].forEach((t=>{var n,i;"string"==typeof(null===(n=e.content)||void 0===n||null===(i=n["m.relates_to"])||void 0===i?void 0:i[t])&&(e.content["m.relates_to"][t]=(0,l.internaliseString)(e.content["m.relates_to"][t]))})),this.txnId=e.txn_id||null,this.localTimestamp=Date.now()-(null!==(t=this.getAge())&&void 0!==t?t:0),this.reEmitter=new d.TypedReEmitter(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=s.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){const e=Object.assign({},this.getContent());if(this.getWireType()===a.EventType.RoomMessageEncrypted)for(const[t,n]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(t)||void 0===e[t]&&(e[t]=n);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender||this.event.user_id}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getOriginalContent(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content||{}:this.event.content||{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var e;const t=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];return(null==t?void 0:t.rel_type)===c.THREAD_RELATION_TYPE.name?t.event_id:(null===(n=this.getThread())||void 0===n?void 0:n.id)||this.threadId;var n}get isThreadRoot(){var e;return!!this.getServerAggregatedRelation(c.THREAD_RELATION_TYPE.name)||(null===(e=this.getThread())||void 0===e?void 0:e.id)===this.getId()}get replyEventId(){var e;const t=this.getContent()["m.relates_to"]||this.getWireContent()["m.relates_to"];return null==t||null===(e=t["m.in_reply_to"])||void 0===e?void 0:e.event_id}get relationEventId(){var e,t;return null===(e=this.getWireContent())||void 0===e||null===(t=e["m.relates_to"])||void 0===t?void 0:t.event_id}getPrevContent(){return this.getUnsigned().prev_content||this.event.prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age||this.event.age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}makeEncrypted(e,t,n,i){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=n,this.claimedEd25519Key=i}isBeingDecrypted(){return null!=this._decryptionPromise}getDecryptionPromise(){return this._decryptionPromise}isDecryptionFailure(){var e,t;return"m.bad.encrypted"===(null===(e=this.clearEvent)||void 0===e||null===(t=e.content)||void 0===t?void 0:t.msgtype)}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}async attemptDecryption(e,t={}){if("boolean"==typeof t&&(t={isRetry:t}),!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");const n=this.clearEvent&&!this.isDecryptionFailure(),i=t.forceRedecryptIfUntrusted&&this.isKeySourceUntrusted();if(n&&!i)throw new Error("Attempt to decrypt event which has already been decrypted");return this._decryptionPromise?(o.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this.retryDecryption=!0,this._decryptionPromise):(this._decryptionPromise=this.decryptionLoop(e,t),this._decryptionPromise)}cancelAndResendKeyRequest(e,t){const n=this.getWireContent();return e.requestRoomKey({algorithm:n.algorithm,room_id:this.getRoomId(),session_id:n.session_id,sender_key:n.sender_key},this.getKeyRequestRecipients(t),!0)}getKeyRequestRecipients(e){const t=this.getWireContent(),n=[{userId:e,deviceId:"*"}],i=this.getSender();return i!==e&&n.push({userId:i,deviceId:t.device_id}),n}async decryptionLoop(e,t={}){for(await Promise.resolve();;){let n,i;this.retryDecryption=!1;try{e?(n=await e.decryptEvent(this),!0===t.isRetry&&o.logger.info(`Decrypted event on retry (id=${this.getId()})`)):n=this.badEncryptedMessage("Encryption not enabled")}catch(e){if("DecryptionError"!==e.name){const n=t.isRetry?"re":"";return o.logger.error(`Error ${n}decrypting event (id=${this.getId()}): ${e.stack||e}`),this._decryptionPromise=null,void(this.retryDecryption=!1)}if(i=e,this.retryDecryption){o.logger.log(`Got error decrypting event (id=${this.getId()}: ${e.detailedString}), but retrying`,e);continue}o.logger.warn(`Got error decrypting event (id=${this.getId()}: ${e.detailedString})`,e),n=this.badEncryptedMessage(e.message)}return this._decryptionPromise=null,this.retryDecryption=!1,this.setClearData(n),this.setPushActions(null),void(!1!==t.emit&&this.emit(m.Decrypted,this,i))}}badEncryptedMessage(e){return{clearEvent:{type:a.EventType.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}}setClearData(e){this.clearEvent=e.clearEvent,this.senderCurve25519Key=e.senderCurve25519Key||null,this.claimedEd25519Key=e.claimedEd25519Key||null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===a.EventType.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return{ed25519:this.claimedEd25519Key}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(m.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){const t=!e||e.visible,n=e?e.reason:null;let i=!1;this.visibility.visible!==e.visible?i=!0:this.visibility.visible||this.visibility.reason===n||(i=!0),i&&(this.visibility=t?p:Object.freeze({visible:!1,reason:n}),this.emit(m.VisibilityChange,this,t))}messageVisibility(){return this.visibility}makeRedacted(e){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit(m.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event;for(const e in this.event)this.event.hasOwnProperty(e)&&!f.has(e)&&delete this.event[e];this.isEncrypted()&&(this.clearEvent=null);const t=v[this.getType()]||{},n=this.getContent();for(const e in n)n.hasOwnProperty(e)&&!t[e]&&delete n[e];this.invalidateExtensibleEvent()}isRedacted(){return Boolean(this.getUnsigned().redacted_because)}isRedaction(){return this.getType()===a.EventType.RoomRedaction}asVisibilityChange(){if(!a.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType()))return null;const e=this.getRelation();if(!e||"m.reference"!=e.rel_type)return null;const t=e.event_id;if(!t)return null;const n=this.getWireContent(),i=!!n.visible,r=n.reason;return r&&"string"!=typeof r?null:{visible:i,reason:r,eventId:t}}isVisibilityEvent(){return a.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType())}getRedactionEvent(){var e,t;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null===(t=this.clearEvent)||void 0===t?void 0:t.unsigned.redacted_because:this.event.unsigned.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushActions}setPushActions(e){this.pushActions=e}handleRemoteEcho(e){const t=this.getUnsigned(),n=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==n&&this.emit(m.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-this.getAge()}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(m.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(m.LocalEventIdReplaced,this)}isRelation(e){var t;const n=null===(t=this.getWireContent())||void 0===t?void 0:t["m.relates_to"];return(!this.isState()||(null==n?void 0:n.rel_type)!==a.RelationType.Replace)&&(null==n?void 0:n.rel_type)&&n.event_id&&(!e||n.rel_type===e)}getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit(m.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var t;return null===(t=this.getUnsigned()["m.relations"])||void 0===t?void 0:t[e]}replacingEventId(){const e=this.getServerAggregatedRelation(a.RelationType.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){const e=this.getServerAggregatedRelation(a.RelationType.Replace);if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){const e=this.getRelation();return this.replyEventId?this.replyEventId:e?e.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssocation(){return!!this.getAssociatedId()}updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(e=!0){this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){const e=new g(JSON.parse(JSON.stringify(this.event)));for(const[t,n]of Object.entries(this))"event"!==t&&(e[t]=n);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;const t=(0,l.deepSortedObjectEntries)(this.event),n=(0,l.deepSortedObjectEntries)(e.event);return JSON.stringify(t)===JSON.stringify(n)}toJSON(){const e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setVerificationRequest(e){this.verificationRequest=e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.thread=e,this.setThreadId(e.id),this.reEmitter.reEmit(e,[c.ThreadEvent.Update])}getThread(){return this.thread}setThreadId(e){this.threadId=e}}t.MatrixEvent=g;const f=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),v={[a.EventType.RoomMember]:{membership:1},[a.EventType.RoomCreate]:{creator:1},[a.EventType.RoomJoinRules]:{join_rule:1},[a.EventType.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},[a.EventType.RoomAliases]:{aliases:1}}},8515:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolicyScope=t.POLICIES_ACCOUNT_EVENT_TYPE=t.IgnoredInvites=t.IGNORE_INVITES_ACCOUNT_EVENT_KEY=void 0;var i=n(1333),r=n(8910),s=n(4702),o=n(3102);const a=new i.UnstableValue("m.policies","org.matrix.msc3847.policies");t.POLICIES_ACCOUNT_EVENT_TYPE=a;const l=new i.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites");var c;let d;t.IGNORE_INVITES_ACCOUNT_EVENT_KEY=l,function(e){e.Ban="m.ban"}(c||(c={})),t.PolicyScope=d,function(e){e.User="m.policy.user",e.Room="m.policy.room",e.Server="m.policy.server"}(d||(t.PolicyScope=d={})),t.IgnoredInvites=class{constructor(e){this.client=e}async addRule(e,t,n){const i=await this.getOrCreateTargetRoom();return(await this.client.sendStateEvent(i.roomId,e,{entity:t,reason:n,recommendation:c.Ban})).event_id}async removeRule(e){await this.client.redactEvent(e.getRoomId(),e.getId())}async addSource(e){await this.client.joinRoom(e);const t=(await this.getOrCreateSourceRooms()).map((e=>e.roomId));return!t.includes(e)&&(t.push(e),await this.withIgnoreInvitesPolicies((e=>{e.sources=t})),!0)}async getRuleForInvite({sender:e,roomId:t}){const n=await this.getOrCreateSourceRooms(),i=e.split(":")[1],s=t.split(":")[1];for(const a of n){const n=a.getUnfilteredTimelineSet().getLiveTimeline().getState(r.EventTimeline.FORWARDS);for(const{scope:r,entities:a}of[{scope:d.Room,entities:[t]},{scope:d.User,entities:[e]},{scope:d.Server,entities:[i,s]}]){const e=n.getStateEvents(r);for(const t of e){const e=t.getContent();if((null==e?void 0:e.recommendation)!=c.Ban)continue;const n=null==e?void 0:e.entity;if(!n)continue;let i;try{i=new RegExp((0,o.globToRegexp)(n,!1))}catch(e){continue}for(const e of a)if(e&&i.test(e))return t}}}return null}async getOrCreateTargetRoom(){let e=this.getIgnoreInvitesPolicies().target;if("string"!=typeof e&&(e=null),e){const t=this.client.getRoom(e);if(t)return t;e=null}return e=(await this.client.createRoom({name:"Individual Policy Room",preset:s.Preset.PrivateChat})).room_id,await this.withIgnoreInvitesPolicies((t=>{t.target=e})),this.client.getRoom(e)}async getOrCreateSourceRooms(){let e=this.getIgnoreInvitesPolicies().sources,t=!1;Array.isArray(e)||(t=!0,e=[]);let n=e.filter((e=>"string"==typeof e)).map((e=>this.client.getRoom(e))).filter((e=>!!e));return n.length!=e.length&&(t=!0),0==n.length&&(t=!0,n=[await this.getOrCreateTargetRoom()]),t&&await this.withIgnoreInvitesPolicies((t=>{t.sources=e})),n}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}async withIgnoreInvitesPolicies(e){const{policies:t,ignoreInvitesPolicies:n}=this.getPoliciesAndIgnoreInvitesPolicies();e(n),t[l.name]=n,await this.client.setAccountData(a.name,t)}getPoliciesAndIgnoreInvitesPolicies(){let e={};for(const n of[a.name,a.altName]){var t;if(!n)continue;const i=null===(t=this.client.getAccountData(n))||void 0===t?void 0:t.getContent();if(i){e=i;break}}let n={},i=!1;for(const t of[l.name,l.altName]){if(!t)continue;const r=e[t];if(r&&"object"==typeof r){n=r,i=!0;break}}return i||(e[l.name]=n),{policies:e,ignoreInvitesPolicies:n}}}},2958:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.ReadReceipt=t.MAIN_ROOM_TIMELINE=void 0,t.synthesizeReceipt=h;var r=i(n(8416)),s=n(5550),o=n(8070),a=n(5861),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}const d="main";function h(e,t,n){var i;return new o.MatrixEvent({content:{[t.getId()]:{[n]:{[e]:{ts:t.getTs(),threadId:null!==(i=t.threadRootId)&&void 0!==i?i:d}}}},type:o.EventType.Receipt,room_id:t.getRoomId()})}t.MAIN_ROOM_TIMELINE=d;class u extends a.TypedEventEmitter{constructor(...e){super(...e),(0,r.default)(this,"receipts",{}),(0,r.default)(this,"receiptCacheByEventId",{}),(0,r.default)(this,"timeline",void 0)}getReadReceiptForUserId(e,t=!1,n=s.ReceiptType.Read){var i,r;const[o,a]=null!==(i=null===(r=this.receipts[n])||void 0===r?void 0:r[e])&&void 0!==i?i:[];return t?o:null!=a?a:o}getEventReadUpTo(e,t=!1){var n,i,r,o,a;const l=this.getUnfilteredTimelineSet(),c=this.getReadReceiptForUserId(e,t,s.ReceiptType.Read),d=this.getReadReceiptForUserId(e,t,s.ReceiptType.ReadPrivate);let h;var u,p;return null!=c&&c.eventId&&null!=d&&d.eventId&&(h=l.compareEventOrdering(null==c?void 0:c.eventId,null==d?void 0:d.eventId)),!h&&null!=c&&null!==(n=c.data)&&void 0!==n&&n.ts&&null!=d&&null!==(i=d.data)&&void 0!==i&&i.ts&&(h=(null==c||null===(u=c.data)||void 0===u?void 0:u.ts)-(null==d||null===(p=d.data)||void 0===p?void 0:p.ts)),h?null!==(a=h<0?null==d?void 0:d.eventId:null==c?void 0:c.eventId)&&void 0!==a?a:null:null!==(r=null!==(o=null==d?void 0:d.eventId)&&void 0!==o?o:null==c?void 0:c.eventId)&&void 0!==r?r:null}addReceiptToStructure(e,t,n,i,r){var s,o;this.receipts[t]||(this.receipts[t]={}),this.receipts[t][n]||(this.receipts[t][n]=[null,null]);const a=this.receipts[t][n];let l=a[0];var c;if(r&&(l=null!==(c=a[1])&&void 0!==c?c:a[0]),l){const t=this.getUnfilteredTimelineSet().compareEventOrdering(l.eventId,e);if(null!==t&&t>=0)return}const d={eventId:e,data:i},h=r?a[0]:d,u=r?d:a[1];let p=null;h&&u&&(p=this.getUnfilteredTimelineSet().compareEventOrdering(h.eventId,u.eventId));const m=null===p||p<0,g=null!==(s=a[1])&&void 0!==s?s:a[0];if(r&&m?a[1]=d:r||(a[0]=d,m||(a[1]=null)),g!==(null!==(o=a[1])&&void 0!==o?o:a[0])){if(g&&this.receiptCacheByEventId[g.eventId]){const e=g.eventId;this.receiptCacheByEventId[e]=this.receiptCacheByEventId[e].filter((e=>e.type!==t||e.userId!==n)),this.receiptCacheByEventId[e].length<1&&delete this.receiptCacheByEventId[e]}this.receiptCacheByEventId[e]||(this.receiptCacheByEventId[e]=[]),this.receiptCacheByEventId[e].push({userId:n,type:t,data:i})}}getReceiptsForEvent(e){return this.receiptCacheByEventId[e.getId()]||[]}addLocalEchoReceipt(e,t,n){this.addReceipt(h(e,t,n),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter((function(e){return l.isSupportedReceiptType(e.type)})).map((function(e){return e.userId}))}hasUserReadEvent(e,t){const n=this.getEventReadUpTo(e,!1);if(n===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let e=this.timeline.length-1;e>=0;--e){const i=this.timeline[e];if(i.getId()===t)return!1;if(i.getId()===n)return!0}return!1}}t.ReadReceipt=u},7286:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RelationsContainer=void 0;var r=i(n(8416)),s=n(9690),o=n(4369);t.RelationsContainer=class{constructor(e,t){this.client=e,this.room=t,(0,r.default)(this,"relations",new Map)}getChildEventsForEvent(e,t,n){var i,r;return null===(i=this.relations.get(e))||void 0===i||null===(r=i.get(t))||void 0===r?void 0:r.get(n)}getAllChildEventsForEvent(e){var t;const n=null!==(t=this.relations.get(e))&&void 0!==t?t:new Map,i=[];for(const e of n.values())for(const t of e.values())i.push(...t.getRelations());return i}aggregateParentEvent(e){const t=this.relations.get(e.getId());if(t)for(const n of t.values())for(const t of n.values())t.setTargetEvent(e)}aggregateChildEvent(e,t){if(e.isRedacted()||e.status===o.EventStatus.CANCELLED)return;const n=e.getRelation();if(!n)return;const i=()=>{e.isDecryptionFailure()?e.once(o.MatrixEventEvent.Decrypted,i):this.aggregateChildEvent(e,t)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption())return void e.once(o.MatrixEventEvent.Decrypted,i);const{event_id:r,rel_type:a}=n,l=e.getType();let c=this.relations.get(r);c||(c=new Map,this.relations.set(r,c));let d=c.get(a);d||(d=new Map,c.set(a,d));let h=d.get(l);if(!h){var u,p,m;h=new s.Relations(a,l,this.client),d.set(l,h);const e=null!==(u=this.room)&&void 0!==u?u:null==t?void 0:t.room,n=null!==(p=null!==(m=null==t?void 0:t.findEventById(r))&&void 0!==m?m:null==e?void 0:e.findEventById(r))&&void 0!==p?p:null==e?void 0:e.getPendingEvent(r);n&&h.setTargetEvent(n)}h.addEvent(e)}}},9690:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RelationsEvent=t.Relations=void 0;var r=i(n(8416)),s=n(4369),o=n(7434),a=n(2481),l=n(5861),c=n(7366);let d;t.RelationsEvent=d,function(e){e.Add="Relations.add",e.Remove="Relations.remove",e.Redaction="Relations.redaction"}(d||(t.RelationsEvent=d={}));class h extends l.TypedEventEmitter{constructor(e,t,n){super(),this.relationType=e,this.eventType=t,(0,r.default)(this,"relationEventIds",new Set),(0,r.default)(this,"relations",new Set),(0,r.default)(this,"annotationsByKey",{}),(0,r.default)(this,"annotationsBySender",{}),(0,r.default)(this,"sortedAnnotationsByKey",[]),(0,r.default)(this,"targetEvent",null),(0,r.default)(this,"creationEmitted",!1),(0,r.default)(this,"client",void 0),(0,r.default)(this,"onEventStatus",((e,t)=>{e.isSending()?t===s.EventStatus.CANCELLED&&(e.removeListener(s.MatrixEventEvent.Status,this.onEventStatus),this.removeEvent(e)):e.removeListener(s.MatrixEventEvent.Status,this.onEventStatus)})),(0,r.default)(this,"onBeforeRedaction",(async e=>{if(this.relations.has(e)){if(this.relations.delete(e),this.relationType===a.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===a.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.removeListener(s.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.emit(d.Redaction,e)}})),this.client=n instanceof c.Room?n.client:n}async addEvent(e){if(this.relationEventIds.has(e.getId()))return;const t=e.getRelation();if(!t)return void o.logger.error("Event must have relation info");const n=t.rel_type,i=e.getType();if(this.relationType===n&&this.eventType===i){if(e.isSending()&&e.on(s.MatrixEventEvent.Status,this.onEventStatus),this.relations.add(e),this.relationEventIds.add(e.getId()),this.relationType===a.RelationType.Annotation)this.addAnnotationToAggregation(e);else if(this.relationType===a.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.on(s.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.emit(d.Add,e),this.maybeEmitCreated()}else o.logger.error("Event relation info doesn't match this container")}async removeEvent(e){if(!this.relations.has(e))return;const t=e.getRelation();if(!t)return void o.logger.error("Event must have relation info");const n=t.rel_type,i=e.getType();if(this.relationType===n&&this.eventType===i){if(this.relations.delete(e),this.relationType===a.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===a.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}this.emit(d.Remove,e)}else o.logger.error("Event relation info doesn't match this container")}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){const{key:t}=e.getRelation();if(!t)return;let n=this.annotationsByKey[t];n||(n=this.annotationsByKey[t]=new Set,this.sortedAnnotationsByKey.push([t,n])),n.add(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const n=e[1];return t[1].size-n.size}));const i=e.getSender();let r=this.annotationsBySender[i];r||(r=this.annotationsBySender[i]=new Set),r.add(e)}removeAnnotationFromAggregation(e){const{key:t}=e.getRelation();if(!t)return;const n=this.annotationsByKey[t];n&&(n.delete(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const n=e[1];return t[1].size-n.size})));const i=e.getSender(),r=this.annotationsBySender[i];r&&r.delete(e)}getSortedAnnotationsByKey(){return this.relationType!==a.RelationType.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==a.RelationType.Annotation?null:this.annotationsBySender}async getLastReplacement(){if(this.relationType!==a.RelationType.Replace)return null;if(!this.targetEvent)return null;const e=this.targetEvent.getServerAggregatedRelation(a.RelationType.Replace),t=null==e?void 0:e.origin_server_ts,n=this.getRelations().reduce(((e,n)=>n.getSender()!==this.targetEvent.getSender()||t&&t>n.getTs()||e&&e.getTs()>n.getTs()?e:n),null);return null!=n&&n.shouldAttemptDecryption()?await n.attemptDecryption(this.client.crypto):null!=n&&n.isBeingDecrypted()&&await n.getDecryptionPromise(),n}async setTargetEvent(e){if(!this.targetEvent){if(this.targetEvent=e,this.relationType===a.RelationType.Replace&&!this.targetEvent.isState()){const e=await this.getLastReplacement();e&&this.targetEvent.makeReplaced(e)}this.maybeEmitCreated()}}maybeEmitCreated(){this.creationEmitted||this.targetEvent&&this.relations.size&&(this.creationEmitted=!0,this.targetEvent.emit(s.MatrixEventEvent.RelationsCreated,this.relationType,this.eventType))}}t.Relations=h},2848:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMemberEvent=t.RoomMember=void 0;var r=i(n(8416)),s=n(3667),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102)),a=n(7434),l=n(5861),c=n(2481);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}let h;t.RoomMemberEvent=h,function(e){e.Membership="RoomMember.membership",e.Name="RoomMember.name",e.PowerLevel="RoomMember.powerLevel",e.Typing="RoomMember.typing"}(h||(t.RoomMemberEvent=h={}));class u extends l.TypedEventEmitter{constructor(e,t){super(),this.roomId=e,this.userId=t,(0,r.default)(this,"_isOutOfBand",!1),(0,r.default)(this,"_modified",void 0),(0,r.default)(this,"_requestedProfileInfo",void 0),(0,r.default)(this,"typing",!1),(0,r.default)(this,"name",void 0),(0,r.default)(this,"rawDisplayName",void 0),(0,r.default)(this,"powerLevel",0),(0,r.default)(this,"powerLevelNorm",0),(0,r.default)(this,"user",null),(0,r.default)(this,"membership",null),(0,r.default)(this,"disambiguate",!1),(0,r.default)(this,"events",{member:null}),this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){const n=e.getDirectionalContent().displayname;if(e.getType()!==c.EventType.RoomMember)return;this._isOutOfBand=!1,this.events.member=e;const i=this.membership;this.membership=e.getDirectionalContent().membership,void 0===this.membership&&a.logger.trace(`membership event with membership undefined (forwardLooking: ${e.forwardLooking})!`,e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=function(e,t,n){return!(!t||t===e)&&(!!o.removeHiddenChars(t)&&(!!n&&(!!p.test(t)||(!!m.test(t)||!!n.getUserIdsWithDisplayName(t).some((t=>t!==e))))))}(this.userId,n,t);const r=this.name;this.name=function(e,t,n,i){return i?o.removeDirectionOverrideChars(t)+" ("+e+")":t&&t!==e&&o.removeHiddenChars(t)?o.removeDirectionOverrideChars(t):e}(this.userId,n,0,this.disambiguate),this.rawDisplayName=o.removeDirectionOverrideChars(e.getDirectionalContent().displayname),this.rawDisplayName&&o.removeHiddenChars(this.rawDisplayName)||(this.rawDisplayName=this.userId),i!==this.membership&&(this.updateModifiedTime(),this.emit(h.Membership,e,this,i)),r!==this.name&&(this.updateModifiedTime(),this.emit(h.Name,e,this,r))}setPowerLevelEvent(e){if("m.room.power_levels"!==e.getType())return;const t=e.getDirectionalContent();let n=t.users_default||0;const i=t.users||{};Object.values(i).forEach((function(e){n=Math.max(n,e)}));const r=this.powerLevel,s=this.powerLevelNorm;void 0!==i[this.userId]&&Number.isInteger(i[this.userId])?this.powerLevel=i[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),r===this.powerLevel&&s===this.powerLevelNorm||(this.updateModifiedTime(),this.emit(h.PowerLevel,e,this))}setTypingEvent(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const n=e.getContent().user_ids;Array.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit(h.Typing,e,this)))}updateModifiedTime(){this._modified=Date.now()}getLastModifiedTime(){return this._modified}isKicked(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){const e=this.events.member;let t=e.getContent(),n=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return n}}getAvatarUrl(e,t,n,i,r=!0,o){const a=this.getMxcAvatarUrl();if(!a&&!r)return null;return(0,s.getHttpUriForMxc)(e,a,t,n,i,o)||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null}}t.RoomMember=u;const p=/@.+:.+/,m=/[\u200E\u200F\u202A-\u202F]/},6860:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomStateEvent=t.RoomState=void 0;var r,s=i(n(8416)),o=n(2848),a=n(7434),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102)),c=n(2481),d=n(4369),h=n(4702),u=n(5861),p=n(6320),m=n(771),g=n(5699);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let b;!function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished"}(r||(r={})),t.RoomStateEvent=b,function(e){e.Events="RoomState.events",e.Members="RoomState.members",e.NewMember="RoomState.newMember",e.Update="RoomState.update",e.BeaconLiveness="RoomState.BeaconLiveness",e.Marker="RoomState.Marker"}(b||(t.RoomStateEvent=b={}));class w extends u.TypedEventEmitter{constructor(e,t={status:r.NotStarted}){super(),this.roomId=e,this.oobMemberFlags=t,(0,s.default)(this,"reEmitter",new m.TypedReEmitter(this)),(0,s.default)(this,"sentinels",{}),(0,s.default)(this,"displayNameToUserIds",new Map),(0,s.default)(this,"userIdsToDisplayNames",{}),(0,s.default)(this,"tokenToInvite",{}),(0,s.default)(this,"joinedMemberCount",null),(0,s.default)(this,"summaryJoinedMemberCount",null),(0,s.default)(this,"invitedMemberCount",null),(0,s.default)(this,"summaryInvitedMemberCount",null),(0,s.default)(this,"modified",void 0),(0,s.default)(this,"members",{}),(0,s.default)(this,"events",new Map),(0,s.default)(this,"paginationToken",null),(0,s.default)(this,"beacons",new Map),(0,s.default)(this,"_liveBeaconIds",[]),this.updateModifiedTime()}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce(((e,t)=>"join"===t.membership?e+1:e),0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce(((e,t)=>"invite"===t.membership?e+1:e),0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter((t=>!e.includes(t.userId)))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;let t=this.sentinels[e];if(void 0===t){t=new o.RoomMember(this.roomId,e);const n=this.members[e];n&&t.setMembershipEvent(n.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());return this.events.get(e).get(t)||null}get hasLiveBeacons(){var e;return!(null===(e=this.liveBeaconIds)||void 0===e||!e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){const e=new w(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=r.NotStarted,Array.from(this.events.values()).forEach((t=>{e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==r.Finished&&this.getMembers().forEach((t=>{t.isOutOfBand()&&e.getMember(t.userId).markOutOfBand()})),e}setUnknownStateEvents(e){const t=e.filter((e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey())));this.setStateEvents(t)}setStateEvents(e,t){this.updateModifiedTime(),e.forEach((e=>{if(e.getRoomId()!==this.roomId)return;if(!e.isState())return;g.M_BEACON_INFO.matches(e.getType())&&this.setBeacon(e);const t=this.getStateEventMatching(e);this.setStateEvent(e),e.getType()===c.EventType.RoomMember&&(this.updateDisplayNameCache(e.getStateKey(),e.getContent().displayname),this.updateThirdPartyTokenCache(e)),this.emit(b.Events,e,this,t)})),this.onBeaconLivenessChange(),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState())if(e.getType()===c.EventType.RoomMember){const t=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const n=this.getOrCreateMember(t,e);n.setMembershipEvent(e,this),this.updateMember(n),this.emit(b.Members,e,this,n)}else if(e.getType()===c.EventType.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(this.members).forEach((t=>{const n=t.getLastModifiedTime();t.setPowerLevelEvent(e),n!==t.getLastModifiedTime()&&this.emit(b.Members,e,this,t)})),this.sentinels={}}else c.UNSTABLE_MSC2716_MARKER.matches(e.getType())&&this.emit(b.Marker,e,t)})),this.emit(b.Update,this)}processBeaconEvents(e,t){if(!e.length||!this.beacons.size)return;const n=[...this.beacons.values()].reduce(((e,t)=>y(y({},e),{},{[t.beaconInfoId]:t})),{}),i=(e,t)=>{if(!g.M_BEACON.matches(t.getType()))return;const i=n[e];i&&i.addLocations([t])};e.forEach((e=>{var r;const s=null===(r=e.getRelation())||void 0===r?void 0:r.event_id;n[s]&&(t.decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure()?e.once(d.MatrixEventEvent.Decrypted,(async()=>{i(s,e)})):i(s,e))}))}getOrCreateMember(e,t){let n=this.members[e];return n||(n=new o.RoomMember(this.roomId,e),this.members[e]=n,this.emit(b.NewMember,t,this,n)),n}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){const t=(0,p.getBeaconInfoIdentifier)(e);if(this.beacons.has(t)){const i=this.beacons.get(t);var n;return e.isRedacted()?void(i.beaconInfoId===(null===(n=e.getRedactionEvent())||void 0===n?void 0:n.redacts)&&(i.destroy(),this.beacons.delete(t))):i.update(e)}if(e.isRedacted())return;const i=new p.Beacon(e);this.reEmitter.reEmit(i,[p.BeaconEvent.New,p.BeaconEvent.Update,p.BeaconEvent.Destroy,p.BeaconEvent.LivenessChange]),this.emit(p.BeaconEvent.New,e,i),i.on(p.BeaconEvent.LivenessChange,this.onBeaconLivenessChange.bind(this)),i.on(p.BeaconEvent.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(i.identifier,i)}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter((e=>e.isLive)).map((e=>e.identifier)),this.emit(b.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var t,n;return null!==(t=null===(n=this.events.get(e.getType()))||void 0===n?void 0:n.get(e.getStateKey()))&&void 0!==t?t:null}updateMember(e){const t=this.getStateEvents(c.EventType.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===r.NotStarted}markOutOfBandMembersStarted(){this.oobMemberFlags.status===r.NotStarted&&(this.oobMemberFlags.status=r.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===r.InProgress&&(this.oobMemberFlags.status=r.NotStarted)}clearOutOfBandMembers(){let e=0;Object.keys(this.members).forEach((t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])})),a.logger.log(`LL: RoomState removed ${e} members...`),this.oobMemberFlags.status=r.NotStarted}setOutOfBandMembers(e){a.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),this.oobMemberFlags.status===r.InProgress&&(a.logger.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=r.Finished,e.forEach((e=>this.setOutOfBandMember(e))),this.emit(b.Update,this))}setOutOfBandMember(e){if(e.getType()!==c.EventType.RoomMember)return;const t=e.getStateKey(),n=this.getMember(t);if(n&&!n.isOutOfBand())return;const i=this.getOrCreateMember(t,e);i.setMembershipEvent(e,this),i.markOutOfBand(),this.updateDisplayNameCache(i.userId,i.name),this.setStateEvent(e),this.updateMember(i),this.emit(b.Members,e,this,i)}setTypingEvent(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var t;return null!==(t=this.displayNameToUserIds.get(l.removeHiddenChars(e)))&&void 0!==t?t:[]}maySendRedactionForEvent(e,t){const n=this.getMember(t);if(!n||"leave"===n.membership)return!1;if(e.status||e.isRedacted())return!1;const i=this.maySendEvent(c.EventType.RoomRedaction,t);return e.getSender()===t?i:this.hasSufficientPowerLevelFor("redact",n.powerLevel)}hasSufficientPowerLevelFor(e,t){const n=this.getStateEvents(c.EventType.RoomPowerLevels,"");let i={};n&&(i=n.getContent());let r=50;return l.isNumber(i[e])&&(r=i[e]),t>=r}maySendMessage(e){return this.maySendEventOfType(c.EventType.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,n){const i=this.getStateEvents(c.EventType.RoomPowerLevels,"");let r,s={},o=0,a=0,l=0;if(i){r=i.getContent(),s=r.events||{},o=Number.isSafeInteger(r.state_default)?r.state_default:50;const e=r.users&&r.users[t];Number.isSafeInteger(e)?l=e:Number.isSafeInteger(r.users_default)&&(l=r.users_default),Number.isSafeInteger(r.events_default)&&(a=r.events_default)}let d=n?o:a;return Number.isSafeInteger(s[e])&&(d=s[e]),l>=d}mayTriggerNotifOfType(e,t){const n=this.getMember(t);if(!n)return!1;const i=this.getStateEvents(c.EventType.RoomPowerLevels,"");let r=50;return i&&i.getContent()&&i.getContent().notifications&&l.isNumber(i.getContent().notifications[e])&&(r=i.getContent().notifications[e]),n.powerLevel>=r}getJoinRule(){var e;const t=this.getStateEvents(c.EventType.RoomJoinRules,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||h.JoinRule.Invite}getHistoryVisibility(){var e;const t=this.getStateEvents(c.EventType.RoomHistoryVisibility,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||h.HistoryVisibility.Shared}getGuestAccess(){var e;const t=this.getStateEvents(c.EventType.RoomGuestAccess,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||h.GuestAccess.Forbidden}updateThirdPartyTokenCache(e){if(!e.getContent().third_party_invite)return;const t=(e.getContent().third_party_invite.signed||{}).token;t&&this.getStateEvents(c.EventType.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}updateDisplayNameCache(e,t){const n=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],n){const t=l.removeHiddenChars(n),i=this.displayNameToUserIds.get(t);if(i){const n=i.filter((t=>t!==e));this.displayNameToUserIds.set(t,n)}}this.userIdsToDisplayNames[e]=t;const i=t&&l.removeHiddenChars(t);if(i){var r;const t=null!==(r=this.displayNameToUserIds.get(i))&&void 0!==r?r:[];t.push(e),this.displayNameToUserIds.set(i,t)}}}t.RoomState=w},5205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=void 0,t.RoomSummary=class{constructor(e,t){this.roomId=e}}},7366:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomNameType=t.RoomEvent=t.Room=t.NotificationCountType=t.KNOWN_SAFE_ROOM_VERSION=void 0;var r=i(n(8416)),s=n(3705),o=n(8910),a=n(3667),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=k(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102)),c=n(4369),d=n(8881),h=n(2848),u=n(5205),p=n(7434),m=n(771),g=n(2481),f=n(2168),v=n(7906),y=n(6860),b=n(6320),w=n(6969),S=n(5550),_=n(7286),E=n(2958);function k(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(k=function(e){return e?n:t})(e)}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.KNOWN_SAFE_ROOM_VERSION="9";const C=["1","2","3","4","5","6","7","8","9"];let A,I;t.NotificationCountType=A,function(e){e.Highlight="highlight",e.Total="total"}(A||(t.NotificationCountType=A={})),t.RoomEvent=I,function(e){e.MyMembership="Room.myMembership",e.Tags="Room.tags",e.AccountData="Room.accountData",e.Receipt="Room.receipt",e.Name="Room.name",e.Redaction="Room.redaction",e.RedactionCancelled="Room.redactionCancelled",e.LocalEchoUpdated="Room.localEchoUpdated",e.Timeline="Room.timeline",e.TimelineReset="Room.timelineReset",e.TimelineRefresh="Room.TimelineRefresh",e.OldStateUpdated="Room.OldStateUpdated",e.CurrentStateUpdated="Room.CurrentStateUpdated",e.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline"}(I||(t.RoomEvent=I={}));class R extends E.ReadReceipt{constructor(e,t,n,i={}){super(),this.roomId=e,this.client=t,this.myUserId=n,this.opts=i,(0,r.default)(this,"reEmitter",void 0),(0,r.default)(this,"txnToEvent",{}),(0,r.default)(this,"notificationCounts",{}),(0,r.default)(this,"timelineSets",void 0),(0,r.default)(this,"threadsTimelineSets",[]),(0,r.default)(this,"filteredTimelineSets",{}),(0,r.default)(this,"timelineNeedsRefresh",!1),(0,r.default)(this,"pendingEventList",void 0),(0,r.default)(this,"blacklistUnverifiedDevices",null),(0,r.default)(this,"selfMembership",null),(0,r.default)(this,"summaryHeroes",null),(0,r.default)(this,"getTypeWarning",!1),(0,r.default)(this,"getVersionWarning",!1),(0,r.default)(this,"membersPromise",void 0),(0,r.default)(this,"name",void 0),(0,r.default)(this,"normalizedName",void 0),(0,r.default)(this,"tags",{}),(0,r.default)(this,"accountData",{}),(0,r.default)(this,"summary",null),(0,r.default)(this,"storageToken",void 0),(0,r.default)(this,"timeline",void 0),(0,r.default)(this,"oldState",void 0),(0,r.default)(this,"currentState",void 0),(0,r.default)(this,"relations",new _.RelationsContainer(this.client,this)),(0,r.default)(this,"threads",new Map),(0,r.default)(this,"lastThread",void 0),(0,r.default)(this,"visibilityEvents",new Map),(0,r.default)(this,"threadTimelineSetsPromise",null),(0,r.default)(this,"threadsReady",!1),(0,r.default)(this,"applyRedaction",(e=>{if(e.isRedaction()){const t=e.event.redacts,n=this.findEventById(t);n&&(n.makeRedacted(e),n.isState()&&this.currentState.getStateEvents(n.getType(),n.getStateKey()).getId()===n.getId()&&this.currentState.setStateEvents([n]),this.emit(I.Redaction,e,this),this.visibilityEvents.delete(t),n.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e))}})),this.setMaxListeners(100),this.reEmitter=new m.TypedReEmitter(this),i.pendingEventOrdering=i.pendingEventOrdering||f.PendingEventOrdering.Chronological,this.name=e,this.timelineSets=[new s.EventTimelineSet(this,i)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[I.Timeline,I.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===f.PendingEventOrdering.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then((e=>{e.forEach((async e=>{const t=new c.MatrixEvent(e);t.getType()===g.EventType.RoomMessageEncrypted&&await t.attemptDecryption(this.client.crypto),t.setStatus(d.EventStatus.NOT_SENT),this.addPendingEvent(t,t.getTxnId())}))}))),this.opts.lazyLoadMembers?this.membersPromise=null:this.membersPromise=Promise.resolve(!1)}async createThreadsTimelineSets(){var e;if(this.threadTimelineSetsPromise)return this.threadTimelineSetsPromise;if(null!==(e=this.client)&&void 0!==e&&e.supportsExperimentalThreads())try{this.threadTimelineSetsPromise=Promise.all([this.createThreadTimelineSet(),this.createThreadTimelineSet(w.ThreadFilterType.My)]);const e=await this.threadTimelineSetsPromise;this.threadsTimelineSets.push(...e)}catch(e){this.threadTimelineSetsPromise=null}}decryptCriticalEvents(){const e=this.getEventReadUpTo(this.client.getUserId(),!0),t=this.getLiveTimeline().getEvents(),n=t.findIndex((t=>t.event.event_id===e)),i=t.slice(n).filter((e=>e.shouldAttemptDecryption())).reverse().map((e=>e.attemptDecryption(this.client.crypto,{isRetry:!0})));return Promise.allSettled(i)}decryptAllEvents(){const e=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().filter((e=>e.shouldAttemptDecryption())).reverse().map((e=>e.attemptDecryption(this.client.crypto,{isRetry:!0})));return Promise.allSettled(e)}getCreator(){var e;const t=this.currentState.getStateEvents(g.EventType.RoomCreate,"");return null!==(e=null==t?void 0:t.getContent().creator)&&void 0!==e?e:null}getVersion(){const e=this.currentState.getStateEvents(g.EventType.RoomCreate,"");if(!e)return this.getVersionWarning||(p.logger.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1";const t=e.getContent().room_version;return void 0===t?"1":t}shouldUpgradeToVersion(){return C.includes(this.getVersion())?null:"9"}async getRecommendedVersion(){let e=(await this.client.getCapabilities())["m.room_versions"];if(!e){e={default:"9",available:{}};for(const t of C)e.available[t]=f.RoomVersionStability.Stable}let t=this.checkVersionAgainstCapability(e);if(t.urgent&&t.needsUpgrade){if(p.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),e=(await this.client.getCapabilities(!0))["m.room_versions"],!e)return p.logger.warn("No room version capability - assuming upgrade required."),t;t=this.checkVersionAgainstCapability(e)}return t}checkVersionAgainstCapability(e){const t=this.getVersion();p.logger.log(`[${this.roomId}] Current version: ${t}`),p.logger.log(`[${this.roomId}] Version capability: `,e);const n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((t=>"stable"===e.available[t])).includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?p.logger.warn(`URGENT upgrade required on ${this.roomId}`):p.logger.warn(`Non-urgent upgrade required on ${this.roomId}`)),n}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(g.EventType.RoomTombstone,e)}getPendingEvents(){if(this.opts.pendingEventOrdering!==f.PendingEventOrdering.Detached)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(this.opts.pendingEventOrdering!==f.PendingEventOrdering.Detached)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);const t=l.removeElement(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}hasPendingEvent(e){return this.opts.pendingEventOrdering===f.PendingEventOrdering.Detached&&this.pendingEventList.some((t=>t.getId()===e))}getPendingEvent(e){return this.opts.pendingEventOrdering!==f.PendingEventOrdering.Detached?null:this.pendingEventList.find((t=>t.getId()===e))}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}getLastActiveTimestamp(){const e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}getMyMembership(){return this.selfMembership}getDMInviter(){if(this.myUserId){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this.selfMembership&&2==this.getInvitedAndJoinedMemberCount()&&this.summaryHeroes.length)return this.summaryHeroes[0]}guessDMUserId(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];const t=this.currentState.getMembers().find((e=>e.userId!==this.myUserId));return t?t.userId:this.myUserId}getAvatarFallbackMember(){if(this.getInvitedAndJoinedMemberCount()>2)return;const e=Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length;if(e){const e=this.summaryHeroes.map((e=>this.getMember(e))).find((e=>!!e));if(e)return e}const t=this.currentState.getMembers();if(t.length<=2){const e=t.find((e=>e.userId!==this.myUserId));if(e)return e}if(e){const e=this.summaryHeroes.map((e=>this.client.getUser(e))).find((e=>!!e));if(e){const t=new h.RoomMember(this.roomId,e.userId);return t.user=e,t}}}updateMyMembership(e){const t=this.selfMembership;this.selfMembership=e,t!==e&&("leave"===e&&this.cleanupAfterLeaving(),this.emit(I.MyMembership,this,e,t))}async loadMembersFromServer(){const e=this.client.store.getSyncToken();return(await this.client.members(this.roomId,void 0,"leave",e)).chunk}async loadMembers(){let e=!1,t=await this.client.store.getOutOfBandMembers(this.roomId);return(null===t||this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId))&&(e=!0,t=await this.loadMembersFromServer(),p.logger.log(`LL: got ${t.length} members from server for room ${this.roomId}`)),{memberEvents:t.map(this.client.getEventMapper()),fromServer:e}}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this.loadMembers().then((e=>(this.currentState.setOutOfBandMembers(e.memberEvents),this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId)&&this.client.crypto.trackRoomDevices(this.roomId),e.fromServer))).catch((e=>{throw this.membersPromise=null,this.currentState.markOutOfBandMembersFailed(),e}));return e.then((e=>{if(e){const e=this.currentState.getMembers().filter((e=>e.isOutOfBand())).map((e=>e.events.member.event));return p.logger.log(`LL: telling store to write ${e.length} members for room ${this.roomId}`),this.client.store.setOutOfBandMembers(this.roomId,e).catch((e=>{p.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((e=>{p.logger.error(e)})),this.membersPromise=e,this.membersPromise}async clearLoadedMembersIfNeeded(){this.opts.lazyLoadMembers&&this.membersPromise&&(await this.loadMembersIfNeeded(),await this.client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this.membersPromise=null)}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch((e=>{p.logger.error(`error after clearing loaded members from room ${this.roomId} after leaving`),p.logger.log(e)}))}async refreshLiveTimeline(){const e=this.getLiveTimeline(),t=e.getPaginationToken(o.EventTimeline.FORWARDS),n=e.getPaginationToken(o.EventTimeline.BACKWARDS),i=e.getEvents(),r=i[i.length-1];p.logger.log(`[refreshLiveTimeline for ${this.roomId}] at mostRecentEventInTimeline=${r&&r.getId()} liveTimelineBefore=${e.toString()} forwardPaginationToken=${t} backwardPaginationToken=${n}`);const s=this.getUnfilteredTimelineSet();let a;r?(this.resetLiveTimeline(null,null),this.emit(I.TimelineRefresh,this,s),a=await this.client.getEventTimeline(s,r.getId())):a=await this.client.getLatestTimeline(s);const l=s.getLiveTimeline();!l||null===l.getPaginationToken(o.Direction.Forward)&&null===l.getPaginationToken(o.Direction.Backward)&&0===l.getEvents().length?(p.logger.log(`[refreshLiveTimeline for ${this.roomId}] using our new live timeline`),a.setPaginationToken(t,o.EventTimeline.FORWARDS),s.setLiveTimeline(a),this.fixUpLegacyTimelineFields()):p.logger.log(`[refreshLiveTimeline for ${this.roomId}] \`/sync\` or some other request beat us to creating a new live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history.`),this.setTimelineNeedsRefresh(!1),this.emit(I.TimelineRefresh,this,s)}resetLiveTimeline(e,t){for(let n=0;n<this.timelineSets.length;n++)this.timelineSets[n].resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){const e=this.oldState,t=this.currentState;this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(o.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(o.EventTimeline.FORWARDS),e!==this.oldState&&this.emit(I.OldStateUpdated,this,e,this.oldState),t!==this.currentState&&(this.emit(I.CurrentStateUpdated,this,t,this.currentState),this.reEmitter.stopReEmitting(t,[y.RoomStateEvent.Events,y.RoomStateEvent.Members,y.RoomStateEvent.NewMember,y.RoomStateEvent.Update,y.RoomStateEvent.Marker,b.BeaconEvent.New,b.BeaconEvent.Update,b.BeaconEvent.Destroy,b.BeaconEvent.LivenessChange]),this.reEmitter.reEmit(this.currentState,[y.RoomStateEvent.Events,y.RoomStateEvent.Members,y.RoomStateEvent.NewMember,y.RoomStateEvent.Update,y.RoomStateEvent.Marker,b.BeaconEvent.New,b.BeaconEvent.Update,b.BeaconEvent.Destroy,b.BeaconEvent.LivenessChange]))}async hasUnverifiedDevices(){if(!this.client.isRoomEncrypted(this.roomId))return!1;const e=await this.getEncryptionTargetMembers();for(const t of e)if(this.client.getStoredDevicesForUser(t.userId).some((e=>e.isUnverified())))return!0;return!1}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){const t=this.findEventById(e),n=this.findThreadForEvent(t);return n?n.timelineSet.getLiveTimeline():this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){let t=this.getUnfilteredTimelineSet().findEventById(e);if(!t){const n=this.getThreads();for(let i=0;i<n.length;i++)if(t=n[i].findEventById(e),t)return t}return t}getUnreadNotificationCount(e=A.Total){return this.notificationCounts[e]}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t}setSummary(e){const t=e["m.heroes"],n=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(t)&&(this.summaryHeroes=t.filter((e=>e!==this.myUserId)))}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices}getAvatarUrl(e,t,n,i,r=!0){const s=this.currentState.getStateEvents(g.EventType.RoomAvatar,"");if(!s&&!r)return null;const o=s?s.getContent().url:null;return o?(0,a.getHttpUriForMxc)(e,o,t,n,i):null}getMxcAvatarUrl(){var e,t;return(null===(e=this.currentState.getStateEvents(g.EventType.RoomAvatar,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.url)||null}getAliases(){const e=[],t=this.currentState.getStateEvents(g.EventType.RoomAliases);if(t)for(const n of t)if(Array.isArray(n.getContent().aliases)){const t=n.getContent().aliases.filter((e=>"string"==typeof e&&"#"===e[0]&&!!e.endsWith(`:${n.getStateKey()}`)));e.push(...t)}return e}getCanonicalAlias(){const e=this.currentState.getStateEvents(g.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){const e=this.currentState.getStateEvents(g.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}addEventsToTimeline(e,t,n,i){n.getTimelineSet().addEventsToTimeline(e,t,n,i)}getThread(e){return this.threads.get(e)}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership("join")}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}async getEncryptionTargetMembers(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e}shouldEncryptForInvitedMembers(){var e;const t=this.currentState.getStateEvents(g.EventType.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){const n=this.getMember(e);return!!n&&n.membership===t}getOrCreateFilteredTimelineSet(e,{prepopulateTimeline:t=!0,useSyncEvents:n=!0,pendingEvents:i=!0}={}){if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];const r=Object.assign({filter:e,pendingEvents:i},this.opts),a=new s.EventTimelineSet(this,r);this.reEmitter.reEmit(a,[I.Timeline,I.TimelineReset]),n&&(this.filteredTimelineSets[e.filterId]=a,this.timelineSets.push(a));const l=this.getLiveTimeline();if(t){l.getEvents().forEach((function(e){a.addLiveEvent(e)}));let e=l;for(;e.getNeighbouringTimeline(o.EventTimeline.BACKWARDS);)e=e.getNeighbouringTimeline(o.EventTimeline.BACKWARDS);a.getLiveTimeline().setPaginationToken(e.getPaginationToken(o.EventTimeline.BACKWARDS),o.EventTimeline.BACKWARDS)}else if(n){const e=l.getPaginationToken(o.Direction.Forward);a.getLiveTimeline().setPaginationToken(e,o.Direction.Backward)}return a}async getThreadListFilter(e=w.ThreadFilterType.All){const t=this.client.getUserId(),n=new v.Filter(t),i={room:{timeline:{[w.FILTER_RELATED_BY_REL_TYPES.name]:[w.THREAD_RELATION_TYPE.name]}}};e===w.ThreadFilterType.My&&(i.room.timeline[w.FILTER_RELATED_BY_SENDERS.name]=[t]),n.setDefinition(i);const r=await this.client.getOrCreateFilter(`THREAD_PANEL_${this.roomId}_${e}`,n);return n.filterId=r,n}async createThreadTimelineSet(e){let t;if(w.Thread.hasServerSideSupport){const n=await this.getThreadListFilter(e);t=this.getOrCreateFilteredTimelineSet(n,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else t=new s.EventTimelineSet(this,{pendingEvents:!1}),Array.from(this.threads).forEach((([,n])=>{if(0===n.length)return;const i=n.events.some((e=>e.getSender()===this.client.getUserId()));(e!==w.ThreadFilterType.My||i)&&t.getLiveTimeline().addEvent(n.rootEvent,{toStartOfTimeline:!1})}));return t}async fetchRoomThreads(){if(this.threadsReady||!this.client.supportsExperimentalThreads())return;const e=await this.getThreadListFilter(),{chunk:t}=await this.client.createMessagesRequest(this.roomId,"",Number.MAX_SAFE_INTEGER,o.Direction.Backward,e);if(!t.length)return;const n=t.map(this.client.getEventMapper()).sort(((e,t)=>{const n=e.getServerAggregatedRelation(g.RelationType.Thread),i=t.getServerAggregatedRelation(g.RelationType.Thread);return n.latest_event.origin_server_ts-i.latest_event.origin_server_ts}));let i;const r=this.getLiveTimeline().getState(o.EventTimeline.FORWARDS);for(const e of n)this.threadsTimelineSets[0].addLiveEvent(e,{duplicateStrategy:s.DuplicateStrategy.Ignore,fromCache:!1,roomState:r}),e.getServerAggregatedRelation(g.RelationType.Thread).current_user_participated&&(this.threadsTimelineSets[1].addLiveEvent(e,{duplicateStrategy:s.DuplicateStrategy.Ignore,fromCache:!1,roomState:r}),i=e),this.getThread(e.getId())||this.createThread(e.getId(),e,[],!0);this.client.decryptEventIfNeeded(n[n.length-1]),i&&this.client.decryptEventIfNeeded(i),this.threadsReady=!0,this.on(w.ThreadEvent.NewReply,this.onThreadNewReply)}onThreadNewReply(e){for(const t of this.threadsTimelineSets)t.removeEvent(e.id),t.addLiveEvent(e.rootEvent)}removeFilteredTimelineSet(e){const t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];const n=this.timelineSets.indexOf(t);n>-1&&this.timelineSets.splice(n,1)}eventShouldLiveIn(e,t,n){var i;if(!this.client.supportsExperimentalThreads())return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||null!=n&&n.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};if(e.isRelation(w.THREAD_RELATION_TYPE.name))return{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:e.threadRootId};const r=e.getAssociatedId(),s=null!==(i=this.findEventById(r))&&void 0!==i?i:null==t?void 0:t.find((e=>e.getId()===r));return s&&(e.isRelation()||e.isRedaction())?this.eventShouldLiveIn(s,t,n):null!=n&&n.has(e.relationEventId)?{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.relationEventId}:{shouldLiveInRoom:!0,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;const{threadId:t}=this.eventShouldLiveIn(e);return t?this.getThread(t):null}addThreadedEvents(e,t,n=!1){let i=this.getThread(e);if(i)i.addEvents(t,n);else{var r;const s=null!==(r=this.findEventById(e))&&void 0!==r?r:t.find((t=>t.getId()===e));i=this.createThread(e,s,t,n),this.emit(w.ThreadEvent.Update,i)}}processThreadedEvents(e,t){e.forEach(this.applyRedaction);const n={};for(const t of e){var i;const{threadId:e,shouldLiveInThread:r}=this.eventShouldLiveIn(t);r&&!n[e]&&(n[e]=[]),null===(i=n[e])||void 0===i||i.push(t)}Object.entries(n).map((([e,n])=>this.addThreadedEvents(e,n,t)))}createThread(e,t,n=[],i){var r;if(t){const e=this.relations.getAllChildEventsForEvent(t.getId());null!=e&&e.length&&(n=n.concat(e.filter((e=>!e.isRelation(g.RelationType.Replace)))))}const s=new w.Thread(e,t,{initialEvents:n,room:this,client:this.client});return this.threads.set(s.id,s),this.reEmitter.reEmit(s,[w.ThreadEvent.Update,w.ThreadEvent.NewReply,I.Timeline,I.TimelineReset]),(!this.lastThread||(null===(r=this.lastThread.rootEvent)||void 0===r?void 0:r.localTimestamp)<(null==t?void 0:t.localTimestamp))&&(this.lastThread=s),this.emit(w.ThreadEvent.New,s,i),this.threadsReady&&this.threadsTimelineSets.forEach((e=>{s.rootEvent&&(w.Thread.hasServerSideSupport?e.addLiveEvent(s.rootEvent):e.addEventToTimeline(s.rootEvent,e.getLiveTimeline(),i))})),s}processLiveEvent(e){if(this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId)for(const t in this.txnToEvent)if(this.txnToEvent[t].getId()===e.getId()){p.logger.debug("processLiveEvent: found sent event without txn ID: ",t,e.getId());const n=e.getUnsigned();n.transaction_id=t,e.setUnsigned(n);break}}addLiveEvent(e,t){const{duplicateStrategy:n,timelineWasEmpty:i,fromCache:r}=t;for(let t=0;t<this.timelineSets.length;t++)this.timelineSets[t].addLiveEvent(e,{duplicateStrategy:n,fromCache:r,timelineWasEmpty:i});e.sender&&e.getType()!==g.EventType.RoomRedaction&&this.addReceipt((0,E.synthesizeReceipt)(e.sender.userId,e,S.ReceiptType.Read),!0)}addPendingEvent(e,t){if(e.status!==d.EventStatus.SENDING&&e.status!==d.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(o.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(o.EventTimeline.FORWARDS),!1),this.txnToEvent[t]=e,this.opts.pendingEventOrdering===f.PendingEventOrdering.Detached){if(this.pendingEventList.some((e=>e.status===d.EventStatus.NOT_SENT))&&(p.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(d.EventStatus.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var n;const t=e.event.redacts;let i=null===(n=this.pendingEventList)||void 0===n?void 0:n.find((e=>e.getId()===t));i||(i=this.findEventById(t)),i&&(i.markLocallyRedacted(e),this.emit(I.Redaction,e,this))}}else for(let t=0;t<this.timelineSets.length;t++){const n=this.timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.addEventToTimeline(e,n.getLiveTimeline(),{toStartOfTimeline:!1}):n.addEventToTimeline(e,n.getLiveTimeline(),{toStartOfTimeline:!1})}this.emit(I.LocalEchoUpdated,e,this,null,null)}savePendingEvents(){if(this.pendingEventList){const e=this.pendingEventList.map((e=>T(T({},e.event),{},{txn_id:e.getTxnId()}))).filter((e=>{const t=e.type===g.EventType.RoomMessageEncrypted,n=this.client.isRoomEncrypted(this.roomId);return t||!n}));this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent[e]}handleRemoteEcho(e,t){const n=t.getId(),i=e.getId(),r=t.status;p.logger.debug(`Got remote echo for event ${n} -> ${i} old status ${r}`),delete this.txnToEvent[e.getUnsigned().transaction_id],this.pendingEventList&&this.removePendingEvent(n),t.handleRemoteEcho(e.event);const{shouldLiveInRoom:s,threadId:o}=this.eventShouldLiveIn(e),a=this.getThread(o);if(null==a||a.timelineSet.handleRemoteEcho(t,n,i),s)for(let e=0;e<this.timelineSets.length;e++)this.timelineSets[e].handleRemoteEcho(t,n,i);this.emit(I.LocalEchoUpdated,t,this,n,r)}updatePendingEvent(e,t,n){if(p.logger.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${n}`),t==d.EventStatus.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==d.EventStatus.SENT&&this.getTimelineForEvent(n)){const t=this.findEventById(n);if(!t.getUnsigned().transaction_id){const n=t.getUnsigned();n.transaction_id=e.getTxnId(),t.setUnsigned(n),this.removeEvent(t.getId()),this.handleRemoteEcho(t,e)}return}const i=e.status,r=e.getId();if(!i)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const s=P[i];if(!s||s.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+i+"->"+t);if(e.setStatus(t),t==d.EventStatus.SENT){e.replaceLocalEventId(n);const{shouldLiveInRoom:t,threadId:i}=this.eventShouldLiveIn(e),s=this.getThread(i);if(null==s||s.timelineSet.replaceEventId(r,n),t)for(let e=0;e<this.timelineSets.length;e++)this.timelineSets[e].replaceEventId(r,n)}else if(t==d.EventStatus.CANCELLED){if(this.pendingEventList){const e=this.getPendingEvent(r);this.removePendingEvent(r),e.isRedaction()&&this.revertRedactionLocalEcho(e)}this.removeEvent(r)}this.savePendingEvents(),this.emit(I.LocalEchoUpdated,e,this,r,i)}revertRedactionLocalEcho(e){const t=e.event.redacts;if(!t)return;const n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit(I.RedactionCancelled,e,this),n.isRelation()&&this.aggregateNonLiveRelation(n))}addLiveEvents(e,t,n=!1){let i=t,r=!1;if("object"==typeof t?({duplicateStrategy:i,fromCache:n=!1,timelineWasEmpty:r}=t):void 0!==t&&p.logger.warn("Overload deprecated: `Room.addLiveEvents(events, duplicateStrategy?, fromCache?)` is deprecated in favor of the overload with `Room.addLiveEvents(events, IAddLiveEventOptions)`"),i&&-1===["replace","ignore"].indexOf(i))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(let e=0;e<this.timelineSets.length;e++){const t=this.timelineSets[e].getLiveTimeline();if(t.getPaginationToken(o.EventTimeline.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+t.getPaginationToken(o.EventTimeline.FORWARDS)+")");if(t.getNeighbouringTimeline(o.EventTimeline.FORWARDS))throw new Error(`live timeline ${e} is no longer live - it has a neighbouring timeline`)}const s=this.findThreadRoots(e),a={},l={duplicateStrategy:i,fromCache:n,timelineWasEmpty:r};for(const t of e){var c;if(this.processLiveEvent(t),t.getUnsigned().transaction_id){const e=this.txnToEvent[t.getUnsigned().transaction_id];if(e){this.handleRemoteEcho(t,e);continue}}const{shouldLiveInRoom:n,shouldLiveInThread:i,threadId:r}=this.eventShouldLiveIn(t,e,s);i&&!a[null!=r?r:""]&&(a[null!=r?r:""]=[]),null===(c=a[null!=r?r:""])||void 0===c||c.push(t),n&&this.addLiveEvent(t,l)}Object.entries(a).forEach((([e,t])=>{this.addThreadedEvents(e,t,!1)}))}partitionThreadedEvents(e){if(this.client.supportsExperimentalThreads()){const t=this.findThreadRoots(e);return e.reduce(((n,i)=>{const{shouldLiveInRoom:r,shouldLiveInThread:s,threadId:o}=this.eventShouldLiveIn(i,e,t);return r&&n[0].push(i),s&&(i.setThreadId(null!=o?o:""),n[1].push(i)),n}),[[],[]])}return[e,[]]}findThreadRoots(e){const t=new Set;for(const i of e){var n;i.isRelation(w.THREAD_RELATION_TYPE.name)&&t.add(null!==(n=i.relationEventId)&&void 0!==n?n:"")}return t}addReceipt(e,t=!1){const n=e.getContent();Object.keys(n).forEach((e=>{Object.keys(n[e]).forEach((i=>{Object.keys(n[e][i]).forEach((r=>{var s;const o=n[e][i][r],a=o.thread_id&&o.thread_id!==E.MAIN_ROOM_TIMELINE?this.threads.get(null!==(s=o.thread_id)&&void 0!==s?s:""):this;null==a||a.addReceiptToStructure(e,i,r,o,t)}))}))})),this.emit(I.Receipt,e,this)}addEphemeralEvents(e){for(const t of e)t.getType()===g.EventType.Typing?this.currentState.setTypingEvent(t):t.getType()===g.EventType.Receipt&&this.addReceipt(t)}removeEvents(e){for(let t=0;t<e.length;++t)this.removeEvent(e[t])}removeEvent(e){let t=!1;for(let n=0;n<this.timelineSets.length;n++){const i=this.timelineSets[n].removeEvent(e);i&&(i.isRedaction()&&this.revertRedactionLocalEcho(i),t=!0)}return t}recalculate(){const e=this.currentState.getStateEvents(g.EventType.RoomMember,this.myUserId);if(e){const t=e.getContent().membership;this.updateMyMembership(t),"invite"===t&&(e.getUnsigned().invite_room_state||[]).forEach((e=>{this.currentState.getStateEvents(e.type,e.state_key)||this.currentState.setStateEvents([new c.MatrixEvent({type:e.type,state_key:e.state_key,content:e.content,event_id:"$fake"+Date.now(),room_id:this.roomId,user_id:this.myUserId})])}))}const t=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,l.normalize)(this.name),this.summary=new u.RoomSummary(this.roomId,{title:this.name}),t!==this.name&&this.emit(I.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(I.Tags,e,this)}addAccountData(e){for(let t=0;t<e.length;t++){const n=e[t];"m.tag"===n.getType()&&this.addTags(n);const i=this.accountData[n.getType()];this.accountData[n.getType()]=n,this.emit(I.AccountData,n,this,i)}}getAccountData(e){return this.accountData[e]}maySendMessage(){return"join"===this.getMyMembership()&&(this.client.isRoomEncrypted(this.roomId)?this.currentState.maySendEvent(g.EventType.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(g.EventType.RoomMessage,this.myUserId))}canInvite(e){let t="join"===this.getMyMembership();const n=this.currentState.getStateEvents(g.EventType.RoomPowerLevels,""),i=n&&n.getContent(),r=this.getMember(e);return i&&r&&i.invite>r.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){const e=this.currentState.getStateEvents(g.EventType.RoomCreate,"");if(e)return e.getContent()[g.RoomCreateTypeField];this.getTypeWarning||(p.logger.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===g.RoomType.Space}isCallRoom(){return this.getType()===g.RoomType.UnstableCall}isElementVideoRoom(){return this.getType()===g.RoomType.ElementVideo}roomNameGenerator(e){if(this.client.roomNameGenerator){const t=this.client.roomNameGenerator(this.roomId,e);if(null!==t)return t}switch(e.type){case O.Actual:return e.name;case O.Generated:return"Inviting"===e.subtype?`Inviting ${M(e.names,e.count)}`:M(e.names,e.count);case O.EmptyRoom:return e.oldName?`Empty room (was ${e.oldName})`:"Empty room"}}calculateRoomName(e,t=!1){if(!t){const e=this.currentState.getStateEvents(g.EventType.RoomName,"");if(null!=e&&e.getContent().name)return this.roomNameGenerator({type:O.Actual,name:e.getContent().name})}const n=this.getCanonicalAlias();if(n)return this.roomNameGenerator({type:O.Actual,name:n});let i=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1,r=[];const s=this.currentState.getStateEvents(g.UNSTABLE_ELEMENT_FUNCTIONAL_USERS.name,"");Array.isArray(null==s?void 0:s.getContent().service_members)&&(r=s.getContent().service_members);let o=null;if(this.summaryHeroes)o=[],this.summaryHeroes.forEach((e=>{if(r.includes(e))return void i--;const t=this.getMember(e);o.push(t?t.name:e)}));else{let t=this.currentState.getMembers().filter((t=>t.userId!==e&&("invite"===t.membership||"join"===t.membership)));t=t.filter((({userId:e})=>!r.includes(e)||(i--,!1))),t.sort(((e,t)=>l.compare(e.userId,t.userId))),t=t.slice(0,5),o=t.map((e=>e.name))}if(i)return this.roomNameGenerator({type:O.Generated,names:o,count:i});if("join"==this.getMyMembership()){const e=this.currentState.getStateEvents(g.EventType.RoomThirdPartyInvite);if(null!=e&&e.length){const t=e.map((e=>e.getContent().display_name));return this.roomNameGenerator({type:O.Generated,subtype:"Inviting",names:t,count:t.length+1})}}let a,c=o;return c.length||(c=this.currentState.getMembers().filter((t=>t.userId!==e&&"invite"!==t.membership&&"join"!==t.membership)).map((e=>e.name))),c.length&&(a=this.roomNameGenerator({type:O.Generated,names:c,count:c.length+1})),this.roomNameGenerator({type:O.EmptyRoom,oldName:a})}applyNewVisibilityEvent(e){const t=e.asVisibilityChange();if(!t)return;const n=e.getSender();if(!n)return;if(!(g.EVENT_VISIBILITY_CHANGE_TYPE.name&&this.currentState.maySendStateEvent(g.EVENT_VISIBILITY_CHANGE_TYPE.name,n)||g.EVENT_VISIBILITY_CHANGE_TYPE.altName&&this.currentState.maySendStateEvent(g.EVENT_VISIBILITY_CHANGE_TYPE.altName,n)))return;const i=this.visibilityEvents.get(t.eventId);if(i){let t=i.length-1;const n=Math.max(0,i.length-30);for(;t>=n&&!(i[t].getTs()<e.getTs());--t);-1===t?i.unshift(e):i.splice(t+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);const r=this.findEventById(t.eventId);r&&r.applyVisibilityEvent(t)}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");const t=e.getRelation().event_id,n=this.visibilityEvents.get(t);if(!n)return;const i=n.findIndex((t=>t.getId()===e.getId()));if(-1!==i&&(n.splice(i,1),i===n.length)){const e=this.findEventById(t);if(!e)return;if(0===i)this.visibilityEvents.delete(t),e.applyVisibilityEvent();else{const t=n[n.length-1].asVisibilityChange();if(!t)throw new Error("at this stage, visibility changes should be well-formed");e.applyVisibilityEvent(t)}}}applyPendingVisibilityEvents(e){const t=this.visibilityEvents.get(e.getId());if(!t||0==t.length)return;const n=t[t.length-1],i=n.asVisibilityChange();i&&(i.visible,n.getTs()<e.getTs()||e.applyVisibilityEvent(i))}}t.Room=R;const P={[d.EventStatus.ENCRYPTING]:[d.EventStatus.SENDING,d.EventStatus.NOT_SENT,d.EventStatus.CANCELLED],[d.EventStatus.SENDING]:[d.EventStatus.ENCRYPTING,d.EventStatus.QUEUED,d.EventStatus.NOT_SENT,d.EventStatus.SENT],[d.EventStatus.QUEUED]:[d.EventStatus.SENDING,d.EventStatus.CANCELLED],[d.EventStatus.SENT]:[],[d.EventStatus.NOT_SENT]:[d.EventStatus.SENDING,d.EventStatus.QUEUED,d.EventStatus.CANCELLED],[d.EventStatus.CANCELLED]:[]};let O;function M(e,t){const n=t-1;return e.length?1===e.length&&n<=1?e[0]:2===e.length&&n<=2?`${e[0]} and ${e[1]}`:n>1?`${e[0]} and ${n} others`:`${e[0]} and 1 other`:"Empty room"}t.RoomNameType=O,function(e){e[e.EmptyRoom=0]="EmptyRoom",e[e.Generated=1]="Generated",e[e.Actual=2]="Actual"}(O||(t.RoomNameType=O={}))},1398:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=void 0;var i=n(3558);class r{static fromJson(e,t){const n=e.context||{};let s=(n.events_before||[]).map(t),o=(n.events_after||[]).map(t);const a=new i.EventContext(t(e.result)),l=a.ourEvent.threadRootId;return s=s.filter((e=>e.threadRootId===l)),o=o.filter((e=>e.threadRootId===l)),a.setPaginateToken(n.start,!0),a.addEvents(s,!0),a.addEvents(o,!1),a.setPaginateToken(n.end,!1),new r(e.rank,a)}constructor(e,t){this.rank=e,this.context=t}}t.SearchResult=r},6969:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadFilterType=t.ThreadEvent=t.Thread=t.THREAD_RELATION_TYPE=t.FILTER_RELATED_BY_SENDERS=t.FILTER_RELATED_BY_REL_TYPES=void 0;var r=i(n(8416)),s=n(8070),o=n(771),a=n(4369),l=n(8910),c=n(3705),d=n(7048),h=n(7434),u=n(2958);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}let m;t.ThreadEvent=m,function(e){e.New="Thread.new",e.Update="Thread.update",e.NewReply="Thread.newReply",e.ViewThread="Thread.viewThread"}(m||(t.ThreadEvent=m={}));class g extends u.ReadReceipt{constructor(e,t,n){var i;if(super(),this.id=e,this.rootEvent=t,(0,r.default)(this,"timelineSet",void 0),(0,r.default)(this,"_currentUserParticipated",!1),(0,r.default)(this,"reEmitter",void 0),(0,r.default)(this,"lastEvent",void 0),(0,r.default)(this,"replyCount",0),(0,r.default)(this,"room",void 0),(0,r.default)(this,"client",void 0),(0,r.default)(this,"initialEventsFetched",!g.hasServerSideSupport),(0,r.default)(this,"onBeforeRedaction",((e,t)=>{null!=e&&e.isRelation(y.name)&&this.room.eventShouldLiveIn(e).threadId===this.id&&e.getId()!==this.id&&!t.status&&(this.replyCount--,this.emit(m.Update,this))})),(0,r.default)(this,"onRedaction",(e=>{var t;if(e.threadRootId!==this.id)return;const n=[...this.timelineSet.getLiveTimeline().getEvents()].reverse();this.lastEvent=null!==(t=n.find((e=>!e.isRedacted()&&e.isRelation(y.name))))&&void 0!==t?t:this.rootEvent,this.emit(m.Update,this)})),(0,r.default)(this,"onEcho",(e=>{if(e.threadRootId!==this.id)return;if(this.lastEvent===e)return;if(!e.isRelation(y.name))return;const t=e.isRelation(y.name);(!this.lastEvent||this.lastEvent.isRedacted()||t&&e.getId()!==this.lastEvent.getId()&&e.localTimestamp>this.lastEvent.localTimestamp)&&(this.lastEvent=e,this.lastEvent.getId()!==this.id&&(g.hasServerSideSupport&&this.replyCount++,this.emit(m.NewReply,this,e))),this.emit(m.Update,this)})),null==n||!n.room)throw new Error("element-web#22141: A thread requires a room in order to function");this.room=n.room,this.client=n.client,this.timelineSet=new c.EventTimelineSet(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new o.TypedReEmitter(this),this.reEmitter.reEmit(this.timelineSet,[s.RoomEvent.Timeline,s.RoomEvent.TimelineReset]),this.room.on(s.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.room.on(s.RoomEvent.Redaction,this.onRedaction),this.room.on(s.RoomEvent.LocalEchoUpdated,this.onEcho),this.timelineSet.on(s.RoomEvent.Timeline,this.onEcho),n.initialEvents&&this.addEvents(n.initialEvents,!1),this.initialiseThread(),null===(i=this.rootEvent)||void 0===i||i.setThread(this)}async fetchRootEvent(){var e;this.rootEvent=this.room.findEventById(this.id);try{const e=await this.client.fetchRoomEvent(this.roomId,this.id),t=this.client.getEventMapper();this.rootEvent=t(e)}catch(e){h.logger.error("Failed to fetch thread root to construct thread with",e)}null===(e=this.rootEvent)||void 0===e||e.setThread(this),this.emit(m.Update,this)}static setServerSideSupport(e,t){g.hasServerSideSupport=e,t||(f.setPreferUnstable(!0),v.setPreferUnstable(!0),y.setPreferUnstable(!0))}get roomState(){return this.room.getLiveTimeline().getState(l.EventTimeline.FORWARDS)}addEventToTimeline(e,t){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:t,fromCache:!1,roomState:this.roomState})}addEvents(e,t){e.forEach((e=>this.addEvent(e,t,!1))),this.emit(m.Update,this)}addEvent(e,t,n=!0){var i;if(e.setThread(this),this._currentUserParticipated||e.getSender()!==this.client.getUserId()||(this._currentUserParticipated=!0),g.hasServerSideSupport){if(!t&&this.initialEventsFetched&&e.localTimestamp>(null===(i=this.lastReply())||void 0===i?void 0:i.localTimestamp))this.fetchEditsWhereNeeded(e),this.addEventToTimeline(e,!1);else if(e.isRelation(s.RelationType.Annotation)||e.isRelation(s.RelationType.Replace))return this.timelineSet.relations.aggregateParentEvent(e),void this.timelineSet.relations.aggregateChildEvent(e,this.timelineSet)}else this.addEventToTimeline(e,t),this.client.decryptEventIfNeeded(e,{});g.hasServerSideSupport&&this.rootEvent||!e.isRelation(y.name)||this.replyCount++,n&&this.emit(m.Update,this)}getRootEventBundledRelationship(e=this.rootEvent){return null==e?void 0:e.getServerAggregatedRelation(y.name)}async initialiseThread(){let e=this.getRootEventBundledRelationship();if(g.hasServerSideSupport&&!e&&(await this.fetchRootEvent(),e=this.getRootEventBundledRelationship()),g.hasServerSideSupport&&e){this.replyCount=e.count,this._currentUserParticipated=e.current_user_participated;const t=new a.MatrixEvent(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({room_id:this.rootEvent.getRoomId()},e.latest_event));this.setEventMetadata(t),t.setThread(this),this.lastEvent=t,this.fetchEditsWhereNeeded(t)}this.emit(m.Update,this)}async fetchEditsWhereNeeded(...e){return Promise.all(e.filter((e=>e.isEncrypted())).map((e=>{if(!e.isRelation())return this.client.relations(this.roomId,e.getId(),s.RelationType.Replace,e.getType(),{limit:1}).then((t=>{t.events.length&&e.makeReplaced(t.events[0])})).catch((e=>{h.logger.error("Failed to load edits for encrypted thread event",e)}))})))}async fetchInitialEvents(){this.initialEventsFetched||(await this.fetchEvents(),this.initialEventsFetched=!0)}setEventMetadata(e){l.EventTimeline.setEventMetadata(e,this.roomState,!1),e.setThread(this)}findEventById(e){var t;return(null===(t=this.lastEvent)||void 0===t?void 0:t.getId())===e?this.lastEvent:this.timelineSet.findEventById(e)}lastReply(e=(()=>!0)){for(let t=this.events.length-1;t>=0;t--){const n=this.events[t];if(e(n))return n}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount}get replyToEvent(){var e;return null!==(e=this.lastEvent)&&void 0!==e?e:this.lastReply()}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof a.MatrixEvent}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}async fetchEvents(e={limit:20,direction:l.Direction.Backward}){var t;let{originalEvent:n,events:i,prevBatch:r,nextBatch:s}=await this.client.relations(this.room.roomId,this.id,y.name,null,e);e.to||s||(i=[...i,n]),await this.fetchEditsWhereNeeded(...i),await Promise.all(i.map((e=>(this.setEventMetadata(e),this.client.decryptEventIfNeeded(e)))));const o=(null!==(t=e.direction)&&void 0!==t?t:l.Direction.Backward)===l.Direction.Backward;return this.timelineSet.addEventsToTimeline(i,o,this.liveTimeline,o?s:r),{originalEvent:n,events:i,prevBatch:r,nextBatch:s}}getUnfilteredTimelineSet(){return this.timelineSet}get timeline(){return this.events}addReceipt(e,t){throw new Error("Unsupported function on the thread model")}}t.Thread=g,(0,r.default)(g,"hasServerSideSupport",void 0);const f=new d.ServerControlledNamespacedValue("related_by_senders","io.element.relation_senders");t.FILTER_RELATED_BY_SENDERS=f;const v=new d.ServerControlledNamespacedValue("related_by_rel_types","io.element.relation_types");t.FILTER_RELATED_BY_REL_TYPES=v;const y=new d.ServerControlledNamespacedValue("m.thread","io.element.thread");let b;t.THREAD_RELATION_TYPE=y,t.ThreadFilterType=b,function(e){e[e.My=0]="My",e[e.All=1]="All"}(b||(t.ThreadFilterType=b={}))},5861:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypedEventEmitter=t.EventEmitterEvents=void 0;var i=n(7187);let r;t.EventEmitterEvents=r,function(e){e.NewListener="newListener",e.RemoveListener="removeListener",e.Error="error"}(r||(t.EventEmitterEvents=r={}));class s extends i.EventEmitter{addListener(e,t){return super.addListener(e,t)}emit(e,...t){return super.emit(e,...t)}eventNames(){return super.eventNames()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,t){return super.off(e,t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}rawListeners(e){return super.rawListeners(e)}}t.TypedEventEmitter=s},3998:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.UserEvent=t.User=void 0;var r=i(n(8416)),s=n(5861);let o;t.UserEvent=o,function(e){e.DisplayName="User.displayName",e.AvatarUrl="User.avatarUrl",e.Presence="User.presence",e.CurrentlyActive="User.currentlyActive",e.LastPresenceTs="User.lastPresenceTs"}(o||(t.UserEvent=o={}));class a extends s.TypedEventEmitter{constructor(e){super(),this.userId=e,(0,r.default)(this,"modified",void 0),(0,r.default)(this,"displayName",void 0),(0,r.default)(this,"rawDisplayName",void 0),(0,r.default)(this,"avatarUrl",void 0),(0,r.default)(this,"presenceStatusMsg",null),(0,r.default)(this,"presence","offline"),(0,r.default)(this,"lastActiveAgo",0),(0,r.default)(this,"lastPresenceTs",0),(0,r.default)(this,"currentlyActive",!1),(0,r.default)(this,"events",{presence:null,profile:null}),this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.updateModifiedTime()}setPresenceEvent(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const n=[];(e.getContent().presence!==this.presence||t)&&n.push(o.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push(o.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push(o.DisplayName),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push(o.CurrentlyActive),this.presence=e.getContent().presence,n.push(o.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(let t=0;t<n.length;t++)this.emit(n[t],e,this)}setDisplayName(e){const t=this.displayName;this.displayName="string"==typeof e?e:void 0,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName="string"==typeof e?e:void 0}setAvatarUrl(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}t.User=a},1707:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=void 0;var r=i(n(8416)),s=n(3102),o=n(7434),a=n(1470),l=n(2481);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const h=[a.PushRuleKind.Override,a.PushRuleKind.ContentSpecific,a.PushRuleKind.RoomSpecific,a.PushRuleKind.SenderSpecific,a.PushRuleKind.Underride],u=[{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:a.ConditionKind.EventMatch,key:"type",pattern:"m.reaction"}],actions:[a.PushRuleActionName.DontNotify]},{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:a.ConditionKind.EventMatch,key:"type",pattern:l.EventType.RoomServerAcl},{kind:a.ConditionKind.EventMatch,key:"state_key",pattern:""}],actions:[]}];class p{constructor(e){this.client=e}static actionListToActionsObject(e){const t={notify:!1,tweaks:{}};for(let n=0;n<e.length;++n){const i=e[n];i===a.PushRuleActionName.Notify?t.notify=!0:"object"==typeof i&&(void 0===i.value&&(i.value=!0),t.tweaks[i.set_tweak]=i.value)}return t}static rewriteDefaultRules(e){let t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);const n=t.global.override;for(const e of u){const t=n.find((t=>t.rule_id===e.rule_id));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{const t=e.rule_id;o.logger.warn(`Adding default global override for ${t}`),n.push(e)}}return t}matchingRuleFromKindSet(e,t){for(let n=0;n<h.length;++n){const i=h[n],r=t[i];if(r)for(let t=0;t<r.length;++t){const n=r[t];if(!n.enabled)continue;const s=this.templateRuleToRaw(i,n);if(s&&this.ruleMatchesEvent(s,e))return d(d({},n),{},{kind:i})}}return null}templateRuleToRaw(e,t){const n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case a.PushRuleKind.Underride:case a.PushRuleKind.Override:n.conditions=t.conditions;break;case a.PushRuleKind.RoomSpecific:if(!t.rule_id)return null;n.conditions.push({kind:a.ConditionKind.EventMatch,key:"room_id",value:t.rule_id});break;case a.PushRuleKind.SenderSpecific:if(!t.rule_id)return null;n.conditions.push({kind:a.ConditionKind.EventMatch,key:"user_id",value:t.rule_id});break;case a.PushRuleKind.ContentSpecific:if(!t.pattern)return null;n.conditions.push({kind:a.ConditionKind.EventMatch,key:"content.body",pattern:t.pattern})}return n}eventFulfillsCondition(e,t){switch(e.kind){case a.ConditionKind.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case a.ConditionKind.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case a.ConditionKind.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case a.ConditionKind.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t)}return!1}eventFulfillsSenderNotifPermCondition(e,t){const n=e.key;if(!n)return!1;const i=this.client.getRoom(t.getRoomId());return!(null==i||!i.currentState)&&i.currentState.mayTriggerNotifOfType(n,t.getSender())}eventFulfillsRoomMemberCountCondition(e,t){if(!e.is)return!1;const n=this.client.getRoom(t.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;const i=n.currentState.getJoinedMemberCount(),r=e.is.match(/^([=<>]*)(\d*)$/);if(!r)return!1;const s=r[1],o=parseInt(r[2]);if(isNaN(o))return!1;switch(s){case"":case"==":return i==o;case"<":return i<o;case">":return i>o;case"<=":return i<=o;case">=":return i>=o;default:return!1}}eventFulfillsDisplayNameCondition(e,t){let n=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(n=t.getClearContent()),!n||!n.body||"string"!=typeof n.body)return!1;const i=this.client.getRoom(t.getRoomId());if(!(i&&i.currentState&&i.currentState.members&&i.currentState.getMember(this.client.credentials.userId)))return!1;const r=i.currentState.getMember(this.client.credentials.userId).name,o=new RegExp("(^|\\W)"+(0,s.escapeRegExp)(r)+"(\\W|$)","i");return n.body.search(o)>-1}eventFulfillsEventMatchCondition(e,t){if(!e.key)return!1;const n=this.valueForDottedKey(e.key,t);if("string"!=typeof n)return!1;if(e.value)return e.value===n;if("string"!=typeof e.pattern)return!1;const i="content.body"===e.key?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$");return!!n.match(i)}createCachedRegex(e,t,n){return p.cachedGlobToRegex[t]||(p.cachedGlobToRegex[t]=new RegExp(e+(0,s.globToRegexp)(t)+n,"i")),p.cachedGlobToRegex[t]}valueForDottedKey(e,t){const n=e.split(".");let i;const r=n[0];for("content"===r?(i=t.getContent(),n.shift()):"type"===r?(i=t.getType(),n.shift()):i=t.event;n.length>0;){const e=n.shift();if((0,s.isNullOrUndefined)(i[e]))return null;i=i[e]}return i}matchingRuleForEventWithRulesets(e,t){return t?e.getSender()===this.client.credentials.userId?null:this.matchingRuleFromKindSet(e,t.global):null}pushActionsForEventAndRulesets(e,t){const n=this.matchingRuleForEventWithRulesets(e,t);if(!n)return{};const i=p.actionListToActionsObject(n.actions);return void 0===i.tweaks.highlight&&(i.tweaks.highlight=n.kind==a.PushRuleKind.ContentSpecific),i}ruleMatchesEvent(e,t){var n;if(null===(n=e.conditions)||void 0===n||!n.length)return!0;let i=!0;for(let n=0;n<e.conditions.length;++n){const r=e.conditions[n];i&=this.eventFulfillsCondition(r,t)}return i}actionsForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){for(const t of["global"])if(void 0!==this.client.pushRules[t])for(const n of h)if(void 0!==this.client.pushRules[t][n])for(const i of this.client.pushRules[t][n])if(i.rule_id===e)return i;return null}}t.PushProcessor=p,(0,r.default)(p,"cachedGlobToRegex",{})},8401:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomLowercaseString=function(e){return r(e,n)},t.randomString=function(e){return r(e,i+n+"0123456789")},t.randomUppercaseString=function(e){return r(e,i)};const n="abcdefghijklmnopqrstuvwxyz",i="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function r(e,t){let n="";for(let i=0;i<e;++i)n+=t.charAt(Math.floor(Math.random()*t.length));return n}},2731:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearTimeout=function(e){if(0===o.length)return;let t;for(t=0;t<o.length;t++)if(o[t].key==e){o.splice(t,1);break}0===t&&a()},t.setTimeout=function(e,t,...n){(t=t||0)<0&&(t=0);const i=Date.now()+t,r=s++,l={runAt:i,func:e,params:n,key:r},c=function(e,t){let n=0,r=e.length;for(;n<r;){const t=n+r>>1;e[t].runAt-i>0?r=t:n=t+1}return n}(o);return o.splice(c,0,l),a(),r};var i=n(7434);let r,s=0;const o=[];function a(){r&&n.g.clearTimeout(r);const e=o[0];if(!e)return;const t=Date.now(),i=Math.min(e.runAt-t,1e3);r=n.g.setTimeout(l,i)}function l(){let e;const t=Date.now(),r=[];for(;;){const n=o[0];if(!n||n.runAt>t)break;e=o.shift(),e.key,r.push(e)}a();for(let t=0;t<r.length;t++){e=r[t];try{e.func.apply(n.g,e.params)}catch(e){i.logger.error("Uncaught exception in callback function",e.stack||e)}}}},9443:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=void 0;var r=i(n(8416)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102)),o=(n(7434),n(2481));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}class l{static RETRY_BACKOFF_RATELIMIT(e,t,n){if(400===n.httpStatus||403===n.httpStatus||401===n.httpStatus)return-1;if("rejected"===n.cors)return-1;if("M_TOO_LARGE"===n.name)return-1;if("M_LIMIT_EXCEEDED"===n.name){const e=n.data.retry_after_ms;if(e>0)return e}return t>4?-1:1e3*Math.pow(2,t)}static QUEUE_MESSAGES(e){return e.getType()===o.EventType.RoomMessage||e.hasAssocation()?"message":null}constructor(e=l.RETRY_BACKOFF_RATELIMIT,t=l.QUEUE_MESSAGES){this.retryAlgorithm=e,this.queueAlgorithm=t,(0,r.default)(this,"queues",{}),(0,r.default)(this,"activeQueues",[]),(0,r.default)(this,"procFn",null),(0,r.default)(this,"processQueue",(e=>{const t=this.peekNextEvent(e);if(!t){const t=this.activeQueues.indexOf(e);return t>=0&&this.activeQueues.splice(t,1),void c()}c(this.queues[e].length),Promise.resolve().then((()=>this.procFn(t.event))).then((n=>{this.removeNextEvent(e),c(t.event.getId()),t.defer.resolve(n),this.processQueue(e)}),(n=>{t.attempts+=1;const i=this.retryAlgorithm(t.event,t.attempts,n);c(t.attempts,t.event.getId()),-1===i?(c(t.event.getId()),this.removeNextEvent(e),t.defer.reject(n),this.processQueue(e)):setTimeout(this.processQueue,i,e)}))}))}getQueueForEvent(e){const t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map((function(e){return e.event})):null}removeEventFromQueue(e){const t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;let n=!1;return s.removeElement(this.queues[t],(t=>{if(t.event.getId()===e.getId())return n=!0,!0})),n}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){const t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);const n=s.defer();return this.queues[t].push({event:e,defer:n,attempts:0}),c(e.getId()),this.startProcessingQueues(),n.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter((e=>-1===this.activeQueues.indexOf(e)&&this.queues[e].length>0)).forEach((e=>{this.activeQueues.push(e),c(),this.processQueue(e)}))}peekNextEvent(e){const t=this.queues[e];return Array.isArray(t)?t[0]:null}removeNextEvent(e){const t=this.queues[e];return Array.isArray(t)?t.shift():null}}function c(...e){}t.MatrixScheduler=l},1415:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0,t.SERVICE_TYPES=n,function(e){e.IS="SERVICE_TYPE_IS",e.IM="SERVICE_TYPE_IM"}(n||(t.SERVICE_TYPES=n={}))},11:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SlidingSyncSdk=void 0;var r=i(n(8416)),s=n(7366),o=n(7434),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102)),l=n(8910),c=n(2168),d=n(4551),h=n(7715),u=n(2443),p=n(8070),m=n(1707);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}class f{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return u.ExtensionState.PreProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){if(e.device_lists&&await this.crypto.handleDeviceListChanges({oldSyncToken:"yep"},e.device_lists),e.device_one_time_keys_count){const t=e.device_one_time_keys_count.signed_curve25519||0;this.crypto.updateOneTimeKeyCount(t)}if(e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]){const t=e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"];this.crypto.setNeedsNewFallback(t instanceof Array&&!t.includes("signed_curve25519"))}}}class v{constructor(e){this.client=e,(0,r.default)(this,"nextBatch",null)}name(){return"to_device"}when(){return u.ExtensionState.PreProcess}onRequest(e){const t={since:null!==this.nextBatch?this.nextBatch:void 0};return e&&(t.limit=100,t.enabled=!0),t}async onResponse(e){const t=[];e.events=e.events||[],e.events.map(this.client.getEventMapper()).map((e=>{if("m.key.verification.cancel"===e.getType()){const n=e.getContent().transaction_id;n&&t.push(n)}return e})).forEach((e=>{const n=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=n.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){const i=n.transaction_id;t.includes(i)&&e.flagCancelled()}this.client.emit(c.ClientEvent.ToDeviceEvent,e)}else o.logger.log("Ignoring undecryptable to-device event from "+e.getSender())})),this.nextBatch=e.next_batch}}class y{constructor(e){this.client=e}name(){return"account_data"}when(){return u.ExtensionState.PostProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){e.global&&e.global.length>0&&this.processGlobalAccountData(e.global);for(const t in e.rooms){const n=b(this.client,t,e.rooms[t]),i=this.client.getRoom(t);i?(i.addAccountData(n),n.forEach((e=>{this.client.emit(c.ClientEvent.Event,e)}))):o.logger.warn("got account data for room but room doesn't exist on client:",t)}}processGlobalAccountData(e){const t=b(this.client,void 0,e),n=t.reduce(((e,t)=>(e[t.getId()]=this.client.store.getAccountData(t.getType()),e)),{});this.client.store.storeAccountDataEvents(t),t.forEach((e=>{if(e.getType()===p.EventType.PushRules){const t=e.getContent();this.client.pushRules=m.PushProcessor.rewriteDefaultRules(t)}const t=n[e.getId()];return this.client.emit(c.ClientEvent.AccountData,e,t),e}))}}function b(e,t,n,i=!0){const r=e.getEventMapper({decrypt:i});return n.map((function(e){return e.room_id=t,r(e)}))}t.SlidingSyncSdk=class{constructor(e,t,n={}){var i;this.slidingSync=e,this.client=t,this.opts=n,(0,r.default)(this,"syncState",null),(0,r.default)(this,"syncStateData",void 0),(0,r.default)(this,"lastPos",null),(0,r.default)(this,"failCount",0),(0,r.default)(this,"notifEvents",[]),this.opts.initialSyncLimit=null!==(i=this.opts.initialSyncLimit)&&void 0!==i?i:8,this.opts.resolveInvitesToProfiles=this.opts.resolveInvitesToProfiles||!1,this.opts.pollTimeout=this.opts.pollTimeout||3e4,this.opts.pendingEventOrdering=this.opts.pendingEventOrdering||c.PendingEventOrdering.Chronological,this.opts.experimentalThreadSupport=!0===this.opts.experimentalThreadSupport,n.canResetEntireTimeline||(n.canResetEntireTimeline=e=>!1),t.getNotifTimelineSet()&&t.reEmitter.reEmit(t.getNotifTimelineSet(),[s.RoomEvent.Timeline,s.RoomEvent.TimelineReset]),this.slidingSync.on(u.SlidingSyncEvent.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(u.SlidingSyncEvent.RoomData,this.onRoomData.bind(this));const o=[new v(this.client),new y(this.client)];this.opts.crypto&&o.push(new f(this.opts.crypto)),o.forEach((e=>{this.slidingSync.registerExtension(e)}))}onRoomData(e,t){let n=this.client.store.getRoom(e);if(!n){if(!t.initial)return void o.logger.debug("initial flag not set but no stored room exists for room ",e,t);n=(0,d._createAndReEmitRoom)(this.client,e,this.opts)}this.processRoomData(this.client,n,t)}onLifecycle(e,t,n){switch(n&&o.logger.debug("onLifecycle",e,n),e){case u.SlidingSyncState.Complete:if(this.purgeNotifications(),!t)break;this.lastPos||this.updateSyncState(d.SyncState.Prepared,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(d.SyncState.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.lastPos=t.pos;break;case u.SlidingSyncState.RequestFinished:if(n){if(this.failCount+=1,this.updateSyncState(this.failCount>3?d.SyncState.Error:d.SyncState.Reconnecting,{error:new h.MatrixError(n)}),this.shouldAbortSync(new h.MatrixError(n)))return}else this.failCount=0}}async syncLeftRooms(){return[]}async peek(e){return null}stopPeeking(){}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(o.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(d.SyncState.Error,{error:e}),!0)}async processRoomData(e,t,n){n=function(e,t,n){if(!n.name)return n;for(const e of n.required_state)if(e.type===p.EventType.RoomName&&""===e.state_key)return e.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+t,state_key:"",type:p.EventType.RoomName,content:{name:n.name},sender:e.getUserId(),origin_server_ts:(new Date).getTime()}),n}(e,t.roomId,n);const i=b(this.client,t.roomId,n.required_state);let r=b(this.client,t.roomId,n.timeline,!1);const o=[];if(n.initial){const e=new Set;t.getLiveTimeline().getEvents().forEach((t=>{e.add(t.getId())}));const i=[],s=[];let o=!1;for(let t=r.length-1;t>=0;t--){const n=r[t];e.has(n.getId())?o=!0:o?i.push(n):s.unshift(n)}r=s,i.length>0&&t.addEventsToTimeline(i,!0,t.getLiveTimeline(),n.prev_batch)}const d=this.client.isRoomEncrypted(t.roomId);if(null!=n.notification_count&&t.setUnreadNotificationCount(s.NotificationCountType.Total,n.notification_count),null!=n.highlight_count&&(!d||d&&t.getUnreadNotificationCount(s.NotificationCountType.Highlight)<=0)&&t.setUnreadNotificationCount(s.NotificationCountType.Highlight,n.highlight_count),Number.isInteger(n.invited_count)&&t.currentState.setInvitedMemberCount(n.invited_count),Number.isInteger(n.joined_count)&&t.currentState.setJoinedMemberCount(n.joined_count),n.invite_state){const e=b(this.client,t.roomId,n.invite_state);return this.processRoomEvents(t,e),n.initial&&(t.recalculate(),this.client.store.storeRoom(t),this.client.emit(c.ClientEvent.Room,t)),e.forEach((e=>{this.client.emit(c.ClientEvent.Event,e)})),void t.updateMyMembership("invite")}n.initial&&t.getLiveTimeline().setPaginationToken(n.prev_batch,l.EventTimeline.BACKWARDS),this.processRoomEvents(t,i,r,!1),t.addEphemeralEvents(o),t.updateMyMembership("join"),t.recalculate(),n.initial&&(e.store.storeRoom(t),e.emit(c.ClientEvent.Room,t)),this.addNotifications(r);const h=async t=>{e.emit(c.ClientEvent.Event,t),t.isState()&&t.getType()==p.EventType.RoomEncryption&&this.opts.crypto&&await this.opts.crypto.onCryptoEvent(t)};await a.promiseMapSeries(i,h),await a.promiseMapSeries(r,h),o.forEach((function(t){e.emit(c.ClientEvent.Event,t)})),t.decryptCriticalEvents()}processRoomEvents(e,t,n,i=!1){n=n||[],t=t||[];const r=e.getLiveTimeline(),s=0==r.getEvents().length;if(s){for(const e of t)this.client.getPushActionsForEvent(e);r.initialiseState(t)}s||(e.oldState.setStateEvents(t),e.currentState.setStateEvents(t)),e.addLiveEvents(n,{fromCache:i}),e.recalculate(),this.resolveInvites(e)}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(n){if(n._requestedProfileInfo)return;n._requestedProfileInfo=!0;const i=t.getUser(n.userId);let r;r=i?Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):t.getProfileInfo(n.userId),r.then((function(t){const i=n.events.member;"invite"===i.getContent().membership&&(i.getContent().avatar_url=t.avatar_url,i.getContent().displayname=t.displayname,n.setMembershipEvent(i,e.currentState))}),(function(e){}))}))}retryImmediately(){return!0}async sync(){for(o.logger.debug("Sliding sync init loop");!this.client.isGuest();)try{o.logger.debug("Getting push rules...");const e=await this.client.getPushRules();o.logger.debug("Got push rules"),this.client.pushRules=e;break}catch(e){if(o.logger.error("Getting push rules failed",e),this.shouldAbortSync(e))return}await this.slidingSync.start()}stop(){o.logger.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,t){const n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(c.ClientEvent.Sync,this.syncState,n,t)}addNotifications(e){if(this.client.getNotifTimelineSet())for(const t of e){const e=this.client.getPushActionsForEvent(t);e&&e.notify&&e.tweaks&&e.tweaks.highlight&&this.notifEvents.push(t)}}purgeNotifications(){this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((e=>{this.client.getNotifTimelineSet().addLiveEvent(e)})),this.notifEvents=[]}}},2443:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SlidingSyncState=t.SlidingSyncEvent=t.SlidingSync=t.ExtensionState=void 0;var r=i(n(8416)),s=n(7434),o=n(5861),a=n(3102);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let d,h,u;t.SlidingSyncState=d,function(e){e.RequestFinished="FINISHED",e.Complete="COMPLETE"}(d||(t.SlidingSyncState=d={}));class p{constructor(e){(0,r.default)(this,"list",void 0),(0,r.default)(this,"isModified",void 0),(0,r.default)(this,"roomIndexToRoomId",void 0),(0,r.default)(this,"joinedCount",void 0),this.replaceList(e)}setModified(e){this.isModified=e}updateListRange(e){this.list.ranges=JSON.parse(JSON.stringify(e))}replaceList(e){e.filters=e.filters||{},e.ranges=e.ranges||[],this.list=JSON.parse(JSON.stringify(e)),this.isModified=!0,this.roomIndexToRoomId={},this.joinedCount=0}getList(e){let t={ranges:JSON.parse(JSON.stringify(this.list.ranges))};return(this.isModified||e)&&(t=JSON.parse(JSON.stringify(this.list))),t}isIndexInRange(e){for(const t of this.list.ranges)if(t[0]<=e&&e<=t[1])return!0;return!1}}t.ExtensionState=h,function(e){e.PreProcess="ExtState.PreProcess",e.PostProcess="ExtState.PostProcess"}(h||(t.ExtensionState=h={})),t.SlidingSyncEvent=u,function(e){e.RoomData="SlidingSync.RoomData",e.Lifecycle="SlidingSync.Lifecycle",e.List="SlidingSync.List"}(u||(t.SlidingSyncEvent=u={}));class m extends o.TypedEventEmitter{constructor(e,t,n,i,s){super(),this.proxyBaseUrl=e,this.roomSubscriptionInfo=n,this.client=i,this.timeoutMS=s,(0,r.default)(this,"lists",void 0),(0,r.default)(this,"listModifiedCount",0),(0,r.default)(this,"terminated",!1),(0,r.default)(this,"needsResend",!1),(0,r.default)(this,"txnId",null),(0,r.default)(this,"txnIdDefers",[]),(0,r.default)(this,"extensions",{}),(0,r.default)(this,"desiredRoomSubscriptions",new Set),(0,r.default)(this,"confirmedRoomSubscriptions",new Set),(0,r.default)(this,"pendingReq",void 0),this.lists=t.map((e=>new p(e)))}listLength(){return this.lists.length}getListData(e){return this.lists[e]?{joinedCount:this.lists[e].joinedCount,roomIndexToRoomId:Object.assign({},this.lists[e].roomIndexToRoomId)}:null}getList(e){return this.lists[e]?this.lists[e].getList(!0):null}setListRanges(e,t){return this.lists[e].updateListRange(t),this.resend()}setList(e,t){return this.lists[e]?this.lists[e].replaceList(t):this.lists[e]=new p(t),this.listModifiedCount+=1,this.resend()}getRoomSubscriptions(){return new Set(Array.from(this.desiredRoomSubscriptions))}modifyRoomSubscriptions(e){return this.desiredRoomSubscriptions=e,this.resend()}modifyRoomSubscriptionInfo(e){return this.roomSubscriptionInfo=e,this.confirmedRoomSubscriptions=new Set,this.resend()}registerExtension(e){if(this.extensions[e.name()])throw new Error(`registerExtension: ${e.name()} already exists as an extension`);this.extensions[e.name()]=e}getExtensionRequest(e){const t={};return Object.keys(this.extensions).forEach((n=>{t[n]=this.extensions[n].onRequest(e)})),t}onPreExtensionsResponse(e){Object.keys(e).forEach((t=>{this.extensions[t].when()==h.PreProcess&&this.extensions[t].onResponse(e[t])}))}onPostExtensionsResponse(e){Object.keys(e).forEach((t=>{this.extensions[t].when()==h.PostProcess&&this.extensions[t].onResponse(e[t])}))}invokeRoomDataListeners(e,t){t.required_state||(t.required_state=[]),t.timeline||(t.timeline=[]),this.emit(u.RoomData,e,t)}invokeLifecycleListeners(e,t,n){this.emit(u.Lifecycle,e,t,n)}shiftRight(e,t,n){for(let i=t;i>n;i--)this.lists[e].isIndexInRange(i)&&(this.lists[e].roomIndexToRoomId[i]=this.lists[e].roomIndexToRoomId[i-1])}shiftLeft(e,t,n){for(let i=n;i<t;i++)this.lists[e].isIndexInRange(i)&&(this.lists[e].roomIndexToRoomId[i]=this.lists[e].roomIndexToRoomId[i+1])}removeEntry(e,t){let n=-1;for(const t in this.lists[e].roomIndexToRoomId)Number(t)>n&&(n=Number(t));n<0||t>n||(this.shiftLeft(e,n,t),delete this.lists[e].roomIndexToRoomId[n])}addEntry(e,t){let n=-1;for(const t in this.lists[e].roomIndexToRoomId)Number(t)>n&&(n=Number(t));n<0||t>n||this.shiftRight(e,n+1,t)}processListOps(e,t){let n=-1;e.ops.forEach((e=>{switch(e.op){case"DELETE":s.logger.debug("DELETE",t,e.index,";"),delete this.lists[t].roomIndexToRoomId[e.index],-1!==n&&this.removeEntry(t,n),n=e.index;break;case"INSERT":s.logger.debug("INSERT",t,e.index,e.room_id,";"),this.lists[t].roomIndexToRoomId[e.index]&&(n<0?this.addEntry(t,e.index):n>e.index?this.shiftRight(t,n,e.index):n<e.index&&this.shiftLeft(t,e.index,n),n=-1),this.lists[t].roomIndexToRoomId[e.index]=e.room_id;break;case"INVALIDATE":for(let n=e.range[0];n<=e.range[1];n++)delete this.lists[t].roomIndexToRoomId[n];s.logger.debug("INVALIDATE",t,e.range[0],e.range[1],";");break;case"SYNC":{const n=e.range[0];for(let i=n;i<=e.range[1];i++){const r=e.room_ids[i-n];if(!r)break;this.lists[t].roomIndexToRoomId[i]=r}s.logger.debug("SYNC",t,e.range[0],e.range[1],(e.room_ids||[]).join(" "),";");break}}})),-1!==n&&this.removeEntry(t,n)}resend(){var e;if(this.needsResend&&this.txnIdDefers.length>0)return this.txnIdDefers[this.txnIdDefers.length-1].promise;this.needsResend=!0,this.txnId=this.client.makeTxnId();const t=(0,a.defer)();return this.txnIdDefers.push(c(c({},t),{},{txnId:this.txnId})),null===(e=this.pendingReq)||void 0===e||e.abort(),t.promise}resolveTransactionDefers(e){if(!e)return;let t=-1;for(let n=0;n<this.txnIdDefers.length;n++)if(this.txnIdDefers[n].txnId===e){t=n;break}if(-1!==t){for(let e=0;e<t;e++)this.txnIdDefers[e].reject(this.txnIdDefers[e].txnId);this.txnIdDefers[t].resolve(e),this.txnIdDefers=this.txnIdDefers.slice(t+1)}else s.logger.warn(`resolveTransactionDefers: seen ${e} but it isn't a pending txn, ignoring.`)}stop(){var e;this.terminated=!0,null===(e=this.pendingReq)||void 0===e||e.abort(),this.removeAllListeners(u.Lifecycle),this.removeAllListeners(u.List),this.removeAllListeners(u.RoomData)}async start(){let e;for(;!this.terminated;){this.needsResend=!1;let t,n=!1;try{const i=this.listModifiedCount,r={lists:this.lists.map((e=>e.getList(!1))),pos:e,timeout:this.timeoutMS,clientTimeout:this.timeoutMS+1e4,extensions:this.getExtensionRequest(void 0===e)},o=g(this.desiredRoomSubscriptions,this.confirmedRoomSubscriptions),a=g(this.confirmedRoomSubscriptions,this.desiredRoomSubscriptions);if(a.size>0&&(r.unsubscribe_rooms=Array.from(a)),o.size>0){r.room_subscriptions={};for(const e of o)r.room_subscriptions[e]=this.roomSubscriptionInfo}this.txnId&&(r.txn_id=this.txnId,this.txnId=null),this.pendingReq=this.client.slidingSync(r,this.proxyBaseUrl),t=await this.pendingReq,s.logger.debug(t),e=t.pos;for(const e of o)this.confirmedRoomSubscriptions.add(e);for(const e of a)this.confirmedRoomSubscriptions.delete(e);i!==this.listModifiedCount&&(s.logger.debug("list modified during await call, not updating list"),n=!0),this.lists.forEach((e=>{e.setModified(!1)})),t.lists=t.lists||[],t.rooms=t.rooms||{},t.extensions=t.extensions||{},t.lists.forEach(((e,t)=>{this.lists[t].joinedCount=e.count})),this.invokeLifecycleListeners(d.RequestFinished,t)}catch(e){if(e.httpStatus)this.invokeLifecycleListeners(d.RequestFinished,null,e),await(0,a.sleep)(3e3);else{if(this.needsResend||"aborted"===e)continue;s.logger.error(e),await(0,a.sleep)(3e3)}}if(!t)continue;this.onPreExtensionsResponse(t.extensions),Object.keys(t.rooms).forEach((e=>{this.invokeRoomDataListeners(e,t.rooms[e])}));const i=new Set;n||t.lists.forEach(((e,t)=>{e.ops=e.ops||[],e.ops.length>0&&i.add(t),this.processListOps(e,t)})),this.invokeLifecycleListeners(d.Complete,t),this.onPostExtensionsResponse(t.extensions),i.forEach((e=>{this.emit(u.List,e,this.lists[e].joinedCount,Object.assign({},this.lists[e].roomIndexToRoomId))})),this.resolveTransactionDefers(t.txn_id)}}}t.SlidingSync=m;const g=(e,t)=>{const n=new Set(e);for(const e of t)n.delete(e);return n}},3861:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=void 0;var r=i(n(8416)),s=n(2741),o=d(n(3102)),a=d(n(3415)),l=n(7434);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}const h=[e=>{e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})},e=>{e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},e=>{e.createObjectStore("client_options",{keyPath:["clobber"]})},e=>{e.createObjectStore("to_device_queue",{autoIncrement:!0})}],u=h.length;function p(e,t,n){const i=e.openCursor(t);return new Promise(((e,t)=>{const r=[];i.onerror=()=>{t(new Error("Query failed: "+i.error))},i.onsuccess=()=>{const t=i.result;t?(r.push(n(t)),t.continue()):e(r)}}))}function m(e){return new Promise(((t,n)=>{e.oncomplete=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function g(e){return new Promise(((t,n)=>{e.onsuccess=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function f(e){return g(e).then((t=>e.result))}t.LocalIndexedDBStoreBackend=class{static exists(e,t){return t="matrix-js-sdk:"+(t||"default"),a.exists(e,t)}constructor(e,t){this.indexedDB=e,(0,r.default)(this,"dbName",void 0),(0,r.default)(this,"syncAccumulator",void 0),(0,r.default)(this,"db",null),(0,r.default)(this,"disconnected",!0),(0,r.default)(this,"_isNewlyCreated",!1),(0,r.default)(this,"isPersisting",!1),(0,r.default)(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+(t||"default"),this.syncAccumulator=new s.SyncAccumulator}connect(){if(!this.disconnected)return l.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,l.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this.dbName,u);return e.onupgradeneeded=t=>{const n=e.result,i=t.oldVersion;l.logger.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${i}`),i<1&&(this._isNewlyCreated=!0),h.forEach(((e,t)=>{i<=t&&e(n)}))},e.onblocked=()=>{l.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},l.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),g(e).then((()=>(l.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.result,this.db.onversionchange=()=>{this.db.close()},this.init())))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then((([e,t])=>{l.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:t.nextBatch,rooms:t.roomsData,account_data:{events:e}},!0)}))}getOutOfBandMembers(e){return new Promise(((t,n)=>{const i=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),r=IDBKeyRange.only(e),s=i.openCursor(r),o=[];let a=!1;s.onsuccess=()=>{const e=s.result;if(!e)return o.length||a?t(o):t(null);const n=e.value;n.oob_written?a=!0:o.push(n),e.continue()},s.onerror=e=>{n(e)}})).then((t=>(l.logger.log(`LL: got ${null==t?void 0:t.length} membershipEvents from storage for room ${e} ...`),t)))}async setOutOfBandMembers(e,t){l.logger.log(`LL: backend about to store ${t.length} members for ${e}`);const n=this.db.transaction(["oob_membership_events"],"readwrite"),i=n.objectStore("oob_membership_events");t.forEach((e=>{i.put(e)}));const r={room_id:e,oob_written:!0,state_key:0};i.put(r),await m(n),l.logger.log(`LL: backend done storing for ${e}!`)}async clearOutOfBandMembers(e){const t=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),n=IDBKeyRange.only(e),i=f(t.openKeyCursor(n,"next")).then((e=>e&&e.primaryKey[1])),r=f(t.openKeyCursor(n,"prev")).then((e=>e&&e.primaryKey[1])),[s,o]=await Promise.all([i,r]),a=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),c=IDBKeyRange.bound([e,s],[e,o]);var d;l.logger.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,s],[e,o]),await(d=a.delete(c),new Promise(((e,t)=>{d.onsuccess=()=>e(d),d.onerror=e=>t(e)})))}clearDatabase(){return new Promise((e=>{l.logger.log(`Removing indexeddb instance: ${this.dbName}`);const t=this.indexedDB.deleteDatabase(this.dbName);t.onblocked=()=>{l.logger.log(`can't yet delete indexeddb ${this.dbName} because it is open elsewhere`)},t.onerror=()=>{l.logger.warn(`unable to delete js-sdk store indexeddb: ${t.error}`),e()},t.onsuccess=()=>{l.logger.log(`Removed indexeddb instance: ${this.dbName}`),e()}}))}getSavedSync(e=!0){const t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(o.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then((()=>{this.syncAccumulator.accumulate(e)}))}async syncToDatabase(e){if(this.isPersisting)return l.logger.warn("Skipping syncToDatabase() as persist already in flight"),void this.pendingUserPresenceData.push(...e);e.unshift(...this.pendingUserPresenceData),this.isPersisting=!0;try{const t=this.syncAccumulator.getJSON(!0);await Promise.all([this.persistUserPresenceEvents(e),this.persistAccountData(t.accountData),this.persistSyncData(t.nextBatch,t.roomsData)])}finally{this.isPersisting=!1}}persistSyncData(e,t){return l.logger.log("Persisting sync data up to",e),o.promiseTry((()=>{const n=this.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t}),m(n).then((()=>{l.logger.log("Persisted sync data up to",e)}))}))}persistAccountData(e){return o.promiseTry((()=>{const t=this.db.transaction(["accountData"],"readwrite"),n=t.objectStore("accountData");for(let t=0;t<e.length;t++)n.put(e[t]);return m(t).then()}))}persistUserPresenceEvents(e){return o.promiseTry((()=>{const t=this.db.transaction(["users"],"readwrite"),n=t.objectStore("users");for(const t of e)n.put({userId:t[0],event:t[1]});return m(t).then()}))}getUserPresenceEvents(){return o.promiseTry((()=>p(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,(e=>[e.value.userId,e.value.event]))))}loadAccountData(){return l.logger.log("LocalIndexedDBStoreBackend: loading account data..."),o.promiseTry((()=>p(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(e=>e.value)).then((e=>(l.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e)))))}loadSyncData(){return l.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),o.promiseTry((()=>p(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(e=>e.value)).then((e=>(l.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&l.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))))}getClientOptions(){return Promise.resolve().then((()=>p(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.options})).then((e=>e[0]))))}async storeClientOptions(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await m(t)}async saveToDeviceBatches(e){const t=this.db.transaction(["to_device_queue"],"readwrite"),n=t.objectStore("to_device_queue");for(const t of e)n.add(t);await m(t)}async getOldestToDeviceBatch(){const e=this.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),t=await f(e.openCursor());if(!t)return null;const n=t.value;return{id:t.key,txnId:n.txnId,eventType:n.eventType,batch:n.batch}}async removeToDeviceBatch(e){const t=this.db.transaction(["to_device_queue"],"readwrite");t.objectStore("to_device_queue").delete(e),await m(t)}}},4215:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=void 0;var r=i(n(8416)),s=n(7434),o=n(3102);t.RemoteIndexedDBStoreBackend=class{constructor(e,t){this.workerFactory=e,this.dbName=t,(0,r.default)(this,"worker",void 0),(0,r.default)(this,"nextSeq",0),(0,r.default)(this,"inFlight",{}),(0,r.default)(this,"startPromise",null),(0,r.default)(this,"onWorkerMessage",(e=>{const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void s.logger.error("Got reply from worker with no seq");const e=this.inFlight[t.seq];if(void 0===e)return void s.logger.error("Got reply for unknown seq "+t.seq);if(delete this.inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const n=new Error(t.error.message);n.name=t.error.name,e.reject(n)}}else s.logger.warn("Unrecognised message from worker: ",t)}))}connect(){return this.ensureStarted().then((()=>this.doCmd("connect")))}clearDatabase(){return this.ensureStarted().then((()=>this.doCmd("clearDatabase")))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}async saveToDeviceBatches(e){return this.doCmd("saveToDeviceBatches",[e])}async getOldestToDeviceBatch(){return this.doCmd("getOldestToDeviceBatch")}async removeToDeviceBatch(e){return this.doCmd("removeToDeviceBatch",[e])}ensureStarted(){return null===this.startPromise&&(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("_setupWorker",[this.dbName]).then((()=>{s.logger.log("IndexedDB worker is ready")}))),this.startPromise}doCmd(e,t){return Promise.resolve().then((()=>{const n=this.nextSeq++,i=(0,o.defer)();return this.inFlight[n]=i,this.worker.postMessage({command:e,seq:n,args:t}),i.promise}))}}},9789:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStore=void 0;var r=i(n(8416)),s=n(1703),o=n(3861),a=n(4215),l=n(3998),c=n(4369),d=n(7434),h=n(5861);class u extends s.MemoryStore{static exists(e,t){return o.LocalIndexedDBStoreBackend.exists(e,t)}constructor(e){if(super(e),(0,r.default)(this,"backend",void 0),(0,r.default)(this,"startedUp",!1),(0,r.default)(this,"syncTs",0),(0,r.default)(this,"userModifiedMap",{}),(0,r.default)(this,"emitter",new h.TypedEventEmitter),(0,r.default)(this,"on",this.emitter.on.bind(this.emitter)),(0,r.default)(this,"getSavedSync",this.degradable((()=>this.backend.getSavedSync()),"getSavedSync")),(0,r.default)(this,"isNewlyCreated",this.degradable((()=>this.backend.isNewlyCreated()),"isNewlyCreated")),(0,r.default)(this,"getSavedSyncToken",this.degradable((()=>this.backend.getNextBatchToken()),"getSavedSyncToken")),(0,r.default)(this,"deleteAllData",this.degradable((()=>(super.deleteAllData(),this.backend.clearDatabase().then((()=>{d.logger.log("Deleted indexeddb data.")}),(e=>{throw d.logger.error(`Failed to delete indexeddb data: ${e}`),e})))))),(0,r.default)(this,"reallySave",this.degradable((()=>{this.syncTs=Date.now();const e=[];for(const t of this.getUsers())this.userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this.userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)}))),(0,r.default)(this,"setSyncData",this.degradable((e=>this.backend.setSyncData(e)),"setSyncData")),(0,r.default)(this,"getOutOfBandMembers",this.degradable((e=>this.backend.getOutOfBandMembers(e)),"getOutOfBandMembers")),(0,r.default)(this,"setOutOfBandMembers",this.degradable(((e,t)=>(super.setOutOfBandMembers(e,t),this.backend.setOutOfBandMembers(e,t))),"setOutOfBandMembers")),(0,r.default)(this,"clearOutOfBandMembers",this.degradable((e=>(super.clearOutOfBandMembers(e),this.backend.clearOutOfBandMembers(e))),"clearOutOfBandMembers")),(0,r.default)(this,"getClientOptions",this.degradable((()=>this.backend.getClientOptions()),"getClientOptions")),(0,r.default)(this,"storeClientOptions",this.degradable((e=>(super.storeClientOptions(e),this.backend.storeClientOptions(e))),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new a.RemoteIndexedDBStoreBackend(e.workerFactory,e.dbName):this.backend=new o.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName)}startup(){return this.startedUp?(d.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(d.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((()=>(d.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents()))).then((e=>{d.logger.log("IndexedDBStore.startup: processing presence events"),e.forEach((([e,t])=>{const n=new l.User(e);t&&n.setPresenceEvent(new c.MatrixEvent(t)),this.userModifiedMap[n.userId]=n.getLastModifiedTime(),this.storeUser(n)}))})))}wantsSave(){return Date.now()-this.syncTs>3e5}save(e=!1){return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){const n=super[t];return async(...t)=>{try{return await e.call(this,...t)}catch(e){d.logger.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emitter.emit("degraded",e);try{d.logger.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),d.logger.log("IndexedDBStore delete after degrading succeeded")}catch(e){d.logger.warn("IndexedDBStore delete after degrading failed",e)}if(n)return n.call(this,...t)}}}async getPendingEvents(e){if(!this.localStorage)return super.getPendingEvents(e);const t=this.localStorage.getItem(p(e));if(t)try{return JSON.parse(t)}catch(e){d.logger.error("Could not parse persisted pending events",e)}return[]}async setPendingEvents(e,t){if(!this.localStorage)return super.setPendingEvents(e,t);t.length>0?this.localStorage.setItem(p(e),JSON.stringify(t)):this.localStorage.removeItem(p(e))}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function p(e){return`mx_pending_events_${e}`}t.IndexedDBStore=u},1703:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStore=void 0;var r=i(n(8416)),s=n(3998),o=n(6860);function a(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}t.MemoryStore=class{constructor(e={}){(0,r.default)(this,"rooms",{}),(0,r.default)(this,"users",{}),(0,r.default)(this,"syncToken",null),(0,r.default)(this,"filters",{}),(0,r.default)(this,"accountData",{}),(0,r.default)(this,"localStorage",void 0),(0,r.default)(this,"oobMembers",{}),(0,r.default)(this,"pendingEvents",{}),(0,r.default)(this,"clientOptions",{}),(0,r.default)(this,"pendingToDeviceBatches",[]),(0,r.default)(this,"nextToDeviceBatchId",0),(0,r.default)(this,"onRoomMember",((e,t,n)=>{if("invite"===n.membership)return;const i=this.users[n.userId]||new s.User(n.userId);n.name&&(i.setDisplayName(n.name),n.events.member&&i.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&i.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[i.userId]=i})),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(o.RoomStateEvent.Members,this.onRoomMember),e.currentState.getMembers().forEach((t=>{this.onRoomMember(null,e.currentState,t)}))}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(o.RoomStateEvent.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map((function(e){return e.summary}))}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,n,i){}storeFilter(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)}getFilter(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null}getFilterIdByName(e){if(!this.localStorage)return null;const t="mxjssdk_memory_filter_"+e;try{const e=this.localStorage.getItem(t);if(a(e))return e}catch(e){}return null}setFilterIdByName(e,t){if(!this.localStorage)return;const n="mxjssdk_memory_filter_"+e;try{a(t)?this.localStorage.setItem(n,t):this.localStorage.removeItem(n)}catch(e){}}storeAccountDataEvents(e){e.forEach((e=>{this.accountData[e.getType()]=e}))}getAccountData(e){return this.accountData[e]}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers[e]||null)}setOutOfBandMembers(e,t){return this.oobMembers[e]=t,Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers={},Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}async getPendingEvents(e){var t;return null!==(t=this.pendingEvents[e])&&void 0!==t?t:[]}async setPendingEvents(e,t){this.pendingEvents[e]=t}saveToDeviceBatches(e){for(const t of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:t.eventType,txnId:t.txnId,batch:t.batch});return Promise.resolve()}async getOldestToDeviceBatch(){return 0===this.pendingToDeviceBatches.length?null:this.pendingToDeviceBatches[0]}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter((t=>t.id!==e)),Promise.resolve()}}},5641:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=void 0;var r=i(n(8416));t.StubStore=class{constructor(){(0,r.default)(this,"accountData",{}),(0,r.default)(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}storeEvents(e,t,n,i){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve({})}storeClientOptions(e){return Promise.resolve()}async getPendingEvents(e){return[]}setPendingEvents(e,t){return Promise.resolve()}async saveToDeviceBatches(e){return Promise.resolve()}getOldestToDeviceBatch(){return Promise.resolve(null)}async removeToDeviceBatch(e){return Promise.resolve()}}},2741:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=t.Category=void 0;var r=i(n(8416)),s=n(7434),o=n(3102),a=n(2481);let l;function c(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.Category=l,function(e){e.Invite="invite",e.Leave="leave",e.Join="join"}(l||(t.Category=l={})),t.SyncAccumulator=class{constructor(e={}){this.opts=e,(0,r.default)(this,"accountData",{}),(0,r.default)(this,"inviteRooms",{}),(0,r.default)(this,"joinRooms",{}),(0,r.default)(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e,t=!1){this.accumulateRooms(e,t),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach((e=>{this.accountData[e.type]=e}))}accumulateRooms(e,t=!1){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((n=>{this.accumulateRoom(n,l.Invite,e.rooms.invite[n],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((n=>{this.accumulateRoom(n,l.Join,e.rooms.join[n],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((n=>{this.accumulateRoom(n,l.Leave,e.rooms.leave[n],t)})))}accumulateRoom(e,t,n,i=!1){switch(t){case l.Invite:this.accumulateInviteState(e,n);break;case l.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,n,i);break;case l.Leave:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:s.logger.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const n=this.inviteRooms[e];t.invite_state.events.forEach((e=>{let t=!1;for(let i=0;i<n.invite_state.events.length;i++){const r=n.invite_state.events[i];r.type===e.type&&r.state_key==e.state_key&&(n.invite_state.events[i]=e,t=!0)}t||n.invite_state.events.push(e)}))}accumulateJoinState(e,t,n=!1){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});const i=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((e=>{i._accountData[e.type]=e})),t.unread_notifications&&(i._unreadNotifications=t.unread_notifications),t.summary){const e="m.heroes",n="m.invited_member_count",r="m.joined_member_count",s=i._summary,o=t.summary;s[e]=o[e]||s[e],s[r]=o[r]||s[r],s[n]=o[n]||s[n]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach((e=>{e.type===a.EventType.Receipt&&e.content&&Object.keys(e.content).forEach((t=>{Object.entries(e.content[t]).forEach((([n,r])=>{(0,o.isSupportedReceiptType)(n)&&Object.keys(r).forEach((r=>{i._readReceipts[r]={data:e.content[t][n][r],type:n,eventId:t}}))}))}))})),t.timeline&&t.timeline.limited&&(i._timeline=[]),t.state&&t.state.events&&t.state.events.forEach((e=>{c(i._currentState,e)})),t.timeline&&t.timeline.events&&t.timeline.events.forEach(((e,r)=>{let s;if(c(i._currentState,e),n)s=e;else{s=Object.assign({},e),void 0!==s.unsigned&&(s.unsigned=Object.assign({},s.unsigned));const t=e.unsigned?e.unsigned.age:e.age;void 0!==t&&(s._localTs=Date.now()-t)}i._timeline.push({event:s,token:0===r?t.timeline.prev_batch:null})})),i._timeline.length>this.opts.maxTimelineEntries)for(let e=i._timeline.length-this.opts.maxTimelineEntries;e<i._timeline.length;e++)if(i._timeline[e].token){i._timeline=i._timeline.slice(e,i._timeline.length);break}}getJSON(e=!1){const t={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((e=>{t.invite[e]=this.inviteRooms[e]})),Object.keys(this.joinRooms).forEach((n=>{const i=this.joinRooms[n],r={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:i._unreadNotifications,summary:i._summary};Object.keys(i._accountData).forEach((e=>{r.account_data.events.push(i._accountData[e])}));const s={type:a.EventType.Receipt,room_id:n,content:{}};Object.keys(i._readReceipts).forEach((e=>{const t=i._readReceipts[e];s.content[t.eventId]||(s.content[t.eventId]={}),s.content[t.eventId][t.type]||(s.content[t.eventId][t.type]={}),s.content[t.eventId][t.type][e]=t.data})),Object.keys(s.content).length>0&&r.ephemeral.events.push(s),i._timeline.forEach((t=>{if(!r.timeline.prev_batch){if(!t.token)return;r.timeline.prev_batch=t.token}let n;!e&&t.event._localTs?(n=Object.assign({},t.event),void 0!==n.unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-t.event._localTs):n=t.event,r.timeline.events.push(n)}));const l=Object.create(null);for(let e=r.timeline.events.length-1;e>=0;e--){const t=r.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const n=(0,o.deepCopy)(t);n.unsigned&&(n.unsigned.prev_content&&(n.content=n.unsigned.prev_content),n.unsigned.prev_sender&&(n.sender=n.unsigned.prev_sender)),c(l,n)}Object.keys(i._currentState).forEach((e=>{Object.keys(i._currentState[e]).forEach((t=>{let n=i._currentState[e][t];l[e]&&l[e][t]&&(n=l[e][t]),r.state.events.push(n)}))})),t.join[n]=r}));const n=[];return Object.keys(this.accountData).forEach((e=>{n.push(this.accountData[e])})),{nextBatch:this.nextBatch,roomsData:t,accountData:n}}getNextBatchToken(){return this.nextBatch}}},4551:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncState=t.SyncApi=void 0,t._createAndReEmitRoom=T;var r=i(n(8416)),s=n(3998),o=n(7366),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102)),l=n(7906),c=n(8910),d=n(1707),h=n(7434),u=n(9489),p=n(2168),m=n(7715),g=n(2481),f=n(6860),v=n(2848),y=n(6320);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}let w;t.SyncState=w,function(e){e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING"}(w||(t.SyncState=w={}));const S=["org.matrix.msc2716v3"];function _(e,t){return`FILTER_SYNC_${e}`+(t?"_"+t:"")}function E(...e){h.logger.log(...e)}var k;function x(e,t){const n=new s.User(t);return e.reEmitter.reEmit(n,[s.UserEvent.AvatarUrl,s.UserEvent.DisplayName,s.UserEvent.Presence,s.UserEvent.CurrentlyActive,s.UserEvent.LastPresenceTs]),n}function T(e,t,n){const{timelineSupport:i}=e,r=new o.Room(t,e,e.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:i});return e.reEmitter.reEmit(r,[o.RoomEvent.Name,o.RoomEvent.Redaction,o.RoomEvent.RedactionCancelled,o.RoomEvent.Receipt,o.RoomEvent.Tags,o.RoomEvent.LocalEchoUpdated,o.RoomEvent.AccountData,o.RoomEvent.MyMembership,o.RoomEvent.Timeline,o.RoomEvent.TimelineReset,f.RoomStateEvent.Events,f.RoomStateEvent.Members,f.RoomStateEvent.NewMember,f.RoomStateEvent.Update,y.BeaconEvent.New,y.BeaconEvent.Update,y.BeaconEvent.Destroy,y.BeaconEvent.LivenessChange]),r.on(f.RoomStateEvent.NewMember,((t,n,i)=>{i.user=e.getUser(i.userId),e.reEmitter.reEmit(i,[v.RoomMemberEvent.Name,v.RoomMemberEvent.Typing,v.RoomMemberEvent.PowerLevel,v.RoomMemberEvent.Membership])})),r}!function(e){e.Offline="offline",e.Online="online",e.Unavailable="unavailable"}(k||(k={})),t.SyncApi=class{constructor(e,t={}){var n;this.client=e,this.opts=t,(0,r.default)(this,"_peekRoom",null),(0,r.default)(this,"currentSyncRequest",null),(0,r.default)(this,"syncState",null),(0,r.default)(this,"syncStateData",null),(0,r.default)(this,"catchingUp",!1),(0,r.default)(this,"running",!1),(0,r.default)(this,"keepAliveTimer",null),(0,r.default)(this,"connectionReturnedDefer",null),(0,r.default)(this,"notifEvents",[]),(0,r.default)(this,"failedSyncCount",0),(0,r.default)(this,"storeIsInvalid",!1),(0,r.default)(this,"getPushRules",(async()=>{try{E("Getting push rules...");const e=await this.client.getPushRules();E("Got push rules"),this.client.pushRules=e}catch(e){if(h.logger.error("Getting push rules failed",e),this.shouldAbortSync(e))return;return E("Waiting for saved sync before retrying push rules..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,e),this.getPushRules()}})),(0,r.default)(this,"buildDefaultFilter",(()=>new l.Filter(this.client.credentials.userId))),(0,r.default)(this,"checkLazyLoadStatus",(async()=>{if(E("Checking lazy load status..."),this.opts.lazyLoadMembers&&this.client.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers&&(E("Checking server lazy load support..."),await this.client.doesServerSupportLazyLoading()?(E("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=this.buildDefaultFilter()),this.opts.filter.setLazyLoadMembers(!0)):(E("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1)),E("Checking whether lazy loading has changed in store..."),await this.wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this.storeIsInvalid=!0;const e=u.InvalidStoreError.TOGGLED_LAZY_LOADING,t=new u.InvalidStoreError(e,!!this.opts.lazyLoadMembers);return this.updateSyncState(w.Error,{error:t}),void h.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}var e;this.opts.lazyLoadMembers&&(null===(e=this.opts.crypto)||void 0===e||e.enableLazyLoading());try{E("Storing client options..."),await this.client.storeClientOptions(),E("Stored client options")}catch(e){throw h.logger.error("Storing client options failed",e),e}})),(0,r.default)(this,"getFilter",(async()=>{let e,t;E("Getting filter..."),e=this.opts.filter?this.opts.filter:this.buildDefaultFilter();try{t=await this.client.getOrCreateFilter(_(this.client.credentials.userId),e)}catch(e){return h.logger.error("Getting filter failed",e),this.shouldAbortSync(e)?{}:(E("Waiting for saved sync before retrying filter..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,e),this.getFilter())}return{filter:e,filterId:t}})),(0,r.default)(this,"savedSyncPromise",void 0),(0,r.default)(this,"onOnline",(()=>{E("Browser thinks we are back online"),this.startKeepAlives(0)})),this.opts.initialSyncLimit=null!==(n=this.opts.initialSyncLimit)&&void 0!==n?n:8,this.opts.resolveInvitesToProfiles=this.opts.resolveInvitesToProfiles||!1,this.opts.pollTimeout=this.opts.pollTimeout||3e4,this.opts.pendingEventOrdering=this.opts.pendingEventOrdering||p.PendingEventOrdering.Chronological,this.opts.experimentalThreadSupport=!0===this.opts.experimentalThreadSupport,t.canResetEntireTimeline||(t.canResetEntireTimeline=e=>!1),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[o.RoomEvent.Timeline,o.RoomEvent.TimelineReset])}createRoom(e){const t=T(this.client,e,this.opts);return t.on(f.RoomStateEvent.Marker,((e,n)=>{this.onMarkerStateEvent(t,e,n)})),t}onMarkerStateEvent(e,t,{timelineWasEmpty:n}={}){n?h.logger.debug(`MarkerState: Ignoring markerEventId=${t.getId()} in roomId=${e.roomId} because the timeline was empty before the marker arrived which means there is nothing to refresh.`):S.includes(e.getVersion())||t.getSender()===e.getCreator()?(h.logger.debug(`MarkerState: Timeline needs to be refreshed because a new markerEventId=${t.getId()} was sent in roomId=${e.roomId}`),e.setTimelineNeedsRefresh(!0),e.emit(o.RoomEvent.HistoryImportedWithinTimeline,t,e)):h.logger.debug(`MarkerState: Ignoring markerEventId=${t.getId()} in roomId=${e.roomId} because MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.`)}syncLeftRooms(){const e=this.client,t=new l.Filter(this.client.credentials.userId);t.setTimelineLimit(1),t.setIncludeLeaveRooms(!0);const n=this.opts.pollTimeout+8e4,i={timeout:0};return e.getOrCreateFilter(_(e.credentials.userId,"LEFT_ROOMS"),t).then((function(t){return i.filter=t,e.http.authedRequest(void 0,m.Method.Get,"/sync",i,void 0,n)})).then((async t=>{var n;let i=[];return null!==(n=t.rooms)&&void 0!==n&&n.leave&&(i=this.mapSyncResponseToRoomArray(t.rooms.leave)),Promise.all(i.map((async t=>{const n=t.room;if(!t.isBrandNewRoom)return;t.timeline=t.timeline||{};const i=this.mapSyncEventsFormat(t.timeline,n),r=this.mapSyncEventsFormat(t.state,n);return n.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,c.EventTimeline.BACKWARDS),await this.processRoomEvents(n,r,i),n.recalculate(),e.store.storeRoom(n),e.emit(p.ClientEvent.Room,n),this.processEventsForNotifs(n,i),n})))}))}peek(e){if(this._peekRoom&&this._peekRoom.roomId===e)return Promise.resolve(this._peekRoom);const t=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then((e=>{e.messages=e.messages||{chunk:[]},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];const n=a.deepCopy(e.state).map(t.getEventMapper()),i=e.state.map(t.getEventMapper()),r=e.messages.chunk.map(t.getEventMapper());return Array.isArray(e.presence)&&e.presence.map(t.getEventMapper()).forEach((function(e){let n=t.store.getUser(e.getContent().user_id);n?n.setPresenceEvent(e):(n=x(t,e.getContent().user_id),n.setPresenceEvent(e),t.store.storeUser(n)),t.emit(p.ClientEvent.Event,e)})),e.messages.start&&(this._peekRoom.oldState.paginationToken=e.messages.start),this._peekRoom.oldState.setStateEvents(n),this._peekRoom.currentState.setStateEvents(i),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(r.reverse(),!0,this._peekRoom.getLiveTimeline(),e.messages.start),t.store.storeRoom(this._peekRoom),t.emit(p.ClientEvent.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom}))}stopPeeking(){this._peekRoom=null}peekPoll(e,t){this._peekRoom===e?this.client.http.authedRequest(void 0,m.Method.Get,"/events",{room_id:e.roomId,timeout:String(3e4),from:t},void 0,5e4).then((t=>{if(this._peekRoom!==e)return void E("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(this.client.getEventMapper()).forEach((e=>{let t=this.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=x(this.client,e.getContent().user_id),t.setPresenceEvent(e),this.client.store.storeUser(t)),this.client.emit(p.ClientEvent.Event,e)}));const n=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(this.client.getEventMapper());e.addLiveEvents(n),this.peekPoll(e,t.end)}),(n=>{h.logger.error("[%s] Peek poll failed: %s",e.roomId,n),setTimeout((()=>{this.peekPoll(e,t)}),3e4)})):E("Stopped peeking in room %s",e.roomId)}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData}async recoverFromSyncStartupError(e,t){await e;const n=this.startKeepAlives();this.updateSyncState(w.Error,{error:t}),await n}async wasLazyLoadingToggled(e=!1){let t=!1;if(!await this.client.store.isNewlyCreated()){const n=await this.client.store.getClientOptions();return n&&(t=!!n.lazyLoadMembers),t!==e}return!1}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(h.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(w.Error,{error:e}),!0)}async sync(){var e,t;if(this.running=!0,null===(e=n.g.window)||void 0===e||null===(t=e.addEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.client.isGuest())return this.doSync({});E("Getting saved sync token...");const i=this.client.store.getSavedSyncToken().then((e=>(E("Got saved sync token"),e)));this.savedSyncPromise=this.client.store.getSavedSync().then((e=>{if(E(`Got reply from saved sync, exists? ${!!e}`),e)return this.syncFromCache(e)})).catch((e=>{h.logger.error("Getting saved sync failed",e)})),await this.getPushRules(),await this.checkLazyLoadStatus();const{filterId:r,filter:s}=await this.getFilter();if(s){if(this.client.resetNotifTimelineSet(),null===this.currentSyncRequest){let e=r;const t=await i;if(t)E("Sending first sync request...");else{E("Sending initial sync request...");const t=this.buildDefaultFilter();t.setDefinition(s.getDefinition()),t.setTimelineLimit(this.opts.initialSyncLimit),e=JSON.stringify(t.getDefinition())}this.currentSyncRequest=this.doSyncRequest({filter:e},t)}return E("Waiting for saved sync before starting sync processing..."),await this.savedSyncPromise,this.doSync({filter:r})}}stop(){var e,t,i;E("SyncApi.stop"),null===(e=n.g.window)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.running=!1,null===(i=this.currentSyncRequest)||void 0===i||i.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}retryImmediately(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}async syncFromCache(e){E("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const n={nextSyncToken:t,catchingUp:!1,fromCache:!0},i={next_batch:t,rooms:e.roomsData,account_data:{events:e.accountData}};try{await this.processSyncResponse(n,i)}catch(e){h.logger.error("Error processing cached sync",e)}this.storeIsInvalid||this.updateSyncState(w.Prepared,n)}async doSync(e){for(;this.running;){const t=this.client.store.getSyncToken();let n;try{null===this.currentSyncRequest&&(this.currentSyncRequest=this.doSyncRequest(e,t)),n=await this.currentSyncRequest}catch(e){if(await this.onSyncError(e))return;continue}finally{this.currentSyncRequest=null}this.client.store.setSyncToken(n.next_batch),this.failedSyncCount=0,await this.client.store.setSyncData(n);const i={oldSyncToken:t,nextSyncToken:n.next_batch,catchingUp:this.catchingUp};this.opts.crypto&&await this.opts.crypto.onSyncWillProcess(i);try{await this.processSyncResponse(i,n)}catch(e){h.logger.error("Caught /sync error",e),this.client.emit(p.ClientEvent.SyncUnexpectedError,e)}i.catchingUp=this.catchingUp,e.hasSyncedBefore||(this.updateSyncState(w.Prepared,i),e.hasSyncedBefore=!0),this.opts.crypto&&await this.opts.crypto.onSyncCompleted(i),this.updateSyncState(w.Syncing,i),this.client.store.wantsSave()&&(this.opts.crypto&&await this.opts.crypto.saveDeviceList(0),this.client.store.save())}this.running||(E("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),this.updateSyncState(w.Stopped))}doSyncRequest(e,t){const n=this.getSyncParams(e,t);return this.client.http.authedRequest(void 0,m.Method.Get,"/sync",n,void 0,n.timeout+8e4)}getSyncParams(e,t){let n=this.opts.pollTimeout;(this.getSyncState()!==w.Syncing||this.catchingUp)&&(this.catchingUp=!0,n=0);let i=e.filter;this.client.isGuest()&&!i&&(i=this.getGuestFilter());const r={filter:i,timeout:n};return this.opts.disablePresence&&(r.set_presence=k.Offline),t?r.since=t:r._cacheBuster=Date.now(),[w.Reconnecting,w.Error].includes(this.getSyncState())&&(r.timeout=0),r}async onSyncError(e){if(!this.running)return E("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),this.updateSyncState(w.Stopped),!0;if(h.logger.error("/sync error %s",e),this.shouldAbortSync(e))return!0;this.failedSyncCount++,h.logger.log("Number of consecutive failed sync requests:",this.failedSyncCount),E("Starting keep-alive");const t=this.startKeepAlives();return this.currentSyncRequest=null,this.updateSyncState(this.failedSyncCount>=3?w.Error:w.Reconnecting,{error:e}),await t&&this.getSyncState()===w.Error&&this.updateSyncState(w.Catchup,{catchingUp:!0}),!1}async processSyncResponse(e,t){var n,i,r;const s=this.client;if(Array.isArray(null===(n=t.presence)||void 0===n?void 0:n.events)&&t.presence.events.map(s.getEventMapper()).forEach((function(e){let t=s.store.getUser(e.getSender());t?t.setPresenceEvent(e):(t=x(s,e.getSender()),t.setPresenceEvent(e),s.store.storeUser(t)),s.emit(p.ClientEvent.Event,e)})),Array.isArray(null===(i=t.account_data)||void 0===i?void 0:i.events)){const e=t.account_data.events.map(s.getEventMapper()),n=e.reduce(((e,t)=>(e[t.getId()]=s.store.getAccountData(t.getType()),e)),{});s.store.storeAccountDataEvents(e),e.forEach((function(e){if(e.getType()===g.EventType.PushRules){const t=e.getContent();s.pushRules=d.PushProcessor.rewriteDefaultRules(t)}const t=n[e.getId()];return s.emit(p.ClientEvent.AccountData,e,t),e}))}if(Array.isArray(null===(r=t.to_device)||void 0===r?void 0:r.events)&&t.to_device.events.length>0){const e=[];t.to_device.events.filter((e=>{var t;return!(e.type===g.EventType.RoomMessageEncrypted&&!["m.olm.v1.curve25519-aes-sha2"].includes(null===(t=e.content)||void 0===t?void 0:t.algorithm)&&(h.logger.log("Ignoring invalid encrypted to-device event from "+e.sender),1))})).map(s.getEventMapper({toDevice:!0})).map((t=>{if("m.key.verification.cancel"===t.getType()){const n=t.getContent().transaction_id;n&&e.push(n)}return t})).forEach((function(t){const n=t.getContent();if("m.room.message"!=t.getType()||"m.bad.encrypted"!=n.msgtype){if("m.key.verification.start"===t.getType()||"m.key.verification.request"===t.getType()){const i=n.transaction_id;e.includes(i)&&t.flagCancelled()}s.emit(p.ClientEvent.ToDeviceEvent,t)}else h.logger.log("Ignoring undecryptable to-device event from "+t.getSender())}))}else this.catchingUp=!1;let l=[],u=[],m=[];if(t.rooms&&(t.rooms.invite&&(l=this.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(u=this.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(m=this.mapSyncResponseToRoomArray(t.rooms.leave))),this.notifEvents=[],await a.promiseMapSeries(l,(async e=>{var t;const n=e.room,i=this.mapSyncEventsFormat(e.invite_state,n);await this.processRoomEvents(n,i);const r=null===(t=n.currentState.getStateEvents(g.EventType.RoomMember,s.getUserId()))||void 0===t?void 0:t.getSender();if(s.isCryptoEnabled()){const e=await s.crypto.cryptoStore.takeParkedSharedHistory(n.roomId);for(const t of e)t.senderId===r&&await s.crypto.olmDevice.addInboundGroupSession(n.roomId,t.senderKey,t.forwardingCurve25519KeyChain,t.sessionId,t.sessionKey,t.keysClaimed,!0,{sharedHistory:!0,untrusted:!0})}e.isBrandNewRoom?(n.recalculate(),s.store.storeRoom(n),s.emit(p.ClientEvent.Room,n)):n.recalculate(),i.forEach((function(e){s.emit(p.ClientEvent.Event,e)}))})),await a.promiseMapSeries(u,(async t=>{const n=t.room,i=this.mapSyncEventsFormat(t.state,n),r=this.mapSyncEventsFormat(t.timeline,n,!1),l=this.mapSyncEventsFormat(t.ephemeral),d=this.mapSyncEventsFormat(t.account_data),u=s.isRoomEncrypted(n.roomId);if(t.unread_notifications&&(n.setUnreadNotificationCount(o.NotificationCountType.Total,t.unread_notifications.notification_count),(!u||n.getUnreadNotificationCount(o.NotificationCountType.Highlight)<=0)&&n.setUnreadNotificationCount(o.NotificationCountType.Highlight,t.unread_notifications.highlight_count)),t.timeline=t.timeline||{},t.isBrandNewRoom)null!==t.timeline.prev_batch&&n.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,c.EventTimeline.BACKWARDS);else if(t.timeline.limited){let i=!0;for(let e=r.length-1;e>=0;e--){const t=r[e].getId();if(n.getTimelineForEvent(t)){E("Already have event "+t+" in limited sync - not resetting"),i=!1,r.splice(0,e);break}}i&&(n.resetLiveTimeline(t.timeline.prev_batch,this.opts.canResetEntireTimeline(n.roomId)?null:e.oldSyncToken),s.resetNotifTimelineSet())}try{await this.processRoomEvents(n,i,r,e.fromCache)}catch(e){h.logger.error(`Failed to process events on room ${n.roomId}:`,e)}t.summary&&n.setSummary(t.summary),n.addEphemeralEvents(l),n.addAccountData(d),n.recalculate(),t.isBrandNewRoom&&(s.store.storeRoom(n),s.emit(p.ClientEvent.Room,n)),this.processEventsForNotifs(n,r);const m=async e=>{s.emit(p.ClientEvent.Event,e),e.isState()&&"m.room.encryption"==e.getType()&&this.opts.crypto&&await this.opts.crypto.onCryptoEvent(e)};await a.promiseMapSeries(i,m),await a.promiseMapSeries(r,m),l.forEach((function(e){s.emit(p.ClientEvent.Event,e)})),d.forEach((function(e){s.emit(p.ClientEvent.Event,e)})),n.decryptCriticalEvents()})),await a.promiseMapSeries(m,(async e=>{const t=e.room,n=this.mapSyncEventsFormat(e.state,t),i=this.mapSyncEventsFormat(e.timeline,t),r=this.mapSyncEventsFormat(e.account_data);await this.processRoomEvents(t,n,i),t.addAccountData(r),t.recalculate(),e.isBrandNewRoom&&(s.store.storeRoom(t),s.emit(p.ClientEvent.Room,t)),this.processEventsForNotifs(t,i),n.forEach((function(e){s.emit(p.ClientEvent.Event,e)})),i.forEach((function(e){s.emit(p.ClientEvent.Event,e)})),r.forEach((function(e){s.emit(p.ClientEvent.Event,e)}))})),e.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((function(e){s.getNotifTimelineSet().addLiveEvent(e)}))),t.device_lists&&this.opts.crypto&&await this.opts.crypto.handleDeviceListChanges(e,t.device_lists),this.opts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.opts.crypto.updateOneTimeKeyCount(e)}if(this.opts.crypto&&(t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"])){const e=t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"];this.opts.crypto.setNeedsNewFallback(e instanceof Array&&!e.includes("signed_curve25519"))}}startKeepAlives(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=a.defer()),this.connectionReturnedDefer.promise}pokeKeepAlive(e=!1){const t=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(e),this.connectionReturnedDefer=null)};this.client.http.request(void 0,m.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((()=>{t()}),(n=>{400==n.httpStatus||404==n.httpStatus?this.keepAliveTimer=setTimeout(t,2e3):(e=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,e),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(w.Error,{error:n}))}))}mapSyncResponseToRoomArray(e){const t=this.client;return Object.keys(e).map((n=>{const i=e[n];let r=t.store.getRoom(n),s=!1;return r||(r=this.createRoom(n),s=!0),i.room=r,i.isBrandNewRoom=s,i}))}mapSyncEventsFormat(e,t,n=!0){if(!e||!Array.isArray(e.events))return[];const i=this.client.getEventMapper({decrypt:n});return e.events.map((function(e){return t&&(e.room_id=t.roomId),i(e)}))}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(n){if(n._requestedProfileInfo)return;n._requestedProfileInfo=!0;const i=t.getUser(n.userId);let r;r=i?Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):t.getProfileInfo(n.userId),r.then((function(t){const i=n.events.member;"invite"===i.getContent().membership&&(i.getContent().avatar_url=t.avatar_url,i.getContent().displayname=t.displayname,n.setMembershipEvent(i,e.currentState))}),(function(e){}))}))}async processRoomEvents(e,t,n,i=!1){const r=e.getLiveTimeline(),s=0==r.getEvents().length;if(s){for(const e of t)this.client.getPushActionsForEvent(e);r.initialiseState(t,{timelineWasEmpty:s})}this.resolveInvites(e),e.recalculate(),s||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(n||[],{fromCache:i,timelineWasEmpty:s}),this.client.processBeaconEvents(e,n)}processEventsForNotifs(e,t){if(this.client.getNotifTimelineSet())for(let e=0;e<t.length;e++){const n=this.client.getPushActionsForEvent(t[e]);n&&n.notify&&n.tweaks&&n.tweaks.highlight&&this.notifEvents.push(t[e])}}getGuestFilter(){return"{}"}updateSyncState(e,t){const n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(p.ClientEvent.Sync,this.syncState,n,t)}}},4969:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineWindow=t.TimelineIndex=void 0;var r=i(n(8416)),s=n(8910);n(7434);t.TimelineWindow=class{constructor(e,t,n={}){this.client=e,this.timelineSet=t,(0,r.default)(this,"windowLimit",void 0),(0,r.default)(this,"start",null),(0,r.default)(this,"end",null),(0,r.default)(this,"eventCount",0),this.windowLimit=n.windowLimit||1e3}load(e,t=20){const n=n=>{let i;const r=n.getEvents();if(e){if(i=r.findIndex((t=>t.getId()===e)),i<0)throw new Error("getEventTimeline result didn't include requested event")}else i=r.length;const s=Math.min(r.length,i+Math.ceil(t/2)),a=Math.max(0,s-t);this.start=new o(n,a-n.getBaseIndex()),this.end=new o(n,s-n.getBaseIndex()),this.eventCount=s-a};if(e){const t=this.timelineSet.getTimelineForEvent(e);return t?(n(t),Promise.resolve()):this.client.getEventTimeline(this.timelineSet,e).then(n)}return n(this.timelineSet.getLiveTimeline()),Promise.resolve()}getTimelineIndex(e){if(e==s.EventTimeline.BACKWARDS)return this.start;if(e==s.EventTimeline.FORWARDS)return this.end;throw new Error("Invalid direction '"+e+"'")}extend(e,t){const n=this.getTimelineIndex(e);if(!n)return!1;const i=e==s.EventTimeline.BACKWARDS?n.retreat(t):n.advance(t);if(i){this.eventCount+=i,this.eventCount;const t=this.eventCount-this.windowLimit;return t>0&&this.unpaginate(t,e!=s.EventTimeline.BACKWARDS),!0}return!1}canPaginate(e){const t=this.getTimelineIndex(e);if(!t)return!1;if(e==s.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||null!==t.timeline.getPaginationToken(e))}paginate(e,t,n=!0,i=5){const r=this.getTimelineIndex(e);if(!r)return Promise.resolve(!1);if(r.pendingPaginate)return r.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!n||0===i)return Promise.resolve(!1);if(null===r.timeline.getPaginationToken(e))return Promise.resolve(!1);const o=this.client.paginateEventTimeline(r.timeline,{backwards:e==s.EventTimeline.BACKWARDS,limit:t}).finally((function(){r.pendingPaginate=null})).then((n=>!!n&&this.paginate(e,t,!0,i-1)));return r.pendingPaginate=o,o}unpaginate(e,t){const n=t?this.start:this.end;if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this.eventCount+" in the timeline");for(;e>0;){const i=t?n.advance(e):n.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=i,this.eventCount-=i,this.eventCount}}getEvents(){if(!this.start)return[];const e=[];let t=this.start.timeline;for(;;){const n=t.getEvents();let i=0,r=n.length;t===this.start.timeline&&(i=this.start.index+t.getBaseIndex()),t===this.end.timeline&&(r=this.end.index+t.getBaseIndex());for(let t=i;t<r;t++)e.push(n[t]);if(t===this.end.timeline)break;t=t.getNeighbouringTimeline(s.EventTimeline.FORWARDS)}return e}};class o{constructor(e,t){this.timeline=e,this.index=t,(0,r.default)(this,"pendingPaginate",void 0)}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const n=this.timeline.getNeighbouringTimeline(e<0?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),this.advance(e)):0}retreat(e){return-1*this.advance(-1*e)}}t.TimelineIndex=o},3102:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ALPHABET=void 0,t.alphabetPad=m,t.averageBetweenStrings=function(e,t,n=p){const i=Math.max(e.length,t.length),r=f(m(e,i,n),n),s=f(m(t,i,n),n),o=(r+s)/BigInt(2);return o===r||o==s?g(o,n)+n[0]:g(o,n)},t.baseToString=g,t.checkObjectHasKeys=function(e,t){for(let n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n]))throw new Error("Missing required key: "+t[n])},t.chunkPromises=async function(e,t){const n=[];for(let i=0;i<e.length;i+=t)n.push(...await Promise.all(e.slice(i,i+t).map((e=>e()))));return n},t.compare=function(e,t){return y.compare(e,t)},t.decodeParams=function(e){const t={},n=new URLSearchParams(e);for(const e of n.keys()){const i=n.getAll(e);t[e]=1===i.length?i[0]:i}return t},t.deepCompare=function e(t,n){if(t===n)return!0;if(typeof t!=typeof n)return!1;if("number"==typeof t&&isNaN(t)&&isNaN(n))return!0;if(null===t||null===n)return t===n;if(!(t instanceof Object))return!1;if(t.constructor!==n.constructor||t.prototype!==n.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===n.toString();if(t instanceof Array){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],n[i]))return!1}else{for(const e in n)if(n.hasOwnProperty(e)!==t.hasOwnProperty(e))return!1;for(const i in t)if(n.hasOwnProperty(i)!==t.hasOwnProperty(i)||!e(t[i],n[i]))return!1}return!0},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.deepSortedObjectEntries=function e(t){if("object"!=typeof t)return t;if(null==t||Array.isArray(t))return t;const n=[];for(const[i,r]of Object.entries(t))n.push([i,e(r)]);return n.sort(((e,t)=>v(e[0],t[0]))),n},t.defer=function(){let e,t;const n=new Promise(((n,i)=>{e=n,t=i}));return{resolve:e,reject:t,promise:n}},t.encodeParams=function(e){const t=new URLSearchParams;for(const[n,i]of Object.entries(e))null!=i&&t.set(n,String(i));return t.toString()},t.encodeUri=function(e,t){for(const n in t)t.hasOwnProperty(n)&&(e=e.replace(n,encodeURIComponent(t[n])));return e},t.ensureNoTrailingSlash=function(e){return e&&e.endsWith("/")?e.slice(0,-1):e},t.escapeRegExp=h,t.getCrypto=function(){return u},t.globToRegexp=function(e,t=!1){return[[/\\\*/g,".*"],[/\?/g,"."],!t&&[/\\\[(!|)(.*)\\]/g,(e,t,n)=>["[",t?"^":"",n.replace(/\\-/,"-"),"]"].join("")]].reduce(((e,t)=>t?e.replace(t[0],t[1]):e),h(e))},t.internaliseString=function(e){return e instanceof String&&(e=e.toString()),l.has(e)||l.set(e,e),l.get(e)},t.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e&&isFinite(e)},t.isSupportedReceiptType=function(e){return[a.ReceiptType.Read,a.ReceiptType.ReadPrivate].includes(e)},t.lexicographicCompare=v,t.nextString=function(e,t=p){return g(f(e,t)+BigInt(1),t)},t.normalize=function(e){return c(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()},t.prevString=function(e,t=p){return g(f(e,t)-BigInt(1),t)},t.promiseMapSeries=async function(e,t){for(const n of e)await t(await n)},t.promiseTry=function(e){return Promise.resolve(e())},t.recursivelyAssign=function e(t,n,i=!1){for(const[r,s]of Object.entries(n))t[r]instanceof Object&&s?e(t[r],s):null==s&&i||(t[r]=s);return t},t.removeDirectionOverrideChars=function(e){return"string"==typeof e?e.replace(/[\u202d-\u202e]/g,""):""},t.removeElement=function(e,t,n){let i;if(n){for(i=e.length-1;i>=0;i--)if(t(e[i],i,e))return e.splice(i,1),!0}else for(i=0;i<e.length;i++)if(t(e[i],i,e))return e.splice(i,1),!0;return!1},t.removeHiddenChars=c,t.setCrypto=function(e){u=e},t.simpleRetryOperation=function(e){return(0,s.default)((t=>e(t)),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})},t.sleep=function(e,t){return new Promise((n=>{setTimeout(n,e,t)}))},t.sortEventsByLatestContentTimestamp=function(e,t){return b(t)-b(e)},t.stringToBase=f;var r=i(n(5067)),s=i(n(2693)),o=n(6709),a=n(5550);const l=new Map;function c(e){return"string"==typeof e?(0,r.default)(e.normalize("NFD").replace(d,"")):""}const d=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\s]/g;function h(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let u;const p=(()=>{let e="";for(let t=32;t<=126;t++)e+=String.fromCharCode(t);return e})();function m(e,t,n=p){return e.padEnd(t,n[0])}function g(e,t=p){const n=BigInt(t.length);var i;if(e<=n)return null!==(i=t[Number(e)-1])&&void 0!==i?i:"";let r=e/n,s=Number(e%n)-1;return s<0&&(r-=BigInt(Math.abs(s)),s=Number(n)-1),g(r,t)+t[s]}function f(e,t=p){const n=BigInt(t.length);let i=BigInt(0);for(let r=e.length-1,s=BigInt(0);r>=0;r--,s++){const o=e.charCodeAt(r)-t.charCodeAt(0);i+=BigInt(1+o)*n**s}return i}function v(e,t){return e<t?-1:e>t?1:0}t.DEFAULT_ALPHABET=p;const y=new Intl.Collator;function b(e){var t;return null!==(t=o.M_TIMESTAMP.findIn(e.getContent()))&&void 0!==t?t:-1}},9679:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixCall=t.CallType=t.CallState=t.CallParty=t.CallEvent=t.CallErrorCode=t.CallError=t.CallDirection=void 0,t.createNewMatrixCall=function(e,t,n){if(!E())return null;const i=!!n&&n.forceTURN,r={client:e,roomId:t,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||i},s=new S(r);return e.reEmitter.reEmit(s,Object.values(v)),s},t.supportsMatrixCall=E;var r=i(n(8416)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(n(3102)),a=n(2481),l=n(8401),c=n(5964),d=n(9704),h=n(5861);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}let p,m,g,f,v,y;t.CallState=p,function(e){e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended"}(p||(t.CallState=p={})),t.CallType=m,function(e){e.Voice="voice",e.Video="video"}(m||(t.CallType=m={})),t.CallDirection=g,function(e){e.Inbound="inbound",e.Outbound="outbound"}(g||(t.CallDirection=g={})),t.CallParty=f,function(e){e.Local="local",e.Remote="remote"}(f||(t.CallParty=f={})),t.CallEvent=v,function(e){e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed",e.LengthChanged="length_changed",e.DataChannel="datachannel"}(v||(t.CallEvent=v={})),t.CallErrorCode=y,function(e){e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy",e.Transfered="transferred"}(y||(t.CallErrorCode=y={}));class b extends Error{constructor(e,t,n){super(t+": "+n),(0,r.default)(this,"code",void 0),this.code=e}}function w(){return Date.now().toString()+(0,l.randomString)(16)}t.CallError=b;class S extends h.TypedEventEmitter{constructor(e){super(),(0,r.default)(this,"roomId",void 0),(0,r.default)(this,"callId",void 0),(0,r.default)(this,"state",p.Fledgling),(0,r.default)(this,"hangupParty",void 0),(0,r.default)(this,"hangupReason",void 0),(0,r.default)(this,"direction",void 0),(0,r.default)(this,"ourPartyId",void 0),(0,r.default)(this,"client",void 0),(0,r.default)(this,"forceTURN",void 0),(0,r.default)(this,"turnServers",void 0),(0,r.default)(this,"candidateSendQueue",[]),(0,r.default)(this,"candidateSendTries",0),(0,r.default)(this,"sentEndOfCandidates",!1),(0,r.default)(this,"peerConn",void 0),(0,r.default)(this,"feeds",[]),(0,r.default)(this,"usermediaSenders",[]),(0,r.default)(this,"screensharingSenders",[]),(0,r.default)(this,"inviteOrAnswerSent",!1),(0,r.default)(this,"waitForLocalAVStream",void 0),(0,r.default)(this,"successor",void 0),(0,r.default)(this,"opponentMember",void 0),(0,r.default)(this,"opponentVersion",void 0),(0,r.default)(this,"opponentPartyId",void 0),(0,r.default)(this,"opponentCaps",void 0),(0,r.default)(this,"inviteTimeout",void 0),(0,r.default)(this,"remoteOnHold",!1),(0,r.default)(this,"callStatsAtEnd",void 0),(0,r.default)(this,"makingOffer",!1),(0,r.default)(this,"ignoreOffer",void 0),(0,r.default)(this,"remoteCandidateBuffer",new Map),(0,r.default)(this,"remoteAssertedIdentity",void 0),(0,r.default)(this,"remoteSDPStreamMetadata",void 0),(0,r.default)(this,"callLengthInterval",void 0),(0,r.default)(this,"callLength",0),(0,r.default)(this,"gotLocalIceCandidate",(e=>{if(e.candidate){if(s.logger.debug("Call "+this.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),this.callHasEnded())return;""===e.candidate.candidate&&this.sentEndOfCandidates||(this.queueCandidate(e.candidate),""===e.candidate.candidate&&(this.sentEndOfCandidates=!0))}})),(0,r.default)(this,"onIceGatheringStateChange",(e=>{if(s.logger.debug("ice gathering state changed to "+this.peerConn.iceGatheringState),"complete"===this.peerConn.iceGatheringState&&!this.sentEndOfCandidates){const e={candidate:""};this.queueCandidate(e),this.sentEndOfCandidates=!0}})),(0,r.default)(this,"gotLocalOffer",(async e=>{if(s.logger.debug("Created offer: ",e),this.callHasEnded())return void s.logger.debug("Ignoring newly created offer on call ID "+this.callId+" because the call has ended");try{await this.peerConn.setLocalDescription(e)}catch(e){return s.logger.debug("Error setting local description!",e),void this.terminate(f.Local,y.SetLocalDescription,!0)}if("gathering"===this.peerConn.iceGatheringState&&await new Promise((e=>{setTimeout(e,200)})),this.callHasEnded())return;const t=this.state===p.CreateOffer?a.EventType.CallInvite:a.EventType.CallNegotiate,n={lifetime:6e4};this.state===p.CreateOffer?n.offer=this.peerConn.localDescription:n.description=this.peerConn.localDescription,n.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},n[c.SDPStreamMetadataKey]=this.getLocalSDPStreamMetadata(),s.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in offer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(t,n)}catch(e){s.logger.error("Failed to send invite",e),e.event&&this.client.cancelPendingEvent(e.event);let t=y.SignallingFailed,n="Signalling failed";return this.state===p.CreateOffer&&(t=y.SendInvite,n="Failed to send invite"),"UnknownDeviceError"==e.name&&(t=y.UnknownDevices,n="Unknown devices present in the room"),this.emit(v.Error,new b(t,n,e)),void this.terminate(f.Local,t,!1)}this.sendCandidateQueue(),this.state===p.CreateOffer&&(this.inviteOrAnswerSent=!0,this.setState(p.InviteSent),this.inviteTimeout=setTimeout((()=>{this.inviteTimeout=null,this.state===p.InviteSent&&this.hangup(y.InviteTimeout,!1)}),6e4))})),(0,r.default)(this,"getLocalOfferFailed",(e=>{s.logger.error("Failed to get local offer",e),this.emit(v.Error,new b(y.LocalOfferFailed,"Failed to get local offer!",e)),this.terminate(f.Local,y.LocalOfferFailed,!1)})),(0,r.default)(this,"getUserMediaFailed",(e=>{this.successor?this.successor.getUserMediaFailed(e):(s.logger.warn("Failed to get user media - ending call",e),this.emit(v.Error,new b(y.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),this.terminate(f.Local,y.NoUserMedia,!1))})),(0,r.default)(this,"onIceConnectionStateChanged",(()=>{this.callHasEnded()||(s.logger.debug("Call ID "+this.callId+": ICE connection state changed to: "+this.peerConn.iceConnectionState),"connected"==this.peerConn.iceConnectionState?(this.setState(p.Connected),this.callLengthInterval||(this.callLengthInterval=setInterval((()=>{this.callLength++,this.emit(v.LengthChanged,this.callLength)}),1e3))):"failed"==this.peerConn.iceConnectionState&&this.hangup(y.IceFailed,!1))})),(0,r.default)(this,"onSignallingStateChanged",(()=>{s.logger.debug("call "+this.callId+": Signalling state changed to: "+this.peerConn.signalingState)})),(0,r.default)(this,"onTrack",(e=>{if(0===e.streams.length)return void s.logger.warn(`Streamless ${e.track.kind} found: ignoring.`);const t=e.streams[0];this.pushRemoteFeed(t),t.addEventListener("removetrack",(()=>{0===t.getTracks().length&&(s.logger.info(`Stream ID ${t.id} has no tracks remaining - removing`),this.deleteFeedByStream(t))}))})),(0,r.default)(this,"onDataChannel",(e=>{this.emit(v.DataChannel,e.channel)})),(0,r.default)(this,"onNegotiationNeeded",(async()=>{if(s.logger.info("Negotiation is needed!"),this.state===p.CreateOffer||0!==this.opponentVersion){this.makingOffer=!0;try{this.getRidOfRTXCodecs();const e=await this.peerConn.createOffer();await this.gotLocalOffer(e)}catch(e){return void this.getLocalOfferFailed(e)}finally{this.makingOffer=!1}}else s.logger.info("Opponent does not support renegotiation: ignoring negotiationneeded event")})),(0,r.default)(this,"onHangupReceived",(e=>{s.logger.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(e)||this.state===p.Ringing?this.terminate(f.Remote,e.reason||y.UserHangup,!0):s.logger.info(`Ignoring message from party ID ${e.party_id}: our partner is ${this.opponentPartyId}`)})),(0,r.default)(this,"onRejectReceived",(e=>{s.logger.debug("Reject received for call ID "+this.callId),[p.InviteSent,p.Ringing].includes(this.state)||this.state===p.Fledgling&&this.direction===g.Inbound?this.terminate(f.Remote,e.reason||y.UserHangup,!0):s.logger.debug(`Call is in state: ${this.state}: ignoring reject`)})),(0,r.default)(this,"onAnsweredElsewhere",(e=>{s.logger.debug("Call ID "+this.callId+" answered elsewhere"),this.terminate(f.Remote,y.AnsweredElsewhere,!0)})),this.roomId=e.roomId,this.client=e.client,this.forceTURN=e.forceTURN,this.ourPartyId=this.client.deviceId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]});for(const e of this.turnServers)o.checkObjectHasKeys(e,["urls"]);this.callId=w()}async placeVoiceCall(){await this.placeCall(!0,!1)}async placeVideoCall(){await this.placeCall(!0,!0)}createDataChannel(e,t){const n=this.peerConn.createDataChannel(e,t);return this.emit(v.DataChannel,n),s.logger.debug("created data channel"),n}getOpponentMember(){return this.opponentMember}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get type(){return this.hasLocalUserMediaVideoTrack||this.hasRemoteUserMediaVideoTrack?m.Video:m.Voice}get hasLocalUserMediaVideoTrack(){var e;return(null===(e=this.localUsermediaStream)||void 0===e?void 0:e.getVideoTracks().length)>0}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some((e=>e.purpose===c.SDPStreamMetadataPurpose.Usermedia&&e.stream.getVideoTracks().length>0))}get hasLocalUserMediaAudioTrack(){var e;return(null===(e=this.localUsermediaStream)||void 0===e?void 0:e.getAudioTracks().length)>0}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some((e=>e.purpose===c.SDPStreamMetadataPurpose.Usermedia&&e.stream.getAudioTracks().length>0))}get localUsermediaFeed(){return this.getLocalFeeds().find((e=>e.purpose===c.SDPStreamMetadataPurpose.Usermedia))}get localScreensharingFeed(){return this.getLocalFeeds().find((e=>e.purpose===c.SDPStreamMetadataPurpose.Screenshare))}get localUsermediaStream(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}get localScreensharingStream(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find((e=>e.purpose===c.SDPStreamMetadataPurpose.Usermedia))}get remoteScreensharingFeed(){return this.getRemoteFeeds().find((e=>e.purpose===c.SDPStreamMetadataPurpose.Screenshare))}get remoteUsermediaStream(){var e;return null===(e=this.remoteUsermediaFeed)||void 0===e?void 0:e.stream}get remoteScreensharingStream(){var e;return null===(e=this.remoteScreensharingFeed)||void 0===e?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find((t=>t.stream.id===e))}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter((e=>e.isLocal()))}getRemoteFeeds(){return this.feeds.filter((e=>!e.isLocal()))}getLocalSDPStreamMetadata(){const e={};for(const t of this.getLocalFeeds())e[t.stream.id]={purpose:t.purpose,audio_muted:t.isAudioMuted(),video_muted:t.isVideoMuted()};return s.logger.debug("Got local SDPStreamMetadata",e),e}noIncomingFeeds(){return!this.feeds.some((e=>!e.isLocal()))}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata())return void this.pushRemoteFeedWithoutMetadata(e);const t=this.getOpponentMember().userId,n=this.remoteSDPStreamMetadata[e.id].purpose,i=this.remoteSDPStreamMetadata[e.id].audio_muted,r=this.remoteSDPStreamMetadata[e.id].video_muted;n?this.getFeedByStreamId(e.id)?s.logger.warn(`Ignoring stream with id ${e.id} because we already have a feed for it`):(this.feeds.push(new d.CallFeed({client:this.client,roomId:this.roomId,userId:t,stream:e,purpose:n,audioMuted:i,videoMuted:r})),this.emit(v.FeedsChanged,this.feeds),s.logger.info(`Pushed remote stream (id="${e.id}", active="${e.active}", purpose=${n})`)):s.logger.warn(`Ignoring stream with id ${e.id} because we didn't get any metadata about it`)}pushRemoteFeedWithoutMetadata(e){var t;const n=this.getOpponentMember().userId,i=c.SDPStreamMetadataPurpose.Usermedia,r=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;r&&e.id!==r.id?s.logger.warn(`Ignoring new stream ID ${e.id}: we already have stream ID ${r.id}`):this.getFeedByStreamId(e.id)?s.logger.warn(`Ignoring stream with id ${e.id} because we already have a feed for it`):(this.feeds.push(new d.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,stream:e,purpose:i})),this.emit(v.FeedsChanged,this.feeds),s.logger.info(`Pushed remote stream (id="${e.id}", active="${e.active}")`))}pushNewLocalFeed(e,t,n=!0){const i=this.client.getUserId();_(e.getAudioTracks(),!0),_(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)?s.logger.warn(`Ignoring stream with id ${e.id} because we already have a feed for it`):this.pushLocalFeed(new d.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:i,stream:e,purpose:t}),n)}pushLocalFeed(e,t=!0){if(this.feeds.push(e),t){const t=e.purpose===c.SDPStreamMetadataPurpose.Usermedia?this.usermediaSenders:this.screensharingSenders;t.splice(0,t.length);for(const n of e.stream.getTracks())s.logger.info(`Adding track (id="${n.id}", kind="${n.kind}", streamId="${e.stream.id}", streamPurpose="${e.purpose}", enabled=${n.enabled}) to peer connection`),t.push(this.peerConn.addTrack(n,e.stream))}s.logger.info(`Pushed local stream (id="${e.stream.id}", active="${e.stream.active}", purpose="${e.purpose}")`),this.emit(v.FeedsChanged,this.feeds)}removeLocalFeed(e){const t=e.purpose===c.SDPStreamMetadataPurpose.Usermedia?this.usermediaSenders:this.screensharingSenders;for(const e of t)this.peerConn.removeTrack(e);t.splice(0,t.length),this.deleteFeedByStream(e.stream)}deleteAllFeeds(){for(const e of this.feeds)e.dispose();this.feeds=[],this.emit(v.FeedsChanged,this.feeds)}deleteFeedByStream(e){s.logger.debug(`Removing feed with stream id ${e.id}`);const t=this.getFeedByStreamId(e.id);t?(t.dispose(),this.feeds.splice(this.feeds.indexOf(t),1),this.emit(v.FeedsChanged,this.feeds)):s.logger.warn(`Didn't find the feed with stream id ${e.id} to delete`)}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),t=[];return e.forEach((e=>{t.push(e)})),t}async initWithInvite(e){var t;const n=e.getContent();this.direction=g.Inbound,await this.client.checkTurnServers()||s.logger.warn("Failed to get TURN credentials! Proceeding with call anyway...");const i=n[c.SDPStreamMetadataKey];i?this.updateRemoteSDPStreamMetadata(i):s.logger.debug("Did not get any SDPStreamMetadata! Can not send/receive multiple streams"),this.peerConn=this.createPeerConnection(),this.chooseOpponent(e);try{await this.peerConn.setRemoteDescription(n.offer),await this.addBufferedIceCandidates()}catch(e){return s.logger.debug("Failed to set remote description",e),void this.terminate(f.Local,y.SetRemoteDescription,!1)}const r=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;if(!r||0===r.getTracks().length)return s.logger.error("No remote stream or no tracks after setting remote description!"),void this.terminate(f.Local,y.SetRemoteDescription,!1);this.setState(p.Ringing),e.getLocalAge()&&setTimeout((()=>{this.state==p.Ringing&&(s.logger.debug("Call invite has expired. Hanging up."),this.hangupParty=f.Remote,this.setState(p.Ended),this.stopAllMedia(),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit(v.Hangup))}),n.lifetime-e.getLocalAge())}initWithHangup(e){this.setState(p.Ended)}shouldAnswerWithMediaType(e,t,n){return e&&!t?(s.logger.warn(`Unable to answer with ${n} because the other side isn't sending it either.`),!1):o.isNullOrUndefined(e)||e===t||this.opponentSupportsSDPStreamMetadata()?null!=e?e:t:(s.logger.warn(`Unable to answer with ${n}=${e} because the other side doesn't support it. Answering with ${n}=${t}.`),t)}async answer(e,t){if(!this.inviteOrAnswerSent){if(!1===e&&!1===t)throw new Error("You CANNOT answer a call without media");if(s.logger.debug(`Answering call ${this.callId}`),this.localUsermediaStream||this.waitForLocalAVStream)this.waitForLocalAVStream&&this.setState(p.WaitLocalMedia);else{const n=this.state,i=this.shouldAnswerWithMediaType(e,this.hasRemoteUserMediaAudioTrack,"audio"),r=this.shouldAnswerWithMediaType(t,this.hasRemoteUserMediaVideoTrack,"video");this.setState(p.WaitLocalMedia),this.waitForLocalAVStream=!0;try{const e=await this.client.getMediaHandler().getUserMediaStream(i,r);this.waitForLocalAVStream=!1;const t=[new d.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),stream:e,purpose:c.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1})];this.localScreensharingFeed&&t.push(this.localScreensharingFeed),this.answerWithCallFeeds(t)}catch(e){if(!r)return void this.getUserMediaFailed(e);s.logger.warn("Failed to getUserMedia(), trying to getUserMedia() without video"),this.setState(n),this.waitForLocalAVStream=!1,await this.answer(i,!1)}}}}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.gotCallFeedsForAnswer(e)}replacedBy(e){this.state===p.WaitLocalMedia?(s.logger.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):[p.CreateOffer,p.InviteSent].includes(this.state)&&(s.logger.debug("Handing local stream to new call"),e.gotCallFeedsForAnswer(this.getLocalFeeds())),this.successor=e,this.emit(v.Replaced,e),this.hangup(y.Replaced,!0)}hangup(e,t){if(this.callHasEnded())return;if(s.logger.debug("Ending call "+this.callId),this.terminate(f.Local,e,!t),this.state===p.WaitLocalMedia)return;const n={};(this.opponentVersion&&0!==this.opponentVersion||e!==y.UserHangup)&&(n.reason=e),this.sendVoipEvent(a.EventType.CallHangup,n)}reject(){if(this.state!==p.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(0===this.opponentVersion)return s.logger.info(`Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(y.UserHangup,!0);s.logger.debug("Rejecting call: "+this.callId),this.terminate(f.Local,y.UserHangup,!0),this.sendVoipEvent(a.EventType.CallReject,{})}async upgradeCall(e,t){if((e||t)&&this.opponentSupportsSDPStreamMetadata())try{const n=e||this.hasLocalUserMediaAudioTrack,i=t||this.hasLocalUserMediaVideoTrack,r=await this.client.getMediaHandler().getUserMediaStream(n,i,!1);await this.updateLocalUsermediaStream(r,e,t)}catch(e){s.logger.error("Failed to upgrade the call",e),this.emit(v.Error,new b(y.NoUserMedia,"Failed to get camera access: ",e))}}opponentSupportsSDPStreamMetadata(){return Boolean(this.remoteSDPStreamMetadata)}isScreensharing(){return Boolean(this.localScreensharingStream)}async setScreensharingEnabled(e,t){if(e&&this.isScreensharing())return s.logger.warn("There is already a screensharing stream - there is nothing to do!"),!0;if(!e&&!this.isScreensharing())return s.logger.warn("There already isn't a screensharing stream - there is nothing to do!"),!1;if(!this.opponentSupportsSDPStreamMetadata())return this.setScreensharingEnabledWithoutMetadataSupport(e,t);if(s.logger.debug(`Set screensharing enabled? ${e}`),!e){for(const e of this.screensharingSenders)this.peerConn.removeTrack(e);return this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{const e=await this.client.getMediaHandler().getScreensharingStream(t);return!!e&&(this.pushNewLocalFeed(e,c.SDPStreamMetadataPurpose.Screenshare),!0)}catch(e){return s.logger.error("Failed to get screen-sharing stream:",e),!1}}async setScreensharingEnabledWithoutMetadataSupport(e,t){if(s.logger.debug(`Set screensharing enabled? ${e} using replaceTrack()`),!e){const e=this.localUsermediaStream.getTracks().find((e=>"video"===e.kind));return this.usermediaSenders.find((e=>{var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)})).replaceTrack(e),this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{const e=await this.client.getMediaHandler().getScreensharingStream(t);if(!e)return!1;const n=e.getTracks().find((e=>"video"===e.kind));return this.usermediaSenders.find((e=>{var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)})).replaceTrack(n),this.pushNewLocalFeed(e,c.SDPStreamMetadataPurpose.Screenshare,!1),!0}catch(e){return s.logger.error("Failed to get screen-sharing stream:",e),!1}}async updateLocalUsermediaStream(e,t=!1,n=!1){const i=this.localUsermediaFeed,r=t||!i.isAudioMuted()&&!this.remoteOnHold,o=n||!i.isVideoMuted()&&!this.remoteOnHold;_(e.getAudioTracks(),r),_(e.getVideoTracks(),o);for(const e of this.localUsermediaStream.getTracks())this.localUsermediaStream.removeTrack(e),e.stop();for(const t of e.getTracks())this.localUsermediaStream.addTrack(t);const a=[];for(const t of e.getTracks()){const n=this.usermediaSenders.find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.kind)===t.kind}));let r;n?(s.logger.info(`Replacing track (id="${t.id}", kind="${t.kind}", streamId="${e.id}", streamPurpose="${i.purpose}") to peer connection`),await n.replaceTrack(t),r=n):(s.logger.info(`Adding track (id="${t.id}", kind="${t.kind}", streamId="${e.id}", streamPurpose="${i.purpose}") to peer connection`),r=this.peerConn.addTrack(t,this.localUsermediaStream)),a.push(r)}this.usermediaSenders=a}async setLocalVideoMuted(e){var t;return await this.client.getMediaHandler().hasVideoDevice()?this.hasLocalUserMediaVideoTrack||e?(null===(t=this.localUsermediaFeed)||void 0===t||t.setAudioVideoMuted(null,e),this.updateMuteStatus(),this.isLocalVideoMuted()):(await this.upgradeCall(!1,!0),this.isLocalVideoMuted()):this.isLocalVideoMuted()}isLocalVideoMuted(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isVideoMuted()}async setMicrophoneMuted(e){var t;return await this.client.getMediaHandler().hasAudioDevice()?this.hasLocalUserMediaAudioTrack||e?(null===(t=this.localUsermediaFeed)||void 0===t||t.setAudioVideoMuted(e,null),this.updateMuteStatus(),this.isMicrophoneMuted()):(await this.upgradeCall(!0,!1),this.isMicrophoneMuted()):this.isMicrophoneMuted()}isMicrophoneMuted(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isAudioMuted()}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(const t of this.peerConn.getTransceivers())t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.emit(v.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==p.Connected)return!1;let e=!0;for(const t of this.peerConn.getTransceivers())["inactive","recvonly"].includes(t.currentDirection)||(e=!1);return e}sendDtmfDigit(e){for(const t of this.peerConn.getSenders())if("audio"===t.track.kind&&t.dtmf)return void t.dtmf.insertDTMF(e);throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){this.sendVoipEvent(a.EventType.CallSDPStreamMetadataChangedPrefix,{[c.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()});const e=this.isMicrophoneMuted()||this.remoteOnHold,t=this.isLocalVideoMuted()||this.remoteOnHold;_(this.localUsermediaStream.getAudioTracks(),!e),_(this.localUsermediaStream.getVideoTracks(),!t)}gotCallFeedsForInvite(e){if(this.successor)this.successor.gotCallFeedsForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{for(const t of e)this.pushLocalFeed(t);this.setState(p.CreateOffer),s.logger.debug("gotUserMediaForInvite")}}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type},[c.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()};e.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},s.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in answer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(a.EventType.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(e){this.setState(p.Ringing),this.client.cancelPendingEvent(e.event);let t=y.SendAnswer,n="Failed to send answer";throw"UnknownDeviceError"==e.name&&(t=y.UnknownDevices,n="Unknown devices present in the room"),this.emit(v.Error,new b(t,n,e)),e}this.sendCandidateQueue()}async gotCallFeedsForAnswer(e){if(this.callHasEnded())return;this.waitForLocalAVStream=!1;for(const t of e)this.pushLocalFeed(t);let t;this.setState(p.CreateAnswer);try{this.getRidOfRTXCodecs(),t=await this.peerConn.createAnswer()}catch(e){return s.logger.debug("Failed to create answer: ",e),void this.terminate(f.Local,y.CreateAnswer,!0)}try{await this.peerConn.setLocalDescription(t),this.setState(p.Connecting),await new Promise((e=>{setTimeout(e,200)})),this.sendAnswer()}catch(e){return s.logger.debug("Error setting local description!",e),void this.terminate(f.Local,y.SetLocalDescription,!0)}}async onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const t=e.getContent(),n=t.candidates;if(!n)return void s.logger.info("Ignoring candidates event with no candidates!");const i=0===t.version?null:t.party_id||null;if(void 0===this.opponentPartyId){s.logger.info(`Buffering ${n.length} candidates until we pick an opponent`);const e=this.remoteCandidateBuffer.get(i)||[];return e.push(...n),void this.remoteCandidateBuffer.set(i,e)}this.partyIdMatches(t)?await this.addIceCandidates(n):s.logger.info(`Ignoring candidates from party ID ${t.party_id}: we have chosen party ID ${this.opponentPartyId}`)}async onAnswerReceived(e){const t=e.getContent();if(s.logger.debug(`Got answer for call ID ${this.callId} from party ID ${t.party_id}`),this.callHasEnded())return void s.logger.debug(`Ignoring answer because call ID ${this.callId} has ended`);if(void 0!==this.opponentPartyId)return void s.logger.info(`Ignoring answer from party ID ${t.party_id}: we already have an answer/reject from ${this.opponentPartyId}`);this.chooseOpponent(e),await this.addBufferedIceCandidates(),this.setState(p.Connecting);const n=t[c.SDPStreamMetadataKey];n?this.updateRemoteSDPStreamMetadata(n):s.logger.warn("Did not get any SDPStreamMetadata! Can not send/receive multiple streams");try{await this.peerConn.setRemoteDescription(t.answer)}catch(e){return s.logger.debug("Failed to set remote description",e),void this.terminate(f.Local,y.SetRemoteDescription,!1)}if(null!==this.opponentPartyId)try{await this.sendVoipEvent(a.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(e){s.logger.warn("Failed to send select_answer event",e)}}async onSelectAnswerReceived(e){if(this.direction!==g.Inbound)return void s.logger.warn("Got select_answer for an outbound call: ignoring");const t=e.getContent().selected_party_id;null!=t?t!==this.ourPartyId&&(s.logger.info(`Got select_answer for party ID ${t}: we are party ID ${this.ourPartyId}.`),await this.terminate(f.Remote,y.AnsweredElsewhere,!0)):s.logger.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring")}async onNegotiateReceived(e){const t=e.getContent(),n=t.description;if(!n||!n.sdp||!n.type)return void s.logger.info("Ignoring invalid m.call.negotiate event");const i=this.direction===g.Inbound,r="offer"===n.type&&(this.makingOffer||"stable"!==this.peerConn.signalingState);if(this.ignoreOffer=!i&&r,this.ignoreOffer)return void s.logger.info("Ignoring colliding negotiate event because we're impolite");const o=this.isLocalOnHold(),l=t[c.SDPStreamMetadataKey];l?this.updateRemoteSDPStreamMetadata(l):s.logger.warn("Received negotiation event without SDPStreamMetadata!");try{if(await this.peerConn.setRemoteDescription(n),"offer"===n.type){this.getRidOfRTXCodecs();const e=await this.peerConn.createAnswer();await this.peerConn.setLocalDescription(e),this.sendVoipEvent(a.EventType.CallNegotiate,{description:this.peerConn.localDescription,[c.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()})}}catch(e){s.logger.warn("Failed to complete negotiation",e)}const d=this.isLocalOnHold();o!==d&&(this.emit(v.LocalHoldUnhold,d),this.emit(v.HoldUnhold,d))}updateRemoteSDPStreamMetadata(e){this.remoteSDPStreamMetadata=o.recursivelyAssign(this.remoteSDPStreamMetadata||{},e,!0);for(const e of this.getRemoteFeeds()){var t;const n=e.stream.id,i=this.remoteSDPStreamMetadata[n];e.setAudioVideoMuted(null==i?void 0:i.audio_muted,null==i?void 0:i.video_muted),e.purpose=null===(t=this.remoteSDPStreamMetadata[n])||void 0===t?void 0:t.purpose}}onSDPStreamMetadataChangedReceived(e){const t=e.getContent()[c.SDPStreamMetadataKey];this.updateRemoteSDPStreamMetadata(t)}async onAssertedIdentityReceived(e){const t=e.getContent();t.asserted_identity&&(this.remoteAssertedIdentity={id:t.asserted_identity.id,displayName:t.asserted_identity.display_name},this.emit(v.AssertedIdentityChanged))}callHasEnded(){return this.state===p.Ended}getRidOfRTXCodecs(){if(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)return;const e=RTCRtpReceiver.getCapabilities("video").codecs,t=[...RTCRtpSender.getCapabilities("video").codecs,...e];for(const e of t)if("video/rtx"===e.mimeType){const n=t.indexOf(e);t.splice(n,1)}for(const e of this.peerConn.getTransceivers()){var n,i;!this.screensharingSenders.includes(e.sender)||"video"!==(null===(n=e.sender.track)||void 0===n?void 0:n.kind)&&"video"!==(null===(i=e.receiver.track)||void 0===i?void 0:i.kind)||e.setCodecPreferences(t)}}setState(e){const t=this.state;this.state=e,this.emit(v.State,e,t)}sendVoipEvent(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:"1",call_id:this.callId,party_id:this.ourPartyId}))}queueCandidate(e){if(this.candidateSendQueue.push(e),this.state===p.Ringing||!this.inviteOrAnswerSent)return;const t=this.direction===g.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((()=>{this.sendCandidateQueue()}),t)}async transfer(e){const t=await this.client.getProfileInfo(e),n=w(),i={replacement_id:w(),target_user:{id:e,display_name:t.displayname,avatar_url:t.avatar_url},create_call:n};await this.sendVoipEvent(a.EventType.CallReplaces,i),await this.terminate(f.Local,y.Transfered,!0)}async transferToCall(e){const t=await this.client.getProfileInfo(e.getOpponentMember().userId),n=await this.client.getProfileInfo(this.getOpponentMember().userId),i=w(),r={replacement_id:w(),target_user:{id:this.getOpponentMember().userId,display_name:n.displayname,avatar_url:n.avatar_url},await_call:i};await e.sendVoipEvent(a.EventType.CallReplaces,r);const s={replacement_id:w(),target_user:{id:e.getOpponentMember().userId,display_name:t.displayname,avatar_url:t.avatar_url},create_call:i};await this.sendVoipEvent(a.EventType.CallReplaces,s),await this.terminate(f.Local,y.Transfered,!0),await e.terminate(f.Local,y.Transfered,!0)}async terminate(e,t,n){this.callHasEnded()||(this.callStatsAtEnd=await this.collectCallStats(),this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=null),this.callLengthInterval&&(clearInterval(this.callLengthInterval),this.callLengthInterval=null),t!==y.Replaced&&this.stopAllMedia(),this.deleteAllFeeds(),this.hangupParty=e,this.hangupReason=t,this.setState(p.Ended),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),n&&this.emit(v.Hangup))}stopAllMedia(){s.logger.debug("Stopping all media for call",this.callId);for(const e of this.feeds)if(e.isLocal()&&e.purpose===c.SDPStreamMetadataPurpose.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===c.SDPStreamMetadataPurpose.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else{s.logger.debug("Stopping remote stream",e.stream.id);for(const t of e.stream.getTracks())t.stop()}}checkForErrorListener(){if(0===this.listeners(h.EventEmitterEvents.Error).length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(0===this.candidateSendQueue.length)return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const t={candidates:e};s.logger.debug("Attempting to send "+e.length+" candidates");try{await this.sendVoipEvent(a.EventType.CallCandidates,t),this.candidateSendTries=0}catch(t){if(t.event&&this.client.cancelPendingEvent(t.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){s.logger.debug("Failed to send candidates on attempt "+this.candidateSendTries+". Giving up on this call.",t);const e=y.SignallingFailed,n="Signalling failed";return this.emit(v.Error,new b(e,n,t)),void this.hangup(e,!1)}const n=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,s.logger.debug("Failed to send candidates. Retrying in "+n+"ms",t),setTimeout((()=>{this.sendCandidateQueue()}),n)}}async placeCall(e,t){if(!e)throw new Error("You CANNOT start a call without audio");this.setState(p.WaitLocalMedia);try{const n=await this.client.getMediaHandler().getUserMediaStream(e,t);_(n.getAudioTracks(),!0),_(n.getVideoTracks(),!0);const i=new d.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),stream:n,purpose:c.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1});await this.placeCallWithCallFeeds([i])}catch(e){return void this.getUserMediaFailed(e)}}async placeCallWithCallFeeds(e){this.checkForErrorListener(),this.direction=g.Outbound,this.client.callEventHandler.calls.set(this.callId,this),await this.client.checkTurnServers()||s.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection(),this.gotCallFeedsForInvite(e)}createPeerConnection(){const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e.addEventListener("datachannel",this.onDataChannel),e}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){const t=e.getContent();s.logger.debug(`Choosing party ID ${t.party_id} for call ID ${this.callId}`),this.opponentVersion=t.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=e.sender}async addBufferedIceCandidates(){const e=this.remoteCandidateBuffer.get(this.opponentPartyId);e&&(s.logger.info(`Adding ${e.length} buffered candidates for opponent ${this.opponentPartyId}`),await this.addIceCandidates(e)),this.remoteCandidateBuffer=null}async addIceCandidates(e){for(const t of e)if(null!==t.sdpMid&&void 0!==t.sdpMid||null!==t.sdpMLineIndex&&void 0!==t.sdpMLineIndex){s.logger.debug("Call "+this.callId+" got remote ICE "+t.sdpMid+" candidate: "+t.candidate);try{await this.peerConn.addIceCandidate(t)}catch(e){this.ignoreOffer||s.logger.info("Failed to add remote ICE candidate",e)}}else s.logger.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex")}get hasPeerConnection(){return Boolean(this.peerConn)}}function _(e,t){for(let n=0;n<e.length;n++)e[n].enabled=t}function E(){if("undefined"==typeof window||"undefined"==typeof document)return!1;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return s.logger.error("WebRTC is not supported in this browser / environment"),!1}catch(e){return s.logger.error("Exception thrown when trying to access WebRTC",e),!1}return!0}t.MatrixCall=S},2931:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventHandlerEvent=t.CallEventHandler=void 0;var r=i(n(8416)),s=n(4369),o=n(7434),a=n(9679),l=n(2481),c=n(2168),d=n(4551),h=n(7366);let u;t.CallEventHandlerEvent=u,function(e){e.Incoming="Call.incoming"}(u||(t.CallEventHandlerEvent=u={})),t.CallEventHandler=class{constructor(e){(0,r.default)(this,"client",void 0),(0,r.default)(this,"calls",void 0),(0,r.default)(this,"callEventBuffer",void 0),(0,r.default)(this,"candidateEventsByCall",void 0),(0,r.default)(this,"evaluateEventBuffer",(async()=>{if(this.client.getSyncState()===d.SyncState.Syncing){await Promise.all(this.callEventBuffer.map((e=>{this.client.decryptEventIfNeeded(e)})));const e=new Set;for(const t of this.callEventBuffer)t.getType()!==l.EventType.CallAnswer&&t.getType()!==l.EventType.CallHangup||e.add(t.getContent().call_id);for(const t of this.callEventBuffer)if(t.getType()!==l.EventType.CallInvite||!e.has(t.getContent().call_id))try{await this.handleCallEvent(t)}catch(e){o.logger.error("Caught exception handling call event",e)}this.callEventBuffer=[]}})),(0,r.default)(this,"onRoomTimeline",(e=>{this.client.decryptEventIfNeeded(e),(this.eventIsACall(e)||e.isBeingDecrypted())&&this.callEventBuffer.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once(s.MatrixEventEvent.Decrypted,(async()=>{if(this.eventIsACall(e))if(this.callEventBuffer.includes(e))this.evaluateEventBuffer();else try{await this.handleCallEvent(e)}catch(e){o.logger.error("Caught exception handling call event",e)}}))})),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(c.ClientEvent.Sync,this.evaluateEventBuffer),this.client.on(h.RoomEvent.Timeline,this.onRoomTimeline)}stop(){this.client.removeListener(c.ClientEvent.Sync,this.evaluateEventBuffer),this.client.removeListener(h.RoomEvent.Timeline,this.onRoomTimeline)}eventIsACall(e){const t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")}async handleCallEvent(e){const t=e.getContent(),n=e.getType(),i=e.getSender()===this.client.credentials.userId;let r=t.call_id?this.calls.get(t.call_id):void 0;if(n!==l.EventType.CallInvite)if(n!==l.EventType.CallCandidates)if([l.EventType.CallHangup,l.EventType.CallReject].includes(n))r?r.state!==a.CallState.Ended&&(n===l.EventType.CallHangup?r.onHangupReceived(t):r.onRejectReceived(t),r.state===a.CallState.Ended&&this.calls.delete(t.call_id)):(r=(0,a.createNewMatrixCall)(this.client,e.getRoomId()),r&&(r.callId=t.call_id,r.initWithHangup(e),this.calls.set(t.call_id,r)));else if(r&&r.hasPeerConnection){if(e.getContent().party_id!==r.ourPartyId)switch(n){case l.EventType.CallAnswer:i?r.state===a.CallState.Ringing&&r.onAnsweredElsewhere(t):r.onAnswerReceived(e);break;case l.EventType.CallSelectAnswer:r.onSelectAnswerReceived(e);break;case l.EventType.CallNegotiate:r.onNegotiateReceived(e);break;case l.EventType.CallAssertedIdentity:case l.EventType.CallAssertedIdentityPrefix:r.onAssertedIdentityReceived(e);break;case l.EventType.CallSDPStreamMetadataChanged:case l.EventType.CallSDPStreamMetadataChangedPrefix:r.onSDPStreamMetadataChangedReceived(e)}}else o.logger.info(`Discarding possible call event ${e.getId()} as we don't have a call/peerConn`,n);else{if(i)return;r?r.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e))}else{if(i)return;if(e.getLocalAge()>t.lifetime-3e3)return;if(r&&r.state===a.CallState.Ended)return;r&&o.logger.log(`WARN: Already have a MatrixCall with id ${t.call_id} but got an invite. Clobbering.`);const n=this.client.getTurnServersExpiry()-Date.now();if(o.logger.info("Current turn creds expire in "+n+" ms"),r=(0,a.createNewMatrixCall)(this.client,e.getRoomId(),{forceTURN:this.client.forceTURN}),!r)return void o.logger.log("Incoming call ID "+t.call_id+" but this client doesn't support WebRTC");if(r.callId=t.call_id,await r.initWithInvite(e),this.calls.set(r.callId,r),this.candidateEventsByCall.get(r.callId))for(const e of this.candidateEventsByCall.get(r.callId))r.onRemoteIceCandidatesReceived(e);let s;for(const e of this.calls.values()){const t=[a.CallState.WaitLocalMedia,a.CallState.CreateOffer,a.CallState.InviteSent].includes(e.state);if(r.roomId===e.roomId&&e.direction===a.CallDirection.Outbound&&t){s=e;break}}s?s.state===a.CallState.WaitLocalMedia||s.state===a.CallState.CreateOffer||s.callId>r.callId?(o.logger.log("Glare detected: answering incoming call "+r.callId+" and canceling outgoing call "+s.callId),s.replacedBy(r),r.answer()):(o.logger.log("Glare detected: rejecting incoming call "+r.callId+" and keeping outgoing call "+s.callId),r.hangup(a.CallErrorCode.Replaced,!0)):this.client.emit(u.Incoming,r)}}}},5964:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.SDPStreamMetadataPurpose=t.SDPStreamMetadataKey=void 0,t.SDPStreamMetadataKey="org.matrix.msc3077.sdp_stream_metadata",t.SDPStreamMetadataPurpose=n,function(e){e.Usermedia="m.usermedia",e.Screenshare="m.screenshare"}(n||(t.SDPStreamMetadataPurpose=n={}))},9704:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.SPEAKING_THRESHOLD=t.CallFeedEvent=t.CallFeed=void 0;var r=i(n(8416)),s=n(5861);let o;t.SPEAKING_THRESHOLD=-60,t.CallFeedEvent=o,function(e){e.NewStream="new_stream",e.MuteStateChanged="mute_state_changed",e.VolumeChanged="volume_changed",e.Speaking="speaking"}(o||(t.CallFeedEvent=o={}));class a extends s.TypedEventEmitter{constructor(e){super(),(0,r.default)(this,"stream",void 0),(0,r.default)(this,"userId",void 0),(0,r.default)(this,"purpose",void 0),(0,r.default)(this,"speakingVolumeSamples",void 0),(0,r.default)(this,"client",void 0),(0,r.default)(this,"roomId",void 0),(0,r.default)(this,"audioMuted",void 0),(0,r.default)(this,"videoMuted",void 0),(0,r.default)(this,"measuringVolumeActivity",!1),(0,r.default)(this,"audioContext",void 0),(0,r.default)(this,"analyser",void 0),(0,r.default)(this,"frequencyBinCount",void 0),(0,r.default)(this,"speakingThreshold",-60),(0,r.default)(this,"speaking",!1),(0,r.default)(this,"volumeLooperTimeout",void 0),(0,r.default)(this,"onAddTrack",(()=>{this.emit(o.NewStream,this.stream)})),(0,r.default)(this,"volumeLooper",(()=>{if(!this.analyser)return;if(!this.measuringVolumeActivity)return;this.analyser.getFloatFrequencyData(this.frequencyBinCount);let e=-1/0;for(let t=0;t<this.frequencyBinCount.length;t++)this.frequencyBinCount[t]>e&&(e=this.frequencyBinCount[t]);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(e),this.emit(o.VolumeChanged,e);let t=!1;for(let e=0;e<this.speakingVolumeSamples.length;e++)if(this.speakingVolumeSamples[e]>this.speakingThreshold){t=!0;break}this.speaking!==t&&(this.speaking=t,this.emit(o.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,200)})),this.client=e.client,this.roomId=e.roomId,this.userId=e.userId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(8).fill(-1/0),this.updateStream(null,e.stream),this.hasAudioTrack&&this.initVolumeMeasuring()}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,t){t!==e&&(e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),t&&(this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?this.initVolumeMeasuring():this.measureVolumeActivity(!1)),this.emit(o.NewStream,this.stream))}initVolumeMeasuring(){const e=window.AudioContext||window.webkitAudioContext;this.hasAudioTrack&&e&&(this.audioContext=new e,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}getMember(){return this.client.getRoom(this.roomId).getMember(this.userId)}isLocal(){return this.userId===this.client.getUserId()}isAudioMuted(){return 0===this.stream.getAudioTracks().length||this.audioMuted}isVideoMuted(){return 0===this.stream.getVideoTracks().length||this.videoMuted}isSpeaking(){return this.speaking}setAudioVideoMuted(e,t){null!==e&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),null!==t&&(this.videoMuted=t),this.emit(o.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!(this.audioContext&&this.analyser&&this.frequencyBinCount&&this.hasAudioTrack))return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(o.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}dispose(){clearTimeout(this.volumeLooperTimeout)}}t.CallFeed=a},7626:(e,t,n)=>{"use strict";var i=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandler=void 0;var r=i(n(8416)),s=n(7434),o=n(9679);t.MediaHandler=class{constructor(e){this.client=e,(0,r.default)(this,"audioInput",void 0),(0,r.default)(this,"videoInput",void 0),(0,r.default)(this,"localUserMediaStream",void 0),(0,r.default)(this,"userMediaStreams",[]),(0,r.default)(this,"screensharingStreams",[])}async setAudioInput(e){s.logger.info("LOG setting audio input to",e),this.audioInput!==e&&(this.audioInput=e,await this.updateLocalUsermediaStreams())}async setVideoInput(e){s.logger.info("LOG setting video input to",e),this.videoInput!==e&&(this.videoInput=e,await this.updateLocalUsermediaStreams())}async updateLocalUsermediaStreams(){if(0===this.userMediaStreams.length)return;const e=new Map;for(const t of this.client.callEventHandler.calls.values())e.set(t.callId,{audio:t.hasLocalUserMediaAudioTrack,video:t.hasLocalUserMediaVideoTrack});for(const t of this.client.callEventHandler.calls.values()){if(t.state===o.CallState.Ended||!e.has(t.callId))continue;const{audio:n,video:i}=e.get(t.callId),r=await this.getUserMediaStream(n,i,!1);await t.updateLocalUsermediaStream(r)}}async hasAudioDevice(){return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)).length>0}async hasVideoDevice(){return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).length>0}async getUserMediaStream(e,t,n=!0){var i,r,o,a;const l=e&&await this.hasAudioDevice(),c=t&&await this.hasVideoDevice();let d;if(!this.localUserMediaStream||0===this.localUserMediaStream.getAudioTracks().length&&l||0===this.localUserMediaStream.getVideoTracks().length&&c||(null===(i=this.localUserMediaStream.getAudioTracks()[0])||void 0===i||null===(r=i.getSettings())||void 0===r?void 0:r.deviceId)!==this.audioInput||(null===(o=this.localUserMediaStream.getVideoTracks()[0])||void 0===o||null===(a=o.getSettings())||void 0===a?void 0:a.deviceId)!==this.videoInput){const e=this.getUserMediaContraints(l,c);s.logger.log("Getting user media with constraints",e),d=await navigator.mediaDevices.getUserMedia(e);for(const e of d.getTracks()){const t=e.getSettings();"audio"===e.kind?this.audioInput=t.deviceId:"video"===e.kind&&(this.videoInput=t.deviceId)}n&&(this.localUserMediaStream=d)}else{if(d=this.localUserMediaStream.clone(),!l)for(const e of d.getAudioTracks())d.removeTrack(e);if(!c)for(const e of d.getVideoTracks())d.removeTrack(e)}return n&&this.userMediaStreams.push(d),d}stopUserMediaStream(e){s.logger.debug("Stopping usermedia stream",e.id);for(const t of e.getTracks())t.stop();const t=this.userMediaStreams.indexOf(e);-1!==t&&(s.logger.debug("Splicing usermedia stream out stream array",e.id),this.userMediaStreams.splice(t,1)),this.localUserMediaStream===e&&(this.localUserMediaStream=void 0)}async getScreensharingStream(e,t=!0){let n;if(0===this.screensharingStreams.length){const t=this.getScreenshareContraints(e);if(!t)return null;e?(s.logger.debug("Getting screensharing stream using getUserMedia()",e),n=await navigator.mediaDevices.getUserMedia(t)):(s.logger.debug("Getting screensharing stream using getDisplayMedia()"),n=await navigator.mediaDevices.getDisplayMedia(t))}else{const e=this.screensharingStreams[this.screensharingStreams.length-1];s.logger.log("Cloning screensharing stream",e.id),n=e.clone()}return t&&this.screensharingStreams.push(n),n}stopScreensharingStream(e){s.logger.debug("Stopping screensharing stream",e.id);for(const t of e.getTracks())t.stop();const t=this.screensharingStreams.indexOf(e);-1!==t&&(s.logger.debug("Splicing screensharing stream out stream array",e.id),this.screensharingStreams.splice(t,1))}stopAllStreams(){for(const e of this.userMediaStreams)for(const t of e.getTracks())t.stop();for(const e of this.screensharingStreams)for(const t of e.getTracks())t.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0}getUserMediaContraints(e,t){const n=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:n?{exact:640}:{ideal:640},height:n?{exact:360}:{ideal:360}}}}getScreenshareContraints(e){return e?(s.logger.debug("Using desktop capturer source",e),{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}}}):(s.logger.debug("Not using desktop capturer source"),{audio:!1,video:!0})}}},729:e=>{"use strict";var t={};function n(e,i,r){var s,o,a,l,c,d="";for("string"!=typeof i&&(r=i,i=n.defaultChars),void 0===r&&(r=!0),c=function(e){var n,i,r=t[e];if(r)return r;for(r=t[e]=[],n=0;n<128;n++)i=String.fromCharCode(n),/^[0-9a-z]$/i.test(i)?r.push(i):r.push("%"+("0"+n.toString(16).toUpperCase()).slice(-2));for(n=0;n<e.length;n++)r[e.charCodeAt(n)]=e[n];return r}(i),s=0,o=e.length;s<o;s++)if(a=e.charCodeAt(s),r&&37===a&&s+2<o&&/^[0-9a-f]{2}$/i.test(e.slice(s+1,s+3)))d+=e.slice(s,s+3),s+=2;else if(a<128)d+=c[a];else if(a>=55296&&a<=57343){if(a>=55296&&a<=56319&&s+1<o&&(l=e.charCodeAt(s+1))>=56320&&l<=57343){d+=encodeURIComponent(e[s]+e[s+1]),s++;continue}d+="%EF%BF%BD"}else d+=encodeURIComponent(e[s]);return d}n.defaultChars=";/?:@&=+$,-_.!~*'()#",n.componentChars="-_.!~*'()",e.exports=n},631:(e,t,n)=>{var i="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=i&&r&&"function"==typeof r.get?r.get:null,o=i&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=a&&l&&"function"==typeof l.get?l.get:null,d=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,u="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,g=Object.prototype.toString,f=Function.prototype.toString,v=String.prototype.match,y=String.prototype.slice,b=String.prototype.replace,w=String.prototype.toUpperCase,S=String.prototype.toLowerCase,_=RegExp.prototype.test,E=Array.prototype.concat,k=Array.prototype.join,x=Array.prototype.slice,T=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,A=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,R="function"==typeof Symbol&&"object"==typeof Symbol.iterator,P="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,M=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function D(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||_.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var i=e<0?-T(-e):T(e);if(i!==e){var r=String(i),s=y.call(t,r.length+1);return b.call(r,n,"$&_")+"."+b.call(b.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var L=n(4654),F=L.custom,N=z(F)?F:null;function j(e,t,n){var i="double"===(n.quoteStyle||t)?'"':"'";return i+e+i}function B(e){return b.call(String(e),/"/g,"&quot;")}function U(e){return!("[object Array]"!==H(e)||P&&"object"==typeof e&&P in e)}function q(e){return!("[object RegExp]"!==H(e)||P&&"object"==typeof e&&P in e)}function z(e){if(R)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!I)return!1;try{return I.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,i,r){var a=n||{};if(K(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(K(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!K(a,"customInspect")||a.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(K(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(K(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var g=a.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return $(t,a);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var w=String(t);return g?D(t,w):w}if("bigint"==typeof t){var _=String(t)+"n";return g?D(t,_):_}var T=void 0===a.depth?5:a.depth;if(void 0===i&&(i=0),i>=T&&T>0&&"object"==typeof t)return U(t)?"[Array]":"[Object]";var A,F=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=k.call(Array(e.indent+1)," ")}return{base:n,prev:k.call(Array(t+1),n)}}(a,i);if(void 0===r)r=[];else if(W(r,t)>=0)return"[Circular]";function V(t,n,s){if(n&&(r=x.call(r)).push(n),s){var o={depth:a.depth};return K(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),e(t,o,i+1,r)}return e(t,a,i+1,r)}if("function"==typeof t&&!q(t)){var G=function(e){if(e.name)return e.name;var t=v.call(f.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),ee=Q(t,V);return"[Function"+(G?": "+G:" (anonymous)")+"]"+(ee.length>0?" { "+k.call(ee,", ")+" }":"")}if(z(t)){var te=R?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(t);return"object"!=typeof t||R?te:Y(te)}if((A=t)&&"object"==typeof A&&("undefined"!=typeof HTMLElement&&A instanceof HTMLElement||"string"==typeof A.nodeName&&"function"==typeof A.getAttribute)){for(var ne="<"+S.call(String(t.nodeName)),ie=t.attributes||[],re=0;re<ie.length;re++)ne+=" "+ie[re].name+"="+j(B(ie[re].value),"double",a);return ne+=">",t.childNodes&&t.childNodes.length&&(ne+="..."),ne+"</"+S.call(String(t.nodeName))+">"}if(U(t)){if(0===t.length)return"[]";var se=Q(t,V);return F&&!function(e){for(var t=0;t<e.length;t++)if(W(e[t],"\n")>=0)return!1;return!0}(se)?"["+J(se,F)+"]":"[ "+k.call(se,", ")+" ]"}if(function(e){return!("[object Error]"!==H(e)||P&&"object"==typeof e&&P in e)}(t)){var oe=Q(t,V);return"cause"in Error.prototype||!("cause"in t)||O.call(t,"cause")?0===oe.length?"["+String(t)+"]":"{ ["+String(t)+"] "+k.call(oe,", ")+" }":"{ ["+String(t)+"] "+k.call(E.call("[cause]: "+V(t.cause),oe),", ")+" }"}if("object"==typeof t&&l){if(N&&"function"==typeof t[N]&&L)return L(t,{depth:T-i});if("symbol"!==l&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var ae=[];return o.call(t,(function(e,n){ae.push(V(n,t,!0)+" => "+V(e,t))})),Z("Map",s.call(t),ae,F)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var le=[];return d.call(t,(function(e){le.push(V(e,t))})),Z("Set",c.call(t),le,F)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return X("WeakMap");if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return X("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return X("WeakRef");if(function(e){return!("[object Number]"!==H(e)||P&&"object"==typeof e&&P in e)}(t))return Y(V(Number(t)));if(function(e){if(!e||"object"!=typeof e||!C)return!1;try{return C.call(e),!0}catch(e){}return!1}(t))return Y(V(C.call(t)));if(function(e){return!("[object Boolean]"!==H(e)||P&&"object"==typeof e&&P in e)}(t))return Y(m.call(t));if(function(e){return!("[object String]"!==H(e)||P&&"object"==typeof e&&P in e)}(t))return Y(V(String(t)));if(!function(e){return!("[object Date]"!==H(e)||P&&"object"==typeof e&&P in e)}(t)&&!q(t)){var ce=Q(t,V),de=M?M(t)===Object.prototype:t instanceof Object||t.constructor===Object,he=t instanceof Object?"":"null prototype",ue=!de&&P&&Object(t)===t&&P in t?y.call(H(t),8,-1):he?"Object":"",pe=(de||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(ue||he?"["+k.call(E.call([],ue||[],he||[]),": ")+"] ":"");return 0===ce.length?pe+"{}":F?pe+"{"+J(ce,F)+"}":pe+"{ "+k.call(ce,", ")+" }"}return String(t)};var V=Object.prototype.hasOwnProperty||function(e){return e in this};function K(e,t){return V.call(e,t)}function H(e){return g.call(e)}function W(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function $(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,i="... "+n+" more character"+(n>1?"s":"");return $(y.call(e,0,t.maxStringLength),t)+i}return j(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,G),"single",t)}function G(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+w.call(t.toString(16))}function Y(e){return"Object("+e+")"}function X(e){return e+" { ? }"}function Z(e,t,n,i){return e+" ("+t+") {"+(i?J(n,i):k.call(n,", "))+"}"}function J(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+k.call(e,","+n)+"\n"+t.prev}function Q(e,t){var n=U(e),i=[];if(n){i.length=e.length;for(var r=0;r<e.length;r++)i[r]=K(e,r)?t(e[r],e):""}var s,o="function"==typeof A?A(e):[];if(R){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in e)K(e,l)&&(n&&String(Number(l))===l&&l<e.length||R&&s["$"+l]instanceof Symbol||(_.call(/[^\w$]/,l)?i.push(t(l,e)+": "+t(e[l],e)):i.push(l+": "+t(e[l],e))));if("function"==typeof A)for(var c=0;c<o.length;c++)O.call(e,o[c])&&i.push("["+t(o[c])+"]: "+t(e[o[c]],e));return i}},2693:(e,t,n)=>{"use strict";const i=n(9353),r=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const o=(e,t)=>new Promise(((n,o)=>{t={onFailedAttempt:()=>{},retries:10,...t};const a=i.operation(t);a.attempt((async i=>{try{n(await e(i))}catch(e){if(!(e instanceof Error))return void o(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof s)a.stop(),o(e.originalError);else if(e instanceof TypeError&&(l=e.message,!r.includes(l)))a.stop(),o(e);else{((e,t,n)=>{const i=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=i})(e,i,t);try{await t.onFailedAttempt(e)}catch(e){return void o(e)}a.retry(e)||o(a.mainError())}}var l}))}));e.exports=o,e.exports.default=o,e.exports.AbortError=s},9430:function(e,t){var n,i;void 0===(i="function"==typeof(n=function(){return function(e){function t(e){return" "===e||"\t"===e||"\n"===e||"\f"===e||"\r"===e}function n(t){var n,i=t.exec(e.substring(g));if(i)return n=i[0],g+=n.length,n}for(var i,r,s,o,a,l=e.length,c=/^[ \t\n\r\u000c]+/,d=/^[, \t\n\r\u000c]+/,h=/^[^ \t\n\r\u000c]+/,u=/[,]+$/,p=/^\d+$/,m=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,g=0,f=[];;){if(n(d),g>=l)return f;i=n(h),r=[],","===i.slice(-1)?(i=i.replace(u,""),y()):v()}function v(){for(n(c),s="",o="in descriptor";;){if(a=e.charAt(g),"in descriptor"===o)if(t(a))s&&(r.push(s),s="",o="after descriptor");else{if(","===a)return g+=1,s&&r.push(s),void y();if("("===a)s+=a,o="in parens";else{if(""===a)return s&&r.push(s),void y();s+=a}}else if("in parens"===o)if(")"===a)s+=a,o="in descriptor";else{if(""===a)return r.push(s),void y();s+=a}else if("after descriptor"===o)if(t(a));else{if(""===a)return void y();o="in descriptor",g-=1}g+=1}}function y(){var t,n,s,o,a,l,c,d,h,u=!1,g={};for(o=0;o<r.length;o++)l=(a=r[o])[a.length-1],c=a.substring(0,a.length-1),d=parseInt(c,10),h=parseFloat(c),p.test(c)&&"w"===l?((t||n)&&(u=!0),0===d?u=!0:t=d):m.test(c)&&"x"===l?((t||n||s)&&(u=!0),h<0?u=!0:n=h):p.test(c)&&"h"===l?((s||n)&&(u=!0),0===d?u=!0:s=d):u=!0;u?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+a+"'."):(g.url=i,t&&(g.w=t),n&&(g.d=n),s&&(g.h=s),f.push(g))}}})?n.apply(t,[]):n)||(e.exports=i)},9299:(module,__unused_webpack_exports,__webpack_require__)=>{var factory;globalThis,factory=()=>(()=>{"use strict";var __webpack_modules__=[,(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.UNSUPPORTED_FEATURES=t.TextRenderingMode=t.StreamType=t.RenderingIntentFlag=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.LINE_FACTOR=t.LINE_DESCENT_FACTOR=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FontType=t.FeatureTest=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.AnnotationType=t.AnnotationStateModelType=t.AnnotationReviewState=t.AnnotationReplyType=t.AnnotationMode=t.AnnotationMarkedState=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationEditorType=t.AnnotationEditorPrefix=t.AnnotationEditorParamsType=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.arrayByteLength=d,t.arraysToBytes=function(e){const t=e.length;if(1===t&&e[0]instanceof Uint8Array)return e[0];let n=0;for(let i=0;i<t;i++)n+=d(e[i]);let i=0;const r=new Uint8Array(n);for(let n=0;n<t;n++){let t=e[n];t instanceof Uint8Array||(t="string"==typeof t?c(t):new Uint8Array(t));const s=t.byteLength;r.set(t,i),i+=s}return r},t.assert=function(e,t){e||o(t)},t.bytesToString=function(e){"object"==typeof e&&null!==e&&void 0!==e.length||o("Invalid argument for bytesToString");const t=e.length,n=8192;if(t<n)return String.fromCharCode.apply(null,e);const i=[];for(let r=0;r<t;r+=n){const s=Math.min(r+n,t),o=e.subarray(r,s);i.push(String.fromCharCode.apply(null,o))}return i.join("")},t.createPromiseCapability=function(){const e=Object.create(null);let t=!1;return Object.defineProperty(e,"settled",{get:()=>t}),e.promise=new Promise((function(n,i){e.resolve=function(e){t=!0,n(e)},e.reject=function(e){t=!0,i(e)}})),e},t.createValidAbsoluteUrl=function(e,t=null,n=null){if(!e)return null;try{if(n&&"string"==typeof e){if(n.addDefaultProtocol&&e.startsWith("www.")){const t=e.match(/\./g);t&&t.length>=2&&(e=`http://${e}`)}if(n.tryConvertEncoding)try{e=m(e)}catch(e){}}const i=t?new URL(e,t):new URL(e);if(function(e){if(!e)return!1;switch(e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i))return i}catch(e){}return null},t.escapeString=function(e){return e.replace(/([()\\\n\r])/g,(e=>"\n"===e?"\\n":"\r"===e?"\\r":`\\${e}`))},t.getModificationDate=function(e=new Date){return[e.getUTCFullYear().toString(),(e.getUTCMonth()+1).toString().padStart(2,"0"),e.getUTCDate().toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")},t.getVerbosityLevel=function(){return r},t.info=function(e){r>=i.INFOS&&console.log(`Info: ${e}`)},t.isArrayBuffer=function(e){return"object"==typeof e&&null!==e&&void 0!==e.byteLength},t.isArrayEqual=function(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0},t.isAscii=function(e){return/^[\x00-\x7F]*$/.test(e)},t.objectFromMap=function(e){const t=Object.create(null);for(const[n,i]of e)t[n]=i;return t},t.objectSize=function(e){return Object.keys(e).length},t.setVerbosityLevel=function(e){Number.isInteger(e)&&(r=e)},t.shadow=a,t.string32=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},t.stringToBytes=c,t.stringToPDFString=function(e){if(e[0]>=""){let t;if(""===e[0]&&""===e[1]?t="utf-16be":""===e[0]&&""===e[1]?t="utf-16le":""===e[0]&&""===e[1]&&""===e[2]&&(t="utf-8"),t)try{const n=new TextDecoder(t,{fatal:!0}),i=c(e);return n.decode(i)}catch(e){s(`stringToPDFString: "${e}".`)}}const t=[];for(let n=0,i=e.length;n<i;n++){const i=p[e.charCodeAt(n)];t.push(i?String.fromCharCode(i):e.charAt(n))}return t.join("")},t.stringToUTF16BEString=function(e){const t=[""];for(let n=0,i=e.length;n<i;n++){const i=e.charCodeAt(n);t.push(String.fromCharCode(i>>8&255),String.fromCharCode(255&i))}return t.join("")},t.stringToUTF8String=m,t.unreachable=o,t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=s,n(2),t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],t.LINE_FACTOR=1.35,t.LINE_DESCENT_FACTOR=.35,t.RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},t.AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},t.AnnotationEditorPrefix="pdfjs_internal_editor_",t.AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,INK:15},t.AnnotationEditorParamsType={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.AnnotationStateModelType={MARKED:"Marked",REVIEW:"Review"},t.AnnotationMarkedState={MARKED:"Marked",UNMARKED:"Unmarked"},t.AnnotationReviewState={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"},t.AnnotationReplyType={GROUP:"Group",REPLY:"R"},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"},t.DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"},t.PageActionEventType={O:"PageOpen",C:"PageClose"},t.StreamType={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"},t.FontType={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};const i={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=i,t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"},t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let r=i.WARNINGS;function s(e){r>=i.WARNINGS&&console.log(`Warning: ${e}`)}function o(e){throw new Error(e)}function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}const l=function(){function e(t,n){this.constructor===e&&o("Cannot initialize BaseException."),this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();function c(e){"string"!=typeof e&&o("Invalid argument for stringToBytes");const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;++i)n[i]=255&e.charCodeAt(i);return n}function d(e){return void 0!==e.length?e.length:void 0!==e.byteLength?e.byteLength:void o("Invalid argument for arrayByteLength")}t.BaseException=l,t.PasswordException=class extends l{constructor(e,t){super(e,"PasswordException"),this.code=t}},t.UnknownErrorException=class extends l{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},t.InvalidPDFException=class extends l{constructor(e){super(e,"InvalidPDFException")}},t.MissingPDFException=class extends l{constructor(e){super(e,"MissingPDFException")}},t.UnexpectedResponseException=class extends l{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},t.FormatError=class extends l{constructor(e){super(e,"FormatError")}},t.AbortException=class extends l{constructor(e){super(e,"AbortException")}},t.FeatureTest=class{static get isLittleEndian(){return a(this,"isLittleEndian",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return a(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(e){return!1}}())}static get isOffscreenCanvasSupported(){return a(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}};const h=[...Array(256).keys()].map((e=>e.toString(16).padStart(2,"0")));class u{static makeHexColor(e,t,n){return`#${h[e]}${h[t]}${h[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[1],t[1]=n),t[0]*=e[0],t[1]*=e[0],e[3]<0&&(n=t[2],t[2]=t[3],t[3]=n),t[2]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[2],t[2]=n,n=t[1],t[1]=t[3],t[3]=n,e[1]<0&&(n=t[2],t[2]=t[3],t[3]=n),t[2]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[1],t[1]=n),t[0]*=e[2],t[1]*=e[2]),t[0]+=e[4],t[1]+=e[4],t[2]+=e[5],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n]}static getAxialAlignedBoundingBox(e,t){const n=u.applyTransform(e,t),i=u.applyTransform(e.slice(2,4),t),r=u.applyTransform([e[0],e[3]],t),s=u.applyTransform([e[2],e[1]],t);return[Math.min(n[0],i[0],r[0],s[0]),Math.min(n[1],i[1],r[1],s[1]),Math.max(n[0],i[0],r[0],s[0]),Math.max(n[1],i[1],r[1],s[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static apply3dTransform(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],s=e[2]*t[1]+e[3]*t[3],o=(n+s)/2,a=Math.sqrt((n+s)**2-4*(n*s-r*i))/2,l=o+a||1,c=o-a||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),s=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>s?null:[n,r,i,s]}static bezierBoundingBox(e,t,n,i,r,s,o,a){const l=[],c=[[],[]];let d,h,u,p,m,g,f,v;for(let c=0;c<2;++c)if(0===c?(h=6*e-12*n+6*r,d=-3*e+9*n-9*r+3*o,u=3*n-3*e):(h=6*t-12*i+6*s,d=-3*t+9*i-9*s+3*a,u=3*i-3*t),Math.abs(d)<1e-12){if(Math.abs(h)<1e-12)continue;p=-u/h,0<p&&p<1&&l.push(p)}else f=h*h-4*u*d,v=Math.sqrt(f),f<0||(m=(-h+v)/(2*d),0<m&&m<1&&l.push(m),g=(-h-v)/(2*d),0<g&&g<1&&l.push(g));let y,b=l.length;const w=b;for(;b--;)p=l[b],y=1-p,c[0][b]=y*y*y*e+3*y*y*p*n+3*y*p*p*r+p*p*p*o,c[1][b]=y*y*y*t+3*y*y*p*i+3*y*p*p*s+p*p*p*a;return c[0][w]=e,c[1][w]=t,c[0][w+1]=o,c[1][w+1]=a,c[0].length=c[1].length=w+2,[Math.min(...c[0]),Math.min(...c[1]),Math.max(...c[0]),Math.max(...c[1])]}}t.Util=u;const p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function m(e){return decodeURIComponent(escape(e))}},(e,t,n)=>{n(3)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;const n=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type);t.isNodeJS=n},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=void 0,t.binarySearchFirstItem=function(e,t,n=0){let i=n,r=e.length-1;if(r<0||!t(e[r]))return e.length;if(t(e[i]))return i;for(;i<r;){const n=i+r>>1;t(e[n])?r=n:i=n+1}return i},t.deprecated=function(e){console.log("Deprecated API usage: "+e)},t.getColorValues=function(e){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const n of e.keys()){t.style.color=n;const i=window.getComputedStyle(t).color;e.set(n,f(i))}t.remove()},t.getFilenameFromUrl=function(e){const t=e.indexOf("#"),n=e.indexOf("?"),i=Math.min(t>0?t:e.length,n>0?n:e.length);return e.substring(e.lastIndexOf("/",i)+1,i)},t.getPdfFilenameFromUrl=function(e,t="document.pdf"){if("string"!=typeof e)return t;if(p(e))return(0,r.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e);let s=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(s&&(s=s[0],s.includes("%")))try{s=n.exec(decodeURIComponent(s))[0]}catch(e){}return s||t},t.getRGB=f,t.getXfaPageViewport=function(e,{scale:t=1,rotation:n=0}){const{width:i,height:r}=e.attributes.style,s=[0,0,parseInt(i),parseInt(r)];return new h({viewBox:s,scale:t,rotation:n})},t.isDataScheme=p,t.isPdfFile=function(e){return"string"==typeof e&&/\.pdf$/i.test(e)},t.isValidFetchUrl=m,t.loadScript=function(e,t=!1){return new Promise(((n,i)=>{const r=document.createElement("script");r.src=e,r.onload=function(e){t&&r.remove(),n(e)},r.onerror=function(){i(new Error(`Cannot load script at: ${r.src}`))},(document.head||document.documentElement).append(r)}))};var i=n(5),r=n(1);class s{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}t.PixelsPerInch=s;class o extends i.BaseCanvasFactory{constructor({ownerDocument:e=globalThis.document}={}){super(),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}async function a(e,t=!1){if(m(e,document.baseURI)){const n=await fetch(e);if(!n.ok)throw new Error(n.statusText);return t?new Uint8Array(await n.arrayBuffer()):(0,r.stringToBytes)(await n.text())}return new Promise(((n,i)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),t&&(s.responseType="arraybuffer"),s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(200===s.status||0===s.status){let e;if(t&&s.response?e=new Uint8Array(s.response):!t&&s.responseText&&(e=(0,r.stringToBytes)(s.responseText)),e)return void n(e)}i(new Error(s.statusText))}},s.send(null)}))}t.DOMCanvasFactory=o;class l extends i.BaseCMapReaderFactory{_fetchData(e,t){return a(e,this.isCompressed).then((e=>({cMapData:e,compressionType:t})))}}t.DOMCMapReaderFactory=l;class c extends i.BaseStandardFontDataFactory{_fetchData(e){return a(e,!0)}}t.DOMStandardFontDataFactory=c;class d extends i.BaseSVGFactory{_createSVG(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}}t.DOMSVGFactory=d;class h{constructor({viewBox:e,scale:t,rotation:n,offsetX:i=0,offsetY:r=0,dontFlip:s=!1}){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=i,this.offsetY=r;const o=(e[2]+e[0])/2,a=(e[3]+e[1])/2;let l,c,d,h,u,p,m,g;switch((n%=360)<0&&(n+=360),n){case 180:l=-1,c=0,d=0,h=1;break;case 90:l=0,c=1,d=1,h=0;break;case 270:l=0,c=-1,d=-1,h=0;break;case 0:l=1,c=0,d=0,h=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}s&&(d=-d,h=-h),0===l?(u=Math.abs(a-e[1])*t+i,p=Math.abs(o-e[0])*t+r,m=Math.abs(e[3]-e[1])*t,g=Math.abs(e[2]-e[0])*t):(u=Math.abs(o-e[0])*t+i,p=Math.abs(a-e[1])*t+r,m=Math.abs(e[2]-e[0])*t,g=Math.abs(e[3]-e[1])*t),this.transform=[l*t,c*t,d*t,h*t,u-l*t*o-d*t*a,p-c*t*o-h*t*a],this.width=m,this.height=g}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new h({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){return r.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=r.Util.applyTransform([e[0],e[1]],this.transform),n=r.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return r.Util.applyInverseTransform([e,t],this.transform)}}t.PageViewport=h;class u extends r.BaseException{constructor(e,t){super(e,"RenderingCancelledException"),this.type=t}}function p(e){const t=e.length;let n=0;for(;n<t&&""===e[n].trim();)n++;return"data:"===e.substring(n,n+5).toLowerCase()}function m(e,t){try{const{protocol:n}=t?new URL(e,t):new URL(e);return"http:"===n||"https:"===n}catch(e){return!1}}let g;function f(e){if(e.startsWith("#")){const t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map((e=>parseInt(e))):e.startsWith("rgba(")?e.slice(5,-1).split(",").map((e=>parseInt(e))).slice(0,3):((0,r.warn)(`Not a valid color format: "${e}"`),[0,0,0])}t.RenderingCancelledException=u,t.StatTimer=class{constructor(){this.started=Object.create(null),this.times=[]}time(e){e in this.started&&(0,r.warn)(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,r.warn)(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const e of this.times){const n=e.name;n.length>t&&(t=n.length)}for(const n of this.times){const i=n.end-n.start;e.push(`${n.name.padEnd(t)} ${i}ms\n`)}return e.join("")}},t.PDFDateString=class{static toDateObject(e){if(!e||"string"!=typeof e)return null;g||(g=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=g.exec(e);if(!t)return null;const n=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let s=parseInt(t[4],10);s=s>=0&&s<=23?s:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let a=parseInt(t[6],10);a=a>=0&&a<=59?a:0;const l=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,"-"===l?(s+=c,o+=d):"+"===l&&(s-=c,o-=d),new Date(Date.UTC(n,i,r,s,o,a))}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var i=n(1);class r{constructor(){this.constructor===r&&(0,i.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d")}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){(0,i.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=r;class s{constructor({baseUrl:e=null,isCompressed:t=!1}){this.constructor===s&&(0,i.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":""),n=this.isCompressed?i.CMapCompressionType.BINARY:i.CMapCompressionType.NONE;return this._fetchData(t,n).catch((e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)}))}_fetchData(e,t){(0,i.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=s;class o{constructor({baseUrl:e=null}){this.constructor===o&&(0,i.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetchData(t).catch((e=>{throw new Error(`Unable to load font data at: ${t}`)}))}_fetchData(e){(0,i.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=o;class a{constructor(){this.constructor===a&&(0,i.unreachable)("Cannot initialize BaseSVGFactory.")}create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if("string"!=typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){(0,i.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=a},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(7),_display_utils=__w_pdfjs_require__(4),_font_loader=__w_pdfjs_require__(11),_canvas=__w_pdfjs_require__(12),_worker_options=__w_pdfjs_require__(15),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(16),_metadata=__w_pdfjs_require__(17),_optional_content_config=__w_pdfjs_require__(18),_transport_stream=__w_pdfjs_require__(19),_xfa_text=__w_pdfjs_require__(20);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory,createPDFNetworkStream;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:e,NodeCMapReaderFactory:t,NodeStandardFontDataFactory:n}=__w_pdfjs_require__(21);exports.DefaultCanvasFactory=DefaultCanvasFactory=e,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=t,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=n}function setPDFNetworkStreamFactory(e){createPDFNetworkStream=e}function getDocument(e){const t=new PDFDocumentLoadingTask;let n;if("string"==typeof e||e instanceof URL)n={url:e};else if((0,_util.isArrayBuffer)(e))n={data:e};else if(e instanceof PDFDataRangeTransport)n={range:e};else{if("object"!=typeof e)throw new Error("Invalid parameter in getDocument, need either string, URL, Uint8Array, or parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");n=e}const i=Object.create(null);let r=null,s=null;for(const e in n){const t=n[e];switch(e){case"url":if("undefined"!=typeof window)try{i[e]=new URL(t,window.location).href;continue}catch(e){(0,_util.warn)(`Cannot create valid URL: "${e}".`)}else if("string"==typeof t||t instanceof URL){i[e]=t.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":r=t;continue;case"worker":s=t;continue;case"data":if(_is_node.isNodeJS&&"undefined"!=typeof Buffer&&t instanceof Buffer)i[e]=new Uint8Array(t);else{if(t instanceof Uint8Array)break;if("string"==typeof t)i[e]=(0,_util.stringToBytes)(t);else if("object"!=typeof t||null===t||isNaN(t.length)){if(!(0,_util.isArrayBuffer)(t))throw new Error("Invalid PDF binary data: either typed array, string, or array-like object is expected in the data property.");i[e]=new Uint8Array(t)}else i[e]=new Uint8Array(t)}continue}i[e]=t}if(i.CMapReaderFactory=i.CMapReaderFactory||DefaultCMapReaderFactory,i.StandardFontDataFactory=i.StandardFontDataFactory||DefaultStandardFontDataFactory,i.ignoreErrors=!0!==i.stopAtErrors,i.fontExtraProperties=!0===i.fontExtraProperties,i.pdfBug=!0===i.pdfBug,i.enableXfa=!0===i.enableXfa,(!Number.isInteger(i.rangeChunkSize)||i.rangeChunkSize<1)&&(i.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),("string"!=typeof i.docBaseUrl||(0,_display_utils.isDataScheme)(i.docBaseUrl))&&(i.docBaseUrl=null),(!Number.isInteger(i.maxImageSize)||i.maxImageSize<-1)&&(i.maxImageSize=-1),"string"!=typeof i.cMapUrl&&(i.cMapUrl=null),"string"!=typeof i.standardFontDataUrl&&(i.standardFontDataUrl=null),"boolean"!=typeof i.useWorkerFetch&&(i.useWorkerFetch=i.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&i.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),"boolean"!=typeof i.isEvalSupported&&(i.isEvalSupported=!0),"boolean"!=typeof i.disableFontFace&&(i.disableFontFace=_is_node.isNodeJS),"boolean"!=typeof i.useSystemFonts&&(i.useSystemFonts=!_is_node.isNodeJS&&!i.disableFontFace),"object"==typeof i.ownerDocument&&null!==i.ownerDocument||(i.ownerDocument=globalThis.document),"boolean"!=typeof i.disableRange&&(i.disableRange=!1),"boolean"!=typeof i.disableStream&&(i.disableStream=!1),"boolean"!=typeof i.disableAutoFetch&&(i.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(i.verbosity),!s){const e={verbosity:i.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};s=e.port?PDFWorker.fromPort(e):new PDFWorker(e),t._worker=s}const o=t.docId;return s.promise.then((function(){if(t.destroyed)throw new Error("Loading aborted");const e=_fetchDocument(s,i,r,o),n=new Promise((function(e){let t;r?t=new _transport_stream.PDFDataTransportStream({length:i.length,initialData:i.initialData,progressiveDone:i.progressiveDone,contentDispositionFilename:i.contentDispositionFilename,disableRange:i.disableRange,disableStream:i.disableStream},r):i.data||(t=createPDFNetworkStream({url:i.url,length:i.length,httpHeaders:i.httpHeaders,withCredentials:i.withCredentials,rangeChunkSize:i.rangeChunkSize,disableRange:i.disableRange,disableStream:i.disableStream})),e(t)}));return Promise.all([e,n]).then((function([e,n]){if(t.destroyed)throw new Error("Loading aborted");const r=new _message_handler.MessageHandler(o,e,s.port),a=new WorkerTransport(r,t,n,i);t._transport=a,r.send("Ready",null)}))})).catch(t._capability.reject),t}async function _fetchDocument(e,t,n,i){if(e.destroyed)throw new Error("Worker was destroyed");n&&(t.length=n.length,t.initialData=n.initialData,t.progressiveDone=n.progressiveDone,t.contentDispositionFilename=n.contentDispositionFilename);const r=await e.messageHandler.sendWithPromise("GetDocRequest",{docId:i,apiVersion:"2.15.349",source:{data:t.data,url:t.url,password:t.password,disableAutoFetch:t.disableAutoFetch,rangeChunkSize:t.rangeChunkSize,length:t.length},maxImageSize:t.maxImageSize,disableFontFace:t.disableFontFace,docBaseUrl:t.docBaseUrl,ignoreErrors:t.ignoreErrors,isEvalSupported:t.isEvalSupported,fontExtraProperties:t.fontExtraProperties,enableXfa:t.enableXfa,useSystemFonts:t.useSystemFonts,cMapUrl:t.useWorkerFetch?t.cMapUrl:null,standardFontDataUrl:t.useWorkerFetch?t.standardFontDataUrl:null});if(t.data&&(t.data=null),e.destroyed)throw new Error("Worker was destroyed");return r}class PDFDocumentLoadingTask{static#e=0;constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId="d"+PDFDocumentLoadingTask.#e++,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0,await(this._transport?.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,n=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(const n of this._progressListeners)n(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(const t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,n,i,r=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=i,this._transport=n,this._stats=r?new _display_utils.StatTimer:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:r=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const t=this._transport.getRenderingIntent(e);let n=this._annotationPromises.get(t.cacheKey);return n||(n=this._transport.getAnnotations(this._pageIndex,t.renderingIntent),this._annotationPromises.set(t.cacheKey,n),n=n.then((e=>{for(const t of e)void 0!==t.titleObj&&Object.defineProperty(t,"title",{get:()=>((0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),t.titleObj.str)}),void 0!==t.contentsObj&&Object.defineProperty(t,"contents",{get:()=>((0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),t.contentsObj.str)});return e}))),n}getJSActions(){return this._jsActionsPromise||=this._transport.getPageJSActions(this._pageIndex)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:i=_util.AnnotationMode.ENABLE,transform:r=null,imageLayer:s=null,canvasFactory:o=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:d=null,printAnnotationStorage:h=null}){void 0!==arguments[0]?.renderInteractiveForms&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),!0===arguments[0].renderInteractiveForms&&i===_util.AnnotationMode.ENABLE&&(i=_util.AnnotationMode.ENABLE_FORMS)),void 0!==arguments[0]?.includeAnnotationStorage&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),!0===arguments[0].includeAnnotationStorage&&i===_util.AnnotationMode.ENABLE&&(i=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");const u=this._transport.getRenderingIntent(n,i,h);this.pendingCleanup=!1,l||(l=this._transport.getOptionalContentConfig());let p=this._intentStates.get(u.cacheKey);p||(p=Object.create(null),this._intentStates.set(u.cacheKey,p)),p.streamReaderCancelTimeout&&(clearTimeout(p.streamReaderCancelTimeout),p.streamReaderCancelTimeout=null);const m=o||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),g=!!(u.renderingIntent&_util.RenderingIntentFlag.PRINT);p.displayReadyCapability||(p.displayReadyCapability=(0,_util.createPromiseCapability)(),p.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(u));const f=e=>{p.renderTasks.delete(v),(this.cleanupAfterRender||g)&&(this.pendingCleanup=!0),this._tryCleanup(),e?(v.capability.reject(e),this._abortOperatorList({intentState:p,reason:e instanceof Error?e:new Error(e)})):v.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},v=new InternalRenderTask({callback:f,params:{canvasContext:e,viewport:t,transform:r,imageLayer:s,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:p.operatorList,pageIndex:this._pageIndex,canvasFactory:m,useRequestAnimationFrame:!g,pdfBug:this._pdfBug,pageColors:d});(p.renderTasks||=new Set).add(v);const y=v.task;return Promise.all([p.displayReadyCapability.promise,l]).then((([e,t])=>{this.pendingCleanup?f():(this._stats&&this._stats.time("Rendering"),v.initializeGraphics({transparency:e,optionalContentConfig:t}),v.operatorListChanged())})).catch(f),y}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:n=null}={}){const i=this._transport.getRenderingIntent(e,t,n,!0);let r,s=this._intentStates.get(i.cacheKey);return s||(s=Object.create(null),this._intentStates.set(i.cacheKey,s)),s.opListReadCapability||(r=Object.create(null),r.operatorListChanged=function(){s.operatorList.lastChunk&&(s.opListReadCapability.resolve(s.operatorList),s.renderTasks.delete(r))},s.opListReadCapability=(0,_util.createPromiseCapability)(),(s.renderTasks||=new Set).add(r),s.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(i)),s.opListReadCapability.promise}streamTextContent({disableCombineTextItems:e=!1,includeMarkedContent:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:!0!==e,includeMarkedContent:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then((e=>_xfa_text.XfaText.textContent(e)));const t=this.streamTextContent(e);return new Promise((function(e,n){const i=t.getReader(),r={items:[],styles:Object.create(null)};!function t(){i.read().then((function({value:n,done:i}){i?e(r):(Object.assign(r.styles,n.styles),r.items.push(...n.items),t())}),n)}()}))}getStructTree(){return this._structTreePromise||=this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();this.objs.clear();for(const e of this._bitmaps)e.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer);for(const e of this._bitmaps)e.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats&&this._stats.timeEnd("Page Request"),n.displayReadyCapability&&n.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let n=0,i=e.length;n<i;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const e of t.renderTasks)e.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageMap:n}){const i=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n}).getReader(),r=this._intentStates.get(t);r.streamReader=i;const s=()=>{i.read().then((({value:e,done:t})=>{t?r.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,r),s())}),(e=>{if(r.streamReader=null,!this._transport.destroyed){if(r.operatorList){r.operatorList.lastChunk=!0;for(const e of r.renderTasks)e.operatorListChanged();this._tryCleanup()}if(r.displayReadyCapability)r.displayReadyCapability.reject(e);else{if(!r.opListReadCapability)throw e;r.opListReadCapability.reject(e)}}}))};s()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(!n){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException)return void(e.streamReaderCancelTimeout=setTimeout((()=>{this._abortOperatorList({intentState:e,reason:t,force:!0}),e.streamReaderCancelTimeout=null}),RENDERING_CANCELLED_TIMEOUT))}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch((()=>{})),e.streamReader=null,!this._transport.destroyed){for(const[t,n]of this._intentStates)if(n===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(e,t){const n={data:structuredClone(e,t)};this._deferred.then((()=>{for(const e of this._listeners)e.call(this,n)}))}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){const n=this._listeners.indexOf(t);this._listeners.splice(n,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};if(exports.PDFWorkerUtil=PDFWorkerUtil,_is_node.isNodeJS)PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if("object"==typeof document){const e=document?.currentScript?.src;e&&(PDFWorkerUtil.fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(e,t){let n;try{if(n=new URL(e),!n.origin||"null"===n.origin)return!1}catch(e){return!1}const i=new URL(t,n);return n.origin===i.origin},PDFWorkerUtil.createCDNWrapper=function(e){const t=`importScripts("${e}");`;return URL.createObjectURL(new Blob([t]))};class PDFWorker{static#t=new WeakMap;constructor({name:e=null,port:t=null,verbosity:n=(0,_util.getVerbosityLevel)()}={}){if(t&&PDFWorker.#t.has(t))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,t)return PDFWorker.#t.set(t,this),void this._initializeFromPort(t);this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve()}_initialize(){if("undefined"!=typeof Worker&&!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let e=PDFWorker.workerSrc;try{PDFWorkerUtil.isSameOrigin(window.location.href,e)||(e=PDFWorkerUtil.createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e),n=new _message_handler.MessageHandler("main","worker",t),i=()=>{t.removeEventListener("error",r),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=()=>{this._webWorker||i()};t.addEventListener("error",r),n.on("test",(e=>{t.removeEventListener("error",r),this.destroyed?i():e?(this._messageHandler=n,this._port=t,this._webWorker=t,this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),n.destroy(),t.terminate())})),n.on("ready",(e=>{if(t.removeEventListener("error",r),this.destroyed)i();else try{s()}catch(e){this._setupFakeWorker()}}));const s=()=>{const e=new Uint8Array;n.send("test",e,[e.buffer])};return void s()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new LoopbackPort;this._port=t;const n="fake"+PDFWorkerUtil.fakeWorkerId++,i=new _message_handler.MessageHandler(n+"_worker",n,t);e.setup(i,t);const r=new _message_handler.MessageHandler(n,n+"_worker",t);this._messageHandler=r,this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})})).catch((e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#t.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.#t.has(e.port)?this.#t.get(e.port):new PDFWorker(e)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(null!==PDFWorkerUtil.fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch(e){return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{#n=null;#i=new Map;#r=new Map;#s=null;constructor(e,t,n,i){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this._params=i,i.useWorkerFetch||(this.CMapReaderFactory=new i.CMapReaderFactory({baseUrl:i.cMapUrl,isCompressed:i.cMapPacked}),this.StandardFontDataFactory=new i.StandardFontDataFactory({baseUrl:i.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return this.#n}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,n=null,i=!1){let r=_util.RenderingIntentFlag.DISPLAY,s=null;switch(e){case"any":r=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":r=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:r+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:r+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:r+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,s=(r&_util.RenderingIntentFlag.PRINT&&n instanceof _annotation_storage.PrintAnnotationStorage?n:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return i&&(r+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:r,cacheKey:`${r}_${_annotation_storage.AnnotationStorage.getHash(s)}`,annotationStorageMap:s}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const t of this.#i.values())e.push(t._destroy());this.#i.clear(),this.#r.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#s=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function({value:e,done:n}){n?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{const n=(0,_util.createPromiseCapability)(),i=this._fullReader;return i.headersReady.then((()=>{i.isStreamingSupported&&i.isRangeSupported||(this._lastProgress&&t.onProgress?.(this._lastProgress),i.onProgress=e=>{t.onProgress?.({loaded:e.loaded,total:e.total})}),n.resolve({isStreamingSupported:i.isStreamingSupported,isRangeSupported:i.isRangeSupported,contentLength:i.contentLength})}),n.reject),n.promise})),e.on("GetRangeReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(e.begin,e.end);n?(t.onPull=()=>{n.read().then((function({value:e,done:n}){n?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{n.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(({pdfInfo:e})=>{this._numPages=e.numPages,this._htmlForXfa=e.htmlForXfa,delete e.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(e,this))})),e.on("DocException",(function(e){let n;switch(e.name){case"PasswordException":n=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":n=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":n=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":n=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":n=new _util.UnknownErrorException(e.message,e.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(n)})),e.on("PasswordRequest",(e=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){const n=e=>{e instanceof Error?this._passwordCapability.reject(e):this._passwordCapability.resolve({password:e})};try{t.onPassword(n,e.code)}catch(e){this._passwordCapability.reject(e)}}else this._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return this._passwordCapability.promise})),e.on("DataLoaded",(e=>{t.onProgress?.({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{this.destroyed||this.#i.get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(([t,n,i])=>{if(!this.destroyed&&!this.commonObjs.has(t))switch(n){case"Font":const r=this._params;if("error"in i){const e=i.error;(0,_util.warn)(`Error during font loading: ${e}`),this.commonObjs.resolve(t,e);break}let s=null;r.pdfBug&&globalThis.FontInspector?.enabled&&(s={registerFont(e,t){globalThis.FontInspector.fontAdded(e,t)}});const o=new _font_loader.FontFaceObject(i,{isEvalSupported:r.isEvalSupported,disableFontFace:r.disableFontFace,ignoreErrors:r.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:s});this.fontLoader.bind(o).catch((n=>e.sendWithPromise("FontFallback",{id:t}))).finally((()=>{!r.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(t,o)}));break;case"FontPath":case"Image":this.commonObjs.resolve(t,i);break;default:throw new Error(`Got unknown common object type ${n}`)}})),e.on("obj",(([e,t,n,i])=>{if(this.destroyed)return;const r=this.#i.get(t);if(!r.objs.has(e))switch(n){case"Image":r.objs.resolve(e,i);const t=8e6;if(i){let e;if(i.bitmap){const{bitmap:t,width:n,height:s}=i;e=n*s*4,r._bitmaps.add(t)}else e=i.data?.length||0;e>t&&(r.cleanupAfterRender=!0)}break;case"Pattern":r.objs.resolve(e,i);break;default:throw new Error(`Got unknown object type ${n}`)}})),e.on("DocProgress",(e=>{this.destroyed||t.onProgress?.({loaded:e.loaded,total:e.total})})),e.on("DocStats",(e=>{this.destroyed||(this.#n=Object.freeze({streamTypes:Object.freeze(e.streamTypes),fontTypes:Object.freeze(e.fontTypes)}))})),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),e.on("FetchStandardFontData",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#r.get(t);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((e=>{if(this.destroyed)throw new Error("Transport destroyed");const n=new PDFPageProxy(t,e,this,this._params.ownerDocument,this._params.pdfBug);return this.#i.set(t,n),n}));return this.#r.set(t,i),i}getPageIndex(e){return"object"!=typeof e||null===e||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(){return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally((()=>{this.annotationStorage.resetModified()}))}getFieldObjects(){return this._getFieldObjectsPromise||=this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||=this.messageHandler.sendWithPromise("HasJSActions",null)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then((e=>new _optional_content_config.OptionalContentConfig(e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.#s||=this.messageHandler.sendWithPromise("GetMetadata",null).then((e=>({info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(const e of this.#i.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#s=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){const e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,enableXfa:e.enableXfa})}}class PDFObjects{#o=Object.create(null);#a(e){return this.#o[e]||(this.#o[e]={capability:(0,_util.createPromiseCapability)(),data:null})}get(e,t=null){if(t){const n=this.#a(e);return n.capability.promise.then((()=>t(n.data))),null}const n=this.#o[e];if(!n?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){return this.#o[e]?.capability.settled||!1}resolve(e,t=null){const n=this.#a(e);n.data=t,n.capability.resolve()}clear(){this.#o=Object.create(null)}}class RenderTask{#l=null;constructor(e){this.#l=e,this.onContinue=null}get promise(){return this.#l.capability.promise}cancel(){this.#l.cancel()}get separateAnnots(){const{separateAnnots:e}=this.#l.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#l;return e.form||e.canvas&&t?.size>0}}exports.RenderTask=RenderTask;class InternalRenderTask{static#c=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:i,annotationCanvasMap:r,operatorList:s,pageIndex:o,canvasFactory:a,useRequestAnimationFrame:l=!1,pdfBug:c=!1,pageColors:d=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=s,this._pageIndex=o,this.canvasFactory=a,this._pdfBug=c,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===l&&"undefined"!=typeof window,this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#c.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#c.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:i,transform:r,imageLayer:s,background:o}=this.params;this.gfx=new _canvas.CanvasGraphics(n,this.commonObjs,this.objs,this.canvasFactory,s,t,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(e=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#c.delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){this.graphicsReady?(this.stepper&&this.stepper.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#c.delete(this._canvas),this.callback())))}}const version="2.15.349";exports.version=version;const build="b8aa9c622";exports.build=build},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PrintAnnotationStorage=t.AnnotationStorage=void 0;var i=n(1),r=n(8),s=n(10);class o{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null}getValue(e,t){const n=this._storage.get(e);return void 0===n?t:Object.assign(t,n)}getRawValue(e){return this._storage.get(e)}removeKey(e){this._storage.delete(e),0===this._storage.size&&this.resetModified()}setValue(e,t){const n=this._storage.get(e);let i=!1;if(void 0!==n)for(const[e,r]of Object.entries(t))n[e]!==r&&(i=!0,n[e]=r);else i=!0,this._storage.set(e,t);i&&this.#d()}has(e){return this._storage.has(e)}getAll(){return this._storage.size>0?(0,i.objectFromMap)(this._storage):null}get size(){return this._storage.size}#d(){this._modified||(this._modified=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new a(this)}get serializable(){if(0===this._storage.size)return null;const e=new Map;for(const[t,n]of this._storage){const i=n instanceof r.AnnotationEditor?n.serialize():n;i&&e.set(t,i)}return e}static getHash(e){if(!e)return"";const t=new s.MurmurHash3_64;for(const[n,i]of e)t.update(`${n}:${JSON.stringify(i)}`);return t.hexdigest()}}t.AnnotationStorage=o;class a extends o{#h=null;constructor(e){super(),this.#h=structuredClone(e.serializable)}get print(){(0,i.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#h}}t.PrintAnnotationStorage=a},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditor=void 0;var i=n(9),r=n(1);class s{#u=this.focusin.bind(this);#p=this.focusout.bind(this);#m=!1;#g=!1;#f=!1;#v=s._zIndex++;static _colorManager=new i.ColorManager;static _zIndex=1;constructor(e){this.constructor===s&&(0,r.unreachable)("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null;const[t,n]=this.parent.viewportBaseDimensions;this.x=e.x/t,this.y=e.y/n,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,r.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#v}focusin(e){this.#m?this.#m=!1:this.parent.setSelected(this)}focusout(e){this.isAttachedToDOM&&(e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove()))}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(e){const t=this.parent.div.getBoundingClientRect();this.startX=e.clientX-t.x,this.startY=e.clientY-t.y,e.dataTransfer.setData("text/plain",this.id),e.dataTransfer.effectAllowed="move"}setAt(e,t,n,i){const[r,s]=this.parent.viewportBaseDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(e+n)/r,this.y=(t+i)/s,this.div.style.left=100*this.x+"%",this.div.style.top=100*this.y+"%"}translate(e,t){const[n,i]=this.parent.viewportBaseDimensions;[e,t]=this.screenToPageTranslation(e,t),this.x+=e/n,this.y+=t/i,this.div.style.left=100*this.x+"%",this.div.style.top=100*this.y+"%"}screenToPageTranslation(e,t){const{rotation:n}=this.parent.viewport;switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}setDims(e,t){const[n,i]=this.parent.viewportBaseDimensions;this.div.style.width=100*e/n+"%",this.div.style.height=100*t/i+"%"}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#u),this.div.addEventListener("focusout",this.#p);const[e,t]=this.getInitialTranslation();return this.translate(e,t),(0,i.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(e){const t=i.KeyboardManager.platform.isMac;0!==e.button||e.ctrlKey&&t?e.preventDefault():(e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this),this.#m=!0)}getRect(e,t){const[n,i]=this.parent.viewportBaseDimensions,[r,s]=this.parent.pageDimensions,o=r*e/n,a=s*t/i,l=this.x*r,c=this.y*s,d=this.width*r,h=this.height*s;switch(this.rotation){case 0:return[l+o,s-c-a-h,l+o+d,s-c-a];case 90:return[l+a,s-c+o,l+a+h,s-c+o+d];case 180:return[l-o-d,s-c+a,l-o,s-c+a+h];case 270:return[l-a-h,s-c-o-d,l-a,s-c-o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,i,r,s]=e,o=r-n,a=s-i;switch(this.rotation){case 0:return[n,t-s,o,a];case 90:return[n,t-i,a,o];case 180:return[r,t-i,o,a];case 270:return[r,t-s,a,o];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#f=!0}disableEditMode(){this.#f=!1}isInEditMode(){return this.#f}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#u)}serialize(){(0,r.unreachable)("An editor must be serializable")}static deserialize(e,t){const n=new this.prototype.constructor({parent:t,id:t.getNextId()});n.rotation=e.rotation;const[i,r]=t.pageDimensions,[s,o,a,l]=n.getRectInCurrentCoords(e.rect,r);return n.x=s/i,n.y=o/r,n.width=a/i,n.height=l/r,n}remove(){this.div.removeEventListener("focusin",this.#u),this.div.removeEventListener("focusout",this.#p),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){this.div?.classList.add("selectedEditor")}unselect(){this.div?.classList.remove("selectedEditor")}updateParams(e,t){}disableEditing(){}enableEditing(){}getIdForTextLayer(){return this.id}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return this.#g}set isEditing(e){this.#g=e,e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}}t.AnnotationEditor=s},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardManager=t.CommandManager=t.ColorManager=t.AnnotationEditorUIManager=void 0,t.bindEvents=function(e,t,n){for(const i of n)t.addEventListener(i,e[i].bind(e))},t.opacityToHex=function(e){return Math.round(Math.min(255,Math.max(1,255*e))).toString(16).padStart(2,"0")};var i=n(1),r=n(4);class s{#y=0;getId(){return`${i.AnnotationEditorPrefix}${this.#y++}`}}class o{#b=[];#w=!1;#S;#_=-1;constructor(e=128){this.#S=e}add({cmd:e,undo:t,mustExec:n,type:i=NaN,overwriteIfSameType:r=!1,keepUndo:s=!1}){if(n&&e(),this.#w)return;const o={cmd:e,undo:t,type:i};if(-1===this.#_)return this.#b.length>0&&(this.#b.length=0),this.#_=0,void this.#b.push(o);if(r&&this.#b[this.#_].type===i)return s&&(o.undo=this.#b[this.#_].undo),void(this.#b[this.#_]=o);const a=this.#_+1;a===this.#S?this.#b.splice(0,1):(this.#_=a,a<this.#b.length&&this.#b.splice(a)),this.#b.push(o)}undo(){-1!==this.#_&&(this.#w=!0,this.#b[this.#_].undo(),this.#w=!1,this.#_-=1)}redo(){this.#_<this.#b.length-1&&(this.#_+=1,this.#w=!0,this.#b[this.#_].cmd(),this.#w=!1)}hasSomethingToUndo(){return-1!==this.#_}hasSomethingToRedo(){return this.#_<this.#b.length-1}destroy(){this.#b=null}}t.CommandManager=o;class a{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const t=a.platform.isMac;for(const[n,i]of e)for(const e of n){const n=e.startsWith("mac+");t&&n?(this.callbacks.set(e.slice(4),i),this.allKeys.add(e.split("+").at(-1))):t||n||(this.callbacks.set(e,i),this.allKeys.add(e.split("+").at(-1)))}}static get platform(){const e="undefined"!=typeof navigator?navigator.platform:"";return(0,i.shadow)(this,"platform",{isWin:e.includes("Win"),isMac:e.includes("Mac")})}#E(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(this.#E(t));n&&(n.bind(e)(),t.stopPropagation(),t.preventDefault())}}t.KeyboardManager=a;class l{#k=null;copy(e){e&&(Array.isArray(e)?this.#k=e.map((e=>e.serialize())):this.#k=[e.serialize()],this.#k=this.#k.filter((e=>!!e)),0===this.#k.length&&(this.#k=null))}paste(){return this.#k}isEmpty(){return null===this.#k}destroy(){this.#k=null}}class c{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,r.getColorValues)(e),(0,i.shadow)(this,"_colors",e)}convert(e){const t=(0,r.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[e,n]of this._colors)if(n.every(((e,n)=>e===t[n])))return c._colorsMapping.get(e);return t}getHexCode(e){const t=this._colors.get(e);return t?i.Util.makeHexColor(...t):e}}t.ColorManager=c;class d{#x=null;#T=new Map;#C=new Map;#A=new l;#I=new o;#R=0;#P=null;#O=null;#M=new s;#D=!1;#L=i.AnnotationEditorType.NONE;#F=new Set;#N=this.keydown.bind(this);#j=this.onEditingAction.bind(this);#B=this.onPageChanging.bind(this);#U=this.onTextLayerRendered.bind(this);#q={isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#z=null;static _keyboardManager=new a([[["ctrl+a","mac+meta+a"],d.prototype.selectAll],[["ctrl+c","mac+meta+c"],d.prototype.copy],[["ctrl+v","mac+meta+v"],d.prototype.paste],[["ctrl+x","mac+meta+x"],d.prototype.cut],[["ctrl+z","mac+meta+z"],d.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],d.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],d.prototype.delete],[["Escape","mac+Escape"],d.prototype.unselectAll]]);constructor(e,t){this.#z=e,this.#O=t,this.#O._on("editingaction",this.#j),this.#O._on("pagechanging",this.#B),this.#O._on("textlayerrendered",this.#U)}destroy(){this.#V(),this.#O._off("editingaction",this.#j),this.#O._off("pagechanging",this.#B),this.#O._off("textlayerrendered",this.#U);for(const e of this.#C.values())e.destroy();this.#C.clear(),this.#T.clear(),this.#x=null,this.#F.clear(),this.#A.destroy(),this.#I.destroy()}onPageChanging({pageNumber:e}){this.#R=e-1}onTextLayerRendered({pageNumber:e}){const t=e-1;this.#C.get(t)?.onTextLayerRendered()}focusMainContainer(){this.#z.focus()}#K(){this.#z.addEventListener("keydown",this.#N)}#V(){this.#z.removeEventListener("keydown",this.#N)}keydown(e){this.getActive()?.shouldGetKeyboardEvents()||d._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","cut","copy","paste","delete","selectAll"].includes(e.name)&&this[e.name]()}#H(e){Object.entries(e).some((([e,t])=>this.#q[e]!==t))&&this.#O.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#q,e)})}#W(e){this.#O.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#K(),this.#H({isEditing:this.#L!==i.AnnotationEditorType.NONE,isEmpty:this.#$(),hasSomethingToUndo:this.#I.hasSomethingToUndo(),hasSomethingToRedo:this.#I.hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:this.#A.isEmpty()})):(this.#V(),this.#H({isEditing:!1}))}registerEditorTypes(e){this.#P=e;for(const e of this.#P)this.#W(e.defaultPropertiesToUpdate)}getId(){return this.#M.getId()}addLayer(e){this.#C.set(e.pageIndex,e),this.#D?e.enable():e.disable()}removeLayer(e){this.#C.delete(e.pageIndex)}updateMode(e){if(this.#L=e,e===i.AnnotationEditorType.NONE)this.setEditingState(!1),this.#G();else{this.setEditingState(!0),this.#Y();for(const t of this.#C.values())t.updateMode(e)}}updateToolbar(e){e!==this.#L&&this.#O.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){for(const n of this.#F)n.updateParams(e,t);for(const n of this.#P)n.updateDefaultParams(e,t)}#Y(){if(!this.#D){this.#D=!0;for(const e of this.#C.values())e.enable()}}#G(){if(this.unselectAll(),this.#D){this.#D=!1;for(const e of this.#C.values())e.disable()}}getEditors(e){const t=[];for(const n of this.#T.values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return this.#T.get(e)}addEditor(e){this.#T.set(e.id,e)}removeEditor(e){this.#T.delete(e.id),this.unselect(e)}#X(e){const t=this.#C.get(e.pageIndex);t?t.addOrRebuild(e):this.addEditor(e)}setActiveEditor(e){this.#x!==e&&(this.#x=e,e&&this.#W(e.propertiesToUpdate))}toggleSelected(e){if(this.#F.has(e))return this.#F.delete(e),e.unselect(),void this.#H({hasSelectedEditor:this.hasSelection});this.#F.add(e),e.select(),this.#W(e.propertiesToUpdate),this.#H({hasSelectedEditor:!0})}setSelected(e){for(const t of this.#F)t!==e&&t.unselect();this.#F.clear(),this.#F.add(e),e.select(),this.#W(e.propertiesToUpdate),this.#H({hasSelectedEditor:!0})}isSelected(e){return this.#F.has(e)}unselect(e){e.unselect(),this.#F.delete(e),this.#H({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#F.size}undo(){this.#I.undo(),this.#H({hasSomethingToUndo:this.#I.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#$()})}redo(){this.#I.redo(),this.#H({hasSomethingToUndo:!0,hasSomethingToRedo:this.#I.hasSomethingToRedo(),isEmpty:this.#$()})}addCommands(e){this.#I.add(e),this.#H({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#$()})}#$(){if(0===this.#T.size)return!0;if(1===this.#T.size)for(const e of this.#T.values())return e.isEmpty();return!1}delete(){if(this.#x&&this.#x.commitOrRemove(),!this.hasSelection)return;const e=[...this.#F];this.addCommands({cmd:()=>{for(const t of e)t.remove()},undo:()=>{for(const t of e)this.#X(t)},mustExec:!0})}copy(){if(this.#x&&this.#x.commitOrRemove(),this.hasSelection){const e=[];for(const t of this.#F)t.isEmpty()||e.push(t);if(0===e.length)return;this.#A.copy(e),this.#H({hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(this.#A.isEmpty())return;this.unselectAll();const e=this.#C.get(this.#R),t=this.#A.paste().map((t=>e.deserialize(t)));this.addCommands({cmd:()=>{for(const e of t)this.#X(e);this.#Z(t)},undo:()=>{for(const e of t)e.remove()},mustExec:!0})}#Z(e){this.#F.clear();for(const t of e)t.isEmpty()||(this.#F.add(t),t.select());this.#H({hasSelectedEditor:!0})}selectAll(){for(const e of this.#F)e.commit();this.#Z(this.#T.values())}unselectAll(){if(this.#x)this.#x.commitOrRemove();else if(0!==this.#Z.size){for(const e of this.#F)e.unselect();this.#F.clear(),this.#H({hasSelectedEditor:!1})}}isActive(e){return this.#x===e}getActive(){return this.#x}getMode(){return this.#L}}t.AnnotationEditorUIManager=d},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash3_64=void 0;var i=n(1);const r=3285377520,s=4294901760,o=65535;t.MurmurHash3_64=class{constructor(e){this.h1=e?4294967295&e:r,this.h2=e?4294967295&e:r}update(e){let t,n;if("string"==typeof e){t=new Uint8Array(2*e.length),n=0;for(let i=0,r=e.length;i<r;i++){const r=e.charCodeAt(i);r<=255?t[n++]=r:(t[n++]=r>>>8,t[n++]=255&r)}}else{if(!(0,i.isArrayBuffer)(e))throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");t=e.slice(),n=t.byteLength}const r=n>>2,a=n-4*r,l=new Uint32Array(t.buffer,0,r);let c=0,d=0,h=this.h1,u=this.h2;const p=3432918353,m=461845907,g=11601,f=13715;for(let e=0;e<r;e++)1&e?(c=l[e],c=c*p&s|c*g&o,c=c<<15|c>>>17,c=c*m&s|c*f&o,h^=c,h=h<<13|h>>>19,h=5*h+3864292196):(d=l[e],d=d*p&s|d*g&o,d=d<<15|d>>>17,d=d*m&s|d*f&o,u^=d,u=u<<13|u>>>19,u=5*u+3864292196);switch(c=0,a){case 3:c^=t[4*r+2]<<16;case 2:c^=t[4*r+1]<<8;case 1:c^=t[4*r],c=c*p&s|c*g&o,c=c<<15|c>>>17,c=c*m&s|c*f&o,1&r?h^=c:u^=c}this.h1=h,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;e^=t>>>1,e=3981806797*e&s|36045*e&o,t=4283543511*t&s|(2950163797*(t<<16|e>>>16)&s)>>>16,e^=t>>>1,e=444984403*e&s|60499*e&o,t=3301882366*t&s|(3120437893*(t<<16|e>>>16)&s)>>>16,e^=t>>>1;const n=(e>>>0).toString(16),i=(t>>>0).toString(16);return n.padStart(8,"0")+i.padStart(8,"0")}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var i=n(1);class r{constructor({docId:e,onUnsupportedFeature:t,ownerDocument:n=globalThis.document,styleElement:s=null}){this.constructor===r&&(0,i.unreachable)("Cannot initialize BaseFontLoader."),this.docId=e,this._onUnsupportedFeature=t,this._document=n,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(e){this.nativeFontFaces.push(e),this._document.fonts.add(e)}insertRule(e){let t=this.styleElement;t||(t=this.styleElement=this._document.createElement("style"),t.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(t));const n=t.sheet;n.insertRule(e,n.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(e){if(e.attached||e.missingFile)return;if(e.attached=!0,this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(n){throw this._onUnsupportedFeature({featureId:i.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,i.warn)(`Failed to load font '${t.family}': '${n}'.`),e.disableFontFace=!0,n}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise((n=>{const i=this._queueLoadingCallback(n);this._prepareFontLoadEvent([t],[e],i)}))}}_queueLoadingCallback(e){(0,i.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return(0,i.shadow)(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){(0,i.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,i.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(e,t,n){(0,i.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let s;t.FontLoader=s,t.FontLoader=s=class extends r{constructor(e){super(e),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let e=!1;return("undefined"==typeof navigator||/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent)?.[1]>=14)&&(e=!0),(0,i.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){const t=this.loadingContext,n={id:"pdfjs-font-loading-"+t.nextRequestId++,done:!1,complete:function(){for((0,i.assert)(!n.done,"completeRequest() cannot be called twice."),n.done=!0;t.requests.length>0&&t.requests[0].done;){const e=t.requests.shift();setTimeout(e.callback,0)}},callback:e};return t.requests.push(n),n}get _loadTestFont(){return(0,i.shadow)(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t,n){function r(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function s(e,t,n,i){return e.substring(0,t)+i+e.substring(t+n)}let o,a;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let d=0;const h=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=s(u,976,h.length,h);const p=1482184792;let m=r(u,16);for(o=0,a=h.length-3;o<a;o+=4)m=m-p+r(h,o)|0;o<h.length&&(m=m-p+r(h+"XXX",o)|0),u=s(u,16,4,(0,i.string32)(m));const g=`@font-face {font-family:"${h}";src:url(data:font/opentype;base64,${btoa(u)});}`;this.insertRule(g);const f=[];for(const e of t)f.push(e.loadedName);f.push(h);const v=this._document.createElement("div");v.style.visibility="hidden",v.style.width=v.style.height="10px",v.style.position="absolute",v.style.top=v.style.left="0px";for(const e of f){const t=this._document.createElement("span");t.textContent="Hi",t.style.fontFamily=e,v.append(t)}this._document.body.append(v),function e(t,n){if(d++,d>30)return(0,i.warn)("Load test font never loaded."),void n();c.font="30px "+t,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0?n():setTimeout(e.bind(null,t,n))}(h,(()=>{v.remove(),n.complete()}))}},t.FontFaceObject=class{constructor(e,{isEvalSupported:t=!0,disableFontFace:n=!1,ignoreErrors:i=!1,onUnsupportedFeature:r,fontRegistry:s=null}){this.compiledGlyphs=Object.create(null);for(const t in e)this[t]=e[t];this.isEvalSupported=!1!==t,this.disableFontFace=!0===n,this.ignoreErrors=!0===i,this._onUnsupportedFeature=r,this.fontRegistry=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(this.cssFontInfo){const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}else e=new FontFace(this.loadedName,this.data,{});return this.fontRegistry&&this.fontRegistry.registerFont(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=(0,i.bytesToString)(this.data),t=`url(data:${this.mimetype};base64,${btoa(e)});`;let n;if(this.cssFontInfo){let e=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(e+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${e}src:${t}}`}else n=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this.fontRegistry&&this.fontRegistry.registerFont(this,t),n}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let n;try{n=e.get(this.loadedName+"_path_"+t)}catch(e){if(!this.ignoreErrors)throw e;return this._onUnsupportedFeature({featureId:i.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,i.warn)(`getPathGenerator - ignoring character: "${e}".`),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&i.FeatureTest.isEvalSupported){const e=[];for(const t of n){const n=void 0!==t.args?t.args.join(","):"";e.push("c.",t.cmd,"(",n,");\n")}return this.compiledGlyphs[t]=new Function("c","size",e.join(""))}return this.compiledGlyphs[t]=function(e,t){for(const i of n)"scale"===i.cmd&&(i.args=[t,-t]),e[i.cmd].apply(e,i.args)}}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var i=n(1),r=n(4),s=n(13),o=n(14),a=n(3);const l=4096,c=16;function d(e){if(e._transformStack&&(e._transformStack=[]),!e.mozCurrentTransform){e._originalSave=e.save,e._originalRestore=e.restore,e._originalRotate=e.rotate,e._originalScale=e.scale,e._originalTranslate=e.translate,e._originalTransform=e.transform,e._originalSetTransform=e.setTransform,e._originalResetTransform=e.resetTransform,e._transformMatrix=e._transformMatrix||[1,0,0,1,0,0],e._transformStack=[];try{const t=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),"lineWidth");e._setLineWidth=t.set,e._getLineWidth=t.get,Object.defineProperty(e,"lineWidth",{set:function(e){this._setLineWidth(1.000001*e)},get:function(){return this._getLineWidth()}})}catch(e){}Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){const[e,t,n,i,r,s]=this._transformMatrix,o=e*i-t*n,a=t*n-e*i;return[i/o,t/a,n/a,e/o,(i*r-n*s)/a,(t*r-e*s)/o]}}),e.save=function(){const e=this._transformMatrix;this._transformStack.push(e),this._transformMatrix=e.slice(0,6),this._originalSave()},e.restore=function(){0===this._transformStack.length&&(0,i.warn)("Tried to restore a ctx when the stack was already empty.");const e=this._transformStack.pop();e&&(this._transformMatrix=e,this._originalRestore())},e.translate=function(e,t){const n=this._transformMatrix;n[4]=n[0]*e+n[2]*t+n[4],n[5]=n[1]*e+n[3]*t+n[5],this._originalTranslate(e,t)},e.scale=function(e,t){const n=this._transformMatrix;n[0]*=e,n[1]*=e,n[2]*=t,n[3]*=t,this._originalScale(e,t)},e.transform=function(t,n,i,r,s,o){const a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*n,a[1]*t+a[3]*n,a[0]*i+a[2]*r,a[1]*i+a[3]*r,a[0]*s+a[2]*o+a[4],a[1]*s+a[3]*o+a[5]],e._originalTransform(t,n,i,r,s,o)},e.setTransform=function(t,n,i,r,s,o){this._transformMatrix=[t,n,i,r,s,o],e._originalSetTransform(t,n,i,r,s,o)},e.resetTransform=function(){this._transformMatrix=[1,0,0,1,0,0],e._originalResetTransform()},e.rotate=function(e){const t=Math.cos(e),n=Math.sin(e),i=this._transformMatrix;this._transformMatrix=[i[0]*t+i[2]*n,i[1]*t+i[3]*n,i[0]*-n+i[2]*t,i[1]*-n+i[3]*t,i[4],i[5]],this._originalRotate(e)}}}class h{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n,i){let r;return void 0!==this.cache[e]?(r=this.cache[e],this.canvasFactory.reset(r,t,n),r.context.setTransform(1,0,0,1,0,0)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),i&&d(r.context),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function u(e,t,n,i,r,s,o,a,l,c){const[d,h,u,p,m,g]=e.mozCurrentTransform;if(0===h&&0===u){const f=o*d+m,v=Math.round(f),y=a*p+g,b=Math.round(y),w=(o+l)*d+m,S=Math.abs(Math.round(w)-v)||1,_=(a+c)*p+g,E=Math.abs(Math.round(_)-b)||1;return e.setTransform(Math.sign(d),0,0,Math.sign(p),v,b),e.drawImage(t,n,i,r,s,0,0,S,E),e.setTransform(d,h,u,p,m,g),[S,E]}if(0===d&&0===p){const f=a*u+m,v=Math.round(f),y=o*h+g,b=Math.round(y),w=(a+c)*u+m,S=Math.abs(Math.round(w)-v)||1,_=(o+l)*h+g,E=Math.abs(Math.round(_)-b)||1;return e.setTransform(0,Math.sign(h),Math.sign(u),0,v,b),e.drawImage(t,n,i,r,s,0,0,E,S),e.setTransform(d,h,u,p,m,g),[E,S]}return e.drawImage(t,n,i,r,s,o,a,l,c),[Math.hypot(d,h)*l,Math.hypot(u,p)*c]}class p{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=i.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=i.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=i.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=i.Util.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){const n=i.Util.applyTransform(t,e),r=i.Util.applyTransform(t.slice(2),e);this.minX=Math.min(this.minX,n[0],r[0]),this.minY=Math.min(this.minY,n[1],r[1]),this.maxX=Math.max(this.maxX,n[0],r[0]),this.maxY=Math.max(this.maxY,n[1],r[1])}updateScalingPathMinMax(e,t){i.Util.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,r,s,o,a,l,c,d){const h=i.Util.bezierBoundingBox(t,n,r,s,o,a,l,c);if(d)return d[0]=Math.min(d[0],h[0],h[2]),d[1]=Math.max(d[1],h[0],h[2]),d[2]=Math.min(d[2],h[1],h[3]),void(d[3]=Math.max(d[3],h[1],h[3]));this.updateRectMinMax(e,h)}getPathBoundingBox(e=s.PathType.FILL,t=null){const n=[this.minX,this.minY,this.maxX,this.maxY];if(e===s.PathType.STROKE){t||(0,i.unreachable)("Stroke bounding box must include transform.");const e=i.Util.singularValueDecompose2dScale(t),r=e[0]*this.lineWidth/2,s=e[1]*this.lineWidth/2;n[0]-=r,n[1]-=s,n[2]+=r,n[3]+=s}return n}updateClipFromPath(){const e=i.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=s.PathType.FILL,t=null){return i.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function m(e,t,n=null){if("undefined"!=typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);const r=t.height,s=t.width,o=r%c,a=(r-o)/c,l=0===o?a:a+1,d=e.createImageData(s,c);let h,u=0;const p=t.data,m=d.data;let g,f,v,y,b,w,S,_;if(n)switch(n.length){case 1:b=n[0],w=n[0],S=n[0],_=n[0];break;case 4:b=n[0],w=n[1],S=n[2],_=n[3]}if(t.kind===i.ImageKind.GRAYSCALE_1BPP){const t=p.byteLength,n=new Uint32Array(m.buffer,0,m.byteLength>>2),r=n.length,y=s+7>>3;let b=4294967295,w=i.FeatureTest.isLittleEndian?4278190080:255;for(_&&255===_[0]&&0===_[255]&&([b,w]=[w,b]),g=0;g<l;g++){for(v=g<a?c:o,h=0,f=0;f<v;f++){const e=t-u;let i=0;const r=e>y?s:8*e-7,o=-8&r;let a=0,l=0;for(;i<o;i+=8)l=p[u++],n[h++]=128&l?b:w,n[h++]=64&l?b:w,n[h++]=32&l?b:w,n[h++]=16&l?b:w,n[h++]=8&l?b:w,n[h++]=4&l?b:w,n[h++]=2&l?b:w,n[h++]=1&l?b:w;for(;i<r;i++)0===a&&(l=p[u++],a=128),n[h++]=l&a?b:w,a>>=1}for(;h<r;)n[h++]=0;e.putImageData(d,0,g*c)}}else if(t.kind===i.ImageKind.RGBA_32BPP){const t=!!(b||w||S);for(f=0,y=s*c*4,g=0;g<a;g++){if(m.set(p.subarray(u,u+y)),u+=y,t)for(let e=0;e<y;e+=4)b&&(m[e+0]=b[m[e+0]]),w&&(m[e+1]=w[m[e+1]]),S&&(m[e+2]=S[m[e+2]]);e.putImageData(d,0,f),f+=c}if(g<l){if(y=s*o*4,m.set(p.subarray(u,u+y)),t)for(let e=0;e<y;e+=4)b&&(m[e+0]=b[m[e+0]]),w&&(m[e+1]=w[m[e+1]]),S&&(m[e+2]=S[m[e+2]]);e.putImageData(d,0,f)}}else{if(t.kind!==i.ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);{const t=!!(b||w||S);for(v=c,y=s*v,g=0;g<l;g++){for(g>=a&&(v=o,y=s*v),h=0,f=y;f--;)m[h++]=p[u++],m[h++]=p[u++],m[h++]=p[u++],m[h++]=255;if(t)for(let e=0;e<h;e+=4)b&&(m[e+0]=b[m[e+0]]),w&&(m[e+1]=w[m[e+1]]),S&&(m[e+2]=S[m[e+2]]);e.putImageData(d,0,g*c)}}}}function g(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);const n=t.height,i=t.width,r=n%c,s=(n-r)/c,a=0===r?s:s+1,l=e.createImageData(i,c);let d=0;const h=t.data,u=l.data;for(let t=0;t<a;t++){const n=t<s?c:r;({srcPos:d}=(0,o.applyMaskImageData)({src:h,srcPos:d,dest:u,width:i,height:n})),e.putImageData(l,0,t*c)}}function f(e,t){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let i=0,r=n.length;i<r;i++){const r=n[i];void 0!==e[r]&&(t[r]=e[r])}void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function v(e,t){e.strokeStyle=e.fillStyle=t||"#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0)}function y(e,t,n,i){const r=e.length;for(let s=3;s<r;s+=4){const r=e[s];if(0===r)e[s-3]=t,e[s-2]=n,e[s-1]=i;else if(r<255){const o=255-r;e[s-3]=e[s-3]*r+t*o>>8,e[s-2]=e[s-2]*r+n*o>>8,e[s-1]=e[s-1]*r+i*o>>8}}}function b(e,t,n){const i=e.length;for(let r=3;r<i;r+=4){const i=n?n[e[r]]:e[r];t[r]=t[r]*i*.00392156862745098|0}}function w(e,t,n){const i=e.length;for(let r=3;r<i;r+=4){const i=77*e[r-3]+152*e[r-2]+28*e[r-1];t[r]=n?t[r]*n[i>>8]>>8:t[r]*i>>16}}function S(e,t){const n=i.Util.singularValueDecompose2dScale(e);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*r.PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==t?t:n[0]<=s||n[1]<=s}const _=["butt","round","square"],E=["miter","round","bevel"],k={},x={};class T{constructor(e,t,n,i,r,s,o,a){this.ctx=e,this.current=new p(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=i,this.imageLayer=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=s,this.cachedCanvases=new h(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=a?.background||null,this.foregroundColor=a?.foreground||null,e&&d(e),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:i=null}){const s=this.ctx.canvas.width,o=this.ctx.canvas.height,a=i||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;const e=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;const t=this.backgroundColor=this.ctx.fillStyle;let n=!0,i=a;if(this.ctx.fillStyle=a,i=this.ctx.fillStyle,n="string"==typeof i&&/^#[0-9A-Fa-f]{6}$/.test(i),"#000000"===e&&"#ffffff"===t||e===t||!n)this.foregroundColor=this.backgroundColor=null;else{const[n,s,o]=(0,r.getRGB)(i),a=e=>(e/=255)<=.03928?e/12.92:((e+.055)/1.055)**2.4,l=Math.round(.2126*a(n)+.7152*a(s)+.0722*a(o));this.selectColor=(n,i,r)=>{const s=.2126*a(n)+.7152*a(i)+.0722*a(r);return Math.round(s)===l?t:e}}}if(this.ctx.fillStyle=this.backgroundColor||a,this.ctx.fillRect(0,0,s,o),this.ctx.restore(),n){const e=this.cachedCanvases.getCanvas("transparent",s,o,!0);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform)}this.ctx.save(),v(this.ctx,this.foregroundColor),e&&(this.ctx.transform.apply(this.ctx,e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform.apply(this.ctx,t.transform),this.viewportScale=t.scale,this.baseTransform=this.ctx.mozCurrentTransform.slice(),this.imageLayer&&this.imageLayer.beginLayout()}executeOperatorList(e,t,n,r){const s=e.argsArray,o=e.fnArray;let a=t||0;const l=s.length;if(l===a)return a;const c=l-a>10&&"function"==typeof n,d=c?Date.now()+15:0;let h=0;const u=this.commonObjs,p=this.objs;let m;for(;;){if(void 0!==r&&a===r.nextBreakPoint)return r.breakIt(a,n),a;if(m=o[a],m!==i.OPS.dependency)this[m].apply(this,s[a]);else for(const e of s[a]){const t=e.startsWith("g_")?u:p;if(!t.has(e))return t.get(e,n),a}if(a++,a===l)return a;if(c&&++h>10){if(Date.now()>d)return n(),a;h=0}}}#J(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#J(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(e,t){const n=e.width,i=e.height;let r,s,o=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=i,d="prescale1";for(;o>2&&l>1||a>2&&c>1;){let t=l,n=c;o>2&&l>1&&(t=Math.ceil(l/2),o/=l/t),a>2&&c>1&&(n=Math.ceil(c/2),a/=c/n),r=this.cachedCanvases.getCanvas(d,t,n,!1),s=r.context,s.clearRect(0,0,t,n),s.drawImage(e,0,0,l,c,0,0,t,n),e=r.canvas,l=t,c=n,d="prescale1"===d?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:n,height:r}=e,o=this.current.fillColor,a=this.current.patternFill,l=t.mozCurrentTransform;let c,d,h,p;if((e.bitmap||e.data)&&e.count>1){const t=e.bitmap||e.data.buffer,n=l.slice(0,4);d=JSON.stringify(a?n:[n,o]),c=this._cachedBitmapsMap.get(t),c||(c=new Map,this._cachedBitmapsMap.set(t,c));const i=c.get(d);if(i&&!a)return{canvas:i,offsetX:Math.round(Math.min(l[0],l[2])+l[4]),offsetY:Math.round(Math.min(l[1],l[3])+l[5])};h=i}h||(p=this.cachedCanvases.getCanvas("maskCanvas",n,r,!1),g(p.context,e));let m=i.Util.transform(l,[1/n,0,0,-1/r,0,0]);m=i.Util.transform(m,[1,0,0,1,0,-r]);const f=i.Util.applyTransform([0,0],m),v=i.Util.applyTransform([n,r],m),y=i.Util.normalizeRect([f[0],f[1],v[0],v[1]]),b=Math.round(y[2]-y[0])||1,w=Math.round(y[3]-y[1])||1,_=this.cachedCanvases.getCanvas("fillCanvas",b,w,!0),E=_.context,k=Math.min(f[0],v[0]),x=Math.min(f[1],v[1]);E.translate(-k,-x),E.transform.apply(E,m),h||(h=this._scaleImage(p.canvas,E.mozCurrentTransformInverse),h=h.img,c&&a&&c.set(d,h)),E.imageSmoothingEnabled=S(E.mozCurrentTransform,e.interpolate),u(E,h,0,0,h.width,h.height,0,0,n,r),E.globalCompositeOperation="source-in";const T=i.Util.transform(E.mozCurrentTransformInverse,[1,0,0,1,-k,-x]);return E.fillStyle=a?o.getPattern(t,this,T,s.PathType.FILL):o,E.fillRect(0,0,n,r),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(d,_.canvas)),{canvas:_.canvas,offsetX:Math.round(k),offsetY:Math.round(x)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=_[e]}setLineJoin(e){this.ctx.lineJoin=E[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n[0],r=n[1];switch(i){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=n[1];break;case"ca":this.current.fillAlpha=n[1],this.ctx.globalAlpha=n[1];break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=r}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,e,t,!0);this.suspendedCtx=this.ctx,this.ctx=i.context;const r=this.ctx;r.setTransform.apply(r,this.suspendedCtx.mozCurrentTransform),f(this.suspendedCtx,r),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},e.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},e.transform=function(e,n,i,r,s,o){t.transform(e,n,i,r,s,o),this.__originalTransform(e,n,i,r,s,o)},e.setTransform=function(e,n,i,r,s,o){t.setTransform(e,n,i,r,s,o),this.__originalSetTransform(e,n,i,r,s,o)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},e.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},e.bezierCurveTo=function(e,n,i,r,s,o){t.bezierCurveTo(e,n,i,r,s,o),this.__originalBezierCurveTo(e,n,i,r,s,o)},e.rect=function(e,n,i,r){t.rect(e,n,i,r),this.__originalRect(e,n,i,r)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),f(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask;(function(e,t,n,i){const r=i[0],s=i[1],o=i[2]-r,a=i[3]-s;0!==o&&0!==a&&(function(e,t,n,i,r,s,o,a,l,c,d){const h=!!s,u=h?s[0]:0,p=h?s[1]:0,m=h?s[2]:0;let g;g="Luminosity"===r?w:b;const f=Math.min(i,Math.ceil(1048576/n));for(let r=0;r<i;r+=f){const s=Math.min(f,i-r),v=e.getImageData(a-c,r+(l-d),n,s),b=t.getImageData(a,r+l,n,s);h&&y(v.data,u,p,m),g(v.data,b.data,o),t.putImageData(b,a,r+l)}}(t.context,n,o,a,t.subtype,t.backdrop,t.transferMap,r,s,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())})(this.suspendedCtx,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(f(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),f(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,i,r,s){this.ctx.transform(e,t,n,i,r,s),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){const r=this.ctx,s=this.current;let o,a,l=s.x,c=s.y;const d=r.mozCurrentTransform,h=0===d[0]&&0===d[3]||0===d[1]&&0===d[2],u=h?n.slice(0):null;for(let n=0,p=0,m=e.length;n<m;n++)switch(0|e[n]){case i.OPS.rectangle:l=t[p++],c=t[p++];const e=t[p++],n=t[p++],m=l+e,g=c+n;r.moveTo(l,c),0===e||0===n?r.lineTo(m,g):(r.lineTo(m,c),r.lineTo(m,g),r.lineTo(l,g)),h||s.updateRectMinMax(d,[l,c,m,g]),r.closePath();break;case i.OPS.moveTo:l=t[p++],c=t[p++],r.moveTo(l,c),h||s.updatePathMinMax(d,l,c);break;case i.OPS.lineTo:l=t[p++],c=t[p++],r.lineTo(l,c),h||s.updatePathMinMax(d,l,c);break;case i.OPS.curveTo:o=l,a=c,l=t[p+4],c=t[p+5],r.bezierCurveTo(t[p],t[p+1],t[p+2],t[p+3],l,c),s.updateCurvePathMinMax(d,o,a,t[p],t[p+1],t[p+2],t[p+3],l,c,u),p+=6;break;case i.OPS.curveTo2:o=l,a=c,r.bezierCurveTo(l,c,t[p],t[p+1],t[p+2],t[p+3]),s.updateCurvePathMinMax(d,o,a,l,c,t[p],t[p+1],t[p+2],t[p+3],u),l=t[p+2],c=t[p+3],p+=4;break;case i.OPS.curveTo3:o=l,a=c,l=t[p+2],c=t[p+3],r.bezierCurveTo(t[p],t[p+1],l,c,l,c),s.updateCurvePathMinMax(d,o,a,t[p],t[p+1],l,c,l,c,u),p+=4;break;case i.OPS.closePath:r.closePath()}h&&s.updateScalingPathMinMax(d,u),s.setCurrentPoint(l,c)}closePath(){this.ctx.closePath()}stroke(e){e=void 0===e||e;const t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof n&&n?.getPattern?(t.save(),t.strokeStyle=n.getPattern(t,this,t.mozCurrentTransformInverse,s.PathType.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e){e=void 0===e||e;const t=this.ctx,n=this.current.fillColor;let i=!1;this.current.patternFill&&(t.save(),t.fillStyle=n.getPattern(t,this,t.mozCurrentTransformInverse,s.PathType.FILL),i=!0);const r=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==r&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=k}eoClip(){this.pendingClip=x}beginText(){this.current.textMatrix=i.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(const n of e)t.setTransform.apply(t,n.transform),t.translate(n.x,n.y),n.addToPath(t,n.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const n=this.commonObjs.get(e),r=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=n.fontMatrix||i.FONT_IDENTITY_MATRIX,0!==r.fontMatrix[0]&&0!==r.fontMatrix[3]||(0,i.warn)("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;const s=n.loadedName||"sans-serif";let o="normal";n.black?o="900":n.bold&&(o="bold");const a=n.italic?"italic":"normal",l=`"${s}", ${n.fallbackName}`;let c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font=`${a} ${o} ${c}px ${l}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,i,r,s){this.current.textMatrix=[e,t,n,i,r,s],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,r){const s=this.ctx,o=this.current,a=o.font,l=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,d=l&i.TextRenderingMode.FILL_STROKE_MASK,h=!!(l&i.TextRenderingMode.ADD_TO_PATH_FLAG),u=o.patternFill&&!a.missingFile;let p;(a.disableFontFace||h||u)&&(p=a.getPathGenerator(this.commonObjs,e)),a.disableFontFace||u?(s.save(),s.translate(t,n),s.beginPath(),p(s,c),r&&s.setTransform.apply(s,r),d!==i.TextRenderingMode.FILL&&d!==i.TextRenderingMode.FILL_STROKE||s.fill(),d!==i.TextRenderingMode.STROKE&&d!==i.TextRenderingMode.FILL_STROKE||s.stroke(),s.restore()):(d!==i.TextRenderingMode.FILL&&d!==i.TextRenderingMode.FILL_STROKE||s.fillText(e,t,n),d!==i.TextRenderingMode.STROKE&&d!==i.TextRenderingMode.FILL_STROKE||s.strokeText(e,t,n)),h&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:s.mozCurrentTransform,x:t,y:n,fontSize:c,addToPath:p})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10,!1);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let e=3;e<t.length;e+=4)if(t[e]>0&&t[e]<255){n=!0;break}return(0,i.shadow)(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(0===r)return;const o=this.ctx,a=t.fontSizeScale,l=t.charSpacing,c=t.wordSpacing,d=t.fontDirection,h=t.textHScale*d,u=e.length,p=n.vertical,m=p?1:-1,g=n.defaultVMetrics,f=r*t.fontMatrix[0],v=t.textRenderingMode===i.TextRenderingMode.FILL&&!n.disableFontFace&&!t.patternFill;let y;if(o.save(),o.transform.apply(o,t.textMatrix),o.translate(t.x,t.y+t.textRise),d>0?o.scale(h,-1):o.scale(h,1),t.patternFill){o.save();const e=t.fillColor.getPattern(o,this,o.mozCurrentTransformInverse,s.PathType.FILL);y=o.mozCurrentTransform,o.restore(),o.fillStyle=e}let b=t.lineWidth;const w=t.textMatrixScale;if(0===w||0===b){const e=t.textRenderingMode&i.TextRenderingMode.FILL_STROKE_MASK;e!==i.TextRenderingMode.STROKE&&e!==i.TextRenderingMode.FILL_STROKE||(b=this.getSinglePixelWidth())}else b/=w;1!==a&&(o.scale(a,a),b/=a),o.lineWidth=b;let S,_=0;for(S=0;S<u;++S){const t=e[S];if("number"==typeof t){_+=m*t*r/1e3;continue}let i=!1;const s=(t.isSpace?c:0)+l,h=t.fontChar,u=t.accent;let b,w,E,k=t.width;if(p){const e=t.vmetric||g,n=-(t.vmetric?e[1]:.5*k)*f,i=e[2]*f;k=e?-e[0]:k,b=n/a,w=(_+i)/a}else b=_/a,w=0;if(n.remeasure&&k>0){const e=1e3*o.measureText(h).width/r*a;if(k<e&&this.isFontSubpixelAAEnabled){const t=k/e;i=!0,o.save(),o.scale(t,1),b/=t}else k!==e&&(b+=(k-e)/2e3*r/a)}if(this.contentVisible&&(t.isInFont||n.missingFile))if(v&&!u)o.fillText(h,b,w);else if(this.paintChar(h,b,w,y),u){const e=b+r*u.offset.x/a,t=w-r*u.offset.y/a;this.paintChar(u.fontChar,e,t,y)}E=p?k*f-s*d:k*f+s*d,_+=E,i&&o.restore()}p?t.y-=_:t.x+=_*h,o.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,r=n.font,s=n.fontSize,o=n.fontDirection,a=r.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*o,h=n.fontMatrix||i.FONT_IDENTITY_MATRIX,u=e.length;let p,m,g,f;if(n.textRenderingMode!==i.TextRenderingMode.INVISIBLE&&0!==s){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,t.save(),t.transform.apply(t,n.textMatrix),t.translate(n.x,n.y),t.scale(d,o),p=0;p<u;++p){if(m=e[p],"number"==typeof m){f=a*m*s/1e3,this.ctx.translate(f,0),n.x+=f*d;continue}const o=(m.isSpace?c:0)+l,u=r.charProcOperatorList[m.operatorListId];u?(this.contentVisible&&(this.processingType3=m,this.save(),t.scale(s,s),t.transform.apply(t,h),this.executeOperatorList(u),this.restore()),g=i.Util.applyTransform([m.width,0],h)[0]*s+o,t.translate(g,0),n.x+=g*d):(0,i.warn)(`Type3 character "${m.operatorListId}" is not available.`)}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,i,r,s){this.ctx.rect(n,i,r-n,s-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){const n=e[1],i=this.baseTransform||this.ctx.mozCurrentTransform.slice(),r={createCanvasGraphics:e=>new T(e,this.commonObjs,this.objs,this.canvasFactory)};t=new s.TilingPattern(e,n,this.ctx,r,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){const r=this.selectColor?.(e,t,n)||i.Util.makeHexColor(e,t,n);this.ctx.strokeStyle=r,this.current.strokeColor=r}setFillRGBColor(e,t,n){const r=this.selectColor?.(e,t,n)||i.Util.makeHexColor(e,t,n);this.ctx.fillStyle=r,this.current.fillColor=r,this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=(0,s.getShadingPattern)(this.objs.get(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,t.mozCurrentTransformInverse,s.PathType.SHADING);const r=t.mozCurrentTransformInverse;if(r){const e=t.canvas,n=e.width,s=e.height,o=i.Util.applyTransform([0,0],r),a=i.Util.applyTransform([0,s],r),l=i.Util.applyTransform([n,0],r),c=i.Util.applyTransform([n,s],r),d=Math.min(o[0],a[0],l[0],c[0]),h=Math.min(o[1],a[1],l[1],c[1]),u=Math.max(o[0],a[0],l[0],c[0]),p=Math.max(o[1],a[1],l[1],c[1]);this.ctx.fillRect(d,h,u-d,p-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,i.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,i.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform.apply(this,e),this.baseTransform=this.ctx.mozCurrentTransform,t)){const e=t[2]-t[0],n=t[3]-t[1];this.ctx.rect(t[0],t[1],e,n),this.current.updateRectMinMax(this.ctx.mozCurrentTransform,t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||(0,i.info)("TODO: Support non-isolated groups."),e.knockout&&(0,i.warn)("Knockout groups not supported.");const n=t.mozCurrentTransform;if(e.matrix&&t.transform.apply(t,e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=i.Util.getAxialAlignedBoundingBox(e.bbox,t.mozCurrentTransform);const s=[0,0,t.canvas.width,t.canvas.height];r=i.Util.intersect(r,s)||[0,0,0,0];const o=Math.floor(r[0]),a=Math.floor(r[1]);let c=Math.max(Math.ceil(r[2])-o,1),d=Math.max(Math.ceil(r[3])-a,1),h=1,u=1;c>l&&(h=c/l,c=l),d>l&&(u=d/l,d=l),this.current.startNewPathAndClipBox([0,0,c,d]);let p="groupAt"+this.groupLevel;e.smask&&(p+="_smask_"+this.smaskCounter++%2);const m=this.cachedCanvases.getCanvas(p,c,d,!0),g=m.context;g.scale(1/h,1/u),g.translate(-o,-a),g.transform.apply(g,n),e.smask?this.smaskStack.push({canvas:m.canvas,context:g,offsetX:o,offsetY:a,scaleX:h,scaleY:u,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.scale(h,u),t.save()),f(t,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const e=this.ctx.mozCurrentTransform;this.restore(),this.ctx.save(),this.ctx.setTransform.apply(this.ctx,e);const n=i.Util.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,n,r,s){if(this.#J(),v(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform),Array.isArray(t)&&4===t.length){const r=t[2]-t[0],o=t[3]-t[1];if(s&&this.annotationCanvasMap){(n=n.slice())[4]-=t[0],n[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=r,t[3]=o;const[s,a]=i.Util.singularValueDecompose2dScale(this.ctx.mozCurrentTransform),{viewportScale:l}=this,c=Math.ceil(r*this.outputScaleX*l),h=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(c,h);const{canvas:u,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,d(this.ctx),this.ctx.setTransform(s,0,0,-a,0,o*a),v(this.ctx,this.foregroundColor)}else v(this.ctx,this.foregroundColor),this.ctx.rect(t[0],t[1],r,o),this.ctx.clip(),this.endPath()}this.current=new p(this.ctx.canvas.width,this.ctx.canvas.height),this.transform.apply(this,n),this.transform.apply(this,r)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;(e=this.getObject(e.data,e)).count=t;const n=this.ctx,i=this.processingType3;if(i&&(void 0===i.compiled&&(i.compiled=function(e){const{width:t,height:n}=e;if(t>1e3||n>1e3)return null;const i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=t+1;let s,o,l,c=new Uint8Array(r*(n+1));const d=t+7&-8;let h=new Uint8Array(d*n),u=0;for(const t of e.data){let e=128;for(;e>0;)h[u++]=t&e?0:255,e>>=1}let p=0;for(u=0,0!==h[u]&&(c[0]=1,++p),o=1;o<t;o++)h[u]!==h[u+1]&&(c[o]=h[u]?2:1,++p),u++;for(0!==h[u]&&(c[o]=2,++p),s=1;s<n;s++){u=s*d,l=s*r,h[u-d]!==h[u]&&(c[l]=h[u]?1:8,++p);let e=(h[u]?4:0)+(h[u-d]?8:0);for(o=1;o<t;o++)e=(e>>2)+(h[u+1]?4:0)+(h[u-d+1]?8:0),i[e]&&(c[l+o]=i[e],++p),u++;if(h[u-d]!==h[u]&&(c[l+o]=h[u]?2:4,++p),p>1e3)return null}for(u=d*(n-1),l=s*r,0!==h[u]&&(c[l]=8,++p),o=1;o<t;o++)h[u]!==h[u+1]&&(c[l+o]=h[u]?4:8,++p),u++;if(0!==h[u]&&(c[l+o]=4,++p),p>1e3)return null;const m=new Int32Array([0,r,-1,0,-r,0,0,0,1]);let g,f,v;for(a.isNodeJS?f=[]:g=new Path2D,s=0;p&&s<=n;s++){let e=s*r;const n=e+t;for(;e<n&&!c[e];)e++;if(e===n)continue;g?g.moveTo(e%r,s):v=[e%r,s];const i=e;let o=c[e];do{const t=m[o];do{e+=t}while(!c[e]);const n=c[e];5!==n&&10!==n?(o=n,c[e]=0):(o=n&51*o>>4,c[e]&=o>>2|o<<2),g?g.lineTo(e%r,e/r|0):v.push(e%r,e/r|0),c[e]||--p}while(i!==e);g||f.push(v),--s}return h=null,c=null,function(e){if(e.save(),e.scale(1/t,-1/n),e.translate(0,-n),g)e.fill(g);else{e.beginPath();for(const t of f){e.moveTo(t[0],t[1]);for(let n=2,i=t.length;n<i;n+=2)e.lineTo(t[n],t[n+1])}e.fill()}e.beginPath(),e.restore()}}(e)),i.compiled))return void i.compiled(n);const r=this._createMaskCanvas(e),s=r.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(s,r.offsetX,r.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,r=0,s,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const l=a.mozCurrentTransform;a.transform(t,n,r,s,0,0);const c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,0,0);for(let e=0,d=o.length;e<d;e+=2){const d=i.Util.transform(l,[t,n,r,s,o[e],o[e+1]]),[h,u]=i.Util.applyTransform([0,0],d);a.drawImage(c.canvas,h,u)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,i=this.current.patternFill;for(const r of e){const{data:e,width:o,height:a,transform:l}=r,c=this.cachedCanvases.getCanvas("maskCanvas",o,a,!1),d=c.context;d.save(),g(d,this.getObject(e,r)),d.globalCompositeOperation="source-in",d.fillStyle=i?n.getPattern(d,this,t.mozCurrentTransformInverse,s.PathType.FILL):n,d.fillRect(0,0,o,a),d.restore(),t.save(),t.transform.apply(t,l),t.scale(1,-1),u(t,c.canvas,0,0,o,a,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,i.warn)("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,n,r){if(!this.contentVisible)return;const s=this.getObject(e);if(!s)return void(0,i.warn)("Dependent image isn't ready yet");const o=s.width,a=s.height,l=[];for(let e=0,i=r.length;e<i;e+=2)l.push({transform:[t,0,0,n,r[e],r[e+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(s,l)}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,i=this.ctx;let r;if(this.save(),i.scale(1/t,-1/n),"function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)r=e;else{const i=this.cachedCanvases.getCanvas("inlineImage",t,n,!1);m(i.context,e,this.current.transferMaps),r=i.canvas}const s=this._scaleImage(r,i.mozCurrentTransformInverse);i.imageSmoothingEnabled=S(i.mozCurrentTransform,e.interpolate);const[o,a]=u(i,s.img,0,0,s.paintWidth,s.paintHeight,0,-n,t,n);if(this.imageLayer){const t=this.getCanvasPosition(0,-n);this.imageLayer.appendImage({imgData:e,left:t[0],top:t[1],width:o,height:a})}this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx,i=e.width,r=e.height,s=this.cachedCanvases.getCanvas("inlineImage",i,r,!1);m(s.context,e,this.current.transferMaps);for(let o=0,a=t.length;o<a;o++){const a=t[o];if(n.save(),n.transform.apply(n,a.transform),n.scale(1,-1),u(n,s.canvas,a.x,a.y,a.w,a.h,0,-1,1,1),this.imageLayer){const t=this.getCanvasPosition(a.x,a.y);this.imageLayer.appendImage({imgData:e,left:t[0],top:t[1],width:i,height:r})}n.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const n=this.ctx;this.pendingClip&&(t||(this.pendingClip===x?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=this.ctx.mozCurrentTransform;if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:e}=this.current,t=this.ctx.mozCurrentTransform;let n,i;if(0===t[1]&&0===t[2]){const r=Math.abs(t[0]),s=Math.abs(t[3]);if(0===e)n=1/r,i=1/s;else{const t=r*e,o=s*e;n=t<1?1/t:1,i=o<1?1/o:1}}else{const r=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[1]),o=Math.hypot(t[2],t[3]);if(0===e)n=o/r,i=s/r;else{const t=e*r;n=o>t?o/t:1,i=s>t?s/t:1}}this._cachedScaleForStroking=[n,i]}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:n}=this.current,[i,r]=this.getScaleForStroking();if(t.lineWidth=n||1,1===i&&1===r)return void t.stroke();let s,o,a;e&&(s=t.mozCurrentTransform.slice(),o=t.getLineDash().slice(),a=t.lineDashOffset),t.scale(i,r);const l=Math.max(i,r);t.setLineDash(t.getLineDash().map((e=>e/l))),t.lineDashOffset/=l,t.stroke(),e&&(t.setTransform(...s),t.setLineDash(o),t.lineDashOffset=a)}getCanvasPosition(e,t){const n=this.ctx.mozCurrentTransform;return[n[0]*e+n[2]*t+n[4],n[1]*e+n[3]*t+n[5]]}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}t.CanvasGraphics=T;for(const e in i.OPS)void 0!==T.prototype[e]&&(T.prototype[i.OPS[e]]=T.prototype[e])},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=function(e){switch(e[0]){case"RadialAxial":return new l(e);case"Mesh":return new h(e);case"Dummy":return new u}throw new Error(`Unknown IR type: ${e[0]}`)};var i=n(1),r=n(3);const s={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function o(e,t){if(!t||r.isNodeJS)return;const n=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],n,i),e.clip(s)}t.PathType=s;class a{constructor(){this.constructor===a&&(0,i.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,i.unreachable)("Abstract method `getPattern` called.")}}class l extends a{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const e of this._colorStops)t.addColorStop(e[0],e[1]);return t}getPattern(e,t,n,r){let a;if(r===s.STROKE||r===s.FILL){const s=t.current.getClippedPathBoundingBox(r,e.mozCurrentTransform)||[0,0,0,0],l=Math.ceil(s[2]-s[0])||1,c=Math.ceil(s[3]-s[1])||1,d=t.cachedCanvases.getCanvas("pattern",l,c,!0),h=d.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-s[0],-s[1]),n=i.Util.transform(n,[1,0,0,1,s[0],s[1]]),h.transform.apply(h,t.baseTransform),this.matrix&&h.transform.apply(h,this.matrix),o(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),a=e.createPattern(d.canvas,"no-repeat");const u=new DOMMatrix(n);try{a.setTransform(u)}catch(e){(0,i.warn)(`RadialAxialShadingPattern.getPattern: "${e?.message}".`)}}else o(e,this._bbox),a=this._createGradient(e);return a}}function c(e,t,n,i,r,s,o,a){const l=t.coords,c=t.colors,d=e.data,h=4*e.width;let u;l[n+1]>l[i+1]&&(u=n,n=i,i=u,u=s,s=o,o=u),l[i+1]>l[r+1]&&(u=i,i=r,r=u,u=o,o=a,a=u),l[n+1]>l[i+1]&&(u=n,n=i,i=u,u=s,s=o,o=u);const p=(l[n]+t.offsetX)*t.scaleX,m=(l[n+1]+t.offsetY)*t.scaleY,g=(l[i]+t.offsetX)*t.scaleX,f=(l[i+1]+t.offsetY)*t.scaleY,v=(l[r]+t.offsetX)*t.scaleX,y=(l[r+1]+t.offsetY)*t.scaleY;if(m>=y)return;const b=c[s],w=c[s+1],S=c[s+2],_=c[o],E=c[o+1],k=c[o+2],x=c[a],T=c[a+1],C=c[a+2],A=Math.round(m),I=Math.round(y);let R,P,O,M,D,L,F,N;for(let e=A;e<=I;e++){if(e<f){let t;t=e<m?0:(m-e)/(m-f),R=p-(p-g)*t,P=b-(b-_)*t,O=w-(w-E)*t,M=S-(S-k)*t}else{let t;t=e>y?1:f===y?0:(f-e)/(f-y),R=g-(g-v)*t,P=_-(_-x)*t,O=E-(E-T)*t,M=k-(k-C)*t}let t;t=e<m?0:e>y?1:(m-e)/(m-y),D=p-(p-v)*t,L=b-(b-x)*t,F=w-(w-T)*t,N=S-(S-C)*t;const n=Math.round(Math.min(R,D)),i=Math.round(Math.max(R,D));let r=h*e+4*n;for(let e=n;e<=i;e++)t=(R-e)/(R-D),t<0?t=0:t>1&&(t=1),d[r++]=P-(P-L)*t|0,d[r++]=O-(O-F)*t|0,d[r++]=M-(M-N)*t|0,d[r++]=255}}function d(e,t,n){const i=t.coords,r=t.colors;let s,o;switch(t.type){case"lattice":const a=t.verticesPerRow,l=Math.floor(i.length/a)-1,d=a-1;for(s=0;s<l;s++){let t=s*a;for(let s=0;s<d;s++,t++)c(e,n,i[t],i[t+1],i[t+a],r[t],r[t+1],r[t+a]),c(e,n,i[t+a+1],i[t+1],i[t+a],r[t+a+1],r[t+1],r[t+a])}break;case"triangles":for(s=0,o=i.length;s<o;s+=3)c(e,n,i[s],i[s+1],i[s+2],r[s],r[s+1],r[s+2]);break;default:throw new Error("illegal figure")}}class h extends a{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){const i=Math.floor(this._bounds[0]),r=Math.floor(this._bounds[1]),s=Math.ceil(this._bounds[2])-i,o=Math.ceil(this._bounds[3])-r,a=Math.min(Math.ceil(Math.abs(s*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(o*e[1]*1.1)),3e3),c=s/a,h=o/l,u={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-r,scaleX:1/c,scaleY:1/h},p=a+4,m=l+4,g=n.getCanvas("mesh",p,m,!1),f=g.context,v=f.createImageData(a,l);if(t){const e=v.data;for(let n=0,i=e.length;n<i;n+=4)e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=255}for(const e of this._figures)d(v,e,u);return f.putImageData(v,2,2),{canvas:g.canvas,offsetX:i-2*c,offsetY:r-2*h,scaleX:c,scaleY:h}}getPattern(e,t,n,r){let a;if(o(e,this._bbox),r===s.SHADING)a=i.Util.singularValueDecompose2dScale(e.mozCurrentTransform);else if(a=i.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){const e=i.Util.singularValueDecompose2dScale(this.matrix);a=[a[0]*e[0],a[1]*e[1]]}const l=this._createMeshCanvas(a,r===s.SHADING?null:this._background,t.cachedCanvases);return r!==s.SHADING&&(e.setTransform.apply(e,t.baseTransform),this.matrix&&e.transform.apply(e,this.matrix)),e.translate(l.offsetX,l.offsetY),e.scale(l.scaleX,l.scaleY),e.createPattern(l.canvas,"no-repeat")}}class u extends a{getPattern(){return"hotpink"}}class p{static get MAX_PATTERN_SIZE(){return(0,i.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(e,t,n,i,r){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(e){const t=this.operatorList,n=this.bbox,r=this.xstep,s=this.ystep,o=this.paintType,a=this.tilingType,l=this.color,c=this.canvasGraphicsFactory;(0,i.info)("TilingType: "+a);const d=n[0],h=n[1],u=n[2],p=n[3],m=i.Util.singularValueDecompose2dScale(this.matrix),g=i.Util.singularValueDecompose2dScale(this.baseTransform),f=[m[0]*g[0],m[1]*g[1]],v=this.getSizeAndScale(r,this.ctx.canvas.width,f[0]),y=this.getSizeAndScale(s,this.ctx.canvas.height,f[1]),b=e.cachedCanvases.getCanvas("pattern",v.size,y.size,!0),w=b.context,S=c.createCanvasGraphics(w);S.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(S,o,l);let _=d,E=h,k=u,x=p;return d<0&&(_=0,k+=Math.abs(d)),h<0&&(E=0,x+=Math.abs(h)),w.translate(-v.scale*_,-y.scale*E),S.transform(v.scale,0,0,y.scale,0,0),w.save(),this.clipBbox(S,_,E,k,x),S.baseTransform=S.ctx.mozCurrentTransform.slice(),S.executeOperatorList(t),S.endDrawing(),{canvas:b.canvas,scaleX:v.scale,scaleY:y.scale,offsetX:_,offsetY:E}}getSizeAndScale(e,t,n){e=Math.abs(e);const i=Math.max(p.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*n);return r>=i?r=i:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,i,r){const s=i-t,o=r-n;e.ctx.rect(t,n,s,o),e.current.updateRectMinMax(e.ctx.mozCurrentTransform,[t,n,i,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,s=e.current;switch(t){case 1:const e=this.ctx;r.fillStyle=e.fillStyle,r.strokeStyle=e.strokeStyle,s.fillColor=e.fillStyle,s.strokeColor=e.strokeStyle;break;case 2:const o=i.Util.makeHexColor(n[0],n[1],n[2]);r.fillStyle=o,r.strokeStyle=o,s.fillColor=o,s.strokeColor=o;break;default:throw new i.FormatError(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,r){let o=n;r!==s.SHADING&&(o=i.Util.transform(o,t.baseTransform),this.matrix&&(o=i.Util.transform(o,this.matrix)));const a=this.createPatternCanvas(t);let l=new DOMMatrix(o);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const c=e.createPattern(a.canvas,"repeat");try{c.setTransform(l)}catch(e){(0,i.warn)(`TilingPattern.getPattern: "${e?.message}".`)}return c}}t.TilingPattern=p},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyMaskImageData=function({src:e,srcPos:t=0,dest:n,destPos:r=0,width:s,height:o,inverseDecode:a=!1}){const l=i.FeatureTest.isLittleEndian?4278190080:255,[c,d]=a?[0,l]:[l,0],h=s>>3,u=7&s,p=e.length;n=new Uint32Array(n.buffer);for(let i=0;i<o;i++){for(const i=t+h;t<i;t++){const i=t<p?e[t]:255;n[r++]=128&i?d:c,n[r++]=64&i?d:c,n[r++]=32&i?d:c,n[r++]=16&i?d:c,n[r++]=8&i?d:c,n[r++]=4&i?d:c,n[r++]=2&i?d:c,n[r++]=1&i?d:c}if(0===u)continue;const i=t<p?e[t++]:255;for(let e=0;e<u;e++)n[r++]=i&1<<7-e?d:c}return{srcPos:t,destPos:r}};var i=n(1)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;const n=Object.create(null);t.GlobalWorkerOptions=n,n.workerPort=void 0===n.workerPort?null:n.workerPort,n.workerSrc=void 0===n.workerSrc?"":n.workerSrc},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var i=n(1);function r(e){switch(e instanceof Error||"object"==typeof e&&null!==e||(0,i.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new i.AbortException(e.message);case"MissingPDFException":return new i.MissingPDFException(e.message);case"PasswordException":return new i.PasswordException(e.message,e.code);case"UnexpectedResponseException":return new i.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new i.UnknownErrorException(e.message,e.details);default:return new i.UnknownErrorException(e.message,e.toString())}}t.MessageHandler=class{constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{const t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void this._processStreamMessage(t);if(t.callback){const e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],1===t.callback)n.resolve(t.data);else{if(2!==t.callback)throw new Error("Unexpected callback case");n.reject(r(t.reason))}return}const i=this.actionHandler[t.action];if(!i)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const e=this.sourceName,s=t.sourceName;new Promise((function(e){e(i(t.data))})).then((function(i){n.postMessage({sourceName:e,targetName:s,callback:1,callbackId:t.callbackId,data:i})}),(function(i){n.postMessage({sourceName:e,targetName:s,callback:2,callbackId:t.callbackId,reason:r(i)})}))}else t.streamId?this._createStreamSink(t):i(t.data)},n.addEventListener("message",this._onComObjOnMessage)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,s=(0,i.createPromiseCapability)();this.callbackCapabilities[r]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(e){s.reject(e)}return s.promise}sendWithStream(e,t,n,s){const o=this.streamId++,a=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:n=>{const r=(0,i.createPromiseCapability)();return this.streamControllers[o]={controller:n,startCall:r,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:a,targetName:l,action:e,streamId:o,data:t,desiredSize:n.desiredSize},s),r.promise},pull:e=>{const t=(0,i.createPromiseCapability)();return this.streamControllers[o].pullCall=t,c.postMessage({sourceName:a,targetName:l,stream:6,streamId:o,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,i.assert)(e instanceof Error,"cancel must have a valid reason");const t=(0,i.createPromiseCapability)();return this.streamControllers[o].cancelCall=t,this.streamControllers[o].isClosed=!0,c.postMessage({sourceName:a,targetName:l,stream:1,streamId:o,reason:r(e)}),t.promise}},n)}_createStreamSink(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,o=this.comObj,a=this,l=this.actionHandler[e.action],c={enqueue(e,r=1,a){if(this.isCancelled)return;const l=this.desiredSize;this.desiredSize-=r,l>0&&this.desiredSize<=0&&(this.sinkCapability=(0,i.createPromiseCapability)(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:s,stream:4,streamId:t,chunk:e},a)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:3,streamId:t}),delete a.streamSinks[t])},error(e){(0,i.assert)(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:5,streamId:t,reason:r(e)}))},sinkCapability:(0,i.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,new Promise((function(t){t(l(e.data,c))})).then((function(){o.postMessage({sourceName:n,targetName:s,stream:8,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:n,targetName:s,stream:8,streamId:t,reason:r(e)})}))}_processStreamMessage(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,o=this.comObj,a=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case 8:e.success?a.startCall.resolve():a.startCall.reject(r(e.reason));break;case 7:e.success?a.pullCall.resolve():a.pullCall.reject(r(e.reason));break;case 6:if(!l){o.postMessage({sourceName:n,targetName:s,stream:7,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,new Promise((function(e){e(l.onPull&&l.onPull())})).then((function(){o.postMessage({sourceName:n,targetName:s,stream:7,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:n,targetName:s,stream:7,streamId:t,reason:r(e)})}));break;case 4:if((0,i.assert)(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case 3:if((0,i.assert)(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this._deleteStreamController(a,t);break;case 5:(0,i.assert)(a,"error should have stream controller"),a.controller.error(r(e.reason)),this._deleteStreamController(a,t);break;case 2:e.success?a.cancelCall.resolve():a.cancelCall.reject(r(e.reason)),this._deleteStreamController(a,t);break;case 1:if(!l)break;new Promise((function(t){t(l.onCancel&&l.onCancel(r(e.reason)))})).then((function(){o.postMessage({sourceName:n,targetName:s,stream:2,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:n,targetName:s,stream:2,streamId:t,reason:r(e)})})),l.sinkCapability.reject(r(e.reason)),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(e,t){await Promise.allSettled([e.startCall&&e.startCall.promise,e.pullCall&&e.pullCall.promise,e.cancelCall&&e.cancelCall.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var i=n(1);t.Metadata=class{#Q;#ee;constructor({parsedData:e,rawData:t}){this.#Q=e,this.#ee=t}getRaw(){return this.#ee}get(e){return this.#Q.get(e)??null}getAll(){return(0,i.objectFromMap)(this.#Q)}has(e){return this.#Q.has(e)}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var i=n(1);const r=Symbol("INTERNAL");class s{#te=!0;constructor(e,t){this.name=e,this.intent=t}get visible(){return this.#te}_setVisible(e,t){e!==r&&(0,i.unreachable)("Internal method `_setVisible` called."),this.#te=t}}t.OptionalContentConfig=class{#ne=!0;#ie=new Map;#re=null;#se=null;constructor(e){if(this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,this.#se=e.order;for(const t of e.groups)this.#ie.set(t.id,new s(t.name,t.intent));if("OFF"===e.baseState)for(const e of this.#ie.values())e._setVisible(r,!1);for(const t of e.on)this.#ie.get(t)._setVisible(r,!0);for(const t of e.off)this.#ie.get(t)._setVisible(r,!1);this.#re=new Map;for(const[e,t]of this.#ie)this.#re.set(e,t.visible)}}#oe(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const t=e[r];let s;if(Array.isArray(t))s=this.#oe(t);else{if(!this.#ie.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;s=this.#ie.get(t).visible}switch(n){case"And":if(!s)return!1;break;case"Or":if(s)return!0;break;case"Not":return!s;default:return!0}}return"And"===n}isVisible(e){if(0===this.#ie.size)return!0;if(!e)return(0,i.warn)("Optional content group not defined."),!0;if("OCG"===e.type)return this.#ie.has(e.id)?this.#ie.get(e.id).visible:((0,i.warn)(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return this.#oe(e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this.#ie.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(this.#ie.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this.#ie.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(!this.#ie.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this.#ie.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(!this.#ie.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this.#ie.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(this.#ie.get(t).visible)return!1}return!0}return(0,i.warn)(`Unknown optional content policy ${e.policy}.`),!0}return(0,i.warn)(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){this.#ie.has(e)?(this.#ie.get(e)._setVisible(r,!!t),this.#ne=null):(0,i.warn)(`Optional content group not found: ${e}`)}get hasInitialVisibility(){if(null!==this.#ne)return this.#ne;for(const[e,t]of this.#ie){const n=this.#re.get(e);if(t.visible!==n)return this.#ne=!1}return this.#ne=!0}getOrder(){return this.#ie.size?this.#se?this.#se.slice():[...this.#ie.keys()]:null}getGroups(){return this.#ie.size>0?(0,i.objectFromMap)(this.#ie):null}getGroup(e){return this.#ie.get(e)||null}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var i=n(1),r=n(4);t.PDFDataTransportStream=class{constructor(e,t){(0,i.assert)(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=e.progressiveDone||!1,this._contentDispositionFilename=e.contentDispositionFilename||null;const n=e.initialData;if(n?.length>0){const e=new Uint8Array(n).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._contentLength=e.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),this._pdfDataRangeTransport.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),this._pdfDataRangeTransport.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),this._pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),this._pdfDataRangeTransport.transportReady()}_onReceiveData(e){const t=new Uint8Array(e.chunk).buffer;if(void 0===e.begin)this._fullRequestReader?this._fullRequestReader._enqueue(t):this._queuedChunks.push(t);else{const n=this._rangeReaders.some((function(n){return n._begin===e.begin&&(n._enqueue(t),!0)}));(0,i.assert)(n,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){if(void 0===e.total){const t=this._rangeReaders[0];t?.onProgress&&t.onProgress({loaded:e.loaded})}else{const t=this._fullRequestReader;t?.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,i.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new s(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new o(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}};class s{constructor(e,t,n=!1,i=null){this._stream=e,this._done=n||!1,this._filename=(0,r.isPdfFile)(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,i.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class o{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,i.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class n{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};return function e(i){if(!i)return;let r=null;const s=i.name;if("#text"===s)r=i.value;else{if(!n.shouldBuildText(s))return;i?.attributes?.textContent?r=i.attributes.textContent:i.value&&(r=i.value)}if(null!==r&&t.push({str:r}),i.children)for(const t of i.children)e(t)}(e),i}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}t.XfaText=n},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var i=n(5);const r=function(e){return new Promise(((t,n)=>{__webpack_require__(172).readFile(e,((e,i)=>{!e&&i?t(new Uint8Array(i)):n(new Error(e))}))}))};class s extends i.BaseCanvasFactory{_createCanvas(e,t){return __webpack_require__(3414).createCanvas(e,t)}}t.NodeCanvasFactory=s;class o extends i.BaseCMapReaderFactory{_fetchData(e,t){return r(e).then((e=>({cMapData:e,compressionType:t})))}}t.NodeCMapReaderFactory=o;class a extends i.BaseStandardFontDataFactory{_fetchData(e){return r(e)}}t.NodeStandardFontDataFactory=a},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditorLayer=void 0;var i=n(1),r=n(9),s=n(4),o=n(23),a=n(24);class l{#ae=!1;#le=this.pointerup.bind(this);#ce=this.pointerdown.bind(this);#de=new Map;#he=!1;#ue=new WeakMap;#pe=new Map;#me;#ge=new Set;static _initialized=!1;constructor(e){l._initialized||(l._initialized=!0,o.FreeTextEditor.initialize(e.l10n),a.InkEditor.initialize(e.l10n),e.uiManager.registerEditorTypes([o.FreeTextEditor,a.InkEditor])),this.#me=e.uiManager,this.annotationStorage=e.annotationStorage,this.pageIndex=e.pageIndex,this.div=e.div,this.#me.addLayer(this)}get textLayerElements(){const e=this.div.parentNode.getElementsByClassName("textLayer").item(0);if(!e)return(0,i.shadow)(this,"textLayerElements",null);let t=this.#ue.get(e);return t||(t=e.querySelectorAll('span[role="presentation"]'),0===t.length?(0,i.shadow)(this,"textLayerElements",null):(t=Array.from(t),t.sort(l.#fe),this.#ue.set(e,t),t))}get#ve(){return!!this.div.parentNode.querySelector(".textLayer .endOfContent")}updateToolbar(e){this.#me.updateToolbar(e)}updateMode(e=this.#me.getMode()){this.#ye(),e===i.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),this.#me.unselectAll()}addInkEditorIfNeeded(e){if(e||this.#me.getMode()===i.AnnotationEditorType.INK){if(!e)for(const e of this.#de.values())if(e.isEmpty())return void e.setInBackground();this.#be({offsetX:0,offsetY:0}).setInBackground()}}setEditingState(e){this.#me.setEditingState(e)}addCommands(e){this.#me.addCommands(e)}enable(){this.div.style.pointerEvents="auto";for(const e of this.#de.values())e.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const e of this.#de.values())e.disableEditing()}setActiveEditor(e){this.#me.getActive()!==e&&this.#me.setActiveEditor(e)}enableClick(){this.div.addEventListener("pointerdown",this.#ce),this.div.addEventListener("pointerup",this.#le)}disableClick(){this.div.removeEventListener("pointerdown",this.#ce),this.div.removeEventListener("pointerup",this.#le)}attach(e){this.#de.set(e.id,e)}detach(e){this.#de.delete(e.id),this.removePointerInTextLayer(e)}remove(e){this.#me.removeEditor(e),this.detach(e),this.annotationStorage.removeKey(e.id),e.div.style.display="none",setTimeout((()=>{e.div.style.display="",e.div.remove(),e.isAttachedToDOM=!1,document.activeElement===document.body&&this.#me.focusMainContainer()}),0),this.#he||this.addInkEditorIfNeeded(!1)}#we(e){e.parent!==this&&(this.attach(e),e.pageIndex=this.pageIndex,e.parent?.detach(e),e.parent=this,e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}static#fe(e,t){const n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return n.y+n.height<=i.y?-1:i.y+i.height<=n.y?1:n.x+n.width/2-(i.x+i.width/2)}onTextLayerRendered(){this.#pe.clear();for(const e of this.#ge)e.isAttachedToDOM&&this.addPointerInTextLayer(e);this.#ge.clear()}removePointerInTextLayer(e){if(!this.#ve)return void this.#ge.delete(e);const{id:t}=e,n=this.#pe.get(t);if(!n)return;this.#pe.delete(t);let i=n.getAttribute("aria-owns");i?.includes(t)&&(i=i.split(" ").filter((e=>e!==t)).join(" "),i?n.setAttribute("aria-owns",i):(n.removeAttribute("aria-owns"),n.setAttribute("role","presentation")))}addPointerInTextLayer(e){if(!this.#ve)return void this.#ge.add(e);this.removePointerInTextLayer(e);const t=this.textLayerElements;if(!t)return;const{contentDiv:n}=e,i=e.getIdForTextLayer(),r=(0,s.binarySearchFirstItem)(t,(e=>l.#fe(n,e)<0)),o=t[Math.max(0,r-1)],a=o.getAttribute("aria-owns");a?.includes(i)||o.setAttribute("aria-owns",a?`${a} ${i}`:i),o.removeAttribute("role"),this.#pe.set(i,o)}moveDivInDOM(e){this.addPointerInTextLayer(e);const{div:t,contentDiv:n}=e;if(!this.div.hasChildNodes())return void this.div.append(t);const i=Array.from(this.div.childNodes).filter((e=>e!==t));if(0===i.length)return;const r=(0,s.binarySearchFirstItem)(i,(e=>l.#fe(n,e)<0));0===r?i[0].before(t):i[r-1].after(t)}add(e){if(this.#we(e),this.addToAnnotationStorage(e),this.#me.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}this.moveDivInDOM(e),e.onceAdded()}addToAnnotationStorage(e){e.isEmpty()||this.annotationStorage.has(e.id)||this.annotationStorage.setValue(e.id,e)}addOrRebuild(e){e.needsToBeRebuilt()?e.rebuild():this.add(e)}addANewEditor(e){this.addCommands({cmd:()=>{this.addOrRebuild(e)},undo:()=>{e.remove()},mustExec:!0})}addUndoableEditor(e){this.addCommands({cmd:()=>{this.addOrRebuild(e)},undo:()=>{e.remove()},mustExec:!1})}getNextId(){return this.#me.getId()}#Se(e){switch(this.#me.getMode()){case i.AnnotationEditorType.FREETEXT:return new o.FreeTextEditor(e);case i.AnnotationEditorType.INK:return new a.InkEditor(e)}return null}deserialize(e){switch(e.annotationType){case i.AnnotationEditorType.FREETEXT:return o.FreeTextEditor.deserialize(e,this);case i.AnnotationEditorType.INK:return a.InkEditor.deserialize(e,this)}return null}#be(e){const t=this.getNextId(),n=this.#Se({parent:this,id:t,x:e.offsetX,y:e.offsetY});return n&&this.add(n),n}setSelected(e){this.#me.setSelected(e)}toggleSelected(e){this.#me.toggleSelected(e)}isSelected(e){return this.#me.isSelected(e)}unselect(e){this.#me.unselect(e)}pointerup(e){const t=r.KeyboardManager.platform.isMac;0!==e.button||e.ctrlKey&&t||e.target===this.div&&(this.#ae?this.#be(e):this.#ae=!0)}pointerdown(e){const t=r.KeyboardManager.platform.isMac;if(0!==e.button||e.ctrlKey&&t)return;if(e.target!==this.div)return;const n=this.#me.getActive();this.#ae=!n||n.isEmpty()}drop(e){const t=e.dataTransfer.getData("text/plain"),n=this.#me.getEditor(t);if(!n)return;e.preventDefault(),e.dataTransfer.dropEffect="move",this.#we(n);const i=this.div.getBoundingClientRect(),r=e.clientX-i.x,s=e.clientY-i.y;n.translate(r-n.startX,s-n.startY),this.moveDivInDOM(n),n.div.focus()}dragover(e){e.preventDefault()}destroy(){this.#me.getActive()?.parent===this&&this.#me.setActiveEditor(null);for(const e of this.#de.values())this.removePointerInTextLayer(e),e.isAttachedToDOM=!1,e.div.remove(),e.parent=null;this.#pe.clear(),this.div=null,this.#de.clear(),this.#ge.clear(),this.#me.removeLayer(this)}#ye(){this.#he=!0;for(const e of this.#de.values())e.isEmpty()&&e.remove();this.#he=!1}render(e){this.viewport=e.viewport,(0,r.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(const e of this.#me.getEditors(this.pageIndex))this.add(e);this.updateMode()}update(e){this.viewport=e.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){const[e,t,n,i]=this.viewport.viewBox;return[n-e,i-t]}get viewportBaseDimensions(){const{width:e,height:t,rotation:n}=this.viewport;return n%180==0?[e,t]:[t,e]}setDimensions(){const{width:e,height:t,rotation:n}=this.viewport,i=n%180!=0,r=Math.floor(e)+"px",s=Math.floor(t)+"px";this.div.style.width=i?s:r,this.div.style.height=i?r:s,this.div.setAttribute("data-main-rotation",n)}}t.AnnotationEditorLayer=l},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FreeTextEditor=void 0;var i=n(1),r=n(9),s=n(8);class o extends s.AnnotationEditor{#_e=this.editorDivBlur.bind(this);#Ee=this.editorDivFocus.bind(this);#ke=this.editorDivKeydown.bind(this);#xe;#Te="";#Ce="";#Ae=!1;#Ie;static _freeTextDefaultContent="";static _l10nPromise;static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static _keyboardManager=new r.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],o.prototype.commitOrRemove]]);constructor(e){super({...e,name:"freeTextEditor"}),this.#xe=e.color||o._defaultColor||s.AnnotationEditor._defaultLineColor,this.#Ie=e.fontSize||o._defaultFontSize}static initialize(e){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map((t=>[t,e.get(t)])));const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case i.AnnotationEditorParamsType.FREETEXT_SIZE:o._defaultFontSize=t;break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:o._defaultColor=t}}updateParams(e,t){switch(e){case i.AnnotationEditorParamsType.FREETEXT_SIZE:this.#Re(t);break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:this.#Pe(t)}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,o._defaultFontSize],[i.AnnotationEditorParamsType.FREETEXT_COLOR,o._defaultColor||s.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,this.#Ie],[i.AnnotationEditorParamsType.FREETEXT_COLOR,this.#xe]]}#Re(e){const t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--scale-factor))`,this.translate(0,-(e-this.#Ie)*this.parent.scaleFactor),this.#Ie=e,this.#Oe()},n=this.#Ie;this.parent.addCommands({cmd:()=>{t(e)},undo:()=>{t(n)},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#Pe(e){const t=this.#xe;this.parent.addCommands({cmd:()=>{this.#xe=e,this.editorDiv.style.color=e},undo:()=>{this.#xe=t,this.editorDiv.style.color=t},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}getInitialTranslation(){return[-o._internalPadding*this.parent.scaleFactor,-(o._internalPadding+this.#Ie)*this.parent.scaleFactor]}rebuild(){super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(i.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",this.#ke),this.editorDiv.addEventListener("focus",this.#Ee),this.editorDiv.addEventListener("blur",this.#_e))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",this.#ke),this.editorDiv.removeEventListener("focus",this.#Ee),this.editorDiv.removeEventListener("blur",this.#_e),this.div.focus(),this.isEditing=!1)}focusin(e){super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}#Me(){const e=this.editorDiv.getElementsByTagName("div");if(0===e.length)return this.editorDiv.innerText;const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n].firstChild;"#text"===i?.nodeName?t.push(i.data):t.push("")}return t.join("\n")}#Oe(){const[e,t]=this.parent.viewportBaseDimensions,n=this.div.getBoundingClientRect();this.width=n.width/e,this.height=n.height/t}commit(){super.commit(),this.#Ae||(this.#Ae=!0,this.parent.addUndoableEditor(this)),this.disableEditMode(),this.#Ce=this.editorDiv.innerHTML,this.#Te=this.#Me().trimEnd(),this.#Oe()}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(e){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(e){o._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}getIdForTextLayer(){return this.editorDiv.id}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),o._l10nPromise.get("editor_free_text_aria_label").then((e=>this.editorDiv?.setAttribute("aria-label",e))),o._l10nPromise.get("free_text_default_content").then((e=>this.editorDiv?.setAttribute("default-content",e))),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#Ie}px * var(--scale-factor))`,n.color=this.#xe,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,r.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[n,i]=this.parent.viewportBaseDimensions;this.setAt(e*n,t*i,this.width*n,this.height*i),this.editorDiv.innerHTML=this.#Ce,this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(e,t){const n=super.deserialize(e,t);return n.#Ie=e.fontSize,n.#xe=i.Util.makeHexColor(...e.color),n.#Te=e.value,n.#Ce=e.value.split("\n").map((e=>`<div>${e}</div>`)).join(""),n}serialize(){if(this.isEmpty())return null;const e=o._internalPadding*this.parent.scaleFactor,t=this.getRect(e,e),n=s.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:i.AnnotationEditorType.FREETEXT,color:n,fontSize:this.#Ie,value:this.#Te,pageIndex:this.parent.pageIndex,rect:t,rotation:this.rotation}}}t.FreeTextEditor=o},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InkEditor=void 0,Object.defineProperty(t,"fitCurve",{enumerable:!0,get:function(){return s.fitCurve}});var i=n(1),r=n(8),s=n(25),o=n(9);class a extends r.AnnotationEditor{#De=0;#Le=0;#Fe=0;#Ne=this.canvasPointermove.bind(this);#je=this.canvasPointerleave.bind(this);#Be=this.canvasPointerup.bind(this);#Ue=this.canvasPointerdown.bind(this);#qe=!1;#ze=!1;#Ve=null;#Ke=null;#He=0;#We=0;#$e=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _l10nPromise;constructor(e){super({...e,name:"inkEditor"}),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(e){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map((t=>[t,e.get(t)])))}static updateDefaultParams(e,t){switch(e){case i.AnnotationEditorParamsType.INK_THICKNESS:a._defaultThickness=t;break;case i.AnnotationEditorParamsType.INK_COLOR:a._defaultColor=t;break;case i.AnnotationEditorParamsType.INK_OPACITY:a._defaultOpacity=t/100}}updateParams(e,t){switch(e){case i.AnnotationEditorParamsType.INK_THICKNESS:this.#Ge(t);break;case i.AnnotationEditorParamsType.INK_COLOR:this.#Pe(t);break;case i.AnnotationEditorParamsType.INK_OPACITY:this.#Ye(t)}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,a._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,a._defaultColor||r.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*a._defaultOpacity)]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||a._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,this.color||a._defaultColor||r.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??a._defaultOpacity))]]}#Ge(e){const t=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=e,this.#Xe()},undo:()=>{this.thickness=t,this.#Xe()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#Pe(e){const t=this.color;this.parent.addCommands({cmd:()=>{this.color=e,this.#Ze()},undo:()=>{this.color=t,this.#Ze()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#Ye(e){e/=100;const t=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=e,this.#Ze()},undo:()=>{this.opacity=t,this.#Ze()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){super.rebuild(),null!==this.div&&(this.canvas||(this.#Je(),this.#Qe()),this.isAttachedToDOM||(this.parent.add(this),this.#et()),this.#Xe())}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#Ke.disconnect(),this.#Ke=null,super.remove())}enableEditMode(){this.#qe||null===this.canvas||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",this.#Ue),this.canvas.addEventListener("pointerup",this.#Be))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#Ue),this.canvas.removeEventListener("pointerup",this.#Be))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}#tt(){const{width:e,height:t,rotation:n}=this.parent.viewport;switch(n){case 90:return[0,e,e,t];case 180:return[e,t,e,t];case 270:return[t,0,e,t];default:return[0,0,e,t]}}#nt(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,o.opacityToHex)(this.opacity)}`}#it(e,t){this.isEditing=!0,this.#ze||(this.#ze=!0,this.#et(),this.thickness||=a._defaultThickness,this.color||=a._defaultColor||r.AnnotationEditor._defaultLineColor,this.opacity??=a._defaultOpacity),this.currentPath.push([e,t]),this.#Ve=null,this.#nt(),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.#$e=()=>{this.#$e&&(this.#Ve&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):this.#Ze(),this.ctx.lineTo(...this.#Ve),this.#Ve=null,this.ctx.stroke()),window.requestAnimationFrame(this.#$e))},window.requestAnimationFrame(this.#$e)}#rt(e,t){const[n,i]=this.currentPath.at(-1);e===n&&t===i||(this.currentPath.push([e,t]),this.#Ve=[e,t])}#st(e,t){this.ctx.closePath(),this.#$e=null,e=Math.min(Math.max(e,0),this.canvas.width),t=Math.min(Math.max(t,0),this.canvas.height);const[n,i]=this.currentPath.at(-1);let r;if(e===n&&t===i||this.currentPath.push([e,t]),1!==this.currentPath.length)r=(0,s.fitCurve)(this.currentPath,30,null);else{const n=[e,t];r=[[n,n.slice(),n.slice(),n]]}const o=a.#ot(r);this.currentPath.length=0,this.parent.addCommands({cmd:()=>{this.paths.push(r),this.bezierPath2D.push(o),this.rebuild()},undo:()=>{this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#Je(),this.#Qe()),this.#Xe())},mustExec:!0})}#Ze(){if(this.isEmpty())return void this.#at();this.#nt();const{canvas:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),this.#at();for(const e of this.bezierPath2D)t.stroke(e)}commit(){this.#qe||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#qe=!0,this.div.classList.add("disabled"),this.#Xe(!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveDivInDOM(this),this.div.focus())}focusin(e){super.focusin(e),this.enableEditMode()}canvasPointerdown(e){0===e.button&&this.isInEditMode()&&!this.#qe&&(this.setInForeground(),"mouse"!==e.type&&this.div.focus(),e.stopPropagation(),this.canvas.addEventListener("pointerleave",this.#je),this.canvas.addEventListener("pointermove",this.#Ne),this.#it(e.offsetX,e.offsetY))}canvasPointermove(e){e.stopPropagation(),this.#rt(e.offsetX,e.offsetY)}canvasPointerup(e){0===e.button&&this.isInEditMode()&&0!==this.currentPath.length&&(e.stopPropagation(),this.#lt(e),this.setInBackground())}canvasPointerleave(e){this.#lt(e),this.setInBackground()}#lt(e){this.#st(e.offsetX,e.offsetY),this.canvas.removeEventListener("pointerleave",this.#je),this.canvas.removeEventListener("pointermove",this.#Ne),this.parent.addToAnnotationStorage(this)}#Je(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",a._l10nPromise.get("editor_ink_canvas_aria_label").then((e=>this.canvas?.setAttribute("aria-label",e))),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#Qe(){this.#Ke=new ResizeObserver((e=>{const t=e[0].contentRect;t.width&&t.height&&this.setDimensions(t.width,t.height)})),this.#Ke.observe(this.div)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),a._l10nPromise.get("editor_ink_aria_label").then((e=>this.div?.setAttribute("aria-label",e)));const[n,i,r,s]=this.#tt();if(this.setAt(n,i,0,0),this.setDims(r,s),this.#Je(),this.width){const[n,i]=this.parent.viewportBaseDimensions;this.setAt(e*n,t*i,this.width*n,this.height*i),this.#ze=!0,this.#et(),this.setDims(this.width*n,this.height*i),this.#Ze(),this.#ct(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#Qe(),this.div}#et(){if(!this.#ze)return;const[e,t]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*t),this.#at()}setDimensions(e,t){const n=Math.round(e),i=Math.round(t);if(this.#He===n&&this.#We===i)return;this.#He=n,this.#We=i,this.canvas.style.visibility="hidden",this.#De&&Math.abs(this.#De-e/t)>.01&&(t=Math.ceil(e/this.#De),this.setDims(e,t));const[r,s]=this.parent.viewportBaseDimensions;this.width=e/r,this.height=t/s,this.#qe&&this.#dt(e,t),this.#et(),this.#Ze(),this.canvas.style.visibility="visible"}#dt(e,t){const n=this.#ht(),i=(e-n)/this.#Fe,r=(t-n)/this.#Le;this.scaleFactor=Math.min(i,r)}#at(){const e=this.#ht()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)}static#ot(e){const t=new Path2D;for(let n=0,i=e.length;n<i;n++){const[i,r,s,o]=e[n];0===n&&t.moveTo(...i),t.bezierCurveTo(r[0],r[1],s[0],s[1],o[0],o[1])}return t}#ut(e,t,n,i){const r=[],s=this.thickness/2;let o,a;for(const l of this.paths){o=[],a=[];for(let r=0,c=l.length;r<c;r++){const[c,d,h,u]=l[r],p=e*(c[0]+t)+s,m=i-e*(c[1]+n)-s,g=e*(d[0]+t)+s,f=i-e*(d[1]+n)-s,v=e*(h[0]+t)+s,y=i-e*(h[1]+n)-s,b=e*(u[0]+t)+s,w=i-e*(u[1]+n)-s;0===r&&(o.push(p,m),a.push(p,m)),o.push(g,f,v,y,b,w),this.#pt(p,m,g,f,v,y,b,w,4,a)}r.push({bezier:o,points:a})}return r}#pt(e,t,n,i,r,s,o,a,l,c){if(this.#mt(e,t,n,i,r,s,o,a))c.push(o,a);else{for(let d=1;d<l-1;d++){const h=d/l,u=1-h;let p=h*e+u*n,m=h*t+u*i,g=h*n+u*r,f=h*i+u*s;p=h*p+u*g,m=h*m+u*f,g=h*g+u*(h*r+u*o),f=h*f+u*(h*s+u*a),p=h*p+u*g,m=h*m+u*f,c.push(p,m)}c.push(o,a)}}#mt(e,t,n,i,r,s,o,a){const l=(3*n-2*e-o)**2,c=(3*i-2*t-a)**2,d=(3*r-e-2*o)**2,h=(3*s-t-2*a)**2;return Math.max(l,d)+Math.max(c,h)<=10}#gt(){let e=1/0,t=-1/0,n=1/0,r=-1/0;for(const s of this.paths)for(const[o,a,l,c]of s){const s=i.Util.bezierBoundingBox(...o,...a,...l,...c);e=Math.min(e,s[0]),n=Math.min(n,s[1]),t=Math.max(t,s[2]),r=Math.max(r,s[3])}return[e,n,t,r]}#ht(){return this.#qe?Math.ceil(this.thickness*this.parent.scaleFactor):0}#Xe(e=!1){if(this.isEmpty())return;if(!this.#qe)return void this.#Ze();const t=this.#gt(),n=this.#ht();this.#Fe=Math.max(16,t[2]-t[0]),this.#Le=Math.max(16,t[3]-t[1]);const i=Math.ceil(n+this.#Fe*this.scaleFactor),r=Math.ceil(n+this.#Le*this.scaleFactor),[s,o]=this.parent.viewportBaseDimensions;this.width=i/s,this.height=r/o,this.#De=i/r,this.#ct();const a=this.translationX,l=this.translationY;this.translationX=-t[0],this.translationY=-t[1],this.#et(),this.#Ze(),this.#He=i,this.#We=r,this.setDims(i,r);const c=e?n/this.scaleFactor/2:0;this.translate(a-this.translationX-c,l-this.translationY-c)}#ct(){const{style:e}=this.div;this.#De>=1?(e.minHeight="16px",e.minWidth=`${Math.round(16*this.#De)}px`):(e.minWidth="16px",e.minHeight=`${Math.round(16/this.#De)}px`)}static deserialize(e,t){const n=super.deserialize(e,t);n.thickness=e.thickness,n.color=i.Util.makeHexColor(...e.color),n.opacity=e.opacity;const[r,s]=t.pageDimensions,o=n.width*r,a=n.height*s,l=t.scaleFactor,c=e.thickness/2;n.#De=o/a,n.#qe=!0,n.#He=Math.round(o),n.#We=Math.round(a);for(const{bezier:t}of e.paths){const e=[];n.paths.push(e);let i=l*(t[0]-c),r=l*(a-t[1]-c);for(let n=2,s=t.length;n<s;n+=6){const s=l*(t[n]-c),o=l*(a-t[n+1]-c),d=l*(t[n+2]-c),h=l*(a-t[n+3]-c),u=l*(t[n+4]-c),p=l*(a-t[n+5]-c);e.push([[i,r],[s,o],[d,h],[u,p]]),i=u,r=p}const s=this.#ot(e);n.bezierPath2D.push(s)}const d=n.#gt();return n.#Fe=d[2]-d[0],n.#Le=d[3]-d[1],n.#dt(o,a),n}serialize(){if(this.isEmpty())return null;const e=this.getRect(0,0),t=this.rotation%180==0?e[3]-e[1]:e[2]-e[0],n=r.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:i.AnnotationEditorType.INK,color:n,thickness:this.thickness,opacity:this.opacity,paths:this.#ut(this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,t),pageIndex:this.parent.pageIndex,rect:e,rotation:this.rotation}}}t.InkEditor=a},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fitCurve=void 0;const i=n(26);t.fitCurve=i},e=>{function t(e,r,s,o,a){var c,d,h,u,p,m,g,f,v,y,b,w,S;if(2===e.length)return w=l.vectorLen(l.subtract(e[0],e[1]))/3,[c=[e[0],l.addArrays(e[0],l.mulItems(r,w)),l.addArrays(e[1],l.mulItems(s,w)),e[1]]];if(d=function(e){var t,n,i,r=[];return e.forEach(((e,s)=>{t=s?n+l.vectorLen(l.subtract(e,i)):0,r.push(t),n=t,i=e})),r=r.map((e=>e/n))}(e),[c,u,m]=n(e,d,d,r,s,a),0===u||u<o)return[c];if(u<o*o)for(h=d,p=u,g=m,S=0;S<20;S++){if(h=i(c,e,h),[c,u,m]=n(e,d,h,r,s,a),u<o)return[c];if(m===g){let e=u/p;if(e>.9999&&e<1.0001)break}p=u,g=m}return b=[],(f=l.subtract(e[m-1],e[m+1])).every((e=>0===e))&&(f=l.subtract(e[m-1],e[m]),[f[0],f[1]]=[-f[1],f[0]]),v=l.normalize(f),y=l.mulItems(v,-1),(b=b.concat(t(e.slice(0,m+1),r,v,o,a))).concat(t(e.slice(m),y,s,o,a))}function n(e,t,n,i,r,a){var d,h,u;return d=function(e,t,n,i){var r,s,o,a,d,h,u,p,m,g,f,v,y,b,w,S,_,E=e[0],k=e[e.length-1];for(r=[E,null,null,k],s=l.zeros_Xx2x2(t.length),y=0,b=t.length;y<b;y++)_=1-(S=t[y]),(o=s[y])[0]=l.mulItems(n,3*S*(_*_)),o[1]=l.mulItems(i,3*_*(S*S));for(a=[[0,0],[0,0]],d=[0,0],y=0,b=e.length;y<b;y++)S=t[y],o=s[y],a[0][0]+=l.dot(o[0],o[0]),a[0][1]+=l.dot(o[0],o[1]),a[1][0]+=l.dot(o[0],o[1]),a[1][1]+=l.dot(o[1],o[1]),w=l.subtract(e[y],c.q([E,E,k,k],S)),d[0]+=l.dot(o[0],w),d[1]+=l.dot(o[1],w);return h=a[0][0]*a[1][1]-a[1][0]*a[0][1],u=a[0][0]*d[1]-a[1][0]*d[0],p=d[0]*a[1][1]-d[1]*a[0][1],g=0===h?0:u/h,(m=0===h?0:p/h)<(f=1e-6*(v=l.vectorLen(l.subtract(E,k))))||g<f?(r[1]=l.addArrays(E,l.mulItems(n,v/3)),r[2]=l.addArrays(k,l.mulItems(i,v/3))):(r[1]=l.addArrays(E,l.mulItems(n,m)),r[2]=l.addArrays(k,l.mulItems(i,g))),r}(e,n,i,r),[h,u]=function(e,t,n){var i,r,a,d,h,u,p,m;r=0,a=Math.floor(e.length/2);const g=s(t,10);for(h=0,u=e.length;h<u;h++)p=e[h],m=o(0,n[h],g,10),(i=(d=l.subtract(c.q(t,m),p))[0]*d[0]+d[1]*d[1])>r&&(r=i,a=h);return[r,a]}(e,d,t),a&&a({bez:d,points:e,params:t,maxErr:h,maxPoint:u}),[d,h,u]}function i(e,t,n){return n.map(((n,i)=>r(e,t[i],n)))}function r(e,t,n){var i=l.subtract(c.q(e,n),t),r=c.qprime(e,n),s=l.mulMatrix(i,r),o=l.sum(l.squareItems(r))+2*l.mulMatrix(i,c.qprimeprime(e,n));return 0===o?n:n-s/o}var s=function(e,t){for(var n,i=[0],r=e[0],s=0,o=1;o<=t;o++)n=c.q(e,o/t),s+=l.vectorLen(l.subtract(n,r)),i.push(s),r=n;return i.map((e=>e/s))};function o(e,t,n,i){if(t<0)return 0;if(t>1)return 1;for(var r,s,o,a,l=1;l<=i;l++)if(t<=n[l]){o=(l-1)/i,s=l/i,a=(t-(r=n[l-1]))/(n[l]-r)*(s-o)+o;break}return a}function a(e,t){return l.normalize(l.subtract(e,t))}class l{static zeros_Xx2x2(e){for(var t=[];e--;)t.push([0,0]);return t}static mulItems(e,t){return e.map((e=>e*t))}static mulMatrix(e,t){return e.reduce(((e,n,i)=>e+n*t[i]),0)}static subtract(e,t){return e.map(((e,n)=>e-t[n]))}static addArrays(e,t){return e.map(((e,n)=>e+t[n]))}static addItems(e,t){return e.map((e=>e+t))}static sum(e){return e.reduce(((e,t)=>e+t))}static dot(e,t){return l.mulMatrix(e,t)}static vectorLen(e){return Math.hypot(...e)}static divItems(e,t){return e.map((e=>e/t))}static squareItems(e){return e.map((e=>e*e))}static normalize(e){return this.divItems(e,this.vectorLen(e))}}class c{static q(e,t){var n=1-t,i=l.mulItems(e[0],n*n*n),r=l.mulItems(e[1],3*n*n*t),s=l.mulItems(e[2],3*n*t*t),o=l.mulItems(e[3],t*t*t);return l.addArrays(l.addArrays(i,r),l.addArrays(s,o))}static qprime(e,t){var n=1-t,i=l.mulItems(l.subtract(e[1],e[0]),3*n*n),r=l.mulItems(l.subtract(e[2],e[1]),6*n*t),s=l.mulItems(l.subtract(e[3],e[2]),3*t*t);return l.addArrays(l.addArrays(i,r),s)}static qprimeprime(e,t){return l.addArrays(l.mulItems(l.addArrays(l.subtract(e[2],l.mulItems(e[1],2)),e[0]),6*(1-t)),l.mulItems(l.addArrays(l.subtract(e[3],l.mulItems(e[2],2)),e[1]),6*t))}}e.exports=function(e,n,i){if(!Array.isArray(e))throw new TypeError("First argument should be an array");if(e.forEach((t=>{if(!Array.isArray(t)||t.some((e=>"number"!=typeof e))||t.length!==e[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")})),(e=e.filter(((t,n)=>0===n||!t.every(((t,i)=>t===e[n-1][i]))))).length<2)return[];const r=e.length,s=a(e[1],e[0]),o=a(e[r-2],e[r-1]);return t(e,s,o,n,i)},e.exports.fitCubic=t,e.exports.createTangent=a},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationLayer=void 0;var i=n(1),r=n(4),s=n(7),o=n(28),a=n(29);const l=1e3,c=new WeakSet;function d(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class h{static create(e){switch(e.data.annotationType){case i.AnnotationType.LINK:return new p(e);case i.AnnotationType.TEXT:return new m(e);case i.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new f(e);case"Btn":return e.data.radioButton?new y(e):e.data.checkBox?new v(e):new b(e);case"Ch":return new w(e)}return new g(e);case i.AnnotationType.POPUP:return new S(e);case i.AnnotationType.FREETEXT:return new E(e);case i.AnnotationType.LINE:return new k(e);case i.AnnotationType.SQUARE:return new x(e);case i.AnnotationType.CIRCLE:return new T(e);case i.AnnotationType.POLYLINE:return new C(e);case i.AnnotationType.CARET:return new I(e);case i.AnnotationType.INK:return new R(e);case i.AnnotationType.POLYGON:return new A(e);case i.AnnotationType.HIGHLIGHT:return new P(e);case i.AnnotationType.UNDERLINE:return new O(e);case i.AnnotationType.SQUIGGLY:return new M(e);case i.AnnotationType.STRIKEOUT:return new D(e);case i.AnnotationType.STAMP:return new L(e);case i.AnnotationType.FILEATTACHMENT:return new F(e);default:return new u(e)}}}class u{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this._mouseState=e.mouseState,t&&(this.container=this._createContainer(n)),i&&(this.quadrilaterals=this._createQuadrilaterals(n))}_createContainer(e=!1){const t=this.data,n=this.page,r=this.viewport,s=document.createElement("section"),{width:o,height:a}=d(t.rect),[l,c,h,u]=r.viewBox,p=h-l,m=u-c;s.setAttribute("data-annotation-id",t.id);const g=i.Util.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]);if(!e&&t.borderStyle.width>0){s.style.borderWidth=`${t.borderStyle.width}px`;const e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;if(e>0||n>0){const t=`calc(${e}px * var(--scale-factor)) / calc(${n}px * var(--scale-factor))`;s.style.borderRadius=t}switch(t.borderStyle.style){case i.AnnotationBorderStyleType.SOLID:s.style.borderStyle="solid";break;case i.AnnotationBorderStyleType.DASHED:s.style.borderStyle="dashed";break;case i.AnnotationBorderStyleType.BEVELED:(0,i.warn)("Unimplemented border style: beveled");break;case i.AnnotationBorderStyleType.INSET:(0,i.warn)("Unimplemented border style: inset");break;case i.AnnotationBorderStyleType.UNDERLINE:s.style.borderBottomStyle="solid"}const r=t.borderColor||null;r?s.style.borderColor=i.Util.makeHexColor(0|r[0],0|r[1],0|r[2]):s.style.borderWidth=0}s.style.left=100*(g[0]-l)/p+"%",s.style.top=100*(g[1]-c)/m+"%";const{rotation:f}=t;return t.hasOwnCanvas||0===f?(s.style.width=100*o/p+"%",s.style.height=100*a/m+"%"):this.setRotation(f,s),s}setRotation(e,t=this.container){const[n,i,r,s]=this.viewport.viewBox,o=r-n,a=s-i,{width:l,height:c}=d(this.data.rect);let h,u;e%180==0?(h=100*l/o,u=100*c/a):(h=100*c/o,u=100*l/a),t.style.width=`${h}%`,t.style.height=`${u}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(e,t,n)=>{const i=n.detail[e];n.target.style[t]=o.ColorConverters[`${i[0]}_HTML`](i.slice(1))};return(0,i.shadow)(this,"_commonActions",{display:e=>{const t=e.detail.display%2==1;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:t,print:0===e.detail.display||3===e.detail.display})},print:e=>{this.annotationStorage.setValue(this.data.id,{print:e.detail.print})},hidden:e=>{this.container.style.visibility=e.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:e.detail.hidden})},focus:e=>{setTimeout((()=>e.target.focus({preventScroll:!1})),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.detail.readonly?e.target.setAttribute("readonly",""):e.target.removeAttribute("readonly")},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{const t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||n[i];r&&r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[i,r]of Object.entries(t)){const s=n[i];s&&(s({detail:r,target:e}),delete t[i])}}_createQuadrilaterals(e=!1){if(!this.data.quadPoints)return null;const t=[],n=this.data.rect;for(const n of this.data.quadPoints)this.data.rect=[n[2].x,n[2].y,n[1].x,n[1].y],t.push(this._createContainer(e));return this.data.rect=n,t}_createPopup(e,t){let n=this.container;this.quadrilaterals&&(e=e||this.quadrilaterals,n=this.quadrilaterals[0]),e||((e=document.createElement("div")).className="popupTriggerArea",n.append(e));const i=new _({container:n,trigger:e,color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,hideWrapper:!0}).render();i.style.left="100%",n.append(i)}_renderQuadrilaterals(e){for(const t of this.quadrilaterals)t.className=e;return this.quadrilaterals}render(){(0,i.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:e,id:s,exportValues:o}of r){if(-1===e)continue;if(s===t)continue;const r="string"==typeof o?o:null,a=document.querySelector(`[data-element-id="${s}"]`);!a||c.has(a)?n.push({id:s,exportValue:r,domElement:a}):(0,i.warn)(`_getElementsByName - element not allowed: ${s}`)}return n}for(const i of document.getElementsByName(e)){const{id:e,exportValue:r}=i;e!==t&&c.has(i)&&n.push({id:e,exportValue:r,domElement:i})}return n}static get platform(){const e="undefined"!=typeof navigator?navigator.platform:"";return(0,i.shadow)(this,"platform",{isWin:e.includes("Win"),isMac:e.includes("Mac")})}}class p extends u{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(n,e.action),i=!0):e.dest?(this._bindLink(n,e.dest),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),i=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map(((e,t)=>{const i=0===t?n:n.cloneNode();return e.append(i),e})):(this.container.className="linkAnnotation",i&&this.container.append(n),this.container)}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&(e.className="internalLink")}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),e.className="internalLink"}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(t.actions)){const r=n.get(i);r&&(e[r]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1))}e.onclick||(e.onclick=()=>!1),e.className="internalLink"}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),e.className="internalLink",!this._fieldObjects)return(0,i.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(e.onclick=()=>!1));e.onclick=()=>{n&&n();const{fields:e,refs:r,include:s}=t,o=[];if(0!==e.length||0!==r.length){const t=new Set(r);for(const n of e){const e=this._fieldObjects[n]||[];for(const{id:n}of e)t.add(n)}for(const e of Object.values(this._fieldObjects))for(const n of e)t.has(n.id)===s&&o.push(n)}else for(const e of Object.values(this._fieldObjects))o.push(...e);const a=this.annotationStorage,l=[];for(const e of o){const{id:t}=e;switch(l.push(t),e.type){case"text":{const n=e.defaultValue||"";a.setValue(t,{value:n});break}case"checkbox":case"radiobutton":{const n=e.defaultValue===e.exportValues;a.setValue(t,{value:n});break}case"combobox":case"listbox":{const n=e.defaultValue||"";a.setValue(t,{value:n});break}default:continue}const n=document.querySelector(`[data-element-id="${t}"]`);n&&(c.has(n)?n.dispatchEvent(new Event("resetform")):(0,i.warn)(`_bindResetFormAction - element not allowed: ${t}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}}class m extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str)})}render(){this.container.className="textAnnotation";const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(e,this.data),this.container.append(e),this.container}}class g extends u{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(e){const{isWin:t,isMac:n}=u.platform;return t&&e.ctrlKey||n&&e.metaKey}_setEventListener(e,t,n,i){t.includes("mouse")?e.addEventListener(t,(e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:i(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})})):e.addEventListener(t,(e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:i(e)}})}))}_setEventListeners(e,t,n){for(const[i,r]of t)("Action"===r||this.data.actions?.[r])&&this._setEventListener(e,i,r,n)}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":i.Util.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const{fontColor:t}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||9,r=e.style;let s;if(this.data.multiLine){const e=Math.abs(this.data.rect[3]-this.data.rect[1]),t=e/(Math.round(e/(i.LINE_FACTOR*n))||1);s=Math.min(n,Math.round(t/i.LINE_FACTOR))}else{const e=Math.abs(this.data.rect[3]-this.data.rect[1]);s=Math.min(n,Math.round(e/i.LINE_FACTOR))}r.fontSize=`calc(${s}px * var(--scale-factor))`,r.color=i.Util.makeHexColor(t[0],t[1],t[2]),null!==this.data.textAlignment&&(r.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class f extends g{constructor(e){super(e,{isRenderable:e.renderForms||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,n,i){const r=this.annotationStorage;for(const s of this._getElementsByName(e.name,e.id))s.domElement&&(s.domElement[t]=n),r.setValue(s.id,{[i]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.className="textWidgetAnnotation";let n=null;if(this.renderForms){const i=e.getValue(t,{value:this.data.fieldValue}),r=i.formattedValue||i.value||"",s={userValue:r,formattedValue:null,valueOnFocus:""};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=r,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",r),this.data.doNotScroll&&(n.style.overflowX="hidden")),c.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=l,this._setRequired(n,this.data.required),n.addEventListener("input",(i=>{e.setValue(t,{value:i.target.value}),this.setPropertyOnSiblings(n,"value",i.target.value,"value")})),n.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue??"";n.value=s.userValue=t,s.formattedValue=null}));let o=e=>{const{formattedValue:t}=s;null!=t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",(e=>{s.userValue&&(e.target.value=s.userValue),s.valueOnFocus=e.target.value})),n.addEventListener("updatefromsandbox",(n=>{const i={value(n){s.userValue=n.detail.value??"",e.setValue(t,{value:s.userValue.toString()}),n.target.value=s.userValue},formattedValue(n){const{formattedValue:i}=n.detail;s.formattedValue=i,null!=i&&n.target!==document.activeElement&&(n.target.value=i),e.setValue(t,{formattedValue:i})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)}};this._dispatchEventFromSandbox(i,n)})),n.addEventListener("keydown",(e=>{let n=-1;if("Escape"===e.key?n=0:"Enter"===e.key?n=2:"Tab"===e.key&&(n=3),-1===n)return;const{value:i}=e.target;s.valueOnFocus!==i&&(s.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}));const i=o;o=null,n.addEventListener("blur",(e=>{const{value:n}=e.target;s.userValue=n,this._mouseState.isDown&&s.valueOnFocus!==n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:n,willCommit:!0,commitKey:1,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),i(e)})),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",(e=>{const{data:n,target:i}=e,{value:r,selectionStart:s,selectionEnd:o}=i;let a=s,l=o;switch(e.inputType){case"deleteWordBackward":{const e=r.substring(0,s).match(/\w*[^\w]*$/);e&&(a-=e[0].length);break}case"deleteWordForward":{const e=r.substring(s).match(/^[^\w]*\w*/);e&&(l+=e[0].length);break}case"deleteContentBackward":s===o&&(a-=1);break;case"deleteContentForward":s===o&&(l+=1)}e.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:r,change:n||"",willCommit:!1,selStart:a,selEnd:l}})})),this._setEventListeners(n,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.value))}if(o&&n.addEventListener("blur",o),null!==this.data.maxLen&&(n.maxLength=this.data.maxLen),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/this.data.maxLen;n.classList.add("comb"),n.style.letterSpacing=`calc(${e}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell";return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class v extends g{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;"string"==typeof i&&(i="Off"!==i,e.setValue(n,{value:i})),this.container.className="buttonWidgetAnnotation checkBox";const r=document.createElement("input");return c.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=l,r.addEventListener("change",(i=>{const{name:r,checked:s}=i.target;for(const i of this._getElementsByName(r,n)){const n=s&&i.exportValue===t.exportValue;i.domElement&&(i.domElement.checked=n),e.setValue(i.id,{value:n})}e.setValue(n,{value:s})})),r.addEventListener("resetform",(e=>{const n=t.defaultFieldValue||"Off";e.target.checked=n===t.exportValue})),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",(t=>{const i={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(n,{value:t.target.checked})}};this._dispatchEventFromSandbox(i,t)})),this._setEventListeners(r,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class y extends g{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;"string"==typeof i&&(i=i!==t.buttonValue,e.setValue(n,{value:i}));const r=document.createElement("input");if(c.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=l,r.addEventListener("change",(t=>{const{name:i,checked:r}=t.target;for(const t of this._getElementsByName(i,n))e.setValue(t.id,{value:!1});e.setValue(n,{value:r})})),r.addEventListener("resetform",(e=>{const n=t.defaultFieldValue;e.target.checked=null!=n&&n===t.buttonValue})),this.enableScripting&&this.hasJSActions){const i=t.buttonValue;r.addEventListener("updatefromsandbox",(t=>{const r={value:t=>{const r=i===t.detail.value;for(const i of this._getElementsByName(t.target.name)){const t=r&&i.id===n;i.domElement&&(i.domElement.checked=t),e.setValue(i.id,{value:t})}}};this._dispatchEventFromSandbox(r,t)})),this._setEventListeners(r,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class b extends p{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(e.title=this.data.alternativeText);const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({},e)}))),e}}class w extends g{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.className="choiceWidgetAnnotation";const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");c.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=l;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue;for(const e of i.options)e.selected=e.value===t}));for(const e of this.data.options){const t=document.createElement("option");t.textContent=e.displayValue,t.value=e.exportValue,n.value.includes(e.exportValue)&&(t.setAttribute("selected",!0),r=!1),i.append(t)}let s=null;if(r){const e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),i.prepend(e),s=()=>{e.remove(),i.removeEventListener("input",s),s=null},i.addEventListener("input",s)}const o=(e,t)=>{const n=t?"value":"textContent",i=e.target.options;return e.target.multiple?Array.prototype.filter.call(i,(e=>e.selected)).map((e=>e[n])):-1===i.selectedIndex?null:i[i.selectedIndex][n]},a=e=>{const t=e.target.options;return Array.prototype.map.call(t,(e=>({displayValue:e.textContent,exportValue:e.value})))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",(n=>{const r={value(n){s?.();const r=n.detail.value,a=new Set(Array.isArray(r)?r:[r]);for(const e of i.options)e.selected=a.has(e.value);e.setValue(t,{value:o(n,!0)})},multipleSelection(e){i.multiple=!0},remove(n){const r=i.options,s=n.detail.remove;r[s].selected=!1,i.remove(s),r.length>0&&-1===Array.prototype.findIndex.call(r,(e=>e.selected))&&(r[0].selected=!0),e.setValue(t,{value:o(n,!0),items:a(n)})},clear(n){for(;0!==i.length;)i.remove(0);e.setValue(t,{value:null,items:[]})},insert(n){const{index:r,displayValue:s,exportValue:l}=n.detail.insert,c=i.children[r],d=document.createElement("option");d.textContent=s,d.value=l,c?c.before(d):i.append(d),e.setValue(t,{value:o(n,!0),items:a(n)})},items(n){const{items:r}=n.detail;for(;0!==i.length;)i.remove(0);for(const e of r){const{displayValue:t,exportValue:n}=e,r=document.createElement("option");r.textContent=t,r.value=n,i.append(r)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(n,!0),items:a(n)})},indices(n){const i=new Set(n.detail.indices);for(const e of n.target.options)e.selected=i.has(e.index);e.setValue(t,{value:o(n,!0)})},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(r,n)})),i.addEventListener("input",(n=>{const i=o(n,!0),r=o(n,!1);e.setValue(t,{value:i}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:r,changeEx:i,willCommit:!0,commitKey:1,keyDown:!1}})})),this._setEventListeners(i,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],(e=>e.target.checked))):i.addEventListener("input",(function(n){e.setValue(t,{value:o(n,!0)})})),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class S extends u{constructor(e){super(e,{isRenderable:!!(e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str)})}render(){if(this.container.className="popupAnnotation",["Line","Square","Circle","PolyLine","Polygon","Ink"].includes(this.data.parentType))return this.container;const e=`[data-annotation-id="${this.data.parentId}"]`,t=this.layer.querySelectorAll(e);if(0===t.length)return this.container;const n=new _({container:this.container,trigger:Array.from(t),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),r=this.page,s=i.Util.normalizeRect([this.data.parentRect[0],r.view[3]-this.data.parentRect[1]+r.view[1],this.data.parentRect[2],r.view[3]-this.data.parentRect[3]+r.view[1]]),o=s[0]+this.data.parentRect[2]-this.data.parentRect[0],a=s[1],[l,c,d,h]=this.viewport.viewBox,u=d-l,p=h-c;return this.container.style.left=100*(o-l)/u+"%",this.container.style.top=100*(a-c)/p+"%",this.container.append(n.render()),this.container}}class _{constructor(e){this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.titleObj=e.titleObj,this.modificationDate=e.modificationDate,this.contentsObj=e.contentsObj,this.richText=e.richText,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}render(){const e=document.createElement("div");e.className="popupWrapper",this.hideElement=this.hideWrapper?e:this.container,this.hideElement.hidden=!0;const t=document.createElement("div");t.className="popup";const n=this.color;if(n){const e=.7*(255-n[0])+n[0],r=.7*(255-n[1])+n[1],s=.7*(255-n[2])+n[2];t.style.backgroundColor=i.Util.makeHexColor(0|e,0|r,0|s)}const s=document.createElement("h1");s.dir=this.titleObj.dir,s.textContent=this.titleObj.str,t.append(s);const o=r.PDFDateString.toDateObject(this.modificationDate);if(o){const e=document.createElement("span");e.className="popupDate",e.textContent="{{date}}, {{time}}",e.dataset.l10nId="annotation_date_string",e.dataset.l10nArgs=JSON.stringify({date:o.toLocaleDateString(),time:o.toLocaleTimeString()}),t.append(e)}if(!this.richText?.str||this.contentsObj?.str&&this.contentsObj.str!==this.richText.str){const e=this._formatContents(this.contentsObj);t.append(e)}else a.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:t}),t.lastChild.className="richText popupContent";Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const e of this.trigger)e.addEventListener("click",this._toggle.bind(this)),e.addEventListener("mouseover",this._show.bind(this,!1)),e.addEventListener("mouseout",this._hide.bind(this,!1));return t.addEventListener("click",this._hide.bind(this,!0)),e.append(t),e}_formatContents({str:e,dir:t}){const n=document.createElement("p");n.className="popupContent",n.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let e=0,t=i.length;e<t;++e){const r=i[e];n.append(document.createTextNode(r)),e<t-1&&n.append(document.createElement("br"))}return n}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(e=!1){e&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex+=1)}_hide(e=!0){e&&(this.pinned=!1),this.hideElement.hidden||this.pinned||(this.hideElement.hidden=!0,this.container.style.zIndex-=1)}}class E extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){return this.container.className="freeTextAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class k extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const e=this.data,{width:t,height:n}=d(e.rect),i=this.svgFactory.create(t,n,!0),r=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),this._createPopup(r,e),this.container}}class x extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const e=this.data,{width:t,height:n}=d(e.rect),i=this.svgFactory.create(t,n,!0),r=e.borderStyle.width,s=this.svgFactory.createElement("svg:rect");return s.setAttribute("x",r/2),s.setAttribute("y",r/2),s.setAttribute("width",t-r),s.setAttribute("height",n-r),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),this._createPopup(s,e),this.container}}class T extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const e=this.data,{width:t,height:n}=d(e.rect),i=this.svgFactory.create(t,n,!0),r=e.borderStyle.width,s=this.svgFactory.createElement("svg:ellipse");return s.setAttribute("cx",t/2),s.setAttribute("cy",n/2),s.setAttribute("rx",t/2-r/2),s.setAttribute("ry",n/2-r/2),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),this._createPopup(s,e),this.container}}class C extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,{width:t,height:n}=d(e.rect),i=this.svgFactory.create(t,n,!0);let r=[];for(const t of e.vertices){const n=t.x-e.rect[0],i=e.rect[3]-t.y;r.push(n+","+i)}r=r.join(" ");const s=this.svgFactory.createElement(this.svgElementName);return s.setAttribute("points",r),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),this._createPopup(s,e),this.container}}class A extends C{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class I extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class R extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,{width:t,height:n}=d(e.rect),i=this.svgFactory.create(t,n,!0);for(const t of e.inkLists){let n=[];for(const i of t){const t=i.x-e.rect[0],r=e.rect[3]-i.y;n.push(`${t},${r}`)}n=n.join(" ");const r=this.svgFactory.createElement(this.svgElementName);r.setAttribute("points",n),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),this._createPopup(r,e),i.append(r)}return this.container.append(i),this.container}}class P extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class O extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class M extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class D extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class L extends u{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class F extends u{constructor(e){super(e,{isRenderable:!0});const{filename:t,content:n}=this.data.file;this.filename=(0,r.getFilenameFromUrl)(t),this.content=n,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:t,content:n})}render(){this.container.className="fileAttachmentAnnotation";const e=document.createElement("div");return e.className="popupTriggerArea",e.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(e,this.data),this.container.append(e),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}t.AnnotationLayer=class{static render(e){const{annotations:t,div:n,viewport:o}=e;this.#ft(n,o);const a=[],l=[];for(const e of t){if(!e)continue;if(e.annotationType===i.AnnotationType.POPUP){l.push(e);continue}const{width:t,height:n}=d(e.rect);t<=0||n<=0||a.push(e)}l.length&&a.push(...l);for(const t of a){const i=h.create({data:t,layer:n,page:e.page,viewport:o,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new r.DOMSVGFactory,annotationStorage:e.annotationStorage||new s.AnnotationStorage,enableScripting:e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,mouseState:e.mouseState||{isDown:!1}});if(i.isRenderable){const e=i.render();if(t.hidden&&(e.style.visibility="hidden"),Array.isArray(e))for(const t of e)n.append(t);else i instanceof S?n.prepend(e):n.append(e)}}this.#vt(n,e.annotationCanvasMap)}static update(e){const{annotationCanvasMap:t,div:n,viewport:i}=e;this.#ft(n,i),this.#vt(n,t),n.hidden=!1}static#ft(e,{width:t,height:n,rotation:i}){const{style:r}=e,s=i%180!=0,o=Math.floor(t)+"px",a=Math.floor(n)+"px";r.width=s?a:o,r.height=s?o:a,e.setAttribute("data-main-rotation",i)}static#vt(e,t){if(t){for(const[n,i]of t){const t=e.querySelector(`[data-annotation-id="${n}"]`);if(!t)continue;const{firstChild:r}=t;r?"CANVAS"===r.nodeName?r.replaceWith(i):r.before(i):t.append(i)}t.clear()}}}},(e,t)=>{function n(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0,t.ColorConverters=class{static CMYK_G([e,t,n,i]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_HTML([e]){const t=n(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_HTML([e,t,i]){return`#${n(e)}${n(t)}${n(i)}`}static T_HTML(){return"#00000000"}static CMYK_RGB([e,t,n,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,n+i),1-Math.min(1,t+i)]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const i=1-e,r=1-t,s=1-n;return["CMYK",i,r,s,Math.min(i,r,s)]}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var i=n(20);t.XfaLayer=class{static setupStorage(e,t,n,i,r){const s=i.getValue(t,{value:null});switch(n.name){case"textarea":if(null!==s.value&&(e.textContent=s.value),"print"===r)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(s.value===n.attributes.xfaOn?e.setAttribute("checked",!0):s.value===n.attributes.xfaOff&&e.removeAttribute("checked"),"print"===r)break;e.addEventListener("change",(e=>{i.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==s.value&&e.setAttribute("value",s.value),"print"===r)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==s.value)for(const e of n.children)e.attributes.value===s.value&&(e.attributes.selected=!0);e.addEventListener("input",(e=>{const n=e.target.options,r=-1===n.selectedIndex?"":n[n.selectedIndex].value;i.setValue(t,{value:r})}))}}static setAttributes({html:e,element:t,storage:n=null,intent:i,linkService:r}){const{attributes:s}=t,o=e instanceof HTMLAnchorElement;"radio"===s.type&&(s.name=`${s.name}-${i}`);for(const[t,n]of Object.entries(s))if(null!=n)switch(t){case"class":n.length&&e.setAttribute(t,n.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",n);break;case"style":Object.assign(e.style,n);break;case"textContent":e.textContent=n;break;default:(!o||"href"!==t&&"newWindow"!==t)&&e.setAttribute(t,n)}o&&r.addLinkAttributes(e,s.href,s.newWindow),n&&s.dataId&&this.setupStorage(e,s.dataId,t,n)}static render(e){const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,s=e.intent||"display",o=document.createElement(r.name);r.attributes&&this.setAttributes({html:o,element:r,intent:s,linkService:n});const a=[[r,-1,o]],l=e.div;if(l.append(o),e.viewport){const t=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=t}"richText"!==s&&l.setAttribute("class","xfaLayer xfaFont");const c=[];for(;a.length>0;){const[e,r,o]=a.at(-1);if(r+1===e.children.length){a.pop();continue}const l=e.children[++a.at(-1)[1]];if(null===l)continue;const{name:d}=l;if("#text"===d){const e=document.createTextNode(l.value);c.push(e),o.append(e);continue}let h;if(h=l?.attributes?.xmlns?document.createElementNS(l.attributes.xmlns,d):document.createElement(d),o.append(h),l.attributes&&this.setAttributes({html:h,element:l,storage:t,intent:s,linkService:n}),l.children&&l.children.length>0)a.push([l,-1,h]);else if(l.value){const e=document.createTextNode(l.value);i.XfaText.shouldBuildText(d)&&c.push(e),h.append(e)}}for(const e of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))e.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayerRenderTask=void 0,t.renderTextLayer=function(e){const t=new u({textContent:e.textContent,textContentStream:e.textContentStream,container:e.container,viewport:e.viewport,textDivs:e.textDivs,textContentItemsStr:e.textContentItemsStr,enhanceTextSelection:e.enhanceTextSelection});return t._render(e.timeout),t};var i=n(1),r=n(4);const s=30,o=new Map,a=/^\s+$/g;function l(e,t,n,r){const l=document.createElement("span"),c=e._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};e._textDivs.push(l);const d=i.Util.transform(e._viewport.transform,t.transform);let h=Math.atan2(d[1],d[0]);const u=n[t.fontName];u.vertical&&(h+=Math.PI/2);const p=Math.hypot(d[2],d[3]),m=p*function(e,t){const n=o.get(e);if(n)return n;t.save(),t.font=`30px ${e}`;const i=t.measureText("");let r=i.fontBoundingBoxAscent,a=Math.abs(i.fontBoundingBoxDescent);if(r){t.restore();const n=r/(r+a);return o.set(e,n),n}t.strokeStyle="red",t.clearRect(0,0,s,s),t.strokeText("g",0,0);let l=t.getImageData(0,0,s,s).data;a=0;for(let e=l.length-1-3;e>=0;e-=4)if(l[e]>0){a=Math.ceil(e/4/s);break}t.clearRect(0,0,s,s),t.strokeText("A",0,s),l=t.getImageData(0,0,s,s).data,r=0;for(let e=0,t=l.length;e<t;e+=4)if(l[e]>0){r=s-Math.floor(e/4/s);break}if(t.restore(),r){const t=r/(r+a);return o.set(e,t),t}return o.set(e,.8),.8}(u.fontFamily,r);let g,f;0===h?(g=d[4],f=d[5]-m):(g=d[4]+m*Math.sin(h),f=d[5]-m*Math.cos(h)),l.style.left=`${g}px`,l.style.top=`${f}px`,l.style.fontSize=`${p}px`,l.style.fontFamily=u.fontFamily,c.fontSize=p,l.setAttribute("role","presentation"),l.textContent=t.str,l.dir=t.dir,e._fontInspectorEnabled&&(l.dataset.fontName=t.fontName),0!==h&&(c.angle=h*(180/Math.PI));let v=!1;if(t.str.length>1||e._enhanceTextSelection&&a.test(t.str))v=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){const e=Math.abs(t.transform[0]),n=Math.abs(t.transform[3]);e!==n&&Math.max(e,n)/Math.min(e,n)>1.5&&(v=!0)}if(v&&(u.vertical?c.canvasWidth=t.height*e._viewport.scale:c.canvasWidth=t.width*e._viewport.scale),e._textDivProperties.set(l,c),e._textContentStream&&e._layoutText(l),e._enhanceTextSelection&&c.hasText){let n=1,r=0;0!==h&&(n=Math.cos(h),r=Math.sin(h));const s=(u.vertical?t.height:t.width)*e._viewport.scale,o=p;let a,c;0!==h?(a=[n,r,-r,n,g,f],c=i.Util.getAxialAlignedBoundingBox([0,0,s,o],a)):c=[g,f,g+s,f+o],e._bounds.push({left:c[0],top:c[1],right:c[2],bottom:c[3],div:l,size:[s,o],m:a})}}function c(e){if(e._canceled)return;const t=e._textDivs,n=e._capability,i=t.length;if(i>1e5)return e._renderingDone=!0,void n.resolve();if(!e._textContentStream)for(let n=0;n<i;n++)e._layoutText(t[n]);e._renderingDone=!0,n.resolve()}function d(e,t,n){let i=0;for(let r=0;r<n;r++){const n=e[t++];n>0&&(i=i?Math.min(n,i):n)}return i}function h(e,t){t.sort((function(e,t){return e.x1-t.x1||e.index-t.index}));const n=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(const e of t){let t=0;for(;t<n.length&&n[t].end<=e.y1;)t++;let i,r,s=n.length-1;for(;s>=0&&n[s].start>=e.y2;)s--;let o,a,l=-1/0;for(o=t;o<=s;o++){let t;i=n[o],r=i.boundary,t=r.x2>e.x1?r.index>e.index?r.x1New:e.x1:void 0===r.x2New?(r.x2+e.x1)/2:r.x2New,t>l&&(l=t)}for(e.x1New=l,o=t;o<=s;o++)i=n[o],r=i.boundary,void 0===r.x2New?r.x2>e.x1?r.index>e.index&&(r.x2New=r.x2):r.x2New=l:r.x2New>l&&(r.x2New=Math.max(l,r.x2));const c=[];let d=null;for(o=t;o<=s;o++){i=n[o],r=i.boundary;const t=r.x2>e.x2?r:e;d===t?c.at(-1).end=i.end:(c.push({start:i.start,end:i.end,boundary:t}),d=t)}for(n[t].start<e.y1&&(c[0].start=e.y1,c.unshift({start:n[t].start,end:e.y1,boundary:n[t].boundary})),e.y2<n[s].end&&(c.at(-1).end=e.y2,c.push({start:e.y2,end:n[s].end,boundary:n[s].boundary})),o=t;o<=s;o++){if(i=n[o],r=i.boundary,void 0!==r.x2New)continue;let e=!1;for(a=t-1;!e&&a>=0&&n[a].start>=r.y1;a--)e=n[a].boundary===r;for(a=s+1;!e&&a<n.length&&n[a].end<=r.y2;a++)e=n[a].boundary===r;for(a=0;!e&&a<c.length;a++)e=c[a].boundary===r;e||(r.x2New=l)}Array.prototype.splice.apply(n,[t,s-t+1,...c])}for(const t of n){const n=t.boundary;void 0===n.x2New&&(n.x2New=Math.max(e,n.x2))}}class u{constructor({textContent:e,textContentStream:t,container:n,viewport:s,textDivs:o,textContentItemsStr:a,enhanceTextSelection:l}){l&&(0,r.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=e,this._textContentStream=t,this._container=n,this._document=n.ownerDocument,this._viewport=s,this._textDivs=o||[],this._textContentItemsStr=a||[],this._enhanceTextSelection=!!l,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,i.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally((()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)})).catch((()=>{}))}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new i.AbortException("TextLayer task cancelled.")).catch((()=>{})),this._reader=null),null!==this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(e,t){for(let n=0,i=e.length;n<i;n++)if(void 0!==e[n].str)this._textContentItemsStr.push(e[n].str),l(this,e[n],t,this._layoutTextCtx);else if("beginMarkedContentProps"===e[n].type||"beginMarkedContent"===e[n].type){const t=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==e[n].id&&this._container.setAttribute("id",`${e[n].id}`),t.append(this._container)}else"endMarkedContent"===e[n].type&&(this._container=this._container.parentNode)}_layoutText(e){const t=this._textDivProperties.get(e);let n="";if(0!==t.canvasWidth&&t.hasText){const{fontFamily:i}=e.style,{fontSize:r}=t;r===this._layoutTextLastFontSize&&i===this._layoutTextLastFontFamily||(this._layoutTextCtx.font=`${r*this._devicePixelRatio}px ${i}`,this._layoutTextLastFontSize=r,this._layoutTextLastFontFamily=i);const{width:s}=this._layoutTextCtx.measureText(e.textContent);if(s>0){const e=this._devicePixelRatio*t.canvasWidth/s;this._enhanceTextSelection&&(t.scale=e),n=`scaleX(${e})`}}if(0!==t.angle&&(n=`rotate(${t.angle}deg) ${n}`),n.length>0&&(this._enhanceTextSelection&&(t.originalTransform=n),e.style.transform=n),t.hasText&&this._container.append(e),t.hasEOL){const e=document.createElement("br");e.setAttribute("role","presentation"),this._container.append(e)}}_render(e=0){const t=(0,i.createPromiseCapability)();let n=Object.create(null);const r=this._document.createElement("canvas");if(r.height=r.width=s,this._layoutTextCtx=r.getContext("2d",{alpha:!1}),this._textContent){const e=this._textContent.items,n=this._textContent.styles;this._processItems(e,n),t.resolve()}else{if(!this._textContentStream)throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');{const e=()=>{this._reader.read().then((({value:i,done:r})=>{r?t.resolve():(Object.assign(n,i.styles),this._processItems(i.items,n),e())}),t.reject)};this._reader=this._textContentStream.getReader(),e()}}t.promise.then((()=>{n=null,e?this._renderTimer=setTimeout((()=>{c(this),this._renderTimer=null}),e):c(this)}),this._capability.reject)}expandTextDivs(e=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;null!==this._bounds&&(function(e){const t=e._bounds,n=e._viewport,r=function(e,t,n){const i=n.map((function(e,t){return{x1:e.left,y1:e.top,x2:e.right,y2:e.bottom,index:t,x1New:void 0,x2New:void 0}}));h(e,i);const r=new Array(n.length);for(const e of i){const t=e.index;r[t]={left:e.x1New,top:0,right:e.x2New,bottom:0}}n.map((function(t,n){const s=r[n],o=i[n];o.x1=t.top,o.y1=e-s.right,o.x2=t.bottom,o.y2=e-s.left,o.index=n,o.x1New=void 0,o.x2New=void 0})),h(t,i);for(const e of i){const t=e.index;r[t].top=e.x1New,r[t].bottom=e.x2New}return r}(n.width,n.height,t);for(let n=0;n<r.length;n++){const s=t[n].div,o=e._textDivProperties.get(s);if(0===o.angle){o.paddingLeft=t[n].left-r[n].left,o.paddingTop=t[n].top-r[n].top,o.paddingRight=r[n].right-t[n].right,o.paddingBottom=r[n].bottom-t[n].bottom,e._textDivProperties.set(s,o);continue}const a=r[n],l=t[n],c=l.m,h=c[0],u=c[1],p=[[0,0],[0,l.size[1]],[l.size[0],0],l.size],m=new Float64Array(64);for(let e=0,t=p.length;e<t;e++){const t=i.Util.applyTransform(p[e],c);m[e+0]=h&&(a.left-t[0])/h,m[e+4]=u&&(a.top-t[1])/u,m[e+8]=h&&(a.right-t[0])/h,m[e+12]=u&&(a.bottom-t[1])/u,m[e+16]=u&&(a.left-t[0])/-u,m[e+20]=h&&(a.top-t[1])/h,m[e+24]=u&&(a.right-t[0])/-u,m[e+28]=h&&(a.bottom-t[1])/h,m[e+32]=h&&(a.left-t[0])/-h,m[e+36]=u&&(a.top-t[1])/-u,m[e+40]=h&&(a.right-t[0])/-h,m[e+44]=u&&(a.bottom-t[1])/-u,m[e+48]=u&&(a.left-t[0])/u,m[e+52]=h&&(a.top-t[1])/-h,m[e+56]=u&&(a.right-t[0])/u,m[e+60]=h&&(a.bottom-t[1])/-h}const g=1+Math.min(Math.abs(h),Math.abs(u));o.paddingLeft=d(m,32,16)/g,o.paddingTop=d(m,48,16)/g,o.paddingRight=d(m,0,16)/g,o.paddingBottom=d(m,16,16)/g,e._textDivProperties.set(s,o)}}(this),this._bounds=null);const t=[],n=[];for(let i=0,r=this._textDivs.length;i<r;i++){const r=this._textDivs[i],s=this._textDivProperties.get(r);s.hasText&&(e?(t.length=0,n.length=0,s.originalTransform&&t.push(s.originalTransform),s.paddingTop>0?(n.push(`${s.paddingTop}px`),t.push(`translateY(${-s.paddingTop}px)`)):n.push(0),s.paddingRight>0?n.push(s.paddingRight/s.scale+"px"):n.push(0),s.paddingBottom>0?n.push(`${s.paddingBottom}px`):n.push(0),s.paddingLeft>0?(n.push(s.paddingLeft/s.scale+"px"),t.push(`translateX(${-s.paddingLeft/s.scale}px)`)):n.push(0),r.style.padding=n.join(" "),t.length&&(r.style.transform=t.join(" "))):(r.style.padding=null,r.style.transform=s.originalTransform))}}}t.TextLayerRenderTask=u},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var i=n(4),r=n(1),s=n(3);let o=class{constructor(){(0,r.unreachable)("Not implemented: SVGGraphics")}};t.SVGGraphics=o;{const a={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},l="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/1999/xlink",d=["butt","round","square"],h=["miter","round","bevel"],u=function(e,t="",n=!1){if(URL.createObjectURL&&"undefined"!=typeof Blob&&!n)return URL.createObjectURL(new Blob([e],{type:t}));const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r=`data:${t};base64,`;for(let t=0,n=e.length;t<n;t+=3){const s=255&e[t],o=255&e[t+1],a=255&e[t+2];r+=i[s>>2]+i[(3&s)<<4|o>>4]+i[t+1<n?(15&o)<<2|a>>6:64]+i[t+2<n?63&a:64]}return r},p=function(){const e=new Uint8Array([137,80,78,71,13,10,26,10]),t=new Int32Array(256);for(let e=0;e<256;e++){let n=e;for(let e=0;e<8;e++)n=1&n?3988292384^n>>1&2147483647:n>>1&2147483647;t[e]=n}function n(e,n,i,r){let s=r;const o=n.length;i[s]=o>>24&255,i[s+1]=o>>16&255,i[s+2]=o>>8&255,i[s+3]=255&o,s+=4,i[s]=255&e.charCodeAt(0),i[s+1]=255&e.charCodeAt(1),i[s+2]=255&e.charCodeAt(2),i[s+3]=255&e.charCodeAt(3),s+=4,i.set(n,s),s+=n.length;const a=function(e,n,i){let r=-1;for(let s=n;s<i;s++){const n=255&(r^e[s]);r=r>>>8^t[n]}return-1^r}(i,r+4,s);i[s]=a>>24&255,i[s+1]=a>>16&255,i[s+2]=a>>8&255,i[s+3]=255&a}function i(e){let t=e.length;const n=65535,i=Math.ceil(t/n),r=new Uint8Array(2+t+5*i+4);let s=0;r[s++]=120,r[s++]=156;let o=0;for(;t>n;)r[s++]=0,r[s++]=255,r[s++]=255,r[s++]=0,r[s++]=0,r.set(e.subarray(o,o+n),s),s+=n,o+=n,t-=n;r[s++]=1,r[s++]=255&t,r[s++]=t>>8&255,r[s++]=255&~t,r[s++]=(65535&~t)>>8&255,r.set(e.subarray(o),s),s+=e.length-o;const a=function(e,t,n){let i=1,r=0;for(let t=0;t<n;++t)i=(i+(255&e[t]))%65521,r=(r+i)%65521;return r<<16|i}(e,0,e.length);return r[s++]=a>>24&255,r[s++]=a>>16&255,r[s++]=a>>8&255,r[s++]=255&a,r}return function(t,o,a){return function(t,o,a,l){const c=t.width,d=t.height;let h,p,m;const g=t.data;switch(o){case r.ImageKind.GRAYSCALE_1BPP:p=0,h=1,m=c+7>>3;break;case r.ImageKind.RGB_24BPP:p=2,h=8,m=3*c;break;case r.ImageKind.RGBA_32BPP:p=6,h=8,m=4*c;break;default:throw new Error("invalid format")}const f=new Uint8Array((1+m)*d);let v=0,y=0;for(let e=0;e<d;++e)f[v++]=0,f.set(g.subarray(y,y+m),v),y+=m,v+=m;if(o===r.ImageKind.GRAYSCALE_1BPP&&l){v=0;for(let e=0;e<d;e++){v++;for(let e=0;e<m;e++)f[v++]^=255}}const b=new Uint8Array([c>>24&255,c>>16&255,c>>8&255,255&c,d>>24&255,d>>16&255,d>>8&255,255&d,h,p,0,0,0]),w=function(e){if(!s.isNodeJS)return i(e);try{let t;t=parseInt(process.versions.node)>=8?e:Buffer.from(e);const n=__webpack_require__(2258).deflateSync(t,{level:9});return n instanceof Uint8Array?n:new Uint8Array(n)}catch(e){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+e)}return i(e)}(f),S=e.length+36+b.length+w.length,_=new Uint8Array(S);let E=0;return _.set(e,E),E+=e.length,n("IHDR",b,_,E),E+=12+b.length,n("IDATA",w,_,E),E+=12+w.length,n("IEND",new Uint8Array(0),_,E),u(_,"image/png",a)}(t,void 0===t.kind?r.ImageKind.GRAYSCALE_1BPP:t.kind,o,a)}}();class m{constructor(){this.fontSizeScale=1,this.fontWeight=a.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=a.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}}function g(e){let t=[];const n=[];for(const i of e)"save"!==i.fn?"restore"===i.fn?t=n.pop():t.push(i):(t.push({fnId:92,fn:"group",items:[]}),n.push(t),t=t.at(-1).items);return t}function f(e){if(Number.isInteger(e))return e.toString();const t=e.toFixed(10);let n=t.length-1;if("0"!==t[n])return t;do{n--}while("0"===t[n]);return t.substring(0,"."===t[n]?n:n+1)}function v(e){if(0===e[4]&&0===e[5]){if(0===e[1]&&0===e[2])return 1===e[0]&&1===e[3]?"":`scale(${f(e[0])} ${f(e[3])})`;if(e[0]===e[3]&&e[1]===-e[2])return`rotate(${f(180*Math.acos(e[0])/Math.PI)})`}else if(1===e[0]&&0===e[1]&&0===e[2]&&1===e[3])return`translate(${f(e[4])} ${f(e[5])})`;return`matrix(${f(e[0])} ${f(e[1])} ${f(e[2])} ${f(e[3])} ${f(e[4])} ${f(e[5])})`}let y=0,b=0,w=0;t.SVGGraphics=o=class{constructor(e,t,n=!1){(0,i.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new i.DOMSVGFactory,this.current=new m,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!n,this._operatorIdMapping=[];for(const e in r.OPS)this._operatorIdMapping[r.OPS[e]]=e}save(){this.transformStack.push(this.transformMatrix);const e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){const t=e.fnArray,n=e.argsArray;for(let e=0,i=t.length;e<i;e++)if(t[e]===r.OPS.dependency)for(const t of n[e]){const e=t.startsWith("g_")?this.commonObjs:this.objs,n=new Promise((n=>{e.get(t,n)}));this.current.dependencies.push(n)}return Promise.all(this.current.dependencies)}transform(e,t,n,i,s,o){const a=[e,t,n,i,s,o];this.transformMatrix=r.Util.transform(this.transformMatrix,a),this.tgrp=null}getSVG(e,t){this.viewport=t;const n=this._initialize(t);return this.loadDependencies(e).then((()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),n)))}convertOpList(e){const t=this._operatorIdMapping,n=e.argsArray,i=e.fnArray,r=[];for(let e=0,s=i.length;e<s;e++){const s=i[e];r.push({fnId:s,fn:t[s],args:n[e]})}return g(r)}executeOpTree(e){for(const t of e){const e=t.fn,n=t.fnId,i=t.args;switch(0|n){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(i);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(i[0],i[1]);break;case r.OPS.setFont:this.setFont(i);break;case r.OPS.showText:case r.OPS.showSpacedText:this.showText(i[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(i[0],i[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(i[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(i[0]);break;case r.OPS.setHScale:this.setHScale(i[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(i[0],i[1],i[2],i[3],i[4],i[5]);break;case r.OPS.setTextRise:this.setTextRise(i[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(i[0]);break;case r.OPS.setLineWidth:this.setLineWidth(i[0]);break;case r.OPS.setLineJoin:this.setLineJoin(i[0]);break;case r.OPS.setLineCap:this.setLineCap(i[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(i[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(i[0],i[1],i[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(i[0],i[1],i[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(i);break;case r.OPS.setFillColorN:this.setFillColorN(i);break;case r.OPS.shadingFill:this.shadingFill(i[0]);break;case r.OPS.setDash:this.setDash(i[0],i[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(i[0]);break;case r.OPS.setFlatness:this.setFlatness(i[0]);break;case r.OPS.setGState:this.setGState(i[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(i[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(i[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(i[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(i[0],i[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(i[0],i[1],i[2],i[3],i[4],i[5]);break;case r.OPS.constructPath:this.constructPath(i[0],i[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,r.warn)(`Unimplemented operator ${e}`)}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,t,n,i,r,s){const o=this.current;o.textMatrix=o.lineMatrix=[e,t,n,i,r,s],o.textMatrixScale=Math.hypot(e,t),o.x=o.lineX=0,o.y=o.lineY=0,o.xcoords=[],o.ycoords=[],o.tspan=this.svgFactory.createElement("svg:tspan"),o.tspan.setAttributeNS(null,"font-family",o.fontFamily),o.tspan.setAttributeNS(null,"font-size",`${f(o.fontSize)}px`),o.tspan.setAttributeNS(null,"y",f(-o.y)),o.txtElement=this.svgFactory.createElement("svg:text"),o.txtElement.append(o.tspan)}beginText(){const e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=r.IDENTITY_MATRIX,e.lineMatrix=r.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,t){const n=this.current;n.x=n.lineX+=e,n.y=n.lineY+=t,n.xcoords=[],n.ycoords=[],n.tspan=this.svgFactory.createElement("svg:tspan"),n.tspan.setAttributeNS(null,"font-family",n.fontFamily),n.tspan.setAttributeNS(null,"font-size",`${f(n.fontSize)}px`),n.tspan.setAttributeNS(null,"y",f(-n.y))}showText(e){const t=this.current,n=t.font,i=t.fontSize;if(0===i)return;const s=t.fontSizeScale,o=t.charSpacing,c=t.wordSpacing,d=t.fontDirection,h=t.textHScale*d,u=n.vertical,p=u?1:-1,m=n.defaultVMetrics,g=i*t.fontMatrix[0];let y=0;for(const r of e){if(null===r){y+=d*c;continue}if("number"==typeof r){y+=p*r*i/1e3;continue}const e=(r.isSpace?c:0)+o,a=r.fontChar;let l,h,f,v=r.width;if(u){let e;const t=r.vmetric||m;e=r.vmetric?t[1]:.5*v,e=-e*g;const n=t[2]*g;v=t?-t[0]:v,l=e/s,h=(y+n)/s}else l=y/s,h=0;(r.isInFont||n.missingFile)&&(t.xcoords.push(t.x+l),u&&t.ycoords.push(-t.y+h),t.tspan.textContent+=a),f=u?v*g-e*d:v*g+e*d,y+=f}t.tspan.setAttributeNS(null,"x",t.xcoords.map(f).join(" ")),u?t.tspan.setAttributeNS(null,"y",t.ycoords.map(f).join(" ")):t.tspan.setAttributeNS(null,"y",f(-t.y)),u?t.y-=y:t.x+=y*h,t.tspan.setAttributeNS(null,"font-family",t.fontFamily),t.tspan.setAttributeNS(null,"font-size",`${f(t.fontSize)}px`),t.fontStyle!==a.fontStyle&&t.tspan.setAttributeNS(null,"font-style",t.fontStyle),t.fontWeight!==a.fontWeight&&t.tspan.setAttributeNS(null,"font-weight",t.fontWeight);const b=t.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if(b===r.TextRenderingMode.FILL||b===r.TextRenderingMode.FILL_STROKE?(t.fillColor!==a.fillColor&&t.tspan.setAttributeNS(null,"fill",t.fillColor),t.fillAlpha<1&&t.tspan.setAttributeNS(null,"fill-opacity",t.fillAlpha)):t.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?t.tspan.setAttributeNS(null,"fill","transparent"):t.tspan.setAttributeNS(null,"fill","none"),b===r.TextRenderingMode.STROKE||b===r.TextRenderingMode.FILL_STROKE){const e=1/(t.textMatrixScale||1);this._setStrokeAttributes(t.tspan,e)}let w=t.textMatrix;0!==t.textRise&&(w=w.slice(),w[5]+=t.textRise),t.txtElement.setAttributeNS(null,"transform",`${v(w)} scale(${f(h)}, -1)`),t.txtElement.setAttributeNS(l,"xml:space","preserve"),t.txtElement.append(t.tspan),t.txtgrp.append(t.txtElement),this._ensureTransformGroup().append(t.txtElement)}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const t=u(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${e.loadedName}"; src: url(${t}); }\n`}setFont(e){const t=this.current,n=this.commonObjs.get(e[0]);let i=e[1];t.font=n,!this.embedFonts||n.missingFile||this.embeddedFonts[n.loadedName]||(this.addFontStyle(n),this.embeddedFonts[n.loadedName]=n),t.fontMatrix=n.fontMatrix||r.FONT_IDENTITY_MATRIX;let s="normal";n.black?s="900":n.bold&&(s="bold");const o=n.italic?"italic":"normal";i<0?(i=-i,t.fontDirection=-1):t.fontDirection=1,t.fontSize=i,t.fontFamily=n.loadedName,t.fontWeight=s,t.fontStyle=o,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",f(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){const e=this.current;e.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&e.txtElement?.hasChildNodes()&&(e.element=e.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=d[e]}setLineJoin(e){this.current.lineJoin=h[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,t,n){this.current.strokeColor=r.Util.makeHexColor(e,t,n)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,t,n){this.current.fillColor=r.Util.makeHexColor(e,t,n),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){const t=this.viewport.width,n=this.viewport.height,i=r.Util.inverseTransform(this.transformMatrix),s=r.Util.applyTransform([0,0],i),o=r.Util.applyTransform([0,n],i),a=r.Util.applyTransform([t,0],i),l=r.Util.applyTransform([t,n],i),c=Math.min(s[0],o[0],a[0],l[0]),d=Math.min(s[1],o[1],a[1],l[1]),h=Math.max(s[0],o[0],a[0],l[0]),u=Math.max(s[1],o[1],a[1],l[1]),p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",c),p.setAttributeNS(null,"y",d),p.setAttributeNS(null,"width",h-c),p.setAttributeNS(null,"height",u-d),p.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&p.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(p)}_makeColorN_Pattern(e){return"TilingPattern"===e[0]?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){const t=e[1],n=e[2],i=e[3]||r.IDENTITY_MATRIX,[s,o,a,l]=e[4],c=e[5],d=e[6],h=e[7],u="shading"+w++,[p,m,g,f]=r.Util.normalizeRect([...r.Util.applyTransform([s,o],i),...r.Util.applyTransform([a,l],i)]),[v,y]=r.Util.singularValueDecompose2dScale(i),b=c*v,S=d*y,_=this.svgFactory.createElement("svg:pattern");_.setAttributeNS(null,"id",u),_.setAttributeNS(null,"patternUnits","userSpaceOnUse"),_.setAttributeNS(null,"width",b),_.setAttributeNS(null,"height",S),_.setAttributeNS(null,"x",`${p}`),_.setAttributeNS(null,"y",`${m}`);const E=this.svg,k=this.transformMatrix,x=this.current.fillColor,T=this.current.strokeColor,C=this.svgFactory.create(g-p,f-m);if(this.svg=C,this.transformMatrix=i,2===h){const e=r.Util.makeHexColor(...t);this.current.fillColor=e,this.current.strokeColor=e}return this.executeOpTree(this.convertOpList(n)),this.svg=E,this.transformMatrix=k,this.current.fillColor=x,this.current.strokeColor=T,_.append(C.childNodes[0]),this.defs.append(_),`url(#${u})`}_makeShadingPattern(e){switch("string"==typeof e&&(e=this.objs.get(e)),e[0]){case"RadialAxial":const t="shading"+w++,n=e[3];let i;switch(e[1]){case"axial":const n=e[4],r=e[5];i=this.svgFactory.createElement("svg:linearGradient"),i.setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"x1",n[0]),i.setAttributeNS(null,"y1",n[1]),i.setAttributeNS(null,"x2",r[0]),i.setAttributeNS(null,"y2",r[1]);break;case"radial":const s=e[4],o=e[5],a=e[6],l=e[7];i=this.svgFactory.createElement("svg:radialGradient"),i.setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"cx",o[0]),i.setAttributeNS(null,"cy",o[1]),i.setAttributeNS(null,"r",l),i.setAttributeNS(null,"fx",s[0]),i.setAttributeNS(null,"fy",s[1]),i.setAttributeNS(null,"fr",a);break;default:throw new Error(`Unknown RadialAxial type: ${e[1]}`)}for(const e of n){const t=this.svgFactory.createElement("svg:stop");t.setAttributeNS(null,"offset",e[0]),t.setAttributeNS(null,"stop-color",e[1]),i.append(t)}return this.defs.append(i),`url(#${t})`;case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${e[0]}`)}}setDash(e,t){this.current.dashArray=e,this.current.dashPhase=t}constructPath(e,t){const n=this.current;let i=n.x,s=n.y,o=[],a=0;for(const n of e)switch(0|n){case r.OPS.rectangle:i=t[a++],s=t[a++];const e=i+t[a++],n=s+t[a++];o.push("M",f(i),f(s),"L",f(e),f(s),"L",f(e),f(n),"L",f(i),f(n),"Z");break;case r.OPS.moveTo:i=t[a++],s=t[a++],o.push("M",f(i),f(s));break;case r.OPS.lineTo:i=t[a++],s=t[a++],o.push("L",f(i),f(s));break;case r.OPS.curveTo:i=t[a+4],s=t[a+5],o.push("C",f(t[a]),f(t[a+1]),f(t[a+2]),f(t[a+3]),f(i),f(s)),a+=6;break;case r.OPS.curveTo2:o.push("C",f(i),f(s),f(t[a]),f(t[a+1]),f(t[a+2]),f(t[a+3])),i=t[a+2],s=t[a+3],a+=4;break;case r.OPS.curveTo3:i=t[a+2],s=t[a+3],o.push("C",f(t[a]),f(t[a+1]),f(i),f(s),f(i),f(s)),a+=4;break;case r.OPS.closePath:o.push("Z")}o=o.join(" "),n.path&&e.length>0&&e[0]!==r.OPS.rectangle&&e[0]!==r.OPS.moveTo?o=n.path.getAttributeNS(null,"d")+o:(n.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(n.path)),n.path.setAttributeNS(null,"d",o),n.path.setAttributeNS(null,"fill","none"),n.element=n.path,n.setCurrentPoint(i,s)}endPath(){const e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element)return void(this.pendingClip=null);const t="clippath"+y++,n=this.svgFactory.createElement("svg:clipPath");n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"transform",v(this.transformMatrix));const i=e.element.cloneNode(!0);if("evenodd"===this.pendingClip?i.setAttributeNS(null,"clip-rule","evenodd"):i.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,n.append(i),this.defs.append(n),e.activeClipUrl){e.clipGroup=null;for(const e of this.extraStack)e.clipGroup=null;n.setAttributeNS(null,"clip-path",e.activeClipUrl)}e.activeClipUrl=`url(#${t})`,this.tgrp=null}clip(e){this.pendingClip=e}closePath(){const e=this.current;if(e.path){const t=`${e.path.getAttributeNS(null,"d")}Z`;e.path.setAttributeNS(null,"d",t)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n);break;case"CA":this.setStrokeAlpha(n);break;case"ca":this.setFillAlpha(n);break;default:(0,r.warn)(`Unimplemented graphic state operator ${t}`)}}fill(){const e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){const e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e,t=1){const n=this.current;let i=n.dashArray;1!==t&&i.length>0&&(i=i.map((function(e){return t*e}))),e.setAttributeNS(null,"stroke",n.strokeColor),e.setAttributeNS(null,"stroke-opacity",n.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",f(n.miterLimit)),e.setAttributeNS(null,"stroke-linecap",n.lineCap),e.setAttributeNS(null,"stroke-linejoin",n.lineJoin),e.setAttributeNS(null,"stroke-width",f(t*n.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",i.map(f).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",f(t*n.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(e)}paintImageXObject(e){const t=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);t?this.paintInlineImageXObject(t):(0,r.warn)(`Dependent image with object ID ${e} is not ready yet`)}paintInlineImageXObject(e,t){const n=e.width,i=e.height,r=p(e,this.forceDataSchema,!!t),s=this.svgFactory.createElement("svg:rect");s.setAttributeNS(null,"x","0"),s.setAttributeNS(null,"y","0"),s.setAttributeNS(null,"width",f(n)),s.setAttributeNS(null,"height",f(i)),this.current.element=s,this.clip("nonzero");const o=this.svgFactory.createElement("svg:image");o.setAttributeNS(c,"xlink:href",r),o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y",f(-i)),o.setAttributeNS(null,"width",f(n)+"px"),o.setAttributeNS(null,"height",f(i)+"px"),o.setAttributeNS(null,"transform",`scale(${f(1/n)} ${f(-1/i)})`),t?t.append(o):this._ensureTransformGroup().append(o)}paintImageMaskXObject(e){const t=this.current,n=e.width,i=e.height,r=t.fillColor;t.maskId="mask"+b++;const s=this.svgFactory.createElement("svg:mask");s.setAttributeNS(null,"id",t.maskId);const o=this.svgFactory.createElement("svg:rect");o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y","0"),o.setAttributeNS(null,"width",f(n)),o.setAttributeNS(null,"height",f(i)),o.setAttributeNS(null,"fill",r),o.setAttributeNS(null,"mask",`url(#${t.maskId})`),this.defs.append(s),this._ensureTransformGroup().append(o),this.paintInlineImageXObject(e,s)}paintFormXObjectBegin(e,t){if(Array.isArray(e)&&6===e.length&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t){const e=t[2]-t[0],n=t[3]-t[1],i=this.svgFactory.createElement("svg:rect");i.setAttributeNS(null,"x",t[0]),i.setAttributeNS(null,"y",t[1]),i.setAttributeNS(null,"width",f(e)),i.setAttributeNS(null,"height",f(n)),this.current.element=i,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){const t=this.svgFactory.create(e.width,e.height),n=this.svgFactory.createElement("svg:defs");t.append(n),this.defs=n;const i=this.svgFactory.createElement("svg:g");return i.setAttributeNS(null,"transform",v(e.transform)),t.append(i),this.svg=i,t}_ensureClipGroup(){if(!this.current.clipGroup){const e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",v(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var i=n(1),r=n(33);const s=__webpack_require__(172),o=__webpack_require__(2001),a=__webpack_require__(3779),l=__webpack_require__(6558),c=/^file:\/\/\/[a-zA-Z]:\//;t.PDFNodeStream=class{constructor(e){this.source=e,this.url=function(e){const t=l.parse(e);return"file:"===t.protocol||t.host?t:/^[a-z]:[/\\]/i.test(e)?l.parse(`file:///${e}`):(t.host||(t.protocol="file:"),t)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new g(this):new p(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=this.isFsUrl?new f(this,e,t):new m(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class d{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=(0,i.createPromiseCapability)(),this._headersCapability=(0,i.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return null===e?(this._readCapability=(0,i.createPromiseCapability)(),this.read()):(this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new i.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class h{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,i.createPromiseCapability)();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return null===e?(this._readCapability=(0,i.createPromiseCapability)(),this.read()):(this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function u(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class p extends d{constructor(e){super(e);const t=t=>{if(404===t.statusCode){const e=new i.MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const n=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:s,suggestedLength:o}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=o||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(n)};this._request=null,"http:"===this._url.protocol?this._request=o.request(u(this._url,e.httpHeaders),t):this._request=a.request(u(this._url,e.httpHeaders),t),this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class m extends h{constructor(e,t,n){super(e),this._httpHeaders={};for(const t in e.httpHeaders){const n=e.httpHeaders[t];void 0!==n&&(this._httpHeaders[t]=n)}this._httpHeaders.Range=`bytes=${t}-${n-1}`;const r=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{const e=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=o.request(u(this._url,this._httpHeaders),r):this._request=a.request(u(this._url,this._httpHeaders),r),this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class g extends d{constructor(e){super(e);let t=decodeURIComponent(this._url.path);c.test(this._url.href)&&(t=t.replace(/^\//,"")),s.lstat(t,((e,n)=>{if(e)return"ENOENT"===e.code&&(e=new i.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=n.size,this._setReadableStream(s.createReadStream(t)),this._headersCapability.resolve()}))}}class f extends h{constructor(e,t,n){super(e);let i=decodeURIComponent(this._url.path);c.test(this._url.href)&&(i=i.replace(/^\//,"")),this._setReadableStream(s.createReadStream(i,{start:t,end:n-1}))}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=function(e,t){return 404===e||0===e&&t.startsWith("file:")?new i.MissingPDFException('Missing PDF "'+t+'".'):new i.UnexpectedResponseException(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e)},t.extractFilenameFromHeader=function(e){const t=e("Content-Disposition");if(t){let e=(0,r.getFilenameFromContentDispositionHeader)(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(e){}if((0,s.isPdfFile)(e))return e}return null},t.validateRangeRequestCapabilities=function({getResponseHeader:e,isHttp:t,rangeChunkSize:n,disableRange:i}){const r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(e("Content-Length"),10);return Number.isInteger(s)?(r.suggestedLength=s,s<=2*n||i||!t||"bytes"!==e("Accept-Ranges")||"identity"!==(e("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r):r},t.validateResponseStatus=function(e){return 200===e||206===e};var i=n(1),r=n(34),s=n(4)},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=function(e){let t=!0,n=r("filename\\*","i").exec(e);if(n){n=n[1];let e=a(n);return e=unescape(e),e=l(e),e=c(e),o(e)}if(n=function(e){const t=[];let n;const i=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=i.exec(e));){let[,e,i,r]=n;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[i,r]}const s=[];for(let e=0;e<t.length&&e in t;++e){let[n,i]=t[e];i=a(i),n&&(i=unescape(i),0===e&&(i=l(i))),s.push(i)}return s.join("")}(e),n)return o(c(n));if(n=r("filename","i").exec(e),n){n=n[1];let e=a(n);return e=c(e),o(e)}function r(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function s(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const r=new TextDecoder(e,{fatal:!0}),s=(0,i.stringToBytes)(n);n=r.decode(s),t=!1}catch(e){}}return n}function o(e){return t&&/[\x80-\xff]/.test(e)&&(e=s("utf-8",e),t&&(e=s("iso-8859-1",e))),e}function a(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replace(/\\(.)/g,"$1")}e=t.join('"')}return e}function l(e){const t=e.indexOf("'");return-1===t?e:s(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function c(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,n,i){if("q"===n||"Q"===n)return s(t,i=(i=i.replace(/_/g," ")).replace(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{i=atob(i)}catch(e){}return s(t,i)}))}return""};var i=n(1)},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var i=n(1),r=n(33);class s{constructor(e,t={}){this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.getXhr=t.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,n){const i={begin:e,end:t};for(const e in n)i[e]=n[e];return this.request(i)}requestFull(e){return this.request(e)}request(e){const t=this.getXhr(),n=this.currXhrId++,i=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const e in this.httpHeaders){const n=this.httpHeaders[e];void 0!==n&&t.setRequestHeader(e,n)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=206):i.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4!==r.readyState)return;if(!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===r.status&&this.isHttp)return void n.onError?.(r.status);const s=r.status||200;if((200!==s||206!==n.expectedStatus)&&s!==n.expectedStatus)return void n.onError?.(r.status);const o=function(e){const t=e.response;return"string"!=typeof t?t:(0,i.stringToBytes)(t).buffer}(r);if(206===s){const e=r.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);n.onDone({begin:parseInt(t[1],10),chunk:o})}else o?n.onDone({begin:0,chunk:o}):n.onError?.(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}t.PDFNetworkStream=class{constructor(e){this._source=e,this._manager=new s(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new o(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new a(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class o{constructor(e,t){this._manager=e;const n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(n),this._headersReceivedCapability=(0,i.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),n=e=>t.getResponseHeader(e),{allowRangeRequests:i,suggestedLength:s}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=(0,r.createResponseStatusError)(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,i.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class a{constructor(e,t,n){this._manager=e;const i={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,n,i),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=(0,r.createResponseStatusError)(e,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,i.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var i=n(1),r=n(33);function s(e,t,n){return{method:"GET",headers:e,signal:n?.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function o(e){const t=new Headers;for(const n in e){const i=e[n];void 0!==i&&t.append(n,i)}return t}t.PDFFetchStream=class{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new a(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new l(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class a{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=(0,i.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=o(this._stream.httpHeaders);const n=t.url;fetch(n,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,r.validateResponseStatus)(e.status))throw(0,r.createResponseStatusError)(e.status,n);this._reader=e.body.getReader(),this._headersCapability.resolve();const t=t=>e.headers.get(t),{allowRangeRequests:s,suggestedLength:o}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=o||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new i.AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}class l{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const a=e.source;this._withCredentials=a.withCredentials||!1,this._readCapability=(0,i.createPromiseCapability)(),this._isStreamingSupported=!a.disableStream,"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${n-1}`);const l=a.url;fetch(l,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,r.validateResponseStatus)(e.status))throw(0,r.createResponseStatusError)(e.status,l);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__w_pdfjs_require__),n.exports}var __webpack_exports__={};return(()=>{var e=__webpack_exports__;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AnnotationEditorLayer",{enumerable:!0,get:function(){return r.AnnotationEditorLayer}}),Object.defineProperty(e,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return t.AnnotationEditorParamsType}}),Object.defineProperty(e,"AnnotationEditorType",{enumerable:!0,get:function(){return t.AnnotationEditorType}}),Object.defineProperty(e,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return s.AnnotationEditorUIManager}}),Object.defineProperty(e,"AnnotationLayer",{enumerable:!0,get:function(){return o.AnnotationLayer}}),Object.defineProperty(e,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(e,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(e,"GlobalWorkerOptions",{enumerable:!0,get:function(){return a.GlobalWorkerOptions}}),Object.defineProperty(e,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(e,"LoopbackPort",{enumerable:!0,get:function(){return i.LoopbackPort}}),Object.defineProperty(e,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(e,"PDFDataRangeTransport",{enumerable:!0,get:function(){return i.PDFDataRangeTransport}}),Object.defineProperty(e,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(e,"PDFWorker",{enumerable:!0,get:function(){return i.PDFWorker}}),Object.defineProperty(e,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(e,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(e,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(e,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(e,"SVGGraphics",{enumerable:!0,get:function(){return d.SVGGraphics}}),Object.defineProperty(e,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return t.UNSUPPORTED_FEATURES}}),Object.defineProperty(e,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(e,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(e,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(e,"XfaLayer",{enumerable:!0,get:function(){return h.XfaLayer}}),Object.defineProperty(e,"binarySearchFirstItem",{enumerable:!0,get:function(){return n.binarySearchFirstItem}}),Object.defineProperty(e,"build",{enumerable:!0,get:function(){return i.build}}),Object.defineProperty(e,"createPromiseCapability",{enumerable:!0,get:function(){return t.createPromiseCapability}}),Object.defineProperty(e,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(e,"getDocument",{enumerable:!0,get:function(){return i.getDocument}}),Object.defineProperty(e,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(e,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(e,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(e,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(e,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(e,"renderTextLayer",{enumerable:!0,get:function(){return c.renderTextLayer}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return i.version}});var t=__w_pdfjs_require__(1),n=__w_pdfjs_require__(4),i=__w_pdfjs_require__(6),r=__w_pdfjs_require__(22),s=__w_pdfjs_require__(9),o=__w_pdfjs_require__(27),a=__w_pdfjs_require__(15),l=__w_pdfjs_require__(3),c=__w_pdfjs_require__(30),d=__w_pdfjs_require__(31),h=__w_pdfjs_require__(29);if(l.isNodeJS){const{PDFNodeStream:e}=__w_pdfjs_require__(32);(0,i.setPDFNetworkStreamFactory)((t=>new e(t)))}else{const{PDFNetworkStream:e}=__w_pdfjs_require__(35),{PDFFetchStream:t}=__w_pdfjs_require__(36);(0,i.setPDFNetworkStreamFactory)((i=>(0,n.isValidFetchUrl)(i.url)?new t(i):new e(i)))}})(),__webpack_exports__})(),module.exports=factory()},2372:(e,t,n)=>{"use strict";const i=n(9299),r=n(3394);"undefined"!=typeof window&&"Worker"in window&&(i.GlobalWorkerOptions.workerPort=new r),e.exports=i},4241:e=>{var t=String,n=function(){return{isColorSupported:!1,reset:t,bold:t,dim:t,italic:t,underline:t,inverse:t,hidden:t,strikethrough:t,black:t,red:t,green:t,yellow:t,blue:t,magenta:t,cyan:t,white:t,gray:t,bgBlack:t,bgRed:t,bgGreen:t,bgYellow:t,bgBlue:t,bgMagenta:t,bgCyan:t,bgWhite:t}};e.exports=n(),e.exports.createColors=n},9041:(e,t,n)=>{var i=n(4606);e.exports=function(e){if(137!==e[0])throw new Error("Invalid .png file header");if(80!==e[1])throw new Error("Invalid .png file header");if(78!==e[2])throw new Error("Invalid .png file header");if(71!==e[3])throw new Error("Invalid .png file header");if(13!==e[4])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");if(10!==e[5])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");if(26!==e[6])throw new Error("Invalid .png file header");if(10!==e[7])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");for(var t=!1,n=[],a=8;a<e.length;){r[3]=e[a++],r[2]=e[a++],r[1]=e[a++],r[0]=e[a++];var l=o[0]+4,c=new Uint8Array(l);c[0]=e[a++],c[1]=e[a++],c[2]=e[a++],c[3]=e[a++];var d=String.fromCharCode(c[0])+String.fromCharCode(c[1])+String.fromCharCode(c[2])+String.fromCharCode(c[3]);if(!n.length&&"IHDR"!==d)throw new Error("IHDR header missing");if("IEND"===d){t=!0,n.push({name:d,data:new Uint8Array(0)});break}for(var h=4;h<l;h++)c[h]=e[a++];r[3]=e[a++],r[2]=e[a++],r[1]=e[a++],r[0]=e[a++];var u=s[0];if(i.buf(c)!==u)throw new Error("CRC values for "+d+" header do not match, PNG file is likely corrupted");var p=new Uint8Array(c.buffer.slice(4));n.push({name:d,data:p})}if(!t)throw new Error(".png file ended prematurely: no IEND header was found");return n};var r=new Uint8Array(4),s=new Int32Array(r.buffer),o=new Uint32Array(r.buffer)},1353:(e,t,n)=>{"use strict";let i=n(1019);class r extends i{constructor(e){super(e),this.type="atrule"}append(...e){return this.proxyOf.nodes||(this.nodes=[]),super.append(...e)}prepend(...e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...e)}}e.exports=r,r.default=r,i.registerAtRule(r)},9932:(e,t,n)=>{"use strict";let i=n(5631);class r extends i{constructor(e){super(e),this.type="comment"}}e.exports=r,r.default=r},1019:(e,t,n)=>{"use strict";let i,r,s,o,{isClean:a,my:l}=n(5513),c=n(4258),d=n(9932),h=n(5631);function u(e){return e.map((e=>(e.nodes&&(e.nodes=u(e.nodes)),delete e.source,e)))}function p(e){if(e[a]=!1,e.proxyOf.nodes)for(let t of e.proxyOf.nodes)p(t)}class m extends h{push(e){return e.parent=this,this.proxyOf.nodes.push(e),this}each(e){if(!this.proxyOf.nodes)return;let t,n,i=this.getIterator();for(;this.indexes[i]<this.proxyOf.nodes.length&&(t=this.indexes[i],n=e(this.proxyOf.nodes[t],t),!1!==n);)this.indexes[i]+=1;return delete this.indexes[i],n}walk(e){return this.each(((t,n)=>{let i;try{i=e(t,n)}catch(e){throw t.addToError(e)}return!1!==i&&t.walk&&(i=t.walk(e)),i}))}walkDecls(e,t){return t?e instanceof RegExp?this.walk(((n,i)=>{if("decl"===n.type&&e.test(n.prop))return t(n,i)})):this.walk(((n,i)=>{if("decl"===n.type&&n.prop===e)return t(n,i)})):(t=e,this.walk(((e,n)=>{if("decl"===e.type)return t(e,n)})))}walkRules(e,t){return t?e instanceof RegExp?this.walk(((n,i)=>{if("rule"===n.type&&e.test(n.selector))return t(n,i)})):this.walk(((n,i)=>{if("rule"===n.type&&n.selector===e)return t(n,i)})):(t=e,this.walk(((e,n)=>{if("rule"===e.type)return t(e,n)})))}walkAtRules(e,t){return t?e instanceof RegExp?this.walk(((n,i)=>{if("atrule"===n.type&&e.test(n.name))return t(n,i)})):this.walk(((n,i)=>{if("atrule"===n.type&&n.name===e)return t(n,i)})):(t=e,this.walk(((e,n)=>{if("atrule"===e.type)return t(e,n)})))}walkComments(e){return this.walk(((t,n)=>{if("comment"===t.type)return e(t,n)}))}append(...e){for(let t of e){let e=this.normalize(t,this.last);for(let t of e)this.proxyOf.nodes.push(t)}return this.markDirty(),this}prepend(...e){e=e.reverse();for(let t of e){let e=this.normalize(t,this.first,"prepend").reverse();for(let t of e)this.proxyOf.nodes.unshift(t);for(let t in this.indexes)this.indexes[t]=this.indexes[t]+e.length}return this.markDirty(),this}cleanRaws(e){if(super.cleanRaws(e),this.nodes)for(let t of this.nodes)t.cleanRaws(e)}insertBefore(e,t){let n,i=0===(e=this.index(e))&&"prepend",r=this.normalize(t,this.proxyOf.nodes[e],i).reverse();for(let t of r)this.proxyOf.nodes.splice(e,0,t);for(let t in this.indexes)n=this.indexes[t],e<=n&&(this.indexes[t]=n+r.length);return this.markDirty(),this}insertAfter(e,t){e=this.index(e);let n,i=this.normalize(t,this.proxyOf.nodes[e]).reverse();for(let t of i)this.proxyOf.nodes.splice(e+1,0,t);for(let t in this.indexes)n=this.indexes[t],e<n&&(this.indexes[t]=n+i.length);return this.markDirty(),this}removeChild(e){let t;e=this.index(e),this.proxyOf.nodes[e].parent=void 0,this.proxyOf.nodes.splice(e,1);for(let n in this.indexes)t=this.indexes[n],t>=e&&(this.indexes[n]=t-1);return this.markDirty(),this}removeAll(){for(let e of this.proxyOf.nodes)e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}replaceValues(e,t,n){return n||(n=t,t={}),this.walkDecls((i=>{t.props&&!t.props.includes(i.prop)||t.fast&&!i.value.includes(t.fast)||(i.value=i.value.replace(e,n))})),this.markDirty(),this}every(e){return this.nodes.every(e)}some(e){return this.nodes.some(e)}index(e){return"number"==typeof e?e:(e.proxyOf&&(e=e.proxyOf),this.proxyOf.nodes.indexOf(e))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}normalize(e,t){if("string"==typeof e)e=u(i(e).nodes);else if(Array.isArray(e)){e=e.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if("root"===e.type&&"document"!==this.type){e=e.nodes.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if(e.type)e=[e];else if(e.prop){if(void 0===e.value)throw new Error("Value field is missed in node creation");"string"!=typeof e.value&&(e.value=String(e.value)),e=[new c(e)]}else if(e.selector)e=[new r(e)];else if(e.name)e=[new s(e)];else{if(!e.text)throw new Error("Unknown node type in node creation");e=[new d(e)]}return e.map((e=>(e[l]||m.rebuild(e),(e=e.proxyOf).parent&&e.parent.removeChild(e),e[a]&&p(e),void 0===e.raws.before&&t&&void 0!==t.raws.before&&(e.raws.before=t.raws.before.replace(/\S/g,"")),e.parent=this.proxyOf,e)))}getProxyProcessor(){return{set:(e,t,n)=>(e[t]===n||(e[t]=n,"name"!==t&&"params"!==t&&"selector"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:e[t]?"each"===t||"string"==typeof t&&t.startsWith("walk")?(...n)=>e[t](...n.map((e=>"function"==typeof e?(t,n)=>e(t.toProxy(),n):e))):"every"===t||"some"===t?n=>e[t](((e,...t)=>n(e.toProxy(),...t))):"root"===t?()=>e.root().toProxy():"nodes"===t?e.nodes.map((e=>e.toProxy())):"first"===t||"last"===t?e[t].toProxy():e[t]:e[t]}}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let e=this.lastEach;return this.indexes[e]=0,e}}m.registerParse=e=>{i=e},m.registerRule=e=>{r=e},m.registerAtRule=e=>{s=e},m.registerRoot=e=>{o=e},e.exports=m,m.default=m,m.rebuild=e=>{"atrule"===e.type?Object.setPrototypeOf(e,s.prototype):"rule"===e.type?Object.setPrototypeOf(e,r.prototype):"decl"===e.type?Object.setPrototypeOf(e,c.prototype):"comment"===e.type?Object.setPrototypeOf(e,d.prototype):"root"===e.type&&Object.setPrototypeOf(e,o.prototype),e[l]=!0,e.nodes&&e.nodes.forEach((e=>{m.rebuild(e)}))}},2671:(e,t,n)=>{"use strict";let i=n(4241),r=n(2868);class s extends Error{constructor(e,t,n,i,r,o){super(e),this.name="CssSyntaxError",this.reason=e,r&&(this.file=r),i&&(this.source=i),o&&(this.plugin=o),void 0!==t&&void 0!==n&&("number"==typeof t?(this.line=t,this.column=n):(this.line=t.line,this.column=t.column,this.endLine=n.line,this.endColumn=n.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,s)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",void 0!==this.line&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(e){if(!this.source)return"";let t=this.source;null==e&&(e=i.isColorSupported),r&&e&&(t=r(t));let n,s,o=t.split(/\r?\n/),a=Math.max(this.line-3,0),l=Math.min(this.line+2,o.length),c=String(l).length;if(e){let{bold:e,red:t,gray:r}=i.createColors(!0);n=n=>e(t(n)),s=e=>r(e)}else n=s=e=>e;return o.slice(a,l).map(((e,t)=>{let i=a+1+t,r=" "+(" "+i).slice(-c)+" | ";if(i===this.line){let t=s(r.replace(/\d/g," "))+e.slice(0,this.column-1).replace(/[^\t]/g," ");return n(">")+s(r)+e+"\n "+t+n("^")}return" "+s(r)+e})).join("\n")}toString(){let e=this.showSourceCode();return e&&(e="\n\n"+e+"\n"),this.name+": "+this.message+e}}e.exports=s,s.default=s},4258:(e,t,n)=>{"use strict";let i=n(5631);class r extends i{constructor(e){e&&void 0!==e.value&&"string"!=typeof e.value&&(e={...e,value:String(e.value)}),super(e),this.type="decl"}get variable(){return this.prop.startsWith("--")||"$"===this.prop[0]}}e.exports=r,r.default=r},6461:(e,t,n)=>{"use strict";let i,r,s=n(1019);class o extends s{constructor(e){super({type:"document",...e}),this.nodes||(this.nodes=[])}toResult(e={}){return new i(new r,this,e).stringify()}}o.registerLazyResult=e=>{i=e},o.registerProcessor=e=>{r=e},e.exports=o,o.default=o},250:(e,t,n)=>{"use strict";let i=n(4258),r=n(7981),s=n(9932),o=n(1353),a=n(5995),l=n(1025),c=n(1675);function d(e,t){if(Array.isArray(e))return e.map((e=>d(e)));let{inputs:n,...h}=e;if(n){t=[];for(let e of n){let n={...e,__proto__:a.prototype};n.map&&(n.map={...n.map,__proto__:r.prototype}),t.push(n)}}if(h.nodes&&(h.nodes=e.nodes.map((e=>d(e,t)))),h.source){let{inputId:e,...n}=h.source;h.source=n,null!=e&&(h.source.input=t[e])}if("root"===h.type)return new l(h);if("decl"===h.type)return new i(h);if("rule"===h.type)return new c(h);if("comment"===h.type)return new s(h);if("atrule"===h.type)return new o(h);throw new Error("Unknown node type: "+e.type)}e.exports=d,d.default=d},5995:(e,t,n)=>{"use strict";let{SourceMapConsumer:i,SourceMapGenerator:r}=n(209),{fileURLToPath:s,pathToFileURL:o}=n(7414),{resolve:a,isAbsolute:l}=n(9830),{nanoid:c}=n(2961),d=n(2868),h=n(2671),u=n(7981),p=Symbol("fromOffsetCache"),m=Boolean(i&&r),g=Boolean(a&&l);class f{constructor(e,t={}){if(null==e||"object"==typeof e&&!e.toString)throw new Error(`PostCSS received ${e} instead of CSS string`);if(this.css=e.toString(),"\ufeff"===this.css[0]||""===this.css[0]?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,t.from&&(!g||/^\w+:\/\//.test(t.from)||l(t.from)?this.file=t.from:this.file=a(t.from)),g&&m){let e=new u(this.css,t);if(e.text){this.map=e;let t=e.consumer().file;!this.file&&t&&(this.file=this.mapResolve(t))}}this.file||(this.id="<input css "+c(6)+">"),this.map&&(this.map.file=this.from)}fromOffset(e){let t,n;if(this[p])n=this[p];else{let e=this.css.split("\n");n=new Array(e.length);let t=0;for(let i=0,r=e.length;i<r;i++)n[i]=t,t+=e[i].length+1;this[p]=n}t=n[n.length-1];let i=0;if(e>=t)i=n.length-1;else{let t,r=n.length-2;for(;i<r;)if(t=i+(r-i>>1),e<n[t])r=t-1;else{if(!(e>=n[t+1])){i=t;break}i=t+1}}return{line:i+1,col:e-n[i]+1}}error(e,t,n,i={}){let r,s,a;if(t&&"object"==typeof t){let e=t,i=n;if("number"==typeof t.offset){let i=this.fromOffset(e.offset);t=i.line,n=i.col}else t=e.line,n=e.column;if("number"==typeof i.offset){let e=this.fromOffset(i.offset);s=e.line,a=e.col}else s=i.line,a=i.column}else if(!n){let e=this.fromOffset(t);t=e.line,n=e.col}let l=this.origin(t,n,s,a);return r=l?new h(e,void 0===l.endLine?l.line:{line:l.line,column:l.column},void 0===l.endLine?l.column:{line:l.endLine,column:l.endColumn},l.source,l.file,i.plugin):new h(e,void 0===s?t:{line:t,column:n},void 0===s?n:{line:s,column:a},this.css,this.file,i.plugin),r.input={line:t,column:n,endLine:s,endColumn:a,source:this.css},this.file&&(o&&(r.input.url=o(this.file).toString()),r.input.file=this.file),r}origin(e,t,n,i){if(!this.map)return!1;let r,a,c=this.map.consumer(),d=c.originalPositionFor({line:e,column:t});if(!d.source)return!1;"number"==typeof n&&(r=c.originalPositionFor({line:n,column:i})),a=l(d.source)?o(d.source):new URL(d.source,this.map.consumer().sourceRoot||o(this.map.mapFile));let h={url:a.toString(),line:d.line,column:d.column,endLine:r&&r.line,endColumn:r&&r.column};if("file:"===a.protocol){if(!s)throw new Error("file: protocol is not available in this PostCSS build");h.file=s(a)}let u=c.sourceContentFor(d.source);return u&&(h.source=u),h}mapResolve(e){return/^\w+:\/\//.test(e)?e:a(this.map.consumer().sourceRoot||this.map.root||".",e)}get from(){return this.file||this.id}toJSON(){let e={};for(let t of["hasBOM","css","file","id"])null!=this[t]&&(e[t]=this[t]);return this.map&&(e.map={...this.map},e.map.consumerCache&&(e.map.consumerCache=void 0)),e}}e.exports=f,f.default=f,d&&d.registerInput&&d.registerInput(f)},1939:(e,t,n)=>{"use strict";let{isClean:i,my:r}=n(5513),s=n(8505),o=n(7088),a=n(1019),l=n(6461),c=(n(2448),n(3632)),d=n(6939),h=n(1025);const u={document:"Document",root:"Root",atrule:"AtRule",rule:"Rule",decl:"Declaration",comment:"Comment"},p={postcssPlugin:!0,prepare:!0,Once:!0,Document:!0,Root:!0,Declaration:!0,Rule:!0,AtRule:!0,Comment:!0,DeclarationExit:!0,RuleExit:!0,AtRuleExit:!0,CommentExit:!0,RootExit:!0,DocumentExit:!0,OnceExit:!0},m={postcssPlugin:!0,prepare:!0,Once:!0};function g(e){return"object"==typeof e&&"function"==typeof e.then}function f(e){let t=!1,n=u[e.type];return"decl"===e.type?t=e.prop.toLowerCase():"atrule"===e.type&&(t=e.name.toLowerCase()),t&&e.append?[n,n+"-"+t,0,n+"Exit",n+"Exit-"+t]:t?[n,n+"-"+t,n+"Exit",n+"Exit-"+t]:e.append?[n,0,n+"Exit"]:[n,n+"Exit"]}function v(e){let t;return t="document"===e.type?["Document",0,"DocumentExit"]:"root"===e.type?["Root",0,"RootExit"]:f(e),{node:e,events:t,eventIndex:0,visitors:[],visitorIndex:0,iterator:0}}function y(e){return e[i]=!1,e.nodes&&e.nodes.forEach((e=>y(e))),e}let b={};class w{constructor(e,t,n){let i;if(this.stringified=!1,this.processed=!1,"object"!=typeof t||null===t||"root"!==t.type&&"document"!==t.type)if(t instanceof w||t instanceof c)i=y(t.root),t.map&&(void 0===n.map&&(n.map={}),n.map.inline||(n.map.inline=!1),n.map.prev=t.map);else{let e=d;n.syntax&&(e=n.syntax.parse),n.parser&&(e=n.parser),e.parse&&(e=e.parse);try{i=e(t,n)}catch(e){this.processed=!0,this.error=e}i&&!i[r]&&a.rebuild(i)}else i=y(t);this.result=new c(e,i,n),this.helpers={...b,result:this.result,postcss:b},this.plugins=this.processor.plugins.map((e=>"object"==typeof e&&e.prepare?{...e,...e.prepare(this.result)}:e))}get[Symbol.toStringTag](){return"LazyResult"}get processor(){return this.result.processor}get opts(){return this.result.opts}get css(){return this.stringify().css}get content(){return this.stringify().content}get map(){return this.stringify().map}get root(){return this.sync().root}get messages(){return this.sync().messages}warnings(){return this.sync().warnings()}toString(){return this.css}then(e,t){return this.async().then(e,t)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let e of this.plugins)if(g(this.runOnRoot(e)))throw this.getAsyncError();if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[i];)e[i]=!0,this.walkSync(e);if(this.listeners.OnceExit)if("document"===e.type)for(let t of e.nodes)this.visitSync(this.listeners.OnceExit,t);else this.visitSync(this.listeners.OnceExit,e)}return this.result}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let e=this.result.opts,t=o;e.syntax&&(t=e.syntax.stringify),e.stringifier&&(t=e.stringifier),t.stringify&&(t=t.stringify);let n=new s(t,this.result.root,this.result.opts).generate();return this.result.css=n[0],this.result.map=n[1],this.result}walkSync(e){e[i]=!0;let t=f(e);for(let n of t)if(0===n)e.nodes&&e.each((e=>{e[i]||this.walkSync(e)}));else{let t=this.listeners[n];if(t&&this.visitSync(t,e.toProxy()))return}}visitSync(e,t){for(let[n,i]of e){let e;this.result.lastPlugin=n;try{e=i(t,this.helpers)}catch(e){throw this.handleError(e,t.proxyOf)}if("root"!==t.type&&"document"!==t.type&&!t.parent)return!0;if(g(e))throw this.getAsyncError()}}runOnRoot(e){this.result.lastPlugin=e;try{if("object"==typeof e&&e.Once){if("document"===this.result.root.type){let t=this.result.root.nodes.map((t=>e.Once(t,this.helpers)));return g(t[0])?Promise.all(t):t}return e.Once(this.result.root,this.helpers)}if("function"==typeof e)return e(this.result.root,this.result)}catch(e){throw this.handleError(e)}}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(e,t){let n=this.result.lastPlugin;try{t&&t.addToError(e),this.error=e,"CssSyntaxError"!==e.name||e.plugin?n.postcssVersion:(e.plugin=n.postcssPlugin,e.setMessage())}catch(e){console&&console.error&&console.error(e)}return e}async runAsync(){this.plugin=0;for(let e=0;e<this.plugins.length;e++){let t=this.plugins[e],n=this.runOnRoot(t);if(g(n))try{await n}catch(e){throw this.handleError(e)}}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[i];){e[i]=!0;let t=[v(e)];for(;t.length>0;){let e=this.visitTick(t);if(g(e))try{await e}catch(e){let n=t[t.length-1].node;throw this.handleError(e,n)}}}if(this.listeners.OnceExit)for(let[t,n]of this.listeners.OnceExit){this.result.lastPlugin=t;try{if("document"===e.type){let t=e.nodes.map((e=>n(e,this.helpers)));await Promise.all(t)}else await n(e,this.helpers)}catch(e){throw this.handleError(e)}}}return this.processed=!0,this.stringify()}prepareVisitors(){this.listeners={};let e=(e,t,n)=>{this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push([e,n])};for(let t of this.plugins)if("object"==typeof t)for(let n in t){if(!p[n]&&/^[A-Z]/.test(n))throw new Error(`Unknown event ${n} in ${t.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!m[n])if("object"==typeof t[n])for(let i in t[n])e(t,"*"===i?n:n+"-"+i.toLowerCase(),t[n][i]);else"function"==typeof t[n]&&e(t,n,t[n])}this.hasListener=Object.keys(this.listeners).length>0}visitTick(e){let t=e[e.length-1],{node:n,visitors:r}=t;if("root"!==n.type&&"document"!==n.type&&!n.parent)return void e.pop();if(r.length>0&&t.visitorIndex<r.length){let[e,i]=r[t.visitorIndex];t.visitorIndex+=1,t.visitorIndex===r.length&&(t.visitors=[],t.visitorIndex=0),this.result.lastPlugin=e;try{return i(n.toProxy(),this.helpers)}catch(e){throw this.handleError(e,n)}}if(0!==t.iterator){let r,s=t.iterator;for(;r=n.nodes[n.indexes[s]];)if(n.indexes[s]+=1,!r[i])return r[i]=!0,void e.push(v(r));t.iterator=0,delete n.indexes[s]}let s=t.events;for(;t.eventIndex<s.length;){let e=s[t.eventIndex];if(t.eventIndex+=1,0===e)return void(n.nodes&&n.nodes.length&&(n[i]=!0,t.iterator=n.getIterator()));if(this.listeners[e])return void(t.visitors=this.listeners[e])}e.pop()}}w.registerPostcss=e=>{b=e},e.exports=w,w.default=w,h.registerLazyResult(w),l.registerLazyResult(w)},4715:e=>{"use strict";let t={split(e,t,n){let i=[],r="",s=!1,o=0,a=!1,l="",c=!1;for(let n of e)c?c=!1:"\\"===n?c=!0:a?n===l&&(a=!1):'"'===n||"'"===n?(a=!0,l=n):"("===n?o+=1:")"===n?o>0&&(o-=1):0===o&&t.includes(n)&&(s=!0),s?(""!==r&&i.push(r.trim()),r="",s=!1):r+=n;return(n||""!==r)&&i.push(r.trim()),i},space:e=>t.split(e,[" ","\n","\t"]),comma:e=>t.split(e,[","],!0)};e.exports=t,t.default=t},8505:(e,t,n)=>{"use strict";let{SourceMapConsumer:i,SourceMapGenerator:r}=n(209),{dirname:s,resolve:o,relative:a,sep:l}=n(9830),{pathToFileURL:c}=n(7414),d=n(5995),h=Boolean(i&&r),u=Boolean(s&&o&&a&&l);e.exports=class{constructor(e,t,n,i){this.stringify=e,this.mapOpts=n.map||{},this.root=t,this.opts=n,this.css=i}isMap(){return void 0!==this.opts.map?!!this.opts.map:this.previous().length>0}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk((e=>{if(e.source&&e.source.input.map){let t=e.source.input.map;this.previousMaps.includes(t)||this.previousMaps.push(t)}}));else{let e=new d(this.css,this.opts);e.map&&this.previousMaps.push(e.map)}return this.previousMaps}isInline(){if(void 0!==this.mapOpts.inline)return this.mapOpts.inline;let e=this.mapOpts.annotation;return(void 0===e||!0===e)&&(!this.previous().length||this.previous().some((e=>e.inline)))}isSourcesContent(){return void 0!==this.mapOpts.sourcesContent?this.mapOpts.sourcesContent:!this.previous().length||this.previous().some((e=>e.withContent()))}clearAnnotation(){if(!1!==this.mapOpts.annotation)if(this.root){let e;for(let t=this.root.nodes.length-1;t>=0;t--)e=this.root.nodes[t],"comment"===e.type&&0===e.text.indexOf("# sourceMappingURL=")&&this.root.removeChild(t)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}setSourcesContent(){let e={};if(this.root)this.root.walk((t=>{if(t.source){let n=t.source.input.from;n&&!e[n]&&(e[n]=!0,this.map.setSourceContent(this.toUrl(this.path(n)),t.source.input.css))}}));else if(this.css){let e=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(e,this.css)}}applyPrevMaps(){for(let e of this.previous()){let t,n=this.toUrl(this.path(e.file)),r=e.root||s(e.file);!1===this.mapOpts.sourcesContent?(t=new i(e.text),t.sourcesContent&&(t.sourcesContent=t.sourcesContent.map((()=>null)))):t=e.consumer(),this.map.applySourceMap(t,n,this.toUrl(this.path(r)))}}isAnnotation(){return!!this.isInline()||(void 0!==this.mapOpts.annotation?this.mapOpts.annotation:!this.previous().length||this.previous().some((e=>e.annotation)))}toBase64(e){return Buffer?Buffer.from(e).toString("base64"):window.btoa(unescape(encodeURIComponent(e)))}addAnnotation(){let e;e=this.isInline()?"data:application/json;base64,"+this.toBase64(this.map.toString()):"string"==typeof this.mapOpts.annotation?this.mapOpts.annotation:"function"==typeof this.mapOpts.annotation?this.mapOpts.annotation(this.opts.to,this.root):this.outputFile()+".map";let t="\n";this.css.includes("\r\n")&&(t="\r\n"),this.css+=t+"/*# sourceMappingURL="+e+" */"}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}generateMap(){if(this.root)this.generateString();else if(1===this.previous().length){let e=this.previous()[0].consumer();e.file=this.outputFile(),this.map=r.fromSourceMap(e)}else this.map=new r({file:this.outputFile()}),this.map.addMapping({source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>",generated:{line:1,column:0},original:{line:1,column:0}});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}path(e){if(0===e.indexOf("<"))return e;if(/^\w+:\/\//.test(e))return e;if(this.mapOpts.absolute)return e;let t=this.opts.to?s(this.opts.to):".";return"string"==typeof this.mapOpts.annotation&&(t=s(o(t,this.mapOpts.annotation))),a(t,e)}toUrl(e){return"\\"===l&&(e=e.replace(/\\/g,"/")),encodeURI(e).replace(/[#?]/g,encodeURIComponent)}sourcePath(e){if(this.mapOpts.from)return this.toUrl(this.mapOpts.from);if(this.mapOpts.absolute){if(c)return c(e.source.input.from).toString();throw new Error("`map.absolute` option is not available in this PostCSS build")}return this.toUrl(this.path(e.source.input.from))}generateString(){this.css="",this.map=new r({file:this.outputFile()});let e,t,n=1,i=1,s="<no source>",o={source:"",generated:{line:0,column:0},original:{line:0,column:0}};this.stringify(this.root,((r,a,l)=>{if(this.css+=r,a&&"end"!==l&&(o.generated.line=n,o.generated.column=i-1,a.source&&a.source.start?(o.source=this.sourcePath(a),o.original.line=a.source.start.line,o.original.column=a.source.start.column-1,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,this.map.addMapping(o))),e=r.match(/\n/g),e?(n+=e.length,t=r.lastIndexOf("\n"),i=r.length-t):i+=r.length,a&&"start"!==l){let e=a.parent||{raws:{}};("decl"!==a.type||a!==e.last||e.raws.semicolon)&&(a.source&&a.source.end?(o.source=this.sourcePath(a),o.original.line=a.source.end.line,o.original.column=a.source.end.column-1,o.generated.line=n,o.generated.column=i-2,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,o.generated.line=n,o.generated.column=i-1,this.map.addMapping(o)))}}))}generate(){if(this.clearAnnotation(),u&&h&&this.isMap())return this.generateMap();{let e="";return this.stringify(this.root,(t=>{e+=t})),[e]}}}},7647:(e,t,n)=>{"use strict";let i=n(8505),r=n(7088),s=(n(2448),n(6939));const o=n(3632);class a{constructor(e,t,n){let s;t=t.toString(),this.stringified=!1,this._processor=e,this._css=t,this._opts=n,this._map=void 0;let a=r;this.result=new o(this._processor,s,this._opts),this.result.css=t;let l=this;Object.defineProperty(this.result,"root",{get:()=>l.root});let c=new i(a,s,this._opts,t);if(c.isMap()){let[e,t]=c.generate();e&&(this.result.css=e),t&&(this.result.map=t)}}get[Symbol.toStringTag](){return"NoWorkResult"}get processor(){return this.result.processor}get opts(){return this.result.opts}get css(){return this.result.css}get content(){return this.result.css}get map(){return this.result.map}get root(){if(this._root)return this._root;let e,t=s;try{e=t(this._css,this._opts)}catch(e){this.error=e}if(this.error)throw this.error;return this._root=e,e}get messages(){return[]}warnings(){return[]}toString(){return this._css}then(e,t){return this.async().then(e,t)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}sync(){if(this.error)throw this.error;return this.result}}e.exports=a,a.default=a},5631:(e,t,n)=>{"use strict";let{isClean:i,my:r}=n(5513),s=n(2671),o=n(1062),a=n(7088);function l(e,t){let n=new e.constructor;for(let i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;if("proxyCache"===i)continue;let r=e[i],s=typeof r;"parent"===i&&"object"===s?t&&(n[i]=t):"source"===i?n[i]=r:Array.isArray(r)?n[i]=r.map((e=>l(e,n))):("object"===s&&null!==r&&(r=l(r)),n[i]=r)}return n}class c{constructor(e={}){this.raws={},this[i]=!1,this[r]=!0;for(let t in e)if("nodes"===t){this.nodes=[];for(let n of e[t])"function"==typeof n.clone?this.append(n.clone()):this.append(n)}else this[t]=e[t]}error(e,t={}){if(this.source){let{start:n,end:i}=this.rangeBy(t);return this.source.input.error(e,{line:n.line,column:n.column},{line:i.line,column:i.column},t)}return new s(e)}warn(e,t,n){let i={node:this};for(let e in n)i[e]=n[e];return e.warn(t,i)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}toString(e=a){e.stringify&&(e=e.stringify);let t="";return e(this,(e=>{t+=e})),t}assign(e={}){for(let t in e)this[t]=e[t];return this}clone(e={}){let t=l(this);for(let n in e)t[n]=e[n];return t}cloneBefore(e={}){let t=this.clone(e);return this.parent.insertBefore(this,t),t}cloneAfter(e={}){let t=this.clone(e);return this.parent.insertAfter(this,t),t}replaceWith(...e){if(this.parent){let t=this,n=!1;for(let i of e)i===this?n=!0:n?(this.parent.insertAfter(t,i),t=i):this.parent.insertBefore(t,i);n||this.remove()}return this}next(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e+1]}prev(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e-1]}before(e){return this.parent.insertBefore(this,e),this}after(e){return this.parent.insertAfter(this,e),this}root(){let e=this;for(;e.parent&&"document"!==e.parent.type;)e=e.parent;return e}raw(e,t){return(new o).raw(this,e,t)}cleanRaws(e){delete this.raws.before,delete this.raws.after,e||delete this.raws.between}toJSON(e,t){let n={},i=null==t;t=t||new Map;let r=0;for(let e in this){if(!Object.prototype.hasOwnProperty.call(this,e))continue;if("parent"===e||"proxyCache"===e)continue;let i=this[e];if(Array.isArray(i))n[e]=i.map((e=>"object"==typeof e&&e.toJSON?e.toJSON(null,t):e));else if("object"==typeof i&&i.toJSON)n[e]=i.toJSON(null,t);else if("source"===e){let s=t.get(i.input);null==s&&(s=r,t.set(i.input,r),r++),n[e]={inputId:s,start:i.start,end:i.end}}else n[e]=i}return i&&(n.inputs=[...t.keys()].map((e=>e.toJSON()))),n}positionInside(e){let t=this.toString(),n=this.source.start.column,i=this.source.start.line;for(let r=0;r<e;r++)"\n"===t[r]?(n=1,i+=1):n+=1;return{line:i,column:n}}positionBy(e){let t=this.source.start;if(e.index)t=this.positionInside(e.index);else if(e.word){let n=this.toString().indexOf(e.word);-1!==n&&(t=this.positionInside(n))}return t}rangeBy(e){let t={line:this.source.start.line,column:this.source.start.column},n=this.source.end?{line:this.source.end.line,column:this.source.end.column+1}:{line:t.line,column:t.column+1};if(e.word){let i=this.toString().indexOf(e.word);-1!==i&&(t=this.positionInside(i),n=this.positionInside(i+e.word.length))}else e.start?t={line:e.start.line,column:e.start.column}:e.index&&(t=this.positionInside(e.index)),e.end?n={line:e.end.line,column:e.end.column}:e.endIndex?n=this.positionInside(e.endIndex):e.index&&(n=this.positionInside(e.index+1));return(n.line<t.line||n.line===t.line&&n.column<=t.column)&&(n={line:t.line,column:t.column+1}),{start:t,end:n}}getProxyProcessor(){return{set:(e,t,n)=>(e[t]===n||(e[t]=n,"prop"!==t&&"value"!==t&&"name"!==t&&"params"!==t&&"important"!==t&&"text"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:"root"===t?()=>e.root().toProxy():e[t]}}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}addToError(e){if(e.postcssNode=this,e.stack&&this.source&&/\n\s{4}at /.test(e.stack)){let t=this.source;e.stack=e.stack.replace(/\n\s{4}at /,`$&${t.input.from}:${t.start.line}:${t.start.column}$&`)}return e}markDirty(){if(this[i]){this[i]=!1;let e=this;for(;e=e.parent;)e[i]=!1}}get proxyOf(){return this}}e.exports=c,c.default=c},6939:(e,t,n)=>{"use strict";let i=n(1019),r=n(8867),s=n(5995);function o(e,t){let n=new s(e,t),i=new r(n);try{i.parse()}catch(e){throw e}return i.root}e.exports=o,o.default=o,i.registerParse(o)},8867:(e,t,n)=>{"use strict";let i=n(4258),r=n(3852),s=n(9932),o=n(1353),a=n(1025),l=n(1675);const c={empty:!0,space:!0};e.exports=class{constructor(e){this.input=e,this.root=new a,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:e,start:{offset:0,line:1,column:1}}}createTokenizer(){this.tokenizer=r(this.input)}parse(){let e;for(;!this.tokenizer.endOfFile();)switch(e=this.tokenizer.nextToken(),e[0]){case"space":this.spaces+=e[1];break;case";":this.freeSemicolon(e);break;case"}":this.end(e);break;case"comment":this.comment(e);break;case"at-word":this.atrule(e);break;case"{":this.emptyRule(e);break;default:this.other(e)}this.endFile()}comment(e){let t=new s;this.init(t,e[2]),t.source.end=this.getPosition(e[3]||e[2]);let n=e[1].slice(2,-2);if(/^\s*$/.test(n))t.text="",t.raws.left=n,t.raws.right="";else{let e=n.match(/^(\s*)([^]*\S)(\s*)$/);t.text=e[2],t.raws.left=e[1],t.raws.right=e[3]}}emptyRule(e){let t=new l;this.init(t,e[2]),t.selector="",t.raws.between="",this.current=t}other(e){let t=!1,n=null,i=!1,r=null,s=[],o=e[1].startsWith("--"),a=[],l=e;for(;l;){if(n=l[0],a.push(l),"("===n||"["===n)r||(r=l),s.push("("===n?")":"]");else if(o&&i&&"{"===n)r||(r=l),s.push("}");else if(0===s.length){if(";"===n){if(i)return void this.decl(a,o);break}if("{"===n)return void this.rule(a);if("}"===n){this.tokenizer.back(a.pop()),t=!0;break}":"===n&&(i=!0)}else n===s[s.length-1]&&(s.pop(),0===s.length&&(r=null));l=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(t=!0),s.length>0&&this.unclosedBracket(r),t&&i){if(!o)for(;a.length&&(l=a[a.length-1][0],"space"===l||"comment"===l);)this.tokenizer.back(a.pop());this.decl(a,o)}else this.unknownWord(a)}rule(e){e.pop();let t=new l;this.init(t,e[0][2]),t.raws.between=this.spacesAndCommentsFromEnd(e),this.raw(t,"selector",e),this.current=t}decl(e,t){let n=new i;this.init(n,e[0][2]);let r,s=e[e.length-1];for(";"===s[0]&&(this.semicolon=!0,e.pop()),n.source.end=this.getPosition(s[3]||s[2]||function(e){for(let t=e.length-1;t>=0;t--){let n=e[t],i=n[3]||n[2];if(i)return i}}(e));"word"!==e[0][0];)1===e.length&&this.unknownWord(e),n.raws.before+=e.shift()[1];for(n.source.start=this.getPosition(e[0][2]),n.prop="";e.length;){let t=e[0][0];if(":"===t||"space"===t||"comment"===t)break;n.prop+=e.shift()[1]}for(n.raws.between="";e.length;){if(r=e.shift(),":"===r[0]){n.raws.between+=r[1];break}"word"===r[0]&&/\w/.test(r[1])&&this.unknownWord([r]),n.raws.between+=r[1]}"_"!==n.prop[0]&&"*"!==n.prop[0]||(n.raws.before+=n.prop[0],n.prop=n.prop.slice(1));let o,a=[];for(;e.length&&(o=e[0][0],"space"===o||"comment"===o);)a.push(e.shift());this.precheckMissedSemicolon(e);for(let t=e.length-1;t>=0;t--){if(r=e[t],"!important"===r[1].toLowerCase()){n.important=!0;let i=this.stringFrom(e,t);i=this.spacesFromEnd(e)+i," !important"!==i&&(n.raws.important=i);break}if("important"===r[1].toLowerCase()){let i=e.slice(0),r="";for(let e=t;e>0;e--){let t=i[e][0];if(0===r.trim().indexOf("!")&&"space"!==t)break;r=i.pop()[1]+r}0===r.trim().indexOf("!")&&(n.important=!0,n.raws.important=r,e=i)}if("space"!==r[0]&&"comment"!==r[0])break}e.some((e=>"space"!==e[0]&&"comment"!==e[0]))&&(n.raws.between+=a.map((e=>e[1])).join(""),a=[]),this.raw(n,"value",a.concat(e),t),n.value.includes(":")&&!t&&this.checkMissedSemicolon(e)}atrule(e){let t,n,i,r=new o;r.name=e[1].slice(1),""===r.name&&this.unnamedAtrule(r,e),this.init(r,e[2]);let s=!1,a=!1,l=[],c=[];for(;!this.tokenizer.endOfFile();){if(t=(e=this.tokenizer.nextToken())[0],"("===t||"["===t?c.push("("===t?")":"]"):"{"===t&&c.length>0?c.push("}"):t===c[c.length-1]&&c.pop(),0===c.length){if(";"===t){r.source.end=this.getPosition(e[2]),this.semicolon=!0;break}if("{"===t){a=!0;break}if("}"===t){if(l.length>0){for(i=l.length-1,n=l[i];n&&"space"===n[0];)n=l[--i];n&&(r.source.end=this.getPosition(n[3]||n[2]))}this.end(e);break}l.push(e)}else l.push(e);if(this.tokenizer.endOfFile()){s=!0;break}}r.raws.between=this.spacesAndCommentsFromEnd(l),l.length?(r.raws.afterName=this.spacesAndCommentsFromStart(l),this.raw(r,"params",l),s&&(e=l[l.length-1],r.source.end=this.getPosition(e[3]||e[2]),this.spaces=r.raws.between,r.raws.between="")):(r.raws.afterName="",r.params=""),a&&(r.nodes=[],this.current=r)}end(e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(e[2]),this.current=this.current.parent):this.unexpectedClose(e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces}freeSemicolon(e){if(this.spaces+=e[1],this.current.nodes){let e=this.current.nodes[this.current.nodes.length-1];e&&"rule"===e.type&&!e.raws.ownSemicolon&&(e.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(e){let t=this.input.fromOffset(e);return{offset:e,line:t.line,column:t.col}}init(e,t){this.current.push(e),e.source={start:this.getPosition(t),input:this.input},e.raws.before=this.spaces,this.spaces="","comment"!==e.type&&(this.semicolon=!1)}raw(e,t,n,i){let r,s,o,a,l=n.length,d="",h=!0;for(let e=0;e<l;e+=1)r=n[e],s=r[0],"space"!==s||e!==l-1||i?"comment"===s?(a=n[e-1]?n[e-1][0]:"empty",o=n[e+1]?n[e+1][0]:"empty",c[a]||c[o]||","===d.slice(-1)?h=!1:d+=r[1]):d+=r[1]:h=!1;if(!h){let i=n.reduce(((e,t)=>e+t[1]),"");e.raws[t]={value:d,raw:i}}e[t]=d}spacesAndCommentsFromEnd(e){let t,n="";for(;e.length&&(t=e[e.length-1][0],"space"===t||"comment"===t);)n=e.pop()[1]+n;return n}spacesAndCommentsFromStart(e){let t,n="";for(;e.length&&(t=e[0][0],"space"===t||"comment"===t);)n+=e.shift()[1];return n}spacesFromEnd(e){let t,n="";for(;e.length&&(t=e[e.length-1][0],"space"===t);)n=e.pop()[1]+n;return n}stringFrom(e,t){let n="";for(let i=t;i<e.length;i++)n+=e[i][1];return e.splice(t,e.length-t),n}colon(e){let t,n,i,r=0;for(let[s,o]of e.entries()){if(t=o,n=t[0],"("===n&&(r+=1),")"===n&&(r-=1),0===r&&":"===n){if(i){if("word"===i[0]&&"progid"===i[1])continue;return s}this.doubleColon(t)}i=t}return!1}unclosedBracket(e){throw this.input.error("Unclosed bracket",{offset:e[2]},{offset:e[2]+1})}unknownWord(e){throw this.input.error("Unknown word",{offset:e[0][2]},{offset:e[0][2]+e[0][1].length})}unexpectedClose(e){throw this.input.error("Unexpected }",{offset:e[2]},{offset:e[2]+1})}unclosedBlock(){let e=this.current.source.start;throw this.input.error("Unclosed block",e.line,e.column)}doubleColon(e){throw this.input.error("Double colon",{offset:e[2]},{offset:e[2]+e[1].length})}unnamedAtrule(e,t){throw this.input.error("At-rule without name",{offset:t[2]},{offset:t[2]+t[1].length})}precheckMissedSemicolon(){}checkMissedSemicolon(e){let t=this.colon(e);if(!1===t)return;let n,i=0;for(let r=t-1;r>=0&&(n=e[r],"space"===n[0]||(i+=1,2!==i));r--);throw this.input.error("Missed semicolon","word"===n[0]?n[3]+1:n[2])}}},20:(e,t,n)=>{"use strict";let i=n(2671),r=n(4258),s=n(1939),o=n(1019),a=n(1723),l=n(7088),c=n(250),d=n(6461),h=n(1728),u=n(9932),p=n(1353),m=n(3632),g=n(5995),f=n(6939),v=n(4715),y=n(1675),b=n(1025),w=n(5631);function S(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),new a(e)}S.plugin=function(e,t){let n,i=!1;function r(...n){console&&console.warn&&!i&&(i=!0,console.warn(e+": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration"),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(e+":  postcss.plugin . :\nhttps://www.w3ctech.com/topic/2226"));let r=t(...n);return r.postcssPlugin=e,r.postcssVersion=(new a).version,r}return Object.defineProperty(r,"postcss",{get:()=>(n||(n=r()),n)}),r.process=function(e,t,n){return S([r(n)]).process(e,t)},r},S.stringify=l,S.parse=f,S.fromJSON=c,S.list=v,S.comment=e=>new u(e),S.atRule=e=>new p(e),S.decl=e=>new r(e),S.rule=e=>new y(e),S.root=e=>new b(e),S.document=e=>new d(e),S.CssSyntaxError=i,S.Declaration=r,S.Container=o,S.Processor=a,S.Document=d,S.Comment=u,S.Warning=h,S.AtRule=p,S.Result=m,S.Input=g,S.Rule=y,S.Root=b,S.Node=w,s.registerPostcss(S),e.exports=S,S.default=S},7981:(e,t,n)=>{"use strict";let{SourceMapConsumer:i,SourceMapGenerator:r}=n(209),{existsSync:s,readFileSync:o}=n(4777),{dirname:a,join:l}=n(9830);class c{constructor(e,t){if(!1===t.map)return;this.loadAnnotation(e),this.inline=this.startWith(this.annotation,"data:");let n=t.map?t.map.prev:void 0,i=this.loadMap(t.from,n);!this.mapFile&&t.from&&(this.mapFile=t.from),this.mapFile&&(this.root=a(this.mapFile)),i&&(this.text=i)}consumer(){return this.consumerCache||(this.consumerCache=new i(this.text)),this.consumerCache}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}startWith(e,t){return!!e&&e.substr(0,t.length)===t}getAnnotationURL(e){return e.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}loadAnnotation(e){let t=e.match(/\/\*\s*# sourceMappingURL=/gm);if(!t)return;let n=e.lastIndexOf(t.pop()),i=e.indexOf("*/",n);n>-1&&i>-1&&(this.annotation=this.getAnnotationURL(e.substring(n,i)))}decodeInline(e){if(/^data:application\/json;charset=utf-?8,/.test(e)||/^data:application\/json,/.test(e))return decodeURIComponent(e.substr(RegExp.lastMatch.length));if(/^data:application\/json;charset=utf-?8;base64,/.test(e)||/^data:application\/json;base64,/.test(e))return t=e.substr(RegExp.lastMatch.length),Buffer?Buffer.from(t,"base64").toString():window.atob(t);var t;let n=e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+n)}loadFile(e){if(this.root=a(e),s(e))return this.mapFile=e,o(e,"utf-8").toString().trim()}loadMap(e,t){if(!1===t)return!1;if(t){if("string"==typeof t)return t;if("function"!=typeof t){if(t instanceof i)return r.fromSourceMap(t).toString();if(t instanceof r)return t.toString();if(this.isMap(t))return JSON.stringify(t);throw new Error("Unsupported previous source map format: "+t.toString())}{let n=t(e);if(n){let e=this.loadFile(n);if(!e)throw new Error("Unable to load previous source map: "+n.toString());return e}}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let t=this.annotation;return e&&(t=l(a(e),t)),this.loadFile(t)}}}isMap(e){return"object"==typeof e&&("string"==typeof e.mappings||"string"==typeof e._mappings||Array.isArray(e.sections))}}e.exports=c,c.default=c},1723:(e,t,n)=>{"use strict";let i=n(7647),r=n(1939),s=n(6461),o=n(1025);class a{constructor(e=[]){this.version="8.4.16",this.plugins=this.normalize(e)}use(e){return this.plugins=this.plugins.concat(this.normalize([e])),this}process(e,t={}){return 0===this.plugins.length&&void 0===t.parser&&void 0===t.stringifier&&void 0===t.syntax?new i(this,e,t):new r(this,e,t)}normalize(e){let t=[];for(let n of e)if(!0===n.postcss?n=n():n.postcss&&(n=n.postcss),"object"==typeof n&&Array.isArray(n.plugins))t=t.concat(n.plugins);else if("object"==typeof n&&n.postcssPlugin)t.push(n);else if("function"==typeof n)t.push(n);else if("object"!=typeof n||!n.parse&&!n.stringify)throw new Error(n+" is not a PostCSS plugin");return t}}e.exports=a,a.default=a,o.registerProcessor(a),s.registerProcessor(a)},3632:(e,t,n)=>{"use strict";let i=n(1728);class r{constructor(e,t,n){this.processor=e,this.messages=[],this.root=t,this.opts=n,this.css=void 0,this.map=void 0}toString(){return this.css}warn(e,t={}){t.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(t.plugin=this.lastPlugin.postcssPlugin);let n=new i(e,t);return this.messages.push(n),n}warnings(){return this.messages.filter((e=>"warning"===e.type))}get content(){return this.css}}e.exports=r,r.default=r},1025:(e,t,n)=>{"use strict";let i,r,s=n(1019);class o extends s{constructor(e){super(e),this.type="root",this.nodes||(this.nodes=[])}removeChild(e,t){let n=this.index(e);return!t&&0===n&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[n].raws.before),super.removeChild(e)}normalize(e,t,n){let i=super.normalize(e);if(t)if("prepend"===n)this.nodes.length>1?t.raws.before=this.nodes[1].raws.before:delete t.raws.before;else if(this.first!==t)for(let e of i)e.raws.before=t.raws.before;return i}toResult(e={}){return new i(new r,this,e).stringify()}}o.registerLazyResult=e=>{i=e},o.registerProcessor=e=>{r=e},e.exports=o,o.default=o,s.registerRoot(o)},1675:(e,t,n)=>{"use strict";let i=n(1019),r=n(4715);class s extends i{constructor(e){super(e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return r.comma(this.selector)}set selectors(e){let t=this.selector?this.selector.match(/,\s*/):null,n=t?t[0]:","+this.raw("between","beforeOpen");this.selector=e.join(n)}}e.exports=s,s.default=s,i.registerRule(s)},1062:e=>{"use strict";const t={colon:": ",indent:"    ",beforeDecl:"\n",beforeRule:"\n",beforeOpen:" ",beforeClose:"\n",beforeComment:"\n",after:"\n",emptyBody:"",commentLeft:" ",commentRight:" ",semicolon:!1};class n{constructor(e){this.builder=e}stringify(e,t){if(!this[e.type])throw new Error("Unknown AST node type "+e.type+". Maybe you need to change PostCSS stringifier.");this[e.type](e,t)}document(e){this.body(e)}root(e){this.body(e),e.raws.after&&this.builder(e.raws.after)}comment(e){let t=this.raw(e,"left","commentLeft"),n=this.raw(e,"right","commentRight");this.builder("/*"+t+e.text+n+"*/",e)}decl(e,t){let n=this.raw(e,"between","colon"),i=e.prop+n+this.rawValue(e,"value");e.important&&(i+=e.raws.important||" !important"),t&&(i+=";"),this.builder(i,e)}rule(e){this.block(e,this.rawValue(e,"selector")),e.raws.ownSemicolon&&this.builder(e.raws.ownSemicolon,e,"end")}atrule(e,t){let n="@"+e.name,i=e.params?this.rawValue(e,"params"):"";if(void 0!==e.raws.afterName?n+=e.raws.afterName:i&&(n+=" "),e.nodes)this.block(e,n+i);else{let r=(e.raws.between||"")+(t?";":"");this.builder(n+i+r,e)}}body(e){let t=e.nodes.length-1;for(;t>0&&"comment"===e.nodes[t].type;)t-=1;let n=this.raw(e,"semicolon");for(let i=0;i<e.nodes.length;i++){let r=e.nodes[i],s=this.raw(r,"before");s&&this.builder(s),this.stringify(r,t!==i||n)}}block(e,t){let n,i=this.raw(e,"between","beforeOpen");this.builder(t+i+"{",e,"start"),e.nodes&&e.nodes.length?(this.body(e),n=this.raw(e,"after")):n=this.raw(e,"after","emptyBody"),n&&this.builder(n),this.builder("}",e,"end")}raw(e,n,i){let r;if(i||(i=n),n&&(r=e.raws[n],void 0!==r))return r;let s=e.parent;if("before"===i){if(!s||"root"===s.type&&s.first===e)return"";if(s&&"document"===s.type)return""}if(!s)return t[i];let o=e.root();if(o.rawCache||(o.rawCache={}),void 0!==o.rawCache[i])return o.rawCache[i];if("before"===i||"after"===i)return this.beforeAfter(e,i);{let t="raw"+((a=i)[0].toUpperCase()+a.slice(1));this[t]?r=this[t](o,e):o.walk((e=>{if(r=e.raws[n],void 0!==r)return!1}))}var a;return void 0===r&&(r=t[i]),o.rawCache[i]=r,r}rawSemicolon(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length&&"decl"===e.last.type&&(t=e.raws.semicolon,void 0!==t))return!1})),t}rawEmptyBody(e){let t;return e.walk((e=>{if(e.nodes&&0===e.nodes.length&&(t=e.raws.after,void 0!==t))return!1})),t}rawIndent(e){if(e.raws.indent)return e.raws.indent;let t;return e.walk((n=>{let i=n.parent;if(i&&i!==e&&i.parent&&i.parent===e&&void 0!==n.raws.before){let e=n.raws.before.split("\n");return t=e[e.length-1],t=t.replace(/\S/g,""),!1}})),t}rawBeforeComment(e,t){let n;return e.walkComments((e=>{if(void 0!==e.raws.before)return n=e.raws.before,n.includes("\n")&&(n=n.replace(/[^\n]+$/,"")),!1})),void 0===n?n=this.raw(t,null,"beforeDecl"):n&&(n=n.replace(/\S/g,"")),n}rawBeforeDecl(e,t){let n;return e.walkDecls((e=>{if(void 0!==e.raws.before)return n=e.raws.before,n.includes("\n")&&(n=n.replace(/[^\n]+$/,"")),!1})),void 0===n?n=this.raw(t,null,"beforeRule"):n&&(n=n.replace(/\S/g,"")),n}rawBeforeRule(e){let t;return e.walk((n=>{if(n.nodes&&(n.parent!==e||e.first!==n)&&void 0!==n.raws.before)return t=n.raws.before,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeClose(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length>0&&void 0!==e.raws.after)return t=e.raws.after,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeOpen(e){let t;return e.walk((e=>{if("decl"!==e.type&&(t=e.raws.between,void 0!==t))return!1})),t}rawColon(e){let t;return e.walkDecls((e=>{if(void 0!==e.raws.between)return t=e.raws.between.replace(/[^\s:]/g,""),!1})),t}beforeAfter(e,t){let n;n="decl"===e.type?this.raw(e,null,"beforeDecl"):"comment"===e.type?this.raw(e,null,"beforeComment"):"before"===t?this.raw(e,null,"beforeRule"):this.raw(e,null,"beforeClose");let i=e.parent,r=0;for(;i&&"root"!==i.type;)r+=1,i=i.parent;if(n.includes("\n")){let t=this.raw(e,null,"indent");if(t.length)for(let e=0;e<r;e++)n+=t}return n}rawValue(e,t){let n=e[t],i=e.raws[t];return i&&i.value===n?i.raw:n}}e.exports=n,n.default=n},7088:(e,t,n)=>{"use strict";let i=n(1062);function r(e,t){new i(t).stringify(e)}e.exports=r,r.default=r},5513:e=>{"use strict";e.exports.isClean=Symbol("isClean"),e.exports.my=Symbol("my")},3852:e=>{"use strict";const t="'".charCodeAt(0),n='"'.charCodeAt(0),i="\\".charCodeAt(0),r="/".charCodeAt(0),s="\n".charCodeAt(0),o=" ".charCodeAt(0),a="\f".charCodeAt(0),l="\t".charCodeAt(0),c="\r".charCodeAt(0),d="[".charCodeAt(0),h="]".charCodeAt(0),u="(".charCodeAt(0),p=")".charCodeAt(0),m="{".charCodeAt(0),g="}".charCodeAt(0),f=";".charCodeAt(0),v="*".charCodeAt(0),y=":".charCodeAt(0),b="@".charCodeAt(0),w=/[\t\n\f\r "#'()/;[\\\]{}]/g,S=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,_=/.[\n"'(/\\]/,E=/[\da-f]/i;e.exports=function(e,k={}){let x,T,C,A,I,R,P,O,M,D,L=e.css.valueOf(),F=k.ignoreErrors,N=L.length,j=0,B=[],U=[];function q(t){throw e.error("Unclosed "+t,j)}return{back:function(e){U.push(e)},nextToken:function(e){if(U.length)return U.pop();if(j>=N)return;let k=!!e&&e.ignoreUnclosed;switch(x=L.charCodeAt(j),x){case s:case o:case l:case c:case a:T=j;do{T+=1,x=L.charCodeAt(T)}while(x===o||x===s||x===l||x===c||x===a);D=["space",L.slice(j,T)],j=T-1;break;case d:case h:case m:case g:case y:case f:case p:{let e=String.fromCharCode(x);D=[e,e,j];break}case u:if(O=B.length?B.pop()[1]:"",M=L.charCodeAt(j+1),"url"===O&&M!==t&&M!==n&&M!==o&&M!==s&&M!==l&&M!==a&&M!==c){T=j;do{if(R=!1,T=L.indexOf(")",T+1),-1===T){if(F||k){T=j;break}q("bracket")}for(P=T;L.charCodeAt(P-1)===i;)P-=1,R=!R}while(R);D=["brackets",L.slice(j,T+1),j,T],j=T}else T=L.indexOf(")",j+1),A=L.slice(j,T+1),-1===T||_.test(A)?D=["(","(",j]:(D=["brackets",A,j,T],j=T);break;case t:case n:C=x===t?"'":'"',T=j;do{if(R=!1,T=L.indexOf(C,T+1),-1===T){if(F||k){T=j+1;break}q("string")}for(P=T;L.charCodeAt(P-1)===i;)P-=1,R=!R}while(R);D=["string",L.slice(j,T+1),j,T],j=T;break;case b:w.lastIndex=j+1,w.test(L),T=0===w.lastIndex?L.length-1:w.lastIndex-2,D=["at-word",L.slice(j,T+1),j,T],j=T;break;case i:for(T=j,I=!0;L.charCodeAt(T+1)===i;)T+=1,I=!I;if(x=L.charCodeAt(T+1),I&&x!==r&&x!==o&&x!==s&&x!==l&&x!==c&&x!==a&&(T+=1,E.test(L.charAt(T)))){for(;E.test(L.charAt(T+1));)T+=1;L.charCodeAt(T+1)===o&&(T+=1)}D=["word",L.slice(j,T+1),j,T],j=T;break;default:x===r&&L.charCodeAt(j+1)===v?(T=L.indexOf("*/",j+2)+1,0===T&&(F||k?T=L.length:q("comment")),D=["comment",L.slice(j,T+1),j,T],j=T):(S.lastIndex=j+1,S.test(L),T=0===S.lastIndex?L.length-1:S.lastIndex-2,D=["word",L.slice(j,T+1),j,T],B.push(D),j=T)}return j++,D},endOfFile:function(){return 0===U.length&&j>=N},position:function(){return j}}}},2448:e=>{"use strict";let t={};e.exports=function(e){t[e]||(t[e]=!0,"undefined"!=typeof console&&console.warn&&console.warn(e))}},1728:e=>{"use strict";class t{constructor(e,t={}){if(this.type="warning",this.text=e,t.node&&t.node.source){let e=t.node.rangeBy(t);this.line=e.start.line,this.column=e.start.column,this.endLine=e.end.line,this.endColumn=e.end.column}for(let e in t)this[e]=t[e]}toString(){return this.node?this.node.error(this.text,{plugin:this.plugin,index:this.index,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}}e.exports=t,t.default=t},5798:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,i="RFC3986";e.exports={default:i,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:i}},129:(e,t,n)=>{"use strict";var i=n(8261),r=n(5235),s=n(5798);e.exports={formats:s,parse:r,stringify:i}},5235:(e,t,n)=>{"use strict";var i=n(2769),r=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:i.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,i){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(s),c=a?s.slice(0,a.index):s,d=[];if(c){if(!n.plainObjects&&r.call(Object.prototype,c)&&!n.allowPrototypes)return;d.push(c)}for(var h=0;n.depth>0&&null!==(a=o.exec(s))&&h<n.depth;){if(h+=1,!n.plainObjects&&r.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;d.push(a[1])}return a&&d.push("["+s.slice(a.index)+"]"),function(e,t,n,i){for(var r=i?t:l(t,n),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&n.parseArrays)o=[].concat(r);else{o=n.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,d=parseInt(c,10);n.parseArrays||""!==c?!isNaN(d)&&a!==c&&String(d)===c&&d>=0&&n.parseArrays&&d<=n.arrayLimit?(o=[])[d]=r:"__proto__"!==c&&(o[c]=r):o={0:r}}r=o}return r}(d,t,n,i)}};e.exports=function(e,t){var n=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||i.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var d="string"==typeof e?function(e,t){var n,c={},d=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,h=t.parameterLimit===1/0?void 0:t.parameterLimit,u=d.split(t.delimiter,h),p=-1,m=t.charset;if(t.charsetSentinel)for(n=0;n<u.length;++n)0===u[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===u[n]?m="utf-8":"utf8=%26%2310003%3B"===u[n]&&(m="iso-8859-1"),p=n,n=u.length);for(n=0;n<u.length;++n)if(n!==p){var g,f,v=u[n],y=v.indexOf("]="),b=-1===y?v.indexOf("="):y+1;-1===b?(g=t.decoder(v,o.decoder,m,"key"),f=t.strictNullHandling?null:""):(g=t.decoder(v.slice(0,b),o.decoder,m,"key"),f=i.maybeMap(l(v.slice(b+1),t),(function(e){return t.decoder(e,o.decoder,m,"value")}))),f&&t.interpretNumericEntities&&"iso-8859-1"===m&&(f=a(f)),v.indexOf("[]=")>-1&&(f=s(f)?[f]:f),r.call(c,g)?c[g]=i.combine(c[g],f):c[g]=f}return c}(e,n):e,h=n.plainObjects?Object.create(null):{},u=Object.keys(d),p=0;p<u.length;++p){var m=u[p],g=c(m,d[m],n,"string"==typeof e);h=i.merge(h,g,n)}return!0===n.allowSparse?h:i.compact(h)}},8261:(e,t,n)=>{"use strict";var i=n(7478),r=n(2769),s=n(5798),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=String.prototype.split,d=Array.prototype.push,h=function(e,t){d.apply(e,l(t)?t:[t])},u=Date.prototype.toISOString,p=s.default,m={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:p,formatter:s.formatters[p],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},g={},f=function e(t,n,s,o,a,d,u,p,f,v,y,b,w,S,_,E){for(var k,x=t,T=E,C=0,A=!1;void 0!==(T=T.get(g))&&!A;){var I=T.get(t);if(C+=1,void 0!==I){if(I===C)throw new RangeError("Cyclic object value");A=!0}void 0===T.get(g)&&(C=0)}if("function"==typeof p?x=p(n,x):x instanceof Date?x=y(x):"comma"===s&&l(x)&&(x=r.maybeMap(x,(function(e){return e instanceof Date?y(e):e}))),null===x){if(a)return u&&!S?u(n,m.encoder,_,"key",b):n;x=""}if("string"==typeof(k=x)||"number"==typeof k||"boolean"==typeof k||"symbol"==typeof k||"bigint"==typeof k||r.isBuffer(x)){if(u){var R=S?n:u(n,m.encoder,_,"key",b);if("comma"===s&&S){for(var P=c.call(String(x),","),O="",M=0;M<P.length;++M)O+=(0===M?"":",")+w(u(P[M],m.encoder,_,"value",b));return[w(R)+(o&&l(x)&&1===P.length?"[]":"")+"="+O]}return[w(R)+"="+w(u(x,m.encoder,_,"value",b))]}return[w(n)+"="+w(String(x))]}var D,L=[];if(void 0===x)return L;if("comma"===s&&l(x))D=[{value:x.length>0?x.join(",")||null:void 0}];else if(l(p))D=p;else{var F=Object.keys(x);D=f?F.sort(f):F}for(var N=o&&l(x)&&1===x.length?n+"[]":n,j=0;j<D.length;++j){var B=D[j],U="object"==typeof B&&void 0!==B.value?B.value:x[B];if(!d||null!==U){var q=l(x)?"function"==typeof s?s(N,B):N:N+(v?"."+B:"["+B+"]");E.set(t,C);var z=i();z.set(g,E),h(L,e(U,q,s,o,a,d,u,p,f,v,y,b,w,S,_,z))}}return L};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return m;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||m.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=s.default;if(void 0!==e.format){if(!o.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var i=s.formatters[n],r=m.filter;return("function"==typeof e.filter||l(e.filter))&&(r=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:m.addQueryPrefix,allowDots:void 0===e.allowDots?m.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:m.charsetSentinel,delimiter:void 0===e.delimiter?m.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:m.encode,encoder:"function"==typeof e.encoder?e.encoder:m.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:m.encodeValuesOnly,filter:r,format:n,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:m.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:m.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:m.strictNullHandling}}(t);"function"==typeof c.filter?r=(0,c.filter)("",r):l(c.filter)&&(n=c.filter);var d,u=[];if("object"!=typeof r||null===r)return"";d=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var p=a[d];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var g="comma"===p&&t&&t.commaRoundTrip;n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var v=i(),y=0;y<n.length;++y){var b=n[y];c.skipNulls&&null===r[b]||h(u,f(r[b],b,p,g,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,v))}var w=u.join(c.delimiter),S=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),w.length>0?S+w:""}},2769:(e,t,n)=>{"use strict";var i=n(5798),r=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)void 0!==e[i]&&(n[i]=e[i]);return n};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],i=0;i<t.length;++i)for(var r=t[i],o=r.obj[r.prop],a=Object.keys(o),l=0;l<a.length;++l){var c=a[l],d=o[c];"object"==typeof d&&null!==d&&-1===n.indexOf(d)&&(t.push({obj:o,prop:c}),n.push(d))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(s(n)){for(var i=[],r=0;r<n.length;++r)void 0!==n[r]&&i.push(n[r]);t.obj[t.prop]=i}}}(t),e},decode:function(e,t,n){var i=e.replace(/\+/g," ");if("iso-8859-1"===n)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(e){return i}},encode:function(e,t,n,r,s){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<a.length;++c){var d=a.charCodeAt(c);45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===i.RFC1738&&(40===d||41===d)?l+=a.charAt(c):d<128?l+=o[d]:d<2048?l+=o[192|d>>6]+o[128|63&d]:d<55296||d>=57344?l+=o[224|d>>12]+o[128|d>>6&63]+o[128|63&d]:(c+=1,d=65536+((1023&d)<<10|1023&a.charCodeAt(c)),l+=o[240|d>>18]+o[128|d>>12&63]+o[128|d>>6&63]+o[128|63&d])}return l},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n}return t(e)},merge:function e(t,n,i){if(!n)return t;if("object"!=typeof n){if(s(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(i&&(i.plainObjects||i.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var o=t;return s(t)&&!s(n)&&(o=a(t,i)),s(t)&&s(n)?(n.forEach((function(n,s){if(r.call(t,s)){var o=t[s];o&&"object"==typeof o&&n&&"object"==typeof n?t[s]=e(o,n,i):t.push(n)}else t[s]=n})),t):Object.keys(n).reduce((function(t,s){var o=n[s];return r.call(t,s)?t[s]=e(t[s],o,i):t[s]=o,t}),o)}}},9353:(e,t,n)=>{e.exports=n(1846)},1846:(e,t,n)=>{var i=n(1960);t.operation=function(e){var n=t.timeouts(e);return new i(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],r=0;r<t.retries;r++)i.push(this.createTimeout(r,t));return e&&e.forever&&!i.length&&i.push(this.createTimeout(r,t)),i.sort((function(e,t){return e-t})),i},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,i=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(i,t.maxTimeout)},t.wrap=function(e,n,i){if(n instanceof Array&&(i=n,n=null),!i)for(var r in i=[],e)"function"==typeof e[r]&&i.push(r);for(var s=0;s<i.length;s++){var o=i[s],a=e[o];e[o]=function(i){var r=t.operation(n),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push((function(e){r.retry(e)||(e&&(arguments[0]=r.mainError()),o.apply(this,arguments))})),r.attempt((function(){i.apply(e,s)}))}.bind(e,a),e[o].options=n}}},1960:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var i=this;return this._timer=setTimeout((function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout((function(){i._operationTimeoutCb(i._attempts)}),i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)}),n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,i=0;i<this._errors.length;i++){var r=this._errors[i],s=r.message,o=(e[s]||0)+1;e[s]=o,o>=n&&(t=r,n=o)}return t}},1036:(e,t,n)=>{const i=n(3719),r=n(2997),{isPlainObject:s}=n(6057),o=n(9996),a=n(9430),{parse:l}=n(20),c=["img","audio","video","picture","svg","object","map","iframe","embed"],d=["script","style"];function h(e,t){e&&Object.keys(e).forEach((function(n){t(e[n],n)}))}function u(e,t){return{}.hasOwnProperty.call(e,t)}function p(e,t){const n=[];return h(e,(function(e){t(e)&&n.push(e)})),n}e.exports=g;const m=/^[^\0\t\n\f\r /<=>]+$/;function g(e,t,n){if(null==e)return"";let v="",y="";function b(e,t){const n=this;this.tag=e,this.attribs=t||{},this.tagPosition=v.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){I.length&&(I[I.length-1].text+=n.text)},this.updateParentNodeMediaChildren=function(){I.length&&c.includes(this.tag)&&I[I.length-1].mediaChildren.push(this.tag)}}(t=Object.assign({},g.defaults,t)).parser=Object.assign({},f,t.parser),d.forEach((function(e){t.allowedTags&&t.allowedTags.indexOf(e)>-1&&!t.allowVulnerableTags&&console.warn(`\n\n Your \`allowedTags\` option includes, \`${e}\`, which is inherently\nvulnerable to XSS attacks. Please remove it from \`allowedTags\`.\nOr, to disable this warning, add the \`allowVulnerableTags\` option\nand ensure you are accounting for this risk.\n\n`)}));const w=t.nonTextTags||["script","style","textarea","option"];let S,_;t.allowedAttributes&&(S={},_={},h(t.allowedAttributes,(function(e,t){S[t]=[];const n=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?n.push(r(e).replace(/\\\*/g,".*")):S[t].push(e)})),n.length&&(_[t]=new RegExp("^("+n.join("|")+")$"))})));const E={},k={},x={};h(t.allowedClasses,(function(e,t){S&&(u(S,t)||(S[t]=[]),S[t].push("class")),E[t]=[],x[t]=[];const n=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?n.push(r(e).replace(/\\\*/g,".*")):e instanceof RegExp?x[t].push(e):E[t].push(e)})),n.length&&(k[t]=new RegExp("^("+n.join("|")+")$"))}));const T={};let C,A,I,R,P,O,M;h(t.transformTags,(function(e,t){let n;"function"==typeof e?n=e:"string"==typeof e&&(n=g.simpleTransform(e)),"*"===t?C=n:T[t]=n}));let D=!1;F();const L=new i.Parser({onopentag:function(e,n){if(t.enforceHtmlBoundary&&"html"===e&&F(),O)return void M++;const i=new b(e,n);I.push(i);let r=!1;const c=!!i.text;let d;if(u(T,e)&&(d=T[e](e,n),i.attribs=n=d.attribs,void 0!==d.text&&(i.innerText=d.text),e!==d.tagName&&(i.name=e=d.tagName,P[A]=d.tagName)),C&&(d=C(e,n),i.attribs=n=d.attribs,e!==d.tagName&&(i.name=e=d.tagName,P[A]=d.tagName)),(t.allowedTags&&-1===t.allowedTags.indexOf(e)||"recursiveEscape"===t.disallowedTagsMode&&!function(e){for(const t in e)if(u(e,t))return!1;return!0}(R)||null!=t.nestingLimit&&A>=t.nestingLimit)&&(r=!0,R[A]=!0,"discard"===t.disallowedTagsMode&&-1!==w.indexOf(e)&&(O=!0,M=1),R[A]=!0),A++,r){if("discard"===t.disallowedTagsMode)return;y=v,v=""}v+="<"+e,"script"===e&&(t.allowedScriptHostnames||t.allowedScriptDomains)&&(i.innerText=""),(!S||u(S,e)||S["*"])&&h(n,(function(n,r){if(!m.test(r))return void delete i.attribs[r];let c=!1;if(!S||u(S,e)&&-1!==S[e].indexOf(r)||S["*"]&&-1!==S["*"].indexOf(r)||u(_,e)&&_[e].test(r)||_["*"]&&_["*"].test(r))c=!0;else if(S&&S[e])for(const t of S[e])if(s(t)&&t.name&&t.name===r){c=!0;let e="";if(!0===t.multiple){const i=n.split(" ");for(const n of i)-1!==t.values.indexOf(n)&&(""===e?e=n:e+=" "+n)}else t.values.indexOf(n)>=0&&(e=n);n=e}if(c){if(-1!==t.allowedSchemesAppliedToAttributes.indexOf(r)&&j(e,n))return void delete i.attribs[r];if("script"===e&&"src"===r){let e=!0;try{const i=B(n);if(t.allowedScriptHostnames||t.allowedScriptDomains){const n=(t.allowedScriptHostnames||[]).find((function(e){return e===i.url.hostname})),r=(t.allowedScriptDomains||[]).find((function(e){return i.url.hostname===e||i.url.hostname.endsWith(`.${e}`)}));e=n||r}}catch(t){e=!1}if(!e)return void delete i.attribs[r]}if("iframe"===e&&"src"===r){let e=!0;try{const i=B(n);if(i.isRelativeUrl)e=u(t,"allowIframeRelativeUrls")?t.allowIframeRelativeUrls:!t.allowedIframeHostnames&&!t.allowedIframeDomains;else if(t.allowedIframeHostnames||t.allowedIframeDomains){const n=(t.allowedIframeHostnames||[]).find((function(e){return e===i.url.hostname})),r=(t.allowedIframeDomains||[]).find((function(e){return i.url.hostname===e||i.url.hostname.endsWith(`.${e}`)}));e=n||r}}catch(t){e=!1}if(!e)return void delete i.attribs[r]}if("srcset"===r)try{let e=a(n);if(e.forEach((function(e){j("srcset",e.url)&&(e.evil=!0)})),e=p(e,(function(e){return!e.evil})),!e.length)return void delete i.attribs[r];n=p(e,(function(e){return!e.evil})).map((function(e){if(!e.url)throw new Error("URL missing");return e.url+(e.w?` ${e.w}w`:"")+(e.h?` ${e.h}h`:"")+(e.d?` ${e.d}x`:"")})).join(", "),i.attribs[r]=n}catch(e){return void delete i.attribs[r]}if("class"===r){const t=E[e],s=E["*"],a=k[e],l=x[e],c=[a,k["*"]].concat(l).filter((function(e){return e}));if(!(d=n,h=t&&s?o(t,s):t||s,g=c,n=h?(d=d.split(/\s+/)).filter((function(e){return-1!==h.indexOf(e)||g.some((function(t){return t.test(e)}))})).join(" "):d).length)return void delete i.attribs[r]}if("style"===r)try{if(0===(n=function(e){return e.nodes[0].nodes.reduce((function(e,t){return e.push(`${t.prop}:${t.value}${t.important?" !important":""}`),e}),[]).join(";")}(function(e,t){if(!t)return e;const n=e.nodes[0];let i;return i=t[n.selector]&&t["*"]?o(t[n.selector],t["*"]):t[n.selector]||t["*"],i&&(e.nodes[0].nodes=n.nodes.reduce(function(e){return function(t,n){return u(e,n.prop)&&e[n.prop].some((function(e){return e.test(n.value)}))&&t.push(n),t}}(i),[])),e}(l(e+" {"+n+"}"),t.allowedStyles))).length)return void delete i.attribs[r]}catch(e){return void delete i.attribs[r]}v+=" "+r,n&&n.length&&(v+='="'+N(n,!0)+'"')}else delete i.attribs[r];var d,h,g})),-1!==t.selfClosing.indexOf(e)?v+=" />":(v+=">",!i.innerText||c||t.textFilter||(v+=N(i.innerText),D=!0)),r&&(v=y+N(v),y="")},ontext:function(e){if(O)return;const n=I[I.length-1];let i;if(n&&(i=n.tag,e=void 0!==n.innerText?n.innerText:e),"discard"!==t.disallowedTagsMode||"script"!==i&&"style"!==i){const n=N(e,!1);t.textFilter&&!D?v+=t.textFilter(n,i):D||(v+=n)}else v+=e;I.length&&(I[I.length-1].text+=e)},onclosetag:function(e){if(O){if(M--,M)return;O=!1}const n=I.pop();if(!n)return;O=!!t.enforceHtmlBoundary&&"html"===e,A--;const i=R[A];if(i){if(delete R[A],"discard"===t.disallowedTagsMode)return void n.updateParentNodeText();y=v,v=""}P[A]&&(e=P[A],delete P[A]),t.exclusiveFilter&&t.exclusiveFilter(n)?v=v.substr(0,n.tagPosition):(n.updateParentNodeMediaChildren(),n.updateParentNodeText(),-1===t.selfClosing.indexOf(e)?(v+="</"+e+">",i&&(v=y+N(v),y=""),D=!1):i&&(v=y,y=""))}},t.parser);return L.write(e),L.end(),v;function F(){v="",A=0,I=[],R={},P={},O=!1,M=0}function N(e,n){return"string"!=typeof e&&(e+=""),t.parser.decodeEntities&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n&&(e=e.replace(/"/g,"&quot;"))),e=e.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n&&(e=e.replace(/"/g,"&quot;")),e}function j(e,n){for(n=n.replace(/[\x00-\x20]+/g,"");;){const e=n.indexOf("\x3c!--");if(-1===e)break;const t=n.indexOf("--\x3e",e+4);if(-1===t)break;n=n.substring(0,e)+n.substring(t+3)}const i=n.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!i)return!!n.match(/^[/\\]{2}/)&&!t.allowProtocolRelative;const r=i[1].toLowerCase();return u(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(r):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(r)}function B(e){if((e=e.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//")).startsWith("relative:"))throw new Error("relative: exploit attempt");let t="relative://relative-site";for(let e=0;e<100;e++)t+=`/${e}`;const n=new URL(e,t);return{isRelativeUrl:n&&"relative-site"===n.hostname&&"relative:"===n.protocol,url:n}}}const f={decodeEntities:!0};g.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1},g.simpleTransform=function(e,t,n){return n=void 0===n||n,t=t||{},function(i,r){let s;if(n)for(s in t)r[s]=t[s];else r=t;return{tagName:e,attribs:r}}}},2997:e=>{"use strict";e.exports=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}},7478:(e,t,n)=>{"use strict";var i=n(210),r=n(1924),s=n(631),o=i("%TypeError%"),a=i("%WeakMap%",!0),l=i("%Map%",!0),c=r("WeakMap.prototype.get",!0),d=r("WeakMap.prototype.set",!0),h=r("WeakMap.prototype.has",!0),u=r("Map.prototype.get",!0),p=r("Map.prototype.set",!0),m=r("Map.prototype.has",!0),g=function(e,t){for(var n,i=e;null!==(n=i.next);i=n)if(n.key===t)return i.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,i={assert:function(e){if(!i.has(e))throw new o("Side channel does not contain "+s(e))},get:function(i){if(a&&i&&("object"==typeof i||"function"==typeof i)){if(e)return c(e,i)}else if(l){if(t)return u(t,i)}else if(n)return function(e,t){var n=g(e,t);return n&&n.value}(n,i)},has:function(i){if(a&&i&&("object"==typeof i||"function"==typeof i)){if(e)return h(e,i)}else if(l){if(t)return m(t,i)}else if(n)return function(e,t){return!!g(e,t)}(n,i);return!1},set:function(i,r){a&&i&&("object"==typeof i||"function"==typeof i)?(e||(e=new a),d(e,i,r)):l?(t||(t=new l),p(t,i,r)):(n||(n={key:{},next:null}),function(e,t,n){var i=g(e,t);i?i.value=n:e.next={key:t,next:e.next,value:n}}(n,i,r))}};return i}},8822:()=>{String.prototype.repeat||function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,n=t(e,e,e)&&t}catch(e){}return n}(),t=function(e){if(null==this)throw TypeError();var t=String(this),n=e?Number(e):0;if(n!=n&&(n=0),n<0||n==1/0)throw RangeError();for(var i="";n;)n%2==1&&(i+=t),n>1&&(t+=t),n>>=1;return i};e?e(String.prototype,"repeat",{value:t,configurable:!0,writable:!0}):String.prototype.repeat=t}()},3379:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],d=s[c]||0,h="".concat(c," ").concat(d);s[c]=d+1;var u=n(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(p);else{var m=r(p,i);i.byIndex=a,t.splice(a,0,{identifier:h,updater:m,references:1})}o.push(h)}return o}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var s=i(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var l=i(e,r),c=0;c<s.length;c++){var d=n(s[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}s=l}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},5067:(e,t,n)=>{"use strict";var i=n(7873),r=RegExp(Object.keys(i).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function s(e){return i[e]}e.exports=function(e){return e.replace(r,s)}},1796:e=>{var t;self,t=()=>(()=>{var e={"./src/drawer.canvasentry.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(n("./src/util/style.js")),r=s(n("./src/util/get-id.js"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wave=null,this.waveCtx=null,this.progress=null,this.progressCtx=null,this.start=0,this.end=1,this.id=(0,r.default)(void 0!==this.constructor.name?this.constructor.name.toLowerCase()+"_":"canvasentry_"),this.canvasContextAttributes={}}var t,n;return t=e,(n=[{key:"initWave",value:function(e){this.wave=e,this.waveCtx=this.wave.getContext("2d",this.canvasContextAttributes)}},{key:"initProgress",value:function(e){this.progress=e,this.progressCtx=this.progress.getContext("2d",this.canvasContextAttributes)}},{key:"updateDimensions",value:function(e,t,n,r){this.start=this.wave.offsetLeft/t||0,this.end=this.start+e/t,this.wave.width=n,this.wave.height=r;var s={width:e+"px"};(0,i.default)(this.wave,s),this.hasProgressCanvas&&(this.progress.width=n,this.progress.height=r,(0,i.default)(this.progress,s))}},{key:"clearWave",value:function(){this.waveCtx.clearRect(0,0,this.waveCtx.canvas.width,this.waveCtx.canvas.height),this.hasProgressCanvas&&this.progressCtx.clearRect(0,0,this.progressCtx.canvas.width,this.progressCtx.canvas.height)}},{key:"setFillStyles",value:function(e,t){this.waveCtx.fillStyle=this.getFillStyle(this.waveCtx,e),this.hasProgressCanvas&&(this.progressCtx.fillStyle=this.getFillStyle(this.progressCtx,t))}},{key:"getFillStyle",value:function(e,t){if("string"==typeof t||t instanceof CanvasGradient)return t;var n=e.createLinearGradient(0,0,0,e.canvas.height);return t.forEach((function(e,i){return n.addColorStop(i/t.length,e)})),n}},{key:"applyCanvasTransforms",value:function(e){e&&(this.waveCtx.setTransform(0,1,1,0,0,0),this.hasProgressCanvas&&this.progressCtx.setTransform(0,1,1,0,0,0))}},{key:"fillRects",value:function(e,t,n,i,r){this.fillRectToContext(this.waveCtx,e,t,n,i,r),this.hasProgressCanvas&&this.fillRectToContext(this.progressCtx,e,t,n,i,r)}},{key:"fillRectToContext",value:function(e,t,n,i,r,s){e&&(s?this.drawRoundedRect(e,t,n,i,r,s):e.fillRect(t,n,i,r))}},{key:"drawRoundedRect",value:function(e,t,n,i,r,s){0!==r&&(r<0&&(n-=r*=-1),e.beginPath(),e.moveTo(t+s,n),e.lineTo(t+i-s,n),e.quadraticCurveTo(t+i,n,t+i,n+s),e.lineTo(t+i,n+r-s),e.quadraticCurveTo(t+i,n+r,t+i-s,n+r),e.lineTo(t+s,n+r),e.quadraticCurveTo(t,n+r,t,n+r-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+s,n),e.closePath(),e.fill())}},{key:"drawLines",value:function(e,t,n,i,r,s){this.drawLineToContext(this.waveCtx,e,t,n,i,r,s),this.hasProgressCanvas&&this.drawLineToContext(this.progressCtx,e,t,n,i,r,s)}},{key:"drawLineToContext",value:function(e,t,n,i,r,s,o){if(e){var a,l,c,d=t.length/2,h=Math.round(d*this.start),u=h,p=Math.round(d*this.end)+1,m=this.wave.width/(p-u-1),g=i+r,f=n/i;for(e.beginPath(),e.moveTo((u-h)*m,g),e.lineTo((u-h)*m,g-Math.round((t[2*u]||0)/f)),a=u;a<p;a++)l=t[2*a]||0,c=Math.round(l/f),e.lineTo((a-h)*m+this.halfPixel,g-c);for(var v=p-1;v>=u;v--)l=t[2*v+1]||0,c=Math.round(l/f),e.lineTo((v-h)*m+this.halfPixel,g-c);e.lineTo((u-h)*m,g-Math.round((t[2*u+1]||0)/f)),e.closePath(),e.fill()}}},{key:"destroy",value:function(){this.waveCtx=null,this.wave=null,this.progressCtx=null,this.progress=null}},{key:"getImage",value:function(e,t,n){var i=this;return"blob"===n?new Promise((function(n){i.wave.toBlob(n,e,t)})):"dataURL"===n?this.wave.toDataURL(e,t):void 0}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=a,e.exports=t.default},"./src/drawer.js":(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=o?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(r,a,l):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}(n("./src/util/index.js"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(h,e);var t,n,i,s,d=(i=h,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=c(i);if(s){var n=c(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return l(this,e)});function h(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(n=d.call(this)).container=r.withOrientation(e,t.vertical),n.params=t,n.width=0,n.height=t.height*n.params.pixelRatio,n.lastPos=0,n.wrapper=null,n}return t=h,(n=[{key:"style",value:function(e,t){return r.style(e,t)}},{key:"createWrapper",value:function(){this.wrapper=r.withOrientation(this.container.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",cursor:this.params.hideCursor?"none":"auto",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}},{key:"handleEvent",value:function(e,t){!t&&e.preventDefault();var n,i=r.withOrientation(e.targetTouches?e.targetTouches[0]:e,this.params.vertical).clientX,s=this.wrapper.getBoundingClientRect(),o=this.width,a=this.getWidth(),l=this.getProgressPixels(s,i);return n=!this.params.fillParent&&o<a?l*(this.params.pixelRatio/o)||0:(l+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,r.clamp(n,0,1)}},{key:"getProgressPixels",value:function(e,t){return this.params.rtl?e.right-t:t-e.left}},{key:"setupWrapperEvents",value:function(){var e=this;this.wrapper.addEventListener("click",(function(t){var n=r.withOrientation(t,e.params.vertical),i=e.wrapper.offsetHeight-e.wrapper.clientHeight;if(0!==i){var s=e.wrapper.getBoundingClientRect();if(n.clientY>=s.bottom-i)return}e.params.interact&&e.fireEvent("click",t,e.handleEvent(t))})),this.wrapper.addEventListener("dblclick",(function(t){e.params.interact&&e.fireEvent("dblclick",t,e.handleEvent(t))})),this.wrapper.addEventListener("scroll",(function(t){return e.fireEvent("scroll",t)}))}},{key:"drawPeaks",value:function(e,t,n,i){this.setWidth(t)||this.clearWave(),this.params.barWidth?this.drawBars(e,0,n,i):this.drawWave(e,0,n,i)}},{key:"resetScroll",value:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(e){var t=this.wrapper.scrollWidth*e;this.recenterOnPosition(t,!0)}},{key:"recenterOnPosition",value:function(e,t){var n=this.wrapper.scrollLeft,i=~~(this.wrapper.clientWidth/2),r=this.wrapper.scrollWidth-this.wrapper.clientWidth,s=e-i,o=s-n;if(0!=r){if(!t&&-i<=o&&o<i){var a=this.params.autoCenterRate;a/=i,a*=r,s=n+(o=Math.max(-a,Math.min(a,o)))}(s=Math.max(0,Math.min(r,s)))!=n&&(this.wrapper.scrollLeft=s)}}},{key:"getScrollX",value:function(){var e=0;if(this.wrapper){var t=this.params.pixelRatio;if(e=Math.round(this.wrapper.scrollLeft*t),this.params.scrollParent){var n=~~(this.wrapper.scrollWidth*t-this.getWidth());e=Math.min(n,Math.max(0,e))}}return e}},{key:"getWidth",value:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(e){if(this.width==e)return!1;if(this.width=e,this.params.fillParent||this.params.scrollParent)this.style(this.wrapper,{width:""});else{var t=~~(this.width/this.params.pixelRatio)+"px";this.style(this.wrapper,{width:t})}return this.updateSize(),!0}},{key:"setHeight",value:function(e){return e!=this.height&&(this.height=e,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"progress",value:function(e){var t=1/this.params.pixelRatio,n=Math.round(e*this.width)*t;if(n<this.lastPos||n-this.lastPos>=t){if(this.lastPos=n,this.params.scrollParent&&this.params.autoCenter){var i=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(i,this.params.autoCenterImmediately)}this.updateProgress(n)}}},{key:"destroy",value:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container.domElement&&this.container.removeChild(this.wrapper.domElement),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(e,t,n,i){}},{key:"drawWave",value:function(e,t,n,i){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(e){}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),h}(r.Observer);t.default=d,e.exports=t.default},"./src/drawer.multicanvas.js":(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(n("./src/drawer.js")),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=s?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n("./src/util/index.js")),o=l(n("./src/drawer.canvasentry.js"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function h(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(l,e);var t,n,i,r,a=(i=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(i);if(r){var n=u(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=a.call(this,e,t)).maxCanvasWidth=t.maxCanvasWidth,n.maxCanvasElementWidth=Math.round(t.maxCanvasWidth/t.pixelRatio),n.hasProgressCanvas=t.waveColor!=t.progressColor,n.halfPixel=.5/t.pixelRatio,n.canvases=[],n.progressWave=null,n.EntryClass=o.default,n.canvasContextAttributes=t.drawingContextAttributes,n.overlap=2*Math.ceil(t.pixelRatio/2),n.barRadius=t.barRadius||0,n.vertical=t.vertical,n}return t=l,n=[{key:"init",value:function(){this.createWrapper(),this.createElements()}},{key:"createElements",value:function(){this.progressWave=s.withOrientation(this.wrapper.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.progressWave,{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"}),this.addCanvas(),this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){for(var e=this,t=Math.round(this.width/this.params.pixelRatio),n=Math.ceil(t/(this.maxCanvasElementWidth+this.overlap));this.canvases.length<n;)this.addCanvas();for(;this.canvases.length>n;)this.removeCanvas();var i=this.maxCanvasWidth+this.overlap,r=this.canvases.length-1;this.canvases.forEach((function(t,n){n==r&&(i=e.width-e.maxCanvasWidth*r),e.updateDimensions(t,i,e.height),t.clearWave()}))}},{key:"addCanvas",value:function(){var e=new this.EntryClass;e.canvasContextAttributes=this.canvasContextAttributes,e.hasProgressCanvas=this.hasProgressCanvas,e.halfPixel=this.halfPixel;var t=this.maxCanvasElementWidth*this.canvases.length,n=s.withOrientation(this.wrapper.appendChild(document.createElement("canvas")),this.params.vertical);if(this.style(n,{position:"absolute",zIndex:2,left:t+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}),e.initWave(n),this.hasProgressCanvas){var i=s.withOrientation(this.progressWave.appendChild(document.createElement("canvas")),this.params.vertical);this.style(i,{position:"absolute",left:t+"px",top:0,bottom:0,height:"100%"}),e.initProgress(i)}this.canvases.push(e)}},{key:"removeCanvas",value:function(){var e=this.canvases[this.canvases.length-1];e.wave.parentElement.removeChild(e.wave.domElement),this.hasProgressCanvas&&e.progress.parentElement.removeChild(e.progress.domElement),e&&(e.destroy(),e=null),this.canvases.pop()}},{key:"updateDimensions",value:function(e,t,n){var i=Math.round(t/this.params.pixelRatio),r=Math.round(this.width/this.params.pixelRatio);e.updateDimensions(i,r,t,n),this.style(this.progressWave,{display:"block"})}},{key:"clearWave",value:function(){var e=this;s.frame((function(){e.canvases.forEach((function(e){return e.clearWave()}))}))()}},{key:"drawBars",value:function(e,t,n,i){var r=this;return this.prepareDraw(e,t,n,i,(function(e){var t=e.absmax,s=e.hasMinVals,o=(e.height,e.offsetY),a=e.halfH,l=e.peaks,c=e.channelIndex;if(void 0!==n)for(var d=s?2:1,h=l.length/d,u=r.params.barWidth*r.params.pixelRatio,p=u+(null===r.params.barGap?Math.max(r.params.pixelRatio,~~(u/2)):Math.max(r.params.pixelRatio,r.params.barGap*r.params.pixelRatio)),m=h/r.width,g=i,f=n;f<g;f+=p){var v=0,y=Math.floor(f*m)*d,b=Math.floor((f+p)*m)*d;do{var w=Math.abs(l[y]);w>v&&(v=w),y+=d}while(y<b);var S=Math.round(v/t*a);0==S&&r.params.barMinHeight&&(S=r.params.barMinHeight),r.fillRect(f+r.halfPixel,a-S+o,u+r.halfPixel,2*S,r.barRadius,c)}}))}},{key:"drawWave",value:function(e,t,n,i){var r=this;return this.prepareDraw(e,t,n,i,(function(e){var t=e.absmax,s=e.hasMinVals,o=(e.height,e.offsetY),a=e.halfH,l=e.peaks,c=e.channelIndex;if(!s){for(var d=[],h=l.length,u=0;u<h;u++)d[2*u]=l[u],d[2*u+1]=-l[u];l=d}void 0!==n&&r.drawLine(l,t,a,o,n,i,c),r.fillRect(0,a+o-r.halfPixel,r.width,r.halfPixel,r.barRadius,c)}))}},{key:"drawLine",value:function(e,t,n,i,r,s,o){var a=this,l=this.params.splitChannelsOptions.channelColors[o]||{},c=l.waveColor,d=l.progressColor;this.canvases.forEach((function(o,l){a.setFillStyles(o,c,d),a.applyCanvasTransforms(o,a.params.vertical),o.drawLines(e,t,n,i,r,s)}))}},{key:"fillRect",value:function(e,t,n,i,r,s){for(var o=Math.floor(e/this.maxCanvasWidth),a=Math.min(Math.ceil((e+n)/this.maxCanvasWidth)+1,this.canvases.length),l=o;l<a;l++){var c=this.canvases[l],d=l*this.maxCanvasWidth,h={x1:Math.max(e,l*this.maxCanvasWidth),y1:t,x2:Math.min(e+n,l*this.maxCanvasWidth+c.wave.width),y2:t+i};if(h.x1<h.x2){var u=this.params.splitChannelsOptions.channelColors[s]||{},p=u.waveColor,m=u.progressColor;this.setFillStyles(c,p,m),this.applyCanvasTransforms(c,this.params.vertical),c.fillRects(h.x1-d,h.y1,h.x2-h.x1,h.y2-h.y1,r)}}}},{key:"hideChannel",value:function(e){return this.params.splitChannels&&this.params.splitChannelsOptions.filterChannels.includes(e)}},{key:"prepareDraw",value:function(e,t,n,i,r,o,a){var l=this;return s.frame((function(){if(e[0]instanceof Array){var c=e;if(l.params.splitChannels){var d,h=c.filter((function(e,t){return!l.hideChannel(t)}));return l.params.splitChannelsOptions.overlay||l.setHeight(Math.max(h.length,1)*l.params.height*l.params.pixelRatio),l.params.splitChannelsOptions&&l.params.splitChannelsOptions.relativeNormalization&&(d=s.max(c.map((function(e){return s.absMax(e)})))),c.forEach((function(e,t){return l.prepareDraw(e,t,n,i,r,h.indexOf(e),d)}))}e=c[0]}if(!l.hideChannel(t)){var u=1/l.params.barHeight;l.params.normalize&&(u=void 0===a?s.absMax(e):a);var p=[].some.call(e,(function(e){return e<0})),m=l.params.height*l.params.pixelRatio,g=m/2,f=m*o||0;return l.params.splitChannelsOptions&&l.params.splitChannelsOptions.overlay&&(f=0),r({absmax:u,hasMinVals:p,height:m,offsetY:f,halfH:g,peaks:e,channelIndex:t})}}))()}},{key:"setFillStyles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.params.waveColor,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.progressColor;e.setFillStyles(t,n)}},{key:"applyCanvasTransforms",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.applyCanvasTransforms(t)}},{key:"getImage",value:function(e,t,n){if("blob"===n)return Promise.all(this.canvases.map((function(i){return i.getImage(e,t,n)})));if("dataURL"===n){var i=this.canvases.map((function(i){return i.getImage(e,t,n)}));return i.length>1?i:i[0]}}},{key:"updateProgress",value:function(e){this.style(this.progressWave,{width:e+"px"})}}],n&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(r.default);t.default=p,e.exports=t.default},"./src/mediaelement-webaudio.js":(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var r;function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=a(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},o.apply(this,arguments)}function a(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function c(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(h,e);var t,n,i,r,a=(i=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(i);if(r){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return c(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=a.call(this,e)).params=e,t.sourceMediaElement=null,t}return t=h,(n=[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer(),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode()}},{key:"_load",value:function(e,t,n){o(d(h.prototype),"_load",this).call(this,e,t,n),this.createMediaElementSource(e)}},{key:"createMediaElementSource",value:function(e){this.sourceMediaElement=this.ac.createMediaElementSource(e),this.sourceMediaElement.connect(this.analyser)}},{key:"play",value:function(e,t){return this.resumeAudioContext(),o(d(h.prototype),"play",this).call(this,e,t)}},{key:"destroy",value:function(){o(d(h.prototype),"destroy",this).call(this),this.destroyWebAudio()}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),h}(((r=n("./src/mediaelement.js"))&&r.__esModule?r:{default:r}).default);t.default=h,e.exports=t.default},"./src/mediaelement.js":(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n("./src/webaudio.js"))&&r.__esModule?r:{default:r},o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=s?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n("./src/util/index.js"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=d(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},c.apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function u(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(a,e);var t,n,i,r,s=(i=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(i);if(r){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=s.call(this,e)).params=e,t.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0},t.mediaType=e.mediaType.toLowerCase(),t.elementPosition=e.elementPosition,t.peaks=null,t.playbackRate=1,t.volume=1,t.isMuted=!1,t.buffer=null,t.onPlayEnd=null,t.mediaListeners={},t}return t=a,(n=[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}},{key:"_setupMediaListeners",value:function(){var e=this;this.mediaListeners.error=function(){e.fireEvent("error","Error loading media element")},this.mediaListeners.canplay=function(){e.fireEvent("canplay")},this.mediaListeners.ended=function(){e.fireEvent("finish")},this.mediaListeners.play=function(){e.fireEvent("play")},this.mediaListeners.pause=function(){e.fireEvent("pause")},this.mediaListeners.seeked=function(t){e.fireEvent("seek")},this.mediaListeners.volumechange=function(t){e.isMuted=e.media.muted,e.isMuted?e.volume=0:e.volume=e.media.volume,e.fireEvent("volume")},Object.keys(this.mediaListeners).forEach((function(t){e.media.removeEventListener(t,e.mediaListeners[t]),e.media.addEventListener(t,e.mediaListeners[t])}))}},{key:"createTimer",value:function(){var e=this;this.on("play",(function t(){e.isPaused()||(e.fireEvent("audioprocess",e.getCurrentTime()),o.frame(t)())})),this.on("pause",(function(){e.fireEvent("audioprocess",e.getCurrentTime())}))}},{key:"load",value:function(e,t,n,i){var r=document.createElement(this.mediaType);r.controls=this.params.mediaControls,r.autoplay=this.params.autoplay||!1,r.preload=null==i?"auto":i,r.src=e,r.style.width="100%";var s=t.querySelector(this.mediaType);s&&t.removeChild(s),t.appendChild(r),this._load(r,n,i)}},{key:"loadElt",value:function(e,t){e.controls=this.params.mediaControls,e.autoplay=this.params.autoplay||!1,this._load(e,t,e.preload)}},{key:"_load",value:function(e,t,n){if(!(e instanceof HTMLMediaElement)||void 0===e.addEventListener)throw new Error("media parameter is not a valid media element");"function"!=typeof e.load||t&&"none"==n||e.load(),this.media=e,this._setupMediaListeners(),this.peaks=t,this.onPlayEnd=null,this.buffer=null,this.isMuted=e.muted,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;var e=(this.buffer||this.media).duration;return e>=1/0&&(e=this.media.seekable.end(0)),e}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(e){this.playbackRate=e||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(e){null==e||isNaN(e)||(this.media.currentTime=e),this.clearPlayEnd()}},{key:"play",value:function(e,t){this.seekTo(e);var n=this.media.play();return t&&this.setPlayEnd(t),n}},{key:"pause",value:function(){var e;return this.media&&(e=this.media.pause()),this.clearPlayEnd(),e}},{key:"setPlayEnd",value:function(e){var t=this;this.clearPlayEnd(),this._onPlayEnd=function(n){n>=e&&(t.pause(),t.seekTo(e))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(e,t,n){return this.buffer?c(p(a.prototype),"getPeaks",this).call(this,e,t,n):this.peaks||[]}},{key:"setSinkId",value:function(e){return e?this.media.setSinkId?this.media.setSinkId(e):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+e))}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(e){this.volume=e,this.media.volume!==this.volume&&(this.media.volume=this.volume)}},{key:"setMute",value:function(e){this.isMuted=this.media.muted=e}},{key:"destroy",value:function(){var e=this;this.pause(),this.unAll(),this.destroyed=!0,Object.keys(this.mediaListeners).forEach((function(t){e.media&&e.media.removeEventListener(t,e.mediaListeners[t])})),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}])&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(s.default);t.default=m,e.exports=t.default},"./src/peakcache.js":(e,t)=>{"use strict";function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clearPeakCache()}var t,i;return t=e,(i=[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[],this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(e,t,n){e!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=e);for(var i=[],r=0;r<this.peakCacheRanges.length&&this.peakCacheRanges[r]<t;)r++;for(r%2==0&&i.push(t);r<this.peakCacheRanges.length&&this.peakCacheRanges[r]<=n;)i.push(this.peakCacheRanges[r]),r++;r%2==0&&i.push(n),i=i.filter((function(e,t,n){return 0==t?e!=n[t+1]:t==n.length-1?e!=n[t-1]:e!=n[t-1]&&e!=n[t+1]})),this.peakCacheRanges=this.peakCacheRanges.concat(i),this.peakCacheRanges=this.peakCacheRanges.sort((function(e,t){return e-t})).filter((function(e,t,n){return 0==t?e!=n[t+1]:t==n.length-1?e!=n[t-1]:e!=n[t-1]&&e!=n[t+1]}));var s=[];for(r=0;r<i.length;r+=2)s.push([i[r],i[r+1]]);return s}},{key:"getCacheRanges",value:function(){var e,t=[];for(e=0;e<this.peakCacheRanges.length;e+=2)t.push([this.peakCacheRanges[e],this.peakCacheRanges[e+1]]);return t}}])&&n(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=i,e.exports=t.default},"./src/util/absMax.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,i.default)(e),n=(0,r.default)(e);return-n>t?-n:t};var i=s(n("./src/util/max.js")),r=s(n("./src/util/min.js"));function s(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default},"./src/util/clamp.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return Math.min(Math.max(t,e),n)},e.exports=t.default},"./src/util/fetch.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e)throw new Error("fetch options missing");if(!e.url)throw new Error("fetch url missing");var t=new r.default,n=new Headers,i=new Request(e.url);t.controller=new AbortController,e&&e.requestHeaders&&e.requestHeaders.forEach((function(e){n.append(e.key,e.value)}));var s=e.responseType||"json",a={method:e.method||"GET",headers:n,mode:e.mode||"cors",credentials:e.credentials||"same-origin",cache:e.cache||"default",redirect:e.redirect||"follow",referrer:e.referrer||"client",signal:t.controller.signal};return fetch(i,a).then((function(e){t.response=e;var n=!0;e.body||(n=!1);var i=e.headers.get("content-length");return null===i&&(n=!1),n?(t.onProgress=function(e){t.fireEvent("progress",e)},new Response(new ReadableStream(new o(t,i,e)),a)):e})).then((function(e){var t;if(e.ok)switch(s){case"arraybuffer":return e.arrayBuffer();case"json":return e.json();case"blob":return e.blob();case"text":return e.text();default:t="Unknown responseType: "+s}throw t||(t="HTTP error status: "+e.status),new Error(t)})).then((function(e){t.fireEvent("success",e)})).catch((function(e){t.fireEvent("error",e)})),t.fetchRequest=i,t};var i,r=(i=n("./src/util/observer.js"))&&i.__esModule?i:{default:i};function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instance=t,this.instance._reader=i.body.getReader(),this.total=parseInt(n,10),this.loaded=0}var t,n;return t=e,(n=[{key:"start",value:function(e){var t=this;!function n(){t.instance._reader.read().then((function(i){var r=i.done,s=i.value;if(r)return 0===t.total&&t.instance.onProgress.call(t.instance,{loaded:t.loaded,total:t.total,lengthComputable:!1}),void e.close();t.loaded+=s.byteLength,t.instance.onProgress.call(t.instance,{loaded:t.loaded,total:t.total,lengthComputable:!(0===t.total)}),e.enqueue(s),n()})).catch((function(t){e.error(t)}))}()}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports=t.default},"./src/util/frame.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(0,r.default)((function(){return e.apply(void 0,n)}))}};var i,r=(i=n("./src/util/request-animation-frame.js"))&&i.__esModule?i:{default:i};e.exports=t.default},"./src/util/get-id.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return void 0===e&&(e="wavesurfer_"),e+Math.random().toString(32).substring(2)},e.exports=t.default},"./src/util/index.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Observer",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"absMax",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"clamp",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"fetchFile",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"frame",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"getId",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"ignoreSilenceMode",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"max",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"min",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"preventClick",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"requestAnimationFrame",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"style",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"withOrientation",{enumerable:!0,get:function(){return g.default}});var i=v(n("./src/util/get-id.js")),r=v(n("./src/util/max.js")),s=v(n("./src/util/min.js")),o=v(n("./src/util/absMax.js")),a=v(n("./src/util/observer.js")),l=v(n("./src/util/style.js")),c=v(n("./src/util/request-animation-frame.js")),d=v(n("./src/util/frame.js")),h=v(n("./node_modules/debounce/index.js")),u=v(n("./src/util/prevent-click.js")),p=v(n("./src/util/fetch.js")),m=v(n("./src/util/clamp.js")),g=v(n("./src/util/orientation.js")),f=v(n("./src/util/silence-mode.js"));function v(e){return e&&e.__esModule?e:{default:e}}},"./src/util/max.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=-1/0;return Object.keys(e).forEach((function(n){e[n]>t&&(t=e[n])})),t},e.exports=t.default},"./src/util/min.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=Number(1/0);return Object.keys(e).forEach((function(n){e[n]<t&&(t=e[n])})),t},e.exports=t.default},"./src/util/observer.js":(e,t)=>{"use strict";function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._disabledEventEmissions=[],this.handlers=null}var t,i;return t=e,i=[{key:"on",value:function(e,t){var n=this;this.handlers||(this.handlers={});var i=this.handlers[e];return i||(i=this.handlers[e]=[]),i.push(t),{name:e,callback:t,un:function(e,t){return n.un(e,t)}}}},{key:"un",value:function(e,t){if(this.handlers){var n,i=this.handlers[e];if(i)if(t)for(n=i.length-1;n>=0;n--)i[n]==t&&i.splice(n,1);else i.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(e,t){var n=this;return this.on(e,(function i(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];t.apply(n,s),setTimeout((function(){n.un(e,i)}),0)}))}},{key:"setDisabledEventEmissions",value:function(e){this._disabledEventEmissions=e}},{key:"_isDisabledEventEmission",value:function(e){return this._disabledEventEmissions&&this._disabledEventEmissions.includes(e)}},{key:"fireEvent",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.handlers&&!this._isDisabledEventEmission(e)){var r=this.handlers[e];r&&r.forEach((function(e){e.apply(void 0,n)}))}}}],i&&n(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=i,e.exports=t.default},"./src/util/orientation.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n){return t[r]?t:new Proxy(t,{get:function(t,s,o){if(s===r)return!0;if("domElement"===s)return t;if("style"===s)return e(t.style,n);if("canvas"===s)return e(t.canvas,n);if("getBoundingClientRect"===s)return function(){return e(t.getBoundingClientRect.apply(t,arguments),n)};if("getContext"===s)return function(){return e(t.getContext.apply(t,arguments),n)};var a=t[i(s,n)];return"function"==typeof a?a.bind(t):a},set:function(e,t,r){return e[i(t,n)]=r,!0}})};var n={width:"height",height:"width",overflowX:"overflowY",overflowY:"overflowX",clientWidth:"clientHeight",clientHeight:"clientWidth",clientX:"clientY",clientY:"clientX",scrollWidth:"scrollHeight",scrollLeft:"scrollTop",offsetLeft:"offsetTop",offsetTop:"offsetLeft",offsetHeight:"offsetWidth",offsetWidth:"offsetHeight",left:"top",right:"bottom",top:"left",bottom:"right",borderRightStyle:"borderBottomStyle",borderRightWidth:"borderBottomWidth",borderRightColor:"borderBottomColor"};function i(e,t){return Object.prototype.hasOwnProperty.call(n,e)&&t?n[e]:e}var r=Symbol("isProxy");e.exports=t.default},"./src/util/prevent-click.js":(e,t)=>{"use strict";function n(e){e.stopPropagation(),document.body.removeEventListener("click",n,!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){document.body.addEventListener("click",n,!0)},e.exports=t.default},"./src/util/request-animation-frame.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return setTimeout(e,1e3/60)}).bind(window);t.default=n,e.exports=t.default},"./src/util/silence-mode.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=document.createElement("div");e.innerHTML='<audio x-webkit-airplay="deny"></audio>';var t=e.children.item(0);t.src="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",t.preload="auto",t.type="audio/mpeg",t.disableRemotePlayback=!0,t.play(),t.remove(),e.remove()},e.exports=t.default},"./src/util/style.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.keys(t).forEach((function(n){e.style[n]!==t[n]&&(e.style[n]=t[n])})),e},e.exports=t.default},"./src/wavesurfer.js":(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n("./src/util/index.js")),s=d(n("./src/drawer.multicanvas.js")),o=d(n("./src/webaudio.js")),a=d(n("./src/mediaelement.js")),l=d(n("./src/peakcache.js")),c=d(n("./src/mediaelement-webaudio.js"));function d(e){return e&&e.__esModule?e:{default:e}}function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function p(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(b,e);var t,n,i,d,h,y=(t=b,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=g(t);if(n){var r=g(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return p(this,e)});function b(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),f(m(t=y.call(this)),"defaultParams",{audioContext:null,audioScriptProcessor:null,audioRate:1,autoCenter:!0,autoCenterRate:5,autoCenterImmediately:!1,backend:"WebAudio",backgroundColor:null,barHeight:1,barRadius:0,barGap:null,barMinHeight:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,drawingContextAttributes:{desynchronized:!1},duration:null,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,hideCursor:!1,ignoreSilenceMode:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:s.default,responsive:!1,rtl:!1,scrollParent:!1,skipLength:2,splitChannels:!1,splitChannelsOptions:{overlay:!1,channelColors:{},filterChannels:[],relativeNormalization:!1},vertical:!1,waveColor:"#999",xhr:{}}),f(m(t),"backends",{MediaElement:a.default,WebAudio:o.default,MediaElementWebAudio:c.default}),f(m(t),"util",r),t.params=Object.assign({},t.defaultParams,e),t.params.splitChannelsOptions=Object.assign({},t.defaultParams.splitChannelsOptions,e.splitChannelsOptions),t.container="string"==typeof e.container?document.querySelector(t.params.container):t.params.container,!t.container)throw new Error("Container element not found");if(null==t.params.mediaContainer?t.mediaContainer=t.container:"string"==typeof t.params.mediaContainer?t.mediaContainer=document.querySelector(t.params.mediaContainer):t.mediaContainer=t.params.mediaContainer,!t.mediaContainer)throw new Error("Media Container element not found");if(t.params.maxCanvasWidth<=1)throw new Error("maxCanvasWidth must be greater than 1");if(t.params.maxCanvasWidth%2==1)throw new Error("maxCanvasWidth must be an even number");if(!0===t.params.rtl&&(!0===t.params.vertical?r.style(t.container,{transform:"rotateX(180deg)"}):r.style(t.container,{transform:"rotateY(180deg)"})),t.params.backgroundColor&&t.setBackgroundColor(t.params.backgroundColor),t.savedVolume=0,t.isMuted=!1,t.tmpEvents=[],t.currentRequest=null,t.arraybuffer=null,t.drawer=null,t.backend=null,t.peakCache=null,"function"!=typeof t.params.renderer)throw new Error("Renderer parameter is invalid");t.Drawer=t.params.renderer,"AudioElement"==t.params.backend&&(t.params.backend="MediaElement"),"WebAudio"!=t.params.backend&&"MediaElementWebAudio"!==t.params.backend||o.default.prototype.supportsWebAudio.call(null)||(t.params.backend="MediaElement"),t.Backend=t.backends[t.params.backend],t.initialisedPluginList={},t.isDestroyed=!1,t.isReady=!1;var n=0;return t._onResize=r.debounce((function(){t.drawer.wrapper&&n!=t.drawer.wrapper.clientWidth&&!t.params.scrollParent&&(n=t.drawer.wrapper.clientWidth)&&t.drawer.fireEvent("redraw")}),"number"==typeof t.params.responsive?t.params.responsive:100),p(t,m(t))}return i=b,d=[{key:"init",value:function(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}},{key:"registerPlugins",value:function(e){var t=this;return e.forEach((function(e){return t.addPlugin(e)})),e.forEach((function(e){e.deferInit||t.initPlugin(e.name)})),this.fireEvent("plugins-registered",e),this}},{key:"getActivePlugins",value:function(){return this.initialisedPluginList}},{key:"addPlugin",value:function(e){var t=this;if(!e.name)throw new Error("Plugin does not have a name!");if(!e.instance)throw new Error("Plugin ".concat(e.name," does not have an instance property!"));e.staticProps&&Object.keys(e.staticProps).forEach((function(n){t[n]=e.staticProps[n]}));var n=e.instance;return Object.getOwnPropertyNames(r.Observer.prototype).forEach((function(e){n.prototype[e]=r.Observer.prototype[e]})),this[e.name]=new n(e.params||{},this),this.fireEvent("plugin-added",e.name),this}},{key:"initPlugin",value:function(e){if(!this[e])throw new Error("Plugin ".concat(e," has not been added yet!"));return this.initialisedPluginList[e]&&this.destroyPlugin(e),this[e].init(),this.initialisedPluginList[e]=!0,this.fireEvent("plugin-initialised",e),this}},{key:"destroyPlugin",value:function(e){if(!this[e])throw new Error("Plugin ".concat(e," has not been added yet and cannot be destroyed!"));if(!this.initialisedPluginList[e])throw new Error("Plugin ".concat(e," is not active and cannot be destroyed!"));if("function"!=typeof this[e].destroy)throw new Error("Plugin ".concat(e," does not have a destroy function!"));return this[e].destroy(),delete this.initialisedPluginList[e],this.fireEvent("plugin-destroyed",e),this}},{key:"destroyAllPlugins",value:function(){var e=this;Object.keys(this.initialisedPluginList).forEach((function(t){return e.destroyPlugin(t)}))}},{key:"createDrawer",value:function(){var e=this;this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",(function(){e.drawBuffer(),e.drawer.progress(e.backend.getPlayedPercents())})),this.drawer.on("click",(function(t,n){setTimeout((function(){return e.seekTo(n)}),0)})),this.drawer.on("scroll",(function(t){e.params.partialRender&&e.drawBuffer(),e.fireEvent("scroll",t)}))}},{key:"createBackend",value:function(){var e=this;this.backend&&this.backend.destroy(),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",(function(){e.drawer.progress(e.backend.getPlayedPercents()),e.fireEvent("finish")})),this.backend.on("play",(function(){return e.fireEvent("play")})),this.backend.on("pause",(function(){return e.fireEvent("pause")})),this.backend.on("audioprocess",(function(t){e.drawer.progress(e.backend.getPlayedPercents()),e.fireEvent("audioprocess",t)})),"MediaElement"!==this.params.backend&&"MediaElementWebAudio"!==this.params.backend||(this.backend.on("seek",(function(){e.drawer.progress(e.backend.getPlayedPercents())})),this.backend.on("volume",(function(){var t=e.getVolume();e.fireEvent("volume",t),e.backend.isMuted!==e.isMuted&&(e.isMuted=e.backend.isMuted,e.fireEvent("mute",e.isMuted))})))}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new l.default)}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(e){e>=this.getDuration()?this.seekTo(1):this.seekTo(e/this.getDuration())}},{key:"play",value:function(e,t){var n=this;return this.params.ignoreSilenceMode&&r.ignoreSilenceMode(),this.fireEvent("interaction",(function(){return n.play(e,t)})),this.backend.play(e,t)}},{key:"setPlayEnd",value:function(e){this.backend.setPlayEnd(e)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(e){this.skip(-e||-this.params.skipLength)}},{key:"skipForward",value:function(e){this.skip(e||this.params.skipLength)}},{key:"skip",value:function(e){var t=this.getDuration()||1,n=this.getCurrentTime()||0;n=Math.max(0,Math.min(t,n+(e||0))),this.seekAndCenter(n/t)}},{key:"seekAndCenter",value:function(e){this.seekTo(e),this.drawer.recenter(e)}},{key:"seekTo",value:function(e){var t=this;if("number"!=typeof e||!isFinite(e)||e<0||e>1)throw new Error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",(function(){return t.seekTo(e)}));var n="WebAudio"===this.params.backend,i=this.backend.isPaused();n&&!i&&this.backend.pause();var r=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(e*this.getDuration()),this.drawer.progress(e),n&&!i&&this.backend.play(),this.params.scrollParent=r,this.fireEvent("seek",e)}},{key:"stop",value:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)}},{key:"setSinkId",value:function(e){return this.backend.setSinkId(e)}},{key:"setVolume",value:function(e){this.backend.setVolume(e),this.fireEvent("volume",e)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(e){this.backend.setPlaybackRate(e)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(e){e!==this.isMuted?(this.backend.setMute?(this.backend.setMute(e),this.isMuted=e):e?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)),this.fireEvent("mute",this.isMuted)):this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function(){return this.isMuted}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.params.splitChannelsOptions.channelColors[e]?this.params.splitChannelsOptions.channelColors[e].waveColor:this.params.waveColor}},{key:"setWaveColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.params.splitChannelsOptions.channelColors[t]?this.params.splitChannelsOptions.channelColors[t].waveColor=e:this.params.waveColor=e,this.drawBuffer()}},{key:"getProgressColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.params.splitChannelsOptions.channelColors[e]?this.params.splitChannelsOptions.channelColors[e].progressColor:this.params.progressColor}},{key:"setProgressColor",value:function(e,t){this.params.splitChannelsOptions.channelColors[t]?this.params.splitChannelsOptions.channelColors[t].progressColor=e:this.params.progressColor=e,this.drawBuffer()}},{key:"getBackgroundColor",value:function(){return this.params.backgroundColor}},{key:"setBackgroundColor",value:function(e){this.params.backgroundColor=e,r.style(this.container,{background:this.params.backgroundColor})}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(e){this.params.cursorColor=e,this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(e){this.params.height=e,this.drawer.setHeight(e*this.params.pixelRatio),this.drawBuffer()}},{key:"setFilteredChannels",value:function(e){this.params.splitChannelsOptions.filterChannels=e,this.drawBuffer()}},{key:"drawBuffer",value:function(){var e,t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),n=this.drawer.getWidth(),i=t,r=0,s=Math.max(r+n,i);if(this.params.fillParent&&(!this.params.scrollParent||t<n)&&(r=0,s=i=n),this.params.partialRender){var o,a=this.peakCache.addRangeToPeakCache(i,r,s);for(o=0;o<a.length;o++)e=this.backend.getPeaks(i,a[o][0],a[o][1]),this.drawer.drawPeaks(e,i,a[o][0],a[o][1])}else e=this.backend.getPeaks(i,r,s),this.drawer.drawPeaks(e,i,r,s);this.fireEvent("redraw",e,i)}},{key:"zoom",value:function(e){e?(this.params.minPxPerSec=e,this.params.scrollParent=!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,this.params.scrollParent=!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",e)}},{key:"loadArrayBuffer",value:function(e){var t=this;this.decodeArrayBuffer(e,(function(e){t.isDestroyed||t.loadDecodedBuffer(e)}))}},{key:"loadDecodedBuffer",value:function(e){this.backend.load(e),this.drawBuffer(),this.isReady=!0,this.fireEvent("ready")}},{key:"loadBlob",value:function(e){var t=this,n=new FileReader;n.addEventListener("progress",(function(e){return t.onProgress(e)})),n.addEventListener("load",(function(e){return t.loadArrayBuffer(e.target.result)})),n.addEventListener("error",(function(){return t.fireEvent("error","Error reading file")})),n.readAsArrayBuffer(e),this.empty()}},{key:"load",value:function(e,t,n,i){if(!e)throw new Error("url parameter cannot be empty");if(this.empty(),n){var r={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(n),"Peaks are not provided":!t,"Backend is not of type 'MediaElement' or 'MediaElementWebAudio'":-1===["MediaElement","MediaElementWebAudio"].indexOf(this.params.backend),"Url is not of type string":"string"!=typeof e},s=Object.keys(r).filter((function(e){return r[e]}));s.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+s.join("\n\t- ")),n=null)}switch("WebAudio"===this.params.backend&&e instanceof HTMLMediaElement&&(e=e.src),this.params.backend){case"WebAudio":return this.loadBuffer(e,t,i);case"MediaElement":case"MediaElementWebAudio":return this.loadMediaElement(e,t,n,i)}}},{key:"loadBuffer",value:function(e,t,n){var i=this,r=function(t){return t&&i.tmpEvents.push(i.once("ready",t)),i.getArrayBuffer(e,(function(e){return i.loadArrayBuffer(e)}))};if(!t)return r();this.backend.setPeaks(t,n),this.drawBuffer(),this.fireEvent("waveform-ready"),this.tmpEvents.push(this.once("interaction",r))}},{key:"loadMediaElement",value:function(e,t,n,i){var r=this,s=e;if("string"==typeof e)this.backend.load(s,this.mediaContainer,t,n);else{var o=e;this.backend.loadElt(o,t),s=o.src}this.tmpEvents.push(this.backend.once("canplay",(function(){r.backend.destroyed||(r.drawBuffer(),r.isReady=!0,r.fireEvent("ready"))})),this.backend.once("error",(function(e){return r.fireEvent("error",e)}))),t&&(this.backend.setPeaks(t,i),this.drawBuffer(),this.fireEvent("waveform-ready")),t&&!this.params.forceDecode||!this.backend.supportsWebAudio()||this.getArrayBuffer(s,(function(e){r.decodeArrayBuffer(e,(function(e){r.backend.buffer=e,r.backend.setPeaks(null),r.drawBuffer(),r.fireEvent("waveform-ready")}))}))}},{key:"decodeArrayBuffer",value:function(e,t){var n=this;this.isDestroyed||(this.arraybuffer=e,this.backend.decodeArrayBuffer(e,(function(i){n.isDestroyed||n.arraybuffer!=e||(t(i),n.arraybuffer=null)}),(function(){return n.fireEvent("error","Error decoding audiobuffer")})))}},{key:"getArrayBuffer",value:function(e,t){var n=this,i=Object.assign({url:e,responseType:"arraybuffer"},this.params.xhr),s=r.fetchFile(i);return this.currentRequest=s,this.tmpEvents.push(s.on("progress",(function(e){n.onProgress(e)})),s.on("success",(function(e){t(e),n.currentRequest=null})),s.on("error",(function(e){n.fireEvent("error",e),n.currentRequest=null}))),s}},{key:"onProgress",value:function(e){var t;t=e.lengthComputable?e.loaded/e.total:e.loaded/(e.loaded+1e6),this.fireEvent("loading",Math.round(100*t),e.target)}},{key:"exportPCM",value:function(e,t,n,i,r){e=e||1024,i=i||0,t=t||1e4,n=n||!1;var s=this.backend.getPeaks(e,i,r),o=[].map.call(s,(function(e){return Math.round(e*t)/t}));return new Promise((function(e,t){if(!n){var i=new Blob([JSON.stringify(o)],{type:"application/json;charset=utf-8"}),r=URL.createObjectURL(i);window.open(r),URL.revokeObjectURL(r)}e(o)}))}},{key:"exportImage",value:function(e,t,n){return e||(e="image/png"),t||(t=1),n||(n="dataURL"),this.drawer.getImage(e,t,n)}},{key:"cancelAjax",value:function(){this.currentRequest&&this.currentRequest.controller&&(this.currentRequest._reader&&this.currentRequest._reader.cancel().catch((function(e){})),this.currentRequest.controller.abort(),this.currentRequest=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach((function(e){return e.un()}))}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend&&(this.backend.destroy(),this.backend=null),this.drawer&&this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}],h=[{key:"create",value:function(e){return new b(e).init()}}],d&&v(i.prototype,d),h&&v(i,h),Object.defineProperty(i,"prototype",{writable:!1}),b}(r.Observer);t.default=y,f(y,"VERSION","6.2.0"),f(y,"util",r),e.exports=t.default},"./src/webaudio.js":(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=o?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(r,a,l):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}(n("./src/util/index.js"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u="playing",p="paused",m="finished",g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(g,e);var t,n,i,r,s=(i=g,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(i);if(r){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return l(this,e)});function g(e){var t,n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),h(c(i=s.call(this)),"audioContext",null),h(c(i),"offlineAudioContext",null),h(c(i),"stateBehaviors",(h(t={},u,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),h(t,p,{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition}}),h(t,m,{init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),t)),i.params=e,i.ac=e.audioContext||(i.supportsWebAudio()?i.getAudioContext():{}),i.lastPlay=i.ac.currentTime,i.startPosition=0,i.scheduledPause=null,i.states=(h(n={},u,Object.create(i.stateBehaviors.playing)),h(n,p,Object.create(i.stateBehaviors.paused)),h(n,m,Object.create(i.stateBehaviors.finished)),n),i.buffer=null,i.filters=[],i.gainNode=null,i.mergedPeaks=null,i.offlineAc=null,i.peaks=null,i.playbackRate=1,i.analyser=null,i.scriptNode=null,i.source=null,i.splitPeaks=[],i.state=null,i.explicitDuration=e.duration,i.sinkStreamDestination=null,i.sinkAudioElement=null,i.destroyed=!1,i}return t=g,n=[{key:"supportsWebAudio",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(e){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),window.WaveSurferOfflineAudioContext}},{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(p),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach((function(e){e&&e.disconnect()})),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(e){this.state!==this.states[e]&&(this.state=this.states[e],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.setFilters(t)}},{key:"setFilters",value:function(e){this.disconnectFilters(),e&&e.length&&(this.filters=e,this.analyser.disconnect(),e.reduce((function(e,t){return e.connect(t),t}),this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.params.audioScriptProcessor?this.scriptNode=this.params.audioScriptProcessor:this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(g.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(g.scriptBufferSize),this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var e=this;this.scriptNode.onaudioprocess=function(){var t=e.getCurrentTime();t>=e.getDuration()?(e.setState(m),e.fireEvent("pause")):t>=e.scheduledPause?e.pause():e.state===e.states.playing&&e.fireEvent("audioprocess",t)}}},{key:"removeOnAudioProcess",value:function(){this.scriptNode.onaudioprocess=null}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(e){return e?(this.sinkAudioElement||(this.sinkAudioElement=new window.Audio,this.sinkAudioElement.autoplay=!0),this.sinkAudioElement.setSinkId?(this.sinkStreamDestination||(this.sinkStreamDestination=this.ac.createMediaStreamDestination()),this.gainNode.disconnect(),this.gainNode.connect(this.sinkStreamDestination),this.sinkAudioElement.srcObject=this.sinkStreamDestination.stream,this.sinkAudioElement.setSinkId(e)):Promise.reject(new Error("setSinkId is not supported in your browser"))):Promise.reject(new Error("Invalid deviceId: "+e))}},{key:"setVolume",value:function(e){this.gainNode.gain.setValueAtTime(e,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(e,t,n){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),"webkitAudioContext"in window?this.offlineAc.decodeAudioData(e,(function(e){return t(e)}),n):this.offlineAc.decodeAudioData(e).then((function(e){return t(e)})).catch((function(e){return n(e)}))}},{key:"setPeaks",value:function(e,t){null!=t&&(this.explicitDuration=t),this.peaks=e}},{key:"setLength",value:function(e){if(!this.mergedPeaks||e!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[],this.mergedPeaks=[];var t,n=this.buffer?this.buffer.numberOfChannels:1;for(t=0;t<n;t++)this.splitPeaks[t]=[],this.splitPeaks[t][2*(e-1)]=0,this.splitPeaks[t][2*(e-1)+1]=0;this.mergedPeaks[2*(e-1)]=0,this.mergedPeaks[2*(e-1)+1]=0}}},{key:"getPeaks",value:function(e,t,n){if(this.peaks)return this.peaks;if(!this.buffer)return[];if(t=t||0,n=n||e-1,this.setLength(e),!this.buffer)return this.params.splitChannels?this.splitPeaks:this.mergedPeaks;if(!this.buffer.length){var i=this.createBuffer(1,4096,this.sampleRate);this.buffer=i.buffer}var r,s=this.buffer.length/e,o=~~(s/10)||1,a=this.buffer.numberOfChannels;for(r=0;r<a;r++){var l=this.splitPeaks[r],c=this.buffer.getChannelData(r),d=void 0;for(d=t;d<=n;d++){var h=~~(d*s),u=~~(h+s),p=c[h],m=p,g=void 0;for(g=h;g<u;g+=o){var f=c[g];f>m&&(m=f),f<p&&(p=f)}l[2*d]=m,l[2*d+1]=p,(0==r||m>this.mergedPeaks[2*d])&&(this.mergedPeaks[2*d]=m),(0==r||p<this.mergedPeaks[2*d+1])&&(this.mergedPeaks[2*d+1]=p)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroyWebAudio",value:function(){this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null),this.sinkStreamDestination&&(this.sinkAudioElement.pause(),this.sinkAudioElement.srcObject=null,this.sinkStreamDestination.disconnect(),this.sinkStreamDestination=null)}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.destroyed=!0,this.destroyWebAudio()}},{key:"load",value:function(e){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=e,this.createSource()}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.setPlaybackRate(this.playbackRate),this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"resumeAudioContext",value:function(){"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume()}},{key:"isPaused",value:function(){return this.state!==this.states.playing}},{key:"getDuration",value:function(){return this.explicitDuration?this.explicitDuration:this.buffer?this.buffer.duration:0}},{key:"seekTo",value:function(e,t){if(this.buffer)return this.scheduledPause=null,null==e&&(e=this.getCurrentTime())>=this.getDuration()&&(e=0),null==t&&(t=this.getDuration()),this.startPosition=e,this.lastPlay=this.ac.currentTime,this.state===this.states.finished&&this.setState(p),{start:e,end:t}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(e,t){if(this.buffer){this.createSource();var n=this.seekTo(e,t);e=n.start,t=n.end,this.scheduledPause=t,this.source.start(0,e),this.resumeAudioContext(),this.setState(u),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime();try{this.source&&this.source.stop(0)}catch(e){}this.setState(p),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(e){this.playbackRate=e||1,this.source&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime)}},{key:"setPlayEnd",value:function(e){this.scheduledPause=e}}],n&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),g}(r.Observer);t.default=g,h(g,"scriptBufferSize",256),e.exports=t.default},"./node_modules/debounce/index.js":e=>{function t(e,t,n){var i,r,s,o,a;function l(){var c=Date.now()-o;c<t&&c>=0?i=setTimeout(l,t-c):(i=null,n||(a=e.apply(s,r),s=r=null))}null==t&&(t=100);var c=function(){s=this,r=arguments,o=Date.now();var c=n&&!i;return i||(i=setTimeout(l,t)),c&&(a=e.apply(s,r),s=r=null),a};return c.clear=function(){i&&(clearTimeout(i),i=null)},c.flush=function(){i&&(a=e.apply(s,r),s=r=null,clearTimeout(i),i=null)},c}t.debounce=t,e.exports=t}},t={},n=function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}("./src/wavesurfer.js");return n})(),e.exports=t()},3394:(e,t,n)=>{e.exports=function(){return new Worker(n.p+"pdf.worker.ae455e55afd44a5e7ccd.js")}},7129:e=>{"use strict";e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTYiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAxNiAyOCI+PGcgaWQ9Imljb21vb24taWdub3JlIj48L2c+PHBhdGggZD0iTTE2IDE3cTAgMC40MDYtMC4yOTcgMC43MDNsLTcgN3EtMC4yOTcgMC4yOTctMC43MDMgMC4yOTd0LTAuNzAzLTAuMjk3bC03LTdxLTAuMjk3LTAuMjk3LTAuMjk3LTAuNzAzdDAuMjk3LTAuNzAzIDAuNzAzLTAuMjk3aDE0cTAuNDA2IDAgMC43MDMgMC4yOTd0MC4yOTcgMC43MDN6TTE2IDExcTAgMC40MDYtMC4yOTcgMC43MDN0LTAuNzAzIDAuMjk3aC0xNHEtMC40MDYgMC0wLjcwMy0wLjI5N3QtMC4yOTctMC43MDMgMC4yOTctMC43MDNsNy03cTAuMjk3LTAuMjk3IDAuNzAzLTAuMjk3dDAuNzAzIDAuMjk3bDcgN3EwLjI5NyAwLjI5NyAwLjI5NyAwLjcwM3oiIGZpbGw9IiMwMDAwMDAiPjwvcGF0aD48L3N2Zz4="},8211:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItbWFwLXBpbiI+PHBhdGggZD0iTTIxIDEwYzAgNy05IDEzLTkgMTNzLTktNi05LTEzYTkgOSAwIDAgMSAxOCAweiI+PC9wYXRoPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTAiIHI9IjMiPjwvY2lyY2xlPjwvc3ZnPg=="},5685:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImZlYXRoZXIgZmVhdGhlci1tYXAtcGluIj48cGF0aCBkPSJNMjEgMTBjMCA3LTkgMTMtOSAxM3MtOS02LTktMTNhOSA5IDAgMCAxIDE4IDB6Ij48L3BhdGg+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMCIgcj0iMyI+PC9jaXJjbGU+PC9zdmc+"},4654:()=>{},3414:()=>{},172:()=>{},2001:()=>{},3779:()=>{},6558:()=>{},2258:()=>{},2868:()=>{},4777:()=>{},9830:()=>{},209:()=>{},7414:()=>{},8416:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},4836:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},2961:e=>{e.exports={nanoid:(e=21)=>{let t="",n=e;for(;n--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t},customAlphabet:(e,t=21)=>(n=t)=>{let i="",r=n;for(;r--;)i+=e[Math.random()*e.length|0];return i}}},3600:e=>{"use strict";e.exports=JSON.parse('{"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}')},9323:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"","aacute":"","Abreve":"","abreve":"","ac":"","acd":"","acE":"","Acirc":"","acirc":"","acute":"","Acy":"","acy":"","AElig":"","aelig":"","af":"","Afr":"","afr":"","Agrave":"","agrave":"","alefsym":"","aleph":"","Alpha":"","alpha":"","Amacr":"","amacr":"","amalg":"","amp":"&","AMP":"&","andand":"","And":"","and":"","andd":"","andslope":"","andv":"","ang":"","ange":"","angle":"","angmsdaa":"","angmsdab":"","angmsdac":"","angmsdad":"","angmsdae":"","angmsdaf":"","angmsdag":"","angmsdah":"","angmsd":"","angrt":"","angrtvb":"","angrtvbd":"","angsph":"","angst":"","angzarr":"","Aogon":"","aogon":"","Aopf":"","aopf":"","apacir":"","ap":"","apE":"","ape":"","apid":"","apos":"\'","ApplyFunction":"","approx":"","approxeq":"","Aring":"","aring":"","Ascr":"","ascr":"","Assign":"","ast":"*","asymp":"","asympeq":"","Atilde":"","atilde":"","Auml":"","auml":"","awconint":"","awint":"","backcong":"","backepsilon":"","backprime":"","backsim":"","backsimeq":"","Backslash":"","Barv":"","barvee":"","barwed":"","Barwed":"","barwedge":"","bbrk":"","bbrktbrk":"","bcong":"","Bcy":"","bcy":"","bdquo":"","becaus":"","because":"","Because":"","bemptyv":"","bepsi":"","bernou":"","Bernoullis":"","Beta":"","beta":"","beth":"","between":"","Bfr":"","bfr":"","bigcap":"","bigcirc":"","bigcup":"","bigodot":"","bigoplus":"","bigotimes":"","bigsqcup":"","bigstar":"","bigtriangledown":"","bigtriangleup":"","biguplus":"","bigvee":"","bigwedge":"","bkarow":"","blacklozenge":"","blacksquare":"","blacktriangle":"","blacktriangledown":"","blacktriangleleft":"","blacktriangleright":"","blank":"","blk12":"","blk14":"","blk34":"","block":"","bne":"=","bnequiv":"","bNot":"","bnot":"","Bopf":"","bopf":"","bot":"","bottom":"","bowtie":"","boxbox":"","boxdl":"","boxdL":"","boxDl":"","boxDL":"","boxdr":"","boxdR":"","boxDr":"","boxDR":"","boxh":"","boxH":"","boxhd":"","boxHd":"","boxhD":"","boxHD":"","boxhu":"","boxHu":"","boxhU":"","boxHU":"","boxminus":"","boxplus":"","boxtimes":"","boxul":"","boxuL":"","boxUl":"","boxUL":"","boxur":"","boxuR":"","boxUr":"","boxUR":"","boxv":"","boxV":"","boxvh":"","boxvH":"","boxVh":"","boxVH":"","boxvl":"","boxvL":"","boxVl":"","boxVL":"","boxvr":"","boxvR":"","boxVr":"","boxVR":"","bprime":"","breve":"","Breve":"","brvbar":"","bscr":"","Bscr":"","bsemi":"","bsim":"","bsime":"","bsolb":"","bsol":"\\\\","bsolhsub":"","bull":"","bullet":"","bump":"","bumpE":"","bumpe":"","Bumpeq":"","bumpeq":"","Cacute":"","cacute":"","capand":"","capbrcup":"","capcap":"","cap":"","Cap":"","capcup":"","capdot":"","CapitalDifferentialD":"","caps":"","caret":"","caron":"","Cayleys":"","ccaps":"","Ccaron":"","ccaron":"","Ccedil":"","ccedil":"","Ccirc":"","ccirc":"","Cconint":"","ccups":"","ccupssm":"","Cdot":"","cdot":"","cedil":"","Cedilla":"","cemptyv":"","cent":"","centerdot":"","CenterDot":"","cfr":"","Cfr":"","CHcy":"","chcy":"","check":"","checkmark":"","Chi":"","chi":"","circ":"","circeq":"","circlearrowleft":"","circlearrowright":"","circledast":"","circledcirc":"","circleddash":"","CircleDot":"","circledR":"","circledS":"","CircleMinus":"","CirclePlus":"","CircleTimes":"","cir":"","cirE":"","cire":"","cirfnint":"","cirmid":"","cirscir":"","ClockwiseContourIntegral":"","CloseCurlyDoubleQuote":"","CloseCurlyQuote":"","clubs":"","clubsuit":"","colon":":","Colon":"","Colone":"","colone":"","coloneq":"","comma":",","commat":"@","comp":"","compfn":"","complement":"","complexes":"","cong":"","congdot":"","Congruent":"","conint":"","Conint":"","ContourIntegral":"","copf":"","Copf":"","coprod":"","Coproduct":"","copy":"","COPY":"","copysr":"","CounterClockwiseContourIntegral":"","crarr":"","cross":"","Cross":"","Cscr":"","cscr":"","csub":"","csube":"","csup":"","csupe":"","ctdot":"","cudarrl":"","cudarrr":"","cuepr":"","cuesc":"","cularr":"","cularrp":"","cupbrcap":"","cupcap":"","CupCap":"","cup":"","Cup":"","cupcup":"","cupdot":"","cupor":"","cups":"","curarr":"","curarrm":"","curlyeqprec":"","curlyeqsucc":"","curlyvee":"","curlywedge":"","curren":"","curvearrowleft":"","curvearrowright":"","cuvee":"","cuwed":"","cwconint":"","cwint":"","cylcty":"","dagger":"","Dagger":"","daleth":"","darr":"","Darr":"","dArr":"","dash":"","Dashv":"","dashv":"","dbkarow":"","dblac":"","Dcaron":"","dcaron":"","Dcy":"","dcy":"","ddagger":"","ddarr":"","DD":"","dd":"","DDotrahd":"","ddotseq":"","deg":"","Del":"","Delta":"","delta":"","demptyv":"","dfisht":"","Dfr":"","dfr":"","dHar":"","dharl":"","dharr":"","DiacriticalAcute":"","DiacriticalDot":"","DiacriticalDoubleAcute":"","DiacriticalGrave":"`","DiacriticalTilde":"","diam":"","diamond":"","Diamond":"","diamondsuit":"","diams":"","die":"","DifferentialD":"","digamma":"","disin":"","div":"","divide":"","divideontimes":"","divonx":"","DJcy":"","djcy":"","dlcorn":"","dlcrop":"","dollar":"$","Dopf":"","dopf":"","Dot":"","dot":"","DotDot":"","doteq":"","doteqdot":"","DotEqual":"","dotminus":"","dotplus":"","dotsquare":"","doublebarwedge":"","DoubleContourIntegral":"","DoubleDot":"","DoubleDownArrow":"","DoubleLeftArrow":"","DoubleLeftRightArrow":"","DoubleLeftTee":"","DoubleLongLeftArrow":"","DoubleLongLeftRightArrow":"","DoubleLongRightArrow":"","DoubleRightArrow":"","DoubleRightTee":"","DoubleUpArrow":"","DoubleUpDownArrow":"","DoubleVerticalBar":"","DownArrowBar":"","downarrow":"","DownArrow":"","Downarrow":"","DownArrowUpArrow":"","DownBreve":"","downdownarrows":"","downharpoonleft":"","downharpoonright":"","DownLeftRightVector":"","DownLeftTeeVector":"","DownLeftVectorBar":"","DownLeftVector":"","DownRightTeeVector":"","DownRightVectorBar":"","DownRightVector":"","DownTeeArrow":"","DownTee":"","drbkarow":"","drcorn":"","drcrop":"","Dscr":"","dscr":"","DScy":"","dscy":"","dsol":"","Dstrok":"","dstrok":"","dtdot":"","dtri":"","dtrif":"","duarr":"","duhar":"","dwangle":"","DZcy":"","dzcy":"","dzigrarr":"","Eacute":"","eacute":"","easter":"","Ecaron":"","ecaron":"","Ecirc":"","ecirc":"","ecir":"","ecolon":"","Ecy":"","ecy":"","eDDot":"","Edot":"","edot":"","eDot":"","ee":"","efDot":"","Efr":"","efr":"","eg":"","Egrave":"","egrave":"","egs":"","egsdot":"","el":"","Element":"","elinters":"","ell":"","els":"","elsdot":"","Emacr":"","emacr":"","empty":"","emptyset":"","EmptySmallSquare":"","emptyv":"","EmptyVerySmallSquare":"","emsp13":"","emsp14":"","emsp":"","ENG":"","eng":"","ensp":"","Eogon":"","eogon":"","Eopf":"","eopf":"","epar":"","eparsl":"","eplus":"","epsi":"","Epsilon":"","epsilon":"","epsiv":"","eqcirc":"","eqcolon":"","eqsim":"","eqslantgtr":"","eqslantless":"","Equal":"","equals":"=","EqualTilde":"","equest":"","Equilibrium":"","equiv":"","equivDD":"","eqvparsl":"","erarr":"","erDot":"","escr":"","Escr":"","esdot":"","Esim":"","esim":"","Eta":"","eta":"","ETH":"","eth":"","Euml":"","euml":"","euro":"","excl":"!","exist":"","Exists":"","expectation":"","exponentiale":"","ExponentialE":"","fallingdotseq":"","Fcy":"","fcy":"","female":"","ffilig":"","fflig":"","ffllig":"","Ffr":"","ffr":"","filig":"","FilledSmallSquare":"","FilledVerySmallSquare":"","fjlig":"fj","flat":"","fllig":"","fltns":"","fnof":"","Fopf":"","fopf":"","forall":"","ForAll":"","fork":"","forkv":"","Fouriertrf":"","fpartint":"","frac12":"","frac13":"","frac14":"","frac15":"","frac16":"","frac18":"","frac23":"","frac25":"","frac34":"","frac35":"","frac38":"","frac45":"","frac56":"","frac58":"","frac78":"","frasl":"","frown":"","fscr":"","Fscr":"","gacute":"","Gamma":"","gamma":"","Gammad":"","gammad":"","gap":"","Gbreve":"","gbreve":"","Gcedil":"","Gcirc":"","gcirc":"","Gcy":"","gcy":"","Gdot":"","gdot":"","ge":"","gE":"","gEl":"","gel":"","geq":"","geqq":"","geqslant":"","gescc":"","ges":"","gesdot":"","gesdoto":"","gesdotol":"","gesl":"","gesles":"","Gfr":"","gfr":"","gg":"","Gg":"","ggg":"","gimel":"","GJcy":"","gjcy":"","gla":"","gl":"","glE":"","glj":"","gnap":"","gnapprox":"","gne":"","gnE":"","gneq":"","gneqq":"","gnsim":"","Gopf":"","gopf":"","grave":"`","GreaterEqual":"","GreaterEqualLess":"","GreaterFullEqual":"","GreaterGreater":"","GreaterLess":"","GreaterSlantEqual":"","GreaterTilde":"","Gscr":"","gscr":"","gsim":"","gsime":"","gsiml":"","gtcc":"","gtcir":"","gt":">","GT":">","Gt":"","gtdot":"","gtlPar":"","gtquest":"","gtrapprox":"","gtrarr":"","gtrdot":"","gtreqless":"","gtreqqless":"","gtrless":"","gtrsim":"","gvertneqq":"","gvnE":"","Hacek":"","hairsp":"","half":"","hamilt":"","HARDcy":"","hardcy":"","harrcir":"","harr":"","hArr":"","harrw":"","Hat":"^","hbar":"","Hcirc":"","hcirc":"","hearts":"","heartsuit":"","hellip":"","hercon":"","hfr":"","Hfr":"","HilbertSpace":"","hksearow":"","hkswarow":"","hoarr":"","homtht":"","hookleftarrow":"","hookrightarrow":"","hopf":"","Hopf":"","horbar":"","HorizontalLine":"","hscr":"","Hscr":"","hslash":"","Hstrok":"","hstrok":"","HumpDownHump":"","HumpEqual":"","hybull":"","hyphen":"","Iacute":"","iacute":"","ic":"","Icirc":"","icirc":"","Icy":"","icy":"","Idot":"","IEcy":"","iecy":"","iexcl":"","iff":"","ifr":"","Ifr":"","Igrave":"","igrave":"","ii":"","iiiint":"","iiint":"","iinfin":"","iiota":"","IJlig":"","ijlig":"","Imacr":"","imacr":"","image":"","ImaginaryI":"","imagline":"","imagpart":"","imath":"","Im":"","imof":"","imped":"","Implies":"","incare":"","in":"","infin":"","infintie":"","inodot":"","intcal":"","int":"","Int":"","integers":"","Integral":"","intercal":"","Intersection":"","intlarhk":"","intprod":"","InvisibleComma":"","InvisibleTimes":"","IOcy":"","iocy":"","Iogon":"","iogon":"","Iopf":"","iopf":"","Iota":"","iota":"","iprod":"","iquest":"","iscr":"","Iscr":"","isin":"","isindot":"","isinE":"","isins":"","isinsv":"","isinv":"","it":"","Itilde":"","itilde":"","Iukcy":"","iukcy":"","Iuml":"","iuml":"","Jcirc":"","jcirc":"","Jcy":"","jcy":"","Jfr":"","jfr":"","jmath":"","Jopf":"","jopf":"","Jscr":"","jscr":"","Jsercy":"","jsercy":"","Jukcy":"","jukcy":"","Kappa":"","kappa":"","kappav":"","Kcedil":"","kcedil":"","Kcy":"","kcy":"","Kfr":"","kfr":"","kgreen":"","KHcy":"","khcy":"","KJcy":"","kjcy":"","Kopf":"","kopf":"","Kscr":"","kscr":"","lAarr":"","Lacute":"","lacute":"","laemptyv":"","lagran":"","Lambda":"","lambda":"","lang":"","Lang":"","langd":"","langle":"","lap":"","Laplacetrf":"","laquo":"","larrb":"","larrbfs":"","larr":"","Larr":"","lArr":"","larrfs":"","larrhk":"","larrlp":"","larrpl":"","larrsim":"","larrtl":"","latail":"","lAtail":"","lat":"","late":"","lates":"","lbarr":"","lBarr":"","lbbrk":"","lbrace":"{","lbrack":"[","lbrke":"","lbrksld":"","lbrkslu":"","Lcaron":"","lcaron":"","Lcedil":"","lcedil":"","lceil":"","lcub":"{","Lcy":"","lcy":"","ldca":"","ldquo":"","ldquor":"","ldrdhar":"","ldrushar":"","ldsh":"","le":"","lE":"","LeftAngleBracket":"","LeftArrowBar":"","leftarrow":"","LeftArrow":"","Leftarrow":"","LeftArrowRightArrow":"","leftarrowtail":"","LeftCeiling":"","LeftDoubleBracket":"","LeftDownTeeVector":"","LeftDownVectorBar":"","LeftDownVector":"","LeftFloor":"","leftharpoondown":"","leftharpoonup":"","leftleftarrows":"","leftrightarrow":"","LeftRightArrow":"","Leftrightarrow":"","leftrightarrows":"","leftrightharpoons":"","leftrightsquigarrow":"","LeftRightVector":"","LeftTeeArrow":"","LeftTee":"","LeftTeeVector":"","leftthreetimes":"","LeftTriangleBar":"","LeftTriangle":"","LeftTriangleEqual":"","LeftUpDownVector":"","LeftUpTeeVector":"","LeftUpVectorBar":"","LeftUpVector":"","LeftVectorBar":"","LeftVector":"","lEg":"","leg":"","leq":"","leqq":"","leqslant":"","lescc":"","les":"","lesdot":"","lesdoto":"","lesdotor":"","lesg":"","lesges":"","lessapprox":"","lessdot":"","lesseqgtr":"","lesseqqgtr":"","LessEqualGreater":"","LessFullEqual":"","LessGreater":"","lessgtr":"","LessLess":"","lesssim":"","LessSlantEqual":"","LessTilde":"","lfisht":"","lfloor":"","Lfr":"","lfr":"","lg":"","lgE":"","lHar":"","lhard":"","lharu":"","lharul":"","lhblk":"","LJcy":"","ljcy":"","llarr":"","ll":"","Ll":"","llcorner":"","Lleftarrow":"","llhard":"","lltri":"","Lmidot":"","lmidot":"","lmoustache":"","lmoust":"","lnap":"","lnapprox":"","lne":"","lnE":"","lneq":"","lneqq":"","lnsim":"","loang":"","loarr":"","lobrk":"","longleftarrow":"","LongLeftArrow":"","Longleftarrow":"","longleftrightarrow":"","LongLeftRightArrow":"","Longleftrightarrow":"","longmapsto":"","longrightarrow":"","LongRightArrow":"","Longrightarrow":"","looparrowleft":"","looparrowright":"","lopar":"","Lopf":"","lopf":"","loplus":"","lotimes":"","lowast":"","lowbar":"_","LowerLeftArrow":"","LowerRightArrow":"","loz":"","lozenge":"","lozf":"","lpar":"(","lparlt":"","lrarr":"","lrcorner":"","lrhar":"","lrhard":"","lrm":"","lrtri":"","lsaquo":"","lscr":"","Lscr":"","lsh":"","Lsh":"","lsim":"","lsime":"","lsimg":"","lsqb":"[","lsquo":"","lsquor":"","Lstrok":"","lstrok":"","ltcc":"","ltcir":"","lt":"<","LT":"<","Lt":"","ltdot":"","lthree":"","ltimes":"","ltlarr":"","ltquest":"","ltri":"","ltrie":"","ltrif":"","ltrPar":"","lurdshar":"","luruhar":"","lvertneqq":"","lvnE":"","macr":"","male":"","malt":"","maltese":"","Map":"","map":"","mapsto":"","mapstodown":"","mapstoleft":"","mapstoup":"","marker":"","mcomma":"","Mcy":"","mcy":"","mdash":"","mDDot":"","measuredangle":"","MediumSpace":"","Mellintrf":"","Mfr":"","mfr":"","mho":"","micro":"","midast":"*","midcir":"","mid":"","middot":"","minusb":"","minus":"","minusd":"","minusdu":"","MinusPlus":"","mlcp":"","mldr":"","mnplus":"","models":"","Mopf":"","mopf":"","mp":"","mscr":"","Mscr":"","mstpos":"","Mu":"","mu":"","multimap":"","mumap":"","nabla":"","Nacute":"","nacute":"","nang":"","nap":"","napE":"","napid":"","napos":"","napprox":"","natural":"","naturals":"","natur":"","nbsp":"","nbump":"","nbumpe":"","ncap":"","Ncaron":"","ncaron":"","Ncedil":"","ncedil":"","ncong":"","ncongdot":"","ncup":"","Ncy":"","ncy":"","ndash":"","nearhk":"","nearr":"","neArr":"","nearrow":"","ne":"","nedot":"","NegativeMediumSpace":"","NegativeThickSpace":"","NegativeThinSpace":"","NegativeVeryThinSpace":"","nequiv":"","nesear":"","nesim":"","NestedGreaterGreater":"","NestedLessLess":"","NewLine":"\\n","nexist":"","nexists":"","Nfr":"","nfr":"","ngE":"","nge":"","ngeq":"","ngeqq":"","ngeqslant":"","nges":"","nGg":"","ngsim":"","nGt":"","ngt":"","ngtr":"","nGtv":"","nharr":"","nhArr":"","nhpar":"","ni":"","nis":"","nisd":"","niv":"","NJcy":"","njcy":"","nlarr":"","nlArr":"","nldr":"","nlE":"","nle":"","nleftarrow":"","nLeftarrow":"","nleftrightarrow":"","nLeftrightarrow":"","nleq":"","nleqq":"","nleqslant":"","nles":"","nless":"","nLl":"","nlsim":"","nLt":"","nlt":"","nltri":"","nltrie":"","nLtv":"","nmid":"","NoBreak":"","NonBreakingSpace":"","nopf":"","Nopf":"","Not":"","not":"","NotCongruent":"","NotCupCap":"","NotDoubleVerticalBar":"","NotElement":"","NotEqual":"","NotEqualTilde":"","NotExists":"","NotGreater":"","NotGreaterEqual":"","NotGreaterFullEqual":"","NotGreaterGreater":"","NotGreaterLess":"","NotGreaterSlantEqual":"","NotGreaterTilde":"","NotHumpDownHump":"","NotHumpEqual":"","notin":"","notindot":"","notinE":"","notinva":"","notinvb":"","notinvc":"","NotLeftTriangleBar":"","NotLeftTriangle":"","NotLeftTriangleEqual":"","NotLess":"","NotLessEqual":"","NotLessGreater":"","NotLessLess":"","NotLessSlantEqual":"","NotLessTilde":"","NotNestedGreaterGreater":"","NotNestedLessLess":"","notni":"","notniva":"","notnivb":"","notnivc":"","NotPrecedes":"","NotPrecedesEqual":"","NotPrecedesSlantEqual":"","NotReverseElement":"","NotRightTriangleBar":"","NotRightTriangle":"","NotRightTriangleEqual":"","NotSquareSubset":"","NotSquareSubsetEqual":"","NotSquareSuperset":"","NotSquareSupersetEqual":"","NotSubset":"","NotSubsetEqual":"","NotSucceeds":"","NotSucceedsEqual":"","NotSucceedsSlantEqual":"","NotSucceedsTilde":"","NotSuperset":"","NotSupersetEqual":"","NotTilde":"","NotTildeEqual":"","NotTildeFullEqual":"","NotTildeTilde":"","NotVerticalBar":"","nparallel":"","npar":"","nparsl":"","npart":"","npolint":"","npr":"","nprcue":"","nprec":"","npreceq":"","npre":"","nrarrc":"","nrarr":"","nrArr":"","nrarrw":"","nrightarrow":"","nRightarrow":"","nrtri":"","nrtrie":"","nsc":"","nsccue":"","nsce":"","Nscr":"","nscr":"","nshortmid":"","nshortparallel":"","nsim":"","nsime":"","nsimeq":"","nsmid":"","nspar":"","nsqsube":"","nsqsupe":"","nsub":"","nsubE":"","nsube":"","nsubset":"","nsubseteq":"","nsubseteqq":"","nsucc":"","nsucceq":"","nsup":"","nsupE":"","nsupe":"","nsupset":"","nsupseteq":"","nsupseteqq":"","ntgl":"","Ntilde":"","ntilde":"","ntlg":"","ntriangleleft":"","ntrianglelefteq":"","ntriangleright":"","ntrianglerighteq":"","Nu":"","nu":"","num":"#","numero":"","numsp":"","nvap":"","nvdash":"","nvDash":"","nVdash":"","nVDash":"","nvge":"","nvgt":">","nvHarr":"","nvinfin":"","nvlArr":"","nvle":"","nvlt":"<","nvltrie":"","nvrArr":"","nvrtrie":"","nvsim":"","nwarhk":"","nwarr":"","nwArr":"","nwarrow":"","nwnear":"","Oacute":"","oacute":"","oast":"","Ocirc":"","ocirc":"","ocir":"","Ocy":"","ocy":"","odash":"","Odblac":"","odblac":"","odiv":"","odot":"","odsold":"","OElig":"","oelig":"","ofcir":"","Ofr":"","ofr":"","ogon":"","Ograve":"","ograve":"","ogt":"","ohbar":"","ohm":"","oint":"","olarr":"","olcir":"","olcross":"","oline":"","olt":"","Omacr":"","omacr":"","Omega":"","omega":"","Omicron":"","omicron":"","omid":"","ominus":"","Oopf":"","oopf":"","opar":"","OpenCurlyDoubleQuote":"","OpenCurlyQuote":"","operp":"","oplus":"","orarr":"","Or":"","or":"","ord":"","order":"","orderof":"","ordf":"","ordm":"","origof":"","oror":"","orslope":"","orv":"","oS":"","Oscr":"","oscr":"","Oslash":"","oslash":"","osol":"","Otilde":"","otilde":"","otimesas":"","Otimes":"","otimes":"","Ouml":"","ouml":"","ovbar":"","OverBar":"","OverBrace":"","OverBracket":"","OverParenthesis":"","para":"","parallel":"","par":"","parsim":"","parsl":"","part":"","PartialD":"","Pcy":"","pcy":"","percnt":"%","period":".","permil":"","perp":"","pertenk":"","Pfr":"","pfr":"","Phi":"","phi":"","phiv":"","phmmat":"","phone":"","Pi":"","pi":"","pitchfork":"","piv":"","planck":"","planckh":"","plankv":"","plusacir":"","plusb":"","pluscir":"","plus":"+","plusdo":"","plusdu":"","pluse":"","PlusMinus":"","plusmn":"","plussim":"","plustwo":"","pm":"","Poincareplane":"","pointint":"","popf":"","Popf":"","pound":"","prap":"","Pr":"","pr":"","prcue":"","precapprox":"","prec":"","preccurlyeq":"","Precedes":"","PrecedesEqual":"","PrecedesSlantEqual":"","PrecedesTilde":"","preceq":"","precnapprox":"","precneqq":"","precnsim":"","pre":"","prE":"","precsim":"","prime":"","Prime":"","primes":"","prnap":"","prnE":"","prnsim":"","prod":"","Product":"","profalar":"","profline":"","profsurf":"","prop":"","Proportional":"","Proportion":"","propto":"","prsim":"","prurel":"","Pscr":"","pscr":"","Psi":"","psi":"","puncsp":"","Qfr":"","qfr":"","qint":"","qopf":"","Qopf":"","qprime":"","Qscr":"","qscr":"","quaternions":"","quatint":"","quest":"?","questeq":"","quot":"\\"","QUOT":"\\"","rAarr":"","race":"","Racute":"","racute":"","radic":"","raemptyv":"","rang":"","Rang":"","rangd":"","range":"","rangle":"","raquo":"","rarrap":"","rarrb":"","rarrbfs":"","rarrc":"","rarr":"","Rarr":"","rArr":"","rarrfs":"","rarrhk":"","rarrlp":"","rarrpl":"","rarrsim":"","Rarrtl":"","rarrtl":"","rarrw":"","ratail":"","rAtail":"","ratio":"","rationals":"","rbarr":"","rBarr":"","RBarr":"","rbbrk":"","rbrace":"}","rbrack":"]","rbrke":"","rbrksld":"","rbrkslu":"","Rcaron":"","rcaron":"","Rcedil":"","rcedil":"","rceil":"","rcub":"}","Rcy":"","rcy":"","rdca":"","rdldhar":"","rdquo":"","rdquor":"","rdsh":"","real":"","realine":"","realpart":"","reals":"","Re":"","rect":"","reg":"","REG":"","ReverseElement":"","ReverseEquilibrium":"","ReverseUpEquilibrium":"","rfisht":"","rfloor":"","rfr":"","Rfr":"","rHar":"","rhard":"","rharu":"","rharul":"","Rho":"","rho":"","rhov":"","RightAngleBracket":"","RightArrowBar":"","rightarrow":"","RightArrow":"","Rightarrow":"","RightArrowLeftArrow":"","rightarrowtail":"","RightCeiling":"","RightDoubleBracket":"","RightDownTeeVector":"","RightDownVectorBar":"","RightDownVector":"","RightFloor":"","rightharpoondown":"","rightharpoonup":"","rightleftarrows":"","rightleftharpoons":"","rightrightarrows":"","rightsquigarrow":"","RightTeeArrow":"","RightTee":"","RightTeeVector":"","rightthreetimes":"","RightTriangleBar":"","RightTriangle":"","RightTriangleEqual":"","RightUpDownVector":"","RightUpTeeVector":"","RightUpVectorBar":"","RightUpVector":"","RightVectorBar":"","RightVector":"","ring":"","risingdotseq":"","rlarr":"","rlhar":"","rlm":"","rmoustache":"","rmoust":"","rnmid":"","roang":"","roarr":"","robrk":"","ropar":"","ropf":"","Ropf":"","roplus":"","rotimes":"","RoundImplies":"","rpar":")","rpargt":"","rppolint":"","rrarr":"","Rrightarrow":"","rsaquo":"","rscr":"","Rscr":"","rsh":"","Rsh":"","rsqb":"]","rsquo":"","rsquor":"","rthree":"","rtimes":"","rtri":"","rtrie":"","rtrif":"","rtriltri":"","RuleDelayed":"","ruluhar":"","rx":"","Sacute":"","sacute":"","sbquo":"","scap":"","Scaron":"","scaron":"","Sc":"","sc":"","sccue":"","sce":"","scE":"","Scedil":"","scedil":"","Scirc":"","scirc":"","scnap":"","scnE":"","scnsim":"","scpolint":"","scsim":"","Scy":"","scy":"","sdotb":"","sdot":"","sdote":"","searhk":"","searr":"","seArr":"","searrow":"","sect":"","semi":";","seswar":"","setminus":"","setmn":"","sext":"","Sfr":"","sfr":"","sfrown":"","sharp":"","SHCHcy":"","shchcy":"","SHcy":"","shcy":"","ShortDownArrow":"","ShortLeftArrow":"","shortmid":"","shortparallel":"","ShortRightArrow":"","ShortUpArrow":"","shy":"","Sigma":"","sigma":"","sigmaf":"","sigmav":"","sim":"","simdot":"","sime":"","simeq":"","simg":"","simgE":"","siml":"","simlE":"","simne":"","simplus":"","simrarr":"","slarr":"","SmallCircle":"","smallsetminus":"","smashp":"","smeparsl":"","smid":"","smile":"","smt":"","smte":"","smtes":"","SOFTcy":"","softcy":"","solbar":"","solb":"","sol":"/","Sopf":"","sopf":"","spades":"","spadesuit":"","spar":"","sqcap":"","sqcaps":"","sqcup":"","sqcups":"","Sqrt":"","sqsub":"","sqsube":"","sqsubset":"","sqsubseteq":"","sqsup":"","sqsupe":"","sqsupset":"","sqsupseteq":"","square":"","Square":"","SquareIntersection":"","SquareSubset":"","SquareSubsetEqual":"","SquareSuperset":"","SquareSupersetEqual":"","SquareUnion":"","squarf":"","squ":"","squf":"","srarr":"","Sscr":"","sscr":"","ssetmn":"","ssmile":"","sstarf":"","Star":"","star":"","starf":"","straightepsilon":"","straightphi":"","strns":"","sub":"","Sub":"","subdot":"","subE":"","sube":"","subedot":"","submult":"","subnE":"","subne":"","subplus":"","subrarr":"","subset":"","Subset":"","subseteq":"","subseteqq":"","SubsetEqual":"","subsetneq":"","subsetneqq":"","subsim":"","subsub":"","subsup":"","succapprox":"","succ":"","succcurlyeq":"","Succeeds":"","SucceedsEqual":"","SucceedsSlantEqual":"","SucceedsTilde":"","succeq":"","succnapprox":"","succneqq":"","succnsim":"","succsim":"","SuchThat":"","sum":"","Sum":"","sung":"","sup1":"","sup2":"","sup3":"","sup":"","Sup":"","supdot":"","supdsub":"","supE":"","supe":"","supedot":"","Superset":"","SupersetEqual":"","suphsol":"","suphsub":"","suplarr":"","supmult":"","supnE":"","supne":"","supplus":"","supset":"","Supset":"","supseteq":"","supseteqq":"","supsetneq":"","supsetneqq":"","supsim":"","supsub":"","supsup":"","swarhk":"","swarr":"","swArr":"","swarrow":"","swnwar":"","szlig":"","Tab":"\\t","target":"","Tau":"","tau":"","tbrk":"","Tcaron":"","tcaron":"","Tcedil":"","tcedil":"","Tcy":"","tcy":"","tdot":"","telrec":"","Tfr":"","tfr":"","there4":"","therefore":"","Therefore":"","Theta":"","theta":"","thetasym":"","thetav":"","thickapprox":"","thicksim":"","ThickSpace":"","ThinSpace":"","thinsp":"","thkap":"","thksim":"","THORN":"","thorn":"","tilde":"","Tilde":"","TildeEqual":"","TildeFullEqual":"","TildeTilde":"","timesbar":"","timesb":"","times":"","timesd":"","tint":"","toea":"","topbot":"","topcir":"","top":"","Topf":"","topf":"","topfork":"","tosa":"","tprime":"","trade":"","TRADE":"","triangle":"","triangledown":"","triangleleft":"","trianglelefteq":"","triangleq":"","triangleright":"","trianglerighteq":"","tridot":"","trie":"","triminus":"","TripleDot":"","triplus":"","trisb":"","tritime":"","trpezium":"","Tscr":"","tscr":"","TScy":"","tscy":"","TSHcy":"","tshcy":"","Tstrok":"","tstrok":"","twixt":"","twoheadleftarrow":"","twoheadrightarrow":"","Uacute":"","uacute":"","uarr":"","Uarr":"","uArr":"","Uarrocir":"","Ubrcy":"","ubrcy":"","Ubreve":"","ubreve":"","Ucirc":"","ucirc":"","Ucy":"","ucy":"","udarr":"","Udblac":"","udblac":"","udhar":"","ufisht":"","Ufr":"","ufr":"","Ugrave":"","ugrave":"","uHar":"","uharl":"","uharr":"","uhblk":"","ulcorn":"","ulcorner":"","ulcrop":"","ultri":"","Umacr":"","umacr":"","uml":"","UnderBar":"_","UnderBrace":"","UnderBracket":"","UnderParenthesis":"","Union":"","UnionPlus":"","Uogon":"","uogon":"","Uopf":"","uopf":"","UpArrowBar":"","uparrow":"","UpArrow":"","Uparrow":"","UpArrowDownArrow":"","updownarrow":"","UpDownArrow":"","Updownarrow":"","UpEquilibrium":"","upharpoonleft":"","upharpoonright":"","uplus":"","UpperLeftArrow":"","UpperRightArrow":"","upsi":"","Upsi":"","upsih":"","Upsilon":"","upsilon":"","UpTeeArrow":"","UpTee":"","upuparrows":"","urcorn":"","urcorner":"","urcrop":"","Uring":"","uring":"","urtri":"","Uscr":"","uscr":"","utdot":"","Utilde":"","utilde":"","utri":"","utrif":"","uuarr":"","Uuml":"","uuml":"","uwangle":"","vangrt":"","varepsilon":"","varkappa":"","varnothing":"","varphi":"","varpi":"","varpropto":"","varr":"","vArr":"","varrho":"","varsigma":"","varsubsetneq":"","varsubsetneqq":"","varsupsetneq":"","varsupsetneqq":"","vartheta":"","vartriangleleft":"","vartriangleright":"","vBar":"","Vbar":"","vBarv":"","Vcy":"","vcy":"","vdash":"","vDash":"","Vdash":"","VDash":"","Vdashl":"","veebar":"","vee":"","Vee":"","veeeq":"","vellip":"","verbar":"|","Verbar":"","vert":"|","Vert":"","VerticalBar":"","VerticalLine":"|","VerticalSeparator":"","VerticalTilde":"","VeryThinSpace":"","Vfr":"","vfr":"","vltri":"","vnsub":"","vnsup":"","Vopf":"","vopf":"","vprop":"","vrtri":"","Vscr":"","vscr":"","vsubnE":"","vsubne":"","vsupnE":"","vsupne":"","Vvdash":"","vzigzag":"","Wcirc":"","wcirc":"","wedbar":"","wedge":"","Wedge":"","wedgeq":"","weierp":"","Wfr":"","wfr":"","Wopf":"","wopf":"","wp":"","wr":"","wreath":"","Wscr":"","wscr":"","xcap":"","xcirc":"","xcup":"","xdtri":"","Xfr":"","xfr":"","xharr":"","xhArr":"","Xi":"","xi":"","xlarr":"","xlArr":"","xmap":"","xnis":"","xodot":"","Xopf":"","xopf":"","xoplus":"","xotime":"","xrarr":"","xrArr":"","Xscr":"","xscr":"","xsqcup":"","xuplus":"","xutri":"","xvee":"","xwedge":"","Yacute":"","yacute":"","YAcy":"","yacy":"","Ycirc":"","ycirc":"","Ycy":"","ycy":"","yen":"","Yfr":"","yfr":"","YIcy":"","yicy":"","Yopf":"","yopf":"","Yscr":"","yscr":"","YUcy":"","yucy":"","yuml":"","Yuml":"","Zacute":"","zacute":"","Zcaron":"","zcaron":"","Zcy":"","zcy":"","Zdot":"","zdot":"","zeetrf":"","ZeroWidthSpace":"","Zeta":"","zeta":"","zfr":"","Zfr":"","ZHcy":"","zhcy":"","zigrarr":"","zopf":"","Zopf":"","Zscr":"","zscr":"","zwj":"","zwnj":""}')},9591:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"","aacute":"","Acirc":"","acirc":"","acute":"","AElig":"","aelig":"","Agrave":"","agrave":"","amp":"&","AMP":"&","Aring":"","aring":"","Atilde":"","atilde":"","Auml":"","auml":"","brvbar":"","Ccedil":"","ccedil":"","cedil":"","cent":"","copy":"","COPY":"","curren":"","deg":"","divide":"","Eacute":"","eacute":"","Ecirc":"","ecirc":"","Egrave":"","egrave":"","ETH":"","eth":"","Euml":"","euml":"","frac12":"","frac14":"","frac34":"","gt":">","GT":">","Iacute":"","iacute":"","Icirc":"","icirc":"","iexcl":"","Igrave":"","igrave":"","iquest":"","Iuml":"","iuml":"","laquo":"","lt":"<","LT":"<","macr":"","micro":"","middot":"","nbsp":"","not":"","Ntilde":"","ntilde":"","Oacute":"","oacute":"","Ocirc":"","ocirc":"","Ograve":"","ograve":"","ordf":"","ordm":"","Oslash":"","oslash":"","Otilde":"","otilde":"","Ouml":"","ouml":"","para":"","plusmn":"","pound":"","quot":"\\"","QUOT":"\\"","raquo":"","reg":"","REG":"","sect":"","shy":"","sup1":"","sup2":"","sup3":"","szlig":"","THORN":"","thorn":"","times":"","Uacute":"","uacute":"","Ucirc":"","ucirc":"","Ugrave":"","ugrave":"","uml":"","Uuml":"","uuml":"","Yacute":"","yacute":"","yen":"","yuml":""}')},2586:e=>{"use strict";e.exports=JSON.parse('{"amp":"&","apos":"\'","gt":">","lt":"<","quot":"\\""}')},7873:e=>{"use strict";e.exports=JSON.parse('{"0":"O","1":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","\\u2028":" ","\\u2029":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":"_","":"_","":"_","":"_","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-.","":"","":",","":",","":",","":",","":",","":"","":"","":";","":"","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":"::=","":":","":"!","":"!","":"!","":"!!","":"!?","":"?","":"?","":"?","":"?","":"?","":"?!","":"??","":"","":".","":".","":".","":".","":".","":".","":".","":".","":".","":".,","":"..","":"..","":"...","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":">","":">","":">","":"4","":"b","":"b","":"d","":"J","":"L","":"P","":"U","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","`":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'\'","\\"":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'\'","":"\'\'\'","":"\'\'\'\'","":"\'B","":"\'D","":"\'n","":"\'P","":"\'T","":"\'Y","":"(","":"(","":"(","":"(","":"(","":"((","":"()","":"(2)","":"(2O)","":"(3)","":"(4)","":"(5)","":"(6)","":"(7)","":"(8)","":"(9)","":"(a)","":"(A)","":"(b)","":"(B)","":"(c)","":"(C)","":"(d)","":"(D)","":"(e)","":"(E)","":"(f)","":"(F)","":"(g)","":"(G)","":"(h)","":"(H)","":"(i)","":"(j)","":"(J)","":"(k)","":"(K)","":"(l)","":"(l)","":"(l)","":"(L)","":"(l2)","":"(l3)","":"(l4)","":"(l5)","":"(l6)","":"(l7)","":"(l8)","":"(l9)","":"(ll)","":"(lO)","":"(M)","":"(n)","":"(N)","":"(o)","":"(O)","":"(p)","":"(P)","":"(q)","":"(Q)","":"(r)","":"(R)","":"(rn)","":"(s)","":"(S)","":"(S)","":"(t)","":"(T)","":"(u)","":"(U)","":"(v)","":"(V)","":"(w)","":"(W)","":"(x)","":"(X)","":"(y)","":"(Y)","":"(z)","":"(Z)","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":")","":")","":")","":")","":")","":"))","":"{","":"{","":"}","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"*","":"*","":"*","":"*","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"//","":"///","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\\\\\","":"\\\\\\\\","":"\\\\","":"&","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"^","":"^","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"bi","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"C","":"F","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<<","":"<<<","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"==","":"===","":"=","":">","":">","":">","":">","":">","":">","":">","":"><","":">>","":">>","":">>>","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"$","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"","":"","":"","":"","":"","":"","":"2","":"2,","":"2.","":"22","":"22","":"23","":"23","":"24","":"24","":"25","":"26","":"27","":"28","":"29","":"2l","":"2l","":"2O.","":"2O","":"2O","":"","":"","":"2","":"2","":"2","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"","":"","":"","":"","":"3","":"3,","":"3.","":"3l","":"3O","":"3","":"3","":"3","":"4","":"4","":"4","":"4","":"4","":"4","":"4","":"4","":"","":"","":"","":"4,","":"4.","":"4","":"4","":"4","":"4","":"5","":"5","":"5","":"5","":"5","":"5","":"5","":"5","":"","":"5,","":"5.","":"5","":"5","":"5","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"","":"","":"","":"6,","":"6.","":"6","":"6","":"6","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"","":"7,","":"7.","":"7","":"7","":"7","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"","":"","":"8,","":"8.","":"8","":"8","":"8","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"","":"","":"","":"","":"","":"9,","":"9.","":"9","":"9","":"9","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"","":"","":"","":"","":"","":"a/c","":"a/s","":"aa","":"AA","":"ae","":"ae","":"AE","":"AE","":"ao","":"AO","":"AR","":"au","":"AU","":"av","":"av","":"AV","":"AV","":"ay","":"AY","":"","":"","":"","":"","":"","":"","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b\'","":"bl","":"","":"","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"c","":"c","":"C","":"C","":"c","":"c","":"C","":"C","":"C\'","":"c/o","":"c/u","":"\\t","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"d","":"","":"d","":"d\'","":"d","":"dz","":"dz","":"Dz","":"DZ","":"d","":"D","":"D","":"d","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"","":"","":"e","":"E","":"e","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"f","":"F","":"f","":"FAX","":"ff","":"ffi","":"ffl","":"fi","":"fl","":"f","":"","":"","":"","":"","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"","":"g","":"","":"","":"","":"g","":"G","":"G\'","":"","":"","":"","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"","":"h","":"h","":"h","":"H","":"H","":"h","":"h","":"h","":"H","":"H","":"H","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"","":"i","":"","":"","":"i","":"i","":"i","":"ii","":"iii","":"ij","":"iv","":"ix","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"j","":"J","":"J","":"","":"","":"","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"k","":"K","":"K","":"K","":"K","":"K","":"K\'","":"l","|":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","I":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"L","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l,","":"l.","":"l\'","":"l2.","":"l2","":"l2","":"l2","":"l3.","":"l3","":"l3","":"l4.","":"l4","":"l4","":"l5.","":"l5","":"l5","":"l6.","":"l6","":"l6","":"l7.","":"l7","":"l7","":"l8.","":"l8","":"l8","":"l9.","":"l9","":"l9","":"lj","":"lJ","":"Lj","":"LJ","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll.","":"lll","":"llS","":"ll","":"ll","":"ll","":"lO","":"lO.","":"lO","":"lO","":"lO","":"ls","":"lt","":"lV","":"lX","":"l","":"lz","":"l","":"l","":"l","":"l","":"l","":"l","":"lo","":"l","":"l","":"l","":"","":"","":"","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"MB","":"","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"n","":"nj","":"Nj","":"NJ","":"No","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"","":"","":"","":"","":"o","":"","":"o","":"o","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"O,","":"O.","":"o\'","":"O\'","":"O\'","%":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"oe","":"OE","":"o","":"oo","":"oo","":"oo","":"OO","":"OO","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oo","":"o","":"O","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"p","":"p","":"p","":"P\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"q","":"QE","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"r","":"r","":"r","":"r","":"r","":"r\'","":"rn","m":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"Rs","":"","":"","":"","":"","":"","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"s","":"s","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"sss","":"st","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"t","":"T","":"T","":"","":"T","":"T","":"T","":"t","":"T","":"t","":"","":"T3","":"t","":"TEL","":"tf","":"ts","":"t","":"t","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"","":"","":"u","":"u","":"U","":"U","":"U","":"U\'","":"ue","":"uo","":"","":"","":"","":"","":"","":"","":"","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VB","":"vi","":"vii","":"viii","":"Vl","":"Vll","":"Vlll","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"w","":"w","":"W","":"w","":"","":"","":"","":"","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"x","":"X","":"X","":"xi","":"xii","":"Xl","":"Xll","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"","":"","":"","":"","":"","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"z","":"z","":"Z","":"z","":"Z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo o ","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"l","":"l","":"l","":"l","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"l","":"l","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"/","":"","":"","":"","":"","":"","":"\'","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":"b","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"b","":"d","":"P","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}')}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),__webpack_require__.b=document.baseURI||self.location.href,__webpack_require__.nc=void 0;var __webpack_exports__={};(()=>{"use strict";var e,t,n,i,r,s,o={},a=[],l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(e,t){for(var n in t)e[n]=t[n];return e}function d(e){var t=e.parentNode;t&&t.removeChild(e)}function h(t,n,i){var r,s,o,a={};for(o in n)"key"==o?r=n[o]:"ref"==o?s=n[o]:a[o]=n[o];if(arguments.length>2&&(a.children=arguments.length>3?e.call(arguments,2):i),"function"==typeof t&&null!=t.defaultProps)for(o in t.defaultProps)void 0===a[o]&&(a[o]=t.defaultProps[o]);return u(t,a,r,s,null)}function u(e,i,r,s,o){var a={type:e,props:i,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++n:o};return null==o&&null!=t.vnode&&t.vnode(a),a}function p(e){return e.children}function m(e,t){this.props=e,this.context=t}function g(e,t){if(null==t)return e.__?g(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?g(e):null}function f(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return f(e)}}function v(e){(!e.__d&&(e.__d=!0)&&i.push(e)&&!y.__r++||r!==t.debounceRendering)&&((r=t.debounceRendering)||setTimeout)(y)}function y(){for(var e;y.__r=i.length;)e=i.sort((function(e,t){return e.__v.__b-t.__v.__b})),i=[],e.some((function(e){var t,n,i,r,s,o;e.__d&&(s=(r=(t=e).__v).__e,(o=t.__P)&&(n=[],(i=c({},r)).__v=r.__v+1,C(o,r,i,t.__n,void 0!==o.ownerSVGElement,null!=r.__h?[s]:null,n,null==s?g(r):s,r.__h),A(n,r),r.__e!=s&&f(r)))}))}function b(e,t,n,i,r,s,l,c,d,h){var m,f,v,y,b,S,E,k=i&&i.__k||a,x=k.length;for(n.__k=[],m=0;m<t.length;m++)if(null!=(y=n.__k[m]=null==(y=t[m])||"boolean"==typeof y?null:"string"==typeof y||"number"==typeof y||"bigint"==typeof y?u(null,y,null,null,y):Array.isArray(y)?u(p,{children:y},null,null,null):y.__b>0?u(y.type,y.props,y.key,null,y.__v):y)){if(y.__=n,y.__b=n.__b+1,null===(v=k[m])||v&&y.key==v.key&&y.type===v.type)k[m]=void 0;else for(f=0;f<x;f++){if((v=k[f])&&y.key==v.key&&y.type===v.type){k[f]=void 0;break}v=null}C(e,y,v=v||o,r,s,l,c,d,h),b=y.__e,(f=y.ref)&&v.ref!=f&&(E||(E=[]),v.ref&&E.push(v.ref,null,y),E.push(f,y.__c||b,y)),null!=b?(null==S&&(S=b),"function"==typeof y.type&&y.__k===v.__k?y.__d=d=w(y,d,e):d=_(e,y,v,k,b,d),"function"==typeof n.type&&(n.__d=d)):d&&v.__e==d&&d.parentNode!=e&&(d=g(v))}for(n.__e=S,m=x;m--;)null!=k[m]&&("function"==typeof n.type&&null!=k[m].__e&&k[m].__e==n.__d&&(n.__d=g(i,m+1)),P(k[m],k[m]));if(E)for(m=0;m<E.length;m++)R(E[m],E[++m],E[++m])}function w(e,t,n){for(var i,r=e.__k,s=0;r&&s<r.length;s++)(i=r[s])&&(i.__=e,t="function"==typeof i.type?w(i,t,n):_(n,i,i,r,i.__e,t));return t}function S(e,t){return t=t||[],null==e||"boolean"==typeof e||(Array.isArray(e)?e.some((function(e){S(e,t)})):t.push(e)),t}function _(e,t,n,i,r,s){var o,a,l;if(void 0!==t.__d)o=t.__d,t.__d=void 0;else if(null==n||r!=s||null==r.parentNode)e:if(null==s||s.parentNode!==e)e.appendChild(r),o=null;else{for(a=s,l=0;(a=a.nextSibling)&&l<i.length;l+=2)if(a==r)break e;e.insertBefore(r,s),o=s}return void 0!==o?o:r.nextSibling}function E(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||l.test(t)?n:n+"px"}function k(e,t,n,i,r){var s;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||E(e.style,t,"");if(n)for(t in n)i&&n[t]===i[t]||E(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=n,n?i||e.addEventListener(t,s?T:x,s):e.removeEventListener(t,s?T:x,s);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function x(e){this.l[e.type+!1](t.event?t.event(e):e)}function T(e){this.l[e.type+!0](t.event?t.event(e):e)}function C(e,n,i,r,s,o,a,l,d){var h,u,g,f,v,y,w,S,_,E,k,x,T,C=n.type;if(void 0!==n.constructor)return null;null!=i.__h&&(d=i.__h,l=n.__e=i.__e,n.__h=null,o=[l]),(h=t.__b)&&h(n);try{e:if("function"==typeof C){if(S=n.props,_=(h=C.contextType)&&r[h.__c],E=h?_?_.props.value:h.__:r,i.__c?w=(u=n.__c=i.__c).__=u.__E:("prototype"in C&&C.prototype.render?n.__c=u=new C(S,E):(n.__c=u=new m(S,E),u.constructor=C,u.render=O),_&&_.sub(u),u.props=S,u.state||(u.state={}),u.context=E,u.__n=r,g=u.__d=!0,u.__h=[]),null==u.__s&&(u.__s=u.state),null!=C.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=c({},u.__s)),c(u.__s,C.getDerivedStateFromProps(S,u.__s))),f=u.props,v=u.state,g)null==C.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(null==C.getDerivedStateFromProps&&S!==f&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(S,E),!u.__e&&null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(S,u.__s,E)||n.__v===i.__v){u.props=S,u.state=u.__s,n.__v!==i.__v&&(u.__d=!1),u.__v=n,n.__e=i.__e,n.__k=i.__k,n.__k.forEach((function(e){e&&(e.__=n)})),u.__h.length&&a.push(u);break e}null!=u.componentWillUpdate&&u.componentWillUpdate(S,u.__s,E),null!=u.componentDidUpdate&&u.__h.push((function(){u.componentDidUpdate(f,v,y)}))}if(u.context=E,u.props=S,u.__v=n,u.__P=e,k=t.__r,x=0,"prototype"in C&&C.prototype.render)u.state=u.__s,u.__d=!1,k&&k(n),h=u.render(u.props,u.state,u.context);else do{u.__d=!1,k&&k(n),h=u.render(u.props,u.state,u.context),u.state=u.__s}while(u.__d&&++x<25);u.state=u.__s,null!=u.getChildContext&&(r=c(c({},r),u.getChildContext())),g||null==u.getSnapshotBeforeUpdate||(y=u.getSnapshotBeforeUpdate(f,v)),T=null!=h&&h.type===p&&null==h.key?h.props.children:h,b(e,Array.isArray(T)?T:[T],n,i,r,s,o,a,l,d),u.base=n.__e,n.__h=null,u.__h.length&&a.push(u),w&&(u.__E=u.__=null),u.__e=!1}else null==o&&n.__v===i.__v?(n.__k=i.__k,n.__e=i.__e):n.__e=I(i.__e,n,i,r,s,o,a,d);(h=t.diffed)&&h(n)}catch(e){n.__v=null,(d||null!=o)&&(n.__e=l,n.__h=!!d,o[o.indexOf(l)]=null),t.__e(e,n,i)}}function A(e,n){t.__c&&t.__c(n,e),e.some((function(n){try{e=n.__h,n.__h=[],e.some((function(e){e.call(n)}))}catch(e){t.__e(e,n.__v)}}))}function I(t,n,i,r,s,a,l,c){var h,u,p,m=i.props,f=n.props,v=n.type,y=0;if("svg"===v&&(s=!0),null!=a)for(;y<a.length;y++)if((h=a[y])&&"setAttribute"in h==!!v&&(v?h.localName===v:3===h.nodeType)){t=h,a[y]=null;break}if(null==t){if(null===v)return document.createTextNode(f);t=s?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,f.is&&f),a=null,c=!1}if(null===v)m===f||c&&t.data===f||(t.data=f);else{if(a=a&&e.call(t.childNodes),u=(m=i.props||o).dangerouslySetInnerHTML,p=f.dangerouslySetInnerHTML,!c){if(null!=a)for(m={},y=0;y<t.attributes.length;y++)m[t.attributes[y].name]=t.attributes[y].value;(p||u)&&(p&&(u&&p.__html==u.__html||p.__html===t.innerHTML)||(t.innerHTML=p&&p.__html||""))}if(function(e,t,n,i,r){var s;for(s in n)"children"===s||"key"===s||s in t||k(e,s,null,n[s],i);for(s in t)r&&"function"!=typeof t[s]||"children"===s||"key"===s||"value"===s||"checked"===s||n[s]===t[s]||k(e,s,t[s],n[s],i)}(t,f,m,s,c),p)n.__k=[];else if(y=n.props.children,b(t,Array.isArray(y)?y:[y],n,i,r,s&&"foreignObject"!==v,a,l,a?a[0]:i.__k&&g(i,0),c),null!=a)for(y=a.length;y--;)null!=a[y]&&d(a[y]);c||("value"in f&&void 0!==(y=f.value)&&(y!==t.value||"progress"===v&&!y||"option"===v&&y!==m.value)&&k(t,"value",y,m.value,!1),"checked"in f&&void 0!==(y=f.checked)&&y!==t.checked&&k(t,"checked",y,m.checked,!1))}return t}function R(e,n,i){try{"function"==typeof e?e(n):e.current=n}catch(e){t.__e(e,i)}}function P(e,n,i){var r,s;if(t.unmount&&t.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||R(r,null,n)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){t.__e(e,n)}r.base=r.__P=null}if(r=e.__k)for(s=0;s<r.length;s++)r[s]&&P(r[s],n,"function"!=typeof e.type);i||null==e.__e||d(e.__e),e.__e=e.__d=void 0}function O(e,t,n){return this.constructor(e,n)}function M(t,n,i){var r,s,o,a=c({},t.props);for(o in n)"key"==o?r=n[o]:"ref"==o?s=n[o]:a[o]=n[o];return arguments.length>2&&(a.children=arguments.length>3?e.call(arguments,2):i),u(t.type,a,r||t.key,s||t.ref,null)}e=a.slice,t={__e:function(e,t,n,i){for(var r,s,o;t=t.__;)if((r=t.__c)&&!r.__)try{if((s=r.constructor)&&null!=s.getDerivedStateFromError&&(r.setState(s.getDerivedStateFromError(e)),o=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,i||{}),o=r.__d),o)return r.__E=r}catch(t){e=t}throw e}},n=0,m.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof e&&(e=e(c({},n),this.props)),e&&c(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),v(this))},m.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),v(this))},m.prototype.render=p,i=[],y.__r=0,s=0;var D,L,F,N=[],j=[],B=t.__b,U=t.__r,q=t.diffed,z=t.__c,V=t.unmount;function K(){for(var e;e=N.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(W),e.__H.__h.forEach($),e.__H.__h=[]}catch(n){e.__H.__h=[],t.__e(n,e.__v)}}t.__b=function(e){D=null,B&&B(e)},t.__r=function(e){U&&U(e);var t=(D=e.__c).__H;t&&(L===D?(t.__h=[],D.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.__V=j,e.__N=e.i=void 0}))):(t.__h.forEach(W),t.__h.forEach($),t.__h=[])),L=D},t.diffed=function(e){q&&q(e);var n=e.__c;n&&n.__H&&(n.__H.__h.length&&(1!==N.push(n)&&F===t.requestAnimationFrame||((F=t.requestAnimationFrame)||function(e){var t,n=function(){clearTimeout(i),H&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,100);H&&(t=requestAnimationFrame(n))})(K)),n.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.__V!==j&&(e.__=e.__V),e.i=void 0,e.__V=j}))),L=D=null},t.__c=function(e,n){n.some((function(e){try{e.__h.forEach(W),e.__h=e.__h.filter((function(e){return!e.__||$(e)}))}catch(i){n.some((function(e){e.__h&&(e.__h=[])})),n=[],t.__e(i,e.__v)}})),z&&z(e,n)},t.unmount=function(e){V&&V(e);var n,i=e.__c;i&&i.__H&&(i.__H.__.forEach((function(e){try{W(e)}catch(e){n=e}})),n&&t.__e(n,i.__v))};var H="function"==typeof requestAnimationFrame;function W(e){var t=D,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),D=t}function $(e){var t=D;e.__c=e.__(),D=t}var G={};function Y(e,t){for(var n in t)e[n]=t[n];return e}function X(e,t,n){var i,r=/(?:\?([^#]*))?(#.*)?$/,s=e.match(r),o={};if(s&&s[1])for(var a=s[1].split("&"),l=0;l<a.length;l++){var c=a[l].split("=");o[decodeURIComponent(c[0])]=decodeURIComponent(c.slice(1).join("="))}e=Q(e.replace(r,"")),t=Q(t||"");for(var d=Math.max(e.length,t.length),h=0;h<d;h++)if(t[h]&&":"===t[h].charAt(0)){var u=t[h].replace(/(^:|[+*?]+$)/g,""),p=(t[h].match(/[+*?]+$/)||G)[0]||"",m=~p.indexOf("+"),g=~p.indexOf("*"),f=e[h]||"";if(!f&&!g&&(p.indexOf("?")<0||m)){i=!1;break}if(o[u]=decodeURIComponent(f),m||g){o[u]=e.slice(h).map(decodeURIComponent).join("/");break}}else if(t[h]!==e[h]){i=!1;break}return(!0===n.default||!1!==i)&&o}function Z(e,t){return e.rank<t.rank?1:e.rank>t.rank?-1:e.index-t.index}function J(e,t){return e.index=t,e.rank=function(e){return e.props.default?0:Q(e.props.path).map(ee).join("")}(e),e.props}function Q(e){return e.replace(/(^\/+|\/+$)/g,"").split("/")}function ee(e){return":"==e.charAt(0)?1+"*+?".indexOf(e.charAt(e.length-1))||4:5}var te={},ne=[],ie=[],re=null,se={url:ae()},oe=function(e,t){var n={__c:t="__cC"+s++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var n,i;return this.getChildContext||(n=[],(i={})[t]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&n.some(v)},this.sub=function(e){n.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n.splice(n.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Provider.__=n.Consumer.contextType=n}(se);function ae(){var e;return""+((e=re&&re.location?re.location:re&&re.getCurrentLocation?re.getCurrentLocation():"undefined"!=typeof location?location:te).pathname||"")+(e.search||"")}function le(e,t){return void 0===t&&(t=!1),"string"!=typeof e&&e.url&&(t=e.replace,e=e.url),function(e){for(var t=ne.length;t--;)if(ne[t].canRoute(e))return!0;return!1}(e)&&function(e,t){void 0===t&&(t="push"),re&&re[t]?re[t](e):"undefined"!=typeof history&&history[t+"State"]&&history[t+"State"](null,null,e)}(e,t?"replace":"push"),ce(e)}function ce(e){for(var t=!1,n=0;n<ne.length;n++)ne[n].routeTo(e)&&(t=!0);return t}function de(e){if(e&&e.getAttribute){var t=e.getAttribute("href"),n=e.getAttribute("target");if(t&&t.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return le(t)}}function he(e){return e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation&&e.stopPropagation(),e.preventDefault(),!1}function ue(e){if(!(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button)){var t=e.target;do{if("a"===t.localName&&t.getAttribute("href")){if(t.hasAttribute("data-native")||t.hasAttribute("native"))return;if(de(t))return he(e)}}while(t=t.parentNode)}}var pe=!1;function me(e){e.history&&(re=e.history),this.state={url:e.url||ae()}}Y(me.prototype=new m,{shouldComponentUpdate:function(e){return!0!==e.static||e.url!==this.props.url||e.onChange!==this.props.onChange},canRoute:function(e){var t=S(this.props.children);return void 0!==this.g(t,e)},routeTo:function(e){this.setState({url:e});var t=this.canRoute(e);return this.p||this.forceUpdate(),t},componentWillMount:function(){this.p=!0},componentDidMount:function(){var e=this;pe||(pe=!0,re||addEventListener("popstate",(function(){ce(ae())})),addEventListener("click",ue)),ne.push(this),re&&(this.u=re.listen((function(t){var n=t.location||t;e.routeTo(""+(n.pathname||"")+(n.search||""))}))),this.p=!1},componentWillUnmount:function(){"function"==typeof this.u&&this.u(),ne.splice(ne.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(e,t){e=e.filter(J).sort(Z);for(var n=0;n<e.length;n++){var i=e[n],r=X(t,i.props.path,i.props);if(r)return[i,r]}},render:function(e,t){var n,i,r=e.onChange,s=t.url,o=this.c,a=this.g(S(e.children),s);if(a&&(i=M(a[0],Y(Y({url:s,matches:n=a[1]},n),{key:void 0,ref:void 0}))),s!==(o&&o.url)){Y(se,o=this.c={url:s,previous:o&&o.url,current:i,path:i?i.props.path:null,matches:n}),o.router=this,o.active=i?[i]:[];for(var l=ie.length;l--;)ie[l]({});"function"==typeof r&&r(o)}return h(oe.Provider,{value:o},i)}});var ge=__webpack_require__(8743);function fe(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}function ve(e){return function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}function ye(e,t){if(0==e)return"0 Bytes";var n=t||2,i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}function be(e){if(we[e])return we[e];const t=fe(e);return we[e]=t%360,we[e]}class we{constructor(e){this.hue=be(e),this.light=`hsl(${this.hue},100%, 80%)`,this.solid=`hsl(${this.hue},100%, 50%)`,this.dark=`hsl(${this.hue},100%, 20%)`,this.ultralight=`hsl(${this.hue},100%, 95%)`,this.ultradark=`hsl(${this.hue},100%, 10%)`,this.styleVariables={"--user_ultralight":this.ultralight,"--user_light":this.light,"--user_solid":this.solid,"--user_dark":this.dark,"--user_ultradark":this.ultradark}}}class Se{constructor(e){this.hue=be(e),this.ultralight=`hsl(${this.hue},100%, 95%)`,this.light=`hsl(${this.hue},100%, 80%)`,this.solid=`hsl(${this.hue},100%, 50%)`,this.dark=`hsl(${this.hue},100%, 20%)`,this.ultradark=`hsl(${this.hue},100%, 10%)`,this.styleVariables={"--room_ultralight":this.ultralight,"--room_light":this.light,"--room_solid":this.solid,"--room_dark":this.dark,"--room_ultradark":this.ultradark}}}var _e=__webpack_require__(3379),Ee=__webpack_require__.n(_e),ke=__webpack_require__(7795),xe=__webpack_require__.n(ke),Te=__webpack_require__(569),Ce=__webpack_require__.n(Te),Ae=__webpack_require__(3565),Ie=__webpack_require__.n(Ae),Re=__webpack_require__(9216),Pe=__webpack_require__.n(Re),Oe=__webpack_require__(4589),Me=__webpack_require__.n(Oe),De=__webpack_require__(1913),Le={};Le.styleTagTransform=Me(),Le.setAttributes=Ie(),Le.insert=Ce().bind(null,"head"),Le.domAPI=xe(),Le.insertStyleElement=Pe(),Ee()(De.Z,Le),De.Z&&De.Z.locals&&De.Z.locals;const Fe="com.open-tower.populus.pdf",Ne="com.open-tower.populus.lastPositionViewed",je="https://matrix.populus.open-tower.com",Be="m.space.child",Ue="m.space.parent",qe="com.open-tower.msc3574.markup.parent",ze="com.open-tower.msc3574.markup.resource",Ve="com.open-tower.msc3592.markup.pdf.highlight",Ke="com.open-tower.msc3775.markup.media.fragment",He="com.open-tower.msc3592.markup.pdf.text",We="com.open-tower.msc3574.markup.location",$e="com.open-tower.msc3574.markup",Ge="com.open-tower.populus.markup.pdf.highlight",Ye="com.open-tower.populus.waveformPCM",Xe=/^#[0-9a-fA-F]{6}$/,Ze={allowedTags:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","nl","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre","span","img","details","summary"],allowedAttributes:{font:["color","data-mx-bg-color","data-mx-color","style"],span:["data-mx-maths","data-mx-bg-color","data-mx-color","data-mx-spoiler","style"],div:["data-mx-maths"],a:["href","name","target","rel"],img:["src","width","height","alt","title"],ol:["start"],code:["class"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","magnet"],allowProtocolRelative:!1,transformTags:{a:(e,t)=>(t.href&&(t.target="_blank"),t.rel="noreferrer noopener",{tagName:e,attribs:t}),img:e=>({tagName:e,attribs:{}}),code(e,t){if(void 0!==t.class){const e=t.class.split(/\s/).filter((e=>e.startsWith("language-")&&!e.startsWith("language-_")));t.class=e.join(" ")}return{tagName:e,attribs:t}},"*"(e,t){delete t.style;const n={"data-mx-color":"color","data-mx-bg-color":"background-color"};let i="";return Object.keys(n).forEach((e=>{const r=n[e],s=t[e];s&&"string"==typeof s&&Xe.test(s)&&(i+=`${r}:${s};`,delete t[e])})),i&&(t.style=i),{tagName:e,attribs:t}}},nestingLimit:50};function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qe(e){const t=n=>i=>{const r=this.getRoom(e);r?n(r):setTimeout(t(n),500)};return new Promise((e=>t(e)()))}function et(...e){return ge.getHttpUriForMxc(this.getHomeserverUrl(),...e)}class tt{static isResumable(){return!!localStorage.getItem("accessToken")&&!!localStorage.getItem("userId")&&!!localStorage.getItem("baseUrl")}static async initClient(){let e;try{e=window.indexedDB}catch(e){}const t={baseUrl:localStorage.getItem("baseUrl"),userId:localStorage.getItem("userId"),accessToken:localStorage.getItem("accessToken"),timelineSupport:!0,unstableClientRelationAggregation:!0};e?(console.log("using indexedDB"),t.store=new ge.IndexedDBStore({indexedDB:e,localStorage,dbName:"populus-web-sync",workerScript:"./indexeddb-worker.js"}),await t.store.startup(),tt.client=ge.createClient(t)):tt.client=ge.createClient(t),tt.client.getRoomWithState=Qe.bind(tt.client),tt.client.getHttpUriForMxcFromHS=et.bind(tt.client);const n=new ge.EventTimelineSet(null,{timelineSupport:!0});return n.getLiveTimeline().setPaginationToken("",ge.EventTimeline.BACKWARDS),tt.client.setNotifTimelineSet(n),tt.client}static restart(){tt.client.stopClient(),tt.client.store.deleteAllData(),tt.initClient()}}Je(tt,"client",void 0),Je(tt,"deviceId",Math.random().toString(16).substr(2,14));var nt=__webpack_require__(9631),it={};it.styleTagTransform=Me(),it.setAttributes=Ie(),it.insert=Ce().bind(null,"head"),it.domAPI=xe(),it.insertStyleElement=Pe(),Ee()(nt.Z,it),nt.Z&&nt.Z.locals&&nt.Z.locals;const rt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-home"},h("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),h("polyline",{points:"9 22 9 12 15 12 15 22"})),st=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},h("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),h("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),h("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),ot=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},h("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),h("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),at=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user-minus"},h("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"8.5",cy:"7",r:"4"}),h("line",{x1:"23",y1:"11",x2:"17",y2:"11"})),lt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user-plus"},h("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"8.5",cy:"7",r:"4"}),h("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),h("line",{x1:"23",y1:"11",x2:"17",y2:"11"})),ct=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user-x"},h("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"8.5",cy:"7",r:"4"}),h("line",{x1:"18",y1:"8",x2:"23",y2:"13"}),h("line",{x1:"23",y1:"8",x2:"18",y2:"13"})),dt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user-check"},h("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"8.5",cy:"7",r:"4"}),h("polyline",{points:"17 11 19 13 23 9"})),ht=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-users"},h("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"9",cy:"7",r:"4"}),h("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),h("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})),ut=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-upload"},h("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),h("polyline",{points:"17 8 12 3 7 8"}),h("line",{x1:"12",y1:"3",x2:"12",y2:"15"})),pt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-log-out"},h("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),h("polyline",{points:"16 17 21 12 16 7"}),h("line",{x1:"21",y1:"12",x2:"9",y2:"12"})),mt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-image"},h("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),h("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),h("polyline",{points:"21 15 16 10 5 21"})),gt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search"},h("circle",{cx:"11",cy:"11",r:"8"}),h("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),ft=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-file-plus"},h("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),h("polyline",{points:"14 2 14 8 20 8"}),h("line",{x1:"12",y1:"18",x2:"12",y2:"12"}),h("line",{x1:"9",y1:"15",x2:"15",y2:"15"})),vt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-file"},h("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),h("polyline",{points:"13 2 13 9 20 9"})),yt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-square"},h("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),h("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),h("line",{x1:"8",y1:"12",x2:"16",y2:"12"})),bt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-settings"},h("circle",{cx:"12",cy:"12",r:"3"}),h("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})),wt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-more-horizontal"},h("circle",{cx:"12",cy:"12",r:"1"}),h("circle",{cx:"19",cy:"12",r:"1"}),h("circle",{cx:"5",cy:"12",r:"1"})),St=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-more-vertical"},h("circle",{cx:"12",cy:"12",r:"1"}),h("circle",{cx:"12",cy:"5",r:"1"}),h("circle",{cx:"12",cy:"19",r:"1"})),_t=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},h("polyline",{points:"12,19 12,5"})),Et=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevron-left"},h("polyline",{points:"15 18 9 12 15 6"})),kt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevron-right"},h("polyline",{points:"9 18 15 12 9 6"})),xt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevrons-right"},h("polyline",{points:"13 17 18 12 13 7"}),h("polyline",{points:"6 17 11 12 6 7"})),Tt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevrons-left"},h("polyline",{points:"11 17 6 12 11 7"}),h("polyline",{points:"18 17 13 12 18 7"})),Ct=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-edit"},h("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),h("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})),At=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x-square"},h("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),h("line",{x1:"9",y1:"9",x2:"15",y2:"15"}),h("line",{x1:"15",y1:"9",x2:"9",y2:"15"})),It=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-file-text"},h("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),h("polyline",{points:"14 2 14 8 20 8"}),h("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),h("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),h("polyline",{points:"10 9 9 9 8 9"})),Rt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-list"},h("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),h("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),h("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),h("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),h("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),h("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})),Pt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-star"},h("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})),Ot=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-video"},h("polygon",{points:"23 7 16 12 23 17 23 7"}),h("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),Mt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-mic"},h("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),h("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),h("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),h("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),Dt=(h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-circle"},h("circle",{cx:"12",cy:"12",r:"10"})),h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-pause"},h("rect",{x:"6",y:"4",width:"4",height:"16"}),h("rect",{x:"14",y:"4",width:"4",height:"16"}))),Lt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})),Ft=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-thumbs-up"},h("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"})),Nt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-edit-3"},h("path",{d:"M12 20h9"}),h("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"})),jt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-trash-2"},h("polyline",{points:"3 6 5 6 21 6"}),h("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),h("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),h("line",{x1:"14",y1:"11",x2:"14",y2:"17"})),Bt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-bell"},h("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),h("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})),Ut=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye"},h("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),h("circle",{cx:"12",cy:"12",r:"3"})),qt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye-off"},h("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),h("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),zt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-log-in"},h("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),h("polyline",{points:"10 17 15 12 10 7"}),h("line",{x1:"15",y1:"12",x2:"3",y2:"12"})),Vt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-tag"},h("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),h("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})),Kt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-zoom-in"},h("circle",{cx:"11",cy:"11",r:"8"}),h("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),h("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),h("line",{x1:"8",y1:"11",x2:"14",y2:"11"})),Ht=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-zoom-out"},h("circle",{cx:"11",cy:"11",r:"8"}),h("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),h("line",{x1:"8",y1:"11",x2:"14",y2:"11"})),Wt=h("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},h("path",{d:"M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h5a1 1 0 000-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM13 16a1 1 0 102 0v-5.586l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 101.414 1.414L13 10.414V16z"})),$t=h("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},h("path",{d:"M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"})),Gt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})),Yt=(h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-inbox"},h("polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12"}),h("path",{d:"M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"})),h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-map-pin"},h("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),h("circle",{cx:"12",cy:"10",r:"3"}))),Xt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-lock"},h("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),h("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})),Zt=h("svg",{width:"24",height:"24",version:"1.1",viewBox:"0 0 6.35 6.35",stroke:"currentColor",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h("g",{transform:"matrix(.79346 0 0 .79346 -64.91 -71.541)","stroke-width":".66691","aria-label":""},h("path",{d:"m84.897 97.735v-3.0819h-1.4224c-0.02963-1.6891 0.41487-2.5188 1.4224-2.667v-1.1261c-1.7484 0.14817-2.7559 1.5409-2.7559 3.882v2.993zm4.6821 0v-3.0819h-1.4224c-0.02963-1.6891 0.41487-2.5188 1.4224-2.667v-1.1261c-1.7484 0.14817-2.7559 1.5409-2.7559 3.882v2.993z","stroke-width":".66691"}))),Jt=h("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",width:"24",height:"24",viewBox:"0 0 24 24",stroke:"currentColor"},h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})),Qt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-download"},h("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),h("polyline",{points:"7 10 12 15 17 10"}),h("line",{x1:"12",y1:"15",x2:"12",y2:"3"})),en=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-columns"},h("path",{d:"M12 3h7a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-7m0-18H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7m0-18v18"})),tn=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-play"},h("polygon",{points:"5 3 19 12 5 21 5 3"})),nn=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-pause"},h("rect",{x:"6",y:"4",width:"4",height:"16"}),h("rect",{x:"14",y:"4",width:"4",height:"16"})),rn=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-headphones"},h("path",{d:"M3 18v-6a9 9 0 0 1 18 0v6"}),h("path",{d:"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"})),sn=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-activity"},h("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})),on=h("svg",{stroke:"currentColor",fill:"currentColor",version:"1.1",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},h("path",{d:"m22.313 22.545v-21.115h-1.9671v-0.50677h2.7306v22.154h-2.7306v-0.50676z","stroke-width":"2"}),h("path",{d:"m7.5988 7.7471v1.1799h0.033713c0.29498-0.43213 0.6842-0.78916 1.1416-1.0497 0.44438-0.24747 0.95774-0.3716 1.5247-0.3716 0.55166 0 1.0574 0.10726 1.5094 0.32179 0.45587 0.21377 0.80448 0.59072 1.042 1.134 0.25896-0.3831 0.60987-0.72097 1.0574-1.0114 0.44439-0.29345 0.9731-0.43979 1.5784-0.43979 0.46124 0 0.88873 0.0567 1.2795 0.16856 0.39381 0.1134 0.73093 0.29345 1.0114 0.54169 0.28041 0.24747 0.50032 0.57157 0.65815 0.97301 0.15707 0.39994 0.23598 0.88114 0.23598 1.448v5.846h-2.3981v-4.9495c0-0.29345-0.01153-0.56928-0.03365-0.82747-0.01605-0.23522-0.07895-0.46507-0.18545-0.67577-0.10191-0.19231-0.25744-0.35091-0.44746-0.45665-0.19691-0.11186-0.4643-0.16856-0.80449-0.16856-0.33712 0-0.60988 0.065152-0.81982 0.19385-0.20839 0.13024-0.37159 0.2988-0.48958 0.50721-0.12184 0.21989-0.20228 0.46125-0.23598 0.71025-0.03985 0.26586-0.05975 0.53403-0.05975 0.8045v4.8652h-2.3981v-4.9035c0-0.25897-0.0061-0.51564-0.01608-0.76618-0.0087-0.24058-0.05744-0.47733-0.14405-0.70181-0.08275-0.21223-0.22986-0.39228-0.42139-0.51563-0.19767-0.12872-0.48729-0.19385-0.87346-0.19385-0.1517 0.00648-0.30187 0.032174-0.44745 0.076633-0.19768 0.05709-0.38156 0.15477-0.54017 0.28654-0.17469 0.14097-0.32333 0.34401-0.44745 0.60835-0.12336 0.2651-0.18542 0.61142-0.18542 1.042v5.0721h-2.3982v-8.7346z","stroke-width":"0"}),h("path",{d:"m1.6866 1.4557v21.115h1.9671v0.50676h-2.7306v-22.154h2.7216v0.50677z","stroke-width":"2"})),an=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-github"},h("path",{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"})),ln=h("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},h("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})),cn=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-archive"},h("polyline",{points:"21 8 21 21 3 21 3 8"}),h("rect",{x:"1",y:"3",width:"22",height:"5"}),h("line",{x1:"10",y1:"12",x2:"14",y2:"12"})),dn=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-copy"},h("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),h("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"}));function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class un extends m{constructor(e){super(e),hn(this,"hideToast",(e=>this.setState({content:null}))),hn(this,"setContent",(e=>this.setState({content:e}))),un.hide=this.hideToast,un.set=this.setContent}render(e,t){return t.content?h("div",{id:"toast-popup"},h("div",{id:"toast-content"},h("button",{id:"dismiss-toast",onclick:this.hideToast},ot),t.content)):null}}function pn(e){return t=>{un.set(h(p,null,h("h3",{id:"toast-header"},e),h("div",null,"Here's the error message:"),h("pre",null,t.message)))}}function mn(){return"ERROR"!==tt.client.getSyncState()||(un.set(h(p,null,h("h3",{id:"toast-header"},"It looks like you're offline"),h("div",null,"This operation requires a network connection. Try again once you're back online."))),!1)}var gn=__webpack_require__(3723),fn={};fn.styleTagTransform=Me(),fn.setAttributes=Ie(),fn.insert=Ce().bind(null,"head"),fn.domAPI=xe(),fn.insertStyleElement=Pe(),Ee()(gn.Z,fn),gn.Z&&gn.Z.locals&&gn.Z.locals;var vn=__webpack_require__(2372),yn=__webpack_require__(145),bn={};bn.styleTagTransform=Me(),bn.setAttributes=Ie(),bn.insert=Ce().bind(null,"head"),bn.domAPI=xe(),bn.insertStyleElement=Pe(),Ee()(yn.Z,bn),yn.Z&&yn.Z.locals&&yn.Z.locals;class wn extends m{constructor(e){var t,n;super(e),n={current:null},(t="canvas")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n,this.pendingRender=null,this.pendingTextRender=null,this.hasRendered=!1}componentDidUpdate(e){if(!this.hasRendered||e.pageFocused!==this.props.pageFocused){const e=this.grabControl();this.drawPdf(e).then((e=>this.props.annotationLayer?.current.forceUpdate())).then((e=>this.highlightText(this.props.searchString)))}e.searchString!==this.props.searchString&&this.highlightText(this.props.searchString)}componentDidMount(){this.props.textLayer.current.addEventListener("click",(e=>{e.preventDefault();const t=new MouseEvent(e.type,e);document.elementsFromPoint(e.clientX,e.clientY).forEach((e=>{e.hasAttribute("data-annotation")&&e.dispatchEvent(t)}))}))}grabControl(){const e={};this.controlToken=e;try{this.pendingRender.cancel()}catch(e){console.log(e)}try{this.pendingTextRender.cancel()}catch(e){console.log(e)}return this.cleanText="",this.props.textLayer.current.innerHTML="",e}async drawPdf(e){this.hasRendered=!0;const t=this.canvas.current;await this.props.hasFetched,this.props.setPdfLoadingStatus("Rendering PDF");const n=await this.props.pdfPromise;if(e!==this.controlToken)return;const i=await n.getPage(this.props.pageFocused).catch(console.log);if(!i)return;console.log("Page loaded");const r=this.props.pdfScale,s=i.getViewport({scale:r});t.height=s.height,t.width=s.width;const o=Math.min(s.width/r,window.innerWidth),a=o/s.width*s.height;this.props.setPdfDimensions?.(a,o),this.props.setPdfFitRatio?.(Math.min(1,window.innerWidth/(s.width/r)));const l=t.getContext("2d"),c={canvasContext:l,viewport:s};if(e!==this.controlToken)return;l.clearRect(0,0,t.width,t.height),this.pendingRender=i.render(c),await this.pendingRender.promise.catch((e=>"RenderingCancelledException"===e.name?console.log(e.message):console.log(e))),console.log("Page rendered");const d=await i.getTextContent();e===this.controlToken&&this.props.textLayer.current&&(this.pendingTextRender=vn.renderTextLayer({textContent:d,container:this.props.textLayer.current,viewport:i.getViewport({scale:1}),textDivs:[]}),this.pendingTextRender.promise.then((e=>{this.cleanText=this.props.textLayer.current.innerHTML})))}async highlightText(e){if(!this.props.textLayer.current)return;if(this.props.textLayer.current.innerHTML=this.cleanText,!e||e.length<3)return;const t=this.props.textLayer.current.children,n=Array.from(t).map((e=>e.innerText)).join("").replace(/[^a-zA-Z0-9]/gm,"").toLowerCase();e=e.replace(/[^a-zA-Z0-9]/gm,"").toLowerCase();let i=n.indexOf(e),r=i+e.length,s=0,o=!0,a=!1;for(const l of t){let t="",c="",d="",h="";for(const u of l.innerText)s===i?o=!1:s===r&&(a=!0,i=n.indexOf(e,r),i>=0&&(t+=`${c}<mark>${d}</mark>${h}`,c="",d="",h="",r=i+e.length,o=!0,a=!1)),o?c+=u:a?h+=u:d+=u,u.match(/[a-zA-Z0-9]/)&&s++;""!==d?l.innerHTML=`${t}${c}<mark>${d}</mark>${h}`:""!==t&&(l.innerHTML=`${t}${c}${d}${h}`)}}render(e){return h(p,null,h("canvas",{ref:this.canvas,"data-page":e.pageFocused,class:"pdf-canvas"}),h("div",{style:"z-index:3",ref:this.props.textLayer,class:"text-layer"}))}}var Sn=__webpack_require__(1796),_n=__webpack_require__.n(Sn);function En(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function kn(e){return e instanceof En(e).Element||e instanceof Element}function xn(e){return e instanceof En(e).HTMLElement||e instanceof HTMLElement}function Tn(e){return"undefined"!=typeof ShadowRoot&&(e instanceof En(e).ShadowRoot||e instanceof ShadowRoot)}var Cn=Math.max,An=Math.min,In=Math.round;function Rn(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function Pn(){return!/^((?!chrome|android).)*safari/i.test(Rn())}function On(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=e.getBoundingClientRect(),r=1,s=1;t&&xn(e)&&(r=e.offsetWidth>0&&In(i.width)/e.offsetWidth||1,s=e.offsetHeight>0&&In(i.height)/e.offsetHeight||1);var o=(kn(e)?En(e):window).visualViewport,a=!Pn()&&n,l=(i.left+(a&&o?o.offsetLeft:0))/r,c=(i.top+(a&&o?o.offsetTop:0))/s,d=i.width/r,h=i.height/s;return{width:d,height:h,top:c,right:l+d,bottom:c+h,left:l,x:l,y:c}}function Mn(e){var t=En(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Dn(e){return e?(e.nodeName||"").toLowerCase():null}function Ln(e){return((kn(e)?e.ownerDocument:e.document)||window.document).documentElement}function Fn(e){return On(Ln(e)).left+Mn(e).scrollLeft}function Nn(e){return En(e).getComputedStyle(e)}function jn(e){var t=Nn(e),n=t.overflow,i=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function Bn(e,t,n){void 0===n&&(n=!1);var i,r,s=xn(t),o=xn(t)&&function(e){var t=e.getBoundingClientRect(),n=In(t.width)/e.offsetWidth||1,i=In(t.height)/e.offsetHeight||1;return 1!==n||1!==i}(t),a=Ln(t),l=On(e,o,n),c={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(s||!s&&!n)&&(("body"!==Dn(t)||jn(a))&&(c=(i=t)!==En(i)&&xn(i)?{scrollLeft:(r=i).scrollLeft,scrollTop:r.scrollTop}:Mn(i)),xn(t)?((d=On(t,!0)).x+=t.clientLeft,d.y+=t.clientTop):a&&(d.x=Fn(a))),{x:l.left+c.scrollLeft-d.x,y:l.top+c.scrollTop-d.y,width:l.width,height:l.height}}function Un(e){var t=On(e),n=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:i}}function qn(e){return"html"===Dn(e)?e:e.assignedSlot||e.parentNode||(Tn(e)?e.host:null)||Ln(e)}function zn(e){return["html","body","#document"].indexOf(Dn(e))>=0?e.ownerDocument.body:xn(e)&&jn(e)?e:zn(qn(e))}function Vn(e,t){var n;void 0===t&&(t=[]);var i=zn(e),r=i===(null==(n=e.ownerDocument)?void 0:n.body),s=En(i),o=r?[s].concat(s.visualViewport||[],jn(i)?i:[]):i,a=t.concat(o);return r?a:a.concat(Vn(qn(o)))}function Kn(e){return["table","td","th"].indexOf(Dn(e))>=0}function Hn(e){return xn(e)&&"fixed"!==Nn(e).position?e.offsetParent:null}function Wn(e){for(var t=En(e),n=Hn(e);n&&Kn(n)&&"static"===Nn(n).position;)n=Hn(n);return n&&("html"===Dn(n)||"body"===Dn(n)&&"static"===Nn(n).position)?t:n||function(e){var t=/firefox/i.test(Rn());if(/Trident/i.test(Rn())&&xn(e)&&"fixed"===Nn(e).position)return null;var n=qn(e);for(Tn(n)&&(n=n.host);xn(n)&&["html","body"].indexOf(Dn(n))<0;){var i=Nn(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}return null}(e)||t}var $n="top",Gn="bottom",Yn="right",Xn="left",Zn="auto",Jn=[$n,Gn,Yn,Xn],Qn="start",ei="end",ti="viewport",ni="popper",ii=Jn.reduce((function(e,t){return e.concat([t+"-"+Qn,t+"-"+ei])}),[]),ri=[].concat(Jn,[Zn]).reduce((function(e,t){return e.concat([t,t+"-"+Qn,t+"-"+ei])}),[]),si=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function oi(e){var t=new Map,n=new Set,i=[];function r(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var i=t.get(e);i&&r(i)}})),i.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||r(e)})),i}var ai={placement:"bottom",modifiers:[],strategy:"absolute"};function li(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function ci(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,i=void 0===n?[]:n,r=t.defaultOptions,s=void 0===r?ai:r;return function(e,t,n){void 0===n&&(n=s);var r,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},ai,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,d={state:a,setOptions:function(n){var r="function"==typeof n?n(a.options):n;h(),a.options=Object.assign({},s,a.options,r),a.scrollParents={reference:kn(e)?Vn(e):e.contextElement?Vn(e.contextElement):[],popper:Vn(t)};var o,c,u=function(e){var t=oi(e);return si.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((o=[].concat(i,a.options.modifiers),c=o.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(c).map((function(e){return c[e]}))));return a.orderedModifiers=u.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,i=void 0===n?{}:n,r=e.effect;if("function"==typeof r){var s=r({state:a,name:t,instance:d,options:i});l.push(s||function(){})}})),d.update()},forceUpdate:function(){if(!c){var e=a.elements,t=e.reference,n=e.popper;if(li(t,n)){a.rects={reference:Bn(t,Wn(n),"fixed"===a.options.strategy),popper:Un(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var i=0;i<a.orderedModifiers.length;i++)if(!0!==a.reset){var r=a.orderedModifiers[i],s=r.fn,o=r.options,l=void 0===o?{}:o,h=r.name;"function"==typeof s&&(a=s({state:a,options:l,name:h,instance:d})||a)}else a.reset=!1,i=-1}}},update:(r=function(){return new Promise((function(e){d.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(r())}))}))),o}),destroy:function(){h(),c=!0}};if(!li(e,t))return d;function h(){l.forEach((function(e){return e()})),l=[]}return d.setOptions(n).then((function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)})),d}}var di={passive:!0};const hi={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,i=e.options,r=i.scroll,s=void 0===r||r,o=i.resize,a=void 0===o||o,l=En(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach((function(e){e.addEventListener("scroll",n.update,di)})),a&&l.addEventListener("resize",n.update,di),function(){s&&c.forEach((function(e){e.removeEventListener("scroll",n.update,di)})),a&&l.removeEventListener("resize",n.update,di)}},data:{}};function ui(e){return e.split("-")[0]}function pi(e){return e.split("-")[1]}function mi(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function gi(e){var t,n=e.reference,i=e.element,r=e.placement,s=r?ui(r):null,o=r?pi(r):null,a=n.x+n.width/2-i.width/2,l=n.y+n.height/2-i.height/2;switch(s){case $n:t={x:a,y:n.y-i.height};break;case Gn:t={x:a,y:n.y+n.height};break;case Yn:t={x:n.x+n.width,y:l};break;case Xn:t={x:n.x-i.width,y:l};break;default:t={x:n.x,y:n.y}}var c=s?mi(s):null;if(null!=c){var d="y"===c?"height":"width";switch(o){case Qn:t[c]=t[c]-(n[d]/2-i[d]/2);break;case ei:t[c]=t[c]+(n[d]/2-i[d]/2)}}return t}var fi={top:"auto",right:"auto",bottom:"auto",left:"auto"};function vi(e){var t,n=e.popper,i=e.popperRect,r=e.placement,s=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,d=e.roundOffsets,h=e.isFixed,u=o.x,p=void 0===u?0:u,m=o.y,g=void 0===m?0:m,f="function"==typeof d?d({x:p,y:g}):{x:p,y:g};p=f.x,g=f.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),b=Xn,w=$n,S=window;if(c){var _=Wn(n),E="clientHeight",k="clientWidth";_===En(n)&&"static"!==Nn(_=Ln(n)).position&&"absolute"===a&&(E="scrollHeight",k="scrollWidth"),(r===$n||(r===Xn||r===Yn)&&s===ei)&&(w=Gn,g-=(h&&_===S&&S.visualViewport?S.visualViewport.height:_[E])-i.height,g*=l?1:-1),r!==Xn&&(r!==$n&&r!==Gn||s!==ei)||(b=Yn,p-=(h&&_===S&&S.visualViewport?S.visualViewport.width:_[k])-i.width,p*=l?1:-1)}var x,T=Object.assign({position:a},c&&fi),C=!0===d?function(e){var t=e.x,n=e.y,i=window.devicePixelRatio||1;return{x:In(t*i)/i||0,y:In(n*i)/i||0}}({x:p,y:g}):{x:p,y:g};return p=C.x,g=C.y,l?Object.assign({},T,((x={})[w]=y?"0":"",x[b]=v?"0":"",x.transform=(S.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",x)):Object.assign({},T,((t={})[w]=y?g+"px":"",t[b]=v?p+"px":"",t.transform="",t))}const yi={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,i=n.gpuAcceleration,r=void 0===i||i,s=n.adaptive,o=void 0===s||s,a=n.roundOffsets,l=void 0===a||a,c={placement:ui(t.placement),variation:pi(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,vi(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,vi(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},bi={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},i=t.attributes[e]||{},r=t.elements[e];xn(r)&&Dn(r)&&(Object.assign(r.style,n),Object.keys(i).forEach((function(e){var t=i[e];!1===t?r.removeAttribute(e):r.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var i=t.elements[e],r=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});xn(i)&&Dn(i)&&(Object.assign(i.style,s),Object.keys(r).forEach((function(e){i.removeAttribute(e)})))}))}},requires:["computeStyles"]},wi={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.offset,s=void 0===r?[0,0]:r,o=ri.reduce((function(e,n){return e[n]=function(e,t,n){var i=ui(e),r=[Xn,$n].indexOf(i)>=0?-1:1,s="function"==typeof n?n(Object.assign({},t,{placement:e})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*r,[Xn,Yn].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}(n,t.rects,s),e}),{}),a=o[t.placement],l=a.x,c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=o}};var Si={left:"right",right:"left",bottom:"top",top:"bottom"};function _i(e){return e.replace(/left|right|bottom|top/g,(function(e){return Si[e]}))}var Ei={start:"end",end:"start"};function ki(e){return e.replace(/start|end/g,(function(e){return Ei[e]}))}function xi(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&Tn(n)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Ti(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Ci(e,t,n){return t===ti?Ti(function(e,t){var n=En(e),i=Ln(e),r=n.visualViewport,s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;var c=Pn();(c||!c&&"fixed"===t)&&(a=r.offsetLeft,l=r.offsetTop)}return{width:s,height:o,x:a+Fn(e),y:l}}(e,n)):kn(t)?function(e,t){var n=On(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):Ti(function(e){var t,n=Ln(e),i=Mn(e),r=null==(t=e.ownerDocument)?void 0:t.body,s=Cn(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=Cn(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-i.scrollLeft+Fn(e),l=-i.scrollTop;return"rtl"===Nn(r||n).direction&&(a+=Cn(n.clientWidth,r?r.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}(Ln(e)))}function Ai(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Ii(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function Ri(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=void 0===i?e.placement:i,s=n.strategy,o=void 0===s?e.strategy:s,a=n.boundary,l=void 0===a?"clippingParents":a,c=n.rootBoundary,d=void 0===c?ti:c,h=n.elementContext,u=void 0===h?ni:h,p=n.altBoundary,m=void 0!==p&&p,g=n.padding,f=void 0===g?0:g,v=Ai("number"!=typeof f?f:Ii(f,Jn)),y=u===ni?"reference":ni,b=e.rects.popper,w=e.elements[m?y:u],S=function(e,t,n,i){var r="clippingParents"===t?function(e){var t=Vn(qn(e)),n=["absolute","fixed"].indexOf(Nn(e).position)>=0&&xn(e)?Wn(e):e;return kn(n)?t.filter((function(e){return kn(e)&&xi(e,n)&&"body"!==Dn(e)})):[]}(e):[].concat(t),s=[].concat(r,[n]),o=s[0],a=s.reduce((function(t,n){var r=Ci(e,n,i);return t.top=Cn(r.top,t.top),t.right=An(r.right,t.right),t.bottom=An(r.bottom,t.bottom),t.left=Cn(r.left,t.left),t}),Ci(e,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}(kn(w)?w:w.contextElement||Ln(e.elements.popper),l,d,o),_=On(e.elements.reference),E=gi({reference:_,element:b,strategy:"absolute",placement:r}),k=Ti(Object.assign({},b,E)),x=u===ni?k:_,T={top:S.top-x.top+v.top,bottom:x.bottom-S.bottom+v.bottom,left:S.left-x.left+v.left,right:x.right-S.right+v.right},C=e.modifiersData.offset;if(u===ni&&C){var A=C[r];Object.keys(T).forEach((function(e){var t=[Yn,Gn].indexOf(e)>=0?1:-1,n=[$n,Gn].indexOf(e)>=0?"y":"x";T[e]+=A[n]*t}))}return T}const Pi={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var r=n.mainAxis,s=void 0===r||r,o=n.altAxis,a=void 0===o||o,l=n.fallbackPlacements,c=n.padding,d=n.boundary,h=n.rootBoundary,u=n.altBoundary,p=n.flipVariations,m=void 0===p||p,g=n.allowedAutoPlacements,f=t.options.placement,v=ui(f),y=l||(v!==f&&m?function(e){if(ui(e)===Zn)return[];var t=_i(e);return[ki(e),t,ki(t)]}(f):[_i(f)]),b=[f].concat(y).reduce((function(e,n){return e.concat(ui(n)===Zn?function(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?ri:l,d=pi(i),h=d?a?ii:ii.filter((function(e){return pi(e)===d})):Jn,u=h.filter((function(e){return c.indexOf(e)>=0}));0===u.length&&(u=h);var p=u.reduce((function(t,n){return t[n]=Ri(e,{placement:n,boundary:r,rootBoundary:s,padding:o})[ui(n)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}(t,{placement:n,boundary:d,rootBoundary:h,padding:c,flipVariations:m,allowedAutoPlacements:g}):n)}),[]),w=t.rects.reference,S=t.rects.popper,_=new Map,E=!0,k=b[0],x=0;x<b.length;x++){var T=b[x],C=ui(T),A=pi(T)===Qn,I=[$n,Gn].indexOf(C)>=0,R=I?"width":"height",P=Ri(t,{placement:T,boundary:d,rootBoundary:h,altBoundary:u,padding:c}),O=I?A?Yn:Xn:A?Gn:$n;w[R]>S[R]&&(O=_i(O));var M=_i(O),D=[];if(s&&D.push(P[C]<=0),a&&D.push(P[O]<=0,P[M]<=0),D.every((function(e){return e}))){k=T,E=!1;break}_.set(T,D)}if(E)for(var L=function(e){var t=b.find((function(t){var n=_.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return k=t,"break"},F=m?3:1;F>0&&"break"!==L(F);F--);t.placement!==k&&(t.modifiersData[i]._skip=!0,t.placement=k,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Oi(e,t,n){return Cn(e,An(t,n))}const Mi={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.mainAxis,s=void 0===r||r,o=n.altAxis,a=void 0!==o&&o,l=n.boundary,c=n.rootBoundary,d=n.altBoundary,h=n.padding,u=n.tether,p=void 0===u||u,m=n.tetherOffset,g=void 0===m?0:m,f=Ri(t,{boundary:l,rootBoundary:c,padding:h,altBoundary:d}),v=ui(t.placement),y=pi(t.placement),b=!y,w=mi(v),S="x"===w?"y":"x",_=t.modifiersData.popperOffsets,E=t.rects.reference,k=t.rects.popper,x="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,T="number"==typeof x?{mainAxis:x,altAxis:x}:Object.assign({mainAxis:0,altAxis:0},x),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(_){if(s){var I,R="y"===w?$n:Xn,P="y"===w?Gn:Yn,O="y"===w?"height":"width",M=_[w],D=M+f[R],L=M-f[P],F=p?-k[O]/2:0,N=y===Qn?E[O]:k[O],j=y===Qn?-k[O]:-E[O],B=t.elements.arrow,U=p&&B?Un(B):{width:0,height:0},q=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},z=q[R],V=q[P],K=Oi(0,E[O],U[O]),H=b?E[O]/2-F-K-z-T.mainAxis:N-K-z-T.mainAxis,W=b?-E[O]/2+F+K+V+T.mainAxis:j+K+V+T.mainAxis,$=t.elements.arrow&&Wn(t.elements.arrow),G=$?"y"===w?$.clientTop||0:$.clientLeft||0:0,Y=null!=(I=null==C?void 0:C[w])?I:0,X=M+W-Y,Z=Oi(p?An(D,M+H-Y-G):D,M,p?Cn(L,X):L);_[w]=Z,A[w]=Z-M}if(a){var J,Q="x"===w?$n:Xn,ee="x"===w?Gn:Yn,te=_[S],ne="y"===S?"height":"width",ie=te+f[Q],re=te-f[ee],se=-1!==[$n,Xn].indexOf(v),oe=null!=(J=null==C?void 0:C[S])?J:0,ae=se?ie:te-E[ne]-k[ne]-oe+T.altAxis,le=se?te+E[ne]+k[ne]-oe-T.altAxis:re,ce=p&&se?function(e,t,n){var i=Oi(e,t,n);return i>n?n:i}(ae,te,le):Oi(p?ae:ie,te,p?le:re);_[S]=ce,A[S]=ce-te}t.modifiersData[i]=A}},requiresIfExists:["offset"]},Di={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,i=e.name,r=e.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=ui(n.placement),l=mi(a),c=[Xn,Yn].indexOf(a)>=0?"height":"width";if(s&&o){var d=function(e,t){return Ai("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Ii(e,Jn))}(r.padding,n),h=Un(s),u="y"===l?$n:Xn,p="y"===l?Gn:Yn,m=n.rects.reference[c]+n.rects.reference[l]-o[l]-n.rects.popper[c],g=o[l]-n.rects.reference[l],f=Wn(s),v=f?"y"===l?f.clientHeight||0:f.clientWidth||0:0,y=m/2-g/2,b=d[u],w=v-h[c]-d[p],S=v/2-h[c]/2+y,_=Oi(b,S,w),E=l;n.modifiersData[i]=((t={})[E]=_,t.centerOffset=_-S,t)}},effect:function(e){var t=e.state,n=e.options.element,i=void 0===n?"[data-popper-arrow]":n;null!=i&&("string"!=typeof i||(i=t.elements.popper.querySelector(i)))&&xi(t.elements.popper,i)&&(t.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Li(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Fi(e){return[$n,Yn,Gn,Xn].some((function(t){return e[t]>=0}))}var Ni=ci({defaultModifiers:[hi,{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=gi({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},yi,bi,wi,Pi,Mi,Di,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,i=t.rects.reference,r=t.rects.popper,s=t.modifiersData.preventOverflow,o=Ri(t,{elementContext:"reference"}),a=Ri(t,{altBoundary:!0}),l=Li(o,i),c=Li(a,r,s),d=Fi(l),h=Fi(c);t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:h},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":h})}}]}),ji="tippy-content",Bi="tippy-arrow",Ui="tippy-svg-arrow",qi={passive:!0,capture:!0},zi=function(){return document.body};function Vi(e,t,n){if(Array.isArray(e)){var i=e[t];return null==i?Array.isArray(n)?n[t]:n:i}return e}function Ki(e,t){var n={}.toString.call(e);return 0===n.indexOf("[object")&&n.indexOf(t+"]")>-1}function Hi(e,t){return"function"==typeof e?e.apply(void 0,t):e}function Wi(e,t){return 0===t?e:function(i){clearTimeout(n),n=setTimeout((function(){e(i)}),t)};var n}function $i(e){return[].concat(e)}function Gi(e,t){-1===e.indexOf(t)&&e.push(t)}function Yi(e){return[].slice.call(e)}function Xi(e){return Object.keys(e).reduce((function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t}),{})}function Zi(){return document.createElement("div")}function Ji(e){return["Element","Fragment"].some((function(t){return Ki(e,t)}))}function Qi(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function er(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function tr(e,t,n){var i=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[i](t,n)}))}function nr(e,t){for(var n=t;n;){var i;if(e.contains(n))return!0;n=null==n.getRootNode||null==(i=n.getRootNode())?void 0:i.host}return!1}var ir={isTouch:!1},rr=0;function sr(){ir.isTouch||(ir.isTouch=!0,window.performance&&document.addEventListener("mousemove",or))}function or(){var e=performance.now();e-rr<20&&(ir.isTouch=!1,document.removeEventListener("mousemove",or)),rr=e}function ar(){var e,t=document.activeElement;if((e=t)&&e._tippy&&e._tippy.reference===e){var n=t._tippy;t.blur&&!n.state.isVisible&&t.blur()}}var lr=!("undefined"==typeof window||"undefined"==typeof document||!window.msCrypto),cr=Object.assign({appendTo:zi,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),dr=Object.keys(cr);function hr(e){var t=(e.plugins||[]).reduce((function(t,n){var i,r=n.name,s=n.defaultValue;return r&&(t[r]=void 0!==e[r]?e[r]:null!=(i=cr[r])?i:s),t}),{});return Object.assign({},e,t)}function ur(e,t){var n=Object.assign({},t,{content:Hi(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(hr(Object.assign({},cr,{plugins:t}))):dr).reduce((function(t,n){var i=(e.getAttribute("data-tippy-"+n)||"").trim();if(!i)return t;if("content"===n)t[n]=i;else try{t[n]=JSON.parse(i)}catch(e){t[n]=i}return t}),{})}(e,t.plugins));return n.aria=Object.assign({},cr.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?t.interactive:n.aria.expanded,content:"auto"===n.aria.content?t.interactive?null:"describedby":n.aria.content},n}function pr(e,t){e.innerHTML=t}function mr(e){var t=Zi();return!0===e?t.className=Bi:(t.className=Ui,Ji(e)?t.appendChild(e):pr(t,e)),t}function gr(e,t){Ji(t.content)?(pr(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?pr(e,t.content):e.textContent=t.content)}function fr(e){var t=e.firstElementChild,n=Yi(t.children);return{box:t,content:n.find((function(e){return e.classList.contains(ji)})),arrow:n.find((function(e){return e.classList.contains(Bi)||e.classList.contains(Ui)})),backdrop:n.find((function(e){return e.classList.contains("tippy-backdrop")}))}}function vr(e){var t=Zi(),n=Zi();n.className="tippy-box",n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var i=Zi();function r(n,i){var r=fr(t),s=r.box,o=r.content,a=r.arrow;i.theme?s.setAttribute("data-theme",i.theme):s.removeAttribute("data-theme"),"string"==typeof i.animation?s.setAttribute("data-animation",i.animation):s.removeAttribute("data-animation"),i.inertia?s.setAttribute("data-inertia",""):s.removeAttribute("data-inertia"),s.style.maxWidth="number"==typeof i.maxWidth?i.maxWidth+"px":i.maxWidth,i.role?s.setAttribute("role",i.role):s.removeAttribute("role"),n.content===i.content&&n.allowHTML===i.allowHTML||gr(o,e.props),i.arrow?a?n.arrow!==i.arrow&&(s.removeChild(a),s.appendChild(mr(i.arrow))):s.appendChild(mr(i.arrow)):a&&s.removeChild(a)}return i.className=ji,i.setAttribute("data-state","hidden"),gr(i,e.props),t.appendChild(n),n.appendChild(i),r(e.props,e.props),{popper:t,onUpdate:r}}vr.$$tippy=!0;var yr=1,br=[],wr=[];function Sr(e,t){var n,i,r,s,o,a,l,c,d=ur(e,Object.assign({},cr,hr(Xi(t)))),h=!1,u=!1,p=!1,m=!1,g=[],f=Wi($,d.interactiveDebounce),v=yr++,y=(c=d.plugins).filter((function(e,t){return c.indexOf(e)===t})),b={id:v,reference:e,popper:Zi(),popperInstance:null,props:d,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:y,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(r)},setProps:function(t){if(!b.state.isDestroyed){M("onBeforeUpdate",[b,t]),H();var n=b.props,i=ur(e,Object.assign({},n,Xi(t),{ignoreAttributes:!0}));b.props=i,K(),n.interactiveDebounce!==i.interactiveDebounce&&(F(),f=Wi($,i.interactiveDebounce)),n.triggerTarget&&!i.triggerTarget?$i(n.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):i.triggerTarget&&e.removeAttribute("aria-expanded"),L(),O(),_&&_(n,i),b.popperInstance&&(Z(),Q().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),M("onAfterUpdate",[b,t])}},setContent:function(e){b.setProps({content:e})},show:function(){var e=b.state.isVisible,t=b.state.isDestroyed,n=!b.state.isEnabled,i=ir.isTouch&&!b.props.touch,r=Vi(b.props.duration,0,cr.duration);if(!(e||t||n||i||A().hasAttribute("disabled")||(M("onShow",[b],!1),!1===b.props.onShow(b)))){if(b.state.isVisible=!0,C()&&(S.style.visibility="visible"),O(),U(),b.state.isMounted||(S.style.transition="none"),C()){var s=R();Qi([s.box,s.content],0)}var o,l,c;a=function(){var e;if(b.state.isVisible&&!m){if(m=!0,S.offsetHeight,S.style.transition=b.props.moveTransition,C()&&b.props.animation){var t=R(),n=t.box,i=t.content;Qi([n,i],r),er([n,i],"visible")}D(),L(),Gi(wr,b),null==(e=b.popperInstance)||e.forceUpdate(),M("onMount",[b]),b.props.animation&&C()&&function(e,t){z(e,(function(){b.state.isShown=!0,M("onShown",[b])}))}(r)}},l=b.props.appendTo,c=A(),(o=b.props.interactive&&l===zi||"parent"===l?c.parentNode:Hi(l,[c])).contains(S)||o.appendChild(S),b.state.isMounted=!0,Z()}},hide:function(){var e=!b.state.isVisible,t=b.state.isDestroyed,n=!b.state.isEnabled,i=Vi(b.props.duration,1,cr.duration);if(!(e||t||n)&&(M("onHide",[b],!1),!1!==b.props.onHide(b))){if(b.state.isVisible=!1,b.state.isShown=!1,m=!1,h=!1,C()&&(S.style.visibility="hidden"),F(),q(),O(!0),C()){var r=R(),s=r.box,o=r.content;b.props.animation&&(Qi([s,o],i),er([s,o],"hidden"))}D(),L(),b.props.animation?C()&&function(e,t){z(e,(function(){!b.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&t()}))}(i,b.unmount):b.unmount()}},hideWithInteractivity:function(e){I().addEventListener("mousemove",f),Gi(br,f),f(e)},enable:function(){b.state.isEnabled=!0},disable:function(){b.hide(),b.state.isEnabled=!1},unmount:function(){b.state.isVisible&&b.hide(),b.state.isMounted&&(J(),Q().forEach((function(e){e._tippy.unmount()})),S.parentNode&&S.parentNode.removeChild(S),wr=wr.filter((function(e){return e!==b})),b.state.isMounted=!1,M("onHidden",[b]))},destroy:function(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),H(),delete e._tippy,b.state.isDestroyed=!0,M("onDestroy",[b]))}};if(!d.render)return b;var w=d.render(b),S=w.popper,_=w.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+b.id,b.popper=S,e._tippy=b,S._tippy=b;var E=y.map((function(e){return e.fn(b)})),k=e.hasAttribute("aria-expanded");return K(),L(),O(),M("onCreate",[b]),d.showOnCreate&&ee(),S.addEventListener("mouseenter",(function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()})),S.addEventListener("mouseleave",(function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&I().addEventListener("mousemove",f)})),b;function x(){var e=b.props.touch;return Array.isArray(e)?e:[e,0]}function T(){return"hold"===x()[0]}function C(){var e;return!(null==(e=b.props.render)||!e.$$tippy)}function A(){return l||e}function I(){var e,t,n=A().parentNode;return n?null!=(t=$i(n)[0])&&null!=(e=t.ownerDocument)&&e.body?t.ownerDocument:document:document}function R(){return fr(S)}function P(e){return b.state.isMounted&&!b.state.isVisible||ir.isTouch||s&&"focus"===s.type?0:Vi(b.props.delay,e?0:1,cr.delay)}function O(e){void 0===e&&(e=!1),S.style.pointerEvents=b.props.interactive&&!e?"":"none",S.style.zIndex=""+b.props.zIndex}function M(e,t,n){var i;void 0===n&&(n=!0),E.forEach((function(n){n[e]&&n[e].apply(n,t)})),n&&(i=b.props)[e].apply(i,t)}function D(){var t=b.props.aria;if(t.content){var n="aria-"+t.content,i=S.id;$i(b.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(n);if(b.state.isVisible)e.setAttribute(n,t?t+" "+i:i);else{var r=t&&t.replace(i,"").trim();r?e.setAttribute(n,r):e.removeAttribute(n)}}))}}function L(){!k&&b.props.aria.expanded&&$i(b.props.triggerTarget||e).forEach((function(e){b.props.interactive?e.setAttribute("aria-expanded",b.state.isVisible&&e===A()?"true":"false"):e.removeAttribute("aria-expanded")}))}function F(){I().removeEventListener("mousemove",f),br=br.filter((function(e){return e!==f}))}function N(t){if(!ir.isTouch||!p&&"mousedown"!==t.type){var n=t.composedPath&&t.composedPath()[0]||t.target;if(!b.props.interactive||!nr(S,n)){if($i(b.props.triggerTarget||e).some((function(e){return nr(e,n)}))){if(ir.isTouch)return;if(b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else M("onClickOutside",[b,t]);!0===b.props.hideOnClick&&(b.clearDelayTimeouts(),b.hide(),u=!0,setTimeout((function(){u=!1})),b.state.isMounted||q())}}}function j(){p=!0}function B(){p=!1}function U(){var e=I();e.addEventListener("mousedown",N,!0),e.addEventListener("touchend",N,qi),e.addEventListener("touchstart",B,qi),e.addEventListener("touchmove",j,qi)}function q(){var e=I();e.removeEventListener("mousedown",N,!0),e.removeEventListener("touchend",N,qi),e.removeEventListener("touchstart",B,qi),e.removeEventListener("touchmove",j,qi)}function z(e,t){var n=R().box;function i(e){e.target===n&&(tr(n,"remove",i),t())}if(0===e)return t();tr(n,"remove",o),tr(n,"add",i),o=i}function V(t,n,i){void 0===i&&(i=!1),$i(b.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,n,i),g.push({node:e,eventType:t,handler:n,options:i})}))}function K(){var e;T()&&(V("touchstart",W,{passive:!0}),V("touchend",G,{passive:!0})),(e=b.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(V(e,W),e){case"mouseenter":V("mouseleave",G);break;case"focus":V(lr?"focusout":"blur",Y);break;case"focusin":V("focusout",Y)}}))}function H(){g.forEach((function(e){var t=e.node,n=e.eventType,i=e.handler,r=e.options;t.removeEventListener(n,i,r)})),g=[]}function W(e){var t,n=!1;if(b.state.isEnabled&&!X(e)&&!u){var i="focus"===(null==(t=s)?void 0:t.type);s=e,l=e.currentTarget,L(),!b.state.isVisible&&Ki(e,"MouseEvent")&&br.forEach((function(t){return t(e)})),"click"===e.type&&(b.props.trigger.indexOf("mouseenter")<0||h)&&!1!==b.props.hideOnClick&&b.state.isVisible?n=!0:ee(e),"click"===e.type&&(h=!n),n&&!i&&te(e)}}function $(e){var t=e.target,n=A().contains(t)||S.contains(t);if("mousemove"!==e.type||!n){var i=Q().concat(S).map((function(e){var t,n=null==(t=e._tippy.popperInstance)?void 0:t.state;return n?{popperRect:e.getBoundingClientRect(),popperState:n,props:d}:null})).filter(Boolean);(function(e,t){var n=t.clientX,i=t.clientY;return e.every((function(e){var t=e.popperRect,r=e.popperState,s=e.props.interactiveBorder,o=r.placement.split("-")[0],a=r.modifiersData.offset;if(!a)return!0;var l="bottom"===o?a.top.y:0,c="top"===o?a.bottom.y:0,d="right"===o?a.left.x:0,h="left"===o?a.right.x:0,u=t.top-i+l>s,p=i-t.bottom-c>s,m=t.left-n+d>s,g=n-t.right-h>s;return u||p||m||g}))})(i,e)&&(F(),te(e))}}function G(e){X(e)||b.props.trigger.indexOf("click")>=0&&h||(b.props.interactive?b.hideWithInteractivity(e):te(e))}function Y(e){b.props.trigger.indexOf("focusin")<0&&e.target!==A()||b.props.interactive&&e.relatedTarget&&S.contains(e.relatedTarget)||te(e)}function X(e){return!!ir.isTouch&&T()!==e.type.indexOf("touch")>=0}function Z(){J();var t=b.props,n=t.popperOptions,i=t.placement,r=t.offset,s=t.getReferenceClientRect,o=t.moveTransition,l=C()?fr(S).arrow:null,c=s?{getBoundingClientRect:s,contextElement:s.contextElement||A()}:e,d={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(C()){var n=R().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?n.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?n.setAttribute("data-"+e,""):n.removeAttribute("data-"+e)})),t.attributes.popper={}}}},h=[{name:"offset",options:{offset:r}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},d];C()&&l&&h.push({name:"arrow",options:{element:l,padding:3}}),h.push.apply(h,(null==n?void 0:n.modifiers)||[]),b.popperInstance=Ni(c,S,Object.assign({},n,{placement:i,onFirstUpdate:a,modifiers:h}))}function J(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function Q(){return Yi(S.querySelectorAll("[data-tippy-root]"))}function ee(e){b.clearDelayTimeouts(),e&&M("onTrigger",[b,e]),U();var t=P(!0),i=x(),r=i[0],s=i[1];ir.isTouch&&"hold"===r&&s&&(t=s),t?n=setTimeout((function(){b.show()}),t):b.show()}function te(e){if(b.clearDelayTimeouts(),M("onUntrigger",[b,e]),b.state.isVisible){if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&h)){var t=P(!1);t?i=setTimeout((function(){b.state.isVisible&&b.hide()}),t):r=requestAnimationFrame((function(){b.hide()}))}}else q()}}function _r(e,t){void 0===t&&(t={});var n=cr.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",sr,qi),window.addEventListener("blur",ar);var i,r=Object.assign({},t,{plugins:n}),s=(i=e,Ji(i)?[i]:function(e){return Ki(e,"NodeList")}(i)?Yi(i):Array.isArray(i)?i:Yi(document.querySelectorAll(i))).reduce((function(e,t){var n=t&&Sr(t,r);return n&&e.push(n),e}),[]);return Ji(e)?s[0]:s}_r.defaultProps=cr,_r.setDefaultProps=function(e){Object.keys(e).forEach((function(t){cr[t]=e[t]}))},_r.currentInput=ir,Object.assign({},bi,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}}),_r.setDefaultProps({render:vr});const Er=_r;var kr=__webpack_require__(6894),xr={};xr.styleTagTransform=Me(),xr.setAttributes=Ie(),xr.insert=Ce().bind(null,"head"),xr.domAPI=xe(),xr.insertStyleElement=Pe(),Ee()(kr.Z,xr),kr.Z&&kr.Z.locals&&kr.Z.locals;class Tr extends m{componentDidMount(){this.tippy=Er(this.base,Object.assign({delay:[1500,null],touch:["hold",1e3]},this.props)),this.base.addEventListener("focusout",this.tippy.hide()),this.base.setAttribute("aria-label",this.props.content)}componentWillUnmount(){this.tippy.destroy()}componentDidUpdate(e){e.content!==this.props.content&&this.tippy.setProps(this.props)}show(){this.tippy.show()}hide(){this.tippy.show()}render(e){return e.children}}var Cr=__webpack_require__(7230),Ar={};Ar.styleTagTransform=Me(),Ar.setAttributes=Ie(),Ar.insert=Ce().bind(null,"head"),Ar.domAPI=xe(),Ar.insertStyleElement=Pe(),Ee()(Cr.Z,Ar),Cr.Z&&Cr.Z.locals&&Cr.Z.locals;var Ir=__webpack_require__(9041),Rr=__webpack_require__.n(Ir);const Pr=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Or=e=>{let t=0;for(let n=0;n<e.length;n++){const i=e[n];t=83*t+Pr.indexOf(i)}return t},Mr=(e,t)=>{var n="";for(let i=1;i<=t;i++){let r=Math.floor(e)/Math.pow(83,t-i)%83;n+=Pr[Math.floor(r)]}return n},Dr=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},Lr=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.round(12.92*t*255+.5):Math.round(255*(1.055*Math.pow(t,1/2.4)-.055)+.5)},Fr=(e,t)=>(e<0?-1:1)*Math.pow(Math.abs(e),t);class Nr extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}}const jr=(e,t,n,i)=>{let r=0,s=0,o=0;const a=4*t;for(let l=0;l<t;l++)for(let t=0;t<n;t++){const n=i(l,t);r+=n*Dr(e[4*l+0+t*a]),s+=n*Dr(e[4*l+1+t*a]),o+=n*Dr(e[4*l+2+t*a])}let l=1/(t*n);return[r*l,s*l,o*l]},Br=[0,0,22,37,0,0,22,37,1];function Ur(e){const t=new Image,n=URL.createObjectURL(e),i=new Promise(((e,i)=>{t.onload=i=>{URL.revokeObjectURL(n),e(t)},t.onerror=e=>i(e)}));return t.src=n,i}function qr(e,t,n,i){return new Promise((r=>{let s=t,o=n;o>600&&(s=Math.floor(s*(600/o)),o=600),s>800&&(o=Math.floor(o*(800/s)),s=800);const a=document.createElement("canvas");a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),a.toBlob((e=>{r({info:{thumbnail_info:{w:s,h:o,mimetype:e.type,size:e.size},w:t,h:n},thumbnail:e})}),i)}))}async function zr(e){const t=Ur(e);let n;"image/png"===e.type&&(n=function(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=e=>t(e.target.result),i.onerror=e=>n(e),i.readAsArrayBuffer(e)}))}(e).then((e=>{const t=new Uint8Array(e),n=Rr()(t);for(const e of n)if("pHYs"===e.name){if(e.data.byteLength!==Br.length)return;return e.data.every(((e,t)=>e===Br[t]))}return!1})));const[i,r]=await Promise.all([n,t]);return{width:i?r.width>>1:r.width,height:i?r.height>>1:r.height,img:r}}function Vr(e,t){return new Promise(((n,i)=>{const r=document.createElement(t),s=URL.createObjectURL(e);r.src=s,r.onloadeddata=e=>{URL.revokeObjectURL(s),n(r)},r.onerror=e=>i(e)}))}async function Kr(e){const t=Ur(e),n=await t;let i=n.width,r=n.height;r>100&&(i=Math.floor(i*(100/r)),r=100),i>100&&(r=Math.floor(r*(100/i)),i=100);const s=document.createElement("canvas");s.width=i,s.height=r;const o=s.getContext("2d");o.drawImage(n,0,0,i,r);const a=o.getImageData(0,0,i,r);return((e,t,n,i,r)=>{if(i<1||i>9||r<1||r>9)throw new Nr("BlurHash must have between 1 and 9 components");if(t*n*4!==e.length)throw new Nr("Width and height must match the pixels array");let s=[];for(let o=0;o<r;o++)for(let r=0;r<i;r++){const i=0==r&&0==o?1:2,a=jr(e,t,n,((e,s)=>i*Math.cos(Math.PI*r*e/t)*Math.cos(Math.PI*o*s/n)));s.push(a)}const o=s[0],a=s.slice(1);let l,c="";if(c+=Mr(i-1+9*(r-1),1),a.length>0){let e=Math.max(...a.map((e=>Math.max(...e)))),t=Math.floor(Math.max(0,Math.min(82,Math.floor(166*e-.5))));l=(t+1)/166,c+=Mr(t,1)}else l=1,c+=Mr(0,1);var d;return c+=Mr((Lr((d=o)[0])<<16)+(Lr(d[1])<<8)+Lr(d[2]),4),a.forEach((e=>{c+=Mr(((e,t)=>19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*Fr(e[0]/t,.5)+9.5))))*19+19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*Fr(e[1]/t,.5)+9.5))))+Math.floor(Math.max(0,Math.min(18,Math.floor(9*Fr(e[2]/t,.5)+9.5)))))(e,l),2)})),c})(a.data,a.width,a.height,4,4)}function Hr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Wr extends m{constructor(e){super(),Hr(this,"avatarImageInput",{current:null}),Hr(this,"chooseAvatar",(e=>this.avatarImageInput.current.click())),Hr(this,"removeAvatar",(e=>{this.setState({previewUrl:null}),delete this.avatarImage,this.props.handleUpdate?.()})),Hr(this,"updatePreview",(e=>{this.avatarImage=this.avatarImageInput.current.files[0],this.avatarImage&&/^image/.test(this.avatarImage.type)&&this.setState({previewUrl:URL.createObjectURL(this.avatarImage)}),this.props.handleUpdate?.()})),this.state={previewUrl:e.previewUrl||void 0}}async uploadAvatar(e){if(e=e||this.props.room,this.avatarImage&&/^image/.test(this.avatarImage.type)){const{width:t,height:n}=await zr(this.avatarImage);this.setState({progress:"generating blurhash..."});const i=await Kr(this.avatarImage);await tt.client.uploadContent(this.avatarImage,{progressHandler:this.props.progressHandler}).then((r=>tt.client.sendStateEvent(e.roomId,ge.EventType.RoomAvatar,{info:{w:t,h:n,mimetype:this.avatarImage.type?this.avatarImage.type:"application/octet-stream",size:this.avatarImage.size,blurhash:i},url:r},"")))}else null===this.state.previewUrl&&this.props.room&&await tt.client.sendStateEvent(this.props.room.roomId,ge.EventType.RoomAvatar,{},"")}render(e,t){return h("div",{id:"select-avatar-wrapper"},t.previewUrl?h("img",{onclick:this.chooseAvatar,id:"select-avatar-selector",src:t.previewUrl}):h("div",{key:"select-avatar-selector",onclick:this.chooseAvatar,id:"select-avatar-selector"}),t.previewUrl?h("button",{id:"select-avatar-change-avatar",type:"button",onclick:this.removeAvatar},"Remove Avatar"):null,t.previewUrl?null:h("button",{id:"select-avatar-change-avatar",type:"button",onclick:this.chooseAvatar},"Add Avatar"),h("input",{id:"select-avatar-selector-hidden",onchange:this.updatePreview,ref:this.avatarImageInput,accept:"image/*",type:"file"}))}}function $r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Gr extends m{constructor(e){super(e),$r(this,"namingTimeout",null),$r(this,"mainForm",{current:null}),$r(this,"fileLoader",{current:null}),$r(this,"roomNameInput",{current:null}),$r(this,"roomAliasInput",{current:null}),$r(this,"roomTopicInput",{current:null}),$r(this,"avatarSelector",{current:null}),$r(this,"submitButton",{current:null}),$r(this,"uploadPreview",{current:null}),$r(this,"progressHandler",(e=>this.setState({progress:e}))),$r(this,"keydownHandler",(e=>e.stopPropagation())),$r(this,"chooseFile",(e=>this.fileLoader.current.click())),$r(this,"clearFile",(e=>this.setState({fileValid:!1},this.fileLoader.current.reset))),$r(this,"nameInputHandler",(e=>{e.stopPropagation(),this.setState({name:e.target.value},this.validateAlias)})),$r(this,"topicInputHandler",(e=>{e.stopPropagation(),this.roomTopicInput.current.style.height="auto",this.roomTopicInput.current.style.height=`${this.roomTopicInput.current.scrollHeight}px`})),$r(this,"handleToggle",(e=>this.setState((e=>({details:!e.details}))))),$r(this,"aliasInputHandler",(e=>{e.stopPropagation(),this.setState({alias:this.toAlias(e.target.value)},this.validateAlias)})),$r(this,"validateAlias",(e=>{clearTimeout(this.namingTimeout),this.setState({querying:!0});const t=this.state.alias.length>0?this.state.alias:this.toAlias(this.state.name);this.namingTimeout=setTimeout((e=>{tt.client.getRoomIdForAlias(`#${t}:${tt.client.getDomain()}`).then((e=>this.setState({querying:!1,aliasAvailable:!1}))).catch((e=>{""===t?this.setState({querying:!1,aliasAvailable:!1}):"M_NOT_FOUND"===e.errcode?this.setState({querying:!1,aliasAvailable:!0}):alert(e)}))}),1e3)})),$r(this,"validateFile",(e=>{const t=this.fileLoader.current.files[0],n=tt.mediaConfig["m.upload.size"];let i=!1;switch(t.type){case"application/pdf":i=!0;case"audio/wav":i=!0;case"audio/mpeg":i=!0;case"audio/mp4":i=!0;case"audio/x-m4a":i=!0;case"audio/aac":i=!0;case"audio/aacp":i=!0;case"audio/flac":i=!0;case"video/mp4":i=!0;case"video/mpeg":i=!0;case"video/webm":i=!0}t.type?.match(/^image/)&&(i=!0),t.size>=n&&(i=!1),this.setState({fileValid:i}),i||(t.size>=n?alert(`Sorry, this file is too large to be uploaded. Your current server limits uploads to ${ye(n)}.`):alert("Please make sure that the file you're uploading is of a supported filetype and has the right extension at the end of its name. Supported filetypes are: pdf, wav, mp3, mp4, m4a, aac, mpeg, webm, and flac."),this.mainForm.current.reset())})),$r(this,"uploadFile",(async e=>{if(e.preventDefault(),!mn())return;const t=this.fileLoader.current.files[0],n=this.state.name,i=this.state.alias.length>0?this.state.alias:this.toAlias(this.state.name),r=this.roomTopicInput.current.value;let s;this.uploadPreview?.current?.pcm&&(s=await tt.client.uploadContent(JSON.stringify(this.uploadPreview?.current?.pcm),{progressHandler:this.progressHandler}).catch(alert));const o=await tt.client.uploadContent(t,{progressHandler:this.progressHandler}).catch(alert);this.submitButton.current.setAttribute("disabled",!0);const{room_id:a}=await tt.client.createRoom({room_alias_name:i,visibility:"private",name:n,topic:r,creation_content:{type:"m.space",[ze]:{"m.file":{url:o,name:t.name,mimetype:t.type,size:t.size}}},initial_state:[{type:ge.EventType.RoomJoinRules,state_key:"",content:{join_rule:"public"}},...s?[{type:Ye,state_key:"",content:{mxc:s}}]:[]],power_level_content_override:{events:{[Be]:0}}}).catch(alert),l=await tt.client.getRoomWithState(a);await this.avatarSelector.current.uploadAvatar(l),this.mainForm.current.reset(),this.props.showMainView()})),this.state={querying:!1,aliasAvailable:!1,fileValid:!1,name:"",alias:"",details:!1}}toAlias(e){return e.replace(/[\s:]/g,"_")}render(e,t){return h("div",{id:"file-upload"},h("h2",null," Upload a new file"),h("hr",{class:"styled-rule"}),t.fileValid?h(p,null,h(Yr,{uploadPreview:this.uploadPreview,file:this.fileLoader.current.files[0]}),h("hr",{class:"styled-rule"})):null,h("form",{id:"file-upload-form",ref:this.mainForm,onsubmit:this.uploadFile},h("label",{for:"file"}," File to Discuss"),h("div",{id:"file-upload-chooser"}," ",t.fileValid?h(p,null,h("span",null,this.fileLoader.current.files[0].name),h("button",{type:"button",onclick:this.clearFile,class:"small-icon"},ot)):h("button",{type:"button",class:"styled-button",onclick:this.chooseFile},"Click to Choose a File"),h("input",{name:"file",oninput:this.validateFile,ref:this.fileLoader,accept:"application/pdf, audio/wav, audio/mpeg, audio/x-m4a, audio/mp4, audio/aac, audio/aacp, audio/flac, video/mp4, video/mpeg, video/webm, image/*",type:"file"})),h("div",{class:"file-upload-form-detail"},t.fileValid?ye(this.fileLoader.current.files[0].size):h("span",null,"")),h("label",{for:"discussion"},"Name for Discussion"),h("input",{class:"styled-input",name:"discussion",value:t.name,onkeydown:this.keydownHandler,oninput:this.nameInputHandler,ref:this.roomNameInput,type:"text"}),t.details?null:h("div",{class:"file-upload-form-detail"},t.querying?"querying...":t.aliasAvailable?"name available":"name unavailable"),h("label",{class:"top-aligned-label",for:"topic"},"Room Avatar"),h(Wr,{ref:this.avatarSelector,progressHandler:this.progressHandler}),h("div",{class:"file-upload-form-detail"},"Add an image to display with this discussion"),h("label",{class:"top-aligned-label",for:"topic"},"Topic of Discussion"),h("textarea",{class:"styled-input",name:"topic",onkeydown:this.keydownHandler,oninput:this.topicInputHandler,ref:this.roomTopicInput,type:"text","data-gramm":"false"}),h("details",{open:t.details,ontoggle:this.handleToggle},h("summary",null,"Advanced Settings"),h("div",{class:"file-upload-details-wrapper"},h("label",{for:"discussion"},"Canonical Alias"),h("input",{name:"discussion",value:t.alias,placeholder:this.toAlias(t.name),oninput:this.aliasInputHandler,ref:this.roomAliasInput,type:"text"}),t.details?h("div",{class:"file-upload-form-detail"},t.querying?"querying...":t.aliasAvailable?"alias available":"alias unavailable"):null)),h("div",{id:"file-upload-form-submit"},h("button",{disabled:t.progress||t.querying||!t.aliasAvailable||!t.fileValid,class:"styled-button",ref:this.submitButton,type:"submit"},t.progress?"Uploading...":"Create Discussion")),t.progress?h("div",{id:"file-upload-form-progress"},h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null))}}class Yr extends m{render(e){return"application/pdf"===e.file.type?h(Xr,{ref:e.uploadPreview,key:e.file.name,file:e.file}):e.file.type.match(/^image/)?h(Jr,{ref:e.uploadPreview,key:e.file.name,file:e.file}):e.file.type.match(/^audio|^video/)?h(Zr,{ref:e.uploadPreview,key:e.file.name,file:e.file}):h(Qr,{ref:e.uploadPreview,file:e.file})}}class Xr extends m{constructor(e){super(e),$r(this,"textLayer",{current:null}),$r(this,"nextPage",(e=>{this.state.pdfPage<this.state.totalPages&&this.setState((e=>({pdfPage:e.pdfPage+1})))})),$r(this,"prevPage",(e=>{this.state.pdfPage>1&&this.setState((e=>({pdfPage:e.pdfPage-1})))})),$r(this,"setPdfDimensions",((e,t)=>this.setState({pdfWidthPx:t,pdfHeightPx:e}))),$r(this,"setPdfFitRatio",(e=>this.setState({pdfFitRatio:e}))),this.userColor=new we(tt.client.getUserId()),this.pdfUrl=URL.createObjectURL(this.props.file),this.state={pdfPromise:vn.getDocument(this.pdfUrl).promise,pdfPage:1}}async componentDidMount(){const e=await this.state.pdfPromise;this.setState({totalPages:e.numPages})}componentWillUnmount(){URL.revokeObjectURL(this.pdfUrl)}render(e,t){const n={"--pdfFitRatio":t.pdfFitRatio,"--pdfWidthPx":`${t.pdfWidthPx}px`,"--pdfHeightPx":`${t.pdfHeightPx}px`,"--selectColor":this.userColor.solid};return h("div",{id:"pdf-upload-preview"},h("div",{id:"pdf-upload-preview-outer-wrapper",style:n},h("div",{id:"pdf-upload-preview-wrapper",style:n},h(wn,{pdfScale:1,setPdfDimensions:this.setPdfDimensions,setPdfFitRatio:this.setPdfFitRatio,hasFetched:!0,pdfPromise:t.pdfPromise,textLayer:this.textLayer,pageFocused:t.pdfPage,setPdfLoadingStatus:e=>{}}))),h("div",{id:"pdf-upload-preview-controls"},h("button",{onClick:this.prevPage,id:"document-preview-prev"},Et),h("button",{onClick:this.nextPage,id:"document-preview-next"},kt)))}}class Zr extends m{constructor(e){super(e),$r(this,"videoElement",{current:null}),$r(this,"generatePeaks",(e=>{confirm("Warning: this operation is memory intensive, and may not work well on mobile devices. Continue?")&&(this.wavesurfer.once("waveform-ready",(e=>{this.wavesurfer.exportPCM(6*this.wavesurfer.getDuration(),1e4,!0).then((e=>{this.pcm=e,setTimeout((e=>{this.wavesurfer.load(this.videoElement.current||this.mediaUrl,this.pcm)}))}))})),this.wavesurfer.load(this.videoElement.current||this.mediaUrl))})),$r(this,"playPause",(e=>{this.state.playing?(this.setState({playing:!1}),this.wavesurfer.pause()):(this.wavesurfer.seekAndCenter(this.wavesurfer.getCurrentTime()/this.wavesurfer.getDuration()),this.lastLeft=this.wavesurfer.drawer.wrapper.scrollLeft,this.wavesurfer.drawer.params.autoCenter=!0,this.wavesurfer.play(),this.setState({playing:!0}))})),this.state={playing:!1},this.mediaUrl=URL.createObjectURL(e.file),this.isVideo=e.file.type.match(/^video/)}componentDidMount(){const e=[],t=ve(fe(this.props.file.name));this.isVideo&&(this.videoElement.current.src=this.mediaUrl);for(let n=0;n<2048;n++)e.push(2*t()-1);this.wavesurfer=new(_n().create)({container:"#media-upload-preview-waveform",backend:"MediaElement",barWidth:5,scrollParent:!0}),this.wavesurfer.on("scroll",(e=>{Math.abs(this.lastLeft-e.target.scrollLeft)>25?this.wavesurfer.drawer.params.autoCenter=!1:this.lastLeft=e.target.scrollLeft})),this.wavesurfer.load(this.videoElement.current||this.mediaUrl,e)}componentWillUnmount(){this.wavesurfer&&this.wavesurfer.destroy(),URL.revokeObjectURL(this.mediaUrl)}render(e,t){return h("div",{id:"media-upload-preview"},this.isVideo?h("video",{ref:this.videoElement}):null,h("div",{id:"media-upload-preview-waveform"}),h("div",{id:"media-upload-preview-controls"},h(Tr,{content:t.playing?"Pause preview":"Play preview"},h("button",{onClick:this.playPause},t.playing?nn:tn)),h(Tr,{content:"Improve waveform"},h("button",{onClick:this.generatePeaks},sn))))}}class Jr extends m{constructor(e){super(e),this.imageUrl=URL.createObjectURL(this.props.file)}componentWillUnmount(){URL.revokeObjectURL(this.imageUrl)}render(){return h("div",{id:"image-upload-preview"},h("img",{src:this.imageUrl}))}}class Qr extends m{render(e){return h("div",{id:"generic-upload-preview"},h("span",null,vt),e.file.name," : ",e.file.size," bytes")}}const es=e=>{const t=e>>8&255,n=255&e;return[Dr(e>>16),Dr(t),Dr(n)]},ts=(e,t)=>{const n=Math.floor(e/361),i=Math.floor(e/19)%19,r=e%19;return[Fr((n-9)/9,2)*t,Fr((i-9)/9,2)*t,Fr((r-9)/9,2)*t]},ns=(e,t,n,i)=>{(e=>{if(!e||e.length<6)throw new Nr("The blurhash string must be at least 6 characters");const t=Or(e[0]),n=Math.floor(t/9)+1,i=t%9+1;if(e.length!==4+2*i*n)throw new Nr(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*i*n}`)})(e),i|=1;const r=Or(e[0]),s=Math.floor(r/9)+1,o=r%9+1,a=(Or(e[1])+1)/166,l=new Array(o*s);for(let t=0;t<l.length;t++)if(0===t){const n=Or(e.substring(2,6));l[t]=es(n)}else{const n=Or(e.substring(4+2*t,6+2*t));l[t]=ts(n,a*i)}const c=4*t,d=new Uint8ClampedArray(c*n);for(let e=0;e<n;e++)for(let i=0;i<t;i++){let r=0,a=0,h=0;for(let c=0;c<s;c++)for(let s=0;s<o;s++){const d=Math.cos(Math.PI*i*s/t)*Math.cos(Math.PI*e*c/n);let u=l[s+c*o];r+=u[0]*d,a+=u[1]*d,h+=u[2]*d}let u=Lr(r),p=Lr(a),m=Lr(h);d[4*i+0+e*c]=u,d[4*i+1+e*c]=p,d[4*i+2+e*c]=m,d[4*i+3+e*c]=255}return d};class is{static hasResource(e){const t=e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS),n=t.getStateEvents("m.room.create","")?.getContent()?.[ze],i=t.getStateEvents(Fe,"")?.getContent()?.mxc;return!(!n&&!i)}constructor(e){const t=e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS),n=t.getStateEvents(Fe,"")?.getContent()?.mxc,i=t.getStateEvents("m.room.create","")?.getContent()?.[ze];this.file=i?.["m.file"],this.room=e,this.pcm=t.getStateEvents(Ye,"")?.getContent()?.mxc,this.mimetype=i?.mimetype||this.file?.mimetype||"application/pdf",this.url=i?.url||this.file?.url||n,this.schema=this.url?.match(/^\w*/)[0],this.hasFetched=new Promise(((e,t)=>{this.resolveFetch=e,this.rejectFetch=t}))}get httpUrl(){return"mxc"===this.schema?tt.client.getHttpUriForMxcFromHS(this.url):"http"===this.schema||"https"===this.schema?this.url:null}}class rs{constructor(e){this.event=e,this.location=this.event.getContent()[We]||this.event.getContent()[$e]?.[We]}isValid(){return!!this.location&&!!this.getStatus()&&!!this.getCreator()}getUnread(){const e=tt.client.getRoom(this.getChild());return e?e.getUnreadNotificationCount():"All"}getVia(){return this.event.getContent().via}isQuestion(){return"questioning"===this.location?.motivation}getType(){return this.location?.[Ve]?"highlight":this.location?.[He]?"text":this.location?.[Ke]?"media-fragment":null}getOrientation(){return this.event.getType()===Ue?"parent":this.event.getType()===Be?"child":void 0}getParent(){return this.event.getType()===Ue?this.event.getStateKey():this.event.getType()===Be?this.event.getRoomId():"m.room.message"===this.event.getType()?this.event.getContent()[$e]?.[qe]:void 0}getChild(){return this.event.getType()===Ue?this.event.getRoomId():this.event.getType()===Be?this.event.getStateKey():"m.room.message"===this.event.getType()?this.event.getRoomId():void 0}getResourcePosition(){return this.location?.[Ve]||this.location?.[He]?this.getPageIndex():this.location?.[Ke]?Math.floor(this.getIntervalStart()/1e3):void 0}getResourceFragment(){if(this.location?.[Ke]){const e=this.location[Ke].start||this.location[Ke].start?`t=${this.getIntervalStart()/1e3},${this.getIntervalEnd()/1e3}`:"",t=this.location[Ke].x?`xywh=${this.location[Ke].x},${this.location[Ke].y},${this.location[Ke].w},${this.location[Ke].h}`:"";return e?t?`${e}&${t}`:e:t}}getText(){return this.location?.[Ve]?.text_content}getPageIndex(){return this.location?.[Ve]?.page_index||this.location?.[He]?.page_index}getRect(){return this.location?.[Ve]?.rect||this.location?.[He]?.rect}getQuadPoints(){return this.location?.[Ve]?.quad_points}getIntervalStart(){if(this.location[Ke])return this.location[Ke].start||0}getIntervalEnd(){if(this.location[Ke])return this.location[Ke].end||"end"}getMediaRect(){if(this.location[Ke]&&this.location[Ke].x&&this.location[Ke].y&&this.location[Ke].w&&this.location[Ke].h)return new DOMRect(this.location[Ke].x,this.location[Ke].y,this.location[Ke].w,this.location[Ke].h)}isPrivate(){return!!this.location?.[Ge]?.private}getRootContent(){return this.location?.[Ge]?.rootContent}getCreator(){return this.location?.[Ge]?.creator}getStatus(){return this.location?.[Ge]?.activityStatus}}var ss=__webpack_require__(3062),os={};function as(e){return h("span",{style:new we(e.member.userId).styleVariables,class:"member-pill"},e.member.name)}os.styleTagTransform=Me(),os.setAttributes=Ie(),os.insert=Ce().bind(null,"head"),os.domAPI=xe(),os.insertStyleElement=Pe(),Ee()(ss.Z,os),ss.Z&&ss.Z.locals&&ss.Z.locals;var ls=__webpack_require__(7724),cs={};function ds(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}cs.styleTagTransform=Me(),cs.setAttributes=Ie(),cs.insert=Ce().bind(null,"head"),cs.domAPI=xe(),cs.insertStyleElement=Pe(),Ee()(ls.Z,cs),ls.Z&&ls.Z.locals&&ls.Z.locals;class hs extends m{constructor(e){super(e),ds(this,"hideModal",(e=>{delete document.body.dataset.modalVisible,this.setState({content:null,title:null})})),ds(this,"setContent",((e,t,n)=>{document.body.dataset.modalVisible=!0,this.setState({content:e,title:t,subtitle:n})})),this.state={content:null},hs.set=this.setContent,hs.hide=this.hideModal,hs.isVisible=e=>null!==this.state.content,hs.getTitle=e=>this.state.title}render(e,t){return t.content?h("div",{id:"modal-popup"},h("div",{id:"modal-background",onclick:this.hideModal}),h("div",{role:"dialog","aria-modal":"true",id:"modal-content"},h("div",{id:"modal-header"},h("h3",{id:"modal-title"},t.title),h("button",{id:"dismiss-modal",onclick:this.hideModal},ot),t.subtitle?h("span",{id:"modal-subtitle"},t.subtitle):null),t.content)):null}}function us(e){return h("span",{style:new we(e.user.userId||e.user.user_id).styleVariables,class:"member-pill"},e.user.displayName||e.user.display_name)}var ps=__webpack_require__(592),ms={};function gs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ms.styleTagTransform=Me(),ms.setAttributes=Ie(),ms.insert=Ce().bind(null,"head"),ms.domAPI=xe(),ms.insertStyleElement=Pe(),Ee()(ps.Z,ms),ps.Z&&ps.Z.locals&&ps.Z.locals;class fs extends m{constructor(...e){super(...e),gs(this,"searchInput",this.props.searchInput||{current:null}),gs(this,"keydownHandler",(e=>{const t=this.props.searchPredicate||(e=>"/"===e.key&&!e.altKey&&!e.ctrlKey);t(e)&&(e.preventDefault(),this.searchInput.current.focus())})),gs(this,"handleClear",(e=>{e.preventDefault(),this.props.setSearch(""),this.searchInput.current.focus()})),gs(this,"handleInputBlur",(e=>{this.props.setFocus&&this.props.setFocus(!1),this.props.onBlur&&this.props.onBlur(e)})),gs(this,"handleInputFocus",(e=>{this.props.setFocus&&this.props.setFocus(!0),this.props.onFocus&&this.props.onFocus(e)})),gs(this,"handleInputKeydown",(e=>{e.altKey||e.ctrlKey||e.stopPropagation(),"Esc"!==e.key&&"Escape"!==e.key||this.searchInput.current.blur(),"Enter"===e.key&&this.props.submit&&this.props.submit(this.props.search)})),gs(this,"handleInput",(e=>this.props.setSearch(e.target.value)))}componentDidMount(){document.addEventListener("keydown",this.keydownHandler)}componentWillUnmount(){document.removeEventListener("keydown",this.keydownHandler)}render(e,t){return h("div",{title:e.title,class:"search-bar"},h("input",{ref:this.searchInput,value:e.search,onkeydown:this.handleInputKeydown,onInput:this.handleInput,onBlur:this.handleInputBlur,onFocus:this.handleInputFocus}),h("div",{class:"search-icon"},gt),h("div",{onmousedown:this.handleClear,title:e.search?"Clear current search":null,class:"right-decoration"},e.search?ot:e.hint?h("span",{class:"search-hint"},e.hint):null))}}var vs=__webpack_require__(5440),ys={};function bs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ys.styleTagTransform=Me(),ys.setAttributes=Ie(),ys.insert=Ce().bind(null,"head"),ys.domAPI=xe(),ys.insertStyleElement=Pe(),Ee()(vs.Z,ys),vs.Z&&vs.Z.locals&&vs.Z.locals;class ws extends m{constructor(e){super(e),bs(this,"inviteSelect",{current:null}),bs(this,"inviteSelectWrapper",{current:null}),bs(this,"resize",(e=>this.inviteSelectWrapper.current.style.height=`${this.inviteSelect.current.scrollHeight}px`)),bs(this,"updateMembership",(e=>{e.getRoomId()===this.props.room.roomId&&this.setState({joins:this.getSortedMembership("join"),invites:this.getSortedMembership("invite"),bans:this.getSortedMembership("ban"),leaves:this.getSortedMembership("leave"),knocks:this.getSortedMembership("knocks")})})),bs(this,"filterMembers",(e=>this.setState({search:e}))),bs(this,"joinMembers",(e=>this.setState({view:"JOINING"}))),bs(this,"kickMembers",(e=>this.setState({view:"KICKING"}))),bs(this,"banMembers",(e=>this.setState({view:"BANNING"}))),bs(this,"unbanMembers",(e=>this.setState({view:"UNBANNING"}))),bs(this,"getSortedMembership",(e=>this.props.room.getMembersWithMembership(e).sort(((e,t)=>e.name.toUpperCase()>t.name.toUpperCase()?1:-1)))),bs(this,"isInvitable",(e=>!this.state.joins.some((t=>t.userId===e))&&!this.state.invites.some((t=>t.userId===e))&&!this.state.bans.some((t=>t.userId===e)))),bs(this,"isKnocking",(e=>this.state.knocks.some((t=>t.userId==e)))),bs(this,"getRemovalListing",(e=>this.state.joins.filter((e=>e.name.toUpperCase().includes(this.state.search.toUpperCase()))))),bs(this,"getDisinviteListing",(e=>this.state.invites.filter((e=>e.name.toUpperCase().includes(this.state.search.toUpperCase()))))),bs(this,"getBanListing",(e=>this.state.joins.filter((e=>e.name.toUpperCase().includes(this.state.search.toUpperCase()))))),bs(this,"getInviteListing",(e=>tt.client.getUsers().filter((e=>this.isInvitable(e.userId))).filter((e=>!this.isKnocking(e.userId))).filter((e=>e.displayName.toUpperCase().includes(this.state.search.toUpperCase()))).sort(((e,t)=>e.displayName.toUpperCase()>t.displayName.toUpperCase()?1:-1)))),bs(this,"getKnockResponseListing",(e=>this.state.knocks.filter((e=>e.name.toUpperCase().includes(this.state.search.toUpperCase()))))),this.state={view:"JOINING",joins:this.getSortedMembership("join"),invites:this.getSortedMembership("invite"),bans:this.getSortedMembership("ban"),knocks:this.getSortedMembership("knock"),search:""}}componentDidMount(){tt.client.on("RoomMember.membership",this.updateMembership),this.resize()}componentWillUnmount(){tt.client.off("RoomMember.membership",this.updateMembership)}componentDidUpdate(){this.resize()}render(e,t){const n=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS),i=e.room.getMember(tt.client.getUserId()),r=n.hasSufficientPowerLevelFor("invite",i.powerLevel),s=n.hasSufficientPowerLevelFor("kick",i.powerLevel),o=n.hasSufficientPowerLevelFor("ban",i.powerLevel),a=n.hasSufficientPowerLevelFor("unban",i.powerLevel),l=this.getInviteListing();return h(p,null,h(fs,{search:t.search,setSearch:this.filterMembers}),h("div",{id:"invite-select-view",class:"select-view"},h("button",{disabled:!r,onClick:this.joinMembers,"data-current-button":"JOINING"===t.view},"Invite"),h("button",{disabled:!s,onClick:this.kickMembers,"data-current-button":"KICKING"===t.view},"Remove"),h("button",{disabled:!o,onClick:this.banMembers,"data-current-button":"BANNING"===t.view},"Ban"),h("button",{disabled:!a,onClick:this.unbanMembers,"data-current-button":"UNBANNING"===t.view},"Unban")),h("div",{ref:this.inviteSelectWrapper,id:"invite-select-wrapper"},"JOINING"===t.view?h("div",{ref:this.inviteSelect,id:"invite-join-members"},h("div",null,this.getKnockResponseListing().map((t=>h(_s,{member:t,room:e.room,key:t.userId}))),l.map((t=>h(Ss,{user:t,room:e.room,key:t.userId})))),h(Cs,{resize:this.resize,search:t.search,isInvitable:this.isInvitable,inviteListing:l,room:e.room})):"KICKING"===t.view?h("div",{ref:this.inviteSelect,id:"invite-kick-members"},this.getRemovalListing().map((t=>h(ks,{member:t,userMember:i,room:e.room,key:t.userId}))),this.getDisinviteListing().map((t=>h(Es,{member:t,userMember:i,room:e.room,key:t.userId})))):"BANNING"===t.view?h("div",{ref:this.inviteSelect,id:"invite-ban-members"},this.getBanListing().map((t=>h(xs,{member:t,userMember:i,room:e.room,key:t.userId})))):"UNBANNING"===t.view?h("div",{ref:this.inviteSelect,id:"invite-unban-members"},this.state.bans.map((t=>h(Ts,{member:t,room:e.room,key:t.userId})))):null))}}class Ss extends m{constructor(...e){super(...e),bs(this,"invite",(e=>tt.client.invite(this.props.room.roomId,this.props.user.userId||this.props.user.user_id).catch(alert)))}render(e){return h("button",{class:"invite-candidate",onclick:this.invite},h("span",{class:"small-icon"},lt),h("span",null,h(us,{user:e.user})))}}class _s extends m{constructor(...e){super(...e),bs(this,"invite",(e=>tt.client.invite(this.props.room.roomId,this.props.member.userId).catch(alert)))}render(e){return h("button",{class:"invite-candidate",onclick:this.invite},h("span",{class:"small-icon"},lt),h("span",null,h(as,{user:e.member})),h("span",{class:"invite-candidate-knocked"},"has requested an invitation"))}}class Es extends m{constructor(...e){super(...e),bs(this,"kick",(e=>tt.client.kick(this.props.room.roomId,this.props.member.userId).catch(alert)))}render(e){return e.userMember.powerLevel<=e.member.powerLevel?null:h("button",{class:"disinvite-candidate",onclick:this.kick},h("span",{class:"small-icon"},at),h("span",null,h(as,{member:e.member})))}}class ks extends m{constructor(...e){super(...e),bs(this,"kick",(e=>tt.client.kick(this.props.room.roomId,this.props.member.userId).catch(alert)))}render(e){return e.userMember.powerLevel<=e.member.powerLevel?null:h("button",{class:"removal-candidate",onclick:this.kick},h("span",{class:"small-icon"},at),h("span",null,h(as,{member:e.member})))}}class xs extends m{constructor(...e){super(...e),bs(this,"ban",(e=>tt.client.ban(this.props.room.roomId,this.props.member.userId).catch(alert)))}render(e){return e.userMember.powerLevel<=e.member.powerLevel?null:h("button",{class:"ban-candidate",onclick:this.ban},h("span",{class:"small-icon"},ct),h("span",null,h(as,{member:e.member})))}}class Ts extends m{constructor(...e){super(...e),bs(this,"unban",(e=>tt.client.unban(this.props.room.roomId,this.props.member.userId).catch(alert)))}render(e){return h("button",{class:"unban-candidate",onclick:this.unban},h("span",{class:"small-icon"},dt),h("span",null,h(as,{member:e.member})))}}class Cs extends m{constructor(e){super(e),bs(this,"serverSearch",(async e=>{this.setState({pending:!0});const{results:t}=await tt.client.searchUserDirectory({term:this.props.search});this.setState({results:t,fired:!0,pending:!1},this.props.resize)})),this.state={results:[],pending:!1,fired:!1}}render(e,t){const n={visibility:e.search?"visible":"hidden"},i=t.results.filter((t=>!e.inviteListing.map((e=>e.userId)).includes(t.user_id))).filter((t=>e.isInvitable(t.user_id))).filter((t=>t.display_name?t.display_name.toUpperCase().includes(e.search.toUpperCase()):t.user_id.toUpperCase().includes(e.search.toUpperCase())));return h(p,null,t.fired&&i.length>0?h("hr",{id:"invite-search-divider"}):null,i.map((t=>h(Ss,{key:t.user_id,user:t,room:e.room}))),h("div",null,h("button",{style:n,id:"invite-search-directory",class:"styled-button",disabled:t.pending,onclick:this.serverSearch},t.fired?"Search again?":"Search for more people?")))}}function As(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Is extends m{constructor(...e){super(...e),As(this,"leaveRoom",(async e=>{await tt.client.leave(this.props.room.roomId),hs.hide()})),As(this,"forgetRoom",(async e=>{await tt.client.leave(this.props.room.roomId),await tt.client.forget(this.props.room.roomId),hs.hide()}))}render(e){return h(p,null,h("p",null,"To stop receiving updates about this room, and remove it from your room listing:"),h("button",{onClick:this.leaveRoom,class:"styled-button"},"Leave This Room"),h("p",null,"To also removed all stored room history, and no longer see the room as an option to join or add to collections:"),h("button",{onClick:this.forgetRoom,class:"styled-button"},"Forget This Room"))}}var Rs=__webpack_require__(8477),Ps={};function Os(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ps.styleTagTransform=Me(),Ps.setAttributes=Ie(),Ps.insert=Ce().bind(null,"head"),Ps.domAPI=xe(),Ps.insertStyleElement=Pe(),Ee()(Rs.Z,Ps),Rs.Z&&Rs.Z.locals&&Rs.Z.locals;class Ms extends m{constructor(e){super(e),Os(this,"newTagInput",{current:null}),Os(this,"handleBlur",(e=>this.setState({newTag:""}))),Os(this,"handleKeyup",(e=>{"Enter"===e.key?(tt.client.setRoomTag(this.props.room.roomId,`u.${this.newTagInput.current.value}`,{order:.5}),this.setState({newTag:""})):this.setState({newTag:this.newTagInput.current.value})})),Os(this,"handleClick",(e=>t=>{tt.client.deleteRoomTag(this.props.room.roomId,e)})),this.state={newTag:"",tags:Object.keys(e.room.tags)},this.accountListener=this.accountListener.bind(this)}componentDidMount(){tt.client.on("Room.accountData",this.accountListener)}componentWillUnmount(){tt.client.off("Room.accountData",this.accountListener)}accountListener(){this.setState({tags:Object.keys(this.props.room.tags)})}render(e,t){const n=t.tags.filter((e=>"u."===e.slice(0,2))).map((t=>h(p,{key:`${e.room.roomId}"-tag-"${t}`},h("span",{onclick:this.handleClick(t),class:"room-tag-delete-icon"},jt),h(Ds,{room:e.room,tag:t}))));return h(p,null,h("div",{class:"tag-editor"},h(p,null,n),h("input",{ref:this.newTagInput,class:"styled-input tag-input",value:t.newTag,onkeyup:this.handleKeyup,onblur:this.handleBlur,placeholder:"new tag"})))}}function Ds(e){return h("span",{class:"room-tag"},e.tag.slice(2))}function Ls(e){const t=Object.keys(e.room.tags).filter((e=>"u."===e.slice(0,2))).map((t=>h(Ds,{key:`${e.room.roomId}"-tag-"${e.tag}`,room:e.room,tag:t})));return h(p,null,t)}function Fs(e){if("string"!=typeof e||!e)throw new Error("expected a non-empty string, got: "+e)}function Ns(e){if("number"!=typeof e)throw new Error("expected a number, got: "+e)}const js="emoji",Bs="keyvalue",Us="favorites",qs="tokens",zs="count",Vs="group-order",Ks="eTag",Hs="url",Ws="skinTone",$s="readonly",Gs="readwrite",Ys="skinUnicodes";function Xs(e){return function(e,t){const n=new Set,i=[];for(const r of e){const e=t(r);n.has(e)||(n.add(e),i.push(r))}return i}(e,(e=>e.unicode))}const Zs={},Js={},Qs={};function eo(e,t,n){n.onerror=()=>t(n.error),n.onblocked=()=>t(new Error("IDB blocked")),n.onsuccess=()=>e(n.result)}function to(e,t,n,i){return new Promise(((r,s)=>{const o=e.transaction(t,n,{durability:"relaxed"}),a="string"==typeof t?o.objectStore(t):t.map((e=>o.objectStore(e)));let l;i(a,o,(e=>{l=e})),o.oncomplete=()=>r(l),o.onerror=()=>s(o.error)}))}function no(e){const t=Zs[e],n=t&&t.result;if(n){n.close();const t=Qs[e];if(t)for(const e of t)e()}delete Zs[e],delete Js[e],delete Qs[e]}const io=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function ro(e){return e.split(/[\s_]+/).map((e=>!e.match(/\w/)||io.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(//g,"'").toLowerCase())).filter(Boolean)}function so(e){return e.filter(Boolean).map((e=>e.toLowerCase())).filter((e=>e.length>=2))}function oo(e,t,n,i){e[t](n).onsuccess=e=>i&&i(e.target.result)}function ao(e,t,n){oo(e,"get",t,n)}function lo(e,t,n){oo(e,"getAll",t,n)}function co(e){e.commit&&e.commit()}function ho(e,t){const n=function(e,t){let n=e[0];for(let i=1;i<e.length;i++){const r=e[i];t(n)>t(r)&&(n=r)}return n}(e,(e=>e.length)),i=[];for(const r of n)e.some((e=>-1===e.findIndex((e=>t(e)===t(r)))))||i.push(r);return i}async function uo(e,t,n,i){try{const r=function(e){const t=e.map((({annotation:e,emoticon:t,group:n,order:i,shortcodes:r,skins:s,tags:o,emoji:a,version:l})=>{const c=[...new Set(so([...(r||[]).map(ro).flat(),...o.map(ro).flat(),...ro(e),t]))].sort(),d={annotation:e,group:n,order:i,tags:o,tokens:c,unicode:a,version:l};if(t&&(d.emoticon=t),r&&(d.shortcodes=r),s){d.skinTones=[],d.skinUnicodes=[],d.skinVersions=[];for(const{tone:e,emoji:t,version:n}of s)d.skinTones.push(e),d.skinUnicodes.push(t),d.skinVersions.push(n)}return d}));return t}(t);await to(e,[js,Bs],Gs,(([e,t],s)=>{let o,a,l=0;function c(){2==++l&&function(){if(o!==i||a!==n){e.clear();for(const t of r)e.put(t);t.put(i,Ks),t.put(n,Hs),co(s)}}()}ao(t,Ks,(e=>{o=e,c()})),ao(t,Hs,(e=>{a=e,c()}))}))}finally{}}async function po(e,t){const n=so(ro(t));return n.length?to(e,js,$s,((e,t,i)=>{const r=[],s=()=>{const e=ho(r,(e=>e.unicode));i(e.sort(((e,t)=>e.order<t.order?-1:1)))};for(let t=0;t<n.length;t++){const i=n[t],o=t===n.length-1?IDBKeyRange.bound(i,i+"",!1,!0):IDBKeyRange.only(i);lo(e.index(qs),o,(e=>{r.push(e),r.length===n.length&&s()}))}})):[]}function mo(e,t,n){return to(e,t,$s,((e,t,i)=>ao(e,n,i)))}const go=["name","url"];function fo(e){!function(e){const t=e&&Array.isArray(e),n=t&&e.length&&(!e[0]||go.some((t=>!(t in e[0]))));if(!t||n)throw new Error("Custom emojis are in the wrong format")}(e);const t=(e,t)=>e.name.toLowerCase()<t.name.toLowerCase()?-1:1,n=e.sort(t),i=function(e,t){const n=new Map;for(const t of e){const e=[...new Set((t.shortcodes||[]).map((e=>ro(e))).flat())];for(const i of e){let e=n;for(let t=0;t<i.length;t++){const n=i.charAt(t);let r=e.get(n);r||(r=new Map,e.set(n,r)),e=r}let r=e.get("");r||(r=[],e.set("",r)),r.push(t)}}return(e,t)=>{let i=n;for(let t=0;t<e.length;t++){const n=e.charAt(t),r=i.get(n);if(!r)return[];i=r}if(t)return i.get("")||[];const r=[],s=[i];for(;s.length;){const e=[...s.shift().entries()].sort(((e,t)=>e[0]<t[0]?-1:1));for(const[t,n]of e)""===t?r.push(...n):s.push(n)}return r}}(e),r=e=>i(e,!0),s=e=>i(e,!1),o=new Map,a=new Map;for(const t of e){a.set(t.name.toLowerCase(),t);for(const e of t.shortcodes||[])o.set(e.toLowerCase(),t)}return{all:n,search:e=>{const n=ro(e);return ho(n.map(((e,t)=>(t<n.length-1?r:s)(e))),(e=>e.name)).sort(t)},byShortcode:e=>o.get(e.toLowerCase()),byName:e=>a.get(e.toLowerCase())}}function vo(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let n=0;n<t;n++)e.skins[n]={tone:e.skinTones[n],unicode:e.skinUnicodes[n],version:e.skinVersions[n]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function yo(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const bo=["annotation","emoji","group","order","tags","version"];function wo(e,t){if(2!==Math.floor(e.status/100))throw new Error("Failed to fetch: "+t+":  "+e.status)}async function So(e){const t=await fetch(e);wo(t,e);const n=t.headers.get("etag");yo(n);const i=await t.json();return function(e){if(!e||!Array.isArray(e)||!e[0]||"object"!=typeof e[0]||bo.some((t=>!(t in e[0]))))throw new Error("Emoji data is in the wrong format")}(i),[n,i]}async function _o(e){const t=function(e){for(var t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n),r=-1;++r<t;)i[r]=e.charCodeAt(r);return n}(JSON.stringify(e)),n=function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,r=-1;++r<i;)t+=String.fromCharCode(n[r]);return t}(await crypto.subtle.digest("SHA-1",t));return btoa(n)}class Eo{constructor({dataSource:e="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",locale:t="en",customEmoji:n=[]}={}){this.dataSource=e,this.locale=t,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=fo(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await(t=this._dbName,Js[t]||(Js[t]=async function(e){const t=await new Promise(((t,n)=>{const i=indexedDB.open(e,1);Zs[e]=i,i.onupgradeneeded=e=>{e.oldVersion<1&&function(e){function t(t,n,i){const r=n?e.createObjectStore(t,{keyPath:n}):e.createObjectStore(t);if(i)for(const[e,[t,n]]of Object.entries(i))r.createIndex(e,t,{multiEntry:n});return r}t(Bs),t(js,"unicode",{[qs]:["tokens",!0],[Vs]:[["group","order"]],[Ys]:["skinUnicodes",!0]}),t(Us,void 0,{[zs]:[""]})}(i.result)},eo(t,n,i)}));return t.onclose=()=>no(e),t}(t)),Js[t]);var t;!function(e,t){let n=Qs[e];n||(n=Qs[e]=[]),n.push(t)}(this._dbName,this._clear);const n=this.dataSource,i=await async function(e){return!await mo(e,Bs,Hs)}(e);i?await async function(e,t){let[n,i]=await So(t);n||(n=await _o(i)),await uo(e,i,t,n)}(e,n):this._lazyUpdate=async function(e,t){let n,i=await async function(e){const t=await fetch(e,{method:"HEAD"});wo(t,e);const n=t.headers.get("etag");return yo(n),n}(t);if(!i){const e=await So(t);i=e[0],n=e[1],i||(i=await _o(n))}await async function(e,t,n){const[i,r]=await Promise.all([Ks,Hs].map((t=>mo(e,Bs,t))));return i===n&&r===t}(e,t,i)||(n||(n=(await So(t))[1]),await uo(e,n,t,i))}(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Ns(e),await this.ready(),Xs(await async function(e,t){return to(e,js,$s,((e,n,i)=>{const r=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);lo(e.index(Vs),r,i)}))}(this._db,e)).map(vo)}async getEmojiBySearchQuery(e){return Fs(e),await this.ready(),[...this._custom.search(e),...Xs(await po(this._db,e)).map(vo)]}async getEmojiByShortcode(e){Fs(e),await this.ready();return this._custom.byShortcode(e)||vo(await async function(e,t){const n=await po(e,t);if(!n.length){const n=e=>(e.shortcodes||[]).includes(t.toLowerCase());return await async function(e,t){return to(e,js,$s,((e,n,i)=>{let r;const s=()=>{e.getAll(r&&IDBKeyRange.lowerBound(r,!0),50).onsuccess=e=>{const n=e.target.result;for(const e of n)if(r=e.unicode,t(e))return i(e);if(n.length<50)return i();s()}};s()}))}(e,n)||null}return n.filter((e=>{const n=(e.shortcodes||[]).map((e=>e.toLowerCase()));return n.includes(t.toLowerCase())}))[0]||null}(this._db,e))}async getEmojiByUnicodeOrName(e){Fs(e),await this.ready();return this._custom.byName(e)||vo(await async function(e,t){return to(e,js,$s,((e,n,i)=>ao(e,t,(n=>{if(n)return i(n);ao(e.index(Ys),t,(e=>i(e||null)))}))))}(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await mo(this._db,Bs,Ws)||0}async setPreferredSkinTone(e){return Ns(e),await this.ready(),t=this._db,Ws,n=e,to(t,Bs,Gs,((e,t)=>{e.put(n,"skinTone"),co(t)}));var t,n}async incrementFavoriteEmojiCount(e){return Fs(e),await this.ready(),t=this._db,n=e,to(t,Us,Gs,((e,t)=>ao(e,n,(i=>{e.put((i||0)+1,n),co(t)}))));var t,n}async getTopFavoriteEmoji(e){return Ns(e),await this.ready(),(await function(e,t,n){return 0===n?[]:to(e,[Us,js],$s,(([e,i],r,s)=>{const o=[];e.index(zs).openCursor(void 0,"prev").onsuccess=e=>{const r=e.target.result;if(!r)return s(o);function a(e){if(o.push(e),o.length===n)return s(o);r.continue()}const l=r.primaryKey,c=t.byName(l);if(c)return a(c);ao(i,l,(e=>{if(e)return a(e);r.continue()}))}}))}(this._db,this._custom,e)).map(vo)}set customEmoji(e){this._custom=fo(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch(e){}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await no(this._dbName)}async delete(){var e;await this._shutdown(),await(e=this._dbName,new Promise(((t,n)=>{no(e),eo(t,n,indexedDB.deleteDatabase(e))})))}}function ko(){}function xo(e){return e()}function To(){return Object.create(null)}function Co(e){e.forEach(xo)}function Ao(e){return"function"==typeof e}function Io(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let Ro,Po;function Oo(e,t){return Ro||(Ro=document.createElement("a")),Ro.href=t,e===Ro.href}function Mo(e,t){e.appendChild(t)}function Do(e,t,n){e.insertBefore(t,n||null)}function Lo(e){e.parentNode.removeChild(e)}function Fo(e){return document.createElement(e)}function No(e){return document.createTextNode(e)}function jo(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function Bo(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Uo(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function qo(e,t){e.value=null==t?"":t}function zo(e,t,n,i){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function Vo(e){Po=e}const Ko=[],Ho=[],Wo=[],$o=[],Go=Promise.resolve();let Yo=!1;function Xo(){Yo||(Yo=!0,Go.then(ea))}function Zo(e){Wo.push(e)}const Jo=new Set;let Qo=0;function ea(){const e=Po;do{for(;Qo<Ko.length;){const e=Ko[Qo];Qo++,Vo(e),ta(e.$$)}for(Vo(null),Ko.length=0,Qo=0;Ho.length;)Ho.pop()();for(let e=0;e<Wo.length;e+=1){const t=Wo[e];Jo.has(t)||(Jo.add(t),t())}Wo.length=0}while(Ko.length);for(;$o.length;)$o.pop()();Yo=!1,Jo.clear(),Vo(e)}function ta(e){if(null!==e.fragment){e.update(),Co(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Zo)}}const na=new Set,ia="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ra(e,t){e.d(1),t.delete(e.key)}function sa(e,t,n,i,r,s,o,a,l,c,d,h){let u=e.length,p=s.length,m=u;const g={};for(;m--;)g[e[m].key]=m;const f=[],v=new Map,y=new Map;for(m=p;m--;){const e=h(r,s,m),a=n(e);let l=o.get(a);l?i&&l.p(e,t):(l=c(a,e),l.c()),v.set(a,f[m]=l),a in g&&y.set(a,Math.abs(m-g[a]))}const b=new Set,w=new Set;function S(e){!function(e,t){e&&e.i&&(na.delete(e),e.i(1))}(e),e.m(a,d),o.set(e.key,e),d=e.first,p--}for(;u&&p;){const t=f[p-1],n=e[u-1],i=t.key,r=n.key;t===n?(d=t.first,u--,p--):v.has(r)?!o.has(i)||b.has(i)?S(t):w.has(r)?u--:y.get(i)>y.get(r)?(w.add(i),S(t)):(b.add(r),u--):(l(n,o),u--)}for(;u--;){const t=e[u];v.has(t.key)||l(t,o)}for(;p;)S(f[p-1]);return f}const oa=[[-1,"","custom"],[0,"","smileys-emotion"],[1,"","people-body"],[3,"","animals-nature"],[4,"","food-drink"],[5,"","travel-places"],[6,"","activities"],[7,"","objects"],[8,"","symbols"],[9,"","flags"]].map((([e,t,n])=>({id:e,emoji:t,name:n}))),aa=oa.slice(1),la=oa[0],ca="function"==typeof requestIdleCallback?requestIdleCallback:setTimeout;function da(e){return e.unicode.includes("")}const ha={"":14,"":13.1,"":12.1,"":11,"":5,"":4,"":3,"":2,"":1,"":.7,"":.6},ua=["","","","","","","","","","","","","",""],pa='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',ma=(e,t)=>e<t?-1:e>t?1:0,ga=(e,t)=>{const n=document.createElement("canvas");n.width=n.height=1;const i=n.getContext("2d");return i.textBaseline="top",i.font=`100px ${pa}`,i.fillStyle=t,i.scale(.01,.01),i.fillText(e,0,0),i.getImageData(0,0,1,1).data};function fa(e){const t=ga(e,"#000"),n=ga(e,"#fff");return t&&n&&((e,t)=>{const n=[...e].join(",");return n===[...t].join(",")&&!n.startsWith("0,0,0,")})(t,n)}const va=new Promise((e=>ca((()=>e(function(){const e=Object.entries(ha);try{for(const[t,n]of e)if(fa(t))return n}catch(e){}return e[0][1]}()))))),ya=new Map;function ba(e){e.preventDefault(),e.stopPropagation()}function wa(e,t,n){return(t+=e?-1:1)<0?t=n.length-1:t>=n.length&&(t=0),t}function Sa(e,t){const n=new Set,i=[];for(const r of e){const e=t(r);n.has(e)||(n.add(e),i.push(r))}return i}const _a=requestAnimationFrame;let Ea,ka="function"==typeof ResizeObserver;function xa(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}const{Map:Ta}=ia;function Ca(e,t,n){const i=e.slice();return i[63]=t[n],i[65]=n,i}function Aa(e,t,n){const i=e.slice();return i[66]=t[n],i[65]=n,i}function Ia(e,t,n){const i=e.slice();return i[63]=t[n],i[65]=n,i}function Ra(e,t,n){const i=e.slice();return i[69]=t[n],i}function Pa(e,t,n){const i=e.slice();return i[72]=t[n],i[65]=n,i}function Oa(e,t){let n,i,r,s,o,a,l,c=t[72]+"";return{key:e,first:null,c(){n=Fo("div"),i=No(c),Bo(n,"id",r="skintone-"+t[65]),Bo(n,"class",s="emoji hide-focus "+(t[65]===t[20]?"active":"")),Bo(n,"aria-selected",o=t[65]===t[20]),Bo(n,"role","option"),Bo(n,"title",a=t[0].skinTones[t[65]]),Bo(n,"tabindex","-1"),Bo(n,"aria-label",l=t[0].skinTones[t[65]]),this.first=n},m(e,t){Do(e,n,t),Mo(n,i)},p(e,d){t=e,512&d[0]&&c!==(c=t[72]+"")&&Uo(i,c),512&d[0]&&r!==(r="skintone-"+t[65])&&Bo(n,"id",r),1049088&d[0]&&s!==(s="emoji hide-focus "+(t[65]===t[20]?"active":""))&&Bo(n,"class",s),1049088&d[0]&&o!==(o=t[65]===t[20])&&Bo(n,"aria-selected",o),513&d[0]&&a!==(a=t[0].skinTones[t[65]])&&Bo(n,"title",a),513&d[0]&&l!==(l=t[0].skinTones[t[65]])&&Bo(n,"aria-label",l)},d(e){e&&Lo(n)}}}function Ma(e,t){let n,i,r,s,o,a,l,c,d,h=t[69].emoji+"";function u(){return t[49](t[69])}return{key:e,first:null,c(){n=Fo("button"),i=Fo("div"),r=No(h),Bo(i,"class","nav-emoji emoji"),Bo(n,"role","tab"),Bo(n,"class","nav-button"),Bo(n,"aria-controls",s="tab-"+t[69].id),Bo(n,"aria-label",o=t[0].categories[t[69].name]),Bo(n,"aria-selected",a=!t[4]&&t[13].id===t[69].id),Bo(n,"title",l=t[0].categories[t[69].name]),this.first=n},m(e,t){Do(e,n,t),Mo(n,i),Mo(i,r),c||(d=jo(n,"click",u),c=!0)},p(e,i){t=e,4096&i[0]&&h!==(h=t[69].emoji+"")&&Uo(r,h),4096&i[0]&&s!==(s="tab-"+t[69].id)&&Bo(n,"aria-controls",s),4097&i[0]&&o!==(o=t[0].categories[t[69].name])&&Bo(n,"aria-label",o),12304&i[0]&&a!==(a=!t[4]&&t[13].id===t[69].id)&&Bo(n,"aria-selected",a),4097&i[0]&&l!==(l=t[0].categories[t[69].name])&&Bo(n,"title",l)},d(e){e&&Lo(n),c=!1,d()}}}function Da(e){let t,n;return{c(){t=Fo("img"),Bo(t,"class","custom-emoji"),Oo(t.src,n=e[63].url)||Bo(t,"src",n),Bo(t,"alt",""),Bo(t,"loading","lazy")},m(e,n){Do(e,t,n)},p(e,i){32768&i[0]&&!Oo(t.src,n=e[63].url)&&Bo(t,"src",n)},d(e){e&&Lo(t)}}}function La(e){let t,n=e[27](e[63],e[8])+"";return{c(){t=No(n)},m(e,n){Do(e,t,n)},p(e,i){33024&i[0]&&n!==(n=e[27](e[63],e[8])+"")&&Uo(t,n)},d(e){e&&Lo(t)}}}function Fa(e,t){let n,i,r,s,o,a,l;function c(e,t){return e[63].unicode?La:Da}let d=c(t),h=d(t);return{key:e,first:null,c(){n=Fo("button"),h.c(),Bo(n,"role",i=t[4]?"option":"menuitem"),Bo(n,"aria-selected",r=t[4]?t[65]==t[5]:""),Bo(n,"aria-label",s=t[28](t[63],t[8])),Bo(n,"title",o=t[63].title),Bo(n,"class",a="emoji "+(t[4]&&t[65]===t[5]?"active":"")),Bo(n,"id",l="emo-"+t[63].id),this.first=n},m(e,t){Do(e,n,t),h.m(n,null)},p(e,u){d===(d=c(t=e))&&h?h.p(t,u):(h.d(1),h=d(t),h&&(h.c(),h.m(n,null))),16&u[0]&&i!==(i=t[4]?"option":"menuitem")&&Bo(n,"role",i),32816&u[0]&&r!==(r=t[4]?t[65]==t[5]:"")&&Bo(n,"aria-selected",r),33024&u[0]&&s!==(s=t[28](t[63],t[8]))&&Bo(n,"aria-label",s),32768&u[0]&&o!==(o=t[63].title)&&Bo(n,"title",o),32816&u[0]&&a!==(a="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&Bo(n,"class",a),32768&u[0]&&l!==(l="emo-"+t[63].id)&&Bo(n,"id",l)},d(e){e&&Lo(n),h.d()}}}function Na(e,t){let n,i,r,s,o,a,l,c,d=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",h=[],u=new Ta,p=t[66].emojis;const m=e=>e[63].id;for(let e=0;e<p.length;e+=1){let n=Ia(t,p,e),i=m(n);u.set(i,h[e]=Fa(i,n))}return{key:e,first:null,c(){n=Fo("div"),i=No(d),o=Fo("div");for(let e=0;e<h.length;e+=1)h[e].c();Bo(n,"id",r="menu-label-"+t[65]),Bo(n,"class",s="category "+(1===t[15].length&&""===t[15][0].category?"gone":"")),Bo(n,"aria-hidden","true"),Bo(o,"class","emoji-menu"),Bo(o,"role",a=t[4]?"listbox":"menu"),Bo(o,"aria-labelledby",l="menu-label-"+t[65]),Bo(o,"id",c=t[4]?"search-results":""),this.first=n},m(e,t){Do(e,n,t),Mo(n,i),Do(e,o,t);for(let e=0;e<h.length;e+=1)h[e].m(o,null)},p(e,g){t=e,40977&g[0]&&d!==(d=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&Uo(i,d),32768&g[0]&&r!==(r="menu-label-"+t[65])&&Bo(n,"id",r),32768&g[0]&&s!==(s="category "+(1===t[15].length&&""===t[15][0].category?"gone":""))&&Bo(n,"class",s),402686256&g[0]&&(p=t[66].emojis,h=sa(h,g,m,1,t,p,u,o,ra,Fa,null,Ia)),16&g[0]&&a!==(a=t[4]?"listbox":"menu")&&Bo(o,"role",a),32768&g[0]&&l!==(l="menu-label-"+t[65])&&Bo(o,"aria-labelledby",l),16&g[0]&&c!==(c=t[4]?"search-results":"")&&Bo(o,"id",c)},d(e){e&&Lo(n),e&&Lo(o);for(let e=0;e<h.length;e+=1)h[e].d()}}}function ja(e){let t,n;return{c(){t=Fo("img"),Bo(t,"class","custom-emoji"),Oo(t.src,n=e[63].url)||Bo(t,"src",n),Bo(t,"alt",""),Bo(t,"loading","lazy")},m(e,n){Do(e,t,n)},p(e,i){1024&i[0]&&!Oo(t.src,n=e[63].url)&&Bo(t,"src",n)},d(e){e&&Lo(t)}}}function Ba(e){let t,n=e[27](e[63],e[8])+"";return{c(){t=No(n)},m(e,n){Do(e,t,n)},p(e,i){1280&i[0]&&n!==(n=e[27](e[63],e[8])+"")&&Uo(t,n)},d(e){e&&Lo(t)}}}function Ua(e,t){let n,i,r,s;function o(e,t){return e[63].unicode?Ba:ja}let a=o(t),l=a(t);return{key:e,first:null,c(){n=Fo("button"),l.c(),Bo(n,"role","menuitem"),Bo(n,"aria-label",i=t[28](t[63],t[8])),Bo(n,"title",r=t[63].title),Bo(n,"class","emoji"),Bo(n,"id",s="fav-"+t[63].id),this.first=n},m(e,t){Do(e,n,t),l.m(n,null)},p(e,c){a===(a=o(t=e))&&l?l.p(t,c):(l.d(1),l=a(t),l&&(l.c(),l.m(n,null))),1280&c[0]&&i!==(i=t[28](t[63],t[8]))&&Bo(n,"aria-label",i),1024&c[0]&&r!==(r=t[63].title)&&Bo(n,"title",r),1024&c[0]&&s!==(s="fav-"+t[63].id)&&Bo(n,"id",s)},d(e){e&&Lo(n),l.d()}}}function qa(e){let t,n,i,r,s,o,a,l,c,d,h,u,p,m,g,f,v,y,b,w,S,_,E,k,x,T,C,A,I,R,P,O,M,D,L,F,N,j,B,U,q,z,V,K,H=e[0].searchLabel+"",W=e[0].searchDescription+"",$=e[0].skinToneDescription+"",G=[],Y=new Ta,X=[],Z=new Ta,J=[],Q=new Ta,ee=[],te=new Ta,ne=e[9];const ie=e=>e[72];for(let t=0;t<ne.length;t+=1){let n=Pa(e,ne,t),i=ie(n);Y.set(i,G[t]=Oa(i,n))}let re=e[12];const se=e=>e[69].id;for(let t=0;t<re.length;t+=1){let n=Ra(e,re,t),i=se(n);Z.set(i,X[t]=Ma(i,n))}let oe=e[15];const ae=e=>e[66].category;for(let t=0;t<oe.length;t+=1){let n=Aa(e,oe,t),i=ae(n);Q.set(i,J[t]=Na(i,n))}let le=e[10];const ce=e=>e[63].id;for(let t=0;t<le.length;t+=1){let n=Ca(e,le,t),i=ce(n);te.set(i,ee[t]=Ua(i,n))}return{c(){t=Fo("section"),n=Fo("div"),i=Fo("div"),r=Fo("div"),s=Fo("input"),c=Fo("label"),d=No(H),h=Fo("span"),u=No(W),p=Fo("div"),m=Fo("button"),g=No(e[21]),y=Fo("span"),b=No($),w=Fo("div");for(let e=0;e<G.length;e+=1)G[e].c();x=Fo("div");for(let e=0;e<X.length;e+=1)X[e].c();C=Fo("div"),A=Fo("div"),I=Fo("div"),R=No(e[18]),O=Fo("div"),M=Fo("div");for(let e=0;e<J.length;e+=1)J[e].c();j=Fo("div");for(let e=0;e<ee.length;e+=1)ee[e].c();q=Fo("button"),q.textContent="",Bo(n,"class","pad-top"),Bo(s,"id","search"),Bo(s,"class","search"),Bo(s,"type","search"),Bo(s,"role","combobox"),Bo(s,"enterkeyhint","search"),Bo(s,"placeholder",o=e[0].searchLabel),Bo(s,"autocapitalize","none"),Bo(s,"autocomplete","off"),Bo(s,"spellcheck","true"),Bo(s,"aria-expanded",a=!(!e[4]||!e[1].length)),Bo(s,"aria-controls","search-results"),Bo(s,"aria-describedby","search-description"),Bo(s,"aria-autocomplete","list"),Bo(s,"aria-activedescendant",l=e[26]?`emo-${e[26]}`:""),Bo(c,"class","sr-only"),Bo(c,"for","search"),Bo(h,"id","search-description"),Bo(h,"class","sr-only"),Bo(r,"class","search-wrapper"),Bo(m,"id","skintone-button"),Bo(m,"class",f="emoji "+(e[6]?"hide-focus":"")),Bo(m,"aria-label",e[23]),Bo(m,"title",e[23]),Bo(m,"aria-describedby","skintone-description"),Bo(m,"aria-haspopup","listbox"),Bo(m,"aria-expanded",e[6]),Bo(m,"aria-controls","skintone-list"),Bo(p,"class",v="skintone-button-wrapper "+(e[19]?"expanded":"")),Bo(y,"id","skintone-description"),Bo(y,"class","sr-only"),Bo(w,"id","skintone-list"),Bo(w,"class",S="skintone-list "+(e[6]?"":"hidden no-animate")),zo(w,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),Bo(w,"role","listbox"),Bo(w,"aria-label",_=e[0].skinTonesLabel),Bo(w,"aria-activedescendant",E="skintone-"+e[20]),Bo(w,"aria-hidden",k=!e[6]),Bo(i,"class","search-row"),Bo(x,"class","nav"),Bo(x,"role","tablist"),zo(x,"grid-template-columns","repeat("+e[12].length+", 1fr)"),Bo(x,"aria-label",T=e[0].categoriesLabel),Bo(A,"class","indicator"),zo(A,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),Bo(C,"class","indicator-wrapper"),Bo(I,"class",P="message "+(e[18]?"":"gone")),Bo(I,"role","alert"),Bo(I,"aria-live","polite"),Bo(O,"class",D="tabpanel "+(!e[14]||e[18]?"gone":"")),Bo(O,"role",L=e[4]?"region":"tabpanel"),Bo(O,"aria-label",F=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),Bo(O,"id",N=e[4]?"":`tab-${e[13].id}`),Bo(O,"tabindex","0"),Bo(j,"class",B="favorites emoji-menu "+(e[18]?"gone":"")),Bo(j,"role","menu"),Bo(j,"aria-label",U=e[0].favoritesLabel),zo(j,"padding-inline-end",e[25]+"px"),Bo(q,"aria-hidden","true"),Bo(q,"tabindex","-1"),Bo(q,"class","abs-pos hidden emoji"),Bo(t,"class","picker"),Bo(t,"aria-label",z=e[0].regionLabel),Bo(t,"style",e[22])},m(o,a){Do(o,t,a),Mo(t,n),Mo(t,i),Mo(i,r),Mo(r,s),qo(s,e[2]),Mo(r,c),Mo(c,d),Mo(r,h),Mo(h,u),Mo(i,p),Mo(p,m),Mo(m,g),Mo(i,y),Mo(y,b),Mo(i,w);for(let e=0;e<G.length;e+=1)G[e].m(w,null);e[48](w),Mo(t,x);for(let e=0;e<X.length;e+=1)X[e].m(x,null);Mo(t,C),Mo(C,A),Mo(t,I),Mo(I,R),Mo(t,O),Mo(O,M);for(let e=0;e<J.length;e+=1)J[e].m(M,null);e[50](O),Mo(t,j);for(let e=0;e<ee.length;e+=1)ee[e].m(j,null);var l;Mo(t,q),e[51](q),e[52](t),V||(K=[jo(s,"input",e[47]),jo(s,"keydown",e[30]),jo(m,"click",e[35]),jo(w,"focusout",e[38]),jo(w,"click",e[34]),jo(w,"keydown",e[36]),jo(w,"keyup",e[37]),jo(x,"keydown",e[32]),(l=e[29].call(null,M),l&&Ao(l.destroy)?l.destroy:ko),jo(O,"click",e[33]),jo(j,"click",e[33])],V=!0)},p(e,n){1&n[0]&&o!==(o=e[0].searchLabel)&&Bo(s,"placeholder",o),18&n[0]&&a!==(a=!(!e[4]||!e[1].length))&&Bo(s,"aria-expanded",a),67108864&n[0]&&l!==(l=e[26]?`emo-${e[26]}`:"")&&Bo(s,"aria-activedescendant",l),4&n[0]&&qo(s,e[2]),1&n[0]&&H!==(H=e[0].searchLabel+"")&&Uo(d,H),1&n[0]&&W!==(W=e[0].searchDescription+"")&&Uo(u,W),2097152&n[0]&&Uo(g,e[21]),64&n[0]&&f!==(f="emoji "+(e[6]?"hide-focus":""))&&Bo(m,"class",f),8388608&n[0]&&Bo(m,"aria-label",e[23]),8388608&n[0]&&Bo(m,"title",e[23]),64&n[0]&&Bo(m,"aria-expanded",e[6]),524288&n[0]&&v!==(v="skintone-button-wrapper "+(e[19]?"expanded":""))&&Bo(p,"class",v),1&n[0]&&$!==($=e[0].skinToneDescription+"")&&Uo(b,$),1049089&n[0]&&(ne=e[9],G=sa(G,n,ie,1,e,ne,Y,w,ra,Oa,null,Pa)),64&n[0]&&S!==(S="skintone-list "+(e[6]?"":"hidden no-animate"))&&Bo(w,"class",S),64&n[0]&&zo(w,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),1&n[0]&&_!==(_=e[0].skinTonesLabel)&&Bo(w,"aria-label",_),1048576&n[0]&&E!==(E="skintone-"+e[20])&&Bo(w,"aria-activedescendant",E),64&n[0]&&k!==(k=!e[6])&&Bo(w,"aria-hidden",k),12305&n[0]|1&n[1]&&(re=e[12],X=sa(X,n,se,1,e,re,Z,x,ra,Ma,null,Ra)),4096&n[0]&&zo(x,"grid-template-columns","repeat("+e[12].length+", 1fr)"),1&n[0]&&T!==(T=e[0].categoriesLabel)&&Bo(x,"aria-label",T),16779264&n[0]&&zo(A,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),262144&n[0]&&Uo(R,e[18]),262144&n[0]&&P!==(P="message "+(e[18]?"":"gone"))&&Bo(I,"class",P),402694449&n[0]&&(oe=e[15],J=sa(J,n,ae,1,e,oe,Q,M,ra,Na,null,Aa)),278528&n[0]&&D!==(D="tabpanel "+(!e[14]||e[18]?"gone":""))&&Bo(O,"class",D),16&n[0]&&L!==(L=e[4]?"region":"tabpanel")&&Bo(O,"role",L),8209&n[0]&&F!==(F=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name])&&Bo(O,"aria-label",F),8208&n[0]&&N!==(N=e[4]?"":`tab-${e[13].id}`)&&Bo(O,"id",N),402654464&n[0]&&(le=e[10],ee=sa(ee,n,ce,1,e,le,te,j,ra,Ua,null,Ca)),262144&n[0]&&B!==(B="favorites emoji-menu "+(e[18]?"gone":""))&&Bo(j,"class",B),1&n[0]&&U!==(U=e[0].favoritesLabel)&&Bo(j,"aria-label",U),33554432&n[0]&&zo(j,"padding-inline-end",e[25]+"px"),1&n[0]&&z!==(z=e[0].regionLabel)&&Bo(t,"aria-label",z),4194304&n[0]&&Bo(t,"style",e[22])},i:ko,o:ko,d(n){n&&Lo(t);for(let e=0;e<G.length;e+=1)G[e].d();e[48](null);for(let e=0;e<X.length;e+=1)X[e].d();for(let e=0;e<J.length;e+=1)J[e].d();e[50](null);for(let e=0;e<ee.length;e+=1)ee[e].d();e[51](null),e[52](null),V=!1,Co(K)}}}function za(e,t,n){let i,r,s,o,a,l,c,d,h,u,{skinToneEmoji:p}=t,{i18n:m}=t,{database:g}=t,{customEmoji:f}=t,{customCategorySorting:v}=t,y=[],b=[],w="",S="",_=!1,E=-1,k=!1,x=!1,T=0,C=0,A="",I=[],R=[],P=8,O=!1,M=0,D=0,L=aa,F=!1;const N=e=>{i.getRootNode().getElementById(e).focus()},j=(e,t)=>{i.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))},B=(e,t)=>t&&e.skins&&e.skins[t]||e.unicode,U=e=>/^skintone-/.test(e.id);function q(e){return!e.unicode||!da(e)||ya.get(e.unicode)}async function z(e){const t=await va;return e.filter((({version:e})=>!e||e<=t))}async function V(e){return function(e,t){const n=e=>{const n={};for(const i of e)"number"==typeof i.tone&&i.version<=t&&(n[i.tone]=i.unicode);return n};return e.map((({unicode:e,skins:t,shortcodes:i,url:r,name:s,category:o})=>({unicode:e,name:s,shortcodes:i,url:r,category:o,id:e||s,skins:t&&n(t),title:(i||[]).join(", ")})))}(e,await va)}function K(e){n(2,w=""),n(44,S=""),n(5,E=-1),n(11,D=L.findIndex((t=>t.id===e.id)))}async function H(e){const t=await g.getEmojiByUnicodeOrName(e),n=[...y,...R].find((t=>t.id===e)),i=n.unicode&&B(n,T);await g.incrementFavoriteEmojiCount(e),j("emoji-click",{emoji:t,skinTone:T,...i&&{unicode:i},...n.name&&{name:n.name}})}async function W(e){const{target:t}=e;if(!U(t))return;ba(e);const i=parseInt(t.id.slice(9),10);n(8,T=i),n(6,k=!1),N("skintone-button"),j("skin-tone-change",{skinTone:i}),g.setPreferredSkinTone(i)}return va.then((e=>{e||n(18,o=m.emojiUnsupportedMessage)})),e.$$set=e=>{"skinToneEmoji"in e&&n(40,p=e.skinToneEmoji),"i18n"in e&&n(0,m=e.i18n),"database"in e&&n(39,g=e.database),"customEmoji"in e&&n(41,f=e.customEmoji),"customCategorySorting"in e&&n(42,v=e.customCategorySorting)},e.$$.update=()=>{if(1280&e.$$.dirty[1]&&f&&g&&n(39,g.customEmoji=f,g),1&e.$$.dirty[0]|256&e.$$.dirty[1]){async function t(){let e=!1;const t=setTimeout((()=>{e=!0,n(18,o=m.loadingMessage)}),1e3);try{await g.ready(),n(14,F=!0)}catch(e){console.error(e),n(18,o=m.networkErrorMessage)}finally{clearTimeout(t),e&&(e=!1,n(18,o=""))}}g&&t()}if(6144&e.$$.dirty[0]|1024&e.$$.dirty[1]&&(f&&f.length?n(12,L=[la,...aa]):L!==aa&&(D&&n(11,D--,D),n(12,L=aa))),4&e.$$.dirty[0]&&ca((()=>{n(44,S=(w||"").trim()),n(5,E=-1)})),6144&e.$$.dirty[0]&&n(13,h=L[D]),24576&e.$$.dirty[0]|8192&e.$$.dirty[1]){async function C(){if(F){if(S.length>=2){const e=S,t=await async function(e){return V(await z(await g.getEmojiBySearchQuery(e)))}(e);e===S&&(n(1,y=t),n(4,_=!0))}else if(h){const e=h.id,t=await async function(e){if(void 0===e)return[];const t=-1===e?f:await g.getEmojiByGroup(e);return V(await z(t))}(e);e===h.id&&(n(1,y=t),n(4,_=!1))}}else n(1,y=[]),n(4,_=!1)}C()}if(4112&e.$$.dirty[0]&&n(22,c=`\n  --font-family: ${pa};\n  --num-groups: ${L.length}; \n  --indicator-opacity: ${_?0:1}; \n  --num-skintones: 6;`),16384&e.$$.dirty[0]|256&e.$$.dirty[1]){async function O(){F&&n(8,T=await g.getPreferredSkinTone())}O()}if(512&e.$$.dirty[1]&&n(9,I=Array(6).fill().map(((e,t)=>function(e,t){if(0===t)return e;const n=e.indexOf("");return-1!==n?e.substring(0,n)+String.fromCodePoint(127995+t-1)+e.substring(n):(e.endsWith("")&&(e=e.substring(0,e.length-1)),e+"\ud83c"+String.fromCodePoint(57339+t-1))}(p,t)))),768&e.$$.dirty[0]&&n(21,l=I[T]),257&e.$$.dirty[0]&&n(23,A=m.skinToneLabel.replace("{skinTone}",m.skinTones[T])),16384&e.$$.dirty[0]|256&e.$$.dirty[1]){async function M(){n(45,d=(await Promise.all(ua.map((e=>g.getEmojiByUnicodeOrName(e))))).filter(Boolean))}F&&M()}if(16384&e.$$.dirty[0]|49408&e.$$.dirty[1]){async function N(){const e=await g.getTopFavoriteEmoji(P),t=await V(Sa([...e,...d],(e=>e.unicode||e.name)).slice(0,P));n(10,R=t)}F&&d&&N()}if(10&e.$$.dirty[0]){const j=y.filter((e=>e.unicode)).filter((e=>da(e)&&!ya.has(e.unicode)));j.length?_a((()=>function(e){const t=i.getRootNode();!function(e,t,n){for(const i of e){const e=xa(n(i));void 0===Ea&&(Ea=xa(t));const r=e/1.8<Ea;ya.set(i.unicode,r)}}(e,r,(e=>t.getElementById(`emo-${e.id}`))),n(1,y)}(j))):(n(1,y=y.filter(q)),_a((()=>{(s||{}).scrollTop=0})))}if(e.$$.dirty[0],e.$$.dirty[1],18&e.$$.dirty[0]|2048&e.$$.dirty[1]){function B(){if(_)return[{category:"",emojis:y}];const e=new Map;for(const t of y){const n=t.category||"";let i=e.get(n);i||(i=[],e.set(n,i)),i.push(t)}return[...e.entries()].map((([e,t])=>({category:e,emojis:t}))).sort(((e,t)=>v(e.category,t.category)))}n(15,b=B())}34&e.$$.dirty[0]&&n(26,u=-1!==E&&y[E].id),192&e.$$.dirty[0]&&(k?a.addEventListener("transitionend",(()=>{n(19,x=!0)}),{once:!0}):n(19,x=!1))},[m,y,w,s,_,E,k,a,T,I,R,D,L,h,F,b,i,r,o,x,C,l,c,A,O,M,u,B,(e,t)=>{return(n=[e.name||B(e,t),...e.shortcodes||[]],Sa(n,(e=>e))).join(", ");var n},function(e){return function(e,t){let n;return ka?(n=new ResizeObserver((e=>t(e[0].contentRect.width))),n.observe(e)):_a((()=>t(e.getBoundingClientRect().width))),{destroy(){n&&n.disconnect()}}}(e,(t=>{{const r=getComputedStyle(i),s=parseInt(r.getPropertyValue("--num-columns"),10),o="rtl"===r.getPropertyValue("direction"),a=e.parentElement.getBoundingClientRect().width-t;n(46,P=s),n(25,M=a),n(24,O=o)}}))},function(e){if(!_||!y.length)return;const t=t=>{ba(e),n(5,E=wa(t,E,y))};switch(e.key){case"ArrowDown":return t(!1);case"ArrowUp":return t(!0);case"Enter":if(-1!==E)return ba(e),H(y[E].id);y.length&&n(5,E=0)}},K,function(e){const{target:t,key:n}=e,i=t=>{t&&(ba(e),t.focus())};switch(n){case"ArrowLeft":return i(t.previousSibling);case"ArrowRight":return i(t.nextSibling);case"Home":return i(t.parentElement.firstChild);case"End":return i(t.parentElement.lastChild)}},async function(e){const{target:t}=e;t.classList.contains("emoji")&&(ba(e),H(t.id.substring(4)))},W,async function(e){n(6,k=!k),n(20,C=T),k&&(ba(e),_a((()=>N(`skintone-${C}`))))},function(e){if(!k)return;const t=async t=>{ba(e),n(20,C=t),await(Xo(),Go),N(`skintone-${C}`)};switch(e.key){case"ArrowUp":return t(wa(!0,C,I));case"ArrowDown":return t(wa(!1,C,I));case"Home":return t(0);case"End":return t(I.length-1);case"Enter":return W(e);case"Escape":return ba(e),n(6,k=!1),N("skintone-button")}},function(e){if(k)return" "===e.key?W(e):void 0},async function(e){const{relatedTarget:t}=e;t&&U(t)||n(6,k=!1)},g,p,f,v,!0,S,d,P,function(){w=this.value,n(2,w)},function(e){Ho[e?"unshift":"push"]((()=>{a=e,n(7,a)}))},e=>K(e),function(e){Ho[e?"unshift":"push"]((()=>{s=e,n(3,s)}))},function(e){Ho[e?"unshift":"push"]((()=>{r=e,n(17,r)}))},function(e){Ho[e?"unshift":"push"]((()=>{i=e,n(16,i)}))}]}class Va extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(Co(n.on_destroy),n.fragment&&n.fragment.d(1),n.on_destroy=n.fragment=null,n.ctx=[])}(this),this.$destroy=ko}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),function(e,t,n,i,r,s,o,a=[-1]){const l=Po;Vo(e);const c=e.$$={fragment:null,ctx:null,props:s,update:ko,not_equal:r,bound:To(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:To(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(c.root);let d=!1;c.ctx=n?n(e,t.props||{},((t,n,...i)=>{const s=i.length?i[0]:n;return c.ctx&&r(c.ctx[t],c.ctx[t]=s)&&(!c.skip_bound&&c.bound[t]&&c.bound[t](s),d&&function(e,t){-1===e.$$.dirty[0]&&(Ko.push(e),Xo(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],c.update(),d=!0,Co(c.before_update),c.fragment=!!i&&i(c.ctx),t.target&&(c.fragment&&c.fragment.c(),function(e,t,n,i){const{fragment:r,on_mount:s,on_destroy:o,after_update:a}=e.$$;r&&r.m(t,void 0),Zo((()=>{const t=s.map(xo).filter(Ao);o?o.push(...t):Co(t),e.$$.on_mount=[]})),a.forEach(Zo)}(e,t.target),ea()),Vo(l)}(this,e,za,qa,Io,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}var Ka={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const Ha=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class Wa extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(t),this._ctx={locale:"en",dataSource:"https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",skinToneEmoji:"",customCategorySorting:ma,customEmoji:null,i18n:Ka,...e};for(const e of Ha)"database"!==e&&Object.prototype.hasOwnProperty.call(this,e)&&(this._ctx[e]=this[e],delete this[e]);this._dbFlush()}connectedCallback(){this._cmp=new Va({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e&&e.close().catch((e=>console.error(e)))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(e,t,n){this._set(e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())),n)}_set(e,t){this._ctx[e]=t,this._cmp&&this._cmp.$set({[e]:t}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:t,database:n}=this._ctx;n&&n.locale===e&&n.dataSource===t||this._set("database",new Eo({locale:e,dataSource:t}))}_dbFlush(){Promise.resolve().then((()=>this._dbCreate()))}}const $a={};for(const e of Ha)$a[e]={get(){return"database"===e&&this._dbCreate(),this._ctx[e]},set(t){if("database"===e)throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(Wa.prototype,$a),customElements.get("emoji-picker")||customElements.define("emoji-picker",Wa);var Ga=__webpack_require__(8244),Ya={};function Xa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ya.styleTagTransform=Me(),Ya.setAttributes=Ie(),Ya.insert=Ce().bind(null,"head"),Ya.domAPI=xe(),Ya.insertStyleElement=Pe(),Ee()(Ga.Z,Ya),Ga.Z&&Ga.Z.locals&&Ga.Z.locals;class Za extends m{constructor(...e){super(...e),Xa(this,"cancel",(e=>this.setState({active:null}))),Xa(this,"handleInput",(e=>this.props.actions[e.data]?this.setState({active:this.props.actions[e.data]}):null)),Xa(this,"insert",((e,t)=>{if(this.props.setTextValue){const n=this.props.textarea.current.selectionStart,i=this.props.textarea.current.selectionEnd;if(n===i){const n=this.props.textValue.slice(0,i),r=this.props.textValue.slice(i),s=n.replace(t,e);this.props.setTextValue(`${s}${r}`,(e=>{this.props.textarea.current.focus(),this.props.textarea.current.selectionEnd=s.length}))}}this.props.getSelection&&this.props.getSelection(e),this.cancel()}))}componentDidMount(){this.props.textarea?.current&&(this.props.textarea.current.addEventListener("input",this.handleInput),this.props.textarea.current.addEventListener("click",this.cancel),this.props.textarea.current.addEventListener("blur",this.cancel))}componentWillUnmount(){this.props.textarea?.current&&(this.props.textarea.current.removeEventListener("input",this.handleInput),this.props.textarea.current.removeEventListener("click",this.cancel),this.props.textarea.current.removeEventListener("blur",this.cancel))}render(e,t){if(t.active)return t.active({insert:this.insert,cancel:this.cancel,textarea:e.textarea,textValue:e.textValue,below:e.below})}}class Ja extends m{constructor(e){super(e),Xa(this,"handleKeydown",(e=>{"ArrowDown"===e.key&&(e.preventDefault(),this.state.selection+1<this.state.popupItems.length&&this.setState((e=>({selection:e.selection+1})))),"ArrowUp"===e.key&&(e.preventDefault(),this.state.selection>0&&this.setState((e=>({selection:e.selection-1})))),("Enter"===e.key||":"===e.key)&&this.state.popupItems.length>0&&(e.preventDefault(),this.insertSelection())})),Xa(this,"handleKeyup",(e=>{const t=this.props.textarea.current.selectionStart,n=this.props.textarea.current.selectionEnd;if(t===n){const e=this.props.textValue.slice(0,n).match(/:\S*$/);if(e){const t=e[0].slice(1);return t.length<2?this.setState({popupItems:[]}):void this.database.getEmojiBySearchQuery(t).then((e=>{this.setState({popupItems:e.filter((e=>e.version<13)).sort(((e,n)=>e.shortcodes[0]===t?-1:n.shortcodes[0]===t?1:e.shortcodes[0].includes(t)?n.shortcodes[0].includes(t)?0:-1:n.shortcodes[0].includes(t)?1:0)).slice(0,3).map(((e,t)=>h(Qa,{key:e.unicode,emoji:e,insert:this.props.insert,selected:this.state.selection===t})))})}))}}this.props.cancel()})),Xa(this,"insertSelection",(e=>{const t=this.state.popupItems[this.state.selection].props.emoji.unicode;this.props.insert(t,/:\S*$/)})),this.state={popupItems:[],selection:0},this.database=new Eo}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("keydown",this.handleKeydown),this.props.textarea.current.addEventListener("keyup",this.handleKeyup))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("keydown",this.handleKeydown),this.props.textarea.current.removeEventListener("keyup",this.handleKeyup))}render(e,t){if(this.state.popupItems.length>0)return h("div",{style:{top:40*t.popupItems.length+"px"},id:"popup-wrapper"},h("div",{id:"popup-menu",style:e.below?{top:"0px"}:{bottom:"0px"}},this.state.popupItems))}}class Qa extends m{constructor(...e){super(...e),Xa(this,"insertEmoji",(e=>{e.preventDefault(),this.props.insert(this.props.emoji.unicode,/:\S*$/)}))}render(e){return h("div",{onmousedown:this.insertEmoji,class:e.selected?"popup-menu-item-selected-emoji popup-menu-item":"popup-menu-item"},h("span",{class:"popup-menu-item-emojishortcode"}," :",e.emoji.shortcodes[0],": "),h("span",null,""),h("span",{class:"popup-menu-item-emojiglyph"}," ",e.emoji.unicode," "))}}class el extends m{constructor(e){super(e),Xa(this,"handleKeydown",(e=>{"ArrowDown"===e.key&&(e.preventDefault(),this.state.selection+1<this.state.popupItems.length&&this.setState((e=>({selection:e.selection+1})))),"ArrowUp"===e.key&&(e.preventDefault(),this.state.selection>0&&this.setState((e=>({selection:e.selection-1})))),"Enter"===e.key&&this.state.popupItems.length>0&&(e.preventDefault(),this.insertSelection())})),Xa(this,"insertSelection",(e=>{const t=this.state.popupItems[this.state.selection].props.user.userId;this.props.insert(`${t} `,/@\S*$/)})),Xa(this,"handleKeyup",(e=>{const t=this.props.textarea.current.selectionStart,n=this.props.textarea.current.selectionEnd;if(t===n){const e=this.props.textValue.slice(0,n).match(/@\S*$/);if(e){const t=this.generatePopupItems(e[0].substring(1)),n={popupItems:t};return t.length<this.state.selection+1&&(n.selection=Math.max(t.length-1,0)),void this.setState(n)}}this.props.cancel()})),this.state={popupItems:[],selection:0}}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("keydown",this.handleKeydown),this.props.textarea.current.addEventListener("keyup",this.handleKeyup))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("keydown",this.handleKeydown),this.props.textarea.current.removeEventListener("keyup",this.handleKeyup))}generatePopupItems(e){return tt.client.getUsers().filter((t=>t.userId.includes(e.toLowerCase())||t.displayName.toLowerCase().includes(e.toLowerCase()))).slice(0,3).map(((e,t)=>h(tl,{insert:this.props.insert,key:e.userId,selected:this.state.selection===t,user:e})))}render(e,t){if(this.state.popupItems.length>0)return h("div",{style:{top:40*t.popupItems.length+"px"},id:"popup-wrapper"},h("div",{id:"popup-menu",style:e.below?{top:"0px"}:{bottom:"0px"}},this.state.popupItems))}}class tl extends m{constructor(...e){super(...e),Xa(this,"colorFromId",new we(this.props.user.userId)),Xa(this,"insertUserId",(e=>{e.preventDefault(),this.props.insert(`${this.props.user.userId} `,/@\S*$/)}))}render(e){return h("div",{onmousedown:this.insertUserId,style:this.colorFromId.styleVariables,class:e.selected?"popup-menu-item-selected-user popup-menu-item":"popup-menu-item"},h("span",{class:"popup-menu-item-userid"}," @",e.user.userId.split(":")[0].substring(1)," "),h("span",null,""),h("span",{class:"popup-menu-item-username"}," ",e.user.displayName," "))}}class nl extends m{constructor(e){super(e),Xa(this,"handleKeydown",(e=>{"ArrowDown"===e.key&&(e.preventDefault(),this.state.selection+1<this.state.popupItems.length&&this.setState((e=>({selection:e.selection+1})))),"ArrowUp"===e.key&&(e.preventDefault(),this.state.selection>0&&this.setState((e=>({selection:e.selection-1})))),"Enter"===e.key&&this.state.popupItems.length>0&&(e.preventDefault(),this.insertSelection())})),Xa(this,"insertSelection",(e=>{const t=this.state.popupItems[this.state.selection].props.member.userId;this.props.insert(`${t} `,/@\S*$/)})),Xa(this,"handleKeyup",(e=>{const t=this.props.textarea.current.selectionStart,n=this.props.textarea.current.selectionEnd;if(t===n){const e=this.props.textValue.slice(0,n).match(/@\S*$/);if(e){const t=this.generatePopupItems(e[0].substring(1)),n={popupItems:t};return t.length<this.state.selection+1&&(n.selection=Math.max(t.length-1,0)),void this.setState(n)}}this.props.cancel()})),this.state={popupItems:[],selection:0}}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("keydown",this.handleKeydown),this.props.textarea.current.addEventListener("keyup",this.handleKeyup))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("keydown",this.handleKeydown),this.props.textarea.current.removeEventListener("keyup",this.handleKeyup))}generatePopupItems(e){const t=tt.client.getRoom(this.props.roomId);return t?t.getMembersWithMembership("join").filter((t=>t.userId.includes(e.toLowerCase())||t.name.toLowerCase().includes(e.toLowerCase()))).slice(0,3).map(((e,t)=>h(il,{insert:this.props.insert,key:e.userId,selected:this.state.selection===t,member:e}))):[]}render(e,t){if(this.state.popupItems.length>0)return h("div",{style:{top:40*t.popupItems.length+"px"},id:"popup-wrapper"},h("div",{id:"popup-menu",style:e.below?{top:"0px"}:{bottom:"0px"}},this.state.popupItems))}}class il extends m{constructor(...e){super(...e),Xa(this,"colorFromId",new we(this.props.member.userId)),Xa(this,"insertUserId",(e=>{e.preventDefault(),this.props.insert(`${this.props.member.userId} `,/@\S*$/)}))}render(e){return h("div",{onmousedown:this.insertUserId,style:this.colorFromId.styleVariables,class:e.selected?"popup-menu-item-selected-user popup-menu-item":"popup-menu-item"},h("span",{class:"popup-menu-item-userid"}," @",e.member.userId.split(":")[0].substring(1)," "),h("span",null,""),h("span",{class:"popup-menu-item-username"}," ",e.member.name," "))}}class rl extends m{constructor(e){super(e),Xa(this,"handleKeydown",(e=>{"ArrowDown"===e.key&&(e.preventDefault(),this.state.selection+1<this.state.popupItems.length&&this.setState((e=>({selection:e.selection+1})))),"ArrowUp"===e.key&&(e.preventDefault(),this.state.selection>0&&this.setState((e=>({selection:e.selection-1})))),"Enter"===e.key&&this.state.popupItems.length>0&&(e.preventDefault(),this.insertSelection())})),Xa(this,"insertSelection",(e=>{const t=this.state.popupItems[this.state.selection].props.flag.keyword;this.props.insert(`~${t} `,/~\S*$/)})),Xa(this,"handleKeyup",(e=>{const t=this.props.textarea.current.selectionStart,n=this.props.textarea.current.selectionEnd;if(t===n){const e=this.props.textValue.slice(0,n).match(/~\S*$/);if(e){const t=this.generatePopupItems(e[0].substring(1)),n={popupItems:t};return t.length<this.state.selection+1&&(n.selection=Math.max(t.length-1,0)),void this.setState(n)}}this.props.cancel()})),this.state={popupItems:[],selection:0}}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("keydown",this.handleKeydown),this.props.textarea.current.addEventListener("keyup",this.handleKeyup))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("keydown",this.handleKeydown),this.props.textarea.current.removeEventListener("keyup",this.handleKeyup))}generatePopupItems(e){return this.props.flags.filter((t=>t.keyword.includes(e))).slice(0,3).map(((e,t)=>h(sl,{insert:this.props.insert,key:e.keyword,selected:this.state.selection===t,flag:e})))}render(e,t){if(this.state.popupItems.length>0)return h("div",{style:{top:40*t.popupItems.length+"px"},id:"popup-wrapper"},h("div",{id:"popup-menu",style:e.below?{top:"0px"}:{bottom:"0px"}},this.state.popupItems))}}class sl extends m{constructor(...e){super(...e),Xa(this,"insertFlag",(e=>{e.preventDefault(),this.props.insert(`~${this.props.flag.keyword} `,/~\S*$/)}))}render(e){return h("div",{onmousedown:this.insertFlag,class:e.selected?"popup-menu-item-selected-flag popup-menu-item":"popup-menu-item"},h("span",{class:"popup-menu-item-flag"}," ~",e.flag.keyword," "),h("span",null,""),h("span",{class:"popup-menu-item-flag-description"}," ",e.flag.description," "))}}var ol=__webpack_require__(2667),al={};function ll(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}al.styleTagTransform=Me(),al.setAttributes=Ie(),al.insert=Ce().bind(null,"head"),al.domAPI=xe(),al.insertStyleElement=Pe(),Ee()(ol.Z,al),ol.Z&&ol.Z.locals&&ol.Z.locals;class cl extends m{constructor(e){super(e),ll(this,"tooltip",{current:null}),ll(this,"handleClick",(()=>{navigator.clipboard.writeText(this.props.copy).then((e=>{this.setState({content:"copied!"},(e=>this.tooltip.current.show()))}))})),this.state={content:"copy to clipboard"}}render(e,{content:t}){return h(Tr,{ref:this.tooltip,content:t},h("button",{onClick:this.handleClick,type:"button",class:"copy-button"},dn))}}var dl,hl=__webpack_require__(5255),ul={};function pl(){return pl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},pl.apply(this,arguments)}function ml(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ul.styleTagTransform=Me(),ul.setAttributes=Ie(),ul.insert=Ce().bind(null,"head"),ul.domAPI=xe(),ul.insertStyleElement=Pe(),Ee()(hl.Z,ul),hl.Z&&hl.Z.locals&&hl.Z.locals;class gl extends m{constructor(e){super(e),ml(this,"resizeObserver",new ResizeObserver((e=>this.resize()))),ml(this,"settingsFormWrapper",{current:null}),ml(this,"settingsForm",{current:null}),ml(this,"avatarSelector",{current:null}),ml(this,"roomTopicTextarea",{current:null}),ml(this,"resize",(e=>{clearTimeout(this.allowOverflow),this.settingsFormWrapper.current.style.height=`${this.settingsForm.current.scrollHeight}px`,this.settingsFormWrapper.current.style.overflowY="hidden",this.allowOverflow=setTimeout((e=>this.settingsFormWrapper.current.style.overflowY="visible"),250)})),ml(this,"handleJoinRuleChange",(e=>this.setState({joinRule:e.target.value}))),ml(this,"handleReadabilityChange",(e=>this.setState({readability:e.target.value}))),ml(this,"handleSpaceVisibilityChange",(e=>this.setState({spaceVisibility:e.target.value}))),ml(this,"handleNameInput",(e=>this.setState({roomName:e.target.value}))),ml(this,"handleTopicInput",(e=>{this.setState({roomTopic:e.target.value}),this.roomTopicTextarea.current.style.height="auto",this.roomTopicTextarea.current.style.height=`${this.roomTopicTextarea.current.scrollHeight}px`})),ml(this,"handleKeydown",(e=>e.stopPropagation())),ml(this,"handleDiscoveryChange",(e=>this.setState({discovery:e.target.value}))),ml(this,"progressHandler",(e=>this.setState({progress:e}))),ml(this,"avatarUpdateHandler",(()=>this.setState({avatarUpdated:!0}))),ml(this,"roleToPowerLevel",(e=>"admin"===e?100:"mod"===e?50:0)),ml(this,"powerLevelsUpdated",(e=>!!this.state.invite||!!this.state.ban||!!this.state.kick||!!this.state.redact||!!this.state.events_default||!!this.state[Be]||this.rolesUpdated())),ml(this,"rolesUpdated",(e=>{for(const e in this.state.users){if(!(e in this.powerLevels?.users))return!0;if(this.state.users[e]!==this.powerLevels?.users?.[e])return!0}for(const e in this.powerLevels?.users){if(!(e in this.state.users))return!0;if(this.state.users[e]!==this.powerLevels?.users?.[e])return!0}return!1})),ml(this,"handleSubmit",(async e=>{if(e.preventDefault(),this.setState({progress:"updating settings..."}),this.forceUpdate(),this.state.discovery!==this.initialDiscovery&&await tt.client.setRoomDirectoryVisibility(this.props.room.roomId,this.state.discovery).catch(this.raiseErr),this.state.joinRule!==this.initialJoinRule){const e={join_rule:this.state.joinRule,..."restricted"===this.state.joinRule&&{allow:[{type:"m.room_membership",room_id:this.props.resource.room.roomId}]}};console.log(e),await tt.client.sendStateEvent(this.props.room.roomId,ge.EventType.RoomJoinRules,e,"").catch(this.raiseErr)}this.state.spaceVisibility!==this.initialSpaceVisibility&&("visible"===this.state.spaceVisibility?this.publishReferences():this.hideReferences()),this.state.roomName!==this.initialRoomName&&await tt.client.setRoomName(this.props.room.roomId,this.state.roomName).catch(this.raiseErr),this.state.roomTopic!==this.initialRoomTopic&&await tt.client.setRoomTopic(this.props.room.roomId,this.state.roomTopic).catch(this.raiseErr),this.state.readability!==this.initialReadability&&await tt.client.sendStateEvent(this.props.room.roomId,ge.EventType.RoomHistoryVisibility,{history_visibility:this.state.readability}).catch(this.raiseErr),this.powerLevelsUpdated()&&(this.state.invite&&(this.powerLevels.invite=this.roleToPowerLevel(this.state.invite)),this.state.ban&&(this.powerLevels.ban=this.roleToPowerLevel(this.state.ban)),this.state.kick&&(this.powerLevels.kick=this.roleToPowerLevel(this.state.kick)),this.state.redact&&(this.powerLevels.redact=this.roleToPowerLevel(this.state.redact)),this.state.events_default&&(this.powerLevels.events_default=this.roleToPowerLevel(this.state.events_default)),this.state[Be]&&(this.powerLevels.events[Be]=this.roleToPowerLevel(this.state[Be])),this.rolesUpdated()&&(this.powerLevels.users=this.state.users),await tt.client.sendStateEvent(this.props.room.roomId,ge.EventType.RoomPowerLevels,this.powerLevels).catch(this.raiseErr)),await this.avatarSelector.current.uploadAvatar(),hs.hide()})),ml(this,"raiseErr",(e=>alert("Something went wrong. You may not have permission to adjust some of these settings."))),ml(this,"showAppearance",(e=>this.setState({view:"APPEARANCE"}))),ml(this,"showAccess",(e=>this.setState({view:"ACCESS"}))),ml(this,"showLinks",(e=>this.setState({view:"LINKS"}))),ml(this,"showRoles",(e=>this.setState({view:"ROLES"}))),ml(this,"showPermissions",(e=>this.setState({view:"PERMISSIONS"}))),ml(this,"setPowerLevelRole",((e,t)=>this.setState({[e]:t}))),ml(this,"setUsers",(e=>this.setState({users:e}))),ml(this,"cancel",(e=>{e.preventDefault(),hs.hide()})),this.roomState=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS),this.resourceState=e.resource?.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS),this.initialJoinRule=this.roomState.getJoinRule(),this.mayChangeJoinRule=this.roomState.maySendStateEvent(ge.EventType.RoomJoinRules,tt.client.getUserId()),this.mayChangeAvatar=this.roomState.maySendStateEvent(ge.EventType.RoomAvatar,tt.client.getUserId()),this.initialRoomName=e.room.name,this.mayChangeRoomName=this.roomState.maySendStateEvent(ge.EventType.RoomName,tt.client.getUserId()),this.initialRoomTopic=this.roomState.getStateEvents(ge.EventType.RoomTopic,"")?.getContent()?.topic,this.mayChangeRoomTopic=this.roomState.maySendStateEvent(ge.EventType.RoomTopic,tt.client.getUserId()),this.initialReadability=e.room.getHistoryVisibility(),this.resourceState&&(this.initialSpaceVisibility=this.resourceState.getStateEvents(Be,e.room.roomId)?.getContent()?.via?"visible":"hidden",this.mayChangeSpaceVisibility=this.resourceState.maySendStateEvent(Be,tt.client.getUserId())),this.restrictedAvailable=!["1","2","3","4","5","6","7"].includes(e.room.getVersion())&&this.resourceState?.getStateEvents(Be,e.room.roomId)?.getContent(),this.mayChangeReadability=this.roomState.maySendStateEvent(ge.EventType.RoomHistoryVisibility,tt.client.getUserId()),this.joinLink=`${window.location.protocol}//${window.location.hostname}${window.location.pathname}?join=${encodeURIComponent(e.room.roomId)}&via=${tt.client.getDomain()}`,this.powerLevels=this.roomState.getStateEvents(ge.EventType.RoomPowerLevels,"")?.getContent(),this.member=e.room.getMember(tt.client.getUserId()),this.state={previewUrl:e.room.getAvatarUrl(tt.client.getHomeserverUrl(),400,400,"crop"),joinRule:this.initialJoinRule,roomName:this.initialRoomName,readability:this.initialReadability,spaceVisibility:this.initialSpaceVisibility,roomTopic:this.initialRoomTopic,users:this.powerLevels?.users||{},discovery:null,references:null,view:"APPEARANCE"}}componentDidMount(){this.initialize(),this.resizeObserver.observe(this.settingsForm.current),this.roomTopicTextarea.current.style.height="auto",this.roomTopicTextarea.current.style.height=`${this.roomTopicTextarea.current.scrollHeight}px`}componentWillUnmount(){this.resizeObserver.disconnect(),clearTimeout(this.allowOverflow)}async initialize(){let e=50;if(this.powerLevels){const t=this.powerLevels?.state_default;Number.isSafeInteger(t)&&(e=t)}this.member.powerLevel>=e&&(this.mayChangeDiscovery=!0);const t=await tt.client.getRoomDirectoryVisibility(this.props.room.roomId);this.initialDiscovery=t.visibility;const n=this.roomState.getStateEvents(Ue);this.setState({references:n,discovery:t.visibility})}publishReferences(){const e=tt.client.getDomain();for(const t of this.state.references){const n=new rs(t);if(!n.isValid())continue;const i={via:[e],[We]:n.location};tt.client.sendStateEvent(n.getParent(),Be,i,this.props.room.roomId).catch((e=>alert(e)))}}hideReferences(){for(const e of this.state.references){const t=new rs(e);if(!t.isValid())continue;const n={};tt.client.sendStateEvent(t.getParent(),Be,n,this.props.room.roomId).catch((e=>alert(e)))}}render(e,t){const n=this.powerLevelsUpdated()||this.state.discovery!==this.initialDiscovery||this.state.joinRule!==this.initialJoinRule||this.state.roomName!==this.initialRoomName||this.state.roomTopic!==this.initialRoomTopic||this.state.readability!==this.initialReadability||this.state.spaceVisibility!==this.initialSpaceVisibility||this.state.avatarUpdated;return h(p,null,h("div",{id:"room-settings-select-view",class:"select-view"},h("button",{onClick:this.showAppearance,"data-current-button":"APPEARANCE"===t.view},"Appearance"),h("button",{onClick:this.showAccess,"data-current-button":"ACCESS"===t.view},"Access"),h("button",{onClick:this.showRoles,"data-current-button":"ROLES"===t.view},"Roles"),h("button",{onClick:this.showPermissions,"data-current-button":"PERMISSIONS"===t.view},"Permissions"),e.joinLink?h("button",{onClick:this.showLinks,"data-current-button":"LINKS"===t.view},"Links"):null),h("div",{ref:this.settingsFormWrapper,id:"room-settings-form-wrapper"},h("form",{ref:this.settingsForm,id:"room-settings-form"},"APPEARANCE"===t.view?h(p,null,h(Wr,{ref:this.avatarSelector,previewUrl:t.previewUrl,room:e.room,progressHandler:this.progressHandler,handleUpdate:this.avatarUpdateHandler}),h("div",{class:"room-settings-info"}),h("label",{htmlFor:"room-name"},"Room Name"),h("input",{name:"room-name",type:"text",class:"styled-input",value:t.roomName,disabled:!this.mayChangeRoomName,onkeydown:this.handleKeydown,onInput:this.handleNameInput}),h("div",{class:"room-settings-info"}),h("label",{class:"top-aligned-label",htmlFor:"room-topic"},"Topic"),h("textarea",{ref:this.roomTopicTextarea,name:"room-topic",class:"styled-input",value:t.roomTopic,disabled:!this.mayChangeRoomTopic,onkeydown:this.handleKeydown,onInput:this.handleTopicInput}),h("div",{class:"room-settings-info"})):"ACCESS"===t.view?h(p,null,h("label",{htmlFor:"discovery"},"Discovery"),h("select",{disabled:!t.discovery||!this.mayChangeDiscovery,class:"styled-input",value:t.discovery,name:"discovery",onchange:this.handleDiscoveryChange},h("option",{value:"private"},"Private"),h("option",{value:"public"},"Publicly Listed")),h("div",{class:"room-settings-info"},"public"===t.discovery?"the room will appear in room search results":"the room will not appear in room search results"),h("label",{htmlFor:"joinRule"},"Join Rule"),h("select",{class:"styled-input",value:t.joinRule,name:"joinRule",onchange:this.handleJoinRuleChange},h("option",{value:"public"},"Public"),h("option",{value:"invite"},"Invite-Only"),h("option",{disabled:!this.restrictedAvailable,value:"restricted"},"Restricted")),h("div",{class:"room-settings-info"},"public"===t.joinRule?"anyone who can find the room may join":"invite"===t.joinRule?"an explicit invitation is required before joining":"only someone with access to the resource being annotated may join"),h("label",{htmlFor:"readability"},"Readability"),h("select",{class:"styled-input",value:t.readability,disabled:!this.mayChangeReadability,name:"readability",onchange:this.handleReadabilityChange},h("option",{value:"shared"},"Members Only"),h("option",{value:"world_readable"},"World Readable")),h("div",{class:"room-settings-info"},"world_readable"===t.readability?"anyone can see what's happening in the room":"only room members can see what's happening in the room"),this.initialSpaceVisibility?h(p,null,h("label",{htmlFor:"spaceVisibility"},"Visibility"),h("select",{class:"styled-input",value:t.spaceVisibility,disabled:!this.mayChangeSpaceVisibility,name:"spaceVisibility",onchange:this.handleSpaceVisibilityChange},h("option",{value:"visible"},"Visible "),h("option",{value:"hidden"},"Hidden")),h("div",{class:"room-settings-info"},"visible"===t.spaceVisibility?"the annotation is visible to everyone":"the annotation is hidden unless you've already seen it")):null):"LINKS"===t.view?h(p,null,h("label",null,"Join Link"),h("div",{class:"room-settings-link-group"},h("pre",{id:"room-settings-join-link"},this.joinLink," "),h(cl,{copy:this.joinLink})),h("div",{class:"room-settings-info"},"Clicking this link will cause an attempt to join this room")):"ROLES"===t.view?h(p,null,h(yl,{initialUsers:this.powerLevels?.users,users:this.state.users,setUsers:this.setUsers,room:e.room}),h(wl,{initialUsers:this.powerLevels?.users,users:this.state.users,setUsers:this.setUsers,room:e.room}),h(_l,{users:this.state.users})):"PERMISSIONS"===t.view?h(p,null,h(vl,{setPowerLevelRole:this.setPowerLevelRole,powerLevels:this.powerLevels,powerKey:"invite",requiredRole:t.invite,label:"Invite",member:this.member,act:"invite new members"}),h(vl,{setPowerLevelRole:this.setPowerLevelRole,powerLevels:this.powerLevels,powerKey:"kick",label:"Kick",requiredRole:t.kick,member:this.member,act:"remove users from the room"}),h(vl,{setPowerLevelRole:this.setPowerLevelRole,powerLevels:this.powerLevels,powerKey:"ban",label:"Ban",requiredRole:t.ban,member:this.member,act:"remove users and ban them from rejoining"}),h(vl,{setPowerLevelRole:this.setPowerLevelRole,powerLevels:this.powerLevels,powerKey:"redact",label:"Redact",requiredRole:t.redact,member:this.member,act:"remove any message from the room"}),e.room.getType()===ge.RoomType.Space?null:h(vl,{setPowerLevelRole:this.setPowerLevelRole,powerLevels:this.powerLevels,powerKey:"events_default",label:"Message",requiredRole:t.events_default,member:this.member,act:"send messages"}),is.hasResource(e.room)?h(fl,{setPowerLevelRole:this.setPowerLevelRole,powerLevels:this.powerLevels,type:Be,requiredRole:t[Be],label:"Annotate",member:this.member,act:"create annotations"}):null):null,h("div",{id:"room-settings-submit-wrapper"},h("button",{disabled:!n,className:"styled-button",onClick:this.handleSubmit},"Save Changes"),h("button",{className:"styled-button",onClick:this.cancel},"Cancel")),"string"==typeof t.progress?h("div",{id:"room-settings-progress"},t.progress):t.progress?.total?h("div",{id:"room-settings-progress"},h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null)))}}class fl extends m{constructor(e){super(e),ml(this,"getPowerLevelForStateEvent",(e=>{if(this.props.type in this.props.powerLevels?.events)return this.props.powerLevels.events[this.props.type];let t=50;if(this.props.powerLevels){const e=this.props.powerLevels?.state_default;Number.isSafeInteger(e)&&(t=e)}return t})),ml(this,"handleChange",(e=>{e.target.value===this.initialRole?this.props.setPowerLevelRole(this.props.type,void 0):this.props.setPowerLevelRole(this.props.type,e.target.value)})),ml(this,"mayChangePowerLevelForStateEvent",(e=>{if(ge.EventType.RoomPowerLevels in this.props.powerLevels?.events){if(this.props.member.powerLevel<getPowerLevelForStateEvent(this.props.type))return!1;const e=this.props.powerLevels.events[ge.EventType.RoomPowerLevels];return this.props.member.powerLevel>=e}return!0})),this.mayChangePowerLevel=this.mayChangePowerLevelForStateEvent(),this.initialPowerLevel=this.getPowerLevelForStateEvent(),this.initialRole=this.initialPowerLevel>=100?"admin":this.initialPowerLevel>=50?"mod":0===this.initialPowerLevel?"member":"custom"}render(e){const t=e.requiredRole||this.initialRole;return h(p,null,h("label",{htmlFor:e.label},e.label),h("select",{class:"styled-input",value:t,disabled:!this.mayChangePowerLevel,name:e.label,onchange:this.handleChange},h("option",{disabled:e.member.powerLevels<100,value:"admin"},"Administrators only"),h("option",{disabled:e.member.powerLevels<50,value:"mod"},"Moderators and above"),h("option",{value:"member"},"Any member"),"custom"===this.initialRole?h("option",{value:"custom"},"Custom Value"):null),h("div",{class:"room-settings-info"},"admin"===t?`Only admins can ${e.act}`:"mod"===t?`Admins and moderators can ${e.act}`:"member"===t?`Any room member can ${e.act}`:`Powerlevel ${this.initialPowerLevel} is required to ${e.act}`))}}class vl extends m{constructor(e){super(e),ml(this,"getPowerLevelForKey",(e=>this.props.powerKey in this.props.powerLevels?this.props.powerLevels[this.props.powerKey]:"events_default"===this.props.powerKey?0:50)),ml(this,"handleChange",(e=>{e.target.value===this.initialRole?this.props.setPowerLevelRole(this.props.powerKey,void 0):this.props.setPowerLevelRole(this.props.powerKey,e.target.value)})),ml(this,"mayChangePowerLevelForKey",(e=>{if(ge.EventType.RoomPowerLevels in this.props.powerLevels?.events){if(this.props.member.powerLevel<this.getPowerLevelForKey(this.props.powerKey))return!1;const e=this.props.powerLevels.events[ge.EventType.RoomPowerLevels];return this.props.member.powerLevel>=e}return!0})),this.mayChangePowerLevel=this.mayChangePowerLevelForKey(),this.initialPowerLevel=this.getPowerLevelForKey(),this.initialRole=100===this.initialPowerLevel?"admin":50===this.initialPowerLevel?"mod":0===this.initialPowerLevel?"member":"custom"}render(e){const t=e.requiredRole||this.initialRole;return h(p,null,h("label",{htmlFor:e.label},e.label),h("select",{class:"styled-input",value:t,disabled:!this.mayChangePowerLevel,name:e.label,onchange:this.handleChange},h("option",{value:"admin"},"Administrators only"),h("option",{value:"mod"},"Moderators and above"),h("option",{value:"member"},"Any member"),"custom"===this.initialRole?h("option",{value:"custom"},"Custom Value"):null),h("div",{class:"room-settings-info"},"admin"===t?`Only admins can ${e.act}`:"mod"===t?`Admins and moderators can ${e.act}`:"member"===t?`Any room member can ${e.act}`:`Powerlevel ${this.initialPowerLevel} is required to ${e.act}`))}}class yl extends m{constructor(e){super(e),ml(this,"getAdmins",(e=>{let t=[];for(const e in this.props.users)if(100===this.props.users[e]){const n=!(e in this.props.initialUsers)||this.props.initialUsers[e]!==this.props.users[e];t.push(h(Sl,{activated:n,toggleRole:this.toggleAdmin,room:this.props.room,key:e,user:e}))}for(const e in this.props.initialUsers)100!==this.props.initialUsers[e]||e in this.props.users||t.push(h(Sl,{deactivated:!0,toggleRole:this.toggleAdmin,room:this.props.room,key:e,user:e}));return t.length>0?t:h("div",{class:"room-settings-role-empty"},"No admins!")})),ml(this,"toggleAdmin",(e=>{const t=Object.assign({},this.props.users);100!==t[e]?t[e]=100:delete t[e],this.props.setUsers(t)})),ml(this,"addAdmin",(e=>{const t=Object.assign({},this.props.users);100!==t[e]&&(t[e]=100),this.props.setUsers(t)})),ml(this,"canAdd",this.props.room.getMember(tt.client.getUserId()).powerLevel>=50),this.state={search:""}}render(e){return h("div",{class:"room-settings-role-list"},h("h5",null,"Administrators"),this.getAdmins(),this.canAdd?h(bl,{users:e.users,addRole:this.addAdmin,room:e.room}):null)}}class bl extends m{constructor(e){super(e),ml(this,"searchInput",{current:null}),ml(this,"handleInput",(e=>this.setState({search:e.target.value}))),ml(this,"setSearch",(e=>this.setState({search:e}))),ml(this,"popupActions",{"@":e=>h(nl,pl({roomId:this.props.room.roomId},e))}),ml(this,"addRole",(e=>{this.setSearch(""),tt.client.getUserId()!==e.trim()&&this.props.room.getMember(e.trim()).powerLevel>=this.props.room.getMember(tt.client.getUserId()).powerLevel||this.props.addRole(e.trim())})),this.state={search:""}}render(e,t){return h("div",{class:"room-settings-add-role"},h("span",{class:"small-icon"},lt),h("div",{class:"room-settings-add-role-input-wrapper"},h("input",{ref:this.searchInput,oninput:this.handleInput,value:t.search,type:"text",class:"styled-input"}),h(Za,{below:!0,textValue:t.search,textarea:this.searchInput,actions:this.popupActions,getSelection:this.addRole})))}}class wl extends m{constructor(...e){super(...e),ml(this,"getMods",(e=>{let t=[];for(const e in this.props.users)if(50===this.props.users[e]){const n=!(e in this.props.initialUsers)||this.props.initialUsers[e]!==this.props.users[e];t.push(h(Sl,{activated:n,toggleRole:this.toggleMod,key:e,room:this.props.room,user:e,power:50}))}for(const e in this.props.initialUsers)50!==this.props.initialUsers[e]||e in this.props.users||t.push(h(Sl,{deactivated:!0,toggleRole:this.toggleMod,key:e,room:this.props.room,user:e,power:50}));return t.length>0?t:h("div",{class:"room-settings-role-empty"},"None")})),ml(this,"toggleMod",(e=>{const t=Object.assign({},this.props.users);50!==t[e]?t[e]=50:delete t[e],this.props.setUsers(t)})),ml(this,"addMod",(e=>{const t=Object.assign({},this.props.users);50!==t[e]&&(t[e]=50),this.props.setUsers(t)})),ml(this,"canAdd",this.props.room.getMember(tt.client.getUserId()).powerLevel>=50)}render(e){return h("div",{class:"room-settings-role-list"},h("h5",null,"Moderators"),this.getMods(),this.canAdd?h(bl,{users:e.users,addRole:this.addMod,room:e.room}):null)}}class Sl extends m{constructor(...e){super(...e),ml(this,"handleClick",(e=>{this.props.toggleRole(this.props.user)})),ml(this,"canToggle",this.props.user===tt.client.getUserId()||this.props.activated||this.props.power<this.props.room.getMember(tt.client.getUserId()).powerLevel)}render(e){return h("button",{type:"button","data-role-deactivated":e.deactivated,"data-role-toggleable":this.canToggle,onclick:this.canToggle?this.handleClick:null,class:"room-settings-role-listing"},h("span",{class:"small-icon"},e.deactivated?lt:at),h("span",{class:"room-settings-role-user"}," ",e.user),e.activated?h("span",{class:"room-settings-role-change-info"},"will be added to this role"):null,e.deactivated?h("span",{class:"room-settings-role-change-info"},"will be removed from this role"):null,(e.deactivated||e.activated)&&tt.client.getUserId()===e.user?h("span",{style:{marginTop:"5px",color:"red"},class:"room-settings-role-change-info"},h("b",null,"Warning"),": changing your own role can be irreversible, and can cause you to lose control of the room."):null)}}class _l extends m{constructor(...e){super(...e),ml(this,"getOtherRoles",(e=>{let t=[];for(const e in this.props.users)100!==this.props.users[e]&&50!==this.props.users[e]&&t.push(h("div",{class:"room-settings-otherrole-listing",key:e},e));return t.length>0?t:null}))}render(){return this.getOtherRoles()?h("div",{class:"room-settings-role-list"},h("h5",null,"Other Roles"),this.getOtherRoles()):null}}function El(e){const t=[],n=/[^\s"]+|"([^"]*)"/gi;let i;do{i=n.exec(e),null!=i&&t.push(i[1]?i[1]:i[0])}while(null!=i);return t}function kl(){return kl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},kl.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(dl||(dl={}));var xl="beforeunload";function Tl(e){e.preventDefault(),e.returnValue=""}function Cl(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function Al(e){var t=e.pathname,n=void 0===t?"/":t,i=e.search,r=void 0===i?"":i,s=e.hash,o=void 0===s?"":s;return r&&"?"!==r&&(n+="?"===r.charAt(0)?r:"?"+r),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function Il(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function Rl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Pl{static push(e,t){le(e,this.history.location.pathname==e),this.history.replace(e,t)}static replace(e,t){le(e,!0),this.history.replace(e,t)}static setPath(e,t){const n=this.history.location.pathname.split("/");n[e]=t,Pl.push(n.join("/"))}}Rl(Pl,"history",function(e){void 0===e&&(e={});var t=e.window,n=void 0===t?document.defaultView:t,i=n.history;function r(){var e=Il(n.location.hash.substr(1)),t=e.pathname,r=void 0===t?"/":t,s=e.search,o=void 0===s?"":s,a=e.hash,l=void 0===a?"":a,c=i.state||{};return[c.idx,{pathname:r,search:o,hash:l,state:c.usr||null,key:c.key||"default"}]}var s=null;function o(){if(s)u.call(s),s=null;else{var e=dl.Pop,t=r(),n=t[0],i=t[1];if(u.length){if(null!=n){var o=c-n;o&&(s={action:e,location:i,retry:function(){y(-1*o)}},y(o))}}else v(e)}}n.addEventListener("popstate",o),n.addEventListener("hashchange",(function(){Al(r()[1])!==Al(d)&&o()}));var a=dl.Pop,l=r(),c=l[0],d=l[1],h=Cl(),u=Cl();function p(e){return function(){var e=document.querySelector("base"),t="";if(e&&e.getAttribute("href")){var i=n.location.href,r=i.indexOf("#");t=-1===r?i:i.slice(0,r)}return t}()+"#"+("string"==typeof e?e:Al(e))}function m(e,t){return void 0===t&&(t=null),kl({pathname:d.pathname,hash:"",search:""},"string"==typeof e?Il(e):e,{state:t,key:Math.random().toString(36).substr(2,8)})}function g(e,t){return[{usr:e.state,key:e.key,idx:t},p(e)]}function f(e,t,n){return!u.length||(u.call({action:e,location:t,retry:n}),!1)}function v(e){a=e;var t=r();c=t[0],d=t[1],h.call({action:a,location:d})}function y(e){i.go(e)}return null==c&&(c=0,i.replaceState(kl({},i.state,{idx:c}),"")),{get action(){return a},get location(){return d},createHref:p,push:function e(t,r){var s=dl.Push,o=m(t,r);if(f(s,o,(function(){e(t,r)}))){var a=g(o,c+1),l=a[0],d=a[1];try{i.pushState(l,"",d)}catch(e){n.location.assign(d)}v(s)}},replace:function e(t,n){var r=dl.Replace,s=m(t,n);if(f(r,s,(function(){e(t,n)}))){var o=g(s,c),a=o[0],l=o[1];i.replaceState(a,"",l),v(r)}},go:y,back:function(){y(-1)},forward:function(){y(1)},listen:function(e){return h.push(e)},block:function(e){var t=u.push(e);return 1===u.length&&n.addEventListener(xl,Tl),function(){t(),u.length||n.removeEventListener(xl,Tl)}}}}()),Rl(Pl,"message",{});var Ol=__webpack_require__(8316),Ml={};function Dl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ml.styleTagTransform=Me(),Ml.setAttributes=Ie(),Ml.insert=Ce().bind(null,"head"),Ml.domAPI=xe(),Ml.insertStyleElement=Pe(),Ee()(Ol.Z,Ml),Ol.Z&&Ol.Z.locals&&Ol.Z.locals;class Ll extends m{constructor(e){super(e),Dl(this,"roomList",{current:null}),Dl(this,"roomListener",(e=>{clearTimeout(this.roomDebounceTimeout),this.roomDebounceTimeout=setTimeout((e=>{this.setState({rooms:tt.client.getVisibleRooms().filter(is.hasResource).filter((e=>"join"===e.getMyMembership()))})}),1e3)})),Dl(this,"resizeListener",(e=>{clearTimeout(this.resizeDebounceTimeout),this.resizeDebounceTimeout=setTimeout(this.resetMemberLimit,500)})),Dl(this,"resetMemberLimit",(e=>{this.roomList.current&&(this.roomList.current.clientWidth>500?this.setState({memberLimit:15}):this.roomList.current.clientWidth>300?this.setState({memberLimit:5}):this.setState({memberLimit:2}))})),Dl(this,"byActivity",((e,t)=>{const n=e.getLastActiveTimestamp(),i=t.getLastActiveTimestamp();return n<i?1*this.state.sortOrder:i<n?-1*this.state.sortOrder:0})),Dl(this,"byName",((e,t)=>{const n=e.name,i=t.name;return n<i?1*this.state.sortOrder:i<n?-1*this.state.sortOrder:0})),Dl(this,"byCreation",((e,t)=>{const n=e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(ge.EventType.RoomCreate,"").getTs(),i=t.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(ge.EventType.RoomCreate,"").getTs();return n<i?1*this.state.sortOrder:i<n?-1*this.state.sortOrder:0})),Dl(this,"sortByActivity",(e=>{this.setState((e=>"ACTIVITY"===e.sort?{sortOrder:-1*e.sortOrder}:{sort:"ACTIVITY"}))})),Dl(this,"sortByName",(e=>{this.setState((e=>"NAME"===e.sort?{sortOrder:-1*e.sortOrder}:{sort:"NAME"}))})),Dl(this,"sortByCreation",(e=>{this.setState((e=>"CREATION"===e.sort?{sortOrder:-1*e.sortOrder}:{sort:"CREATION"}))})),Dl(this,"flipSort",(e=>{this.setState((e=>({sortOrder:-1*e.sortOrder})))})),Dl(this,"searchRooms",(e=>{const t=[],n=[],i=[],r=[],s=[],o=[];for(const a of e)"#"===a.slice(0,1)?n.push(a.slice(1)):"@"===a.slice(0,1)?i.push(a.slice(1)):"*"===a.slice(0,1)?s.push(a.slice(1)):"~"===a.slice(0,1)?r.push(a.slice(1)):"!"===a.slice(0,1)?o.push(a):t.push(a);return this.state.rooms.filter((e=>{let a=!0;r.includes("fav")&&(a=a&&!!e.tags["m.favourite"]);const l=Object.keys(e.tags).filter((e=>"u."===e.slice(0,2))),c=e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS),d=c.getMembers().filter((e=>"join"===e.membership||"invite"===e.membership)),h=d.map((e=>e.userId)),u=d.map((e=>e.name)),p=h.concat(u),m=c.getStateEvents("m.space.parent").filter((e=>!!e.getContent().via)).map((e=>tt.client.getRoom(e.getStateKey())?.name)).filter((e=>e));return t.every((t=>e.name.toLowerCase().includes(t.toLowerCase())))&&(!(o.length>0)||o.some((t=>e.roomId===t)))&&i.every((e=>p.some((t=>t.toLowerCase().includes(e.toLowerCase())))))&&n.every((e=>l.some((t=>t.toLowerCase().includes(e.toLowerCase())))))&&s.every((e=>m.some((t=>t.toLowerCase().includes(e.toLowerCase())))))&&a}))})),Dl(this,"sortRooms",(e=>e.sort(this.getSortFunc()).map((e=>{const t=new is(e);let n=null;return"join"===e.getMyMembership()&&t.url&&(n=h(jl,{memberLimit:this.state.memberLimit,room:e,key:e.roomId})),n})).filter((e=>null!==e)))),this.state={rooms:tt.client.getVisibleRooms().filter(is.hasResource),sort:"ACTIVITY",sortOrder:1,memberLimit:15}}componentDidMount(){tt.client.on("Room",this.roomListener),tt.client.on("Room.name",this.roomListener),tt.client.on("RoomState.events",this.roomListener),tt.client.on("Room.accountData",this.roomListener),this.resetMemberLimit(),window.addEventListener("resize",this.resizeListener)}componentWillUnmount(){tt.client.off("Room",this.roomListener),tt.client.off("Room.name",this.roomListener),tt.client.off("RoomState.events",this.roomListener),tt.client.off("Room.accountData",this.roomListener),window.removeEventListener("resize",this.resizeListener)}getSortFunc(){switch(this.state.sort){case"CREATION":return this.byCreation;case"ACTIVITY":return this.byActivity;case"NAME":return this.byName}}render(e,t){return h("div",{id:"room-list",ref:this.roomList},h("div",{id:"select-sort"},h("button",{class:"small-icon",style:"cursor: pointer",onClick:this.flipSort},1===t.sortOrder?$t:Wt),h("button",{"data-current-button":"ACTIVITY"===t.sort,onClick:this.sortByActivity,class:"styled-button"},"Activity"),h("button",{"data-current-button":"NAME"===t.sort,onClick:this.sortByName,class:"styled-button"},"Name"),h("button",{"data-current-button":"CREATION"===t.sort,onClick:this.sortByCreation,class:"styled-button"},"Creation")),h(Fl,{setFilterItems:e.setFilterItems,filterItems:e.filterItems}),h("div",null,this.sortRooms(this.searchRooms(El(e.searchFilter).concat(e.filterItems.map((e=>e.value)))))))}}class Fl extends m{constructor(...e){super(...e),Dl(this,"removeFilter",(e=>this.props.setFilterItems(this.props.filterItems.filter((t=>t.value!==e.value)))))}render(e){if(e.filterItems.length>0)return h("div",{id:"room-filters"},"Filters: ",e.filterItems.map((e=>h(Nl,{removeFilter:this.removeFilter,key:e.value,filter:e}))))}}class Nl extends m{constructor(...e){super(...e),Dl(this,"removeMe",(e=>{this.props.removeFilter(this.props.filter)}))}render(e){return h("span",{class:"room-filter-listing"},h("span",{class:"room-filter-content"},e.filter.display),h("button",{onclick:this.removeMe,class:"small-icon-badge"},ot))}}class jl extends m{constructor(e){super(e),Dl(this,"roomColor",new Se(this.props.room.roomId)),Dl(this,"toggleButtons",(e=>this.setState((e=>({buttonsVisible:!e.buttonsVisible}))))),Dl(this,"openMembership",(e=>hs.set(h(ws,{room:this.props.room}),"Manage Membership",`for ${this.props.room.name}`))),Dl(this,"openSettings",(e=>hs.set(h(gl,{joinLink:!0,room:this.props.room}),"Room Settings",`for ${this.props.room.name}`))),Dl(this,"handleEditTags",(e=>hs.set(h(Ms,{room:this.props.room}),"Edit Tags",`for ${this.props.room.name}`))),Dl(this,"toggleFavorite",(e=>{this.props.room.tags["m.favourite"]?tt.client.deleteRoomTag(this.props.room.roomId,"m.favourite"):tt.client.setRoomTag(this.props.room.roomId,"m.favourite",{order:.5})})),Dl(this,"handleClose",(e=>hs.set(h(Is,{room:this.props.room}),"Leave Room?",`for ${this.props.room.name}`))),this.state={buttonsVisible:!1}}render(e,t){const n=e.room.getMember(tt.client.getUserId()),i=n.powerLevel>=100,r=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).hasSufficientPowerLevelFor("invite",n.powerLevel),s=e.room.getCanonicalAlias()?.slice(1);if(s)return h("div",{style:this.roomColor.styleVariables,class:"room-listing-entry",id:e.room.roomId},h(Bl,{room:e.room}),h("div",{"data-room-entry-buttons-visible":t.buttonsVisible,class:"room-listing-body"},h("div",{class:"room-listing-heading"},e.room.tags["m.favourite"]?h("span",{class:"fav-star"}," ",Pt," "):null,h("a",{href:`${window.location.origin}${window.location.pathname}#/${encodeURIComponent(s)}/`},e.room.name)),h("div",{class:"room-listing-data"},h(Ul,{room:e.room}),h(ql,{room:e.room,memberLimit:e.memberLimit})),h("div",{class:"room-listing-entry-buttons"},t.buttonsVisible?null:h(Tr,{placement:"right",content:"Toggle buttons"},h("button",{onClick:this.toggleButtons},St)),t.buttonsVisible?h(Tr,{placement:"right",content:"Toggle buttons"},h("button",{onClick:this.toggleButtons},ot)," "):null,t.buttonsVisible?h(Tr,{placement:"right",content:"Toggle favorite"},h("button",{onClick:this.toggleFavorite},Pt)):null,t.buttonsVisible?h(Tr,{placement:"right",content:"Leave conversation"},h("button",{onClick:this.handleClose},pt)):null,t.buttonsVisible?h(Tr,{placement:"right",content:"Edit room tags"},h("button",{onClick:this.handleEditTags},Vt)):null,t.buttonsVisible&&r?h(Tr,{placement:"right",content:"Manage membership"},h("button",{onClick:this.openMembership},lt)):null,t.buttonsVisible&&i?h(Tr,{placement:"right",content:"Configure room settings"},h("button",{onClick:this.openSettings},bt)):null)))}}class Bl extends m{constructor(e){super(e),Dl(this,"avatarCanvas",{current:null}),Dl(this,"handleStateUpdate",(e=>{e.getRoomId()===this.props.room.roomId&&"m.room.avatar"===e.getType()&&this.setState({avatarEvent:e,avatarUrl:e.getContent().url?tt.client.getHttpUriForMxcFromHS(e.getContent().url,800,600,"scale"):null},this.drawBlurhash)})),Dl(this,"handleLoad",(e=>this.setState({loaded:!0}))),Dl(this,"drawBlurhash",(e=>{const t=this.state.avatarEvent?.getContent()?.info;if(!t?.h||!t?.w||!t?.blurhash)return;const n=this.avatarCanvas.current.getContext("2d");n.clearRect(0,0,this.avatarCanvas.current.wdith,this.avatarCanvas.current.height);const i=Math.floor(t.h/t.w*32);this.avatarCanvas.current.width=32,this.avatarCanvas.current.height=i;const r=n.createImageData(32,i),s=ns(t.blurhash,32,i);r.data.set(s),n.putImageData(r,0,0)}));const t=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.avatar","");this.state={avatarEvent:t,loaded:!1,avatarUrl:t?.getContent()?.url?tt.client.getHttpUriForMxcFromHS(t.getContent().url,800,600,"scale"):null}}componentDidMount(){tt.client.on("RoomState.events",this.handleStateUpdate),this.drawBlurhash()}componentWillUnmount(){tt.client.off("RoomState.events",this.handleStateUpdate)}render(e,t){const n=t.avatarEvent?.getContent()?.info,i=n?{"min-height":Math.min(300,n.h),"max-height":Math.min(300,n.h)}:null,r=n?{"min-height":Math.min(300,n.h),"max-height":Math.min(300,n.h),width:"100%"}:null;return h("div",{style:i,"data-has-avatar":!!t.avatarUrl,class:"room-listing-avatar"},t.avatarUrl?h(p,null,h("canvas",{ref:this.avatarCanvas,style:r,class:"room-listing-avatar-canvas"}),h("img",{src:t.avatarUrl,onLoad:this.handleLoad,class:"room-listing-avatar-img","data-avatar-loaded":t.loaded,loading:"lazy",alt:"room avatar"})):null,h(zl,{room:e.room}))}}function Ul(e){const t=Object.keys(e.room.tags).filter((e=>"u."===e.slice(0,2))).length;return t>0?h("div",{class:"room-listing-data-row"},h("span",{class:"room-data-icon"},Vt),h(Ls,{room:e.room})):null}class ql extends m{constructor(e){super(e),Dl(this,"toggleMemberList",(e=>this.setState((e=>({open:!e.open}))))),this.state={open:!1}}render(e,t){const n=e.room.getMembersWithMembership("join"),i=e.room.getMembersWithMembership("invite"),r=t.open?n.map((e=>h(as,{key:e.userId,member:e}))):n.slice(0,e.memberLimit).map((e=>h(as,{key:e.userId,member:e}))),s=i.map((e=>h("span",{key:e.userId,class:"invite-pill"},h(as,{member:e}))));return h("div",{class:"room-listing-data-row"},h("span",{class:"room-data-icon"},ht),h(p,null,r),h(p,null,s),n.length<=e.memberLimit?null:t.open?h("button",{onclick:this.toggleMemberList,class:"room-toggle-members"},ot):h("button",{onclick:this.toggleMemberList,class:"room-toggle-members"},"and ",n.length-e.memberLimit," more."))}}class zl extends m{constructor(e){super(e),Dl(this,"updateAnnotations",(e=>{const t=this.props.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(Be).map((e=>new rs(e))).filter((e=>e.isValid()&&"open"===e.getStatus()));this.setState({annotations:t})})),Dl(this,"handleStateUpdate",(e=>{e.getRoomId()===this.props.room.roomId&&e.getType()===Be&&this.updateAnnotations()})),Dl(this,"handleLoadNew",(e=>{const t=this.props.room.getCanonicalAlias()?.slice(1);t&&Pl.push(`/${encodeURIComponent(t)}/`,{searchString:"~unread"})})),Dl(this,"getUnreadCount",(e=>this.state.annotations.filter((e=>e.getUnread())).length)),this.state={annotations:[]},this.handleTimeline=this.handleTimeline.bind(this),this.handleStateUpdate=this.handleStateUpdate.bind(this),this.handleInitialSync=this.handleInitialSync.bind(this)}componentDidMount(){tt.client.on("RoomState.events",this.handleStateUpdate),tt.client.on("Room.accountData",this.handleTimeline),tt.client.on("Room.timeline",this.handleTimeline),tt.client.on("sync.initial",this.handleInitialSync),"PREPARED"!==tt.client.getSyncState()&&this.updateAnnotations()}componentWillUnmount(){tt.client.off("RoomState.events",this.handleStateUpdate),tt.client.off("Room.accountData",this.handleTimeline),tt.client.off("sync.initial",this.handleInitialSync),tt.client.off("Room.timeline",this.handleTimeline)}handleInitialSync(){this.updateAnnotations()}handleTimeline(e,t){const n=this.state.annotations.map((e=>e.getChild()));t?.roomId in n&&this.updateAnnotations()}render(){const e=this.getUnreadCount();return h("div",{class:"room-annotation-data"},e<1?null:h(Tr,{placement:"right",content:"Unread conversations"},h("span",{onClick:this.handleLoadNew},h("button",{class:"small-icon"},Gt),h("span",{class:"small-icon-badge"},e))))}}var Vl=__webpack_require__(5620),Kl={};function Hl(e){return h(p,null,h("p",null,'Doing so will remove the collection from your main list, but you\'ll still be able to restore it using the "Add Collection" button.'),h("button",{onClick:()=>{tt.client.setRoomTag(e.room.roomId,"m.lowpriority",{order:.5}),hs.hide()},class:"styled-button"},"Archive this room"))}Kl.styleTagTransform=Me(),Kl.setAttributes=Ie(),Kl.insert=Ce().bind(null,"head"),Kl.domAPI=xe(),Kl.insertStyleElement=Pe(),Ee()(Vl.Z,Kl),Vl.Z&&Vl.Z.locals&&Vl.Z.locals;var Wl=__webpack_require__(9129),$l={};function Gl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}$l.styleTagTransform=Me(),$l.setAttributes=Ie(),$l.insert=Ce().bind(null,"head"),$l.domAPI=xe(),$l.insertStyleElement=Pe(),Ee()(Wl.Z,$l),Wl.Z&&Wl.Z.locals&&Wl.Z.locals;class Yl extends m{constructor(e){super(e),Gl(this,"handleRoom",(e=>{clearTimeout(this.roomDebounceTimeout),this.roomDebounceTimeout=setTimeout((e=>{const t=tt.client.getVisibleRooms().filter((e=>"join"===e.getMyMembership())).filter(this.isArchived);this.setState({creating:this.state.creating||0===t.length,archived:t})}))})),Gl(this,"currentListWrapper",{current:null}),Gl(this,"updateHeight",(e=>this.currentListWrapper.current.style.height=`${this.currentList.current.scrollHeight}px`)),Gl(this,"createCollection",(e=>this.setState({creating:!0}))),Gl(this,"unarchiveCollection",(e=>this.setState({creating:!1}))),this.state={creating:!0,archived:tt.client.getVisibleRooms().filter((e=>"join"===e.getMyMembership())).filter(this.isArchived)}}componentDidMount(){tt.client.on("Room.accountData",this.handleRoom)}componentWillUnmount(){tt.client.off("Room.accountData",this.handleRoom)}isArchived(e){const t="m.space"===e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.type,n=e.tags["m.lowpriority"];return t&&n&&!is.hasResource(e)}render(e,t){return h(p,null,h("div",{id:"add-collection-select-view",class:"select-view"},h("button",{onClick:this.createCollection,"data-current-button":t.creating},"Create Collection"),h("button",{onClick:this.unarchiveCollection,disabled:0===t.archived.length,"data-current-button":!t.creating},"Restore from Archive")),h("div",{id:"add-collection-list-wrapper",ref:this.currentListWrapper},t.creating?h(Xl,null):h("div",{id:"add-collection-unarchive-list",ref:this.currentList},t.archived.map((e=>h(Zl,{room:e}))))))}}class Xl extends m{constructor(e){super(e),Gl(this,"mainForm",{current:null}),Gl(this,"collectionNameInput",{current:null}),Gl(this,"collectionTopicInput",{current:null}),Gl(this,"validateName",(e=>{clearTimeout(this.namingTimeout),this.setState({querying:!0}),this.namingTimeout=setTimeout((e=>{tt.client.getRoomIdForAlias(`#${this.toAlias(this.collectionNameInput.current.value)}:${tt.client.getDomain()}`).then((e=>this.setState({querying:!1,nameavailable:!1}))).catch((e=>{""===this.collectionNameInput.current.value?this.setState({querying:!1,nameavailable:!1}):"M_NOT_FOUND"===e.errcode?this.setState({querying:!1,nameavailable:!0}):alert(e)}))}),1e3)})),Gl(this,"handleSubmit",(async e=>{e.preventDefault();const t=this.collectionNameInput.current.value,n=this.toAlias(t),i=this.collectionTopicInput.current.value;await tt.client.createRoom({room_alias_name:n,visibility:"private",name:t,topic:i,creation_content:{type:"m.space"},initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}}]}).catch((e=>{alert(e)})),Modal.hide()})),this.state={querying:!1,nameavailable:!1}}toAlias(e){return e.replace(/[\s:]/g,"_")}render(e,t){return h(p,null,h("form",{ref:this.mainForm,onSubmit:this.handleSubmit,id:"create-collection"},h("label",{for:"name"},"Collection Name"),h("input",{name:"name",class:"styled-input",oninput:this.validateName,ref:this.collectionNameInput}),h("div",{class:"name-validation-detail"},t.querying?"querying...":t.nameavailable?"name available":"name unavailable"),h("label",{for:"topic"},"Collection Topic"),h("textarea",{name:"topic",class:"styled-input",ref:this.collectionTopicInput}),h("div",{id:"create-collection-submit"},h("button",{disabled:t.querying||!t.nameavailable,class:"styled-button",ref:this.submitButton,type:"submit"},"Create Collection"))))}}class Zl extends m{constructor(...e){super(...e),Gl(this,"unarchive",(e=>{this.setState({pending:!0}),tt.client.deleteRoomTag(this.props.room.roomId,"m.lowpriority")}))}render(e,t){return h("button",{class:"unarchive-collection","data-change-pending":t.pending,onclick:this.unarchive},h("span",{class:"small-icon"},cn),h("span",null,e.room.name))}}var Jl=__webpack_require__(1737),Ql={};function ec(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ql.styleTagTransform=Me(),Ql.setAttributes=Ie(),Ql.insert=Ce().bind(null,"head"),Ql.domAPI=xe(),Ql.insertStyleElement=Pe(),Ee()(Jl.Z,Ql),Jl.Z&&Jl.Z.locals&&Jl.Z.locals;class tc extends m{constructor(e){super(e),ec(this,"amJoined",(e=>!("join"!==tt.client.getRoom(this.props.roomId)?.getMyMembership()))),ec(this,"handleRoom",((e,t)=>{e.roomId!==this.props.roomId&&t?.roomId!==this.props.roomId||("m.room.avatar"===e.getType()?this.setState({joined:this.amJoined(),avatarUrl:e.getContent().url?tt.client.mxcUrlToHttp(e.getContent().url,35,35,"crop"):null}):(clearTimeout(this.roomDebounceTimeout),this.roomDebounceTimeout=setTimeout((e=>{this.setState({joined:this.amJoined()})}))))})),ec(this,"handleClick",(e=>this.state.joined?this.props.activeClick&&this.props.activeClick(this.props.roomId,this.props.name):this.props.inactiveClick&&this.props.inactiveClick(this.props.roomId,this.props.name))),ec(this,"roomColor",new Se(this.props.name)),ec(this,"toolTipContent",`<h3>${this.props.name}</h3>${this.props.topic?`<p>${this.props.topic}</p>`:""}${this.props.numJoinedMembers?`<span><svg\n      xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24\n      24" fill="none" stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather\n      feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"\n        /><circle cx="9" cy="7" r="4" /><path d="M23 21v-2a4 4 0 0 0-3-3.87"\n        /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></svg>:\n      ${this.props.numJoinedMembers}`:""}`),this.state={joined:this.amJoined(),loaded:!1,avatarUrl:e.avatarUrl?tt.client.mxcUrlToHttp(e.avatarUrl,35,35,"crop"):null}}componentDidMount(){tt.client.on("Room",this.handleRoom),tt.client.on("RoomState.events",this.handleRoom)}componentDidUnmount(){tt.client.on("Room",this.handleRoom),tt.client.on("RoomState.events",this.handleRoom)}render(e,t){return h(Tr,{content:this.toolTipContent,placement:"bottom-start",allowHTML:!0,theme:"info"},h("div",{onclick:this.handleClick,"data-joined":t.joined,"data-has-avatar":!!t.avatarUrl,class:"room-icon",style:{cursor:t.joined?e.activeClick&&"pointer":e.inactiveClick&&"pointer",width:e.size,height:e.size,lineHeight:`${e.size}px`,...this.roomColor.styleVariables}},t.avatarUrl?h("img",{src:t.avatarUrl,style:{width:e.size,height:e.size}}):e.name.slice(0,1)))}}function nc(e){return h("div",{class:"room-icon","data-joined":!0,"data-placeholder":!0,style:{width:e.size,height:e.size,lineHeight:`${e.size}px`,"--room_light":"var(--low-contrast-background)"}})}function ic(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class rc extends m{constructor(e){super(e),ic(this,"handleRoom",(e=>{clearTimeout(this.roomDebounceTimeout),this.roomDebounceTimeout=setTimeout((e=>{this.setState({spaces:tt.client.getVisibleRooms().filter((e=>"join"===e.getMyMembership())).filter(this.isActiveCollection)})}))})),ic(this,"filterSet",(e=>{this.props.setFilterItems([e]),this.props.showMainView&&this.props.showMainView()})),ic(this,"filterToggle",(e=>{const t=this.props.filterItems.filter((t=>t.value!==e.value));t.length===this.props.filterItems.length&&t.push(e),this.props.setFilterItems(t),this.props.showMainView&&this.props.showMainView()})),ic(this,"addCollection",(e=>{hs.set(h(Yl,null),"Add New Collection")})),rc.init(),this.state={spaces:tt.client.getVisibleRooms().filter((e=>"join"===e.getMyMembership())).filter(this.isActiveCollection)}}static init(){rc.initialized||(rc.initialized=!0,rc.spaces={},tt.client.on("RoomState.events",(e=>{rc.spaces[e.getRoomId()]&&e.getType()===Be&&(e.getContent().via?tt.client.getRoomHierarchy(e.getStateKey(),1,0).then((t=>{const[n]=t.rooms;rc.spaces[e.getRoomId()].children[n.room_id]=n,rc.spaces[e.getRoomId()].via[e.getStateKey()]=e.getContent().via})).then((t=>tt.client.emit("Space.update",e.getRoomId()))):(delete rc.spaces[e.getRoomId()].children[e.getStateKey()],tt.client.emit("Space.update",e.getRoomId())))})))}componentDidMount(){tt.client.on("Room",this.handleRoom),tt.client.on("Room.name",this.handleRoom),tt.client.on("Room.accountData",this.handleRoom)}componentWillUnmount(){tt.client.off("Room",this.handleRoom),tt.client.off("Room.name",this.handleRoom),tt.client.off("Room.accountData",this.handleRoom)}isActiveCollection(e){const t="m.space"===e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.type,n=!e.tags["m.lowpriority"];return t&&n&&!is.hasResource(e)}render(e,t){return h("div",{id:"spaces-manager"},h("h1",null,"Collections"),h("hr",{class:"styled-rule"}),h("div",{id:"spaces-list"},t.spaces.map((t=>h(sc,{filterToggle:this.filterToggle,filterSet:this.filterSet,oneColumn:e.oneColumn,key:t.roomId,room:t})))),h("div",null,h("button",{onclick:this.addCollection,id:"add-space"},"Add Collection")))}}class sc extends m{constructor(e){super(e),ic(this,"handleSpaceUpdate",(e=>{if(e===this.props.room.roomId){const e=rc.spaces[this.props.room.roomId].children,t=rc.spaces[this.props.room.roomId].via;this.setState({via:t,children:e},this.refreshModal)}})),ic(this,"loadChildren",(async e=>{let t=rc.spaces[this.props.room.roomId].nextBatch;const n=await tt.client.getRoomHierarchy(this.props.room.roomId,30,1,!1,t),i=rc.spaces[this.props.room.roomId].via;for(const e of n.rooms[0]?.children_state)i[e.state_key]=e.content.via;const r=rc.spaces[this.props.room.roomId].children;for(const e of n.rooms)e.room_id!==this.props.room.roomId&&(r[e.room_id]=e);t=n.next_batch,rc.spaces[this.props.room.roomId]={via:i,children:r,nextBatch:t},this.setState({via:i,children:r},this.refreshModal)})),ic(this,"pageChildren",(async e=>{rc.spaces[this.props.room.roomId].nextBatch&&this.loadChildren()})),ic(this,"addChildren",(e=>{const t=this.state.limit+15;t>Object.keys(this.state.children).length&&this.pageChildren(),this.setState({limit:t})})),ic(this,"refreshModal",(e=>"Manage Discussions"===hs.getTitle()?hs.set(h(oc,{children:Object.values(this.state.children),nextBatch:this.state.nextBatch,pageChildren:this.pageChildren,room:this.props.room}),"Manage Discussions",`to ${this.props.room.name}`):null)),ic(this,"searchMe",(e=>this.props.filterSet({display:h(p,null,h("span",{class:"small-icon"},Jt),this.props.room.name),value:`*${this.props.room.name}`}))),ic(this,"toggleActions",(e=>this.setState((e=>({actionsVisible:!e.actionsVisible}))))),ic(this,"addChild",(e=>{this.setState({actionsVisible:!1}),hs.set(h(oc,{children:Object.values(this.state.children),nextBatch:this.state.nextBatch,pageChildren:this.pageChildren,room:this.props.room}),"Manage Discussions",`in ${this.props.room.name}`)})),ic(this,"joinChild",(e=>tt.client.joinRoom(e,{viaServers:this.state.via[e]}).catch(pn("Couldn't join this discussion")))),ic(this,"toggleChild",((e,t)=>this.props.filterToggle({value:e,display:h(p,null,h("span",{class:"small-icon"},It),t)}))),ic(this,"openSettings",(e=>{this.setState({actionsVisible:!1}),hs.set(h(gl,{joinLink:!0,room:this.props.room}),"Room Settings",`for ${this.props.room.name}`)})),ic(this,"openMembership",(e=>{this.setState({actionsVisible:!1}),hs.set(h(ws,{room:this.props.room}),"Manage Membership",`for ${this.props.room.name}`)})),ic(this,"handleClose",(e=>hs.set(h(Is,{room:this.props.room}),"Leave Room?",`for ${this.props.room.name}`))),ic(this,"archiveRoom",(e=>hs.set(h(Hl,{room:this.props.room}),"Archive Collection?",`for ${this.props.room.name}`))),ic(this,"roomColor",new Se(this.props.room.name)),rc.spaces[this.props.room.roomId]||(rc.spaces[this.props.room.roomId]={via:{},children:{},nextBatch:null}),this.initialChildCount=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.space.child").filter((e=>e.getContent()?.via)).length,this.state={actionsVisible:!1,children:rc.spaces[this.props.room.roomId].children,limit:30,via:rc.spaces[this.props.room.roomId].via}}componentDidMount(){tt.client.on("Space.update",this.handleSpaceUpdate),this.state.limit>Object.keys(this.state.children).length&&this.loadChildren()}componentWillUnmount(){tt.client.off("Space.update",this.handleSpaceUpdate)}render(e,t){const n=e.room.getMember(tt.client.getUserId()),i=n.powerLevel>=100,r=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).hasSufficientPowerLevelFor("invite",n.powerLevel);return h("div",{style:this.roomColor.styleVariables,class:"space-listing"},h("h3",null,h("span",{onclick:this.searchMe},e.room.name),h("button",{"data-narrow-view":e.oneColumn,onclick:this.toggleActions},St)),t.actionsVisible?h("div",{class:"space-listing-actions"},i?h(Tr,{content:"Add new discussion"},h("button",{class:"small-icon",onclick:this.addChild},yt)):null,r?h(Tr,{content:"Manage membership"},h("button",{class:"small-icon",onclick:this.openMembership},lt)):null,i?h(Tr,{content:"Configure settings"},h("button",{class:"small-icon",onclick:this.openSettings},bt)):null,h(Tr,{content:"Hide and archive"},h("button",{class:"small-icon",onclick:this.archiveRoom},cn)),h(Tr,{content:"Leave collection"},h("button",{class:"small-icon",onclick:this.handleClose},pt))):null,h("div",{class:"space-listing-children"},Object.values(t.children).length>0?Object.values(t.children).slice(0,t.limit).map((e=>h(tc,{key:e.room_id,size:50,inactiveClick:this.joinChild,activeClick:this.toggleChild,roomId:e.room_id,avatarUrl:e.avatar_url,numJoinedMembers:e.num_joined_members,joinRule:e.join_rule,topic:e.topic,name:e.name||e?.canonical_alias?.slice(1)||"?"}))):Array(Math.min(t.limit,this.initialChildCount)).fill().map(((e,t)=>h(nc,{key:t,size:50}))),t.nextBatch||t.limit<Object.values(t.children).length?h("div",{class:"space-listing-more",onclick:this.addChildren},"..."):null))}}class oc extends m{constructor(e){super(e),ic(this,"currentList",{current:null}),ic(this,"currentListWrapper",{current:null}),ic(this,"handleScroll",(e=>{clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((e=>{const t=this.currentList.current;t.scrollTop+t.clientHeight+10>=t.scrollHeight&&this.props.pageChildren()}),500)})),ic(this,"updateHeight",(e=>this.currentListWrapper.current.style.height=`${this.currentList.current.scrollHeight}px`)),ic(this,"addDiscussions",(e=>this.setState({adding:!0}))),ic(this,"removeDiscussions",(e=>this.setState({adding:!1}))),ic(this,"filterDiscussions",(e=>{this.setState({search:e,discussions:tt.client.getVisibleRooms().filter((t=>is.hasResource(t)&&t.name.toLowerCase().includes(e.toLowerCase())))})})),e.children.map((e=>e.name)),this.state={search:"",adding:!0,discussions:tt.client.getVisibleRooms().filter((e=>is.hasResource(e)))}}componentDidMount(){this.updateHeight()}componentDidUpdate(){this.updateHeight()}render(e,t){const n=this.props.children.map((e=>e.room_id)),i=t.adding&&t.discussions.filter((e=>!n.includes(e.roomId))),r=!t.adding&&e.children.filter((e=>e.name.toLowerCase().includes(t.search.toLowerCase())));return h(p,null,h(fs,{search:t.search,setSearch:this.filterDiscussions}),h("div",{id:"manage-discussion-select-view",class:"select-view"},h("button",{onClick:this.addDiscussions,"data-current-button":t.adding},"Add Discussions"),h("button",{onClick:this.removeDiscussions,"data-current-button":!t.adding},"Remove Discussions")),h("div",{id:"manage-discussion-list-wrapper",ref:this.currentListWrapper},t.adding?h("div",{ref:this.currentList,id:"available-discussions-list"},i.map((t=>h(lc,{key:t.roomId,room:t,collection:e.room})))):h("div",{onscroll:this.handleScroll,ref:this.currentList,id:"current-discussions-list"},r.map((t=>h(ac,{key:t.room_id,child:t,collection:e.room}))))))}}class ac extends m{constructor(...e){super(...e),ic(this,"removeMe",(async e=>{this.setState({pending:!0}),await tt.client.sendStateEvent(this.props.collection.roomId,Be,{},this.props.child.room_id).catch(pn("Couldn't remove discussion from collection")),await tt.client.sendStateEvent(this.props.child.room_id,Ue,{},this.props.collection.roomId).catch(pn("Couldn't remove collection as parent of discussion"))}))}render(e,t){return h("button",{"data-change-pending":t.pending,class:"discussion-listing",onclick:this.removeMe},h("span",null,jt),h("span",null,e.child.name))}}class lc extends m{constructor(...e){super(...e),ic(this,"addMe",(async e=>{this.setState({pending:!0});const t=tt.client.getDomain(),n={via:[t],"com.open-tower.populus.collection_child":!0},i={via:[t]};await tt.client.sendStateEvent(this.props.collection.roomId,Be,n,this.props.room.roomId).catch(pn("Couldn't add discussion to collection")),await tt.client.sendStateEvent(this.props.room.roomId,Ue,i,this.props.collection.roomId).catch(pn("Couldn't add collection as parent of discussion"))}))}render(e,t){return h("button",{"aria-label":`add ${e.room.name} to discussion`,"data-change-pending":t.pending,class:"discussion-listing",onclick:this.addMe},h("span",null,yt),h("span",null,e.room.name))}}var cc=__webpack_require__(3734),dc={};function hc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}dc.styleTagTransform=Me(),dc.setAttributes=Ie(),dc.insert=Ce().bind(null,"head"),dc.domAPI=xe(),dc.insertStyleElement=Pe(),Ee()(cc.Z,dc),cc.Z&&cc.Z.locals&&cc.Z.locals;class uc extends m{constructor(e){super(e),hc(this,"displayNameInput",{current:null}),hc(this,"avatarImageInput",{current:null}),hc(this,"scrollbarVisibleSelect",{current:null}),hc(this,"submitButton",{current:null}),hc(this,"mainForm",{current:null}),hc(this,"progressHandler",(e=>this.setState({progress:e}))),hc(this,"chooseAvatar",(e=>this.avatarImageInput.current.click())),hc(this,"removeAvatar",(e=>this.setState({previewUrl:null}))),hc(this,"handleKeydown",(e=>{e.stopPropagation()})),hc(this,"updatePreview",(e=>{const t=this.avatarImageInput.current.files[0];t&&/^image/.test(t.type)&&this.setState({previewUrl:URL.createObjectURL(this.avatarImageInput.current.files[0])})})),hc(this,"updateProfile",(async e=>{if(e.preventDefault(),!mn())return;const t=this.avatarImageInput.current.files[0],n=this.displayNameInput.current.value;this.submitButton.current.setAttribute("disabled",!0),localStorage.setItem("scrollbars",this.scrollbarVisibleSelect.current.value),document.documentElement.dataset.scrollbars=this.scrollbarVisibleSelect.current.value,n&&await tt.client.setDisplayName(n),t&&/^image/.test(t.type)?await tt.client.uploadContent(t,{progressHandler:this.progressHandler}).then((e=>tt.client.setAvatarUrl(e))):this.state.previewUrl||await tt.client.setAvatarUrl("null"),this.mainForm.current.reset(),this.props.showMainView()}));const t=tt.client.getUser(tt.client.getUserId());this.state={previewUrl:tt.client.getHttpUriForMxcFromHS(t.avatarUrl,180,180,"crop"),displayName:t.displayName},"visible"===localStorage.getItem("scrollbars")&&(this.scrollbarsVisible=!0)}render(e,t){return h("div",{id:"profile-information"},h("h2",null,"Update Your Profile"),h("hr",{class:"styled-rule"}),h("form",{id:"profileInformationForm",ref:this.mainForm,onsubmit:this.updateProfile},h("label",null,"My User Id"),h("div",{id:"profile-information-userid"},tt.client.getUserId()),h("label",null,"My Display Name"),h("input",{class:"styled-input",onkeydown:this.handleKeydown,placeholder:t.displayName,ref:this.displayNameInput,type:"text"}),h("label",{class:"top-aligned-label"},"My Avatar"),t.previewUrl?h("img",{onclick:this.chooseAvatar,id:"profileSelector",src:t.previewUrl}):h("div",{key:"profileSelector",onclick:this.chooseAvatar,id:"profileSelector"}),h("input",{id:"profileInformationFormHidden",onchange:this.updatePreview,ref:this.avatarImageInput,accept:"image/*",type:"file"}),h("details",null,h("summary",null,"Display Options"),h("div",{id:"profile-display-options"},h("label",{for:"scrollbar-visibility"},"Scrollbars"),h("select",{class:"styled-input",ref:this.scrollbarVisibleSelect,name:"scrollbar-visibility"},h("option",{value:"hidden"},"Hidden"),h("option",{selected:this.scrollbarsVisible,value:"visible"},"Visible")))),h("details",null,h("summary",null,"Advanced Options"),h("div",{id:"profile-advanced-options"},h("label",null,"My Access Token"),h("pre",null,tt.client.getAccessToken()))),h("div",{key:"profileInformationFormSubmit",id:"profileInformationFormSubmit"},h("button",{class:"styled-button",ref:this.submitButton,type:"submit"},"Update Profile"),t.previewUrl?h("button",{class:"styled-button",type:"button",onclick:this.removeAvatar},"Remove Avatar"):null,h("button",{class:"styled-button",type:"button",onclick:e.logoutHandler},"Logout")),this.state.progress?h("div",{id:"profileInformationFormProgress"},h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null))}}var pc=__webpack_require__(1036),mc=__webpack_require__.n(pc);class gc{constructor(e,t,n){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=n}static range(e,t){return t?e&&e.loc&&t.loc&&e.loc.lexer===t.loc.lexer?new gc(e.loc.lexer,e.loc.start,t.loc.end):null:e&&e.loc}}class fc{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new fc(t,gc.range(this,e))}}class vc{constructor(e,t){this.position=void 0;var n,i="KaTeX parse error: "+e,r=t&&t.loc;if(r&&r.start<=r.end){var s=r.lexer.input;n=r.start;var o=r.end;n===s.length?i+=" at end of input: ":i+=" at position "+(n+1)+": ";var a=s.slice(n,o).replace(/[^]/g,"$&");i+=(n>15?""+s.slice(n-15,n):s.slice(0,n))+a+(o+15<s.length?s.slice(o,o+15)+"":s.slice(o))}var l=new Error(i);return l.name="ParseError",l.__proto__=vc.prototype,l.position=n,l}}vc.prototype.__proto__=Error.prototype;var yc=/([A-Z])/g,bc={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},wc=/[&><"']/g,Sc=function e(t){return"ordgroup"===t.type||"color"===t.type?1===t.body.length?e(t.body[0]):t:"font"===t.type?e(t.body):t},_c=function(e,t){return-1!==e.indexOf(t)},Ec=function(e,t){return void 0===e?t:e},kc=function(e){return String(e).replace(wc,(e=>bc[e]))},xc=function(e){return e.replace(yc,"-$1").toLowerCase()},Tc=Sc,Cc=function(e){var t=Sc(e);return"mathord"===t.type||"textord"===t.type||"atom"===t.type},Ac=function(e){var t=/^\s*([^\\/#]*?)(?::|&#0*58|&#x0*3a)/i.exec(e);return null!=t?t[1]:"_relative"},Ic={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:e=>"#"+e},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(e,t)=>(t.push(e),t)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:e=>Math.max(0,e),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:e=>Math.max(0,e),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:e=>Math.max(0,e),cli:"-e, --max-expand <n>",cliProcessor:e=>"Infinity"===e?1/0:parseInt(e)},globalGroup:{type:"boolean",cli:!1}};function Rc(e){if(e.default)return e.default;var t=e.type,n=Array.isArray(t)?t[0]:t;if("string"!=typeof n)return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class Pc{constructor(e){for(var t in this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{},Ic)if(Ic.hasOwnProperty(t)){var n=Ic[t];this[t]=void 0!==e[t]?n.processor?n.processor(e[t]):e[t]:Rc(n)}}reportNonstrict(e,t,n){var i=this.strict;if("function"==typeof i&&(i=i(e,t,n)),i&&"ignore"!==i){if(!0===i||"error"===i)throw new vc("LaTeX-incompatible input and strict mode is set to 'error': "+t+" ["+e+"]",n);"warn"===i?"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"):"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+i+"': "+t+" ["+e+"]")}}useStrictBehavior(e,t,n){var i=this.strict;if("function"==typeof i)try{i=i(e,t,n)}catch(e){i="error"}return!(!i||"ignore"===i||!0!==i&&"error"!==i&&("warn"===i?("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"),1):("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+i+"': "+t+" ["+e+"]"),1)))}isTrusted(e){e.url&&!e.protocol&&(e.protocol=Ac(e.url));var t="function"==typeof this.trust?this.trust(e):this.trust;return Boolean(t)}}class Oc{constructor(e,t,n){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=n}sup(){return Mc[Dc[this.id]]}sub(){return Mc[Lc[this.id]]}fracNum(){return Mc[Fc[this.id]]}fracDen(){return Mc[Nc[this.id]]}cramp(){return Mc[jc[this.id]]}text(){return Mc[Bc[this.id]]}isTight(){return this.size>=2}}var Mc=[new Oc(0,0,!1),new Oc(1,0,!0),new Oc(2,1,!1),new Oc(3,1,!0),new Oc(4,2,!1),new Oc(5,2,!0),new Oc(6,3,!1),new Oc(7,3,!0)],Dc=[4,5,4,5,6,7,6,7],Lc=[5,5,5,5,7,7,7,7],Fc=[2,3,4,5,6,7,6,7],Nc=[3,3,5,5,7,7,7,7],jc=[1,1,3,3,5,5,7,7],Bc=[0,1,2,3,2,3,2,3],Uc={DISPLAY:Mc[0],TEXT:Mc[2],SCRIPT:Mc[4],SCRIPTSCRIPT:Mc[6]},qc=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}],zc=[];function Vc(e){for(var t=0;t<zc.length;t+=2)if(e>=zc[t]&&e<=zc[t+1])return!0;return!1}qc.forEach((e=>e.blocks.forEach((e=>zc.push(...e)))));var Kc={doubleleftarrow:"M262 157\nl10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3\n 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28\n 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5\nc2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5\n 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87\n-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7\n-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z\nm8 0v40h399730v-40zm0 194v40h399730v-40z",doublerightarrow:"M399738 392l\n-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5\n 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88\n-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68\n-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18\n-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782\nc-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3\n-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z",leftarrow:"M400000 241H110l3-3c68.7-52.7 113.7-120\n 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8\n-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247\nc-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208\n 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3\n 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202\n l-3-3h399890zM100 241v40h399900v-40z",leftbrace:"M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117\n-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7\n 5-6 9-10 13-.7 1-7.3 1-20 1H6z",leftbraceunder:"M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13\n 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688\n 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7\n-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z",leftgroup:"M400000 80\nH435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0\n 435 0h399565z",leftgroupunder:"M400000 262\nH435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219\n 435 219h399565z",leftharpoon:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3\n-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5\n-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7\n-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z",leftharpoonplus:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5\n 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3\n-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7\n-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z\nm0 0v40h400000v-40z",leftharpoondown:"M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333\n 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5\n 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667\n-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z",leftharpoondownplus:"M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12\n 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7\n-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0\nv40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z",lefthook:"M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5\n-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3\n-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21\n 71.5 23h399859zM103 281v-40h399897v40z",leftlinesegment:"M40 281 V428 H0 V94 H40 V241 H400000 v40z\nM40 281 V428 H0 V94 H40 V241 H400000 v40z",leftmapsto:"M40 281 V448H0V74H40V241H400000v40z\nM40 281 V448H0V74H40V241H400000v40z",leftToFrom:"M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23\n-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8\nc28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3\n 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z",longequal:"M0 50 h400000 v40H0z m0 194h40000v40H0z\nM0 50 h400000 v40H0z m0 194h40000v40H0z",midbrace:"M200428 334\nc-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14\n-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7\n 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11\n 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z",midbraceunder:"M199572 214\nc100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14\n 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3\n 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0\n-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z",oiintSize1:"M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6\n-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z\nm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8\n60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z",oiintSize2:"M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8\n-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z\nm502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2\nc0 110 84 276 504 276s502.4-166 502.4-276z",oiiintSize1:"M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6\n-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z\nm525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0\n85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z",oiiintSize2:"M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8\n-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z\nm770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1\nc0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z",rightarrow:"M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z",rightbrace:"M400000 542l\n-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5\ns-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1\nc124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z",rightbraceunder:"M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3\n 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237\n-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z",rightgroup:"M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0\n 3-1 3-3v-38c-76-158-257-219-435-219H0z",rightgroupunder:"M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18\n 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z",rightharpoon:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3\n-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2\n-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58\n 69.2 92 94.5zm0 0v40h399900v-40z",rightharpoonplus:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11\n-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7\n 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z\nm0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z",rightharpoondown:"M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8\n 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5\n-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95\n-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z",rightharpoondownplus:"M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8\n 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3\n 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3\n-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z\nm0-194v40h400000v-40zm0 0v40h400000v-40z",righthook:"M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3\n 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0\n-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21\n 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z",rightlinesegment:"M399960 241 V94 h40 V428 h-40 V281 H0 v-40z\nM399960 241 V94 h40 V428 h-40 V281 H0 v-40z",rightToFrom:"M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23\n 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32\n-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142\n-167z M100 147v40h399900v-40zM0 341v40h399900v-40z",twoheadleftarrow:"M0 167c68 40\n 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69\n-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3\n-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19\n-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101\n 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z",twoheadrightarrow:"M400000 167\nc-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3\n 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42\n 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333\n-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70\n 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z",tilde1:"M200 55.538c-77 0-168 73.953-177 73.953-3 0-7\n-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0\n 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0\n 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128\n-68.267.847-113-73.952-191-73.952z",tilde2:"M344 55.266c-142 0-300.638 81.316-311.5 86.418\n-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9\n 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114\nc1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751\n 181.476 676 181.476c-149 0-189-126.21-332-126.21z",tilde3:"M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457\n-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0\n 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697\n 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696\n -338 0-409-156.573-744-156.573z",tilde4:"M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345\n-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409\n 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9\n 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409\n -175.236-744-175.236z",vec:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z",widehat1:"M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z",widehat2:"M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat3:"M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat4:"M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widecheck1:"M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,\n-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z",widecheck2:"M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck3:"M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck4:"M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",baraboveleftarrow:"M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202\nc4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5\nc-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130\ns-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47\n121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6\ns2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11\nc0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z\nM100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z",rightarrowabovebar:"M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32\n-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0\n13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39\n-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5\n-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z",baraboveshortleftharpoon:"M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17\nc2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21\nc-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40\nc-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z\nM0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z",rightharpoonaboveshortbar:"M0,241 l0,40c399126,0,399993,0,399993,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z",shortbaraboveleftharpoon:"M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,\n1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,\n-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z\nM93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z",shortrightharpoonabovebar:"M53,241l0,40c398570,0,399437,0,399437,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z"};class Hc{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return _c(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){return this.children.map((e=>e.toText())).join("")}}var Wc={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},$c={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},Gc={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function Yc(e,t,n){if(!Wc[t])throw new Error("Font metrics not found for font: "+t+".");var i=e.charCodeAt(0),r=Wc[t][i];if(!r&&e[0]in Gc&&(i=Gc[e[0]].charCodeAt(0),r=Wc[t][i]),r||"text"!==n||Vc(i)&&(r=Wc[t][77]),r)return{depth:r[0],height:r[1],italic:r[2],skew:r[3],width:r[4]}}var Xc={},Zc=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],Jc=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],Qc=function(e,t){return t.size<2?e:Zc[e-1][t.size-1]};class ed{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||ed.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=Jc[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return new ed(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:Qc(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:Jc[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=Qc(ed.BASESIZE,e);return this.size===t&&this.textSize===ed.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==ed.BASESIZE?["sizing","reset-size"+this.size,"size"+ed.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=function(e){var t;if(!Xc[t=e>=5?0:e>=3?1:2]){var n=Xc[t]={cssEmPerMu:$c.quad[t]/18};for(var i in $c)$c.hasOwnProperty(i)&&(n[i]=$c[i][t])}return Xc[t]}(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}ed.BASESIZE=6;var td={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:1.00375,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:1.00375},nd={ex:!0,em:!0,mu:!0},id=function(e){return"string"!=typeof e&&(e=e.unit),e in td||e in nd||"ex"===e},rd=function(e,t){var n;if(e.unit in td)n=td[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if("mu"===e.unit)n=t.fontMetrics().cssEmPerMu;else{var i;if(i=t.style.isTight()?t.havingStyle(t.style.text()):t,"ex"===e.unit)n=i.fontMetrics().xHeight;else{if("em"!==e.unit)throw new vc("Invalid unit: '"+e.unit+"'");n=i.fontMetrics().quad}i!==t&&(n*=i.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*n,t.maxSize)},sd=function(e){return+e.toFixed(4)+"em"},od=function(e){return e.filter((e=>e)).join(" ")},ad=function(e,t,n){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=n||{},t){t.style.isTight()&&this.classes.push("mtight");var i=t.getColor();i&&(this.style.color=i)}},ld=function(e){var t=document.createElement(e);for(var n in t.className=od(this.classes),this.style)this.style.hasOwnProperty(n)&&(t.style[n]=this.style[n]);for(var i in this.attributes)this.attributes.hasOwnProperty(i)&&t.setAttribute(i,this.attributes[i]);for(var r=0;r<this.children.length;r++)t.appendChild(this.children[r].toNode());return t},cd=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+kc(od(this.classes))+'"');var n="";for(var i in this.style)this.style.hasOwnProperty(i)&&(n+=xc(i)+":"+this.style[i]+";");for(var r in n&&(t+=' style="'+kc(n)+'"'),this.attributes)this.attributes.hasOwnProperty(r)&&(t+=" "+r+'="'+kc(this.attributes[r])+'"');t+=">";for(var s=0;s<this.children.length;s++)t+=this.children[s].toMarkup();return t+"</"+e+">"};class dd{constructor(e,t,n,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,ad.call(this,e,n,i),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return _c(this.classes,e)}toNode(){return ld.call(this,"span")}toMarkup(){return cd.call(this,"span")}}class hd{constructor(e,t,n,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,ad.call(this,t,i),this.children=n||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return _c(this.classes,e)}toNode(){return ld.call(this,"a")}toMarkup(){return cd.call(this,"a")}}class ud{constructor(e,t,n){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=n}hasClass(e){return _c(this.classes,e)}toNode(){var e=document.createElement("img");for(var t in e.src=this.src,e.alt=this.alt,e.className="mord",this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e="<img  src='"+this.src+" 'alt='"+this.alt+"' ",t="";for(var n in this.style)this.style.hasOwnProperty(n)&&(t+=xc(n)+":"+this.style[n]+";");return t&&(e+=' style="'+kc(t)+'"'),e+"'/>"}}var pd={:"",:"",:"",:""};class md{constructor(e,t,n,i,r,s,o,a){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=n||0,this.italic=i||0,this.skew=r||0,this.width=s||0,this.classes=o||[],this.style=a||{},this.maxFontSize=0;var l=function(e){for(var t=0;t<qc.length;t++)for(var n=qc[t],i=0;i<n.blocks.length;i++){var r=n.blocks[i];if(e>=r[0]&&e<=r[1])return n.name}return null}(this.text.charCodeAt(0));l&&this.classes.push(l+"_fallback"),/[]/.test(this.text)&&(this.text=pd[this.text])}hasClass(e){return _c(this.classes,e)}toNode(){var e=document.createTextNode(this.text),t=null;for(var n in this.italic>0&&((t=document.createElement("span")).style.marginRight=sd(this.italic)),this.classes.length>0&&((t=t||document.createElement("span")).className=od(this.classes)),this.style)this.style.hasOwnProperty(n)&&((t=t||document.createElement("span")).style[n]=this.style[n]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=kc(od(this.classes)),t+='"');var n="";for(var i in this.italic>0&&(n+="margin-right:"+this.italic+"em;"),this.style)this.style.hasOwnProperty(i)&&(n+=xc(i)+":"+this.style[i]+";");n&&(e=!0,t+=' style="'+kc(n)+'"');var r=kc(this.text);return e?(t+=">",t+=r,t+="</span>"):r}}class gd{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);for(var n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+"='"+this.attributes[t]+"'");e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+"</svg>"}}class fd{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","path");return this.alternate?e.setAttribute("d",this.alternate):e.setAttribute("d",Kc[this.pathName]),e}toMarkup(){return this.alternate?"<path d='"+this.alternate+"'/>":"<path d='"+Kc[this.pathName]+"'/>"}}class vd{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","line");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);return e}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+"='"+this.attributes[t]+"'");return e+"/>"}}function yd(e){if(e instanceof md)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}var bd={bin:1,close:1,inner:1,open:1,punct:1,rel:1},wd={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Sd={math:{},text:{}};function _d(e,t,n,i,r,s){Sd[e][r]={font:t,group:n,replace:i},s&&i&&(Sd[e][i]=Sd[e][r])}var Ed="math",kd="text",xd="main",Td="ams",Cd="accent-token",Ad="bin",Id="close",Rd="inner",Pd="mathord",Od="op-token",Md="open",Dd="punct",Ld="rel",Fd="spacing",Nd="textord";_d(Ed,xd,Ld,"","\\equiv",!0),_d(Ed,xd,Ld,"","\\prec",!0),_d(Ed,xd,Ld,"","\\succ",!0),_d(Ed,xd,Ld,"","\\sim",!0),_d(Ed,xd,Ld,"","\\perp"),_d(Ed,xd,Ld,"","\\preceq",!0),_d(Ed,xd,Ld,"","\\succeq",!0),_d(Ed,xd,Ld,"","\\simeq",!0),_d(Ed,xd,Ld,"","\\mid",!0),_d(Ed,xd,Ld,"","\\ll",!0),_d(Ed,xd,Ld,"","\\gg",!0),_d(Ed,xd,Ld,"","\\asymp",!0),_d(Ed,xd,Ld,"","\\parallel"),_d(Ed,xd,Ld,"","\\bowtie",!0),_d(Ed,xd,Ld,"","\\smile",!0),_d(Ed,xd,Ld,"","\\sqsubseteq",!0),_d(Ed,xd,Ld,"","\\sqsupseteq",!0),_d(Ed,xd,Ld,"","\\doteq",!0),_d(Ed,xd,Ld,"","\\frown",!0),_d(Ed,xd,Ld,"","\\ni",!0),_d(Ed,xd,Ld,"","\\propto",!0),_d(Ed,xd,Ld,"","\\vdash",!0),_d(Ed,xd,Ld,"","\\dashv",!0),_d(Ed,xd,Ld,"","\\owns"),_d(Ed,xd,Dd,".","\\ldotp"),_d(Ed,xd,Dd,"","\\cdotp"),_d(Ed,xd,Nd,"#","\\#"),_d(kd,xd,Nd,"#","\\#"),_d(Ed,xd,Nd,"&","\\&"),_d(kd,xd,Nd,"&","\\&"),_d(Ed,xd,Nd,"","\\aleph",!0),_d(Ed,xd,Nd,"","\\forall",!0),_d(Ed,xd,Nd,"","\\hbar",!0),_d(Ed,xd,Nd,"","\\exists",!0),_d(Ed,xd,Nd,"","\\nabla",!0),_d(Ed,xd,Nd,"","\\flat",!0),_d(Ed,xd,Nd,"","\\ell",!0),_d(Ed,xd,Nd,"","\\natural",!0),_d(Ed,xd,Nd,"","\\clubsuit",!0),_d(Ed,xd,Nd,"","\\wp",!0),_d(Ed,xd,Nd,"","\\sharp",!0),_d(Ed,xd,Nd,"","\\diamondsuit",!0),_d(Ed,xd,Nd,"","\\Re",!0),_d(Ed,xd,Nd,"","\\heartsuit",!0),_d(Ed,xd,Nd,"","\\Im",!0),_d(Ed,xd,Nd,"","\\spadesuit",!0),_d(Ed,xd,Nd,"","\\S",!0),_d(kd,xd,Nd,"","\\S"),_d(Ed,xd,Nd,"","\\P",!0),_d(kd,xd,Nd,"","\\P"),_d(Ed,xd,Nd,"","\\dag"),_d(kd,xd,Nd,"","\\dag"),_d(kd,xd,Nd,"","\\textdagger"),_d(Ed,xd,Nd,"","\\ddag"),_d(kd,xd,Nd,"","\\ddag"),_d(kd,xd,Nd,"","\\textdaggerdbl"),_d(Ed,xd,Id,"","\\rmoustache",!0),_d(Ed,xd,Md,"","\\lmoustache",!0),_d(Ed,xd,Id,"","\\rgroup",!0),_d(Ed,xd,Md,"","\\lgroup",!0),_d(Ed,xd,Ad,"","\\mp",!0),_d(Ed,xd,Ad,"","\\ominus",!0),_d(Ed,xd,Ad,"","\\uplus",!0),_d(Ed,xd,Ad,"","\\sqcap",!0),_d(Ed,xd,Ad,"","\\ast"),_d(Ed,xd,Ad,"","\\sqcup",!0),_d(Ed,xd,Ad,"","\\bigcirc",!0),_d(Ed,xd,Ad,"","\\bullet",!0),_d(Ed,xd,Ad,"","\\ddagger"),_d(Ed,xd,Ad,"","\\wr",!0),_d(Ed,xd,Ad,"","\\amalg"),_d(Ed,xd,Ad,"&","\\And"),_d(Ed,xd,Ld,"","\\longleftarrow",!0),_d(Ed,xd,Ld,"","\\Leftarrow",!0),_d(Ed,xd,Ld,"","\\Longleftarrow",!0),_d(Ed,xd,Ld,"","\\longrightarrow",!0),_d(Ed,xd,Ld,"","\\Rightarrow",!0),_d(Ed,xd,Ld,"","\\Longrightarrow",!0),_d(Ed,xd,Ld,"","\\leftrightarrow",!0),_d(Ed,xd,Ld,"","\\longleftrightarrow",!0),_d(Ed,xd,Ld,"","\\Leftrightarrow",!0),_d(Ed,xd,Ld,"","\\Longleftrightarrow",!0),_d(Ed,xd,Ld,"","\\mapsto",!0),_d(Ed,xd,Ld,"","\\longmapsto",!0),_d(Ed,xd,Ld,"","\\nearrow",!0),_d(Ed,xd,Ld,"","\\hookleftarrow",!0),_d(Ed,xd,Ld,"","\\hookrightarrow",!0),_d(Ed,xd,Ld,"","\\searrow",!0),_d(Ed,xd,Ld,"","\\leftharpoonup",!0),_d(Ed,xd,Ld,"","\\rightharpoonup",!0),_d(Ed,xd,Ld,"","\\swarrow",!0),_d(Ed,xd,Ld,"","\\leftharpoondown",!0),_d(Ed,xd,Ld,"","\\rightharpoondown",!0),_d(Ed,xd,Ld,"","\\nwarrow",!0),_d(Ed,xd,Ld,"","\\rightleftharpoons",!0),_d(Ed,Td,Ld,"","\\nless",!0),_d(Ed,Td,Ld,"","\\@nleqslant"),_d(Ed,Td,Ld,"","\\@nleqq"),_d(Ed,Td,Ld,"","\\lneq",!0),_d(Ed,Td,Ld,"","\\lneqq",!0),_d(Ed,Td,Ld,"","\\@lvertneqq"),_d(Ed,Td,Ld,"","\\lnsim",!0),_d(Ed,Td,Ld,"","\\lnapprox",!0),_d(Ed,Td,Ld,"","\\nprec",!0),_d(Ed,Td,Ld,"","\\npreceq",!0),_d(Ed,Td,Ld,"","\\precnsim",!0),_d(Ed,Td,Ld,"","\\precnapprox",!0),_d(Ed,Td,Ld,"","\\nsim",!0),_d(Ed,Td,Ld,"","\\@nshortmid"),_d(Ed,Td,Ld,"","\\nmid",!0),_d(Ed,Td,Ld,"","\\nvdash",!0),_d(Ed,Td,Ld,"","\\nvDash",!0),_d(Ed,Td,Ld,"","\\ntriangleleft"),_d(Ed,Td,Ld,"","\\ntrianglelefteq",!0),_d(Ed,Td,Ld,"","\\subsetneq",!0),_d(Ed,Td,Ld,"","\\@varsubsetneq"),_d(Ed,Td,Ld,"","\\subsetneqq",!0),_d(Ed,Td,Ld,"","\\@varsubsetneqq"),_d(Ed,Td,Ld,"","\\ngtr",!0),_d(Ed,Td,Ld,"","\\@ngeqslant"),_d(Ed,Td,Ld,"","\\@ngeqq"),_d(Ed,Td,Ld,"","\\gneq",!0),_d(Ed,Td,Ld,"","\\gneqq",!0),_d(Ed,Td,Ld,"","\\@gvertneqq"),_d(Ed,Td,Ld,"","\\gnsim",!0),_d(Ed,Td,Ld,"","\\gnapprox",!0),_d(Ed,Td,Ld,"","\\nsucc",!0),_d(Ed,Td,Ld,"","\\nsucceq",!0),_d(Ed,Td,Ld,"","\\succnsim",!0),_d(Ed,Td,Ld,"","\\succnapprox",!0),_d(Ed,Td,Ld,"","\\ncong",!0),_d(Ed,Td,Ld,"","\\@nshortparallel"),_d(Ed,Td,Ld,"","\\nparallel",!0),_d(Ed,Td,Ld,"","\\nVDash",!0),_d(Ed,Td,Ld,"","\\ntriangleright"),_d(Ed,Td,Ld,"","\\ntrianglerighteq",!0),_d(Ed,Td,Ld,"","\\@nsupseteqq"),_d(Ed,Td,Ld,"","\\supsetneq",!0),_d(Ed,Td,Ld,"","\\@varsupsetneq"),_d(Ed,Td,Ld,"","\\supsetneqq",!0),_d(Ed,Td,Ld,"","\\@varsupsetneqq"),_d(Ed,Td,Ld,"","\\nVdash",!0),_d(Ed,Td,Ld,"","\\precneqq",!0),_d(Ed,Td,Ld,"","\\succneqq",!0),_d(Ed,Td,Ld,"","\\@nsubseteqq"),_d(Ed,Td,Ad,"","\\unlhd"),_d(Ed,Td,Ad,"","\\unrhd"),_d(Ed,Td,Ld,"","\\nleftarrow",!0),_d(Ed,Td,Ld,"","\\nrightarrow",!0),_d(Ed,Td,Ld,"","\\nLeftarrow",!0),_d(Ed,Td,Ld,"","\\nRightarrow",!0),_d(Ed,Td,Ld,"","\\nleftrightarrow",!0),_d(Ed,Td,Ld,"","\\nLeftrightarrow",!0),_d(Ed,Td,Ld,"","\\vartriangle"),_d(Ed,Td,Nd,"","\\hslash"),_d(Ed,Td,Nd,"","\\triangledown"),_d(Ed,Td,Nd,"","\\lozenge"),_d(Ed,Td,Nd,"","\\circledS"),_d(Ed,Td,Nd,"","\\circledR"),_d(kd,Td,Nd,"","\\circledR"),_d(Ed,Td,Nd,"","\\measuredangle",!0),_d(Ed,Td,Nd,"","\\nexists"),_d(Ed,Td,Nd,"","\\mho"),_d(Ed,Td,Nd,"","\\Finv",!0),_d(Ed,Td,Nd,"","\\Game",!0),_d(Ed,Td,Nd,"","\\backprime"),_d(Ed,Td,Nd,"","\\blacktriangle"),_d(Ed,Td,Nd,"","\\blacktriangledown"),_d(Ed,Td,Nd,"","\\blacksquare"),_d(Ed,Td,Nd,"","\\blacklozenge"),_d(Ed,Td,Nd,"","\\bigstar"),_d(Ed,Td,Nd,"","\\sphericalangle",!0),_d(Ed,Td,Nd,"","\\complement",!0),_d(Ed,Td,Nd,"","\\eth",!0),_d(kd,xd,Nd,"",""),_d(Ed,Td,Nd,"","\\diagup"),_d(Ed,Td,Nd,"","\\diagdown"),_d(Ed,Td,Nd,"","\\square"),_d(Ed,Td,Nd,"","\\Box"),_d(Ed,Td,Nd,"","\\Diamond"),_d(Ed,Td,Nd,"","\\yen",!0),_d(kd,Td,Nd,"","\\yen",!0),_d(Ed,Td,Nd,"","\\checkmark",!0),_d(kd,Td,Nd,"","\\checkmark"),_d(Ed,Td,Nd,"","\\beth",!0),_d(Ed,Td,Nd,"","\\daleth",!0),_d(Ed,Td,Nd,"","\\gimel",!0),_d(Ed,Td,Nd,"","\\digamma",!0),_d(Ed,Td,Nd,"","\\varkappa"),_d(Ed,Td,Md,"","\\@ulcorner",!0),_d(Ed,Td,Id,"","\\@urcorner",!0),_d(Ed,Td,Md,"","\\@llcorner",!0),_d(Ed,Td,Id,"","\\@lrcorner",!0),_d(Ed,Td,Ld,"","\\leqq",!0),_d(Ed,Td,Ld,"","\\leqslant",!0),_d(Ed,Td,Ld,"","\\eqslantless",!0),_d(Ed,Td,Ld,"","\\lesssim",!0),_d(Ed,Td,Ld,"","\\lessapprox",!0),_d(Ed,Td,Ld,"","\\approxeq",!0),_d(Ed,Td,Ad,"","\\lessdot"),_d(Ed,Td,Ld,"","\\lll",!0),_d(Ed,Td,Ld,"","\\lessgtr",!0),_d(Ed,Td,Ld,"","\\lesseqgtr",!0),_d(Ed,Td,Ld,"","\\lesseqqgtr",!0),_d(Ed,Td,Ld,"","\\doteqdot"),_d(Ed,Td,Ld,"","\\risingdotseq",!0),_d(Ed,Td,Ld,"","\\fallingdotseq",!0),_d(Ed,Td,Ld,"","\\backsim",!0),_d(Ed,Td,Ld,"","\\backsimeq",!0),_d(Ed,Td,Ld,"","\\subseteqq",!0),_d(Ed,Td,Ld,"","\\Subset",!0),_d(Ed,Td,Ld,"","\\sqsubset",!0),_d(Ed,Td,Ld,"","\\preccurlyeq",!0),_d(Ed,Td,Ld,"","\\curlyeqprec",!0),_d(Ed,Td,Ld,"","\\precsim",!0),_d(Ed,Td,Ld,"","\\precapprox",!0),_d(Ed,Td,Ld,"","\\vartriangleleft"),_d(Ed,Td,Ld,"","\\trianglelefteq"),_d(Ed,Td,Ld,"","\\vDash",!0),_d(Ed,Td,Ld,"","\\Vvdash",!0),_d(Ed,Td,Ld,"","\\smallsmile"),_d(Ed,Td,Ld,"","\\smallfrown"),_d(Ed,Td,Ld,"","\\bumpeq",!0),_d(Ed,Td,Ld,"","\\Bumpeq",!0),_d(Ed,Td,Ld,"","\\geqq",!0),_d(Ed,Td,Ld,"","\\geqslant",!0),_d(Ed,Td,Ld,"","\\eqslantgtr",!0),_d(Ed,Td,Ld,"","\\gtrsim",!0),_d(Ed,Td,Ld,"","\\gtrapprox",!0),_d(Ed,Td,Ad,"","\\gtrdot"),_d(Ed,Td,Ld,"","\\ggg",!0),_d(Ed,Td,Ld,"","\\gtrless",!0),_d(Ed,Td,Ld,"","\\gtreqless",!0),_d(Ed,Td,Ld,"","\\gtreqqless",!0),_d(Ed,Td,Ld,"","\\eqcirc",!0),_d(Ed,Td,Ld,"","\\circeq",!0),_d(Ed,Td,Ld,"","\\triangleq",!0),_d(Ed,Td,Ld,"","\\thicksim"),_d(Ed,Td,Ld,"","\\thickapprox"),_d(Ed,Td,Ld,"","\\supseteqq",!0),_d(Ed,Td,Ld,"","\\Supset",!0),_d(Ed,Td,Ld,"","\\sqsupset",!0),_d(Ed,Td,Ld,"","\\succcurlyeq",!0),_d(Ed,Td,Ld,"","\\curlyeqsucc",!0),_d(Ed,Td,Ld,"","\\succsim",!0),_d(Ed,Td,Ld,"","\\succapprox",!0),_d(Ed,Td,Ld,"","\\vartriangleright"),_d(Ed,Td,Ld,"","\\trianglerighteq"),_d(Ed,Td,Ld,"","\\Vdash",!0),_d(Ed,Td,Ld,"","\\shortmid"),_d(Ed,Td,Ld,"","\\shortparallel"),_d(Ed,Td,Ld,"","\\between",!0),_d(Ed,Td,Ld,"","\\pitchfork",!0),_d(Ed,Td,Ld,"","\\varpropto"),_d(Ed,Td,Ld,"","\\blacktriangleleft"),_d(Ed,Td,Ld,"","\\therefore",!0),_d(Ed,Td,Ld,"","\\backepsilon"),_d(Ed,Td,Ld,"","\\blacktriangleright"),_d(Ed,Td,Ld,"","\\because",!0),_d(Ed,Td,Ld,"","\\llless"),_d(Ed,Td,Ld,"","\\gggtr"),_d(Ed,Td,Ad,"","\\lhd"),_d(Ed,Td,Ad,"","\\rhd"),_d(Ed,Td,Ld,"","\\eqsim",!0),_d(Ed,xd,Ld,"","\\Join"),_d(Ed,Td,Ld,"","\\Doteq",!0),_d(Ed,Td,Ad,"","\\dotplus",!0),_d(Ed,Td,Ad,"","\\smallsetminus"),_d(Ed,Td,Ad,"","\\Cap",!0),_d(Ed,Td,Ad,"","\\Cup",!0),_d(Ed,Td,Ad,"","\\doublebarwedge",!0),_d(Ed,Td,Ad,"","\\boxminus",!0),_d(Ed,Td,Ad,"","\\boxplus",!0),_d(Ed,Td,Ad,"","\\divideontimes",!0),_d(Ed,Td,Ad,"","\\ltimes",!0),_d(Ed,Td,Ad,"","\\rtimes",!0),_d(Ed,Td,Ad,"","\\leftthreetimes",!0),_d(Ed,Td,Ad,"","\\rightthreetimes",!0),_d(Ed,Td,Ad,"","\\curlywedge",!0),_d(Ed,Td,Ad,"","\\curlyvee",!0),_d(Ed,Td,Ad,"","\\circleddash",!0),_d(Ed,Td,Ad,"","\\circledast",!0),_d(Ed,Td,Ad,"","\\centerdot"),_d(Ed,Td,Ad,"","\\intercal",!0),_d(Ed,Td,Ad,"","\\doublecap"),_d(Ed,Td,Ad,"","\\doublecup"),_d(Ed,Td,Ad,"","\\boxtimes",!0),_d(Ed,Td,Ld,"","\\dashrightarrow",!0),_d(Ed,Td,Ld,"","\\dashleftarrow",!0),_d(Ed,Td,Ld,"","\\leftleftarrows",!0),_d(Ed,Td,Ld,"","\\leftrightarrows",!0),_d(Ed,Td,Ld,"","\\Lleftarrow",!0),_d(Ed,Td,Ld,"","\\twoheadleftarrow",!0),_d(Ed,Td,Ld,"","\\leftarrowtail",!0),_d(Ed,Td,Ld,"","\\looparrowleft",!0),_d(Ed,Td,Ld,"","\\leftrightharpoons",!0),_d(Ed,Td,Ld,"","\\curvearrowleft",!0),_d(Ed,Td,Ld,"","\\circlearrowleft",!0),_d(Ed,Td,Ld,"","\\Lsh",!0),_d(Ed,Td,Ld,"","\\upuparrows",!0),_d(Ed,Td,Ld,"","\\upharpoonleft",!0),_d(Ed,Td,Ld,"","\\downharpoonleft",!0),_d(Ed,xd,Ld,"","\\origof",!0),_d(Ed,xd,Ld,"","\\imageof",!0),_d(Ed,Td,Ld,"","\\multimap",!0),_d(Ed,Td,Ld,"","\\leftrightsquigarrow",!0),_d(Ed,Td,Ld,"","\\rightrightarrows",!0),_d(Ed,Td,Ld,"","\\rightleftarrows",!0),_d(Ed,Td,Ld,"","\\twoheadrightarrow",!0),_d(Ed,Td,Ld,"","\\rightarrowtail",!0),_d(Ed,Td,Ld,"","\\looparrowright",!0),_d(Ed,Td,Ld,"","\\curvearrowright",!0),_d(Ed,Td,Ld,"","\\circlearrowright",!0),_d(Ed,Td,Ld,"","\\Rsh",!0),_d(Ed,Td,Ld,"","\\downdownarrows",!0),_d(Ed,Td,Ld,"","\\upharpoonright",!0),_d(Ed,Td,Ld,"","\\downharpoonright",!0),_d(Ed,Td,Ld,"","\\rightsquigarrow",!0),_d(Ed,Td,Ld,"","\\leadsto"),_d(Ed,Td,Ld,"","\\Rrightarrow",!0),_d(Ed,Td,Ld,"","\\restriction"),_d(Ed,xd,Nd,"","`"),_d(Ed,xd,Nd,"$","\\$"),_d(kd,xd,Nd,"$","\\$"),_d(kd,xd,Nd,"$","\\textdollar"),_d(Ed,xd,Nd,"%","\\%"),_d(kd,xd,Nd,"%","\\%"),_d(Ed,xd,Nd,"_","\\_"),_d(kd,xd,Nd,"_","\\_"),_d(kd,xd,Nd,"_","\\textunderscore"),_d(Ed,xd,Nd,"","\\angle",!0),_d(Ed,xd,Nd,"","\\infty",!0),_d(Ed,xd,Nd,"","\\prime"),_d(Ed,xd,Nd,"","\\triangle"),_d(Ed,xd,Nd,"","\\Gamma",!0),_d(Ed,xd,Nd,"","\\Delta",!0),_d(Ed,xd,Nd,"","\\Theta",!0),_d(Ed,xd,Nd,"","\\Lambda",!0),_d(Ed,xd,Nd,"","\\Xi",!0),_d(Ed,xd,Nd,"","\\Pi",!0),_d(Ed,xd,Nd,"","\\Sigma",!0),_d(Ed,xd,Nd,"","\\Upsilon",!0),_d(Ed,xd,Nd,"","\\Phi",!0),_d(Ed,xd,Nd,"","\\Psi",!0),_d(Ed,xd,Nd,"","\\Omega",!0),_d(Ed,xd,Nd,"A",""),_d(Ed,xd,Nd,"B",""),_d(Ed,xd,Nd,"E",""),_d(Ed,xd,Nd,"Z",""),_d(Ed,xd,Nd,"H",""),_d(Ed,xd,Nd,"I",""),_d(Ed,xd,Nd,"K",""),_d(Ed,xd,Nd,"M",""),_d(Ed,xd,Nd,"N",""),_d(Ed,xd,Nd,"O",""),_d(Ed,xd,Nd,"P",""),_d(Ed,xd,Nd,"T",""),_d(Ed,xd,Nd,"X",""),_d(Ed,xd,Nd,"","\\neg",!0),_d(Ed,xd,Nd,"","\\lnot"),_d(Ed,xd,Nd,"","\\top"),_d(Ed,xd,Nd,"","\\bot"),_d(Ed,xd,Nd,"","\\emptyset"),_d(Ed,Td,Nd,"","\\varnothing"),_d(Ed,xd,Pd,"","\\alpha",!0),_d(Ed,xd,Pd,"","\\beta",!0),_d(Ed,xd,Pd,"","\\gamma",!0),_d(Ed,xd,Pd,"","\\delta",!0),_d(Ed,xd,Pd,"","\\epsilon",!0),_d(Ed,xd,Pd,"","\\zeta",!0),_d(Ed,xd,Pd,"","\\eta",!0),_d(Ed,xd,Pd,"","\\theta",!0),_d(Ed,xd,Pd,"","\\iota",!0),_d(Ed,xd,Pd,"","\\kappa",!0),_d(Ed,xd,Pd,"","\\lambda",!0),_d(Ed,xd,Pd,"","\\mu",!0),_d(Ed,xd,Pd,"","\\nu",!0),_d(Ed,xd,Pd,"","\\xi",!0),_d(Ed,xd,Pd,"","\\omicron",!0),_d(Ed,xd,Pd,"","\\pi",!0),_d(Ed,xd,Pd,"","\\rho",!0),_d(Ed,xd,Pd,"","\\sigma",!0),_d(Ed,xd,Pd,"","\\tau",!0),_d(Ed,xd,Pd,"","\\upsilon",!0),_d(Ed,xd,Pd,"","\\phi",!0),_d(Ed,xd,Pd,"","\\chi",!0),_d(Ed,xd,Pd,"","\\psi",!0),_d(Ed,xd,Pd,"","\\omega",!0),_d(Ed,xd,Pd,"","\\varepsilon",!0),_d(Ed,xd,Pd,"","\\vartheta",!0),_d(Ed,xd,Pd,"","\\varpi",!0),_d(Ed,xd,Pd,"","\\varrho",!0),_d(Ed,xd,Pd,"","\\varsigma",!0),_d(Ed,xd,Pd,"","\\varphi",!0),_d(Ed,xd,Ad,"","*",!0),_d(Ed,xd,Ad,"+","+"),_d(Ed,xd,Ad,"","-",!0),_d(Ed,xd,Ad,"","\\cdot",!0),_d(Ed,xd,Ad,"","\\circ",!0),_d(Ed,xd,Ad,"","\\div",!0),_d(Ed,xd,Ad,"","\\pm",!0),_d(Ed,xd,Ad,"","\\times",!0),_d(Ed,xd,Ad,"","\\cap",!0),_d(Ed,xd,Ad,"","\\cup",!0),_d(Ed,xd,Ad,"","\\setminus",!0),_d(Ed,xd,Ad,"","\\land"),_d(Ed,xd,Ad,"","\\lor"),_d(Ed,xd,Ad,"","\\wedge",!0),_d(Ed,xd,Ad,"","\\vee",!0),_d(Ed,xd,Nd,"","\\surd"),_d(Ed,xd,Md,"","\\langle",!0),_d(Ed,xd,Md,"","\\lvert"),_d(Ed,xd,Md,"","\\lVert"),_d(Ed,xd,Id,"?","?"),_d(Ed,xd,Id,"!","!"),_d(Ed,xd,Id,"","\\rangle",!0),_d(Ed,xd,Id,"","\\rvert"),_d(Ed,xd,Id,"","\\rVert"),_d(Ed,xd,Ld,"=","="),_d(Ed,xd,Ld,":",":"),_d(Ed,xd,Ld,"","\\approx",!0),_d(Ed,xd,Ld,"","\\cong",!0),_d(Ed,xd,Ld,"","\\ge"),_d(Ed,xd,Ld,"","\\geq",!0),_d(Ed,xd,Ld,"","\\gets"),_d(Ed,xd,Ld,">","\\gt",!0),_d(Ed,xd,Ld,"","\\in",!0),_d(Ed,xd,Ld,"","\\@not"),_d(Ed,xd,Ld,"","\\subset",!0),_d(Ed,xd,Ld,"","\\supset",!0),_d(Ed,xd,Ld,"","\\subseteq",!0),_d(Ed,xd,Ld,"","\\supseteq",!0),_d(Ed,Td,Ld,"","\\nsubseteq",!0),_d(Ed,Td,Ld,"","\\nsupseteq",!0),_d(Ed,xd,Ld,"","\\models"),_d(Ed,xd,Ld,"","\\leftarrow",!0),_d(Ed,xd,Ld,"","\\le"),_d(Ed,xd,Ld,"","\\leq",!0),_d(Ed,xd,Ld,"<","\\lt",!0),_d(Ed,xd,Ld,"","\\rightarrow",!0),_d(Ed,xd,Ld,"","\\to"),_d(Ed,Td,Ld,"","\\ngeq",!0),_d(Ed,Td,Ld,"","\\nleq",!0),_d(Ed,xd,Fd,"","\\ "),_d(Ed,xd,Fd,"","\\space"),_d(Ed,xd,Fd,"","\\nobreakspace"),_d(kd,xd,Fd,"","\\ "),_d(kd,xd,Fd,""," "),_d(kd,xd,Fd,"","\\space"),_d(kd,xd,Fd,"","\\nobreakspace"),_d(Ed,xd,Fd,null,"\\nobreak"),_d(Ed,xd,Fd,null,"\\allowbreak"),_d(Ed,xd,Dd,",",","),_d(Ed,xd,Dd,";",";"),_d(Ed,Td,Ad,"","\\barwedge",!0),_d(Ed,Td,Ad,"","\\veebar",!0),_d(Ed,xd,Ad,"","\\odot",!0),_d(Ed,xd,Ad,"","\\oplus",!0),_d(Ed,xd,Ad,"","\\otimes",!0),_d(Ed,xd,Nd,"","\\partial",!0),_d(Ed,xd,Ad,"","\\oslash",!0),_d(Ed,Td,Ad,"","\\circledcirc",!0),_d(Ed,Td,Ad,"","\\boxdot",!0),_d(Ed,xd,Ad,"","\\bigtriangleup"),_d(Ed,xd,Ad,"","\\bigtriangledown"),_d(Ed,xd,Ad,"","\\dagger"),_d(Ed,xd,Ad,"","\\diamond"),_d(Ed,xd,Ad,"","\\star"),_d(Ed,xd,Ad,"","\\triangleleft"),_d(Ed,xd,Ad,"","\\triangleright"),_d(Ed,xd,Md,"{","\\{"),_d(kd,xd,Nd,"{","\\{"),_d(kd,xd,Nd,"{","\\textbraceleft"),_d(Ed,xd,Id,"}","\\}"),_d(kd,xd,Nd,"}","\\}"),_d(kd,xd,Nd,"}","\\textbraceright"),_d(Ed,xd,Md,"{","\\lbrace"),_d(Ed,xd,Id,"}","\\rbrace"),_d(Ed,xd,Md,"[","\\lbrack",!0),_d(kd,xd,Nd,"[","\\lbrack",!0),_d(Ed,xd,Id,"]","\\rbrack",!0),_d(kd,xd,Nd,"]","\\rbrack",!0),_d(Ed,xd,Md,"(","\\lparen",!0),_d(Ed,xd,Id,")","\\rparen",!0),_d(kd,xd,Nd,"<","\\textless",!0),_d(kd,xd,Nd,">","\\textgreater",!0),_d(Ed,xd,Md,"","\\lfloor",!0),_d(Ed,xd,Id,"","\\rfloor",!0),_d(Ed,xd,Md,"","\\lceil",!0),_d(Ed,xd,Id,"","\\rceil",!0),_d(Ed,xd,Nd,"\\","\\backslash"),_d(Ed,xd,Nd,"","|"),_d(Ed,xd,Nd,"","\\vert"),_d(kd,xd,Nd,"|","\\textbar",!0),_d(Ed,xd,Nd,"","\\|"),_d(Ed,xd,Nd,"","\\Vert"),_d(kd,xd,Nd,"","\\textbardbl"),_d(kd,xd,Nd,"~","\\textasciitilde"),_d(kd,xd,Nd,"\\","\\textbackslash"),_d(kd,xd,Nd,"^","\\textasciicircum"),_d(Ed,xd,Ld,"","\\uparrow",!0),_d(Ed,xd,Ld,"","\\Uparrow",!0),_d(Ed,xd,Ld,"","\\downarrow",!0),_d(Ed,xd,Ld,"","\\Downarrow",!0),_d(Ed,xd,Ld,"","\\updownarrow",!0),_d(Ed,xd,Ld,"","\\Updownarrow",!0),_d(Ed,xd,Od,"","\\coprod"),_d(Ed,xd,Od,"","\\bigvee"),_d(Ed,xd,Od,"","\\bigwedge"),_d(Ed,xd,Od,"","\\biguplus"),_d(Ed,xd,Od,"","\\bigcap"),_d(Ed,xd,Od,"","\\bigcup"),_d(Ed,xd,Od,"","\\int"),_d(Ed,xd,Od,"","\\intop"),_d(Ed,xd,Od,"","\\iint"),_d(Ed,xd,Od,"","\\iiint"),_d(Ed,xd,Od,"","\\prod"),_d(Ed,xd,Od,"","\\sum"),_d(Ed,xd,Od,"","\\bigotimes"),_d(Ed,xd,Od,"","\\bigoplus"),_d(Ed,xd,Od,"","\\bigodot"),_d(Ed,xd,Od,"","\\oint"),_d(Ed,xd,Od,"","\\oiint"),_d(Ed,xd,Od,"","\\oiiint"),_d(Ed,xd,Od,"","\\bigsqcup"),_d(Ed,xd,Od,"","\\smallint"),_d(kd,xd,Rd,"","\\textellipsis"),_d(Ed,xd,Rd,"","\\mathellipsis"),_d(kd,xd,Rd,"","\\ldots",!0),_d(Ed,xd,Rd,"","\\ldots",!0),_d(Ed,xd,Rd,"","\\@cdots",!0),_d(Ed,xd,Rd,"","\\ddots",!0),_d(Ed,xd,Nd,"","\\varvdots"),_d(Ed,xd,Cd,"","\\acute"),_d(Ed,xd,Cd,"","\\grave"),_d(Ed,xd,Cd,"","\\ddot"),_d(Ed,xd,Cd,"~","\\tilde"),_d(Ed,xd,Cd,"","\\bar"),_d(Ed,xd,Cd,"","\\breve"),_d(Ed,xd,Cd,"","\\check"),_d(Ed,xd,Cd,"^","\\hat"),_d(Ed,xd,Cd,"","\\vec"),_d(Ed,xd,Cd,"","\\dot"),_d(Ed,xd,Cd,"","\\mathring"),_d(Ed,xd,Pd,"","\\@imath"),_d(Ed,xd,Pd,"","\\@jmath"),_d(Ed,xd,Nd,"",""),_d(Ed,xd,Nd,"",""),_d(kd,xd,Nd,"","\\i",!0),_d(kd,xd,Nd,"","\\j",!0),_d(kd,xd,Nd,"","\\ss",!0),_d(kd,xd,Nd,"","\\ae",!0),_d(kd,xd,Nd,"","\\oe",!0),_d(kd,xd,Nd,"","\\o",!0),_d(kd,xd,Nd,"","\\AE",!0),_d(kd,xd,Nd,"","\\OE",!0),_d(kd,xd,Nd,"","\\O",!0),_d(kd,xd,Cd,"","\\'"),_d(kd,xd,Cd,"","\\`"),_d(kd,xd,Cd,"","\\^"),_d(kd,xd,Cd,"","\\~"),_d(kd,xd,Cd,"","\\="),_d(kd,xd,Cd,"","\\u"),_d(kd,xd,Cd,"","\\."),_d(kd,xd,Cd,"","\\c"),_d(kd,xd,Cd,"","\\r"),_d(kd,xd,Cd,"","\\v"),_d(kd,xd,Cd,"",'\\"'),_d(kd,xd,Cd,"","\\H"),_d(kd,xd,Cd,"","\\textcircled");var jd={"--":!0,"---":!0,"``":!0,"''":!0};_d(kd,xd,Nd,"","--",!0),_d(kd,xd,Nd,"","\\textendash"),_d(kd,xd,Nd,"","---",!0),_d(kd,xd,Nd,"","\\textemdash"),_d(kd,xd,Nd,"","`",!0),_d(kd,xd,Nd,"","\\textquoteleft"),_d(kd,xd,Nd,"","'",!0),_d(kd,xd,Nd,"","\\textquoteright"),_d(kd,xd,Nd,"","``",!0),_d(kd,xd,Nd,"","\\textquotedblleft"),_d(kd,xd,Nd,"","''",!0),_d(kd,xd,Nd,"","\\textquotedblright"),_d(Ed,xd,Nd,"","\\degree",!0),_d(kd,xd,Nd,"","\\degree"),_d(kd,xd,Nd,"","\\textdegree",!0),_d(Ed,xd,Nd,"","\\pounds"),_d(Ed,xd,Nd,"","\\mathsterling",!0),_d(kd,xd,Nd,"","\\pounds"),_d(kd,xd,Nd,"","\\textsterling",!0),_d(Ed,Td,Nd,"","\\maltese"),_d(kd,Td,Nd,"","\\maltese");for(var Bd='0123456789/@."',Ud=0;Ud<Bd.length;Ud++){var qd=Bd.charAt(Ud);_d(Ed,xd,Nd,qd,qd)}for(var zd='0123456789!@*()-=+";:?/.,',Vd=0;Vd<zd.length;Vd++){var Kd=zd.charAt(Vd);_d(kd,xd,Nd,Kd,Kd)}for(var Hd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Wd=0;Wd<Hd.length;Wd++){var $d=Hd.charAt(Wd);_d(Ed,xd,Pd,$d,$d),_d(kd,xd,Nd,$d,$d)}_d(Ed,Td,Nd,"C",""),_d(kd,Td,Nd,"C",""),_d(Ed,Td,Nd,"H",""),_d(kd,Td,Nd,"H",""),_d(Ed,Td,Nd,"N",""),_d(kd,Td,Nd,"N",""),_d(Ed,Td,Nd,"P",""),_d(kd,Td,Nd,"P",""),_d(Ed,Td,Nd,"Q",""),_d(kd,Td,Nd,"Q",""),_d(Ed,Td,Nd,"R",""),_d(kd,Td,Nd,"R",""),_d(Ed,Td,Nd,"Z",""),_d(kd,Td,Nd,"Z",""),_d(Ed,xd,Pd,"h",""),_d(kd,xd,Pd,"h","");for(var Gd="",Yd=0;Yd<Hd.length;Yd++){var Xd=Hd.charAt(Yd);_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56320+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56372+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56424+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56580+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56736+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56788+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56840+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56944+Yd)),_d(kd,xd,Nd,Xd,Gd),Yd<26&&(_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56632+Yd)),_d(kd,xd,Nd,Xd,Gd),_d(Ed,xd,Pd,Xd,Gd=String.fromCharCode(55349,56476+Yd)),_d(kd,xd,Nd,Xd,Gd))}_d(Ed,xd,Pd,"k",Gd=String.fromCharCode(55349,56668)),_d(kd,xd,Nd,"k",Gd);for(var Zd=0;Zd<10;Zd++){var Jd=Zd.toString();_d(Ed,xd,Pd,Jd,Gd=String.fromCharCode(55349,57294+Zd)),_d(kd,xd,Nd,Jd,Gd),_d(Ed,xd,Pd,Jd,Gd=String.fromCharCode(55349,57314+Zd)),_d(kd,xd,Nd,Jd,Gd),_d(Ed,xd,Pd,Jd,Gd=String.fromCharCode(55349,57324+Zd)),_d(kd,xd,Nd,Jd,Gd),_d(Ed,xd,Pd,Jd,Gd=String.fromCharCode(55349,57334+Zd)),_d(kd,xd,Nd,Jd,Gd)}for(var Qd="",eh=0;eh<Qd.length;eh++){var th=Qd.charAt(eh);_d(Ed,xd,Pd,th,th),_d(kd,xd,Nd,th,th)}var nh=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["","",""],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],ih=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],rh=function(e,t,n){return Sd[n][e]&&Sd[n][e].replace&&(e=Sd[n][e].replace),{value:e,metrics:Yc(e,t,n)}},sh=function(e,t,n,i,r){var s,o=rh(e,t,n),a=o.metrics;if(e=o.value,a){var l=a.italic;("text"===n||i&&"mathit"===i.font)&&(l=0),s=new md(e,a.height,a.depth,l,a.skew,a.width,r)}else"undefined"!=typeof console&&console.warn("No character metrics for '"+e+"' in style '"+t+"' and mode '"+n+"'"),s=new md(e,0,0,0,0,0,r);if(i){s.maxFontSize=i.sizeMultiplier,i.style.isTight()&&s.classes.push("mtight");var c=i.getColor();c&&(s.style.color=c)}return s},oh=(e,t)=>{if(od(e.classes)!==od(t.classes)||e.skew!==t.skew||e.maxFontSize!==t.maxFontSize)return!1;if(1===e.classes.length){var n=e.classes[0];if("mbin"===n||"mord"===n)return!1}for(var i in e.style)if(e.style.hasOwnProperty(i)&&e.style[i]!==t.style[i])return!1;for(var r in t.style)if(t.style.hasOwnProperty(r)&&e.style[r]!==t.style[r])return!1;return!0},ah=function(e){for(var t=0,n=0,i=0,r=0;r<e.children.length;r++){var s=e.children[r];s.height>t&&(t=s.height),s.depth>n&&(n=s.depth),s.maxFontSize>i&&(i=s.maxFontSize)}e.height=t,e.depth=n,e.maxFontSize=i},lh=function(e,t,n,i){var r=new dd(e,t,n,i);return ah(r),r},ch=(e,t,n,i)=>new dd(e,t,n,i),dh=function(e){var t=new Hc(e);return ah(t),t},hh=function(e,t,n){var i="";switch(e){case"amsrm":i="AMS";break;case"textrm":i="Main";break;case"textsf":i="SansSerif";break;case"texttt":i="Typewriter";break;default:i=e}return i+"-"+("textbf"===t&&"textit"===n?"BoldItalic":"textbf"===t?"Bold":"textit"===t?"Italic":"Regular")},uh={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},ph={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},mh={fontMap:uh,makeSymbol:sh,mathsym:function(e,t,n,i){return void 0===i&&(i=[]),"boldsymbol"===n.font&&rh(e,"Main-Bold",t).metrics?sh(e,"Main-Bold",t,n,i.concat(["mathbf"])):"\\"===e||"main"===Sd[t][e].font?sh(e,"Main-Regular",t,n,i):sh(e,"AMS-Regular",t,n,i.concat(["amsrm"]))},makeSpan:lh,makeSvgSpan:ch,makeLineSpan:function(e,t,n){var i=lh([e],[],t);return i.height=Math.max(n||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),i.style.borderBottomWidth=sd(i.height),i.maxFontSize=1,i},makeAnchor:function(e,t,n,i){var r=new hd(e,t,n,i);return ah(r),r},makeFragment:dh,wrapFragment:function(e,t){return e instanceof Hc?lh([],[e],t):e},makeVList:function(e,t){for(var{children:n,depth:i}=function(e){if("individualShift"===e.positionType){for(var t=e.children,n=[t[0]],i=-t[0].shift-t[0].elem.depth,r=i,s=1;s<t.length;s++){var o=-t[s].shift-r-t[s].elem.depth,a=o-(t[s-1].elem.height+t[s-1].elem.depth);r+=o,n.push({type:"kern",size:a}),n.push(t[s])}return{children:n,depth:i}}var l;if("top"===e.positionType){for(var c=e.positionData,d=0;d<e.children.length;d++){var h=e.children[d];c-="kern"===h.type?h.size:h.elem.height+h.elem.depth}l=c}else if("bottom"===e.positionType)l=-e.positionData;else{var u=e.children[0];if("elem"!==u.type)throw new Error('First child must have type "elem".');if("shift"===e.positionType)l=-u.elem.depth-e.positionData;else{if("firstBaseline"!==e.positionType)throw new Error("Invalid positionType "+e.positionType+".");l=-u.elem.depth}}return{children:e.children,depth:l}}(e),r=0,s=0;s<n.length;s++){var o=n[s];if("elem"===o.type){var a=o.elem;r=Math.max(r,a.maxFontSize,a.height)}}r+=2;var l=lh(["pstrut"],[]);l.style.height=sd(r);for(var c=[],d=i,h=i,u=i,p=0;p<n.length;p++){var m=n[p];if("kern"===m.type)u+=m.size;else{var g=m.elem,f=m.wrapperClasses||[],v=m.wrapperStyle||{},y=lh(f,[l,g],void 0,v);y.style.top=sd(-r-u-g.depth),m.marginLeft&&(y.style.marginLeft=m.marginLeft),m.marginRight&&(y.style.marginRight=m.marginRight),c.push(y),u+=g.height+g.depth}d=Math.min(d,u),h=Math.max(h,u)}var b,w=lh(["vlist"],c);if(w.style.height=sd(h),d<0){var S=lh([],[]),_=lh(["vlist"],[S]);_.style.height=sd(-d);var E=lh(["vlist-s"],[new md("")]);b=[lh(["vlist-r"],[w,E]),lh(["vlist-r"],[_])]}else b=[lh(["vlist-r"],[w])];var k=lh(["vlist-t"],b);return 2===b.length&&k.classes.push("vlist-t2"),k.height=h,k.depth=-d,k},makeOrd:function(e,t,n){var i=e.mode,r=e.text,s=["mord"],o="math"===i||"text"===i&&t.font,a=o?t.font:t.fontFamily;if(55349===r.charCodeAt(0)){var[l,c]=function(e,t){var n=1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536,i="math"===t?0:1;if(119808<=n&&n<120484){var r=Math.floor((n-119808)/26);return[nh[r][2],nh[r][i]]}if(120782<=n&&n<=120831){var s=Math.floor((n-120782)/10);return[ih[s][2],ih[s][i]]}if(120485===n||120486===n)return[nh[0][2],nh[0][i]];if(120486<n&&n<120782)return["",""];throw new vc("Unsupported character: "+e)}(r,i);return sh(r,l,i,t,s.concat(c))}if(a){var d,h;if("boldsymbol"===a){var u=function(e,t,n,i,r){return"textord"!==r&&rh(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}}(r,i,0,0,n);d=u.fontName,h=[u.fontClass]}else o?(d=uh[a].fontName,h=[a]):(d=hh(a,t.fontWeight,t.fontShape),h=[a,t.fontWeight,t.fontShape]);if(rh(r,d,i).metrics)return sh(r,d,i,t,s.concat(h));if(jd.hasOwnProperty(r)&&"Typewriter"===d.substr(0,10)){for(var p=[],m=0;m<r.length;m++)p.push(sh(r[m],d,i,t,s.concat(h)));return dh(p)}}if("mathord"===n)return sh(r,"Math-Italic",i,t,s.concat(["mathnormal"]));if("textord"===n){var g=Sd[i][r]&&Sd[i][r].font;if("ams"===g){var f=hh("amsrm",t.fontWeight,t.fontShape);return sh(r,f,i,t,s.concat("amsrm",t.fontWeight,t.fontShape))}if("main"!==g&&g){var v=hh(g,t.fontWeight,t.fontShape);return sh(r,v,i,t,s.concat(v,t.fontWeight,t.fontShape))}var y=hh("textrm",t.fontWeight,t.fontShape);return sh(r,y,i,t,s.concat(t.fontWeight,t.fontShape))}throw new Error("unexpected type: "+n+" in makeOrd")},makeGlue:(e,t)=>{var n=lh(["mspace"],[],t),i=rd(e,t);return n.style.marginRight=sd(i),n},staticSvg:function(e,t){var[n,i,r]=ph[e],s=new fd(n),o=new gd([s],{width:sd(i),height:sd(r),style:"width:"+sd(i),viewBox:"0 0 "+1e3*i+" "+1e3*r,preserveAspectRatio:"xMinYMin"}),a=ch(["overlay"],[o],t);return a.height=r,a.style.height=sd(r),a.style.width=sd(i),a},svgData:ph,tryCombineChars:e=>{for(var t=0;t<e.length-1;t++){var n=e[t],i=e[t+1];n instanceof md&&i instanceof md&&oh(n,i)&&(n.text+=i.text,n.height=Math.max(n.height,i.height),n.depth=Math.max(n.depth,i.depth),n.italic=i.italic,e.splice(t+1,1),t--)}return e}},gh={number:3,unit:"mu"},fh={number:4,unit:"mu"},vh={number:5,unit:"mu"},yh={mord:{mop:gh,mbin:fh,mrel:vh,minner:gh},mop:{mord:gh,mop:gh,mrel:vh,minner:gh},mbin:{mord:fh,mop:fh,mopen:fh,minner:fh},mrel:{mord:vh,mop:vh,mopen:vh,minner:vh},mopen:{},mclose:{mop:gh,mbin:fh,mrel:vh,minner:gh},mpunct:{mord:gh,mop:gh,mrel:vh,mopen:gh,mclose:gh,mpunct:gh,minner:gh},minner:{mord:gh,mop:gh,mbin:fh,mrel:vh,mopen:gh,mpunct:gh,minner:gh}},bh={mord:{mop:gh},mop:{mord:gh,mop:gh},mbin:{},mrel:{},mopen:{},mclose:{mop:gh},mpunct:{},minner:{mop:gh}},wh={},Sh={},_h={};function Eh(e){for(var{type:t,names:n,props:i,handler:r,htmlBuilder:s,mathmlBuilder:o}=e,a={type:t,numArgs:i.numArgs,argTypes:i.argTypes,allowedInArgument:!!i.allowedInArgument,allowedInText:!!i.allowedInText,allowedInMath:void 0===i.allowedInMath||i.allowedInMath,numOptionalArgs:i.numOptionalArgs||0,infix:!!i.infix,primitive:!!i.primitive,handler:r},l=0;l<n.length;++l)wh[n[l]]=a;t&&(s&&(Sh[t]=s),o&&(_h[t]=o))}function kh(e){var{type:t,htmlBuilder:n,mathmlBuilder:i}=e;Eh({type:t,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:i})}var xh=function(e){return"ordgroup"===e.type&&1===e.body.length?e.body[0]:e},Th=function(e){return"ordgroup"===e.type?e.body:[e]},Ch=mh.makeSpan,Ah=["leftmost","mbin","mopen","mrel","mop","mpunct"],Ih=["rightmost","mrel","mclose","mpunct"],Rh={display:Uc.DISPLAY,text:Uc.TEXT,script:Uc.SCRIPT,scriptscript:Uc.SCRIPTSCRIPT},Ph={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Oh=function(e,t,n,i){void 0===i&&(i=[null,null]);for(var r=[],s=0;s<e.length;s++){var o=jh(e[s],t);if(o instanceof Hc){var a=o.children;r.push(...a)}else r.push(o)}if(mh.tryCombineChars(r),!n)return r;var l=t;if(1===e.length){var c=e[0];"sizing"===c.type?l=t.havingSize(c.size):"styling"===c.type&&(l=t.havingStyle(Rh[c.style]))}var d=Ch([i[0]||"leftmost"],[],t),h=Ch([i[1]||"rightmost"],[],t),u="root"===n;return Mh(r,((e,t)=>{var n=t.classes[0],i=e.classes[0];"mbin"===n&&_c(Ih,i)?t.classes[0]="mord":"mbin"===i&&_c(Ah,n)&&(e.classes[0]="mord")}),{node:d},h,u),Mh(r,((e,t)=>{var n=Fh(t),i=Fh(e),r=n&&i?e.hasClass("mtight")?bh[n][i]:yh[n][i]:null;if(r)return mh.makeGlue(r,l)}),{node:d},h,u),r},Mh=function e(t,n,i,r,s){r&&t.push(r);for(var o=0;o<t.length;o++){var a=t[o],l=Dh(a);if(l)e(l.children,n,i,null,s);else{var c=!a.hasClass("mspace");if(c){var d=n(a,i.node);d&&(i.insertAfter?i.insertAfter(d):(t.unshift(d),o++))}c?i.node=a:s&&a.hasClass("newline")&&(i.node=Ch(["leftmost"])),i.insertAfter=(e=>n=>{t.splice(e+1,0,n),o++})(o)}}r&&t.pop()},Dh=function(e){return e instanceof Hc||e instanceof hd||e instanceof dd&&e.hasClass("enclosing")?e:null},Lh=function e(t,n){var i=Dh(t);if(i){var r=i.children;if(r.length){if("right"===n)return e(r[r.length-1],"right");if("left"===n)return e(r[0],"left")}}return t},Fh=function(e,t){return e?(t&&(e=Lh(e,t)),Ph[e.classes[0]]||null):null},Nh=function(e,t){var n=["nulldelimiter"].concat(e.baseSizingClasses());return Ch(t.concat(n))},jh=function(e,t,n){if(!e)return Ch();if(Sh[e.type]){var i=Sh[e.type](e,t);if(n&&t.size!==n.size){i=Ch(t.sizingClasses(n),[i],t);var r=t.sizeMultiplier/n.sizeMultiplier;i.height*=r,i.depth*=r}return i}throw new vc("Got group of unknown type: '"+e.type+"'")};function Bh(e,t){var n=Ch(["base"],e,t),i=Ch(["strut"]);return i.style.height=sd(n.height+n.depth),n.depth&&(i.style.verticalAlign=sd(-n.depth)),n.children.unshift(i),n}function Uh(e,t){var n=null;1===e.length&&"tag"===e[0].type&&(n=e[0].tag,e=e[0].body);var i,r=Oh(e,t,"root");2===r.length&&r[1].hasClass("tag")&&(i=r.pop());for(var s,o=[],a=[],l=0;l<r.length;l++)if(a.push(r[l]),r[l].hasClass("mbin")||r[l].hasClass("mrel")||r[l].hasClass("allowbreak")){for(var c=!1;l<r.length-1&&r[l+1].hasClass("mspace")&&!r[l+1].hasClass("newline");)l++,a.push(r[l]),r[l].hasClass("nobreak")&&(c=!0);c||(o.push(Bh(a,t)),a=[])}else r[l].hasClass("newline")&&(a.pop(),a.length>0&&(o.push(Bh(a,t)),a=[]),o.push(r[l]));a.length>0&&o.push(Bh(a,t)),n?((s=Bh(Oh(n,t,!0))).classes=["tag"],o.push(s)):i&&o.push(i);var d=Ch(["katex-html"],o);if(d.setAttribute("aria-hidden","true"),s){var h=s.children[0];h.style.height=sd(d.height+d.depth),d.depth&&(h.style.verticalAlign=sd(-d.depth))}return d}function qh(e){return new Hc(e)}class zh{constructor(e,t,n){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=n||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=od(this.classes));for(var n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=kc(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+kc(od(this.classes))+'"'),e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+"</"+this.type+">"}toText(){return this.children.map((e=>e.toText())).join("")}}class Vh{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return kc(this.toText())}toText(){return this.text}}var Kh={MathNode:zh,TextNode:Vh,SpaceNode:class{constructor(e){this.width=void 0,this.character=void 0,this.width=e,this.character=e>=.05555&&e<=.05556?"":e>=.1666&&e<=.1667?"":e>=.2222&&e<=.2223?"":e>=.2777&&e<=.2778?"":e>=-.05556&&e<=-.05555?"":e>=-.1667&&e<=-.1666?"":e>=-.2223&&e<=-.2222?"":e>=-.2778&&e<=-.2777?"":null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",sd(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+sd(this.width)+'"/>'}toText(){return this.character?this.character:" "}},newDocumentFragment:qh},Hh=function(e,t,n){return!Sd[t][e]||!Sd[t][e].replace||55349===e.charCodeAt(0)||jd.hasOwnProperty(e)&&n&&(n.fontFamily&&"tt"===n.fontFamily.substr(4,2)||n.font&&"tt"===n.font.substr(4,2))||(e=Sd[t][e].replace),new Kh.TextNode(e)},Wh=function(e){return 1===e.length?e[0]:new Kh.MathNode("mrow",e)},$h=function(e,t){if("texttt"===t.fontFamily)return"monospace";if("textsf"===t.fontFamily)return"textit"===t.fontShape&&"textbf"===t.fontWeight?"sans-serif-bold-italic":"textit"===t.fontShape?"sans-serif-italic":"textbf"===t.fontWeight?"bold-sans-serif":"sans-serif";if("textit"===t.fontShape&&"textbf"===t.fontWeight)return"bold-italic";if("textit"===t.fontShape)return"italic";if("textbf"===t.fontWeight)return"bold";var n=t.font;if(!n||"mathnormal"===n)return null;var i=e.mode;if("mathit"===n)return"italic";if("boldsymbol"===n)return"textord"===e.type?"bold":"bold-italic";if("mathbf"===n)return"bold";if("mathbb"===n)return"double-struck";if("mathfrak"===n)return"fraktur";if("mathscr"===n||"mathcal"===n)return"script";if("mathsf"===n)return"sans-serif";if("mathtt"===n)return"monospace";var r=e.text;return _c(["\\imath","\\jmath"],r)?null:(Sd[i][r]&&Sd[i][r].replace&&(r=Sd[i][r].replace),Yc(r,mh.fontMap[n].fontName,i)?mh.fontMap[n].variant:null)},Gh=function(e,t,n){if(1===e.length){var i=Xh(e[0],t);return n&&i instanceof zh&&"mo"===i.type&&(i.setAttribute("lspace","0em"),i.setAttribute("rspace","0em")),[i]}for(var r,s=[],o=0;o<e.length;o++){var a=Xh(e[o],t);if(a instanceof zh&&r instanceof zh){if("mtext"===a.type&&"mtext"===r.type&&a.getAttribute("mathvariant")===r.getAttribute("mathvariant")){r.children.push(...a.children);continue}if("mn"===a.type&&"mn"===r.type){r.children.push(...a.children);continue}if("mi"===a.type&&1===a.children.length&&"mn"===r.type){var l=a.children[0];if(l instanceof Vh&&"."===l.text){r.children.push(...a.children);continue}}else if("mi"===r.type&&1===r.children.length){var c=r.children[0];if(c instanceof Vh&&""===c.text&&("mo"===a.type||"mi"===a.type||"mn"===a.type)){var d=a.children[0];d instanceof Vh&&d.text.length>0&&(d.text=d.text.slice(0,1)+""+d.text.slice(1),s.pop())}}}s.push(a),r=a}return s},Yh=function(e,t,n){return Wh(Gh(e,t,n))},Xh=function(e,t){if(!e)return new Kh.MathNode("mrow");if(_h[e.type])return _h[e.type](e,t);throw new vc("Got group of unknown type: '"+e.type+"'")};function Zh(e,t,n,i,r){var s,o=Gh(e,n);s=1===o.length&&o[0]instanceof zh&&_c(["mrow","mtable"],o[0].type)?o[0]:new Kh.MathNode("mrow",o);var a=new Kh.MathNode("annotation",[new Kh.TextNode(t)]);a.setAttribute("encoding","application/x-tex");var l=new Kh.MathNode("semantics",[s,a]),c=new Kh.MathNode("math",[l]);return c.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),i&&c.setAttribute("display","block"),mh.makeSpan([r?"katex":"katex-mathml"],[c])}var Jh=function(e){return new ed({style:e.displayMode?Uc.DISPLAY:Uc.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},Qh=function(e,t){if(t.displayMode){var n=["katex-display"];t.leqno&&n.push("leqno"),t.fleqn&&n.push("fleqn"),e=mh.makeSpan(n,[e])}return e},eu={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},tu={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},nu=function(e){var t=new Kh.MathNode("mo",[new Kh.TextNode(eu[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},iu=function(e,t){var{span:n,minWidth:i,height:r}=function(){var n=4e5,i=e.label.substr(1);if(_c(["widehat","widecheck","widetilde","utilde"],i)){var r,s,o,a="ordgroup"===(p=e.base).type?p.body.length:1;if(a>5)"widehat"===i||"widecheck"===i?(r=420,n=2364,o=.42,s=i+"4"):(r=312,n=2340,o=.34,s="tilde4");else{var l=[1,1,2,2,3,3][a];"widehat"===i||"widecheck"===i?(n=[0,1062,2364,2364,2364][l],r=[0,239,300,360,420][l],o=[0,.24,.3,.3,.36,.42][l],s=i+l):(n=[0,600,1033,2339,2340][l],r=[0,260,286,306,312][l],o=[0,.26,.286,.3,.306,.34][l],s="tilde"+l)}var c=new fd(s),d=new gd([c],{width:"100%",height:sd(o),viewBox:"0 0 "+n+" "+r,preserveAspectRatio:"none"});return{span:mh.makeSvgSpan([],[d],t),minWidth:0,height:o}}var h,u,p,m=[],g=tu[i],[f,v,y]=g,b=y/1e3,w=f.length;if(1===w)h=["hide-tail"],u=[g[3]];else if(2===w)h=["halfarrow-left","halfarrow-right"],u=["xMinYMin","xMaxYMin"];else{if(3!==w)throw new Error("Correct katexImagesData or update code here to support\n                    "+w+" children.");h=["brace-left","brace-center","brace-right"],u=["xMinYMin","xMidYMin","xMaxYMin"]}for(var S=0;S<w;S++){var _=new fd(f[S]),E=new gd([_],{width:"400em",height:sd(b),viewBox:"0 0 "+n+" "+y,preserveAspectRatio:u[S]+" slice"}),k=mh.makeSvgSpan([h[S]],[E],t);if(1===w)return{span:k,minWidth:v,height:b};k.style.height=sd(b),m.push(k)}return{span:mh.makeSpan(["stretchy"],m,t),minWidth:v,height:b}}();return n.height=r,n.style.height=sd(r),i>0&&(n.style.minWidth=sd(i)),n};function ru(e,t){if(!e||e.type!==t)throw new Error("Expected node of type "+t+", but got "+(e?"node of type "+e.type:String(e)));return e}function su(e){var t=ou(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return t}function ou(e){return e&&("atom"===e.type||wd.hasOwnProperty(e.type))?e:null}var au=(e,t)=>{var n,i,r;e&&"supsub"===e.type?(n=(i=ru(e.base,"accent")).base,e.base=n,r=function(e){if(e instanceof dd)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}(jh(e,t)),e.base=i):n=(i=ru(e,"accent")).base;var s=jh(n,t.havingCrampedStyle()),o=0;if(i.isShifty&&Cc(n)){var a=Tc(n);o=yd(jh(a,t.havingCrampedStyle())).skew}var l,c="\\c"===i.label,d=c?s.height+s.depth:Math.min(s.height,t.fontMetrics().xHeight);if(i.isStretchy)l=iu(i,t),l=mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"elem",elem:l,wrapperClasses:["svg-align"],wrapperStyle:o>0?{width:"calc(100% - "+sd(2*o)+")",marginLeft:sd(2*o)}:void 0}]},t);else{var h,u;"\\vec"===i.label?(h=mh.staticSvg("vec",t),u=mh.svgData.vec[1]):((h=yd(h=mh.makeOrd({mode:i.mode,text:i.label},t,"textord"))).italic=0,u=h.width,c&&(d+=h.depth)),l=mh.makeSpan(["accent-body"],[h]);var p="\\textcircled"===i.label;p&&(l.classes.push("accent-full"),d=s.height);var m=o;p||(m-=u/2),l.style.left=sd(m),"\\textcircled"===i.label&&(l.style.top=".2em"),l=mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:-d},{type:"elem",elem:l}]},t)}var g=mh.makeSpan(["mord","accent"],[l],t);return r?(r.children[0]=g,r.height=Math.max(g.height,r.height),r.classes[0]="mord",r):g},lu=(e,t)=>{var n=e.isStretchy?nu(e.label):new Kh.MathNode("mo",[Hh(e.label,e.mode)]),i=new Kh.MathNode("mover",[Xh(e.base,t),n]);return i.setAttribute("accent","true"),i},cu=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map((e=>"\\"+e)).join("|"));Eh({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{var n=xh(t[0]),i=!cu.test(e.funcName),r=!i||"\\widehat"===e.funcName||"\\widetilde"===e.funcName||"\\widecheck"===e.funcName;return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:i,isShifty:r,base:n}},htmlBuilder:au,mathmlBuilder:lu}),Eh({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,t)=>{var n=t[0],i=e.parser.mode;return"math"===i&&(e.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+e.funcName+" works only in text mode"),i="text"),{type:"accent",mode:i,label:e.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:au,mathmlBuilder:lu}),Eh({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:i}=e,r=t[0];return{type:"accentUnder",mode:n.mode,label:i,base:r}},htmlBuilder:(e,t)=>{var n=jh(e.base,t),i=iu(e,t),r="\\utilde"===e.label?.12:0,s=mh.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:i,wrapperClasses:["svg-align"]},{type:"kern",size:r},{type:"elem",elem:n}]},t);return mh.makeSpan(["mord","accentunder"],[s],t)},mathmlBuilder:(e,t)=>{var n=nu(e.label),i=new Kh.MathNode("munder",[Xh(e.base,t),n]);return i.setAttribute("accentunder","true"),i}});var du=e=>{var t=new Kh.MathNode("mpadded",e?[e]:[]);return t.setAttribute("width","+0.6em"),t.setAttribute("lspace","0.3em"),t};Eh({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:i,funcName:r}=e;return{type:"xArrow",mode:i.mode,label:r,body:t[0],below:n[0]}},htmlBuilder(e,t){var n,i=t.style,r=t.havingStyle(i.sup()),s=mh.wrapFragment(jh(e.body,r,t),t),o="\\x"===e.label.slice(0,2)?"x":"cd";s.classes.push(o+"-arrow-pad"),e.below&&(r=t.havingStyle(i.sub()),(n=mh.wrapFragment(jh(e.below,r,t),t)).classes.push(o+"-arrow-pad"));var a,l=iu(e,t),c=-t.fontMetrics().axisHeight+.5*l.height,d=-t.fontMetrics().axisHeight-.5*l.height-.111;if((s.depth>.25||"\\xleftequilibrium"===e.label)&&(d-=s.depth),n){var h=-t.fontMetrics().axisHeight+n.height+.5*l.height+.111;a=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:d},{type:"elem",elem:l,shift:c},{type:"elem",elem:n,shift:h}]},t)}else a=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:d},{type:"elem",elem:l,shift:c}]},t);return a.children[0].children[0].children[1].classes.push("svg-align"),mh.makeSpan(["mrel","x-arrow"],[a],t)},mathmlBuilder(e,t){var n,i=nu(e.label);if(i.setAttribute("minsize","x"===e.label.charAt(0)?"1.75em":"3.0em"),e.body){var r=du(Xh(e.body,t));if(e.below){var s=du(Xh(e.below,t));n=new Kh.MathNode("munderover",[i,s,r])}else n=new Kh.MathNode("mover",[i,r])}else if(e.below){var o=du(Xh(e.below,t));n=new Kh.MathNode("munder",[i,o])}else n=du(),n=new Kh.MathNode("mover",[i,n]);return n}});var hu={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},uu=e=>"textord"===e.type&&"@"===e.text;function pu(e,t,n){var i=hu[e];switch(i){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(i,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":var r={type:"atom",text:i,mode:"math",family:"rel"},s={type:"ordgroup",mode:"math",body:[n.callFunction("\\\\cdleft",[t[0]],[]),n.callFunction("\\Big",[r],[]),n.callFunction("\\\\cdright",[t[1]],[])]};return n.callFunction("\\\\cdparent",[s],[]);case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":return n.callFunction("\\Big",[{type:"textord",text:"\\Vert",mode:"math"}],[]);default:return{type:"textord",text:" ",mode:"math"}}}Eh({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:i}=e;return{type:"cdlabel",mode:n.mode,side:i.slice(4),label:t[0]}},htmlBuilder(e,t){var n=t.havingStyle(t.style.sup()),i=mh.wrapFragment(jh(e.label,n,t),t);return i.classes.push("cd-label-"+e.side),i.style.bottom=sd(.8-i.depth),i.height=0,i.depth=0,i},mathmlBuilder(e,t){var n=new Kh.MathNode("mrow",[Xh(e.label,t)]);return(n=new Kh.MathNode("mpadded",[n])).setAttribute("width","0"),"left"===e.side&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),(n=new Kh.MathNode("mstyle",[n])).setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}}),Eh({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(e,t){var{parser:n}=e;return{type:"cdlabelparent",mode:n.mode,fragment:t[0]}},htmlBuilder(e,t){var n=mh.wrapFragment(jh(e.fragment,t),t);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder:(e,t)=>new Kh.MathNode("mrow",[Xh(e.fragment,t)])}),Eh({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(e,t){for(var{parser:n}=e,i=ru(t[0],"ordgroup").body,r="",s=0;s<i.length;s++)r+=ru(i[s],"textord").text;var o,a=parseInt(r);if(isNaN(a))throw new vc("\\@char has non-numeric argument "+r);if(a<0||a>=1114111)throw new vc("\\@char with invalid code point "+r);return a<=65535?o=String.fromCharCode(a):(a-=65536,o=String.fromCharCode(55296+(a>>10),56320+(1023&a))),{type:"textord",mode:n.mode,text:o}}});var mu=(e,t)=>{var n=Oh(e.body,t.withColor(e.color),!1);return mh.makeFragment(n)},gu=(e,t)=>{var n=Gh(e.body,t.withColor(e.color)),i=new Kh.MathNode("mstyle",n);return i.setAttribute("mathcolor",e.color),i};Eh({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(e,t){var{parser:n}=e,i=ru(t[0],"color-token").color,r=t[1];return{type:"color",mode:n.mode,color:i,body:Th(r)}},htmlBuilder:mu,mathmlBuilder:gu}),Eh({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(e,t){var{parser:n,breakOnTokenText:i}=e,r=ru(t[0],"color-token").color;n.gullet.macros.set("\\current@color",r);var s=n.parseExpression(!0,i);return{type:"color",mode:n.mode,color:r,body:s}},htmlBuilder:mu,mathmlBuilder:gu}),Eh({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:1,argTypes:["size"],allowedInText:!0},handler(e,t,n){var{parser:i}=e,r=n[0],s=!i.settings.displayMode||!i.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:i.mode,newLine:s,size:r&&ru(r,"size").value}},htmlBuilder(e,t){var n=mh.makeSpan(["mspace"],[],t);return e.newLine&&(n.classes.push("newline"),e.size&&(n.style.marginTop=sd(rd(e.size,t)))),n},mathmlBuilder(e,t){var n=new Kh.MathNode("mspace");return e.newLine&&(n.setAttribute("linebreak","newline"),e.size&&n.setAttribute("height",sd(rd(e.size,t)))),n}});var fu={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},vu=e=>{var t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new vc("Expected a control sequence",e);return t},yu=(e,t,n,i)=>{var r=e.gullet.macros.get(n.text);null==r&&(n.noexpand=!0,r={tokens:[n],numArgs:0,unexpandable:!e.gullet.isExpandable(n.text)}),e.gullet.macros.set(t,r,i)};Eh({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t,funcName:n}=e;t.consumeSpaces();var i=t.fetch();if(fu[i.text])return"\\global"!==n&&"\\\\globallong"!==n||(i.text=fu[i.text]),ru(t.parseFunction(),"internal");throw new vc("Invalid token after macro prefix",i)}}),Eh({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,i=t.gullet.popToken(),r=i.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(r))throw new vc("Expected a control sequence",i);for(var s,o=0,a=[[]];"{"!==t.gullet.future().text;)if("#"===(i=t.gullet.popToken()).text){if("{"===t.gullet.future().text){s=t.gullet.future(),a[o].push("{");break}if(i=t.gullet.popToken(),!/^[1-9]$/.test(i.text))throw new vc('Invalid argument number "'+i.text+'"');if(parseInt(i.text)!==o+1)throw new vc('Argument number "'+i.text+'" out of order');o++,a.push([])}else{if("EOF"===i.text)throw new vc("Expected a macro definition");a[o].push(i.text)}var{tokens:l}=t.gullet.consumeArg();return s&&l.unshift(s),"\\edef"!==n&&"\\xdef"!==n||(l=t.gullet.expandTokens(l)).reverse(),t.gullet.macros.set(r,{tokens:l,numArgs:o,delimiters:a},n===fu[n]),{type:"internal",mode:t.mode}}}),Eh({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,i=vu(t.gullet.popToken());t.gullet.consumeSpaces();var r=(e=>{var t=e.gullet.popToken();return"="===t.text&&" "===(t=e.gullet.popToken()).text&&(t=e.gullet.popToken()),t})(t);return yu(t,i,r,"\\\\globallet"===n),{type:"internal",mode:t.mode}}}),Eh({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,i=vu(t.gullet.popToken()),r=t.gullet.popToken(),s=t.gullet.popToken();return yu(t,i,s,"\\\\globalfuture"===n),t.gullet.pushToken(s),t.gullet.pushToken(r),{type:"internal",mode:t.mode}}});var bu=function(e,t,n){var i=Yc(Sd.math[e]&&Sd.math[e].replace||e,t,n);if(!i)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return i},wu=function(e,t,n,i){var r=n.havingBaseStyle(t),s=mh.makeSpan(i.concat(r.sizingClasses(n)),[e],n),o=r.sizeMultiplier/n.sizeMultiplier;return s.height*=o,s.depth*=o,s.maxFontSize=r.sizeMultiplier,s},Su=function(e,t,n){var i=t.havingBaseStyle(n),r=(1-t.sizeMultiplier/i.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=sd(r),e.height-=r,e.depth+=r},_u=function(e,t,n,i,r,s){var o=function(e,t,n,i){return mh.makeSymbol(e,"Size"+t+"-Regular",n,i)}(e,t,r,i),a=wu(mh.makeSpan(["delimsizing","size"+t],[o],i),Uc.TEXT,i,s);return n&&Su(a,i,Uc.TEXT),a},Eu=function(e,t,n){return{type:"elem",elem:mh.makeSpan(["delimsizinginner","Size1-Regular"===t?"delim-size1":"delim-size4"],[mh.makeSpan([],[mh.makeSymbol(e,t,n)])])}},ku=function(e,t,n){var i=Wc["Size4-Regular"][e.charCodeAt(0)]?Wc["Size4-Regular"][e.charCodeAt(0)][4]:Wc["Size1-Regular"][e.charCodeAt(0)][4],r=new fd("inner",function(e,t){switch(e){case"":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145zM367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z";case"":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257zM478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z";default:return""}}(e,Math.round(1e3*t))),s=new gd([r],{width:sd(i),height:sd(t),style:"width:"+sd(i),viewBox:"0 0 "+1e3*i+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),o=mh.makeSvgSpan([],[s],n);return o.height=t,o.style.height=sd(t),o.style.width=sd(i),{type:"elem",elem:o}},xu={type:"kern",size:-.008},Tu=["|","\\lvert","\\rvert","\\vert"],Cu=["\\|","\\lVert","\\rVert","\\Vert"],Au=function(e,t,n,i,r,s){var o,a,l,c;o=l=c=e,a=null;var d="Size1-Regular";"\\uparrow"===e?l=c="":"\\Uparrow"===e?l=c="":"\\downarrow"===e?o=l="":"\\Downarrow"===e?o=l="":"\\updownarrow"===e?(o="\\uparrow",l="",c="\\downarrow"):"\\Updownarrow"===e?(o="\\Uparrow",l="",c="\\Downarrow"):_c(Tu,e)?l="":_c(Cu,e)?l="":"["===e||"\\lbrack"===e?(o="",l="",c="",d="Size4-Regular"):"]"===e||"\\rbrack"===e?(o="",l="",c="",d="Size4-Regular"):"\\lfloor"===e||""===e?(l=o="",c="",d="Size4-Regular"):"\\lceil"===e||""===e?(o="",l=c="",d="Size4-Regular"):"\\rfloor"===e||""===e?(l=o="",c="",d="Size4-Regular"):"\\rceil"===e||""===e?(o="",l=c="",d="Size4-Regular"):"("===e||"\\lparen"===e?(o="",l="",c="",d="Size4-Regular"):")"===e||"\\rparen"===e?(o="",l="",c="",d="Size4-Regular"):"\\{"===e||"\\lbrace"===e?(o="",a="",c="",l="",d="Size4-Regular"):"\\}"===e||"\\rbrace"===e?(o="",a="",c="",l="",d="Size4-Regular"):"\\lgroup"===e||""===e?(o="",c="",l="",d="Size4-Regular"):"\\rgroup"===e||""===e?(o="",c="",l="",d="Size4-Regular"):"\\lmoustache"===e||""===e?(o="",c="",l="",d="Size4-Regular"):"\\rmoustache"!==e&&""!==e||(o="",c="",l="",d="Size4-Regular");var h=bu(o,d,r),u=h.height+h.depth,p=bu(l,d,r),m=p.height+p.depth,g=bu(c,d,r),f=g.height+g.depth,v=0,y=1;if(null!==a){var b=bu(a,d,r);v=b.height+b.depth,y=2}var w=u+f+v,S=w+Math.max(0,Math.ceil((t-w)/(y*m)))*y*m,_=i.fontMetrics().axisHeight;n&&(_*=i.sizeMultiplier);var E=S/2-_,k=[];if(k.push(Eu(c,d,r)),k.push(xu),null===a){var x=S-u-f+.016;k.push(ku(l,x,i))}else{var T=(S-u-f-v)/2+.016;k.push(ku(l,T,i)),k.push(xu),k.push(Eu(a,d,r)),k.push(xu),k.push(ku(l,T,i))}k.push(xu),k.push(Eu(o,d,r));var C=i.havingBaseStyle(Uc.TEXT),A=mh.makeVList({positionType:"bottom",positionData:E,children:k},C);return wu(mh.makeSpan(["delimsizing","mult"],[A],C),Uc.TEXT,i,s)},Iu=.08,Ru=function(e,t,n,i,r){var s=function(e,t,n){t*=1e3;var i="";switch(e){case"sqrtMain":i=function(e,t){return"M95,"+(622+e+80)+"\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl"+e/2.075+" -"+e+"\nc5.3,-9.3,12,-14,20,-14\nH400000v"+(40+e)+"H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM"+(834+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize1":i=function(e,t){return"M263,"+(601+e+80)+"c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl"+e/2.084+" -"+e+"\nc4.7,-7.3,11,-11,19,-11\nH40000v"+(40+e)+"H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM"+(1001+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize2":i=function(e,t){return"M983 "+(10+e+80)+"\nl"+e/3.13+" -"+e+"\nc4,-6.7,10,-10,18,-10 H400000v"+(40+e)+"\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM"+(1001+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize3":i=function(e,t){return"M424,"+(2398+e+80)+"\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl"+e/4.223+" -"+e+"c4,-6.7,10,-10,18,-10 H400000\nv"+(40+e)+"H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M"+(1001+e)+" 80\nh400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize4":i=function(e,t){return"M473,"+(2713+e+80)+"\nc339.3,-1799.3,509.3,-2700,510,-2702 l"+e/5.298+" -"+e+"\nc3.3,-7.3,9.3,-11,18,-11 H400000v"+(40+e)+"H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM"+(1001+e)+" 80h400000v"+(40+e)+"H1017.7z"}(t);break;case"sqrtTall":i=function(e,t,n){return"M702 "+(e+80)+"H400000"+(40+e)+"\nH742v"+(n-54-80-e)+"l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1\nh-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170\nc-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667\n219 661 l218 661zM702 80H400000v"+(40+e)+"H742z"}(t,0,n)}return i}(e,i,n),o=new fd(e,s),a=new gd([o],{width:"400em",height:sd(t),viewBox:"0 0 400000 "+n,preserveAspectRatio:"xMinYMin slice"});return mh.makeSvgSpan(["hide-tail"],[a],r)},Pu=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],Ou=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],Mu=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Du=[0,1.2,1.8,2.4,3],Lu=[{type:"small",style:Uc.SCRIPTSCRIPT},{type:"small",style:Uc.SCRIPT},{type:"small",style:Uc.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],Fu=[{type:"small",style:Uc.SCRIPTSCRIPT},{type:"small",style:Uc.SCRIPT},{type:"small",style:Uc.TEXT},{type:"stack"}],Nu=[{type:"small",style:Uc.SCRIPTSCRIPT},{type:"small",style:Uc.SCRIPT},{type:"small",style:Uc.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],ju=function(e){if("small"===e.type)return"Main-Regular";if("large"===e.type)return"Size"+e.size+"-Regular";if("stack"===e.type)return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},Bu=function(e,t,n,i){for(var r=Math.min(2,3-i.style.size);r<n.length&&"stack"!==n[r].type;r++){var s=bu(e,ju(n[r]),"math"),o=s.height+s.depth;if("small"===n[r].type&&(o*=i.havingBaseStyle(n[r].style).sizeMultiplier),o>t)return n[r]}return n[n.length-1]},Uu=function(e,t,n,i,r,s){var o;"<"===e||"\\lt"===e||""===e?e="\\langle":">"!==e&&"\\gt"!==e&&""!==e||(e="\\rangle"),o=_c(Mu,e)?Lu:_c(Pu,e)?Nu:Fu;var a=Bu(e,t,o,i);return"small"===a.type?function(e,t,n,i,r,s){var o=mh.makeSymbol(e,"Main-Regular",r,i),a=wu(o,t,i,s);return n&&Su(a,i,t),a}(e,a.style,n,i,r,s):"large"===a.type?_u(e,a.size,n,i,r,s):Au(e,t,n,i,r,s)},qu={sqrtImage:function(e,t){var n,i,r=t.havingBaseSizing(),s=Bu("\\surd",e*r.sizeMultiplier,Nu,r),o=r.sizeMultiplier,a=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),l=0,c=0,d=0;return"small"===s.type?(e<1?o=1:e<1.4&&(o=.7),c=(1+a)/o,(n=Ru("sqrtMain",l=(1+a+Iu)/o,d=1e3+1e3*a+80,a,t)).style.minWidth="0.853em",i=.833/o):"large"===s.type?(d=1080*Du[s.size],c=(Du[s.size]+a)/o,l=(Du[s.size]+a+Iu)/o,(n=Ru("sqrtSize"+s.size,l,d,a,t)).style.minWidth="1.02em",i=1/o):(l=e+a+Iu,c=e+a,d=Math.floor(1e3*e+a)+80,(n=Ru("sqrtTall",l,d,a,t)).style.minWidth="0.742em",i=1.056),n.height=c,n.style.height=sd(l),{span:n,advanceWidth:i,ruleWidth:(t.fontMetrics().sqrtRuleThickness+a)*o}},sizedDelim:function(e,t,n,i,r){if("<"===e||"\\lt"===e||""===e?e="\\langle":">"!==e&&"\\gt"!==e&&""!==e||(e="\\rangle"),_c(Pu,e)||_c(Mu,e))return _u(e,t,!1,n,i,r);if(_c(Ou,e))return Au(e,Du[t],!1,n,i,r);throw new vc("Illegal delimiter: '"+e+"'")},sizeToMaxHeight:Du,customSizedDelim:Uu,leftRightDelim:function(e,t,n,i,r,s){var o=i.fontMetrics().axisHeight*i.sizeMultiplier,a=5/i.fontMetrics().ptPerEm,l=Math.max(t-o,n+o),c=Math.max(l/500*901,2*l-a);return Uu(e,c,!0,i,r,s)}},zu={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},Vu=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function Ku(e,t){var n=ou(e);if(n&&_c(Vu,n.text))return n;throw new vc(n?"Invalid delimiter '"+n.text+"' after '"+t.funcName+"'":"Invalid delimiter type '"+e.type+"'",e)}function Hu(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}Eh({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{var n=Ku(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:zu[e.funcName].size,mclass:zu[e.funcName].mclass,delim:n.text}},htmlBuilder:(e,t)=>"."===e.delim?mh.makeSpan([e.mclass]):qu.sizedDelim(e.delim,e.size,t,e.mode,[e.mclass]),mathmlBuilder:e=>{var t=[];"."!==e.delim&&t.push(Hh(e.delim,e.mode));var n=new Kh.MathNode("mo",t);"mopen"===e.mclass||"mclose"===e.mclass?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var i=sd(qu.sizeToMaxHeight[e.size]);return n.setAttribute("minsize",i),n.setAttribute("maxsize",i),n}}),Eh({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=e.parser.gullet.macros.get("\\current@color");if(n&&"string"!=typeof n)throw new vc("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:Ku(t[0],e).text,color:n}}}),Eh({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Ku(t[0],e),i=e.parser;++i.leftrightDepth;var r=i.parseExpression(!1);--i.leftrightDepth,i.expect("\\right",!1);var s=ru(i.parseFunction(),"leftright-right");return{type:"leftright",mode:i.mode,body:r,left:n.text,right:s.delim,rightColor:s.color}},htmlBuilder:(e,t)=>{Hu(e);for(var n,i,r=Oh(e.body,t,!0,["mopen","mclose"]),s=0,o=0,a=!1,l=0;l<r.length;l++)r[l].isMiddle?a=!0:(s=Math.max(r[l].height,s),o=Math.max(r[l].depth,o));if(s*=t.sizeMultiplier,o*=t.sizeMultiplier,n="."===e.left?Nh(t,["mopen"]):qu.leftRightDelim(e.left,s,o,t,e.mode,["mopen"]),r.unshift(n),a)for(var c=1;c<r.length;c++){var d=r[c].isMiddle;d&&(r[c]=qu.leftRightDelim(d.delim,s,o,d.options,e.mode,[]))}if("."===e.right)i=Nh(t,["mclose"]);else{var h=e.rightColor?t.withColor(e.rightColor):t;i=qu.leftRightDelim(e.right,s,o,h,e.mode,["mclose"])}return r.push(i),mh.makeSpan(["minner"],r,t)},mathmlBuilder:(e,t)=>{Hu(e);var n=Gh(e.body,t);if("."!==e.left){var i=new Kh.MathNode("mo",[Hh(e.left,e.mode)]);i.setAttribute("fence","true"),n.unshift(i)}if("."!==e.right){var r=new Kh.MathNode("mo",[Hh(e.right,e.mode)]);r.setAttribute("fence","true"),e.rightColor&&r.setAttribute("mathcolor",e.rightColor),n.push(r)}return Wh(n)}}),Eh({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Ku(t[0],e);if(!e.parser.leftrightDepth)throw new vc("\\middle without preceding \\left",n);return{type:"middle",mode:e.parser.mode,delim:n.text}},htmlBuilder:(e,t)=>{var n;if("."===e.delim)n=Nh(t,[]);else{n=qu.sizedDelim(e.delim,1,t,e.mode,[]);var i={delim:e.delim,options:t};n.isMiddle=i}return n},mathmlBuilder:(e,t)=>{var n="\\vert"===e.delim||"|"===e.delim?Hh("|","text"):Hh(e.delim,e.mode),i=new Kh.MathNode("mo",[n]);return i.setAttribute("fence","true"),i.setAttribute("lspace","0.05em"),i.setAttribute("rspace","0.05em"),i}});var Wu=(e,t)=>{var n,i,r,s=mh.wrapFragment(jh(e.body,t),t),o=e.label.substr(1),a=t.sizeMultiplier,l=0,c=Cc(e.body);if("sout"===o)(n=mh.makeSpan(["stretchy","sout"])).height=t.fontMetrics().defaultRuleThickness/a,l=-.5*t.fontMetrics().xHeight;else if("phase"===o){var d=rd({number:.6,unit:"pt"},t),h=rd({number:.35,unit:"ex"},t);a/=t.havingBaseSizing().sizeMultiplier;var u=s.height+s.depth+d+h;s.style.paddingLeft=sd(u/2+d);var p=Math.floor(1e3*u*a),m="M400000 "+(r=p)+" H0 L"+r/2+" 0 l65 45 L145 "+(r-80)+" H400000z",g=new gd([new fd("phase",m)],{width:"400em",height:sd(p/1e3),viewBox:"0 0 400000 "+p,preserveAspectRatio:"xMinYMin slice"});(n=mh.makeSvgSpan(["hide-tail"],[g],t)).style.height=sd(u),l=s.depth+d+h}else{/cancel/.test(o)?c||s.classes.push("cancel-pad"):"angl"===o?s.classes.push("anglpad"):s.classes.push("boxpad");var f=0,v=0,y=0;/box/.test(o)?(y=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness),v=f=t.fontMetrics().fboxsep+("colorbox"===o?0:y)):"angl"===o?(f=4*(y=Math.max(t.fontMetrics().defaultRuleThickness,t.minRuleThickness)),v=Math.max(0,.25-s.depth)):v=f=c?.2:0,n=function(e,t,n,i,r){var s,o=e.height+e.depth+n+i;if(/fbox|color|angl/.test(t)){if(s=mh.makeSpan(["stretchy",t],[],r),"fbox"===t){var a=r.color&&r.getColor();a&&(s.style.borderColor=a)}}else{var l=[];/^[bx]cancel$/.test(t)&&l.push(new vd({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&l.push(new vd({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var c=new gd(l,{width:"100%",height:sd(o)});s=mh.makeSvgSpan([],[c],r)}return s.height=o,s.style.height=sd(o),s}(s,o,f,v,t),/fbox|boxed|fcolorbox/.test(o)?(n.style.borderStyle="solid",n.style.borderWidth=sd(y)):"angl"===o&&.049!==y&&(n.style.borderTopWidth=sd(y),n.style.borderRightWidth=sd(y)),l=s.depth+v,e.backgroundColor&&(n.style.backgroundColor=e.backgroundColor,e.borderColor&&(n.style.borderColor=e.borderColor))}if(e.backgroundColor)i=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:l},{type:"elem",elem:s,shift:0}]},t);else{var b=/cancel|phase/.test(o)?["svg-align"]:[];i=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:0},{type:"elem",elem:n,shift:l,wrapperClasses:b}]},t)}return/cancel/.test(o)&&(i.height=s.height,i.depth=s.depth),/cancel/.test(o)&&!c?mh.makeSpan(["mord","cancel-lap"],[i],t):mh.makeSpan(["mord"],[i],t)},$u=(e,t)=>{var n=0,i=new Kh.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Xh(e.body,t)]);switch(e.label){case"\\cancel":i.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":i.setAttribute("notation","downdiagonalstrike");break;case"\\phase":i.setAttribute("notation","phasorangle");break;case"\\sout":i.setAttribute("notation","horizontalstrike");break;case"\\fbox":i.setAttribute("notation","box");break;case"\\angl":i.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=t.fontMetrics().fboxsep*t.fontMetrics().ptPerEm,i.setAttribute("width","+"+2*n+"pt"),i.setAttribute("height","+"+2*n+"pt"),i.setAttribute("lspace",n+"pt"),i.setAttribute("voffset",n+"pt"),"\\fcolorbox"===e.label){var r=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness);i.setAttribute("style","border: "+r+"em solid "+String(e.borderColor))}break;case"\\xcancel":i.setAttribute("notation","updiagonalstrike downdiagonalstrike")}return e.backgroundColor&&i.setAttribute("mathbackground",e.backgroundColor),i};Eh({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(e,t,n){var{parser:i,funcName:r}=e,s=ru(t[0],"color-token").color,o=t[1];return{type:"enclose",mode:i.mode,label:r,backgroundColor:s,body:o}},htmlBuilder:Wu,mathmlBuilder:$u}),Eh({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(e,t,n){var{parser:i,funcName:r}=e,s=ru(t[0],"color-token").color,o=ru(t[1],"color-token").color,a=t[2];return{type:"enclose",mode:i.mode,label:r,backgroundColor:o,borderColor:s,body:a}},htmlBuilder:Wu,mathmlBuilder:$u}),Eh({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\fbox",body:t[0]}}}),Eh({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:i}=e,r=t[0];return{type:"enclose",mode:n.mode,label:i,body:r}},htmlBuilder:Wu,mathmlBuilder:$u}),Eh({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\angl",body:t[0]}}});var Gu={};function Yu(e){for(var{type:t,names:n,props:i,handler:r,htmlBuilder:s,mathmlBuilder:o}=e,a={type:t,numArgs:i.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:r},l=0;l<n.length;++l)Gu[n[l]]=a;s&&(Sh[t]=s),o&&(_h[t]=o)}var Xu={};function Zu(e,t){Xu[e]=t}function Ju(e){var t=[];e.consumeSpaces();for(var n=e.fetch().text;"\\hline"===n||"\\hdashline"===n;)e.consume(),t.push("\\hdashline"===n),e.consumeSpaces(),n=e.fetch().text;return t}var Qu=e=>{if(!e.parser.settings.displayMode)throw new vc("{"+e.envName+"} can be used only in display mode.")};function ep(e){if(-1===e.indexOf("ed"))return-1===e.indexOf("*")}function tp(e,t,n){var{hskipBeforeAndAfter:i,addJot:r,cols:s,arraystretch:o,colSeparationType:a,autoTag:l,singleRow:c,emptySingleRow:d,maxNumCols:h,leqno:u}=t;if(e.gullet.beginGroup(),c||e.gullet.macros.set("\\cr","\\\\\\relax"),!o){var p=e.gullet.expandMacroAsText("\\arraystretch");if(null==p)o=1;else if(!(o=parseFloat(p))||o<0)throw new vc("Invalid \\arraystretch: "+p)}e.gullet.beginGroup();var m=[],g=[m],f=[],v=[],y=null!=l?[]:void 0;function b(){l&&e.gullet.macros.set("\\@eqnsw","1",!0)}function w(){y&&(e.gullet.macros.get("\\df@tag")?(y.push(e.subparse([new fc("\\df@tag")])),e.gullet.macros.set("\\df@tag",void 0,!0)):y.push(Boolean(l)&&"1"===e.gullet.macros.get("\\@eqnsw")))}for(b(),v.push(Ju(e));;){var S=e.parseExpression(!1,c?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),S={type:"ordgroup",mode:e.mode,body:S},n&&(S={type:"styling",mode:e.mode,style:n,body:[S]}),m.push(S);var _=e.fetch().text;if("&"===_){if(h&&m.length===h){if(c||a)throw new vc("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else{if("\\end"===_){w(),1===m.length&&"styling"===S.type&&0===S.body[0].body.length&&(g.length>1||!d)&&g.pop(),v.length<g.length+1&&v.push([]);break}if("\\\\"!==_)throw new vc("Expected & or \\\\ or \\cr or \\end",e.nextToken);e.consume();var E=void 0;" "!==e.gullet.future().text&&(E=e.parseSizeGroup(!0)),f.push(E?E.value:null),w(),v.push(Ju(e)),m=[],g.push(m),b()}}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:r,arraystretch:o,body:g,cols:s,rowGaps:f,hskipBeforeAndAfter:i,hLinesBeforeRow:v,colSeparationType:a,tags:y,leqno:u}}function np(e){return"d"===e.substr(0,1)?"display":"text"}var ip=function(e,t){var n,i,r=e.body.length,s=e.hLinesBeforeRow,o=0,a=new Array(r),l=[],c=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),d=1/t.fontMetrics().ptPerEm,h=5*d;e.colSeparationType&&"small"===e.colSeparationType&&(h=t.havingStyle(Uc.SCRIPT).sizeMultiplier/t.sizeMultiplier*.2778);var u="CD"===e.colSeparationType?rd({number:3,unit:"ex"},t):12*d,p=3*d,m=e.arraystretch*u,g=.7*m,f=.3*m,v=0;function y(e){for(var t=0;t<e.length;++t)t>0&&(v+=.25),l.push({pos:v,isDashed:e[t]})}for(y(s[0]),n=0;n<e.body.length;++n){var b=e.body[n],w=g,S=f;o<b.length&&(o=b.length);var _=new Array(b.length);for(i=0;i<b.length;++i){var E=jh(b[i],t);S<E.depth&&(S=E.depth),w<E.height&&(w=E.height),_[i]=E}var k=e.rowGaps[n],x=0;k&&(x=rd(k,t))>0&&(S<(x+=f)&&(S=x),x=0),e.addJot&&(S+=p),_.height=w,_.depth=S,v+=w,_.pos=v,v+=S+x,a[n]=_,y(s[n+1])}var T,C,A=v/2+t.fontMetrics().axisHeight,I=e.cols||[],R=[],P=[];if(e.tags&&e.tags.some((e=>e)))for(n=0;n<r;++n){var O=a[n],M=O.pos-A,D=e.tags[n],L=void 0;(L=!0===D?mh.makeSpan(["eqn-num"],[],t):mh.makeSpan([],!1===D?[]:Oh(D,t,!0),t)).depth=O.depth,L.height=O.height,P.push({type:"elem",elem:L,shift:M})}for(i=0,C=0;i<o||C<I.length;++i,++C){for(var F=I[C]||{},N=!0;"separator"===F.type;){if(N||((T=mh.makeSpan(["arraycolsep"],[])).style.width=sd(t.fontMetrics().doubleRuleSep),R.push(T)),"|"!==F.separator&&":"!==F.separator)throw new vc("Invalid separator type: "+F.separator);var j="|"===F.separator?"solid":"dashed",B=mh.makeSpan(["vertical-separator"],[],t);B.style.height=sd(v),B.style.borderRightWidth=sd(c),B.style.borderRightStyle=j,B.style.margin="0 "+sd(-c/2);var U=v-A;U&&(B.style.verticalAlign=sd(-U)),R.push(B),F=I[++C]||{},N=!1}if(!(i>=o)){var q=void 0;(i>0||e.hskipBeforeAndAfter)&&0!==(q=Ec(F.pregap,h))&&((T=mh.makeSpan(["arraycolsep"],[])).style.width=sd(q),R.push(T));var z=[];for(n=0;n<r;++n){var V=a[n],K=V[i];if(K){var H=V.pos-A;K.depth=V.depth,K.height=V.height,z.push({type:"elem",elem:K,shift:H})}}z=mh.makeVList({positionType:"individualShift",children:z},t),z=mh.makeSpan(["col-align-"+(F.align||"c")],[z]),R.push(z),(i<o-1||e.hskipBeforeAndAfter)&&0!==(q=Ec(F.postgap,h))&&((T=mh.makeSpan(["arraycolsep"],[])).style.width=sd(q),R.push(T))}}if(a=mh.makeSpan(["mtable"],R),l.length>0){for(var W=mh.makeLineSpan("hline",t,c),$=mh.makeLineSpan("hdashline",t,c),G=[{type:"elem",elem:a,shift:0}];l.length>0;){var Y=l.pop(),X=Y.pos-A;Y.isDashed?G.push({type:"elem",elem:$,shift:X}):G.push({type:"elem",elem:W,shift:X})}a=mh.makeVList({positionType:"individualShift",children:G},t)}if(0===P.length)return mh.makeSpan(["mord"],[a],t);var Z=mh.makeVList({positionType:"individualShift",children:P},t);return Z=mh.makeSpan(["tag"],[Z],t),mh.makeFragment([a,Z])},rp={c:"center ",l:"left ",r:"right "},sp=function(e,t){for(var n=[],i=new Kh.MathNode("mtd",[],["mtr-glue"]),r=new Kh.MathNode("mtd",[],["mml-eqn-num"]),s=0;s<e.body.length;s++){for(var o=e.body[s],a=[],l=0;l<o.length;l++)a.push(new Kh.MathNode("mtd",[Xh(o[l],t)]));e.tags&&e.tags[s]&&(a.unshift(i),a.push(i),e.leqno?a.unshift(r):a.push(r)),n.push(new Kh.MathNode("mtr",a))}var c=new Kh.MathNode("mtable",n),d=.5===e.arraystretch?.1:.16+e.arraystretch-1+(e.addJot?.09:0);c.setAttribute("rowspacing",sd(d));var h="",u="";if(e.cols&&e.cols.length>0){var p=e.cols,m="",g=!1,f=0,v=p.length;"separator"===p[0].type&&(h+="top ",f=1),"separator"===p[p.length-1].type&&(h+="bottom ",v-=1);for(var y=f;y<v;y++)"align"===p[y].type?(u+=rp[p[y].align],g&&(m+="none "),g=!0):"separator"===p[y].type&&g&&(m+="|"===p[y].separator?"solid ":"dashed ",g=!1);c.setAttribute("columnalign",u.trim()),/[sd]/.test(m)&&c.setAttribute("columnlines",m.trim())}if("align"===e.colSeparationType){for(var b=e.cols||[],w="",S=1;S<b.length;S++)w+=S%2?"0em ":"1em ";c.setAttribute("columnspacing",w.trim())}else"alignat"===e.colSeparationType||"gather"===e.colSeparationType?c.setAttribute("columnspacing","0em"):"small"===e.colSeparationType?c.setAttribute("columnspacing","0.2778em"):"CD"===e.colSeparationType?c.setAttribute("columnspacing","0.5em"):c.setAttribute("columnspacing","1em");var _="",E=e.hLinesBeforeRow;h+=E[0].length>0?"left ":"",h+=E[E.length-1].length>0?"right ":"";for(var k=1;k<E.length-1;k++)_+=0===E[k].length?"none ":E[k][0]?"dashed ":"solid ";return/[sd]/.test(_)&&c.setAttribute("rowlines",_.trim()),""!==h&&(c=new Kh.MathNode("menclose",[c])).setAttribute("notation",h.trim()),e.arraystretch&&e.arraystretch<1&&(c=new Kh.MathNode("mstyle",[c])).setAttribute("scriptlevel","1"),c},op=function(e,t){-1===e.envName.indexOf("ed")&&Qu(e);var n,i=[],r=e.envName.indexOf("at")>-1?"alignat":"align",s="split"===e.envName,o=tp(e.parser,{cols:i,addJot:!0,autoTag:s?void 0:ep(e.envName),emptySingleRow:!0,colSeparationType:r,maxNumCols:s?2:void 0,leqno:e.parser.settings.leqno},"display"),a=0,l={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&"ordgroup"===t[0].type){for(var c="",d=0;d<t[0].body.length;d++)c+=ru(t[0].body[d],"textord").text;n=Number(c),a=2*n}var h=!a;o.body.forEach((function(e){for(var t=1;t<e.length;t+=2){var i=ru(e[t],"styling");ru(i.body[0],"ordgroup").body.unshift(l)}if(h)a<e.length&&(a=e.length);else{var r=e.length/2;if(n<r)throw new vc("Too many math in a row: expected "+n+", but got "+r,e[0])}}));for(var u=0;u<a;++u){var p="r",m=0;u%2==1?p="l":u>0&&h&&(m=1),i[u]={type:"align",align:p,pregap:m,postgap:0}}return o.colSeparationType=h?"align":"alignat",o};Yu({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,t){var n=(ou(t[0])?[t[0]]:ru(t[0],"ordgroup").body).map((function(e){var t=su(e).text;if(-1!=="lcr".indexOf(t))return{type:"align",align:t};if("|"===t)return{type:"separator",separator:"|"};if(":"===t)return{type:"separator",separator:":"};throw new vc("Unknown column alignment: "+t,e)})),i={cols:n,hskipBeforeAndAfter:!0,maxNumCols:n.length};return tp(e.parser,i,np(e.envName))},htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){var t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],n="c",i={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if("*"===e.envName.charAt(e.envName.length-1)){var r=e.parser;if(r.consumeSpaces(),"["===r.fetch().text){if(r.consume(),r.consumeSpaces(),n=r.fetch().text,-1==="lcr".indexOf(n))throw new vc("Expected l or c or r",r.nextToken);r.consume(),r.consumeSpaces(),r.expect("]"),r.consume(),i.cols=[{type:"align",align:n}]}}var s=tp(e.parser,i,np(e.envName)),o=Math.max(0,...s.body.map((e=>e.length)));return s.cols=new Array(o).fill({type:"align",align:n}),t?{type:"leftright",mode:e.mode,body:[s],left:t[0],right:t[1],rightColor:void 0}:s},htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){var t=tp(e.parser,{arraystretch:.5},"script");return t.colSeparationType="small",t},htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["subarray"],props:{numArgs:1},handler(e,t){var n=(ou(t[0])?[t[0]]:ru(t[0],"ordgroup").body).map((function(e){var t=su(e).text;if(-1!=="lc".indexOf(t))return{type:"align",align:t};throw new vc("Unknown column alignment: "+t,e)}));if(n.length>1)throw new vc("{subarray} can contain only one column");var i={cols:n,hskipBeforeAndAfter:!1,arraystretch:.5};if((i=tp(e.parser,i,"script")).body.length>0&&i.body[0].length>1)throw new vc("{subarray} can contain only one column");return i},htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){var t=tp(e.parser,{arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},np(e.envName));return{type:"leftright",mode:e.mode,body:[t],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:op,htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){_c(["gather","gather*"],e.envName)&&Qu(e);var t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:ep(e.envName),emptySingleRow:!0,leqno:e.parser.settings.leqno};return tp(e.parser,t,"display")},htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:op,htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){Qu(e);var t={autoTag:ep(e.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return tp(e.parser,t,"display")},htmlBuilder:ip,mathmlBuilder:sp}),Yu({type:"array",names:["CD"],props:{numArgs:0},handler:e=>(Qu(e),function(e){var t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var n=e.fetch().text;if("&"!==n&&"\\\\"!==n){if("\\end"===n){0===t[t.length-1].length&&t.pop();break}throw new vc("Expected \\\\ or \\cr or \\end",e.nextToken)}e.consume()}for(var i,r,s=[],o=[s],a=0;a<t.length;a++){for(var l=t[a],c={type:"styling",body:[],mode:"math",style:"display"},d=0;d<l.length;d++)if(uu(l[d])){s.push(c);var h=su(l[d+=1]).text,u=new Array(2);if(u[0]={type:"ordgroup",mode:"math",body:[]},u[1]={type:"ordgroup",mode:"math",body:[]},"=|.".indexOf(h)>-1);else{if(!("<>AV".indexOf(h)>-1))throw new vc('Expected one of "<>AV=|." after @',l[d]);for(var p=0;p<2;p++){for(var m=!0,g=d+1;g<l.length;g++){if(r=h,("mathord"===(i=l[g]).type||"atom"===i.type)&&i.text===r){m=!1,d=g;break}if(uu(l[g]))throw new vc("Missing a "+h+" character to complete a CD arrow.",l[g]);u[p].body.push(l[g])}if(m)throw new vc("Missing a "+h+" character to complete a CD arrow.",l[d])}}var f={type:"styling",body:[pu(h,u,e)],mode:"math",style:"display"};s.push(f),c={type:"styling",body:[],mode:"math",style:"display"}}else c.body.push(l[d]);a%2==0?s.push(c):s.shift(),s=[],o.push(s)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:"math",body:o,arraystretch:1,addJot:!0,rowGaps:[null],cols:new Array(o[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25}),colSeparationType:"CD",hLinesBeforeRow:new Array(o.length+1).fill([])}}(e.parser)),htmlBuilder:ip,mathmlBuilder:sp}),Zu("\\nonumber","\\gdef\\@eqnsw{0}"),Zu("\\notag","\\nonumber"),Eh({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,t){throw new vc(e.funcName+" valid only within array environment")}});var ap=Gu;Eh({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(e,t){var{parser:n,funcName:i}=e,r=t[0];if("ordgroup"!==r.type)throw new vc("Invalid environment name",r);for(var s="",o=0;o<r.body.length;++o)s+=ru(r.body[o],"textord").text;if("\\begin"===i){if(!ap.hasOwnProperty(s))throw new vc("No such environment: "+s,r);var a=ap[s],{args:l,optArgs:c}=n.parseArguments("\\begin{"+s+"}",a),d={mode:n.mode,envName:s,parser:n},h=a.handler(d,l,c);n.expect("\\end",!1);var u=n.nextToken,p=ru(n.parseFunction(),"environment");if(p.name!==s)throw new vc("Mismatch: \\begin{"+s+"} matched by \\end{"+p.name+"}",u);return h}return{type:"environment",mode:n.mode,name:s,nameGroup:r}}});var lp=mh.makeSpan;function cp(e,t){var n=Oh(e.body,t,!0);return lp([e.mclass],n,t)}function dp(e,t){var n,i=Gh(e.body,t);return"minner"===e.mclass?n=new Kh.MathNode("mpadded",i):"mord"===e.mclass?e.isCharacterBox?(n=i[0]).type="mi":n=new Kh.MathNode("mi",i):(e.isCharacterBox?(n=i[0]).type="mo":n=new Kh.MathNode("mo",i),"mbin"===e.mclass?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):"mpunct"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):"mopen"===e.mclass||"mclose"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0em"):"minner"===e.mclass&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}Eh({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(e,t){var{parser:n,funcName:i}=e,r=t[0];return{type:"mclass",mode:n.mode,mclass:"m"+i.substr(5),body:Th(r),isCharacterBox:Cc(r)}},htmlBuilder:cp,mathmlBuilder:dp});var hp=e=>{var t="ordgroup"===e.type&&e.body.length?e.body[0]:e;return"atom"!==t.type||"bin"!==t.family&&"rel"!==t.family?"mord":"m"+t.family};Eh({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(e,t){var{parser:n}=e;return{type:"mclass",mode:n.mode,mclass:hp(t[0]),body:Th(t[1]),isCharacterBox:Cc(t[1])}}}),Eh({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(e,t){var n,{parser:i,funcName:r}=e,s=t[1],o=t[0];n="\\stackrel"!==r?hp(s):"mrel";var a={type:"op",mode:s.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:"\\stackrel"!==r,body:Th(s)},l={type:"supsub",mode:o.mode,base:a,sup:"\\underset"===r?null:o,sub:"\\underset"===r?o:null};return{type:"mclass",mode:i.mode,mclass:n,body:[l],isCharacterBox:Cc(l)}},htmlBuilder:cp,mathmlBuilder:dp});var up=(e,t)=>{var n=e.font,i=t.withFont(n);return jh(e.body,i)},pp=(e,t)=>{var n=e.font,i=t.withFont(n);return Xh(e.body,i)},mp={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};Eh({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:i}=e,r=xh(t[0]),s=i;return s in mp&&(s=mp[s]),{type:"font",mode:n.mode,font:s.slice(1),body:r}},htmlBuilder:up,mathmlBuilder:pp}),Eh({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(e,t)=>{var{parser:n}=e,i=t[0],r=Cc(i);return{type:"mclass",mode:n.mode,mclass:hp(i),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:i}],isCharacterBox:r}}}),Eh({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:i,breakOnTokenText:r}=e,{mode:s}=n,o=n.parseExpression(!0,r);return{type:"font",mode:s,font:"math"+i.slice(1),body:{type:"ordgroup",mode:n.mode,body:o}}},htmlBuilder:up,mathmlBuilder:pp});var gp=(e,t)=>{var n=t;return"display"===e?n=n.id>=Uc.SCRIPT.id?n.text():Uc.DISPLAY:"text"===e&&n.size===Uc.DISPLAY.size?n=Uc.TEXT:"script"===e?n=Uc.SCRIPT:"scriptscript"===e&&(n=Uc.SCRIPTSCRIPT),n},fp=(e,t)=>{var n,i=gp(e.size,t.style),r=i.fracNum(),s=i.fracDen();n=t.havingStyle(r);var o=jh(e.numer,n,t);if(e.continued){var a=8.5/t.fontMetrics().ptPerEm,l=3.5/t.fontMetrics().ptPerEm;o.height=o.height<a?a:o.height,o.depth=o.depth<l?l:o.depth}n=t.havingStyle(s);var c,d,h,u,p,m,g,f,v,y,b=jh(e.denom,n,t);if(e.hasBarLine?(e.barSize?(d=rd(e.barSize,t),c=mh.makeLineSpan("frac-line",t,d)):c=mh.makeLineSpan("frac-line",t),d=c.height,h=c.height):(c=null,d=0,h=t.fontMetrics().defaultRuleThickness),i.size===Uc.DISPLAY.size||"display"===e.size?(u=t.fontMetrics().num1,p=d>0?3*h:7*h,m=t.fontMetrics().denom1):(d>0?(u=t.fontMetrics().num2,p=h):(u=t.fontMetrics().num3,p=3*h),m=t.fontMetrics().denom2),c){var w=t.fontMetrics().axisHeight;u-o.depth-(w+.5*d)<p&&(u+=p-(u-o.depth-(w+.5*d))),w-.5*d-(b.height-m)<p&&(m+=p-(w-.5*d-(b.height-m))),g=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:m},{type:"elem",elem:c,shift:-(w-.5*d)},{type:"elem",elem:o,shift:-u}]},t)}else{var S=u-o.depth-(b.height-m);S<p&&(u+=.5*(p-S),m+=.5*(p-S)),g=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:m},{type:"elem",elem:o,shift:-u}]},t)}return n=t.havingStyle(i),g.height*=n.sizeMultiplier/t.sizeMultiplier,g.depth*=n.sizeMultiplier/t.sizeMultiplier,f=i.size===Uc.DISPLAY.size?t.fontMetrics().delim1:i.size===Uc.SCRIPTSCRIPT.size?t.havingStyle(Uc.SCRIPT).fontMetrics().delim2:t.fontMetrics().delim2,v=null==e.leftDelim?Nh(t,["mopen"]):qu.customSizedDelim(e.leftDelim,f,!0,t.havingStyle(i),e.mode,["mopen"]),y=e.continued?mh.makeSpan([]):null==e.rightDelim?Nh(t,["mclose"]):qu.customSizedDelim(e.rightDelim,f,!0,t.havingStyle(i),e.mode,["mclose"]),mh.makeSpan(["mord"].concat(n.sizingClasses(t)),[v,mh.makeSpan(["mfrac"],[g]),y],t)},vp=(e,t)=>{var n=new Kh.MathNode("mfrac",[Xh(e.numer,t),Xh(e.denom,t)]);if(e.hasBarLine){if(e.barSize){var i=rd(e.barSize,t);n.setAttribute("linethickness",sd(i))}}else n.setAttribute("linethickness","0px");var r=gp(e.size,t.style);if(r.size!==t.style.size){n=new Kh.MathNode("mstyle",[n]);var s=r.size===Uc.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",s),n.setAttribute("scriptlevel","0")}if(null!=e.leftDelim||null!=e.rightDelim){var o=[];if(null!=e.leftDelim){var a=new Kh.MathNode("mo",[new Kh.TextNode(e.leftDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}if(o.push(n),null!=e.rightDelim){var l=new Kh.MathNode("mo",[new Kh.TextNode(e.rightDelim.replace("\\",""))]);l.setAttribute("fence","true"),o.push(l)}return Wh(o)}return n};Eh({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(e,t)=>{var n,{parser:i,funcName:r}=e,s=t[0],o=t[1],a=null,l=null,c="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":n=!0;break;case"\\\\atopfrac":n=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":n=!1,a="(",l=")";break;case"\\\\bracefrac":n=!1,a="\\{",l="\\}";break;case"\\\\brackfrac":n=!1,a="[",l="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":c="display";break;case"\\tfrac":case"\\tbinom":c="text"}return{type:"genfrac",mode:i.mode,continued:!1,numer:s,denom:o,hasBarLine:n,leftDelim:a,rightDelim:l,size:c,barSize:null}},htmlBuilder:fp,mathmlBuilder:vp}),Eh({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(e,t)=>{var{parser:n,funcName:i}=e,r=t[0],s=t[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:r,denom:s,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}}),Eh({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(e){var t,{parser:n,funcName:i,token:r}=e;switch(i){case"\\over":t="\\frac";break;case"\\choose":t="\\binom";break;case"\\atop":t="\\\\atopfrac";break;case"\\brace":t="\\\\bracefrac";break;case"\\brack":t="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:n.mode,replaceWith:t,token:r}}});var yp=["display","text","script","scriptscript"],bp=function(e){var t=null;return e.length>0&&(t="."===(t=e)?null:t),t};Eh({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(e,t){var n,{parser:i}=e,r=t[4],s=t[5],o=xh(t[0]),a="atom"===o.type&&"open"===o.family?bp(o.text):null,l=xh(t[1]),c="atom"===l.type&&"close"===l.family?bp(l.text):null,d=ru(t[2],"size"),h=null;n=!!d.isBlank||(h=d.value).number>0;var u="auto",p=t[3];if("ordgroup"===p.type){if(p.body.length>0){var m=ru(p.body[0],"textord");u=yp[Number(m.text)]}}else p=ru(p,"textord"),u=yp[Number(p.text)];return{type:"genfrac",mode:i.mode,numer:r,denom:s,continued:!1,hasBarLine:n,barSize:h,leftDelim:a,rightDelim:c,size:u}},htmlBuilder:fp,mathmlBuilder:vp}),Eh({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(e,t){var{parser:n,funcName:i,token:r}=e;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:ru(t[0],"size").value,token:r}}}),Eh({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(e,t)=>{var{parser:n,funcName:i}=e,r=t[0],s=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e}(ru(t[1],"infix").size),o=t[2],a=s.number>0;return{type:"genfrac",mode:n.mode,numer:r,denom:o,continued:!1,hasBarLine:a,barSize:s,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:fp,mathmlBuilder:vp});var wp=(e,t)=>{var n,i,r=t.style;"supsub"===e.type?(n=e.sup?jh(e.sup,t.havingStyle(r.sup()),t):jh(e.sub,t.havingStyle(r.sub()),t),i=ru(e.base,"horizBrace")):i=ru(e,"horizBrace");var s,o=jh(i.base,t.havingBaseStyle(Uc.DISPLAY)),a=iu(i,t);if(i.isOver?(s=mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"kern",size:.1},{type:"elem",elem:a}]},t)).children[0].children[0].children[1].classes.push("svg-align"):(s=mh.makeVList({positionType:"bottom",positionData:o.depth+.1+a.height,children:[{type:"elem",elem:a},{type:"kern",size:.1},{type:"elem",elem:o}]},t)).children[0].children[0].children[0].classes.push("svg-align"),n){var l=mh.makeSpan(["mord",i.isOver?"mover":"munder"],[s],t);s=i.isOver?mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.2},{type:"elem",elem:n}]},t):mh.makeVList({positionType:"bottom",positionData:l.depth+.2+n.height+n.depth,children:[{type:"elem",elem:n},{type:"kern",size:.2},{type:"elem",elem:l}]},t)}return mh.makeSpan(["mord",i.isOver?"mover":"munder"],[s],t)};Eh({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:i}=e;return{type:"horizBrace",mode:n.mode,label:i,isOver:/^\\over/.test(i),base:t[0]}},htmlBuilder:wp,mathmlBuilder:(e,t)=>{var n=nu(e.label);return new Kh.MathNode(e.isOver?"mover":"munder",[Xh(e.base,t),n])}}),Eh({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,i=t[1],r=ru(t[0],"url").url;return n.settings.isTrusted({command:"\\href",url:r})?{type:"href",mode:n.mode,href:r,body:Th(i)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(e,t)=>{var n=Oh(e.body,t,!1);return mh.makeAnchor(e.href,[],n,t)},mathmlBuilder:(e,t)=>{var n=Yh(e.body,t);return n instanceof zh||(n=new zh("mrow",[n])),n.setAttribute("href",e.href),n}}),Eh({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,i=ru(t[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:i}))return n.formatUnsupportedCmd("\\url");for(var r=[],s=0;s<i.length;s++){var o=i[s];"~"===o&&(o="\\textasciitilde"),r.push({type:"textord",mode:"text",text:o})}var a={type:"text",mode:n.mode,font:"\\texttt",body:r};return{type:"href",mode:n.mode,href:i,body:Th(a)}}}),Eh({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(e,t){var{parser:n}=e;return{type:"hbox",mode:n.mode,body:Th(t[0])}},htmlBuilder(e,t){var n=Oh(e.body,t,!1);return mh.makeFragment(n)},mathmlBuilder:(e,t)=>new Kh.MathNode("mrow",Gh(e.body,t))}),Eh({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(e,t)=>{var n,{parser:i,funcName:r,token:s}=e,o=ru(t[0],"raw").string,a=t[1];i.settings.strict&&i.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var l={};switch(r){case"\\htmlClass":l.class=o,n={command:"\\htmlClass",class:o};break;case"\\htmlId":l.id=o,n={command:"\\htmlId",id:o};break;case"\\htmlStyle":l.style=o,n={command:"\\htmlStyle",style:o};break;case"\\htmlData":for(var c=o.split(","),d=0;d<c.length;d++){var h=c[d].split("=");if(2!==h.length)throw new vc("Error parsing key-value for \\htmlData");l["data-"+h[0].trim()]=h[1].trim()}n={command:"\\htmlData",attributes:l};break;default:throw new Error("Unrecognized html command")}return i.settings.isTrusted(n)?{type:"html",mode:i.mode,attributes:l,body:Th(a)}:i.formatUnsupportedCmd(r)},htmlBuilder:(e,t)=>{var n=Oh(e.body,t,!1),i=["enclosing"];e.attributes.class&&i.push(...e.attributes.class.trim().split(/\s+/));var r=mh.makeSpan(i,n,t);for(var s in e.attributes)"class"!==s&&e.attributes.hasOwnProperty(s)&&r.setAttribute(s,e.attributes[s]);return r},mathmlBuilder:(e,t)=>Yh(e.body,t)}),Eh({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"htmlmathml",mode:n.mode,html:Th(t[0]),mathml:Th(t[1])}},htmlBuilder:(e,t)=>{var n=Oh(e.html,t,!1);return mh.makeFragment(n)},mathmlBuilder:(e,t)=>Yh(e.mathml,t)});var Sp=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new vc("Invalid size: '"+e+"' in \\includegraphics");var n={number:+(t[1]+t[2]),unit:t[3]};if(!id(n))throw new vc("Invalid unit: '"+n.unit+"' in \\includegraphics.");return n};Eh({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(e,t,n)=>{var{parser:i}=e,r={number:0,unit:"em"},s={number:.9,unit:"em"},o={number:0,unit:"em"},a="";if(n[0])for(var l=ru(n[0],"raw").string.split(","),c=0;c<l.length;c++){var d=l[c].split("=");if(2===d.length){var h=d[1].trim();switch(d[0].trim()){case"alt":a=h;break;case"width":r=Sp(h);break;case"height":s=Sp(h);break;case"totalheight":o=Sp(h);break;default:throw new vc("Invalid key: '"+d[0]+"' in \\includegraphics.")}}}var u=ru(t[0],"url").url;return""===a&&(a=(a=(a=u).replace(/^.*[\\/]/,"")).substring(0,a.lastIndexOf("."))),i.settings.isTrusted({command:"\\includegraphics",url:u})?{type:"includegraphics",mode:i.mode,alt:a,width:r,height:s,totalheight:o,src:u}:i.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(e,t)=>{var n=rd(e.height,t),i=0;e.totalheight.number>0&&(i=rd(e.totalheight,t)-n);var r=0;e.width.number>0&&(r=rd(e.width,t));var s={height:sd(n+i)};r>0&&(s.width=sd(r)),i>0&&(s.verticalAlign=sd(-i));var o=new ud(e.src,e.alt,s);return o.height=n,o.depth=i,o},mathmlBuilder:(e,t)=>{var n=new Kh.MathNode("mglyph",[]);n.setAttribute("alt",e.alt);var i=rd(e.height,t),r=0;if(e.totalheight.number>0&&(r=rd(e.totalheight,t)-i,n.setAttribute("valign",sd(-r))),n.setAttribute("height",sd(i+r)),e.width.number>0){var s=rd(e.width,t);n.setAttribute("width",sd(s))}return n.setAttribute("src",e.src),n}}),Eh({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:i}=e,r=ru(t[0],"size");if(n.settings.strict){var s="m"===i[1],o="mu"===r.value.unit;s?(o||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+i+" supports only mu units, not "+r.value.unit+" units"),"math"!==n.mode&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+i+" works only in math mode")):o&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+i+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:r.value}},htmlBuilder:(e,t)=>mh.makeGlue(e.dimension,t),mathmlBuilder(e,t){var n=rd(e.dimension,t);return new Kh.SpaceNode(n)}}),Eh({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:i}=e,r=t[0];return{type:"lap",mode:n.mode,alignment:i.slice(5),body:r}},htmlBuilder:(e,t)=>{var n;"clap"===e.alignment?(n=mh.makeSpan([],[jh(e.body,t)]),n=mh.makeSpan(["inner"],[n],t)):n=mh.makeSpan(["inner"],[jh(e.body,t)]);var i=mh.makeSpan(["fix"],[]),r=mh.makeSpan([e.alignment],[n,i],t),s=mh.makeSpan(["strut"]);return s.style.height=sd(r.height+r.depth),r.depth&&(s.style.verticalAlign=sd(-r.depth)),r.children.unshift(s),r=mh.makeSpan(["thinbox"],[r],t),mh.makeSpan(["mord","vbox"],[r],t)},mathmlBuilder:(e,t)=>{var n=new Kh.MathNode("mpadded",[Xh(e.body,t)]);if("rlap"!==e.alignment){var i="llap"===e.alignment?"-1":"-0.5";n.setAttribute("lspace",i+"width")}return n.setAttribute("width","0px"),n}}),Eh({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){var{funcName:n,parser:i}=e,r=i.mode;i.switchMode("math");var s="\\("===n?"\\)":"$",o=i.parseExpression(!1,s);return i.expect(s),i.switchMode(r),{type:"styling",mode:i.mode,style:"text",body:o}}}),Eh({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){throw new vc("Mismatched "+e.funcName)}});var _p=(e,t)=>{switch(t.style.size){case Uc.DISPLAY.size:return e.display;case Uc.TEXT.size:return e.text;case Uc.SCRIPT.size:return e.script;case Uc.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};Eh({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"mathchoice",mode:n.mode,display:Th(t[0]),text:Th(t[1]),script:Th(t[2]),scriptscript:Th(t[3])}},htmlBuilder:(e,t)=>{var n=_p(e,t),i=Oh(n,t,!1);return mh.makeFragment(i)},mathmlBuilder:(e,t)=>{var n=_p(e,t);return Yh(n,t)}});var Ep=(e,t,n,i,r,s,o)=>{e=mh.makeSpan([],[e]);var a,l,c,d=n&&Cc(n);if(t){var h=jh(t,i.havingStyle(r.sup()),i);l={elem:h,kern:Math.max(i.fontMetrics().bigOpSpacing1,i.fontMetrics().bigOpSpacing3-h.depth)}}if(n){var u=jh(n,i.havingStyle(r.sub()),i);a={elem:u,kern:Math.max(i.fontMetrics().bigOpSpacing2,i.fontMetrics().bigOpSpacing4-u.height)}}if(l&&a){var p=i.fontMetrics().bigOpSpacing5+a.elem.height+a.elem.depth+a.kern+e.depth+o;c=mh.makeVList({positionType:"bottom",positionData:p,children:[{type:"kern",size:i.fontMetrics().bigOpSpacing5},{type:"elem",elem:a.elem,marginLeft:sd(-s)},{type:"kern",size:a.kern},{type:"elem",elem:e},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:sd(s)},{type:"kern",size:i.fontMetrics().bigOpSpacing5}]},i)}else if(a){var m=e.height-o;c=mh.makeVList({positionType:"top",positionData:m,children:[{type:"kern",size:i.fontMetrics().bigOpSpacing5},{type:"elem",elem:a.elem,marginLeft:sd(-s)},{type:"kern",size:a.kern},{type:"elem",elem:e}]},i)}else{if(!l)return e;var g=e.depth+o;c=mh.makeVList({positionType:"bottom",positionData:g,children:[{type:"elem",elem:e},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:sd(s)},{type:"kern",size:i.fontMetrics().bigOpSpacing5}]},i)}var f=[c];if(a&&0!==s&&!d){var v=mh.makeSpan(["mspace"],[],i);v.style.marginRight=sd(s),f.unshift(v)}return mh.makeSpan(["mop","op-limits"],f,i)},kp=["\\smallint"],xp=(e,t)=>{var n,i,r,s=!1;"supsub"===e.type?(n=e.sup,i=e.sub,r=ru(e.base,"op"),s=!0):r=ru(e,"op");var o,a=t.style,l=!1;if(a.size===Uc.DISPLAY.size&&r.symbol&&!_c(kp,r.name)&&(l=!0),r.symbol){var c=l?"Size2-Regular":"Size1-Regular",d="";if("\\oiint"!==r.name&&"\\oiiint"!==r.name||(d=r.name.substr(1),r.name="oiint"===d?"\\iint":"\\iiint"),o=mh.makeSymbol(r.name,c,"math",t,["mop","op-symbol",l?"large-op":"small-op"]),d.length>0){var h=o.italic,u=mh.staticSvg(d+"Size"+(l?"2":"1"),t);o=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:0},{type:"elem",elem:u,shift:l?.08:0}]},t),r.name="\\"+d,o.classes.unshift("mop"),o.italic=h}}else if(r.body){var p=Oh(r.body,t,!0);1===p.length&&p[0]instanceof md?(o=p[0]).classes[0]="mop":o=mh.makeSpan(["mop"],p,t)}else{for(var m=[],g=1;g<r.name.length;g++)m.push(mh.mathsym(r.name[g],r.mode,t));o=mh.makeSpan(["mop"],m,t)}var f=0,v=0;return(o instanceof md||"\\oiint"===r.name||"\\oiiint"===r.name)&&!r.suppressBaseShift&&(f=(o.height-o.depth)/2-t.fontMetrics().axisHeight,v=o.italic),s?Ep(o,n,i,t,a,v,f):(f&&(o.style.position="relative",o.style.top=sd(f)),o)},Tp=(e,t)=>{var n;if(e.symbol)n=new zh("mo",[Hh(e.name,e.mode)]),_c(kp,e.name)&&n.setAttribute("largeop","false");else if(e.body)n=new zh("mo",Gh(e.body,t));else{n=new zh("mi",[new Vh(e.name.slice(1))]);var i=new zh("mo",[Hh("","text")]);n=e.parentIsSupSub?new zh("mrow",[n,i]):qh([n,i])}return n},Cp={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};Eh({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(e,t)=>{var{parser:n,funcName:i}=e,r=i;return 1===r.length&&(r=Cp[r]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:xp,mathmlBuilder:Tp}),Eh({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var{parser:n}=e,i=t[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:Th(i)}},htmlBuilder:xp,mathmlBuilder:Tp});var Ap={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};Eh({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:xp,mathmlBuilder:Tp}),Eh({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:xp,mathmlBuilder:Tp}),Eh({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e,i=n;return 1===i.length&&(i=Ap[i]),{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:i}},htmlBuilder:xp,mathmlBuilder:Tp});var Ip=(e,t)=>{var n,i,r,s,o=!1;if("supsub"===e.type?(n=e.sup,i=e.sub,r=ru(e.base,"operatorname"),o=!0):r=ru(e,"operatorname"),r.body.length>0){for(var a=r.body.map((e=>{var t=e.text;return"string"==typeof t?{type:"textord",mode:e.mode,text:t}:e})),l=Oh(a,t.withFont("mathrm"),!0),c=0;c<l.length;c++){var d=l[c];d instanceof md&&(d.text=d.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}s=mh.makeSpan(["mop"],l,t)}else s=mh.makeSpan(["mop"],[],t);return o?Ep(s,n,i,t,t.style,0,0):s};function Rp(e,t,n){for(var i=Oh(e,t,!1),r=t.sizeMultiplier/n.sizeMultiplier,s=0;s<i.length;s++){var o=i[s].classes.indexOf("sizing");o<0?Array.prototype.push.apply(i[s].classes,t.sizingClasses(n)):i[s].classes[o+1]==="reset-size"+t.size&&(i[s].classes[o+1]="reset-size"+n.size),i[s].height*=r,i[s].depth*=r}return mh.makeFragment(i)}Eh({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:i}=e,r=t[0];return{type:"operatorname",mode:n.mode,body:Th(r),alwaysHandleSupSub:"\\operatornamewithlimits"===i,limits:!1,parentIsSupSub:!1}},htmlBuilder:Ip,mathmlBuilder:(e,t)=>{for(var n=Gh(e.body,t.withFont("mathrm")),i=!0,r=0;r<n.length;r++){var s=n[r];if(s instanceof Kh.SpaceNode);else if(s instanceof Kh.MathNode)switch(s.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":var o=s.children[0];1===s.children.length&&o instanceof Kh.TextNode?o.text=o.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):i=!1;break;default:i=!1}else i=!1}if(i){var a=n.map((e=>e.toText())).join("");n=[new Kh.TextNode(a)]}var l=new Kh.MathNode("mi",n);l.setAttribute("mathvariant","normal");var c=new Kh.MathNode("mo",[Hh("","text")]);return e.parentIsSupSub?new Kh.MathNode("mrow",[l,c]):Kh.newDocumentFragment([l,c])}}),Zu("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@"),kh({type:"ordgroup",htmlBuilder:(e,t)=>e.semisimple?mh.makeFragment(Oh(e.body,t,!1)):mh.makeSpan(["mord"],Oh(e.body,t,!0),t),mathmlBuilder:(e,t)=>Yh(e.body,t,!0)}),Eh({type:"overline",names:["\\overline"],props:{numArgs:1},handler(e,t){var{parser:n}=e,i=t[0];return{type:"overline",mode:n.mode,body:i}},htmlBuilder(e,t){var n=jh(e.body,t.havingCrampedStyle()),i=mh.makeLineSpan("overline-line",t),r=t.fontMetrics().defaultRuleThickness,s=mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*r},{type:"elem",elem:i},{type:"kern",size:r}]},t);return mh.makeSpan(["mord","overline"],[s],t)},mathmlBuilder(e,t){var n=new Kh.MathNode("mo",[new Kh.TextNode("")]);n.setAttribute("stretchy","true");var i=new Kh.MathNode("mover",[Xh(e.body,t),n]);return i.setAttribute("accent","true"),i}}),Eh({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,i=t[0];return{type:"phantom",mode:n.mode,body:Th(i)}},htmlBuilder:(e,t)=>{var n=Oh(e.body,t.withPhantom(),!1);return mh.makeFragment(n)},mathmlBuilder:(e,t)=>{var n=Gh(e.body,t);return new Kh.MathNode("mphantom",n)}}),Eh({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,i=t[0];return{type:"hphantom",mode:n.mode,body:i}},htmlBuilder:(e,t)=>{var n=mh.makeSpan([],[jh(e.body,t.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var i=0;i<n.children.length;i++)n.children[i].height=0,n.children[i].depth=0;return n=mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t),mh.makeSpan(["mord"],[n],t)},mathmlBuilder:(e,t)=>{var n=Gh(Th(e.body),t),i=new Kh.MathNode("mphantom",n),r=new Kh.MathNode("mpadded",[i]);return r.setAttribute("height","0px"),r.setAttribute("depth","0px"),r}}),Eh({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,i=t[0];return{type:"vphantom",mode:n.mode,body:i}},htmlBuilder:(e,t)=>{var n=mh.makeSpan(["inner"],[jh(e.body,t.withPhantom())]),i=mh.makeSpan(["fix"],[]);return mh.makeSpan(["mord","rlap"],[n,i],t)},mathmlBuilder:(e,t)=>{var n=Gh(Th(e.body),t),i=new Kh.MathNode("mphantom",n),r=new Kh.MathNode("mpadded",[i]);return r.setAttribute("width","0px"),r}}),Eh({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e,i=ru(t[0],"size").value,r=t[1];return{type:"raisebox",mode:n.mode,dy:i,body:r}},htmlBuilder(e,t){var n=jh(e.body,t),i=rd(e.dy,t);return mh.makeVList({positionType:"shift",positionData:-i,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){var n=new Kh.MathNode("mpadded",[Xh(e.body,t)]),i=e.dy.number+e.dy.unit;return n.setAttribute("voffset",i),n}}),Eh({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t}=e;return{type:"internal",mode:t.mode}}}),Eh({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler(e,t,n){var{parser:i}=e,r=n[0],s=ru(t[0],"size"),o=ru(t[1],"size");return{type:"rule",mode:i.mode,shift:r&&ru(r,"size").value,width:s.value,height:o.value}},htmlBuilder(e,t){var n=mh.makeSpan(["mord","rule"],[],t),i=rd(e.width,t),r=rd(e.height,t),s=e.shift?rd(e.shift,t):0;return n.style.borderRightWidth=sd(i),n.style.borderTopWidth=sd(r),n.style.bottom=sd(s),n.width=i,n.height=r+s,n.depth=-s,n.maxFontSize=1.125*r*t.sizeMultiplier,n},mathmlBuilder(e,t){var n=rd(e.width,t),i=rd(e.height,t),r=e.shift?rd(e.shift,t):0,s=t.color&&t.getColor()||"black",o=new Kh.MathNode("mspace");o.setAttribute("mathbackground",s),o.setAttribute("width",sd(n)),o.setAttribute("height",sd(i));var a=new Kh.MathNode("mpadded",[o]);return r>=0?a.setAttribute("height",sd(r)):(a.setAttribute("height",sd(r)),a.setAttribute("depth",sd(-r))),a.setAttribute("voffset",sd(r)),a}});var Pp=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];Eh({type:"sizing",names:Pp,props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{breakOnTokenText:n,funcName:i,parser:r}=e,s=r.parseExpression(!1,n);return{type:"sizing",mode:r.mode,size:Pp.indexOf(i)+1,body:s}},htmlBuilder:(e,t)=>{var n=t.havingSize(e.size);return Rp(e.body,n,t)},mathmlBuilder:(e,t)=>{var n=t.havingSize(e.size),i=Gh(e.body,n),r=new Kh.MathNode("mstyle",i);return r.setAttribute("mathsize",sd(n.sizeMultiplier)),r}}),Eh({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(e,t,n)=>{var{parser:i}=e,r=!1,s=!1,o=n[0]&&ru(n[0],"ordgroup");if(o)for(var a="",l=0;l<o.body.length;++l)if("t"===(a=o.body[l].text))r=!0;else{if("b"!==a){r=!1,s=!1;break}s=!0}else r=!0,s=!0;var c=t[0];return{type:"smash",mode:i.mode,body:c,smashHeight:r,smashDepth:s}},htmlBuilder:(e,t)=>{var n=mh.makeSpan([],[jh(e.body,t)]);if(!e.smashHeight&&!e.smashDepth)return n;if(e.smashHeight&&(n.height=0,n.children))for(var i=0;i<n.children.length;i++)n.children[i].height=0;if(e.smashDepth&&(n.depth=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].depth=0;var s=mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t);return mh.makeSpan(["mord"],[s],t)},mathmlBuilder:(e,t)=>{var n=new Kh.MathNode("mpadded",[Xh(e.body,t)]);return e.smashHeight&&n.setAttribute("height","0px"),e.smashDepth&&n.setAttribute("depth","0px"),n}}),Eh({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:i}=e,r=n[0],s=t[0];return{type:"sqrt",mode:i.mode,body:s,index:r}},htmlBuilder(e,t){var n=jh(e.body,t.havingCrampedStyle());0===n.height&&(n.height=t.fontMetrics().xHeight),n=mh.wrapFragment(n,t);var i=t.fontMetrics().defaultRuleThickness,r=i;t.style.id<Uc.TEXT.id&&(r=t.fontMetrics().xHeight);var s=i+r/4,o=n.height+n.depth+s+i,{span:a,ruleWidth:l,advanceWidth:c}=qu.sqrtImage(o,t),d=a.height-l;d>n.height+n.depth+s&&(s=(s+d-n.height-n.depth)/2);var h=a.height-n.height-s-l;n.style.paddingLeft=sd(c);var u=mh.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+h)},{type:"elem",elem:a},{type:"kern",size:l}]},t);if(e.index){var p=t.havingStyle(Uc.SCRIPTSCRIPT),m=jh(e.index,p,t),g=.6*(u.height-u.depth),f=mh.makeVList({positionType:"shift",positionData:-g,children:[{type:"elem",elem:m}]},t),v=mh.makeSpan(["root"],[f]);return mh.makeSpan(["mord","sqrt"],[v,u],t)}return mh.makeSpan(["mord","sqrt"],[u],t)},mathmlBuilder(e,t){var{body:n,index:i}=e;return i?new Kh.MathNode("mroot",[Xh(n,t),Xh(i,t)]):new Kh.MathNode("msqrt",[Xh(n,t)])}});var Op={display:Uc.DISPLAY,text:Uc.TEXT,script:Uc.SCRIPT,scriptscript:Uc.SCRIPTSCRIPT};Eh({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e,t){var{breakOnTokenText:n,funcName:i,parser:r}=e,s=r.parseExpression(!0,n),o=i.slice(1,i.length-5);return{type:"styling",mode:r.mode,style:o,body:s}},htmlBuilder(e,t){var n=Op[e.style],i=t.havingStyle(n).withFont("");return Rp(e.body,i,t)},mathmlBuilder(e,t){var n=Op[e.style],i=t.havingStyle(n),r=Gh(e.body,i),s=new Kh.MathNode("mstyle",r),o={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]}[e.style];return s.setAttribute("scriptlevel",o[0]),s.setAttribute("displaystyle",o[1]),s}}),kh({type:"supsub",htmlBuilder(e,t){var n=function(e,t){var n=e.base;return n?"op"===n.type?n.limits&&(t.style.size===Uc.DISPLAY.size||n.alwaysHandleSupSub)?xp:null:"operatorname"===n.type?n.alwaysHandleSupSub&&(t.style.size===Uc.DISPLAY.size||n.limits)?Ip:null:"accent"===n.type?Cc(n.base)?au:null:"horizBrace"===n.type&&!e.sub===n.isOver?wp:null:null}(e,t);if(n)return n(e,t);var i,r,s,{base:o,sup:a,sub:l}=e,c=jh(o,t),d=t.fontMetrics(),h=0,u=0,p=o&&Cc(o);if(a){var m=t.havingStyle(t.style.sup());i=jh(a,m,t),p||(h=c.height-m.fontMetrics().supDrop*m.sizeMultiplier/t.sizeMultiplier)}if(l){var g=t.havingStyle(t.style.sub());r=jh(l,g,t),p||(u=c.depth+g.fontMetrics().subDrop*g.sizeMultiplier/t.sizeMultiplier)}s=t.style===Uc.DISPLAY?d.sup1:t.style.cramped?d.sup3:d.sup2;var f,v=t.sizeMultiplier,y=sd(.5/d.ptPerEm/v),b=null;if(r){var w=e.base&&"op"===e.base.type&&e.base.name&&("\\oiint"===e.base.name||"\\oiiint"===e.base.name);(c instanceof md||w)&&(b=sd(-c.italic))}if(i&&r){h=Math.max(h,s,i.depth+.25*d.xHeight),u=Math.max(u,d.sub2);var S=4*d.defaultRuleThickness;if(h-i.depth-(r.height-u)<S){u=S-(h-i.depth)+r.height;var _=.8*d.xHeight-(h-i.depth);_>0&&(h+=_,u-=_)}f=mh.makeVList({positionType:"individualShift",children:[{type:"elem",elem:r,shift:u,marginRight:y,marginLeft:b},{type:"elem",elem:i,shift:-h,marginRight:y}]},t)}else if(r){u=Math.max(u,d.sub1,r.height-.8*d.xHeight),f=mh.makeVList({positionType:"shift",positionData:u,children:[{type:"elem",elem:r,marginLeft:b,marginRight:y}]},t)}else{if(!i)throw new Error("supsub must have either sup or sub.");h=Math.max(h,s,i.depth+.25*d.xHeight),f=mh.makeVList({positionType:"shift",positionData:-h,children:[{type:"elem",elem:i,marginRight:y}]},t)}var E=Fh(c,"right")||"mord";return mh.makeSpan([E],[c,mh.makeSpan(["msupsub"],[f])],t)},mathmlBuilder(e,t){var n,i=!1;e.base&&"horizBrace"===e.base.type&&!!e.sup===e.base.isOver&&(i=!0,n=e.base.isOver),!e.base||"op"!==e.base.type&&"operatorname"!==e.base.type||(e.base.parentIsSupSub=!0);var r,s=[Xh(e.base,t)];if(e.sub&&s.push(Xh(e.sub,t)),e.sup&&s.push(Xh(e.sup,t)),i)r=n?"mover":"munder";else if(e.sub)if(e.sup){var o=e.base;r=o&&"op"===o.type&&o.limits&&t.style===Uc.DISPLAY||o&&"operatorname"===o.type&&o.alwaysHandleSupSub&&(t.style===Uc.DISPLAY||o.limits)?"munderover":"msubsup"}else{var a=e.base;r=a&&"op"===a.type&&a.limits&&(t.style===Uc.DISPLAY||a.alwaysHandleSupSub)||a&&"operatorname"===a.type&&a.alwaysHandleSupSub&&(a.limits||t.style===Uc.DISPLAY)?"munder":"msub"}else{var l=e.base;r=l&&"op"===l.type&&l.limits&&(t.style===Uc.DISPLAY||l.alwaysHandleSupSub)||l&&"operatorname"===l.type&&l.alwaysHandleSupSub&&(l.limits||t.style===Uc.DISPLAY)?"mover":"msup"}return new Kh.MathNode(r,s)}}),kh({type:"atom",htmlBuilder:(e,t)=>mh.mathsym(e.text,e.mode,t,["m"+e.family]),mathmlBuilder(e,t){var n=new Kh.MathNode("mo",[Hh(e.text,e.mode)]);if("bin"===e.family){var i=$h(e,t);"bold-italic"===i&&n.setAttribute("mathvariant",i)}else"punct"===e.family?n.setAttribute("separator","true"):"open"!==e.family&&"close"!==e.family||n.setAttribute("stretchy","false");return n}});var Mp={mi:"italic",mn:"normal",mtext:"normal"};kh({type:"mathord",htmlBuilder:(e,t)=>mh.makeOrd(e,t,"mathord"),mathmlBuilder(e,t){var n=new Kh.MathNode("mi",[Hh(e.text,e.mode,t)]),i=$h(e,t)||"italic";return i!==Mp[n.type]&&n.setAttribute("mathvariant",i),n}}),kh({type:"textord",htmlBuilder:(e,t)=>mh.makeOrd(e,t,"textord"),mathmlBuilder(e,t){var n,i=Hh(e.text,e.mode,t),r=$h(e,t)||"normal";return n="text"===e.mode?new Kh.MathNode("mtext",[i]):/[0-9]/.test(e.text)?new Kh.MathNode("mn",[i]):"\\prime"===e.text?new Kh.MathNode("mo",[i]):new Kh.MathNode("mi",[i]),r!==Mp[n.type]&&n.setAttribute("mathvariant",r),n}});var Dp={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},Lp={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};kh({type:"spacing",htmlBuilder(e,t){if(Lp.hasOwnProperty(e.text)){var n=Lp[e.text].className||"";if("text"===e.mode){var i=mh.makeOrd(e,t,"textord");return i.classes.push(n),i}return mh.makeSpan(["mspace",n],[mh.mathsym(e.text,e.mode,t)],t)}if(Dp.hasOwnProperty(e.text))return mh.makeSpan(["mspace",Dp[e.text]],[],t);throw new vc('Unknown type of space "'+e.text+'"')},mathmlBuilder(e,t){if(!Lp.hasOwnProperty(e.text)){if(Dp.hasOwnProperty(e.text))return new Kh.MathNode("mspace");throw new vc('Unknown type of space "'+e.text+'"')}return new Kh.MathNode("mtext",[new Kh.TextNode("")])}});var Fp=()=>{var e=new Kh.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};kh({type:"tag",mathmlBuilder(e,t){var n=new Kh.MathNode("mtable",[new Kh.MathNode("mtr",[Fp(),new Kh.MathNode("mtd",[Yh(e.body,t)]),Fp(),new Kh.MathNode("mtd",[Yh(e.tag,t)])])]);return n.setAttribute("width","100%"),n}});var Np={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},jp={"\\textbf":"textbf","\\textmd":"textmd"},Bp={"\\textit":"textit","\\textup":"textup"},Up=(e,t)=>{var n=e.font;return n?Np[n]?t.withTextFontFamily(Np[n]):jp[n]?t.withTextFontWeight(jp[n]):t.withTextFontShape(Bp[n]):t};Eh({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:i}=e,r=t[0];return{type:"text",mode:n.mode,body:Th(r),font:i}},htmlBuilder(e,t){var n=Up(e,t),i=Oh(e.body,n,!0);return mh.makeSpan(["mord","text"],i,n)},mathmlBuilder(e,t){var n=Up(e,t);return Yh(e.body,n)}}),Eh({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"underline",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=jh(e.body,t),i=mh.makeLineSpan("underline-line",t),r=t.fontMetrics().defaultRuleThickness,s=mh.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:r},{type:"elem",elem:i},{type:"kern",size:3*r},{type:"elem",elem:n}]},t);return mh.makeSpan(["mord","underline"],[s],t)},mathmlBuilder(e,t){var n=new Kh.MathNode("mo",[new Kh.TextNode("")]);n.setAttribute("stretchy","true");var i=new Kh.MathNode("munder",[Xh(e.body,t),n]);return i.setAttribute("accentunder","true"),i}}),Eh({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"vcenter",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=jh(e.body,t),i=t.fontMetrics().axisHeight,r=.5*(n.height-i-(n.depth+i));return mh.makeVList({positionType:"shift",positionData:r,children:[{type:"elem",elem:n}]},t)},mathmlBuilder:(e,t)=>new Kh.MathNode("mpadded",[Xh(e.body,t)],["vcenter"])}),Eh({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,t,n){throw new vc("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(e,t){for(var n=qp(e),i=[],r=t.havingStyle(t.style.text()),s=0;s<n.length;s++){var o=n[s];"~"===o&&(o="\\textasciitilde"),i.push(mh.makeSymbol(o,"Typewriter-Regular",e.mode,r,["mord","texttt"]))}return mh.makeSpan(["mord","text"].concat(r.sizingClasses(t)),mh.tryCombineChars(i),r)},mathmlBuilder(e,t){var n=new Kh.TextNode(qp(e)),i=new Kh.MathNode("mtext",[n]);return i.setAttribute("mathvariant","monospace"),i}});var qp=e=>e.body.replace(/ /g,e.star?"":""),zp=wh,Vp=new RegExp("[-]+$");class Kp{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp("([ \r\n\t]+)|\\\\(\n|[ \r\t]+\n?)[ \r\t]*|([!-\\[\\]---][-]*|[\ud800-\udbff][\udc00-\udfff][-]*|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5|(\\\\[a-zA-Z@]+)[ \r\n\t]*|\\\\[^\ud800-\udfff])","g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new fc("EOF",new gc(this,t,t));var n=this.tokenRegex.exec(e);if(null===n||n.index!==t)throw new vc("Unexpected character: '"+e[t]+"'",new fc(e[t],new gc(this,t,t+1)));var i=n[6]||n[3]||(n[2]?"\\ ":" ");if(14===this.catcodes[i]){var r=e.indexOf("\n",this.tokenRegex.lastIndex);return-1===r?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=r+1,this.lex()}return new fc(i,new gc(this,t,this.tokenRegex.lastIndex))}}class Hp{constructor(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(0===this.undefStack.length)throw new vc("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(null==e[t]?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,n){if(void 0===n&&(n=!1),n){for(var i=0;i<this.undefStack.length;i++)delete this.undefStack[i][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var r=this.undefStack[this.undefStack.length-1];r&&!r.hasOwnProperty(e)&&(r[e]=this.current[e])}null==t?delete this.current[e]:this.current[e]=t}}var Wp=Xu;Zu("\\noexpand",(function(e){var t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}})),Zu("\\expandafter",(function(e){var t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}})),Zu("\\@firstoftwo",(function(e){return{tokens:e.consumeArgs(2)[0],numArgs:0}})),Zu("\\@secondoftwo",(function(e){return{tokens:e.consumeArgs(2)[1],numArgs:0}})),Zu("\\@ifnextchar",(function(e){var t=e.consumeArgs(3);e.consumeSpaces();var n=e.future();return 1===t[0].length&&t[0][0].text===n.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}})),Zu("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),Zu("\\TextOrMath",(function(e){var t=e.consumeArgs(2);return"text"===e.mode?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}}));var $p={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};Zu("\\char",(function(e){var t,n=e.popToken(),i="";if("'"===n.text)t=8,n=e.popToken();else if('"'===n.text)t=16,n=e.popToken();else if("`"===n.text)if("\\"===(n=e.popToken()).text[0])i=n.text.charCodeAt(1);else{if("EOF"===n.text)throw new vc("\\char` missing argument");i=n.text.charCodeAt(0)}else t=10;if(t){if(null==(i=$p[n.text])||i>=t)throw new vc("Invalid base-"+t+" digit "+n.text);for(var r;null!=(r=$p[e.future().text])&&r<t;)i*=t,i+=r,e.popToken()}return"\\@char{"+i+"}"}));var Gp=(e,t,n)=>{var i=e.consumeArg().tokens;if(1!==i.length)throw new vc("\\newcommand's first argument must be a macro name");var r=i[0].text,s=e.isDefined(r);if(s&&!t)throw new vc("\\newcommand{"+r+"} attempting to redefine "+r+"; use \\renewcommand");if(!s&&!n)throw new vc("\\renewcommand{"+r+"} when command "+r+" does not yet exist; use \\newcommand");var o=0;if(1===(i=e.consumeArg().tokens).length&&"["===i[0].text){for(var a="",l=e.expandNextToken();"]"!==l.text&&"EOF"!==l.text;)a+=l.text,l=e.expandNextToken();if(!a.match(/^\s*[0-9]+\s*$/))throw new vc("Invalid number of arguments: "+a);o=parseInt(a),i=e.consumeArg().tokens}return e.macros.set(r,{tokens:i,numArgs:o}),""};Zu("\\newcommand",(e=>Gp(e,!1,!0))),Zu("\\renewcommand",(e=>Gp(e,!0,!1))),Zu("\\providecommand",(e=>Gp(e,!0,!0))),Zu("\\message",(e=>{var t=e.consumeArgs(1)[0];return console.log(t.reverse().map((e=>e.text)).join("")),""})),Zu("\\errmessage",(e=>{var t=e.consumeArgs(1)[0];return console.error(t.reverse().map((e=>e.text)).join("")),""})),Zu("\\show",(e=>{var t=e.popToken(),n=t.text;return console.log(t,e.macros.get(n),zp[n],Sd.math[n],Sd.text[n]),""})),Zu("\\bgroup","{"),Zu("\\egroup","}"),Zu("~","\\nobreakspace"),Zu("\\lq","`"),Zu("\\rq","'"),Zu("\\aa","\\r a"),Zu("\\AA","\\r A"),Zu("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}"),Zu("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}"),Zu("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}"),Zu("","\\mathscr{B}"),Zu("","\\mathscr{E}"),Zu("","\\mathscr{F}"),Zu("","\\mathscr{H}"),Zu("","\\mathscr{I}"),Zu("","\\mathscr{L}"),Zu("","\\mathscr{M}"),Zu("","\\mathscr{R}"),Zu("","\\mathfrak{C}"),Zu("","\\mathfrak{H}"),Zu("","\\mathfrak{Z}"),Zu("\\Bbbk","\\Bbb{k}"),Zu("","\\cdotp"),Zu("\\llap","\\mathllap{\\textrm{#1}}"),Zu("\\rlap","\\mathrlap{\\textrm{#1}}"),Zu("\\clap","\\mathclap{\\textrm{#1}}"),Zu("\\mathstrut","\\vphantom{(}"),Zu("\\underbar","\\underline{\\text{#1}}"),Zu("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}'),Zu("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}"),Zu("\\ne","\\neq"),Zu("","\\neq"),Zu("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}"),Zu("","\\notin"),Zu("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}"),Zu("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}"),Zu("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}"),Zu("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}"),Zu("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}"),Zu("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}"),Zu("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}"),Zu("","\\perp"),Zu("","\\mathclose{!\\mkern-0.8mu!}"),Zu("","\\notni"),Zu("","\\ulcorner"),Zu("","\\urcorner"),Zu("","\\llcorner"),Zu("","\\lrcorner"),Zu("","\\copyright"),Zu("","\\textregistered"),Zu("","\\textregistered"),Zu("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}'),Zu("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}'),Zu("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}'),Zu("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}'),Zu("\\vdots","\\mathord{\\varvdots\\rule{0pt}{15pt}}"),Zu("","\\vdots"),Zu("\\varGamma","\\mathit{\\Gamma}"),Zu("\\varDelta","\\mathit{\\Delta}"),Zu("\\varTheta","\\mathit{\\Theta}"),Zu("\\varLambda","\\mathit{\\Lambda}"),Zu("\\varXi","\\mathit{\\Xi}"),Zu("\\varPi","\\mathit{\\Pi}"),Zu("\\varSigma","\\mathit{\\Sigma}"),Zu("\\varUpsilon","\\mathit{\\Upsilon}"),Zu("\\varPhi","\\mathit{\\Phi}"),Zu("\\varPsi","\\mathit{\\Psi}"),Zu("\\varOmega","\\mathit{\\Omega}"),Zu("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),Zu("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax"),Zu("\\boxed","\\fbox{$\\displaystyle{#1}$}"),Zu("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),Zu("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),Zu("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");var Yp={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};Zu("\\dots",(function(e){var t="\\dotso",n=e.expandAfterFuture().text;return n in Yp?t=Yp[n]:("\\not"===n.substr(0,4)||n in Sd.math&&_c(["bin","rel"],Sd.math[n].group))&&(t="\\dotsb"),t}));var Xp={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};Zu("\\dotso",(function(e){return e.future().text in Xp?"\\ldots\\,":"\\ldots"})),Zu("\\dotsc",(function(e){var t=e.future().text;return t in Xp&&","!==t?"\\ldots\\,":"\\ldots"})),Zu("\\cdots",(function(e){return e.future().text in Xp?"\\@cdots\\,":"\\@cdots"})),Zu("\\dotsb","\\cdots"),Zu("\\dotsm","\\cdots"),Zu("\\dotsi","\\!\\cdots"),Zu("\\dotsx","\\ldots\\,"),Zu("\\DOTSI","\\relax"),Zu("\\DOTSB","\\relax"),Zu("\\DOTSX","\\relax"),Zu("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),Zu("\\,","\\tmspace+{3mu}{.1667em}"),Zu("\\thinspace","\\,"),Zu("\\>","\\mskip{4mu}"),Zu("\\:","\\tmspace+{4mu}{.2222em}"),Zu("\\medspace","\\:"),Zu("\\;","\\tmspace+{5mu}{.2777em}"),Zu("\\thickspace","\\;"),Zu("\\!","\\tmspace-{3mu}{.1667em}"),Zu("\\negthinspace","\\!"),Zu("\\negmedspace","\\tmspace-{4mu}{.2222em}"),Zu("\\negthickspace","\\tmspace-{5mu}{.277em}"),Zu("\\enspace","\\kern.5em "),Zu("\\enskip","\\hskip.5em\\relax"),Zu("\\quad","\\hskip1em\\relax"),Zu("\\qquad","\\hskip2em\\relax"),Zu("\\tag","\\@ifstar\\tag@literal\\tag@paren"),Zu("\\tag@paren","\\tag@literal{({#1})}"),Zu("\\tag@literal",(e=>{if(e.macros.get("\\df@tag"))throw new vc("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"})),Zu("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),Zu("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),Zu("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),Zu("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),Zu("\\pmb","\\html@mathml{\\@binrel{#1}{\\mathrlap{#1}\\kern0.5px#1}}{\\mathbf{#1}}"),Zu("\\newline","\\\\\\relax"),Zu("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var Zp=sd(Wc["Main-Regular"]["T".charCodeAt(0)][1]-.7*Wc["Main-Regular"]["A".charCodeAt(0)][1]);Zu("\\LaTeX","\\textrm{\\html@mathml{L\\kern-.36em\\raisebox{"+Zp+"}{\\scriptstyle A}\\kern-.15em\\TeX}{LaTeX}}"),Zu("\\KaTeX","\\textrm{\\html@mathml{K\\kern-.17em\\raisebox{"+Zp+"}{\\scriptstyle A}\\kern-.15em\\TeX}{KaTeX}}"),Zu("\\hspace","\\@ifstar\\@hspacer\\@hspace"),Zu("\\@hspace","\\hskip #1\\relax"),Zu("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),Zu("\\ordinarycolon",":"),Zu("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),Zu("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}'),Zu("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}'),Zu("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}'),Zu("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}'),Zu("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}'),Zu("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}'),Zu("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}'),Zu("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}'),Zu("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}'),Zu("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}'),Zu("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}'),Zu("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}'),Zu("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}'),Zu("","\\dblcolon"),Zu("","\\eqcolon"),Zu("","\\coloneqq"),Zu("","\\eqqcolon"),Zu("","\\Coloneqq"),Zu("\\ratio","\\vcentcolon"),Zu("\\coloncolon","\\dblcolon"),Zu("\\colonequals","\\coloneqq"),Zu("\\coloncolonequals","\\Coloneqq"),Zu("\\equalscolon","\\eqqcolon"),Zu("\\equalscoloncolon","\\Eqqcolon"),Zu("\\colonminus","\\coloneq"),Zu("\\coloncolonminus","\\Coloneq"),Zu("\\minuscolon","\\eqcolon"),Zu("\\minuscoloncolon","\\Eqcolon"),Zu("\\coloncolonapprox","\\Colonapprox"),Zu("\\coloncolonsim","\\Colonsim"),Zu("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),Zu("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}"),Zu("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),Zu("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}"),Zu("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}"),Zu("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),Zu("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),Zu("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),Zu("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),Zu("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}"),Zu("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}"),Zu("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}"),Zu("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}"),Zu("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}"),Zu("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}"),Zu("\\ngeqq","\\html@mathml{\\@ngeqq}{}"),Zu("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}"),Zu("\\nleqq","\\html@mathml{\\@nleqq}{}"),Zu("\\nleqslant","\\html@mathml{\\@nleqslant}{}"),Zu("\\nshortmid","\\html@mathml{\\@nshortmid}{}"),Zu("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}"),Zu("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}"),Zu("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}"),Zu("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}"),Zu("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}"),Zu("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}"),Zu("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}"),Zu("\\imath","\\html@mathml{\\@imath}{}"),Zu("\\jmath","\\html@mathml{\\@jmath}{}"),Zu("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}"),Zu("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}"),Zu("","\\llbracket"),Zu("","\\rrbracket"),Zu("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}"),Zu("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}"),Zu("","\\lBrace"),Zu("","\\rBrace"),Zu("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}"),Zu("","\\minuso"),Zu("\\darr","\\downarrow"),Zu("\\dArr","\\Downarrow"),Zu("\\Darr","\\Downarrow"),Zu("\\lang","\\langle"),Zu("\\rang","\\rangle"),Zu("\\uarr","\\uparrow"),Zu("\\uArr","\\Uparrow"),Zu("\\Uarr","\\Uparrow"),Zu("\\N","\\mathbb{N}"),Zu("\\R","\\mathbb{R}"),Zu("\\Z","\\mathbb{Z}"),Zu("\\alef","\\aleph"),Zu("\\alefsym","\\aleph"),Zu("\\Alpha","\\mathrm{A}"),Zu("\\Beta","\\mathrm{B}"),Zu("\\bull","\\bullet"),Zu("\\Chi","\\mathrm{X}"),Zu("\\clubs","\\clubsuit"),Zu("\\cnums","\\mathbb{C}"),Zu("\\Complex","\\mathbb{C}"),Zu("\\Dagger","\\ddagger"),Zu("\\diamonds","\\diamondsuit"),Zu("\\empty","\\emptyset"),Zu("\\Epsilon","\\mathrm{E}"),Zu("\\Eta","\\mathrm{H}"),Zu("\\exist","\\exists"),Zu("\\harr","\\leftrightarrow"),Zu("\\hArr","\\Leftrightarrow"),Zu("\\Harr","\\Leftrightarrow"),Zu("\\hearts","\\heartsuit"),Zu("\\image","\\Im"),Zu("\\infin","\\infty"),Zu("\\Iota","\\mathrm{I}"),Zu("\\isin","\\in"),Zu("\\Kappa","\\mathrm{K}"),Zu("\\larr","\\leftarrow"),Zu("\\lArr","\\Leftarrow"),Zu("\\Larr","\\Leftarrow"),Zu("\\lrarr","\\leftrightarrow"),Zu("\\lrArr","\\Leftrightarrow"),Zu("\\Lrarr","\\Leftrightarrow"),Zu("\\Mu","\\mathrm{M}"),Zu("\\natnums","\\mathbb{N}"),Zu("\\Nu","\\mathrm{N}"),Zu("\\Omicron","\\mathrm{O}"),Zu("\\plusmn","\\pm"),Zu("\\rarr","\\rightarrow"),Zu("\\rArr","\\Rightarrow"),Zu("\\Rarr","\\Rightarrow"),Zu("\\real","\\Re"),Zu("\\reals","\\mathbb{R}"),Zu("\\Reals","\\mathbb{R}"),Zu("\\Rho","\\mathrm{P}"),Zu("\\sdot","\\cdot"),Zu("\\sect","\\S"),Zu("\\spades","\\spadesuit"),Zu("\\sub","\\subset"),Zu("\\sube","\\subseteq"),Zu("\\supe","\\supseteq"),Zu("\\Tau","\\mathrm{T}"),Zu("\\thetasym","\\vartheta"),Zu("\\weierp","\\wp"),Zu("\\Zeta","\\mathrm{Z}"),Zu("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),Zu("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),Zu("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),Zu("\\bra","\\mathinner{\\langle{#1}|}"),Zu("\\ket","\\mathinner{|{#1}\\rangle}"),Zu("\\braket","\\mathinner{\\langle{#1}\\rangle}"),Zu("\\Bra","\\left\\langle#1\\right|"),Zu("\\Ket","\\left|#1\\right\\rangle");var Jp=e=>t=>{var n=t.consumeArg().tokens,i=t.consumeArg().tokens,r=t.consumeArg().tokens,s=t.consumeArg().tokens,o=t.macros.get("|"),a=t.macros.get("\\|");t.macros.beginGroup();var l=t=>n=>{e&&(n.macros.set("|",o),r.length&&n.macros.set("\\|",a));var s=t;return!t&&r.length&&"|"===n.future().text&&(n.popToken(),s=!0),{tokens:s?r:i,numArgs:0}};t.macros.set("|",l(!1)),r.length&&t.macros.set("\\|",l(!0));var c=t.consumeArg().tokens,d=t.expandTokens([...s,...c,...n]);return t.macros.endGroup(),{tokens:d.reverse(),numArgs:0}};Zu("\\bra@ket",Jp(!1)),Zu("\\bra@set",Jp(!0)),Zu("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}"),Zu("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}"),Zu("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}"),Zu("\\angln","{\\angl n}"),Zu("\\blue","\\textcolor{##6495ed}{#1}"),Zu("\\orange","\\textcolor{##ffa500}{#1}"),Zu("\\pink","\\textcolor{##ff00af}{#1}"),Zu("\\red","\\textcolor{##df0030}{#1}"),Zu("\\green","\\textcolor{##28ae7b}{#1}"),Zu("\\gray","\\textcolor{gray}{#1}"),Zu("\\purple","\\textcolor{##9d38bd}{#1}"),Zu("\\blueA","\\textcolor{##ccfaff}{#1}"),Zu("\\blueB","\\textcolor{##80f6ff}{#1}"),Zu("\\blueC","\\textcolor{##63d9ea}{#1}"),Zu("\\blueD","\\textcolor{##11accd}{#1}"),Zu("\\blueE","\\textcolor{##0c7f99}{#1}"),Zu("\\tealA","\\textcolor{##94fff5}{#1}"),Zu("\\tealB","\\textcolor{##26edd5}{#1}"),Zu("\\tealC","\\textcolor{##01d1c1}{#1}"),Zu("\\tealD","\\textcolor{##01a995}{#1}"),Zu("\\tealE","\\textcolor{##208170}{#1}"),Zu("\\greenA","\\textcolor{##b6ffb0}{#1}"),Zu("\\greenB","\\textcolor{##8af281}{#1}"),Zu("\\greenC","\\textcolor{##74cf70}{#1}"),Zu("\\greenD","\\textcolor{##1fab54}{#1}"),Zu("\\greenE","\\textcolor{##0d923f}{#1}"),Zu("\\goldA","\\textcolor{##ffd0a9}{#1}"),Zu("\\goldB","\\textcolor{##ffbb71}{#1}"),Zu("\\goldC","\\textcolor{##ff9c39}{#1}"),Zu("\\goldD","\\textcolor{##e07d10}{#1}"),Zu("\\goldE","\\textcolor{##a75a05}{#1}"),Zu("\\redA","\\textcolor{##fca9a9}{#1}"),Zu("\\redB","\\textcolor{##ff8482}{#1}"),Zu("\\redC","\\textcolor{##f9685d}{#1}"),Zu("\\redD","\\textcolor{##e84d39}{#1}"),Zu("\\redE","\\textcolor{##bc2612}{#1}"),Zu("\\maroonA","\\textcolor{##ffbde0}{#1}"),Zu("\\maroonB","\\textcolor{##ff92c6}{#1}"),Zu("\\maroonC","\\textcolor{##ed5fa6}{#1}"),Zu("\\maroonD","\\textcolor{##ca337c}{#1}"),Zu("\\maroonE","\\textcolor{##9e034e}{#1}"),Zu("\\purpleA","\\textcolor{##ddd7ff}{#1}"),Zu("\\purpleB","\\textcolor{##c6b9fc}{#1}"),Zu("\\purpleC","\\textcolor{##aa87ff}{#1}"),Zu("\\purpleD","\\textcolor{##7854ab}{#1}"),Zu("\\purpleE","\\textcolor{##543b78}{#1}"),Zu("\\mintA","\\textcolor{##f5f9e8}{#1}"),Zu("\\mintB","\\textcolor{##edf2df}{#1}"),Zu("\\mintC","\\textcolor{##e0e5cc}{#1}"),Zu("\\grayA","\\textcolor{##f6f7f7}{#1}"),Zu("\\grayB","\\textcolor{##f0f1f2}{#1}"),Zu("\\grayC","\\textcolor{##e3e5e6}{#1}"),Zu("\\grayD","\\textcolor{##d6d8da}{#1}"),Zu("\\grayE","\\textcolor{##babec2}{#1}"),Zu("\\grayF","\\textcolor{##888d93}{#1}"),Zu("\\grayG","\\textcolor{##626569}{#1}"),Zu("\\grayH","\\textcolor{##3b3e40}{#1}"),Zu("\\grayI","\\textcolor{##21242c}{#1}"),Zu("\\kaBlue","\\textcolor{##314453}{#1}"),Zu("\\kaGreen","\\textcolor{##71B307}{#1}");var Qp={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class em{constructor(e,t,n){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new Hp(Wp,t.macros),this.mode=n,this.stack=[]}feed(e){this.lexer=new Kp(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return 0===this.stack.length&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,n,i;if(e){if(this.consumeSpaces(),"["!==this.future().text)return null;t=this.popToken(),({tokens:i,end:n}=this.consumeArg(["]"]))}else({tokens:i,start:t,end:n}=this.consumeArg());return this.pushToken(new fc("EOF",n.loc)),this.pushTokens(i),t.range(n,"")}consumeSpaces(){for(;" "===this.future().text;)this.stack.pop()}consumeArg(e){var t=[],n=e&&e.length>0;n||this.consumeSpaces();var i,r=this.future(),s=0,o=0;do{if(i=this.popToken(),t.push(i),"{"===i.text)++s;else if("}"===i.text){if(-1==--s)throw new vc("Extra }",i)}else if("EOF"===i.text)throw new vc("Unexpected end of input in a macro argument, expected '"+(e&&n?e[o]:"}")+"'",i);if(e&&n)if((0===s||1===s&&"{"===e[o])&&i.text===e[o]){if(++o===e.length){t.splice(-o,o);break}}else o=0}while(0!==s||n);return"{"===r.text&&"}"===t[t.length-1].text&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:r,end:i}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new vc("The length of delimiters doesn't match the number of args!");for(var n=t[0],i=0;i<n.length;i++){var r=this.popToken();if(n[i]!==r.text)throw new vc("Use of the macro doesn't match its definition",r)}}for(var s=[],o=0;o<e;o++)s.push(this.consumeArg(t&&t[o+1]).tokens);return s}expandOnce(e){var t=this.popToken(),n=t.text,i=t.noexpand?null:this._getExpansion(n);if(null==i||e&&i.unexpandable){if(e&&null==i&&"\\"===n[0]&&!this.isDefined(n))throw new vc("Undefined control sequence: "+n);return this.pushToken(t),t}if(this.expansionCount++,this.expansionCount>this.settings.maxExpand)throw new vc("Too many expansions: infinite loop or need to increase maxExpand setting");var r=i.tokens,s=this.consumeArgs(i.numArgs,i.delimiters);if(i.numArgs)for(var o=(r=r.slice()).length-1;o>=0;--o){var a=r[o];if("#"===a.text){if(0===o)throw new vc("Incomplete placeholder at end of macro body",a);if("#"===(a=r[--o]).text)r.splice(o+1,1);else{if(!/^[1-9]$/.test(a.text))throw new vc("Not a valid argument number",a);r.splice(o,2,...s[+a.text-1])}}}return this.pushTokens(r),r}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;){var e=this.expandOnce();if(e instanceof fc)return e.treatAsRelax&&(e.text="\\relax"),this.stack.pop()}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new fc(e)]):void 0}expandTokens(e){var t=[],n=this.stack.length;for(this.pushTokens(e);this.stack.length>n;){var i=this.expandOnce(!0);i instanceof fc&&(i.treatAsRelax&&(i.noexpand=!1,i.treatAsRelax=!1),t.push(this.stack.pop()))}return t}expandMacroAsText(e){var t=this.expandMacro(e);return t?t.map((e=>e.text)).join(""):t}_getExpansion(e){var t=this.macros.get(e);if(null==t)return t;if(1===e.length){var n=this.lexer.catcodes[e];if(null!=n&&13!==n)return}var i="function"==typeof t?t(this):t;if("string"==typeof i){var r=0;if(-1!==i.indexOf("#"))for(var s=i.replace(/##/g,"");-1!==s.indexOf("#"+(r+1));)++r;for(var o=new Kp(i,this.settings),a=[],l=o.lex();"EOF"!==l.text;)a.push(l),l=o.lex();return a.reverse(),{tokens:a,numArgs:r}}return i}isDefined(e){return this.macros.has(e)||zp.hasOwnProperty(e)||Sd.math.hasOwnProperty(e)||Sd.text.hasOwnProperty(e)||Qp.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return null!=t?"string"==typeof t||"function"==typeof t||!t.unexpandable:zp.hasOwnProperty(e)&&!zp[e].primitive}}var tm=/^[]/,nm=Object.freeze({"":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9",:"a",:"e",:"h",:"i",:"j",:"k",:"l",:"m",:"n",:"o",:"p",:"r",:"s",:"t",:"u",:"v",:"x",:"",:"",:"",:"",:"","":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9",:"A",:"B",:"D",:"E",:"G",:"H",:"I",:"J",:"K",:"L",:"M",:"N",:"O",:"P",:"R",:"T",:"U",:"V",:"W",:"a",:"b",:"c",:"d",:"e",:"f",:"g",:"h",:"i",:"j",:"k",:"l",:"m",:"n",:"o",:"p",:"r",:"s",:"t",:"u",:"v",:"w",:"x",:"y",:"z",:"",:"",:"",:"",:"",:""}),im={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"},"":{text:"\\c"}},rm={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"c",:"c",:"d",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"k",:"l",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"C",:"C",:"D",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"K",:"L",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};class sm{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new em(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(void 0===t&&(t=!0),this.fetch().text!==e)throw new vc("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return null==this.nextToken&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new fc("}")),this.gullet.pushTokens(e);var n=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,n}parseExpression(e,t){for(var n=[];;){"math"===this.mode&&this.consumeSpaces();var i=this.fetch();if(-1!==sm.endOfExpression.indexOf(i.text))break;if(t&&i.text===t)break;if(e&&zp[i.text]&&zp[i.text].infix)break;var r=this.parseAtom(t);if(!r)break;"internal"!==r.type&&n.push(r)}return"text"===this.mode&&this.formLigatures(n),this.handleInfixNodes(n)}handleInfixNodes(e){for(var t,n=-1,i=0;i<e.length;i++)if("infix"===e[i].type){if(-1!==n)throw new vc("only one infix operator per group",e[i].token);n=i,t=e[i].replaceWith}if(-1!==n&&t){var r,s,o=e.slice(0,n),a=e.slice(n+1);return r=1===o.length&&"ordgroup"===o[0].type?o[0]:{type:"ordgroup",mode:this.mode,body:o},s=1===a.length&&"ordgroup"===a[0].type?a[0]:{type:"ordgroup",mode:this.mode,body:a},["\\\\abovefrac"===t?this.callFunction(t,[r,e[n],s],[]):this.callFunction(t,[r,s],[])]}return e}handleSupSubscript(e){var t=this.fetch(),n=t.text;this.consume(),this.consumeSpaces();var i=this.parseGroup(e);if(!i)throw new vc("Expected group after '"+n+"'",t);return i}formatUnsupportedCmd(e){for(var t=[],n=0;n<e.length;n++)t.push({type:"textord",mode:"text",text:e[n]});var i={type:"text",mode:this.mode,body:t};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[i]}}parseAtom(e){var t,n,i=this.parseGroup("atom",e);if("text"===this.mode)return i;for(;;){this.consumeSpaces();var r=this.fetch();if("\\limits"===r.text||"\\nolimits"===r.text){if(i&&"op"===i.type){var s="\\limits"===r.text;i.limits=s,i.alwaysHandleSupSub=!0}else{if(!i||"operatorname"!==i.type)throw new vc("Limit controls must follow a math operator",r);i.alwaysHandleSupSub&&(i.limits="\\limits"===r.text)}this.consume()}else if("^"===r.text){if(t)throw new vc("Double superscript",r);t=this.handleSupSubscript("superscript")}else if("_"===r.text){if(n)throw new vc("Double subscript",r);n=this.handleSupSubscript("subscript")}else if("'"===r.text){if(t)throw new vc("Double superscript",r);var o={type:"textord",mode:this.mode,text:"\\prime"},a=[o];for(this.consume();"'"===this.fetch().text;)a.push(o),this.consume();"^"===this.fetch().text&&a.push(this.handleSupSubscript("superscript")),t={type:"ordgroup",mode:this.mode,body:a}}else{if(!nm[r.text])break;var l=nm[r.text],c=tm.test(r.text);for(this.consume();;){var d=this.fetch().text;if(!nm[d])break;if(tm.test(d)!==c)break;this.consume(),l+=nm[d]}var h=new sm(l,this.settings).parse();c?n={type:"ordgroup",mode:"math",body:h}:t={type:"ordgroup",mode:"math",body:h}}}return t||n?{type:"supsub",mode:this.mode,base:i,sup:t,sub:n}:i}parseFunction(e,t){var n=this.fetch(),i=n.text,r=zp[i];if(!r)return null;if(this.consume(),t&&"atom"!==t&&!r.allowedInArgument)throw new vc("Got function '"+i+"' with no arguments"+(t?" as "+t:""),n);if("text"===this.mode&&!r.allowedInText)throw new vc("Can't use function '"+i+"' in text mode",n);if("math"===this.mode&&!1===r.allowedInMath)throw new vc("Can't use function '"+i+"' in math mode",n);var{args:s,optArgs:o}=this.parseArguments(i,r);return this.callFunction(i,s,o,n,e)}callFunction(e,t,n,i,r){var s={funcName:e,parser:this,token:i,breakOnTokenText:r},o=zp[e];if(o&&o.handler)return o.handler(s,t,n);throw new vc("No function handler for "+e)}parseArguments(e,t){var n=t.numArgs+t.numOptionalArgs;if(0===n)return{args:[],optArgs:[]};for(var i=[],r=[],s=0;s<n;s++){var o=t.argTypes&&t.argTypes[s],a=s<t.numOptionalArgs;(t.primitive&&null==o||"sqrt"===t.type&&1===s&&null==r[0])&&(o="primitive");var l=this.parseGroupOfType("argument to '"+e+"'",o,a);if(a)r.push(l);else{if(null==l)throw new vc("Null argument, please report this as a bug");i.push(l)}}return{args:i,optArgs:r}}parseGroupOfType(e,t,n){switch(t){case"color":return this.parseColorGroup(n);case"size":return this.parseSizeGroup(n);case"url":return this.parseUrlGroup(n);case"math":case"text":return this.parseArgumentGroup(n,t);case"hbox":var i=this.parseArgumentGroup(n,"text");return null!=i?{type:"styling",mode:i.mode,body:[i],style:"text"}:null;case"raw":var r=this.parseStringGroup("raw",n);return null!=r?{type:"raw",mode:"text",string:r.text}:null;case"primitive":if(n)throw new vc("A primitive argument cannot be optional");var s=this.parseGroup(e);if(null==s)throw new vc("Expected group as "+e,this.fetch());return s;case"original":case null:case void 0:return this.parseArgumentGroup(n);default:throw new vc("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;" "===this.fetch().text;)this.consume()}parseStringGroup(e,t){var n=this.gullet.scanArgument(t);if(null==n)return null;for(var i,r="";"EOF"!==(i=this.fetch()).text;)r+=i.text,this.consume();return this.consume(),n.text=r,n}parseRegexGroup(e,t){for(var n,i=this.fetch(),r=i,s="";"EOF"!==(n=this.fetch()).text&&e.test(s+n.text);)s+=(r=n).text,this.consume();if(""===s)throw new vc("Invalid "+t+": '"+i.text+"'",i);return i.range(r,s)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(null==t)return null;var n=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!n)throw new vc("Invalid color: '"+t.text+"'",t);var i=n[0];return/^[0-9a-f]{6}$/i.test(i)&&(i="#"+i),{type:"color-token",mode:this.mode,color:i}}parseSizeGroup(e){var t,n=!1;if(this.gullet.consumeSpaces(),!(t=e||"{"===this.gullet.future().text?this.parseStringGroup("size",e):this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size")))return null;e||0!==t.text.length||(t.text="0pt",n=!0);var i=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!i)throw new vc("Invalid size: '"+t.text+"'",t);var r={number:+(i[1]+i[2]),unit:i[3]};if(!id(r))throw new vc("Invalid unit: '"+r.unit+"'",t);return{type:"size",mode:this.mode,value:r,isBlank:n}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),null==t)return null;var n=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:n}}parseArgumentGroup(e,t){var n=this.gullet.scanArgument(e);if(null==n)return null;var i=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var r=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var s={type:"ordgroup",mode:this.mode,loc:n.loc,body:r};return t&&this.switchMode(i),s}parseGroup(e,t){var n,i=this.fetch(),r=i.text;if("{"===r||"\\begingroup"===r){this.consume();var s="{"===r?"}":"\\endgroup";this.gullet.beginGroup();var o=this.parseExpression(!1,s),a=this.fetch();this.expect(s),this.gullet.endGroup(),n={type:"ordgroup",mode:this.mode,loc:gc.range(i,a),body:o,semisimple:"\\begingroup"===r||void 0}}else if(null==(n=this.parseFunction(t,e)||this.parseSymbol())&&"\\"===r[0]&&!Qp.hasOwnProperty(r)){if(this.settings.throwOnError)throw new vc("Undefined control sequence: "+r,i);n=this.formatUnsupportedCmd(r),this.consume()}return n}formLigatures(e){for(var t=e.length-1,n=0;n<t;++n){var i=e[n],r=i.text;"-"===r&&"-"===e[n+1].text&&(n+1<t&&"-"===e[n+2].text?(e.splice(n,3,{type:"textord",mode:"text",loc:gc.range(i,e[n+2]),text:"---"}),t-=2):(e.splice(n,2,{type:"textord",mode:"text",loc:gc.range(i,e[n+1]),text:"--"}),t-=1)),"'"!==r&&"`"!==r||e[n+1].text!==r||(e.splice(n,2,{type:"textord",mode:"text",loc:gc.range(i,e[n+1]),text:r+r}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var n=t.slice(5),i="*"===n.charAt(0);if(i&&(n=n.slice(1)),n.length<2||n.charAt(0)!==n.slice(-1))throw new vc("\\verb assertion failed --\n                    please report what input caused this bug");return{type:"verb",mode:"text",body:n=n.slice(1,-1),star:i}}rm.hasOwnProperty(t[0])&&!Sd[this.mode][t[0]]&&(this.settings.strict&&"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=rm[t[0]]+t.substr(1));var r,s=Vp.exec(t);if(s&&("i"===(t=t.substring(0,s.index))?t="":"j"===t&&(t="")),Sd[this.mode][t]){this.settings.strict&&"math"===this.mode&&Qd.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var o,a=Sd[this.mode][t].group,l=gc.range(e);if(bd.hasOwnProperty(a)){var c=a;o={type:"atom",mode:this.mode,family:c,loc:l,text:t}}else o={type:a,mode:this.mode,loc:l,text:t};r=o}else{if(!(t.charCodeAt(0)>=128))return null;this.settings.strict&&(Vc(t.charCodeAt(0))?"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'" ('+t.charCodeAt(0)+")",e)),r={type:"textord",mode:"text",loc:gc.range(e),text:t}}if(this.consume(),s)for(var d=0;d<s[0].length;d++){var h=s[0][d];if(!im[h])throw new vc("Unknown accent ' "+h+"'",e);var u=im[h][this.mode]||im[h].text;if(!u)throw new vc("Accent "+h+" unsupported in "+this.mode+" mode",e);r={type:"accent",mode:this.mode,loc:gc.range(e),label:u,isStretchy:!1,isShifty:!0,base:r}}return r}}sm.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var om=function(e,t){if(!("string"==typeof e||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var n=new sm(e,t);delete n.gullet.macros.current["\\df@tag"];var i=n.parse();if(delete n.gullet.macros.current["\\current@color"],delete n.gullet.macros.current["\\color"],n.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new vc("\\tag works only in display equations");i=[{type:"tag",mode:"text",body:i,tag:n.subparse([new fc("\\df@tag")])}]}return i},am=function(e,t,n){t.textContent="";var i=cm(e,n).toNode();t.appendChild(i)};"undefined"!=typeof document&&"CSS1Compat"!==document.compatMode&&("undefined"!=typeof console&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),am=function(){throw new vc("KaTeX doesn't work in quirks mode.")});var lm=function(e,t,n){if(n.throwOnError||!(e instanceof vc))throw e;var i=mh.makeSpan(["katex-error"],[new md(t)]);return i.setAttribute("title",e.toString()),i.setAttribute("style","color:"+n.errorColor),i},cm=function(e,t){var n=new Pc(t);try{return function(e,t,n){var i,r=Jh(n);if("mathml"===n.output)return Zh(e,t,r,n.displayMode,!0);if("html"===n.output){var s=Uh(e,r);i=mh.makeSpan(["katex"],[s])}else{var o=Zh(e,t,r,n.displayMode,!1),a=Uh(e,r);i=mh.makeSpan(["katex"],[o,a])}return Qh(i,n)}(om(e,n),e,n)}catch(t){return lm(t,e,n)}},dm={version:"0.16.0",render:am,renderToString:function(e,t){return cm(e,t).toMarkup()},ParseError:vc,SETTINGS_SCHEMA:Ic,__parse:function(e,t){var n=new Pc(t);return om(e,n)},__renderToDomTree:cm,__renderToHTMLTree:function(e,t){var n=new Pc(t);try{return function(e,t,n){var i=Uh(e,Jh(n)),r=mh.makeSpan(["katex"],[i]);return Qh(r,n)}(om(e,n),0,n)}catch(t){return lm(t,e,n)}},__setFontMetrics:function(e,t){Wc[e]=t},__defineSymbol:_d,__defineMacro:Zu,__domTree:{Span:dd,Anchor:hd,SymbolNode:md,SvgNode:gd,PathNode:fd,LineNode:vd}};function hm(e){e&&Array.from(e.querySelectorAll("[data-mx-maths]")).forEach((e=>{"DIV"===e.tagName?dm.render(e.dataset.mxMaths,e,{displayMode:!0,throwOnError:!1}):dm.render(e.dataset.mxMaths,e,{throwOnError:!1})}))}function um(e){e&&Array.from(e.querySelectorAll("a[href]")).forEach((e=>{try{const t=new URL(e.getAttribute("href"));if(t.host===window.location.host&&t.pathname===window.location.pathname){const t=new URL(e.getAttribute("href")).hash;e.addEventListener("click",(e=>{e.preventDefault(),Pl.push(t.slice(1))}))}else if("matrix.to"===t.host){const n=tt.client.getUser(t.hash.slice(2));if(e.addEventListener("click",(e=>e.preventDefault())),n){const t=new we(n.userId);e.style.setProperty("--user_dark",t.dark)}}}catch(e){}}))}function pm(e){return e>=3600?`${Math.floor(e/3600)}:${Math.floor(e%3600/60)}:${Math.floor(e%60)}`:`${Math.floor(e/60)}:${e%60<=9?0:""}${Math.floor(e%60)}`}function mm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class gm extends m{constructor(...e){super(...e),mm(this,"displayName",tt.client.getUser(this.props.userId).displayName),mm(this,"avatarUrl",tt.client.getUser(this.props.userId).avatarUrl),mm(this,"avatarHttpURI",tt.client.getHttpUriForMxcFromHS(this.avatarUrl,20,20,"crop")),mm(this,"userColor",new we(this.props.userId)),mm(this,"theClass",this.props.isMe?"user-info-message message-from-user":this.props.isReply?"reply-sender-info":"user-info-message")}render(){return h("div",{class:this.theClass,style:this.userColor.styleVariables},this.avatarHttpURI?h("img",{src:this.avatarHttpURI}):null,h("span",null,this.displayName))}}function fm(e){return!(!e["m.relates_to"]||!e["m.relates_to"]["m.in_reply_to"])}function vm(e){for(;e.length&&e[0].startsWith("> ");)e.shift();""===e[0]&&e.shift()}function ym(e){const t=e.trim().split("\n");for(;t.length&&t[0].startsWith("> ");)t.shift();return""===t[0]&&t.shift(),t.join("\n")}function bm(e){let t;const n=e.getSender();switch(e.getContent().msgtype){case"m.file":t=["sent a file"];break;case"m.audio":t=["sent an audio file"];break;case"m.video":t=["sent a video"];break;default:t=e.getContent().body.trim().split("\n"),fm(e.getContent())&&vm(t)}return t.length>0&&(t[0]=`<${n}> ${t[0]}`),`${t.map((e=>`> ${e}`)).join("\n")}\n\n`}function wm(e){let t;const n=e.getSender();switch(e.getContent().msgtype){case"m.file":t="sent a file";break;case"m.audio":t="sent an audio file";break;case"m.video":t="sent a video";break;default:{const n=e.getContent().formatted_body||e.getContent().body.replace(/\n/g,"<br>");t=mc()(n,Em)}}return`<mx-reply><blockquote><a href="https://matrix.to/#/${e.getRoomId()}/${e.getId()}">In reply to</a> <a href="https://matrix.to/#/${n}">${n}</a><br>${t}</blockquote></mx-reply>`}function Sm(e){const t=e.formatted_body;if(!t)return"";const n=(new DOMParser).parseFromString(t,"text/html").body,i=n.querySelector("mx-reply > blockquote");return i?.removeChild(n.querySelector("a")),i?.removeChild(n.querySelector("a")),i?.removeChild(n.querySelector("br")),i?i.outerHTML:""}function _m(e){const t=e.body.trim().split("\n");if(t.length>2&&t[0].startsWith("> <")){const e=[];for(const n of t){if(!n.startsWith("> "))break;e.push(n)}return`${e.join("\n")}\n\n`}return""}const Em={allowedTags:!1,allowedAttributes:!1,allowedSchemes:["http","https","ftp","mailto","magnet","mxc"],exclusiveFilter:e=>"mx-reply"===e.tag},km=/\\\$/,xm=/\$(([^$]|\\\\$)*)\$/,Tm=/\$\$(([^$]|\\\\$)*)\$\$/,Cm=/@\S*:\S*/;function Am(e){const t=new RegExp(`${km.source}|${Tm.source}|${xm.source}|${Cm.source}`,"gm");return e.replaceAll(t,Im)}function Im(e){return Tm.test(e)?function(e){const t=document.createElement("div");return t.dataset.mxMaths=e,t.innerText=e,t.outerHTML}(e.match(Tm)[1]):xm.test(e)?function(e){const t=document.createElement("span");return t.dataset.mxMaths=e,t.innerText=e,t.outerHTML}(e.match(xm)[1]):Cm.test(e)?function(e){const t=tt.client.getUser(e);if(!t)return e;const n=document.createElement("a");return n.href=`https://matrix.to/#/${t.userId}`,n.innerText=t.displayName||t.userId,n.outerHTML}(e):km.test(e)?"$":void 0}function Rm(e){switch(e._type){case"document":case"block_quote":case"list":case"item":case"paragraph":case"heading":case"emph":case"strong":case"link":case"image":case"custom_inline":case"custom_block":return!0;default:return!1}}var Pm=function(e,t){this.current=e,this.entering=!0===t},Om=function(){var e=this.current,t=this.entering;if(null===e)return null;var n=Rm(e);return t&&n?e._firstChild?(this.current=e._firstChild,this.entering=!0):this.entering=!1:e===this.root?this.current=null:null===e._next?(this.current=e._parent,this.entering=!1):(this.current=e._next,this.entering=!0),{entering:t,node:e}},Mm=function(e){return{current:e,root:e,entering:!0,next:Om,resumeAt:Pm}},Dm=function(e,t){this._type=e,this._parent=null,this._firstChild=null,this._lastChild=null,this._prev=null,this._next=null,this._sourcepos=t,this._lastLineBlank=!1,this._lastLineChecked=!1,this._open=!0,this._string_content=null,this._literal=null,this._listData={},this._info=null,this._destination=null,this._title=null,this._isFenced=!1,this._fenceChar=null,this._fenceLength=0,this._fenceOffset=null,this._level=null,this._onEnter=null,this._onExit=null},Lm=Dm.prototype;Object.defineProperty(Lm,"isContainer",{get:function(){return Rm(this)}}),Object.defineProperty(Lm,"type",{get:function(){return this._type}}),Object.defineProperty(Lm,"firstChild",{get:function(){return this._firstChild}}),Object.defineProperty(Lm,"lastChild",{get:function(){return this._lastChild}}),Object.defineProperty(Lm,"next",{get:function(){return this._next}}),Object.defineProperty(Lm,"prev",{get:function(){return this._prev}}),Object.defineProperty(Lm,"parent",{get:function(){return this._parent}}),Object.defineProperty(Lm,"sourcepos",{get:function(){return this._sourcepos}}),Object.defineProperty(Lm,"literal",{get:function(){return this._literal},set:function(e){this._literal=e}}),Object.defineProperty(Lm,"destination",{get:function(){return this._destination},set:function(e){this._destination=e}}),Object.defineProperty(Lm,"title",{get:function(){return this._title},set:function(e){this._title=e}}),Object.defineProperty(Lm,"info",{get:function(){return this._info},set:function(e){this._info=e}}),Object.defineProperty(Lm,"level",{get:function(){return this._level},set:function(e){this._level=e}}),Object.defineProperty(Lm,"listType",{get:function(){return this._listData.type},set:function(e){this._listData.type=e}}),Object.defineProperty(Lm,"listTight",{get:function(){return this._listData.tight},set:function(e){this._listData.tight=e}}),Object.defineProperty(Lm,"listStart",{get:function(){return this._listData.start},set:function(e){this._listData.start=e}}),Object.defineProperty(Lm,"listDelimiter",{get:function(){return this._listData.delimiter},set:function(e){this._listData.delimiter=e}}),Object.defineProperty(Lm,"onEnter",{get:function(){return this._onEnter},set:function(e){this._onEnter=e}}),Object.defineProperty(Lm,"onExit",{get:function(){return this._onExit},set:function(e){this._onExit=e}}),Dm.prototype.appendChild=function(e){e.unlink(),e._parent=this,this._lastChild?(this._lastChild._next=e,e._prev=this._lastChild,this._lastChild=e):(this._firstChild=e,this._lastChild=e)},Dm.prototype.prependChild=function(e){e.unlink(),e._parent=this,this._firstChild?(this._firstChild._prev=e,e._next=this._firstChild,this._firstChild=e):(this._firstChild=e,this._lastChild=e)},Dm.prototype.unlink=function(){this._prev?this._prev._next=this._next:this._parent&&(this._parent._firstChild=this._next),this._next?this._next._prev=this._prev:this._parent&&(this._parent._lastChild=this._prev),this._parent=null,this._next=null,this._prev=null},Dm.prototype.insertAfter=function(e){e.unlink(),e._next=this._next,e._next&&(e._next._prev=e),e._prev=this,this._next=e,e._parent=this._parent,e._next||(e._parent._lastChild=e)},Dm.prototype.insertBefore=function(e){e.unlink(),e._prev=this._prev,e._prev&&(e._prev._next=e),e._next=this,this._prev=e,e._parent=this._parent,e._prev||(e._parent._firstChild=e)},Dm.prototype.walker=function(){return new Mm(this)};const Fm=Dm;var Nm,jm=__webpack_require__(729),Bm=__webpack_require__(5863),Um=new RegExp("^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>]|\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e|[<][?][\\s\\S]*?[?][>]|<![A-Z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)"),qm=/[\\&]/,zm="[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]",Vm=new RegExp("\\\\"+zm+"|&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});","gi"),Km=new RegExp('[&<>"]',"g"),Hm=function(e){return 92===e.charCodeAt(0)?e.charAt(1):(0,Bm.decodeHTML)(e)},Wm=function(e){return qm.test(e)?e.replace(Vm,Hm):e},$m=function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return e}},Gm=function(e){return Km.test(e)?e.replace(Km,$m):e};function Ym(e){return Nm(e)}if(String.fromCodePoint)Nm=function(e){try{return String.fromCodePoint(e)}catch(e){if(e instanceof RangeError)return String.fromCharCode(65533);throw e}};else{var Xm=String.fromCharCode,Zm=Math.floor;Nm=function(){var e,t,n=16384,i=[],r=-1,s=arguments.length;if(!s)return"";for(var o="";++r<s;){var a=Number(arguments[r]);if(!isFinite(a)||a<0||a>1114111||Zm(a)!==a)return String.fromCharCode(65533);a<=65535?i.push(a):(e=55296+((a-=65536)>>10),t=a%1024+56320,i.push(e,t)),(r+1===s||i.length>n)&&(o+=Xm.apply(null,i),i.length=0)}return o}}__webpack_require__(8822);var Jm=function(e){try{return jm(e)}catch(t){return e}},Qm=Wm,eg=39,tg=34,ng=zm,ig="\\\\"+ng,rg=Um,sg=new RegExp(/^[!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/),og=new RegExp('^(?:"('+ig+'|[^"\\x00])*"|\'('+ig+"|[^'\\x00])*'|\\(("+ig+"|[^()\\x00])*\\))"),ag=/^(?:<(?:[^<>\n\\\x00]|\\.)*>)/,lg=new RegExp("^"+ng),cg=new RegExp("^&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});","i"),dg=/`+/,hg=/^`+/,ug=/\.\.\./g,pg=/--+/g,mg=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,gg=/^<[A-Za-z][A-Za-z0-9.+-]{1,31}:[^<>\x00-\x20]*>/i,fg=/^ *(?:\n *)?/,vg=/^[ \t\n\x0b\x0c\x0d]/,yg=/^\s/,bg=/ *$/,wg=/^ */,Sg=/^ *(?:\n|$)/,_g=/^\[(?:[^\\\[\]]|\\.){0,1000}\]/s,Eg=/^[^\n`\[\]\\!<&*_'"]+/m,kg=function(e){var t=new Fm("text");return t._literal=e,t},xg=function(e){return e.slice(1,e.length-1).trim().replace(/[ \t\r\n]+/," ").toLowerCase().toUpperCase()},Tg=function(e){var t=e.exec(this.subject.slice(this.pos));return null===t?null:(this.pos+=t.index+t[0].length,t[0])},Cg=function(){return this.pos<this.subject.length?this.subject.charCodeAt(this.pos):-1},Ag=function(){return this.match(fg),!0},Ig=function(e){var t=this.match(hg);if(null===t)return!1;for(var n,i,r,s=this.pos;null!==(n=this.match(dg));)if(n===t)return i=new Fm("code"),(r=this.subject.slice(s,this.pos-t.length).replace(/\n/gm," ")).length>0&&null!==r.match(/[^ ]/)&&" "==r[0]&&" "==r[r.length-1]?i._literal=r.slice(1,r.length-1):i._literal=r,e.appendChild(i),!0;return this.pos=s,e.appendChild(kg(t)),!0},Rg=function(e){var t,n=this.subject;return this.pos+=1,10===this.peek()?(this.pos+=1,t=new Fm("linebreak"),e.appendChild(t)):lg.test(n.charAt(this.pos))?(e.appendChild(kg(n.charAt(this.pos))),this.pos+=1):e.appendChild(kg("\\")),!0},Pg=function(e){var t,n,i;return(t=this.match(mg))?(n=t.slice(1,t.length-1),(i=new Fm("link"))._destination=Jm("mailto:"+n),i._title="",i.appendChild(kg(n)),e.appendChild(i),!0):!!(t=this.match(gg))&&(n=t.slice(1,t.length-1),(i=new Fm("link"))._destination=Jm(n),i._title="",i.appendChild(kg(n)),e.appendChild(i),!0)},Og=function(e){var t=this.match(rg);if(null===t)return!1;var n=new Fm("html_inline");return n._literal=t,e.appendChild(n),!0},Mg=function(e){var t,n,i,r,s,o,a,l,c,d,h,u=0,p=this.pos;if(e===eg||e===tg)u++,this.pos++;else for(;this.peek()===e;)u++,this.pos++;return 0===u?null:(t=0===p?"\n":this.subject.charAt(p-1),n=-1===(i=this.peek())?"\n":Ym(i),l=yg.test(n),c=sg.test(n),d=yg.test(t),h=sg.test(t),r=!l&&(!c||d||h),s=!d&&(!h||l||c),95===e?(o=r&&(!s||h),a=s&&(!r||c)):e===eg||e===tg?(o=r&&!s,a=s):(o=r,a=s),this.pos=p,{numdelims:u,can_open:o,can_close:a})},Dg=function(e,t){var n=this.scanDelims(e);if(!n)return!1;var i,r=n.numdelims,s=this.pos;this.pos+=r,i=e===eg?"":e===tg?"":this.subject.slice(s,this.pos);var o=kg(i);return t.appendChild(o),(n.can_open||n.can_close)&&(this.options.smart||e!==eg&&e!==tg)&&(this.delimiters={cc:e,numdelims:r,origdelims:r,node:o,previous:this.delimiters,next:null,can_open:n.can_open,can_close:n.can_close},null!==this.delimiters.previous&&(this.delimiters.previous.next=this.delimiters)),!0},Lg=function(e){null!==e.previous&&(e.previous.next=e.next),null===e.next?this.delimiters=e.previous:e.next.previous=e.previous},Fg=function(e,t){e.next!==t&&(e.next=t,t.previous=e)},Ng=function(e){for(var t,n,i,r,s,o,a,l,c,d,h,u=[],p=!1,m=0;m<8;m++)u[m]=e;for(n=this.delimiters;null!==n&&n.previous!==e;)n=n.previous;for(;null!==n;){var g=n.cc;if(n.can_close){switch(t=n.previous,d=!1,g){case eg:h=0;break;case tg:h=1;break;case 95:h=2;break;case 42:h=3+(n.can_open?3:0)+n.origdelims%3}for(;null!==t&&t!==e&&t!==u[h];){if(p=(n.can_open||t.can_close)&&n.origdelims%3!=0&&(t.origdelims+n.origdelims)%3==0,t.cc===n.cc&&t.can_open&&!p){d=!0;break}t=t.previous}if(i=n,42===g||95===g)if(d){a=n.numdelims>=2&&t.numdelims>=2?2:1,r=t.node,s=n.node,t.numdelims-=a,n.numdelims-=a,r._literal=r._literal.slice(0,r._literal.length-a),s._literal=s._literal.slice(0,s._literal.length-a);var f=new Fm(1===a?"emph":"strong");for(l=r._next;l&&l!==s;)c=l._next,l.unlink(),f.appendChild(l),l=c;r.insertAfter(f),Fg(t,n),0===t.numdelims&&(r.unlink(),this.removeDelimiter(t)),0===n.numdelims&&(s.unlink(),o=n.next,this.removeDelimiter(n),n=o)}else n=n.next;else g===eg?(n.node._literal="",d&&(t.node._literal=""),n=n.next):g===tg&&(n.node._literal="",d&&(t.node.literal=""),n=n.next);d||(u[h]=i.previous,i.can_open||this.removeDelimiter(i))}else n=n.next}for(;null!==this.delimiters&&this.delimiters!==e;)this.removeDelimiter(this.delimiters)},jg=function(){var e=this.match(og);return null===e?null:Qm(e.substr(1,e.length-2))},Bg=function(){var e=this.match(ag);if(null===e){if(60===this.peek())return null;for(var t,n=this.pos,i=0;-1!==(t=this.peek());)if(92===t&&lg.test(this.subject.charAt(this.pos+1)))this.pos+=1,-1!==this.peek()&&(this.pos+=1);else if(40===t)this.pos+=1,i+=1;else if(41===t){if(i<1)break;this.pos+=1,i-=1}else{if(null!==vg.exec(Ym(t)))break;this.pos+=1}return this.pos===n&&41!==t||0!==i?null:(e=this.subject.substr(n,this.pos-n),Jm(Qm(e)))}return Jm(Qm(e.substr(1,e.length-2)))},Ug=function(){var e=this.match(_g);return null===e||e.length>1001?0:e.length},qg=function(e){var t=this.pos;this.pos+=1;var n=kg("[");return e.appendChild(n),this.addBracket(n,t,!1),!0},zg=function(e){var t=this.pos;if(this.pos+=1,91===this.peek()){this.pos+=1;var n=kg("![");e.appendChild(n),this.addBracket(n,t+1,!0)}else e.appendChild(kg("!"));return!0},Vg=function(e){var t,n,i,r,s,o,a=!1;if(this.pos+=1,t=this.pos,null===(o=this.brackets))return e.appendChild(kg("]")),!0;if(!o.active)return e.appendChild(kg("]")),this.removeBracket(),!0;n=o.image;var l=this.pos;if(40===this.peek()&&(this.pos++,this.spnl()&&null!==(i=this.parseLinkDestination())&&this.spnl()&&(vg.test(this.subject.charAt(this.pos-1))&&(r=this.parseLinkTitle()),1)&&this.spnl()&&41===this.peek()?(this.pos+=1,a=!0):this.pos=l),!a){var c=this.pos,d=this.parseLinkLabel();if(d>2?s=this.subject.slice(c,c+d):o.bracketAfter||(s=this.subject.slice(o.index,t)),0===d&&(this.pos=l),s){var h=this.refmap[xg(s)];h&&(i=h.destination,r=h.title,a=!0)}}if(a){var u,p,m=new Fm(n?"image":"link");for(m._destination=i,m._title=r||"",u=o.node._next;u;)p=u._next,u.unlink(),m.appendChild(u),u=p;if(e.appendChild(m),this.processEmphasis(o.previousDelimiter),this.removeBracket(),o.node.unlink(),!n)for(o=this.brackets;null!==o;)o.image||(o.active=!1),o=o.previous;return!0}return this.removeBracket(),this.pos=t,e.appendChild(kg("]")),!0},Kg=function(e,t,n){null!==this.brackets&&(this.brackets.bracketAfter=!0),this.brackets={node:e,previous:this.brackets,previousDelimiter:this.delimiters,index:t,image:n,active:!0}},Hg=function(){this.brackets=this.brackets.previous},Wg=function(e){var t;return!!(t=this.match(cg))&&(e.appendChild(kg((0,Bm.decodeHTML)(t))),!0)},$g=function(e){var t;return!!(t=this.match(Eg))&&(this.options.smart?e.appendChild(kg(t.replace(ug,"").replace(pg,(function(e){var t=0,n=0;return e.length%3==0?n=e.length/3:e.length%2==0?t=e.length/2:e.length%3==2?(t=1,n=(e.length-2)/3):(t=2,n=(e.length-4)/3),"".repeat(n)+"".repeat(t)})))):e.appendChild(kg(t)),!0)},Gg=function(e){this.pos+=1;var t=e._lastChild;if(t&&"text"===t.type&&" "===t._literal[t._literal.length-1]){var n=" "===t._literal[t._literal.length-2];t._literal=t._literal.replace(bg,""),e.appendChild(new Fm(n?"linebreak":"softbreak"))}else e.appendChild(new Fm("softbreak"));return this.match(wg),!0},Yg=function(e,t){var n,i,r,s;this.subject=e,this.pos=0;var o=this.pos;if(0===(s=this.parseLinkLabel()))return 0;if(n=this.subject.substr(0,s),58!==this.peek())return this.pos=o,0;if(this.pos++,this.spnl(),null===(i=this.parseLinkDestination()))return this.pos=o,0;var a=this.pos;this.spnl(),this.pos!==a&&(r=this.parseLinkTitle()),null===r&&(r="",this.pos=a);var l=!0;if(null===this.match(Sg)&&(""===r?l=!1:(r="",this.pos=a,l=null!==this.match(Sg))),!l)return this.pos=o,0;var c=xg(n);return""===c?(this.pos=o,0):(t[c]||(t[c]={destination:i,title:r}),this.pos-o)},Xg=function(e){var t=!1,n=this.peek();if(-1===n)return!1;switch(n){case 10:t=this.parseNewline(e);break;case 92:t=this.parseBackslash(e);break;case 96:t=this.parseBackticks(e);break;case 42:case 95:t=this.handleDelim(n,e);break;case eg:case tg:t=this.options.smart&&this.handleDelim(n,e);break;case 91:t=this.parseOpenBracket(e);break;case 33:t=this.parseBang(e);break;case 93:t=this.parseCloseBracket(e);break;case 60:t=this.parseAutolink(e)||this.parseHtmlTag(e);break;case 38:t=this.parseEntity(e);break;default:t=this.parseString(e)}return t||(this.pos+=1,e.appendChild(kg(Ym(n)))),!0},Zg=function(e){for(this.subject=e._string_content.trim(),this.pos=0,this.delimiters=null,this.brackets=null;this.parseInline(e););e._string_content=null,this.processEmphasis(null)};const Jg=function(e){return{subject:"",delimiters:null,brackets:null,pos:0,refmap:{},match:Tg,peek:Cg,spnl:Ag,parseBackticks:Ig,parseBackslash:Rg,parseAutolink:Pg,parseHtmlTag:Og,scanDelims:Mg,handleDelim:Dg,parseLinkTitle:jg,parseLinkDestination:Bg,parseLinkLabel:Ug,parseOpenBracket:qg,parseBang:zg,parseCloseBracket:Vg,addBracket:Kg,removeBracket:Hg,parseEntity:Wg,parseString:$g,parseNewline:Gg,parseReference:Yg,parseInline:Xg,processEmphasis:Ng,removeDelimiter:Lg,options:e||{},parse:Zg}};var Qg=[/./,/^<(?:script|pre|textarea|style)(?:\s|>|$)/i,/^<!--/,/^<[?]/,/^<![A-Z]/,/^<!\[CDATA\[/,/^<[/]?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[123456]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|[/]?[>]|$)/i,new RegExp("^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>])\\s*$","i")],ef=[/./,/<\/(?:script|pre|textarea|style)>/i,/-->/,/\?>/,/>/,/\]\]>/],tf=/^(?:\*[ \t]*){3,}$|^(?:_[ \t]*){3,}$|^(?:-[ \t]*){3,}$/,nf=/^[#`~*+_=<>0-9-]/,rf=/[^ \t\f\v\r\n]/,sf=/^[*+-]/,of=/^(\d{1,9})([.)])/,af=/^#{1,6}(?:[ \t]+|$)/,lf=/^`{3,}(?!.*`)|^~{3,}/,cf=/^(?:`{3,}|~{3,})(?= *$)/,df=/^(?:=+|-+)[ \t]*$/,hf=/\r\n|\n|\r/,uf=function(e){return 32===e||9===e},pf=function(e,t){return t<e.length?e.charCodeAt(t):-1},mf=function(e){for(;e;){if(e._lastLineBlank)return!0;var t=e.type;if(e._lastLineChecked||"list"!==t&&"item"!==t){e._lastLineChecked=!0;break}e._lastLineChecked=!0,e=e._lastChild}return!1},gf=function(){if(this.partiallyConsumedTab){this.offset+=1;var e=4-this.column%4;this.tip._string_content+=" ".repeat(e)}this.tip._string_content+=this.currentLine.slice(this.offset)+"\n"},ff=function(e,t){for(;!this.blocks[this.tip.type].canContain(e);)this.finalize(this.tip,this.lineNumber-1);var n=t+1,i=new Fm(e,[[this.lineNumber,n],[0,0]]);return i._string_content="",this.tip.appendChild(i),this.tip=i,i},vf=function(){if(!this.allClosed){for(;this.oldtip!==this.lastMatchedContainer;){var e=this.oldtip._parent;this.finalize(this.oldtip,this.lineNumber-1),this.oldtip=e}this.allClosed=!0}},yf={document:{continue:function(){return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},list:{continue:function(){return 0},finalize:function(e,t){for(var n=t._firstChild;n;){if(mf(n)&&n._next){t._listData.tight=!1;break}for(var i=n._firstChild;i;){if(mf(i)&&(n._next||i._next)){t._listData.tight=!1;break}i=i._next}n=n._next}},canContain:function(e){return"item"===e},acceptsLines:!1},block_quote:{continue:function(e){var t=e.currentLine;return e.indented||62!==pf(t,e.nextNonspace)?1:(e.advanceNextNonspace(),e.advanceOffset(1,!1),uf(pf(t,e.offset))&&e.advanceOffset(1,!0),0)},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},item:{continue:function(e,t){if(e.blank){if(null==t._firstChild)return 1;e.advanceNextNonspace()}else{if(!(e.indent>=t._listData.markerOffset+t._listData.padding))return 1;e.advanceOffset(t._listData.markerOffset+t._listData.padding,!0)}return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},heading:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},thematic_break:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},code_block:{continue:function(e,t){var n=e.currentLine,i=e.indent;if(t._isFenced){var r=i<=3&&n.charAt(e.nextNonspace)===t._fenceChar&&n.slice(e.nextNonspace).match(cf);if(r&&r[0].length>=t._fenceLength)return e.lastLineLength=e.offset+i+r[0].length,e.finalize(t,e.lineNumber),2;for(var s=t._fenceOffset;s>0&&uf(pf(n,e.offset));)e.advanceOffset(1,!0),s--}else if(i>=4)e.advanceOffset(4,!0);else{if(!e.blank)return 1;e.advanceNextNonspace()}return 0},finalize:function(e,t){if(t._isFenced){var n=t._string_content,i=n.indexOf("\n"),r=n.slice(0,i),s=n.slice(i+1);t.info=Wm(r.trim()),t._literal=s}else t._literal=t._string_content.replace(/(\n *)+$/,"\n");t._string_content=null},canContain:function(){return!1},acceptsLines:!0},html_block:{continue:function(e,t){return!e.blank||6!==t._htmlBlockType&&7!==t._htmlBlockType?0:1},finalize:function(e,t){t._literal=t._string_content.replace(/(\n *)+$/,""),t._string_content=null},canContain:function(){return!1},acceptsLines:!0},paragraph:{continue:function(e){return e.blank?1:0},finalize:function(e,t){for(var n,i=!1;91===pf(t._string_content,0)&&(n=e.inlineParser.parseReference(t._string_content,e.refmap));)t._string_content=t._string_content.slice(n),i=!0;i&&function(e){return!rf.test(e)}(t._string_content)&&t.unlink()},canContain:function(){return!1},acceptsLines:!0}},bf=[function(e){return e.indented||62!==pf(e.currentLine,e.nextNonspace)?0:(e.advanceNextNonspace(),e.advanceOffset(1,!1),uf(pf(e.currentLine,e.offset))&&e.advanceOffset(1,!0),e.closeUnmatchedBlocks(),e.addChild("block_quote",e.nextNonspace),1)},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(af))){e.advanceNextNonspace(),e.advanceOffset(t[0].length,!1),e.closeUnmatchedBlocks();var n=e.addChild("heading",e.nextNonspace);return n.level=t[0].trim().length,n._string_content=e.currentLine.slice(e.offset).replace(/^[ \t]*#+[ \t]*$/,"").replace(/[ \t]+#+[ \t]*$/,""),e.advanceOffset(e.currentLine.length-e.offset),2}return 0},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(lf))){var n=t[0].length;e.closeUnmatchedBlocks();var i=e.addChild("code_block",e.nextNonspace);return i._isFenced=!0,i._fenceLength=n,i._fenceChar=t[0][0],i._fenceOffset=e.indent,e.advanceNextNonspace(),e.advanceOffset(n,!1),2}return 0},function(e,t){if(!e.indented&&60===pf(e.currentLine,e.nextNonspace)){var n,i=e.currentLine.slice(e.nextNonspace);for(n=1;n<=7;n++)if(Qg[n].test(i)&&(n<7||"paragraph"!==t.type&&(e.allClosed||e.blank||"paragraph"!==e.tip.type)))return e.closeUnmatchedBlocks(),e.addChild("html_block",e.offset)._htmlBlockType=n,2}return 0},function(e,t){var n;if(!e.indented&&"paragraph"===t.type&&(n=e.currentLine.slice(e.nextNonspace).match(df))){var i;for(e.closeUnmatchedBlocks();91===pf(t._string_content,0)&&(i=e.inlineParser.parseReference(t._string_content,e.refmap));)t._string_content=t._string_content.slice(i);if(t._string_content.length>0){var r=new Fm("heading",t.sourcepos);return r.level="="===n[0][0]?1:2,r._string_content=t._string_content,t.insertAfter(r),t.unlink(),e.tip=r,e.advanceOffset(e.currentLine.length-e.offset,!1),2}return 0}return 0},function(e){return!e.indented&&tf.test(e.currentLine.slice(e.nextNonspace))?(e.closeUnmatchedBlocks(),e.addChild("thematic_break",e.nextNonspace),e.advanceOffset(e.currentLine.length-e.offset,!1),2):0},function(e,t){var n,i,r;return e.indented&&"list"!==t.type||!(n=function(e,t){var n,i,r,s,o=e.currentLine.slice(e.nextNonspace),a={type:null,tight:!0,bulletChar:null,start:null,delimiter:null,padding:null,markerOffset:e.indent};if(e.indent>=4)return null;if(n=o.match(sf))a.type="bullet",a.bulletChar=n[0][0];else{if(!(n=o.match(of))||"paragraph"===t.type&&1!=n[1])return null;a.type="ordered",a.start=parseInt(n[1]),a.delimiter=n[2]}if(-1!==(i=pf(e.currentLine,e.nextNonspace+n[0].length))&&9!==i&&32!==i)return null;if("paragraph"===t.type&&!e.currentLine.slice(e.nextNonspace+n[0].length).match(rf))return null;e.advanceNextNonspace(),e.advanceOffset(n[0].length,!0),r=e.column,s=e.offset;do{e.advanceOffset(1,!0),i=pf(e.currentLine,e.offset)}while(e.column-r<5&&uf(i));var l=-1===pf(e.currentLine,e.offset),c=e.column-r;return c>=5||c<1||l?(a.padding=n[0].length+1,e.column=r,e.offset=s,uf(pf(e.currentLine,e.offset))&&e.advanceOffset(1,!0)):a.padding=n[0].length+c,a}(e,t))?0:(e.closeUnmatchedBlocks(),"list"===e.tip.type&&(r=n,(i=t._listData).type===r.type&&i.delimiter===r.delimiter&&i.bulletChar===r.bulletChar)||((t=e.addChild("list",e.nextNonspace))._listData=n),(t=e.addChild("item",e.nextNonspace))._listData=n,1)},function(e){return e.indented&&"paragraph"!==e.tip.type&&!e.blank?(e.advanceOffset(4,!0),e.closeUnmatchedBlocks(),e.addChild("code_block",e.offset),2):0}],wf=function(e,t){for(var n,i,r,s=this.currentLine;e>0&&(r=s[this.offset]);)"\t"===r?(n=4-this.column%4,t?(this.partiallyConsumedTab=n>e,i=n>e?e:n,this.column+=i,this.offset+=this.partiallyConsumedTab?0:1,e-=i):(this.partiallyConsumedTab=!1,this.column+=n,this.offset+=1,e-=1)):(this.partiallyConsumedTab=!1,this.offset+=1,this.column+=1,e-=1)},Sf=function(){this.offset=this.nextNonspace,this.column=this.nextNonspaceColumn,this.partiallyConsumedTab=!1},_f=function(){for(var e,t=this.currentLine,n=this.offset,i=this.column;""!==(e=t.charAt(n));)if(" "===e)n++,i++;else{if("\t"!==e)break;n++,i+=4-i%4}this.blank="\n"===e||"\r"===e||""===e,this.nextNonspace=n,this.nextNonspaceColumn=i,this.indent=this.nextNonspaceColumn-this.column,this.indented=this.indent>=4},Ef=function(e){var t,n,i=!0,r=this.doc;for(this.oldtip=this.tip,this.offset=0,this.column=0,this.blank=!1,this.partiallyConsumedTab=!1,this.lineNumber+=1,-1!==e.indexOf("\0")&&(e=e.replace(/\0/g,"")),this.currentLine=e;(n=r._lastChild)&&n._open;){switch(r=n,this.findNextNonspace(),this.blocks[r.type].continue(this,r)){case 0:break;case 1:i=!1;break;case 2:return;default:throw"continue returned illegal value, must be 0, 1, or 2"}if(!i){r=r._parent;break}}this.allClosed=r===this.oldtip,this.lastMatchedContainer=r;for(var s="paragraph"!==r.type&&yf[r.type].acceptsLines,o=this.blockStarts,a=o.length;!s;){if(this.findNextNonspace(),!this.indented&&!nf.test(e.slice(this.nextNonspace))){this.advanceNextNonspace();break}for(var l=0;l<a;){var c=o[l](this,r);if(1===c){r=this.tip;break}if(2===c){r=this.tip,s=!0;break}l++}if(l===a){this.advanceNextNonspace();break}}if(this.allClosed||this.blank||"paragraph"!==this.tip.type){this.closeUnmatchedBlocks(),this.blank&&r.lastChild&&(r.lastChild._lastLineBlank=!0),t=r.type;for(var d=this.blank&&!("block_quote"===t||"code_block"===t&&r._isFenced||"item"===t&&!r._firstChild&&r.sourcepos[0][0]===this.lineNumber),h=r;h;)h._lastLineBlank=d,h=h._parent;this.blocks[t].acceptsLines?(this.addLine(),"html_block"===t&&r._htmlBlockType>=1&&r._htmlBlockType<=5&&ef[r._htmlBlockType].test(this.currentLine.slice(this.offset))&&(this.lastLineLength=e.length,this.finalize(r,this.lineNumber))):this.offset<e.length&&!this.blank&&(r=this.addChild("paragraph",this.offset),this.advanceNextNonspace(),this.addLine())}else this.addLine();this.lastLineLength=e.length},kf=function(e,t){var n=e._parent;e._open=!1,e.sourcepos[1]=[t,this.lastLineLength],this.blocks[e.type].finalize(this,e),this.tip=n},xf=function(e){var t,n,i,r=e.walker();for(this.inlineParser.refmap=this.refmap,this.inlineParser.options=this.options;n=r.next();)i=(t=n.node).type,n.entering||"paragraph"!==i&&"heading"!==i||this.inlineParser.parse(t)},Tf=function(){return new Fm("document",[[1,1],[0,0]])},Cf=function(e){this.doc=new Tf,this.tip=this.doc,this.refmap={},this.lineNumber=0,this.lastLineLength=0,this.offset=0,this.column=0,this.lastMatchedContainer=this.doc,this.currentLine="",this.options.time&&console.time("preparing input");var t=e.split(hf),n=t.length;10===e.charCodeAt(e.length-1)&&(n-=1),this.options.time&&console.timeEnd("preparing input"),this.options.time&&console.time("block parsing");for(var i=0;i<n;i++)this.incorporateLine(t[i]);for(;this.tip;)this.finalize(this.tip,n);return this.options.time&&console.timeEnd("block parsing"),this.options.time&&console.time("inline parsing"),this.processInlines(this.doc),this.options.time&&console.timeEnd("inline parsing"),this.doc};const Af=function(e){return{doc:new Tf,blocks:yf,blockStarts:bf,tip:this.doc,oldtip:this.doc,currentLine:"",lineNumber:0,offset:0,column:0,nextNonspace:0,nextNonspaceColumn:0,indent:0,indented:!1,blank:!1,partiallyConsumedTab:!1,allClosed:!0,lastMatchedContainer:this.doc,refmap:{},lastLineLength:0,inlineParser:new Jg(e),findNextNonspace:_f,advanceOffset:wf,advanceNextNonspace:Sf,addLine:gf,addChild:ff,incorporateLine:Ef,finalize:kf,processInlines:xf,closeUnmatchedBlocks:vf,parse:Cf,options:e||{}}};function If(){}If.prototype.render=function(e){var t,n,i=e.walker();for(this.buffer="",this.lastOut="\n";t=i.next();)this[n=t.node.type]&&this[n](t.node,t.entering);return this.buffer},If.prototype.out=function(e){this.lit(e)},If.prototype.lit=function(e){this.buffer+=e,this.lastOut=e},If.prototype.cr=function(){"\n"!==this.lastOut&&this.lit("\n")},If.prototype.esc=function(e){return e};const Rf=If;var Pf=/^javascript:|vbscript:|file:|data:/i,Of=/^data:image\/(?:png|gif|jpeg|webp)/i,Mf=function(e){return Pf.test(e)&&!Of.test(e)};function Df(e){(e=e||{}).softbreak=e.softbreak||"\n",this.esc=e.esc||Gm,this.disableTags=0,this.lastOut="\n",this.options=e}Df.prototype=Object.create(Rf.prototype),Df.prototype.text=function(e){this.out(e.literal)},Df.prototype.html_inline=function(e){this.options.safe?this.lit("\x3c!-- raw HTML omitted --\x3e"):this.lit(e.literal)},Df.prototype.html_block=function(e){this.cr(),this.options.safe?this.lit("\x3c!-- raw HTML omitted --\x3e"):this.lit(e.literal),this.cr()},Df.prototype.softbreak=function(){this.lit(this.options.softbreak)},Df.prototype.linebreak=function(){this.tag("br",[],!0),this.cr()},Df.prototype.link=function(e,t){var n=this.attrs(e);t?(this.options.safe&&Mf(e.destination)||n.push(["href",this.esc(e.destination)]),e.title&&n.push(["title",this.esc(e.title)]),this.tag("a",n)):this.tag("/a")},Df.prototype.image=function(e,t){t?(0===this.disableTags&&(this.options.safe&&Mf(e.destination)?this.lit('<img src="" alt="'):this.lit('<img src="'+this.esc(e.destination)+'" alt="')),this.disableTags+=1):(this.disableTags-=1,0===this.disableTags&&(e.title&&this.lit('" title="'+this.esc(e.title)),this.lit('" />')))},Df.prototype.emph=function(e,t){this.tag(t?"em":"/em")},Df.prototype.strong=function(e,t){this.tag(t?"strong":"/strong")},Df.prototype.paragraph=function(e,t){var n=e.parent.parent,i=this.attrs(e);null!==n&&"list"===n.type&&n.listTight||(t?(this.cr(),this.tag("p",i)):(this.tag("/p"),this.cr()))},Df.prototype.heading=function(e,t){var n="h"+e.level,i=this.attrs(e);t?(this.cr(),this.tag(n,i)):(this.tag("/"+n),this.cr())},Df.prototype.code=function(e){this.tag("code"),this.out(e.literal),this.tag("/code")},Df.prototype.code_block=function(e){var t=e.info?e.info.split(/\s+/):[],n=this.attrs(e);t.length>0&&t[0].length>0&&n.push(["class","language-"+this.esc(t[0])]),this.cr(),this.tag("pre"),this.tag("code",n),this.out(e.literal),this.tag("/code"),this.tag("/pre"),this.cr()},Df.prototype.thematic_break=function(e){var t=this.attrs(e);this.cr(),this.tag("hr",t,!0),this.cr()},Df.prototype.block_quote=function(e,t){var n=this.attrs(e);t?(this.cr(),this.tag("blockquote",n),this.cr()):(this.cr(),this.tag("/blockquote"),this.cr())},Df.prototype.list=function(e,t){var n="bullet"===e.listType?"ul":"ol",i=this.attrs(e);if(t){var r=e.listStart;null!==r&&1!==r&&i.push(["start",r.toString()]),this.cr(),this.tag(n,i),this.cr()}else this.cr(),this.tag("/"+n),this.cr()},Df.prototype.item=function(e,t){var n=this.attrs(e);t?this.tag("li",n):(this.tag("/li"),this.cr())},Df.prototype.custom_inline=function(e,t){t&&e.onEnter?this.lit(e.onEnter):!t&&e.onExit&&this.lit(e.onExit)},Df.prototype.custom_block=function(e,t){this.cr(),t&&e.onEnter?this.lit(e.onEnter):!t&&e.onExit&&this.lit(e.onExit),this.cr()},Df.prototype.esc=Gm,Df.prototype.out=function(e){this.lit(this.esc(e))},Df.prototype.tag=function(e,t,n){if(!(this.disableTags>0)){if(this.buffer+="<"+e,t&&t.length>0)for(var i,r=0;void 0!==(i=t[r]);)this.buffer+=" "+i[0]+'="'+i[1]+'"',r++;n&&(this.buffer+=" /"),this.buffer+=">",this.lastOut=">"}},Df.prototype.attrs=function(e){var t=[];if(this.options.sourcepos){var n=e.sourcepos;n&&t.push(["data-sourcepos",String(n[0][0])+":"+String(n[0][1])+"-"+String(n[1][0])+":"+String(n[1][1])])}return t};const Lf=Df;var Ff=/\<[^>]*\>/;function Nf(e){return e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}function jf(e){e=e||{},this.disableTags=0,this.lastOut="\n",this.indentLevel=0,this.indent="  ",this.esc=e.esc||Gm,this.options=e}jf.prototype=Object.create(Rf.prototype),jf.prototype.render=function(e){var t,n;this.buffer="";var i,r,s,o,a,l,c=e.walker(),d=this.options;for(d.time&&console.time("rendering"),this.buffer+='<?xml version="1.0" encoding="UTF-8"?>\n',this.buffer+='<!DOCTYPE document SYSTEM "CommonMark.dtd">\n';i=c.next();)if(s=i.entering,l=(r=i.node).type,o=r.isContainer,a="thematic_break"===l||"linebreak"===l||"softbreak"===l,n=Nf(l),s){switch(t=[],l){case"document":t.push(["xmlns","http://commonmark.org/xml/1.0"]);break;case"list":null!==r.listType&&t.push(["type",r.listType.toLowerCase()]),null!==r.listStart&&t.push(["start",String(r.listStart)]),null!==r.listTight&&t.push(["tight",r.listTight?"true":"false"]);var h=r.listDelimiter;if(null!==h){var u;u="."===h?"period":"paren",t.push(["delimiter",u])}break;case"code_block":r.info&&t.push(["info",r.info]);break;case"heading":t.push(["level",String(r.level)]);break;case"link":case"image":t.push(["destination",r.destination]),t.push(["title",r.title]);break;case"custom_inline":case"custom_block":t.push(["on_enter",r.onEnter]),t.push(["on_exit",r.onExit])}if(d.sourcepos){var p=r.sourcepos;p&&t.push(["sourcepos",String(p[0][0])+":"+String(p[0][1])+"-"+String(p[1][0])+":"+String(p[1][1])])}if(this.cr(),this.out(this.tag(n,t,a)),o)this.indentLevel+=1;else if(!o&&!a){var m=r.literal;m&&this.out(this.esc(m)),this.out(this.tag("/"+n))}}else this.indentLevel-=1,this.cr(),this.out(this.tag("/"+n));return d.time&&console.timeEnd("rendering"),this.buffer+="\n",this.buffer},jf.prototype.out=function(e){this.disableTags>0?this.buffer+=e.replace(Ff,""):this.buffer+=e,this.lastOut=e},jf.prototype.cr=function(){if("\n"!==this.lastOut){this.buffer+="\n",this.lastOut="\n";for(var e=this.indentLevel;e>0;e--)this.buffer+=this.indent}},jf.prototype.tag=function(e,t,n){var i="<"+e;if(t&&t.length>0)for(var r,s=0;void 0!==(r=t[s]);)i+=" "+r[0]+'="'+this.esc(r[1])+'"',s++;return n&&(i+=" /"),i+">"},jf.prototype.esc=Gm;var Bf=__webpack_require__(5282),Uf={};function qf(){return qf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},qf.apply(this,arguments)}function zf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Uf.styleTagTransform=Me(),Uf.setAttributes=Ie(),Uf.insert=Ce().bind(null,"head"),Uf.domAPI=xe(),Uf.insertStyleElement=Pe(),Ee()(Bf.Z,Uf),Bf.Z&&Bf.Z.locals&&Bf.Z.locals;class Vf extends m{constructor(e){super(e),zf(this,"handleStatus",((e,t)=>{this.setState({status:t})})),zf(this,"userColor",new we(this.props.event.getSender())),zf(this,"openEditor",(()=>this.setState({responding:!0}))),zf(this,"closeEditor",(()=>this.setState({responding:!1}))),zf(this,"resend",(e=>tt.client.resendEvent(this.props.event))),zf(this,"redactMessage",(()=>{tt.client.redactEvent(this.props.event.getRoomId(),this.props.event.getId())})),this.state={responding:!1,status:e.event.getAssociatedStatus()}}componentDidMount(){this.props.event.getAssociatedStatus()&&this.props.event.on("Event.status",this.handleStatus)}componentWillUnmount(){this.props.event.off("Event.status",this.handleStatus)}render(e,t){const n=e.reactions[e.event.getId()]?e.reactions[e.event.getId()].filter((e=>"m.annotation"===e.getContent()["m.relates_to"].rel_type)):[],i=tt.client.getUserId()===e.event.getSender();return h(p,null,h("div",{"data-event-status":i?t.status:null,id:e.event.getId(),style:e.styleOverride||this.userColor.styleVariables,class:i?"message-frame message-from-user":"message-frame"},e.children,"not_sent"===t.status?h("div",{class:"message-frame-status"},"message not sent - ",h("a",{onclick:this.resend},"resend?")):null,h(Kf,{event:e.event,reactions:n},e.displayOnly?null:i?h($f,{canEdit:e.canEdit,responding:t.responding,openEditor:this.openEditor,redactMessage:this.redactMessage}):h(Wf,{responding:t.responding,openEditor:this.openEditor,event:e.event,redactMessage:this.props.canRedact?this.redactMessage:null,reactions:n}))),t.responding?i?h(Gf,{closeEditor:this.closeEditor,event:e.event}):h(Yf,{closeEditor:this.closeEditor,getCurrentEdit:this.getCurrentEdit,event:e.event}):null)}}class Kf extends m{shouldComponentUpdate(e){return this.props.reactions.length!==e.reactions.length}render(e){const t={};for(const n of e.reactions){const e=n.getContent()?.["m.relates_to"]?.key;e&&(t[e]?t[e]=t[e]+1:t[e]=1)}const n=[];for(const i in t)n.push(h(Hf,{reactions:e.reactions,event:e.event,rtable:t,rkey:i}));return h("div",{class:"message-decoration"},n.length<1?null:h("div",{class:"message-reactions"},h("div",null,n)),e.children)}}class Hf extends m{constructor(...e){super(...e),zf(this,"checkEmoji",(e=>this.props.reactions.find((e=>e.getSender()===tt.client.getUserId()&&e.getContent()?.["m.relates_to"]?.key===this.props.rkey)))),zf(this,"increment",(e=>{tt.client.sendEvent(this.props.event.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:this.props.event.getId(),key:this.props.rkey}})})),zf(this,"decrement",(e=>{tt.client.redactEvent(e.getRoomId(),e.getId())})),zf(this,"onClick",(e=>{const t=this.checkEmoji();t?this.decrement(t):this.increment()}))}render(e){return h("div",{onClick:this.onClick,class:"emoji-badge"},h("span",null,e.rtable[e.rkey]),h("span",null,e.rkey))}}class Wf extends m{constructor(e){super(e),zf(this,"checkEmoji",(e=>this.props.reactions.some((t=>t.getSender()===tt.client.getUserId()&&t.getContent()?.["m.relates_to"]?.key===e)))),zf(this,"actions",{current:null}),zf(this,"picker",{current:null}),zf(this,"clearCarefully",(e=>{e.target!==this.actions.current&&(this.actions.current.contains(e.target)||document.body.contains(e.target)&&this.clearSelecting())})),zf(this,"react",(e=>t=>{this.clearSelecting(),this.checkEmoji(e)||tt.client.sendEvent(this.props.event.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:this.props.event.getId(),key:e}})})),zf(this,"handleEmojiClick",(e=>this.react(e.detail.unicode)())),zf(this,"selectEmoji",(e=>this.setState({selecting:"emoji"}))),zf(this,"pickEmoji",(e=>this.setState({selecting:"emoji-picker"},(e=>this.picker.current.shadowRoot.querySelector("input").focus())))),zf(this,"handleEmojiKeydown",(e=>e.stopPropagation())),zf(this,"clearSelecting",(e=>this.setState({selecting:null}))),this.state={selecting:null}}componentDidUpdate(e,t){!t.selecting&&this.state.selecting&&window.addEventListener("click",this.clearCarefully),t.selecting||this.state.selecting||window.removeEventListener("click",this.clearCarefully)}render(e,t){switch(t.selecting){case"emoji-picker":return h("div",{ref:this.actions,onKeydown:this.handleEmojiKeydown,"data-active":!0,class:"message-actions"},h("emoji-picker",{ref:this.picker,"onemoji-click":this.handleEmojiClick}),h("button",{key:"a",style:{position:"relative",left:"250px"},onclick:this.clearSelecting},ot));case"emoji":return h("div",{ref:this.actions,"data-active":!0,class:"message-actions"},h("button",{key:"b",onclick:this.react("")},""),h("button",{key:"c",onclick:this.react("")},""),h("button",{key:"f",onclick:this.react("")},""),h("button",{key:"d",onclick:this.react("")},""),h("button",{key:"e",onclick:this.react("")},""),h("button",{key:"g",onclick:this.pickEmoji},wt));default:return h("div",{ref:this.actions,class:"message-actions"},!e.responding&&h(Tr,{placement:"top-start",theme:"small",content:"reply to this message"},h("button",{key:"h",onclick:e.openEditor},Lt)),h(Tr,{placement:"top-start",theme:"small",content:"React to this message"},h("button",{key:"i",class:"reaction",onclick:this.selectEmoji},Ft)),e.redactMessage?h(Tr,{placement:"top-end",theme:"small",content:"Delete this message"},h("button",{onclick:e.redactMessage,class:"redact"},jt)):null)}}}function $f(e){return h("div",{class:"message-actions"},!e.responding&&e.canEdit&&h(Tr,{placement:"top-end",theme:"small",content:"Edit this message"},h("button",{onclick:e.openEditor},Nt)),h(Tr,{placement:"top-end",theme:"small",content:"Delete this message"},h("button",{onclick:e.redactMessage,class:"redact"},jt)))}class Gf extends m{constructor(e){super(e),zf(this,"input",{current:null}),zf(this,"handleKeydown",(e=>{e.stopPropagation(),"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),this.sendResponse())})),zf(this,"handleInput",(e=>this.setValue(e.target.value,this.resize()))),zf(this,"setValue",((e,t)=>this.setState({value:e},t))),zf(this,"resize",(()=>{this.input.current.style.height="auto",this.input.current.style.height=`${this.input.current.scrollHeight}px`})),zf(this,"sendResponse",(()=>{const e=new Af,t=new Lf,n=e.parse(Am(this.state.value)),i=t.render(n),r={body:this.state.value,msgtype:"m.text",format:"org.matrix.custom.html",formatted_body:i};fm(this.currentContent)&&(r["m.relates_to"]=this.currentContent["m.relates_to"],r.body=_m(this.currentContent)+r.body,r.formatted_body=function(e){const t=e.formatted_body;return t?(new DOMParser).parseFromString(t,"text/html").body.querySelector("mx-reply").outerHTML:""}(this.currentContent)+r.formatted_body);const s={body:"an edit occurred",msgtype:"m.text","m.new_content":r,"m.relates_to":{rel_type:"m.replace",event_id:this.props.event.getId()}};tt.client.sendEvent(this.props.event.getRoomId(),"m.reaction",s).then((e=>this.props.closeEditor()))})),zf(this,"popupActions",{"@":e=>h(nl,qf({roomId:this.props.event.getRoomId()},e)),":":e=>h(Ja,e)}),this.currentContent=e.event.getContent(),this.state={value:fm(this.currentContent)?ym(this.currentContent.body):this.currentContent.body}}componentDidMount(){this.input.current.style.height="auto",this.input.current.style.height=`${this.input.current.scrollHeight}px`,this.resize()}render(e,t){return h("div",{class:"messageEditor"},h(Za,{textValue:t.value,textarea:this.input,actions:this.popupActions,setTextValue:this.setValue}),h("textarea",{ref:this.input,value:t.value,onkeydown:this.handleKeydown,oninput:this.handleInput,"data-gramm":"false"}),h("button",{onclick:this.sendResponse},"Submit Changes"),h("button",{onclick:this.props.closeEditor},"Cancel"))}}class Yf extends m{constructor(...e){super(...e),zf(this,"input",{current:null}),zf(this,"handleKeydown",(e=>{e.stopPropagation(),"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),this.sendResponse())})),zf(this,"handleInput",(e=>{this.setValue(e.target.value),this.input.current.style.height="auto",this.input.current.style.height=`${this.input.current.scrollHeight}px`})),zf(this,"setValue",((e,t)=>this.setState({value:e},t))),zf(this,"sendResponse",(()=>{const e=new Af,t=new Lf,n=e.parse(Am(this.state.value)),i=t.render(n);tt.client.sendMessage(this.props.event.getRoomId(),{body:bm(this.props.event)+this.state.value,formatted_body:wm(this.props.event)+i,format:"org.matrix.custom.html",msgtype:"m.text","m.relates_to":{"m.in_reply_to":{event_id:this.props.event.getId()}}}).then((e=>this.props.closeEditor()))})),zf(this,"popupActions",{"@":e=>h(nl,qf({roomId:this.props.event.getRoomId()},e)),":":e=>h(Ja,e)})}render(e,t){return h("div",{class:"replyComposer"},h(Za,{textValue:t.value,textarea:this.input,setTextValue:this.setValue,actions:this.popupActions}),h("textarea",{ref:this.input,value:t.value,onkeydown:this.handleKeydown,oninput:this.handleInput,"data-gramm":"false"}),h("button",{onclick:this.sendResponse},"Send Reply"),h("button",{onclick:this.props.closeEditor},"Cancel"))}}var Xf=__webpack_require__(8151),Zf={};function Jf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Zf.styleTagTransform=Me(),Zf.setAttributes=Ie(),Zf.insert=Ce().bind(null,"head"),Zf.domAPI=xe(),Zf.insertStyleElement=Pe(),Ee()(Xf.Z,Zf),Xf.Z&&Xf.Z.locals&&Xf.Z.locals;class Qf extends m{constructor(e){super(e),Jf(this,"hideMediaModal",(e=>{delete document.body.dataset.modalVisible,this.setState({content:null,url:null})})),Jf(this,"setContent",((e,t)=>{document.body.dataset.modalVisible=!0,this.setState({content:e,url:t})})),Jf(this,"catchClick",(e=>e.stopPropagation())),this.state={content:null},Qf.set=this.setContent,Qf.hide=this.hideMediaModal,Qf.isVisible=e=>null!==this.state.content}render(e,t){return t.content?h("div",{id:"media-modal"},h("div",{id:"media-modal-background",onclick:this.hideMediaModal}),h("button",{id:"media-modal-close",onclick:this.hideMediaModal},ot),t.url?h("a",{id:"media-modal-download",download:!0,target:"_blank",href:t.url},Qt):null,h("div",{id:"media-modal-content"},t.content)):null}}function ev(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class tv extends m{constructor(...e){super(...e),ev(this,"blurhashCanvas",{current:null}),ev(this,"drawBlurhash",(e=>{if(!this.props.height||!this.props.width)return;const t=this.blurhashCanvas.current.getContext("2d");t.clearRect(0,0,this.blurhashCanvas.current.wdith,this.blurhashCanvas.current.height);const n=Math.round(this.props.height/this.props.width*32);if(this.blurhashCanvas.current.width=32,this.blurhashCanvas.current.height=n,!this.props.blurhash)return;const i=t.createImageData(32,n),r=ns(this.props.blurhash,32,n);i.data.set(r),t.putImageData(i,0,0)}))}componentDidMount(){this.drawBlurhash()}render(e){const t=e.width&&e.height?{width:`${e.width}px`,"max-width":`calc(min(100% - 20px, ${e.width}px))`}:null;return h("canvas",{ref:this.blurhashCanvas,style:t,class:this.props.class})}}class nv extends m{constructor(e){var t,n;super(e),n={current:null},(t="theCanvas")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n;const i=new(window.AudioContext||window.webkitAudioContext);this.analyser=i.createAnalyser(),i.createMediaStreamSource(e.stream).connect(this.analyser),this.analyser.fftSize=2048,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.draw=this.draw.bind(this)}componentDidMount(){this.width=this.theCanvas.current.width,this.height=this.theCanvas.current.height,this.canvasCtx=this.theCanvas.current.getContext("2d"),this.canvasCtx.clearRect(0,0,this.width,this.height),this.draw()}componentWillUnmount(){this.paused=!0}play(){this.paused=!1,this.draw()}pause(){this.paused=!0}draw(){this.analyser.getByteTimeDomainData(this.dataArray),this.canvasCtx.fillStyle="rgb(0, 0, 0)",this.canvasCtx.fillRect(0,0,this.width,this.height),this.canvasCtx.lineWidth=2,this.canvasCtx.strokeStyle="rgb(200, 200, 200)",this.canvasCtx.beginPath();const e=1*this.width/this.bufferLength;let t=0;for(let n=0;n<this.bufferLength;n++){const i=this.dataArray[n]/128*this.height/2;0===n?this.canvasCtx.moveTo(t,i):this.canvasCtx.lineTo(t,i),t+=e}this.canvasCtx.lineTo(this.width,this.height/2),this.canvasCtx.stroke(),this.paused||requestAnimationFrame(this.draw)}render(e){return h("canvas",{class:`audioVisualizer ${e.class}`,onclick:e.onclick,height:e.height,width:e.width,ref:this.theCanvas})}}var iv=__webpack_require__(4050),rv={};function sv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}rv.styleTagTransform=Me(),rv.setAttributes=Ie(),rv.insert=Ce().bind(null,"head"),rv.domAPI=xe(),rv.insertStyleElement=Pe(),Ee()(iv.Z,rv),iv.Z&&iv.Z.locals&&iv.Z.locals;class ov extends m{constructor(e){super(e),sv(this,"mediaElement",{current:null}),sv(this,"canvasElement",{current:null}),sv(this,"secondaryAudio",{current:null}),sv(this,"handleMediaClick",(e=>{this.mediaElement.current.paused?(this.mediaElement.current.currentTime=this.props.location.getIntervalStart()/1e3,this.mediaElement.current.play(),this.canvasElement.current&&this.projectToCanvas(),this.secondaryAudio.current?.play()):(this.mediaElement.current.pause(),this.secondaryAudio.current?.pause())})),sv(this,"mediaRect",this.props.location.getMediaRect()),sv(this,"handleLoadedMetadata",(e=>{if(!this.mediaRect){const e=this.mediaElement.current.videoWidth||this.mediaElement.current.width,t=this.mediaElement.current.videoHeight||this.mediaElement.current.height;this.canvasElement.current.width=e,this.canvasElement.current.height=t,this.mediaRect=new DOMRect(0,0,e,t)}})),sv(this,"handleLoadedData",(e=>{const t=this.mediaElement.current.mozCaptureStream?.()||this.mediaElement.current.captureStream();this.setState({stream:t})})),sv(this,"refreshCanvas",(e=>{this.canvasElement.current.getContext("2d",{alpha:!1}).drawImage(this.mediaElement.current,this.mediaRect.x,this.mediaRect.y,this.mediaRect.width,this.mediaRect.height,0,0,this.mediaRect.width,this.mediaRect.height)})),sv(this,"projectToCanvas",(e=>{this.refreshCanvas(),this.mediaElement.current.paused||requestAnimationFrame(this.projectToCanvas)})),sv(this,"handleTimeUpdate",(e=>{this.mediaElement.current?.currentTime>this.props.location.getIntervalEnd()/1e3&&(this.mediaElement.current.pause(),this.secondaryAudio.current?.pause())})),sv(this,"initializeUrl",(async e=>{const t=await this.props.resource.hasFetched;this.setState({mediaSrc:t},(e=>{if(this.props.resource?.mimetype?.match(/^video|^audio/)){const e=this.props.location.getIntervalStart();this.mediaElement.current.currentTime=0!==e?e/1e3:1}}))}))}componentDidMount(){"media-fragment"===this.props.location.getType()&&this.props.resource&&this.initializeUrl()}componentWillUnmount(){this.mediaElement.current?.pause?.(),this.secondaryAudio.current?.pause?.()}render(e,t){return"highlight"===e.location.getType()?h("div",{class:"preview-quote"},h("span",null,Zt),e.location.getText()):"text"===e.location.getType()?h("div",{class:"preview-pin"},Yt," ",h("span",null,"on page ",e.location.getPageIndex())):"media-fragment"===e.location.getType()?h("div",{class:"preview-media-fragment"},e.showPosition&&e.resource?.mimetype?.match(/^image/)?h("div",{class:"preview-media-fragment-position"},mt,h("span",null,"Image selection at ",this.mediaRect.x,",",this.mediaRect.y)):e.showPosition?h("div",{class:"preview-media-fragment-position"},rn,h("span",null,"From ",pm(e.location.getIntervalStart()/1e3)," to ",pm(e.location.getIntervalEnd()/1e3))):null,e.resource?.mimetype?.match(/^audio/)?h("div",{class:"preview-media-fragment-audio"},h("audio",{src:t.mediaSrc,ref:this.mediaElement,onloadeddata:this.handleLoadedData,ontimeupdate:this.handleTimeUpdate}),t.stream?h(p,null,this.mediaElement.current.mozCaptureStream?h("audio",{ref:this.secondaryAudio,srcObject:t.stream}):null,h(nv,{onclick:this.handleMediaClick,height:100,width:500,stream:t.stream})):null):e.resource?.mimetype?.match(/^video/)?h("div",{class:"preview-media-fragment-video"},h("video",{src:t.mediaSrc,ref:this.mediaElement,onloadedmetadata:this.handleLoadedMetadata,onseeked:this.refreshCanvas,ontimeupdate:this.handleTimeUpdate}),h("canvas",{width:this.mediaRect?.width,height:this.mediaRect?.height,onclick:this.handleMediaClick,ref:this.canvasElement})):e.resource?.mimetype?.match(/^image/)?h("div",{class:"preview-media-fragment-image"},h("img",{src:t.mediaSrc,ref:this.mediaElement,onload:this.refreshCanvas}),h("canvas",{width:this.mediaRect?.width,height:this.mediaRect?.height,ref:this.canvasElement})):null):void 0}}var av=__webpack_require__(9688),lv={};function cv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}lv.styleTagTransform=Me(),lv.setAttributes=Ie(),lv.insert=Ce().bind(null,"head"),lv.domAPI=xe(),lv.insertStyleElement=Pe(),Ee()(av.Z,lv),av.Z&&av.Z.locals&&av.Z.locals;class dv extends m{constructor(...e){super(...e),cv(this,"messageBody",{current:null})}componentDidMount(){hm(this.messageBody.current),um(this.messageBody.current)}componentDidUpdate(e){this.props.reactions[this.props.event.getId()]!==e.reactions[e.event.getId()]&&(hm(this.messageBody.current),um(this.messageBody.current))}render(e){const t=this.props.event.getContent(),n=fm(t);return h(Vf,{canEdit:!0,displayOnly:e.displayOnly,reactions:e.reactions,canRedact:e.canRedact,event:e.event},h("div",{ref:this.messageBody,class:"message-body"},n?h(pv,{resourceAlias:e.resourceAlias,reactions:e.reactions,event:e.event}):null,h(gv,{content:t})))}}class hv extends m{constructor(...e){super(...e),cv(this,"messageBody",{current:null}),cv(this,"sender",tt.client.getUser(this.props.event.getSender())),cv(this,"userColor",new we(this.props.event.getSender()))}componentDidMount(){hm(this.messageBody.current),um(this.messageBody.current)}componentDidUpdate(e){this.props.reactions[this.props.event.getId()]!==e.reactions[e.event.getId()]&&(hm(this.messageBody.current),um(this.messageBody.current))}render(e){const t=e.event.getContent();return h(Vf,{displayOnly:e.displayOnly,reactions:e.reactions,event:e.event},h("div",{ref:this.messageBody,class:"message-body"},h("div",{class:"emote-banner",style:this.userColor.styleVariables},this.sender.displayName,":"),h(gv,{content:t})))}}class uv extends m{constructor(...e){super(...e),cv(this,"handleClick",(e=>{this.hasFocus()&&this.props.setSecondaryFocus(null)})),cv(this,"handleLinkClick",(e=>{e.stopPropagation(),this.hasFocus()||this.props.setSecondaryFocus(this.location)})),cv(this,"sender",tt.client.getUser(this.props.event.getSender())),cv(this,"userColor",new we(this.props.event.getSender())),cv(this,"location",new rs(this.props.event)),cv(this,"hasFocus",(e=>this.location===this.props.secondaryFocus)),cv(this,"mediaRect",this.location?.getMediaRect())}render(e){const t=this.location.getType();if(t)return h(Vf,{styleOverride:this.hasFocus()?{background:this.userColor.ultralight,...this.userColor.styleVariables}:null,reactions:e.reactions,event:e.event,getCurrentEdit:this.getCurrentEdit},h("div",{onClick:this.handleClick,class:"message-body"},"highlight"===t||"text"==t?h("span",{class:"annotation-banner"},h("span",null,"On "),h("a",{onClick:this.handleLinkClick,href:`${window.location.origin}${window.location.pathname}#/${encodeURIComponent(e.resourceAlias)}/${this.location.getPageIndex()}/${this.props.roomId}`},"page ",this.location.getPageIndex()),":"):"media-fragment"==t?h("span",{class:"annotation-banner"},e.resource?.mimetype?.match(/^image/)?h(p,null,h("span",null,"Image selection at "),h("a",{onClick:this.handleLinkClick,href:`${window.location.origin}${window.location.pathname}#/${encodeURIComponent(e.resourceAlias)}/${Math.floor(this.location.getIntervalStart()/1e3)}/${this.props.roomId}`},this.mediaRect.x,",",this.mediaRect.y),":"):h(p,null,h("span",null,"From "),h("a",{onClick:this.handleLinkClick,href:`${window.location.origin}${window.location.pathname}#/${encodeURIComponent(e.resourceAlias)}/${Math.floor(this.location.getIntervalStart()/1e3)}/${this.props.roomId}`},pm(this.location.getIntervalStart()/1e3)," to ",pm(this.location.getIntervalEnd()/1e3)),":")):null,h(ov,{resource:e.resource,location:this.location})))}}class pv extends m{constructor(e){super(e),cv(this,"replyPreview",{current:null}),cv(this,"handleLoad",(e=>this.setState({loaded:!0}))),cv(this,"fromLiveEvent",(e=>{const t=this.state.liveEvent?.getContent();if(!t)return;const n="org.matrix.custom.html"===t.format&&t.formatted_body,i=fm(t),r=t.msgtype?`${window.location.origin}${window.location.pathname}#/${encodeURIComponent(this.props.resourceAlias)}/_/${this.state.liveEvent.getRoomId()}/${this.state.liveEvent.getId()}`:null,s=new we(this.state.liveEvent.getSender());let o;if(this.state.liveEvent.getContent().msgtype)switch(this.state.liveEvent.getContent().msgtype){case"m.video":{const e=this.state.liveEvent.getContent()?.info.thumbnail_info||props.event?.getContent()?.info,t=this.state.liveEvent.getContent()?.info?.blurhash,n=this.state.liveEvent.getContent().info.thumbnail_url;o=h(p,null,h("video",{class:"media-message-thumbnail",controls:!0,poster:n?tt.client.getHttpUriForMxcFromHS(n):null,onloadedmetadata:this.handleLoad,preload:"metadata",src:tt.client.getHttpUriForMxcFromHS(this.state.liveEvent.getContent().url)}),h(tv,{height:e.h,width:e.w,blurhash:t,class:"media-message-blurhash"}));break}case"m.image":{const e=this.state.liveEvent.getContent()?.info.thumbnail_info||props.event?.getContent()?.info,t=this.state.liveEvent.getContent()?.info?.blurhash,n=this.state.liveEvent.getContent().info.thumbnail_url,i=n?tt.client.getHttpUriForMxcFromHS(n):null;o=h(p,null,h("img",{onLoad:this.handleLoad,loading:"lazy",class:"media-message-thumbnail",src:i}),h(tv,{height:e.h,width:e.w,blurhash:t,class:"media-message-blurhash"}));break}case"m.audio":o=h("audio",{controls:!0,src:tt.client.getHttpUriForMxcFromHS(this.state.liveEvent.getContent().url)});break;case"m.file":o=h("div",{class:"file-upload"},h("span",null,vt),h("a",{href:tt.client.getHttpUriForMxcFromHS(this.state.liveEvent.getContent().url)},this.state.liveEvent.getContent().filename),h("span",null,ye(this.state.liveEvent.getContent().info?.size)));break;case"m.text":{const e=i?ym(t.body):t.body,r=e.length>375&&this.state.truncate;if(i&&n){const e=mc()(t.formatted_body,Em);o=h("div",{onclick:this.clearTruncate,"data-truncate-reply":r,dangerouslySetInnerHTML:{__html:e}})}else o=n?h("div",{onclick:this.clearTruncate,"data-truncate-reply":r,dangerouslySetInnerHTML:{__html:t.formatted_body}}):h("div",{onclick:this.clearTruncate,"data-truncate-reply":r},e);break}case"m.notice":{const e=i?ym(t.body):t.body,r=e.length>375&&this.state.truncate;if(i&&n){const e=mc()(t.formatted_body,Em);o=h("div",{onclick:this.clearTruncate,"data-truncate-reply":r,dangerouslySetInnerHTML:{__html:e}})}else o=n?h("div",{onclick:this.clearTruncate,"data-truncate-reply":r,dangerouslySetInnerHTML:{__html:t.formatted_body}}):h("div",{onclick:this.clearTruncate,"data-truncate-reply":r},e)}}else o=h("div",{class:"redacted-preview"},"Original Message Deleted");return h(p,null,h("div",{class:"reply-preface"},h("a",{href:r},"In reply to"),":"),h(gm,{isReply:!0,userId:this.state.liveEvent.getSender()}),h("div",{ref:this.replyPreview,"data-media-message-loaded":this.state.loaded,style:s.styleVariables,class:"reply-preview"},o))})),cv(this,"clearTruncate",(e=>{this.setState({truncate:!1})})),cv(this,"fallbackPreview",(e=>{const t=this.props.event.getContent(),n={"--user_light":"lightgray"};return"org.matrix.custom.html"===t.format&&t.formatted_body?h("div",{style:n,class:"reply-preview reply-fallback",dangerouslySetInnerHTML:{__html:Sm(t)}}):h("div",{style:n,class:"reply-preview reply-fallback"},function(e){return _m(e).map((e=>e.slice(2)))}(t))})),this.state={truncate:!0}}componentDidMount(){this.getLiveEvent(),hm(this.replyPreview.current),um(this.replyPreview.current)}componentDidUpdate(){this.getLiveEvent(),hm(this.replyPreview.current),um(this.replyPreview.current)}async getLiveEvent(){if(!this.state.liveEvent){const e=this.props.event.getContent()["m.relates_to"]["m.in_reply_to"].event_id,t=this.props.event.getRoomId(),n=tt.client.getRoom(t);if(!n)return;const i=n.findEventById(e);i&&this.setState({liveEvent:i});try{console.log("trying to retrive live event"),await tt.client.getEventTimeline(n.getUnfilteredTimelineSet(),e),console.log("retrived"),this.setState({liveEvent:n.findEventById(e)})}catch(e){console.log("couldn't retrieve - is this a dendrite server? see https://github.com/matrix-org/dendrite/issues/670"),console.log(e)}}}render(e,t){return t.liveEvent?this.fromLiveEvent():this.fallbackPreview()}}class mv extends m{constructor(...e){super(...e),cv(this,"messageBody",{current:null}),cv(this,"noticeStyle",{"--user_ultralight":"hsl(0,0%, 95%)","--user_light":"hsl(0,0%, 80%)","--user_solid":"hsl(0,0%, 50%)","--user_dark":"hsl(0,0%, 20%)"})}componentDidMount(){hm(this.messageBody.current)}componentDidUpdate(e){this.props.reactions[this.props.event.getId()]!==e.reactions[e.event.getId()]&&hm(this.messageBody.current)}render(e){const t=e.event.getContent(),n=fm(t);return h(Vf,{displayOnly:e.displayOnly,reactions:e.reactions,canRedact:e.canRedact,styleOverride:this.noticeStyle,event:e.event},h("div",{ref:this.messageBody,class:"message-body"},n?h(pv,{resourceAlias:e.resourceAlias,reactions:e.reactions,event:e.event}):null,h(gv,{content:t})))}}function gv(e){const t=e.content,n=fm(t),i=/^\s*(\p{Extended_Pictographic}\p{Emoji_Component}*){1,3}\s*$/u.test(t.body);return!i&&"org.matrix.custom.html"===t.format&&t.formatted_body?h("div",{dangerouslySetInnerHTML:{__html:mc()(n?mc()(t.formatted_body,Em):t.formatted_body,Ze)}}):h("div",{class:i?"large-emoji-display":null},n?vm(t.body):t.body)}class fv extends m{constructor(...e){super(...e),cv(this,"userColor",new we(this.props.event.getSender())),cv(this,"isMe",this.props.event.getSender()===tt.client.getUserId()),cv(this,"url",tt.client.getHttpUriForMxcFromHS(this.props.event.getContent().url))}render(e){const t=e.event.getContent().filename,n=e.event.getContent().info?.size;return h(Vf,{displayOnly:e.displayOnly,reactions:e.reactions,canRedact:e.canRedact,event:e.event},h("div",{class:"message-body"},h("div",{class:"file-upload"},h("span",null,vt),h("a",{href:this.url,download:t},t),h("span",null," ",ye(n)," "))))}}class vv extends m{constructor(...e){super(...e),cv(this,"userColor",new we(this.props.event.getSender())),cv(this,"isMe",this.props.event.getSender()===tt.client.getUserId()),cv(this,"url",this.props.event.getContent().info.thumbnail_url?tt.client.getHttpUriForMxcFromHS(this.props.event.getContent().info.thumbnail_url):tt.client.getHttpUriForMxcFromHS(this.props.event.getContent().url)),cv(this,"showPreview",(e=>{const t=tt.client.getHttpUriForMxcFromHS(this.props.event.getContent().url);Qf.set(h("img",{src:t}),t)})),cv(this,"handleLoad",(e=>this.setState({loaded:!0})))}render(e,t){const n=e.event.getContent()?.info.thumbnail_info||e.event?.getContent()?.info,i=e.event?.getContent()?.info?.blurhash;return h(Vf,{displayOnly:e.displayOnly,reactions:e.reactions,canRedact:e.canRedact,event:e.event},h("div",{class:"message-body media-message","data-media-message-loaded":t.loaded},h("img",{onclick:this.showPreview,onLoad:this.handleLoad,loading:"lazy",class:"media-message-thumbnail",src:this.url}),h(tv,{height:n.h,width:n.w,blurhash:i,class:"media-message-blurhash"})))}}class yv extends m{constructor(...e){super(...e),cv(this,"userColor",new we(this.props.event.getSender())),cv(this,"isMe",this.props.event.getSender()===tt.client.getUserId()),cv(this,"content",this.props.event.getContent()),cv(this,"poster",this.content.info.thumbnail_url?tt.client.getHttpUriForMxcFromHS(this.content.info.thumbnail_url):null),cv(this,"handleLoad",(e=>this.setState({loaded:!0}))),cv(this,"url",tt.client.getHttpUriForMxcFromHS(this.content.url))}render(e,t){const n=e.event.getContent()?.info.thumbnail_info||e.event?.getContent()?.info,i=e.event?.getContent()?.info?.blurhash;return h(Vf,{displayOnly:e.displayOnly,reactions:e.reactions,canRedact:e.canRedact,event:e.event},h("div",{class:"message-body media-message","data-media-message-loaded":t.loaded},h("video",{class:"media-message-thumbnail",controls:!0,poster:this.poster,onloadedmetadata:this.handleLoad,preload:"metadata",src:this.url}),h(tv,{height:n.h,width:n.w,blurhash:i,class:"media-message-blurhash"})))}}class bv extends m{constructor(...e){super(...e),cv(this,"userColor",new we(this.props.event.getSender())),cv(this,"isMe",this.props.event.getSender()===tt.client.getUserId()),cv(this,"content",this.props.event.getContent()),cv(this,"url",tt.client.getHttpUriForMxcFromHS(this.content.url))}render(e){return h(Vf,{displayOnly:e.displayOnly,reactions:e.reactions,canRedact:e.canRedact,event:e.event},h("div",{class:"message-body media-message"},h("audio",{controls:!0,src:this.url})))}}function wv(e){const t=tt.client.getRoom(e.getRoomId());if(t){const n=t.getLiveTimeline().getEvents(),i=t.getAccountData("m.fully_read"),r=i?i.getContent().event_id:null;if(r)for(let t=n.length-1;t>=0;--t){if(r===n[t].getId())return!1;if(e.getId()===n[t].getId())return!0}}return!0}var Sv=__webpack_require__(3519),_v={};function Ev(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}_v.styleTagTransform=Me(),_v.setAttributes=Ie(),_v.insert=Ce().bind(null,"head"),_v.domAPI=xe(),_v.insertStyleElement=Pe(),Ee()(Sv.Z,_v),Sv.Z&&Sv.Z.locals&&Sv.Z.locals;class kv extends m{constructor(e){super(e),Ev(this,"scrollAnchor",{current:null}),Ev(this,"updateEvents",(e=>this.setState({events:this.notificationWindow.getEvents().reverse()}))),Ev(this,"tryBackfill",(e=>{const t=this.scrollAnchor.current.base;!this.state.fullyLoaded&&window.innerHeight-t.getBoundingClientRect().top>0&&(this.notificationWindow.canPaginate(ge.EventTimeline.BACKWARDS)?this.notificationWindow.paginate(ge.EventTimeline.BACKWARDS,10).then((e=>setTimeout((e=>{this.setState({events:this.notificationWindow.getEvents().reverse()},this.tryBackfill)}),200))):this.setState({fullyLoaded:!0}))})),Ev(this,"handleTimeline",((e,t)=>{t||this.notificationPromise.then((e=>this.notificationWindow.paginate(ge.EventTimeline.FORWARDS,1,!1))).then(this.updateEvents)})),Ev(this,"handleRoom",(e=>{clearTimeout(this.inviteDebounceTimeout),this.inviteDebounceTimeout=setTimeout((e=>{this.setState({invites:this.getInvites()})}),500)})),Ev(this,"handleScroll",(e=>{clearTimeout(this.scrollDebounceTimeout),this.scrollDebounceTimeout=setTimeout((e=>{this.tryBackfill()}),200)})),Ev(this,"toMilestone",(e=>h("div",{class:"notification-date-indicator"},e))),Ev(this,"toNotification",(e=>"m.text"===e.getContent().msgtype?h(Tv,{event:e,key:e.getId()}):null)),this.state={events:[],invites:this.getInvites(),fullyLoaded:!1},this.notificationPromise=this.loadNotificationWindow(),this.handleScroll=this.handleScroll.bind(this)}componentDidMount(){document.addEventListener("scroll",this.handleScroll),tt.client.on("Room",this.handleRoom),tt.client.on("RoomState.events",this.handleRoom),tt.client.on("Room.timeline",this.handleTimeline),this.notificationPromise.then(this.updateEvents).then(this.tryBackfill)}componentWillUnmount(){document.removeEventListener("scroll",this.handleScroll),tt.client.off("Room",this.handleRoom),tt.client.off("RoomState.events",this.handleRoom),tt.client.off("Room.timeline",this.handleTimeline)}async loadNotificationWindow(){this.notificationWindow=new ge.TimelineWindow(tt.client,tt.client.getNotifTimelineSet()),await this.notificationWindow.load()}getInvites(){return tt.client.getVisibleRooms().filter((e=>"invite"===e.getMyMembership())).filter((e=>"m.space"===e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.type)).map((e=>h(Av,{handleRoom:this.handleRoom,key:e.roomId,room:e})))}render(e,t){return h("div",{id:"notifications-listing"},t.invites,function(e,t,n){const i=Date.now();let r=i;return e.reduce(((e,s)=>{const o=n(s),a=i-s.getTs(),l=r-s.getTs();if(o){let n;if(a<3e5&&l>6e4){r=s.getTs();const e=Math.floor(a/6e4);n=`${e} minute${1===e?"":"s"} ago`}else if(a<36e5&&l>6e5){r=s.getTs();const e=Math.floor(a/6e4);n=`${e} minute${1===e?"":"s"} ago`}else if(a<864e5&&l>36e5){r=s.getTs();const e=Math.floor(a/36e5);n=`${e} hour${1===e?"":"s"} ago`}else l>864e5&&(r=s.getTs(),n=`on ${new Date(r).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`);n&&e.push(t(n)),e.push(o)}return e}),[])}(t.events,this.toMilestone,this.toNotification),h(xv,{ref:this.scrollAnchor,fullyLoaded:t.fullyLoaded}))}}function xv(e){return e.fullyLoaded?h("div",null,h("div",{id:"scroll-done"},"All notifications loaded")):h("div",{id:"scroll-anchor"},"loading...")}function Tv(e){return h(Cv,{event:e.event},h(dv,{reactions:{},displayOnly:!0,event:e.event}))}class Cv extends m{constructor(e){super(e),Ev(this,"userColor",new we(this.props.event.getSender())),Ev(this,"userDisplayName",tt.client.getUser(this.props.event.getSender()).displayName),Ev(this,"avatarUrl",tt.client.getUser(this.props.event.getSender()).avatarUrl),Ev(this,"avatarHttpURI",tt.client.getHttpUriForMxcFromHS(this.avatarUrl,20,20,"crop")),Ev(this,"originRoom",tt.client.getRoom(this.props.event.getRoomId())),Ev(this,"originResource",this.originRoom.getLiveTimeline().getState(ge.EventTimeline.BACKWARDS).getStateEvents(Ue)[0]?.getStateKey()),Ev(this,"originAlias",this.originResource?tt.client.getRoom(this.originResource)?.getCanonicalAlias():null),Ev(this,"originAnnotation",this.originResource?tt.client.getRoom(this.originResource)?.getLiveTimeline().getState(ge.EventTimeline.BACKWARDS).getStateEvents(Be,this.originRoom.roomId):null),Ev(this,"originLocation",this.originAnnotation?new rs(this.originAnnotation):null),Ev(this,"getTopic",(e=>{switch(this.originLocation.getType()){case"highlight":return this.originLocation.getText();case"text":return h("span",{class:"non-text-topic"},Yt,h("span",null," a section of page ",this.originLocation.getPageIndex()));case"media-fragment":return h("span",{class:"non-text-topic"},rn,h("span",null,"an interval from ",this.originLocation.getIntervalStart()," to ",this.originLocation.getIntervalEnd()))}})),Ev(this,"handleClick",(e=>{const t=this.originLocation,n=encodeURIComponent(this.originAlias.slice(1)),i=this.props.event.getId();switch(console.log(t.event.getId()),this.originLocation.getType()){case"highlight":case"text":Pl.push(`/${n}/${t.getPageIndex()}/${t.getChild()}/${i}`);break;case"media-fragment":Pl.push(`/${n}/${this.originLocation.getIntervalStart()}/${t.getChild()}/${i}`);break;default:console.log(`unrecognized location type: ${JSON.stringify(this.originLocation)}`)}})),this.state={unread:wv(e.event)},this.checkUnread=this.checkUnread.bind(this)}componentDidMount(){tt.client.on("Room.accountData",this.checkUnread)}componentWillUnmount(){tt.client.off("Room.accountData",this.checkUnread)}checkUnread(e,t){t?.roomId===this.props.event.getRoomId()&&this.setState({unread:wv(this.props.event)})}render(e,t){if(tt.client.getRoom(this.originResource)&&this.originLocation)return h("div",{onclick:this.originAlias?this.handleClick:null,class:t.unread?"notification unread-notification":"notification",style:this.userColor.styleVariables},tt.client.getRoom(this.originResource)?.name?h("div",{class:"discussion-intro"},"In ",h("b",null,tt.client.getRoom(this.originResource).name),", discussing"):h("div",{class:"discussion-intro"},"Discussing"),h("div",{class:"discussion-topic"},this.getTopic()),h("div",{class:"notification-header"},this.avatarHttpURI?h("img",{src:this.avatarHttpURI}):null,h("span",{class:"sender"},this.userDisplayName),"said:"),h("div",{class:"notification-contents"},e.children))}}class Av extends m{constructor(...e){super(...e),Ev(this,"accept",(e=>{tt.client.joinRoom(this.props.room.roomId),setTimeout(this.props.handleRoom,1e3)})),Ev(this,"decline",(e=>{tt.client.leave(this.props.room.roomId),setTimeout(this.props.handleRoom,1e3)}))}render(e){return h("div",{class:"invite-entry"},h("div",{class:"invite-heading"},"You are invited to join the discussion ",e.room.name,"."),h("div",{class:"invite-buttons"},h("button",{class:"styled-button",onclick:this.accept},"Accept"),h("button",{class:"styled-button",onclick:this.decline},"Decline")))}}var Iv=__webpack_require__(7384),Rv={};Rv.styleTagTransform=Me(),Rv.setAttributes=Ie(),Rv.insert=Ce().bind(null,"head"),Rv.domAPI=xe(),Rv.insertStyleElement=Pe(),Ee()(Iv.Z,Rv),Iv.Z&&Iv.Z.locals&&Iv.Z.locals;class Pv extends m{constructor(e){super(e),this.state={syncStatus:this.fromState(tt.client.getSyncState())},this.handleSync=this.handleSync.bind(this)}fromState(e){switch(e){case"PREPARED":case"CATCHUP":return"loading data...";case"ERROR":return"no connection - working offline";default:return null}}componentDidMount(){tt.client.on("sync",this.handleSync)}componentWillUnmount(){tt.client.off("sync",this.handleSync)}handleSync(e,t){"PREPARED"===t&&tt.client.emit("sync.initial"),this.setState({syncStatus:this.fromState(e)})}render(e,t){return t.syncStatus?h("div",{class:e.class,id:"sync-indicator"},t.syncStatus):null}}var Ov=__webpack_require__(5188),Mv={};function Dv(){return Dv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Dv.apply(this,arguments)}function Lv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Mv.styleTagTransform=Me(),Mv.setAttributes=Ie(),Mv.insert=Ce().bind(null,"head"),Mv.domAPI=xe(),Mv.insertStyleElement=Pe(),Ee()(Ov.Z,Mv),Ov.Z&&Ov.Z.locals&&Ov.Z.locals;class Fv extends m{constructor(e){super(e),Lv(this,"resizeListener",(e=>{clearTimeout(this.resizeDebounceTimeout),this.resizeDebounceTimeout=setTimeout((e=>{document.body.offsetWidth>750?"wide"!==this.state.layout&&this.setState({view:"COLLECTION"===this.state.view?null:this.state.view,layout:"wide"}):document.body.offsetWidth>400?"narrow"!==this.state.layout&&this.setState({layout:"narrow"}):document.body.offsetWidth<=400&&"phone"!==this.state.layout&&this.setState({layout:"phone"})}),500)})),Lv(this,"searchInput",{current:null}),Lv(this,"popupMenu",{current:null}),Lv(this,"setSearch",(e=>this.setState({searchFilter:e}))),Lv(this,"setFilterItems",(e=>this.setState({filterItems:e}))),Lv(this,"submitSearch",(e=>{this.popupMenu.current.state.active||this.setState((e=>({searchFilter:"",filterItems:e.filterItems.concat(El(e.searchFilter).map((e=>({display:e,value:e}))))})))})),Lv(this,"flags",[{keyword:"fav",description:"favorite discussions"}]),Lv(this,"popupActions",{"@":e=>h(el,e),"~":e=>h(rl,Dv({flags:this.flags},e))}),Lv(this,"setFocus",(e=>this.setState({inputFocus:e,view:null}))),Lv(this,"toggleUploadVisible",(e=>this.setState((e=>"UPLOAD"===e.view?{view:null}:{view:"UPLOAD"})))),Lv(this,"toggleProfileVisible",(e=>this.setState((e=>"PROFILE"===e.view?{view:null}:{view:"PROFILE"})))),Lv(this,"toggleNotifVisible",(e=>this.setState((e=>"NOTIF"===e.view?{view:null}:{view:"NOTIF"})))),Lv(this,"toggleCollectionVisible",(e=>this.setState((e=>"COLLECTION"===e.view?{view:null}:{view:"COLLECTION"})))),Lv(this,"showMainView",(e=>this.setState({view:null}))),this.state={view:null,inputFocus:!1,searchFilter:"",filterItems:[],layout:document.body.offsetWidth>750?"wide":document.body.offsetWidth>400?"narrow":"phone"}}componentDidMount(){window.addEventListener("resize",this.resizeListener)}componentWillUnmount(){window.removeEventListener("resize",this.resizeListener)}render(e,t){return h(p,{key:"welcome-fragment"},h("header",{id:"welcome-header"},h("div",{id:"welcome-header-content"},h("div",{id:"welcome-search-wrapper"},h(fs,{search:t.searchFilter,setSearch:this.setSearch,searchInput:this.searchInput,submit:this.submitSearch,hint:"/",setFocus:this.setFocus}),h(Za,{below:!0,ref:this.popupMenu,textValue:t.searchFilter,textarea:this.searchInput,actions:this.popupActions,setTextValue:this.setSearch})),(!t.inputFocus||!("wide"!==t.layout))&&h(p,null,"wide"!==t.layout?h(Tr,{placement:"below",content:"Collection View"},h("button",{"data-active":"COLLECTION"===t.view,id:"welcome-collection",onClick:this.toggleCollectionVisible},Jt)):null,h(Bv,{active:"UPLOAD"===t.view,toggleUploadVisible:this.toggleUploadVisible}),h(Nv,{active:"NOTIF"===t.view,toggleNotifVisible:this.toggleNotifVisible}),h(jv,{active:"PROFILE"===t.view,toggleProfileVisible:this.toggleProfileVisible})))),h("div",{id:"welcome-container"},"UPLOAD"===t.view?h(Gr,{showMainView:this.showMainView}):"PROFILE"===t.view?h(uc,{logoutHandler:e.logoutHandler,showMainView:this.showMainView}):"NOTIF"===t.view?h(kv,null):"COLLECTION"===t.view?h("div",{class:"welcome-column"},h(rc,{oneColumn:!0,showMainView:this.showMainView,setFilterItems:this.setFilterItems,filterItems:t.filterItems})):"wide"!==t.layout?h("div",{class:"welcome-column"},h(Ll,{setFilterItems:this.setFilterItems,filterItems:t.filterItems,searchFilter:t.searchFilter})):h("div",{id:"welcome-split"},h(Ll,{setFilterItems:this.setFilterItems,filterItems:t.filterItems,searchFilter:t.searchFilter}),h("div",null,h(rc,{setFilterItems:this.setFilterItems,filterItems:t.filterItems}),h(Uv,null)))),h(Pv,null))}}class Nv extends m{constructor(e){super(e);const t=tt.client.getVisibleRooms().reduce(((e,t)=>e+(t.getUnreadNotificationCount("highlight")||0)),0),n=tt.client.getVisibleRooms().filter((e=>"invite"===e.getMyMembership())).filter((e=>"m.space"===e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.type)).length;this.state={count:t+n},this.updateCount=this.updateCount.bind(this)}componentDidMount(){tt.client.on("sync",this.updateCount),tt.client.on("RoomState.events",this.updateCount)}componentWillUnmount(){tt.client.off("sync",this.updateCount),tt.client.off("RoomState.events",this.updateCount)}updateCount(){const e=tt.client.getVisibleRooms().reduce(((e,t)=>e+(t.getUnreadNotificationCount("highlight")||0)),0),t=tt.client.getVisibleRooms().filter((e=>"invite"===e.getMyMembership())).filter((e=>e.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.[ze])).length;this.setState({count:e+t})}render(e,t){return h(Tr,{position:"below",content:"View notifications"},h("button",{"data-active":e.active,id:"welcome-notifications",onClick:e.toggleNotifVisible},Bt,t.count>0?h("span",{class:"small-icon-badge"},t.count):null))}}class jv extends m{constructor(e){super(e),Lv(this,"profileListener",(e=>{this.setState({avatarUrl:tt.client.getHttpUriForMxcFromHS(this.user.avatarUrl,30,30,"crop")})})),Lv(this,"displayInitial",(e=>"@"===this.user.displayName.slice(0,1)?this.user.displayName.slice(1,2):this.user.displayName.slice(0,1)));const t=tt.client.getUserId();this.user=tt.client.getUser(t),this.userColor=new we(t),this.state={avatarUrl:tt.client.getHttpUriForMxcFromHS(this.user.avatarUrl,30,30,"crop")}}componentDidMount(){tt.client.on("sync",this.profileListener)}componentWillUnmount(){tt.client.off("sync",this.profileListener)}render(e,t){return h(Tr,{position:"below",content:"View profile"},h("button",{"data-active":e.active,id:"welcome-profile",onClick:e.toggleProfileVisible,style:this.userColor.styleVariables},t.avatarUrl?h("img",{id:"welcome-img",src:t.avatarUrl}):h("span",{id:"welcome-initial"},this.displayInitial())))}}function Bv(e){return h(Tr,{position:"below",content:"Upload file"},h("button",{"data-active":e.active,id:"welcome-upload",onClick:e.toggleUploadVisible},ft))}function Uv(e){return h("div",{id:"welcome-about-card"},h("div",null,"Populus-Viewer"),h("hr",{class:"styled-rule"}),h("div",{id:"welcome-about-card-icons"},h("div",null,h("span",{class:"small-icon"},on)," ",h("a",{target:"_blank",href:"https://matrix.to/#/#opentower:matrix.org"},"Chat with developers")),h("div",null,h("span",{class:"small-icon"},an)," ",h("a",{target:"_blank",href:"https://github.com/opentower/populus-viewer/issues"},"Report a bug or request a feature"))),h("hr",{class:"styled-rule"}),h("div",null," Open-Tower  2022. All Rights Reserved"))}var qv=__webpack_require__(2462),zv={};function Vv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}async function Kv(e){let t=await ge.AutoDiscovery.findClientConfig(e);if("SUCCESS"!==t["m.homeserver"].state&&(e.includes("://")||(e="https://"+e),console.log(e),t=await ge.AutoDiscovery.fromDiscoveryConfig({"m.homeserver":{base_url:e}})),"SUCCESS"!==t["m.homeserver"].state)throw Error("failed autodiscovery");localStorage.setItem("baseUrl",t["m.homeserver"].base_url)}zv.styleTagTransform=Me(),zv.setAttributes=Ie(),zv.insert=Ce().bind(null,"head"),zv.domAPI=xe(),zv.insertStyleElement=Pe(),Ee()(qv.Z,zv),qv.Z&&qv.Z.locals&&qv.Z.locals;class Hv extends m{constructor(e){super(e),Vv(this,"switchView",(e=>t=>{t&&t.preventDefault(),this.setState({registering:e})})),Vv(this,"setServer",((e,t)=>this.setState({server:e},t))),Vv(this,"setName",(e=>this.setState({name:e}))),Vv(this,"setPassword",(e=>this.setState({password:e}))),Vv(this,"loginWrapper",{current:null}),Vv(this,"loginElement",{current:null}),Vv(this,"resizeObserver",new ResizeObserver((e=>this.resize()))),Vv(this,"resize",(e=>{this.loginWrapper.current.style.height=`${this.loginElement.current.scrollHeight}px`}));const t=new URLSearchParams(window.location.search);this.state={name:"",password:"",server:t.get("server")||""}}componentDidUpdate(){this.resizeObserver.disconnect(),this.resizeObserver.observe(this.loginElement.current)}componentWillUnmount(){this.resizeObserver.disconnect()}render(e,t){const n={setServer:this.setServer,server:t.server,setName:this.setName,name:t.name,setPassword:this.setPassword,password:t.password,loginHandler:e.loginHandler,switchView:this.switchView,loginElement:this.loginElement},i="register"===t.registering?h(Gv,n):h($v,n);return h("div",{id:"login-container"},h(Wv,null),h("div",{id:"login-wrapper",ref:this.loginWrapper},i))}}function Wv(){if(clearTimeout(this.debounceLockTimeout),this.debounceLockTimeout=setTimeout((e=>this.debounceLock=!1),500),this.debounceLock)return this.memo;this.debounceLock=!0;const e=[];if(document.body.offsetWidth>600)for(let t=0;t<document.body.offsetWidth/10;t++){const t=Math.random(),n=new we(t.toString()),i=Math.max(600*t,100),r=Math.max(50*Math.random());e.push(h("svg",{height:"50",width:i+50},h("rect",{x:r,width:i,height:25,style:`opacity:.1; fill: ${t<.6?n.solid:"transparent"}`})))}return this.memo=h("div",{id:"login-backdrop"},e),this.memo}class $v extends m{constructor(e){super(e),Vv(this,"handleSubmit",(e=>{e.preventDefault(),this.setState({submitting:!0}),(this.props.server?Kv(this.props.server):Promise.resolve(localStorage.setItem("baseUrl",je))).then((()=>tt.initClient())).then((e=>e.loginWithPassword(this.props.name.toLowerCase(),this.props.password))).then(this.props.loginHandler).catch((e=>{this.setState({submitting:!1}),window.alert(e)}))})),Vv(this,"queryServers",(e=>{const t={};this.flowControl=t,(this.props.server?Kv(this.props.server):Promise.resolve(localStorage.setItem("baseUrl",je))).then((()=>tt.initClient())).then((e=>e.loginFlows())).then(this.handleFlows).catch((()=>this.flowControl===t?this.setState({loading:"failed"}):null))})),Vv(this,"handleFlows",(e=>{const t=e.flows.find((e=>"m.login.sso"===e.type));t?this.setState({loading:null,SSOProviders:t.identity_providers}):this.setState({loading:null})})),Vv(this,"trySSO",((e,t,n)=>{n?.preventDefault(),(t?Kv(t):Promise.resolve(null)).then((()=>tt.client||tt.initClient())).then((t=>window.location.replace(t.getSsoLoginUrl(window.location.href,"sso",e))))})),Vv(this,"setServer",(e=>{clearTimeout(this.serverTimeout),e.match(/[^/]*\.[^/]*/)||""===e?(this.setState({SSOProviders:[],loading:"loading"}),this.props.setServer(e,(e=>{this.serverTimeout=setTimeout(this.queryServers,200)}))):(this.props.setServer(e),this.setState({SSOProviders:[],loading:e.length>0?"badurl":null}))})),Vv(this,"canSubmit",(e=>!(this.state.loading||this.props.password.length<8||/[^a-zA-Z0-9._=/]/.test(this.props.name))));const t=new URLSearchParams(window.location.search);this.state={SSOProviders:[],loading:!1},this.props.server&&t.get("sso")&&(this.doingSSO=!0,this.trySSO(t.get("sso"),t.get("server")))}componentDidMount(){this.props.server&&this.queryServers()}render(e,t){const n="loading"===t.loading?"loading server information...":"failed"===t.loading?"couldn't connect to server":"badurl"===t.loading?"the server name should look like 'matrix.org'":null;return this.doingSSO?h("div",{id:"login-sso-loader"},"Redirecting..."):h("div",{ref:e.loginElement,id:"login"},h("h3",null,"Login To Populus"),h("form",{id:"loginForm",onSubmit:this.handleSubmit},h(Yv,{connectionMessage:n,setServer:this.setServer,server:e.server,setPassword:e.setPassword,password:e.password,setName:e.setName,name:e.name}),h("div",null,h("button",{disabled:!this.canSubmit(),class:"styled-button"},"Login"))),t.SSOProviders.length>0?h(p,null,h("h4",null,"Or, login via:"),h("div",{id:"login-sso-providers"},t.SSOProviders.map((t=>{let n=null;return t.icon&&(n=ge.getHttpUriForMxc(localStorage.getItem("baseUrl"),t.icon,40,40,"crop")),h("div",{onclick:e=>this.trySSO(t.id,null,e),class:"login-sso-listing",key:t.id},n?h("img",{class:"sso-icon",width:"40",height:"40",src:n}):zt,h("a",{class:"sso-name",href:`?server=${encodeURIComponent(e.server)}&sso=${encodeURIComponent(t.id)}`},t.name))})))):null,h("div",{id:"login-options"},h("hr",{class:"styled-rule"}),h("span",null,"Don't have an account? "),h("a",{disabled:t.submitting,onClick:e.switchView("register")},"Register")))}}class Gv extends m{constructor(e){super(e),Vv(this,"beginRegistrationFlow",(async e=>{e.preventDefault(),this.setState({registrationStage:"retrieving-auth"}),this.props.server?await Kv(this.props.server):localStorage.setItem("baseUrl",je),await tt.initClient();try{await tt.client.register(this.props.name.toLowerCase(),this.props.password,void 0,{})}catch(e){if(e.data?.session&&e.data.params["m.login.recaptcha"])console.log(e.data),this.authSession=e.data.session,this.recaptchaKey=e.data.params["m.login.recaptcha"].public_key,this.setState({registrationStage:"awaiting-recaptcha"});else{switch(e.name){case"ConnectionError":un.set(h(p,null,h("h3",{id:"toast-header"},"Can't connect"),h("div",null,h("p",null,"Tried to connect to a server at ",tt.client.getHomeserverUrl()),h("p",null," Double-check that address?"))));break;case"M_USER_IN_USE":un.set(h(p,null,h("h3",{id:"toast-header"},"Can't register"),h("div",null,h("p",null,"Sorry, the name ",h("code",null,this.props.name)," is already in use at ",h("code",null,tt.client.getHomeserverUrl())),h("p",null," Try a different name or server?")))),this.props.setName("");break;default:un.set(h(p,null,h("h3",{id:"toast-header"},"Something went wrong"),h("div",null,"Sorry, here's the error"),h("pre",null,e.name,": ",e.message)))}this.setState({registrationStage:"awaiting-server"})}}})),Vv(this,"recaptchaHandler",(e=>{e.preventDefault(),this.setState({registrationStage:"registering"}),tt.client.register(this.props.name.toLowerCase(),this.props.password,this.authSession,{type:"m.login.recaptcha",response:e.detail}).catch(this.handleDummy).then((e=>tt.client.loginWithPassword(this.props.name.toLowerCase(),this.props.password))).then(this.props.loginHandler).catch(window.alert)})),Vv(this,"canSubmit",(e=>!(this.props.password.length<8||/[^a-zA-Z0-9._=/]/.test(this.props.name)))),Vv(this,"handleDummy",(e=>{if(console.log(e.data),(t=e.data).flows&&t.completed&&t.flows.some((e=>{const n=e.stages.filter((e=>!t.completed.includes(e)));return 1===n.length&&n.includes("m.login.dummy")})))return tt.client.register(this.props.name.toLowerCase(),this.password,this.authSession,{type:"m.login.dummy"});var t;throw new Error("Error: can't complete this registration flow")})),this.state={registrationStage:"awaiting-server"},this.recaptchaHandler=this.recaptchaHandler.bind(this)}componentDidMount(){window.addEventListener("recaptcha",this.recaptchaHandler)}componentWillUnmount(){window.removeEventListener("recaptcha",this.recaptchaHandler)}render(e,t){switch(t.registrationStage){case"retrieving-auth":return h("div",{ref:e.loginElement,id:"registration"},h("div",{id:"registeringFeedback"},"Retrieving Authentication Procedures..."));case"registering":return h("div",{ref:e.loginElement,id:"registration"},h("div",{id:"registeringFeedback"},"Registering Account..."));case"awaiting-recaptcha":return h("div",{ref:e.loginElement,id:"registration"},h("form",{id:"registerForm"},h("div",{id:"theRecaptcha"},"Complete this Recaptcha to finish registration",h("div",{class:"g-recaptcha","data-sitekey":this.recaptchaKey,"data-callback":"recaptchaHandler"})),h("hl",{style:"styled-rule"}),h("div",null,"OR, ",h("button",{class:"styled-button",onClick:e.switchView("login")},"Login With Existing Account")),h("script",{src:"https://www.google.com/recaptcha/api.js",async:!0,defer:!0})));case"awaiting-server":return h("div",{ref:e.loginElement,id:"registration"},h("h3",null,"Register an account"),h("form",{onSubmit:this.beginRegistrationFlow,id:"registerForm"},h(Yv,{newAccount:!0,setServer:e.setServer,server:e.server,setPassword:e.setPassword,password:e.password,setName:e.setName,name:e.name}),h("div",null,h("button",{disabled:!this.canSubmit(),class:"styled-button"},"Register a New Account")),h("div",{id:"login-options"},h("hr",{class:"styled-rule"}),h("span",null,"Already have an account? "),h("a",{onClick:e.switchView("login")},"Login With Existing Account"))))}}}class Yv extends m{constructor(...e){super(...e),Vv(this,"usernameInput",{current:null}),Vv(this,"passwordInput",{current:null}),Vv(this,"validateUsername",(e=>{this.props.setName(e.target.value),/[^a-zA-Z0-9._=/]/.test(e.target.value)?(this.usernameInput.current.setCustomValidity("Bad Character"),this.setState({usernameMessage:"Usernames can include only a-z, 0-9, =, _ or '.'"})):(this.usernameInput.current.setCustomValidity(""),this.setState({usernameMessage:null}))})),Vv(this,"validatePassword",(e=>{this.props.setPassword(e.target.value),e.target.value.length<8&&e.target.value.length>0?(this.passwordInput.current.setCustomValidity("Bad Password"),this.setState({passwordMessage:"Passwords must be at least 8 characters"})):(this.passwordInput.current.setCustomValidity(""),this.setState({passwordMessage:null}))})),Vv(this,"handleFocus",(e=>{window.innerHeight<450&&e.target.scrollIntoView({block:"center"})})),Vv(this,"handleServerInput",(e=>this.props.setServer(e.target.value)))}render(e,t){return h(p,null,h("label",{htmlFor:"servername"},"Server"),h("input",{class:"styled-input",value:e.server,onfocus:this.handleFocus,oninput:this.handleServerInput,type:"text",id:"servername",name:"servername",placeholder:"populus.open-tower.com"}),h("div",{class:"userdata-form-info"},e.connectionMessage),h("label",{htmlFor:"username"},"Username"),h("input",{class:"styled-input",autocomplete:"username",value:e.name,onfocus:this.handleFocus,onInput:this.validateUsername,type:"text",ref:this.usernameInput,id:"username",name:"username"}),h("div",{class:"userdata-form-info"},t.usernameMessage),h("label",{htmlFor:"password"},"Password"),h("input",{class:"styled-input",autocomplete:e.newAccount?"new-password":"current-password",onfocus:this.handleFocus,value:e.password,oninput:this.validatePassword,type:"password",ref:this.passwordInput,id:"password",name:"password"}),h("div",{class:"userdata-form-info"},t.passwordMessage))}}var Xv=__webpack_require__(8046),Zv={};Zv.styleTagTransform=Me(),Zv.setAttributes=Ie(),Zv.insert=Ce().bind(null,"head"),Zv.domAPI=xe(),Zv.insertStyleElement=Pe(),Ee()(Xv.Z,Zv),Xv.Z&&Xv.Z.locals&&Xv.Z.locals;var Jv=__webpack_require__(5789),Qv={};function ey(){return ey=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ey.apply(this,arguments)}function ty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Qv.styleTagTransform=Me(),Qv.setAttributes=Ie(),Qv.insert=Ce().bind(null,"head"),Qv.domAPI=xe(),Qv.insertStyleElement=Pe(),Ee()(Jv.Z,Qv),Jv.Z&&Jv.Z.locals&&Jv.Z.locals;class ny extends m{constructor(e){super(e),ty(this,"userColor",new we(tt.client.getUserId())),ty(this,"theInput",{current:null}),ty(this,"setModeDefault",(e=>this.setState({mode:"Default"}))),ty(this,"setModeSendFile",(e=>this.setState({mode:"SendFile"}))),ty(this,"setFile",(e=>this.setState({file:e}))),ty(this,"setModeRecordVideo",(e=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.setState({mode:"RecordVideo"}):alert("Your browser looks like it doesn't support accessing the webcam...")})),ty(this,"setModeRecordAudio",(e=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.setState({mode:"RecordAudio"}):alert("Your browser looks like it doesn't support accessing the webcam...")})),ty(this,"showMore",(e=>this.setState({buttons:this.state.buttons+1}))),ty(this,"showLess",(e=>this.setState({buttons:this.state.buttons-1}))),ty(this,"submitCurrentInput",(e=>{this.theInput.current&&this.theInput.current.submitInput()})),ty(this,"openPendingAnnotation",((e,t)=>{const n=tt.client.getDomain();if("pending"===this.props.focus.getStatus()){const i=Object.assign({},this.props.focus.location[Ge],{activityStatus:"open",rootEventId:t.event_id,rootContent:e}),r=Object.assign({},this.props.focus.location,{[Ge]:i}),s={via:[n],[We]:r};tt.client.sendStateEvent(this.props.resourceId,Be,s,this.props.focus.getChild()).catch((e=>alert(e))),tt.client.sendStateEvent(this.props.focus.getChild(),Ue,s,this.props.resourceId).catch((e=>alert(e)))}})),ty(this,"sendSelection",(async e=>{const t=this.props.generateLocation(),n={body:"created an annotation",msgtype:"m.emote",[$e]:{[qe]:this.props.resourceId,[We]:t}},i=await tt.client.sendMessage(this.props.focus.getChild(),n);this.openPendingAnnotation(n,i)})),ty(this,"openSettings",(e=>{const t=tt.client.getRoom(this.props.focus.getChild());hs.set(h(gl,{joinLink:!0,resource:this.props.resource,room:t}),"Room Settings",`for ${t.name}`)})),this.state={mode:"Default",buttons:1}}getInput(){const e={ref:this.theInput,submit:this.submitCurrentInput,roomId:this.props.focus.getChild(),handlePending:this.openPendingAnnotation,done:this.setModeDefault};switch(this.state.mode){case"Default":return h(ry,e);case"SendFile":return h(iy,ey({setFile:this.setFile,file:this.state.file},e));case"RecordVideo":return h(oy,e);case"RecordAudio":return h(ay,e)}}render(e,t){const n=tt.client.getRoom(e.focus.getChild()),i=n?.getMember(tt.client.getUserId()),r=!!i&&i.powerLevel>=100;return n&&!n.maySendMessage()?h("div",{id:"message-panel-disabled"},"Read-only Discussion"):h("div",{style:this.userColor.styleVariables,id:"messageComposer"},this.getInput(),h("div",{id:"submit-button-wrapper"},"Default"===t.mode?1===t.buttons?h(p,null,h("button",{id:"submitButton",onclick:this.submitCurrentInput},"Submit"),h(Tr,{key:"record-audio",content:"Record audio message"},h("button",{onclick:this.setModeRecordAudio},Mt)),h(Tr,{key:"record-video",content:"Record video message"},h("button",{onclick:this.setModeRecordVideo},Ot)),h(Tr,{key:"more-options",content:"More options"},h("button",{ref:this.showMoreButton,onclick:this.showMore},wt))):h(p,null,h(Tr,{key:"more-options-2",content:"More options"},h("button",{ref:this.showLessButton,onclick:this.showLess},wt)),h(Tr,{key:"quote-highlighted",content:"Quote highlighted"},h("button",{id:"quote-button",disabled:!e.hasSelection,onclick:this.sendSelection},Zt)),h(Tr,{key:"Upload-file",content:"Upload file"},h("button",{onclick:this.setModeSendFile},ut)),r?h(Tr,{key:"configure-room",content:"Configure room settings"},h("button",{onclick:this.openSettings},bt)):null):h(p,null,h("button",{id:"submitButton",onclick:this.submitCurrentInput},"Submit"),h("button",{id:"cancelButton",onclick:this.setModeDefault},"Cancel"))))}}class iy extends m{constructor(...e){super(...e),ty(this,"fileLoader",{current:null}),ty(this,"theForm",{current:null}),ty(this,"secondaryAudio",{current:null}),ty(this,"getFile",(e=>this.props.file||this.fileLoader.current.files[0])),ty(this,"setFileFromInput",(e=>this.validateFile(this.fileLoader.current.files[0]))),ty(this,"validateFile",(e=>{const t=tt.mediaConfig["m.upload.size"];e.size>=t?(alert(`Sorry, this file is too large to be uploaded. Your current server limits uploads to ${ye(t)}.`),this.props.done()):/^video/.test(e.type)?this.setState({previewUrl:URL.createObjectURL(e),mediaType:"video"}):/^image/.test(e.type)?this.setState({previewUrl:URL.createObjectURL(e),mediaType:"image"}):/^audio/.test(e.type)?Vr(e,"audio").then((t=>{this.mediaElement=t;const n=t.mozCaptureStream?.()||t.captureStream();this.setState({stream:n,previewUrl:URL.createObjectURL(e),mediaType:"audio"})})):this.setState({mediaType:"default"})})),ty(this,"submitInput",(async e=>{if(this.state.mediaType)switch(this.state.mediaType){case"image":await this.submitImage();break;case"video":await this.submitVideo();break;case"audio":await this.submitAudio();break;case"default":await this.submitDefault()}this.props.done()})),ty(this,"handleMediaClick",(e=>{console.log(this.mediaElement.current),this.mediaElement.paused?(this.mediaElement.currentTime=0,this.mediaElement.play(),this.secondaryAudio.current?.play()):(this.mediaElement.pause(),this.secondaryAudio.current?.pause())})),ty(this,"submitDefault",(async e=>{const t=this.getFile(),n=await tt.client.uploadContent(t,{progressHandler:this.progressHandler}).catch((e=>console.log(e))),i={body:t.name,filename:t.name,info:{mimetype:t.type?t.type:"application/octet-stream",size:t.size},msgtype:"m.file",url:n},r=await tt.client.sendMessage(this.props.roomId,i);this.props.handlePending(i,r)})),ty(this,"submitVideo",(async e=>{const t=this.getFile(),n=await Vr(t,"video"),i=await qr(n,n.videoWidth,n.videoHeight,"image/jpeg"),r=await tt.client.uploadContent(i.thumbnail,{name:`${t.name}_800x600`,type:"image/jpeg",progressHandler:this.progressHandler}),s=await Kr(i.thumbnail);console.log("upload video");const o=await tt.client.uploadContent(t,{progressHandler:this.progressHandler}),a=Math.round(1e3*n.duration),l={body:t.name,info:{h:i.info.h,w:i.info.w,mimetype:t.type,size:t.size,blurhash:s,thumbnail_url:r,thumbnail_info:i.info.thumbnail_info},msgtype:"m.video",url:o};a<1/0&&(l.duration=a);const c=await tt.client.sendMessage(this.props.roomId,l);this.props.handlePending(l,c)})),ty(this,"submitAudio",(async e=>{const t=this.getFile();console.log("upload audio");const n=await tt.client.uploadContent(t,{progressHandler:this.progressHandler}),i=Math.round(1e3*this.mediaElement.duration),r={body:t.name,info:{mimetype:t.type,size:t.size},msgtype:"m.audio",url:n};i<1/0&&(r.duration=i);const s=await tt.client.sendMessage(this.props.roomId,r);this.props.handlePending(r,s)})),ty(this,"submitImage",(async e=>{const t=this.getFile(),{width:n,height:i,img:r}=await zr(t),s=await Kr(t),o="image/jpeg"===t.type?"image/jpeg":"image/png",a=await qr(r,n,i,o),l=await tt.client.uploadContent(a.thumbnail,{name:`${t.name}_800x600`,type:o,progressHandler:this.progressHandler}),c=await tt.client.uploadContent(t,{progressHandler:this.progressHandler}),d={body:t.name,info:{h:i,w:n,mimetype:t.type,size:t.size,blurhash:s,thumbnail_url:l,thumbnail_info:a.info.thumbnail_info},msgtype:"m.image",url:c},h=await tt.client.sendMessage(this.props.roomId,d);this.props.handlePending(d,h)})),ty(this,"progressHandler",(e=>this.setState({progress:e})))}componentDidMount(){this.props.file?this.validateFile(this.props.file):this.fileLoader.current.click()}componentWillUnmount(){this.props.setFile(null)}componentDidUpdate(e){e.file!==this.props.file&&this.validateFile(this.props.file)}render(e,t){return h("form",{ref:this.theForm},h("input",{id:"file-uploader-input",ref:this.fileLoader,oninput:this.setFileFromInput,type:"file"}),"video"===t.mediaType?h("video",{ref:this.mediaPreview,class:"video-message-preview media-message-thumbnail",controls:!0,src:t.previewUrl}):"image"===t.mediaType?h("img",{ref:this.mediaPreview,class:"image-message-preview media-message-thumbnail",src:this.state.previewUrl}):"audio"===t.mediaType&&t.stream?h(p,null,this.mediaElement.mozCaptureStream?h("audio",{ref:this.secondaryAudio,srcObject:t.stream}):null,h(nv,{class:"audio-message-preview media-message-thumbnail",height:"100",onclick:this.handleMediaClick,stream:t.stream})):"default"===t.mediaType?h("div",{id:"file-uploader-preview"},h("span",null,vt),h("span",null,this.getFile().name),h("span",null,ye(this.getFile().size)," ")):null,this.state.progress?h("div",{id:"file-uploader-progress"},h("span",null,"Uploading file"),h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null)}}class ry extends m{constructor(e){super(e),ty(this,"currentInput",{current:null}),ty(this,"startTyping",(e=>{tt.client.sendTyping(this.props.roomId,!0,3e4),this.typingLock=!0,this.resetLockTimeout=setTimeout((e=>{this.typingLock=!1}),1e4)})),ty(this,"stopTyping",(e=>{this.typingLock=!1,clearTimeout(this.resetLockTimeout),clearTimeout(this.typingTimeout),tt.client.sendTyping(this.props.roomId,!1)})),ty(this,"handleInput",(e=>{""===e.target.value&&this.stopTyping(),this.setValue(e.target.value),this.currentInput.current.style.height="auto",this.currentInput.current.style.height=`${this.currentInput.current.scrollHeight}px`})),ty(this,"setValue",((e,t)=>this.setState({value:e},t))),ty(this,"handleKeydown",(e=>{e.stopPropagation(),clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout((e=>this.stopTyping()),5e3),"Enter"===e.code&&e.ctrlKey?(e.preventDefault(),this.props.submit()):this.typingLock||this.startTyping()})),ty(this,"submitInput",(e=>{if(this.props.roomId){if(this.stopTyping(),!this.state.value.replace(/\s/g,"").length)return;const e=this.reader.parse(Am(this.state.value)),t=this.writer.render(e),n={body:this.state.value,msgtype:"m.text",format:"org.matrix.custom.html",formatted_body:t};tt.client.sendMessage(this.props.roomId,n).then((e=>{this.props.handlePending(n,e)})),this.currentInput.current.style.height=null,this.setValue("")}})),ty(this,"popupActions",{"@":e=>h(nl,ey({roomId:this.props.roomId},e)),":":e=>h(Ja,e)}),this.state={value:""},this.reader=new Af,this.writer=new Lf}render(e,t){return h(p,null,h(Za,{textValue:t.value,textarea:this.currentInput,setTextValue:this.setValue,actions:this.popupActions}),h("textarea",{ref:this.currentInput,value:t.value,onkeydown:this.handleKeydown,oninput:this.handleInput,onblur:this.stopTyping,"data-gramm":"false"}))}}class sy extends m{constructor(...e){super(...e),ty(this,"mediaPreview",{current:null}),ty(this,"countdownToRecord",(async e=>{await this.initialization,this.state.countdown||this.setState({countdown:3,recording:"countdown"}),setTimeout((e=>{const t=this.state.countdown-1;if(this.setState({countdown:t}),0===t)return this.startRecord();this.countdownToRecord()}),1500)})),ty(this,"startRecord",(e=>{this.mediaRecorder.start(),this.setState({recording:"started"})})),ty(this,"finishRecord",(e=>{this.mediaRecorder.stop(),this.teardownStream(),this.setState({recording:"done"})})),ty(this,"progressHandler",(e=>this.setState({progress:e}))),ty(this,"recordingIcon",(e=>{switch(this.state.recording){case"started":return h("div",{"aria-label":"Stop recording","data-recording-state":this.state.recording,id:this.captionId},Dt);case"countdown":return h("div",{"data-recording-state":this.state.recording,id:this.captionId},this.state.countdown);case"done":return null;default:return h("div",{"aria-label":"Start recording","data-recording-state":this.state.recording,id:this.captionId},this.icon)}})),ty(this,"clickHandler",(()=>{switch(this.state.recording){case"started":return this.finishRecord();case"countdown":case"done":return null;default:return this.countdownToRecord()}}))}componentDidMount(){this.initStream()}componentWillUnmount(){this.teardownStream()}async initStream(){try{let e;this.initialization=new Promise((t=>{e=t})),this.stream=await navigator.mediaDevices.getUserMedia(this.constraints),this.mediaPreview.current.srcObject=this.stream,this.mediaRecorder=new MediaRecorder(this.stream,this.recorderOptions),this.mediaRecorder.ondataavailable=e=>{this.recordingBlob=e.data;const t=tt.mediaConfig["m.upload.size"];if(this.recordingBlob.size>t)return confirm(`Sorry, this recording is too large to be uploaded. Your current server limits uploads to ${ye(t)}. Would you like to save the recording locally?`)&&function(e,t,n){const i=window.URL.createObjectURL(e.slice(0,e.size,n)),r=document.createElement("a");r.style.display="none",r.href=i,r.download="populus-recording-toobig.webm",document.body.appendChild(r),r.click(),setTimeout((function(){document.body.removeChild(r),window.URL.revokeObjectURL(i)}),100)}(this.recordingBlob,0,this.recorderOptions.mimetype),this.setState({recording:null}),void this.initStream();this.setState({recordingAvailable:!0}),this.mediaPreview.current.srcObject=null,this.mediaPreview.current.setAttribute("controls",""),this.mediaPreview.current.src=URL.createObjectURL(e.data)},e()}catch(e){alert(e)}}async teardownStream(){await this.initialization,this.stream.getTracks().forEach((e=>e.stop()))}}class oy extends sy{constructor(...e){super(...e),ty(this,"constraints",{audio:!0,video:{facingMode:"user"},uploading:""}),ty(this,"recorderOptions",{mimeType:"video/webm",videoBitsPerSecond:1e6}),ty(this,"icon",Ot),ty(this,"captionId","videoCaption")}async submitInput(){if("done"===this.state.recording){const e=this.mediaPreview.current,t=await qr(e,e.videoWidth,e.videoHeight,"image/jpeg");this.setState({uploading:"thumbnail"});const n=await tt.client.uploadContent(t.thumbnail,{name:`${tt.client.getUserId()}_${Date.now()}_thumbnail`,type:"image/jpeg",progressHandler:this.progressHandler}),i=await Kr(t.thumbnail);this.setState({uploading:"video"});const r=await tt.client.uploadContent(this.recordingBlob,{progressHandler:this.progressHandler});this.setState({uploading:""});const s=Math.round(1e3*e.duration),o={body:`${tt.client.getUserId()}_${Date.now()}`,info:{h:t.info.h,w:t.info.w,mimetype:"video/webm",size:this.recordingBlob.size,blurhash:i,thumbnail_url:n,thumbnail_info:t.info.thumbnail_info},msgtype:"m.video",url:r};s<1/0&&(o.info.duration=s);const a=await tt.client.sendMessage(this.props.roomId,o);this.props.handlePending(o,a),this.props.done()}else alert("Before submitting, you need to record something.")}render(e,t){return h("div",{id:"videoRecordingWrapper"},h("video",{autoplay:!0,onclick:this.clickHandler,muted:!("done"===t.recording),ref:this.mediaPreview,class:"video-message-preview media-message-thumbnail"}),this.recordingIcon(),this.state.progress?h("div",{id:"media-uploader-progress"},h("span",null,"Uploading recording"),h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null)}}class ay extends sy{constructor(...e){super(...e),ty(this,"constraints",{audio:!0,video:!1}),ty(this,"recorderOptions",{mimeType:"audio/webm"}),ty(this,"icon",Mt),ty(this,"captionId","audioCaption")}async submitInput(){if("done"===this.state.recording){const e=this.mediaPreview.current,t=Math.round(1e3*e.duration),n=await tt.client.uploadContent(this.recordingBlob,{progressHandler:this.progressHandler}),i={body:`${tt.client.getUserId()}_${Date.now()}`,info:{mimetype:"audio/webm",size:this.recordingBlob.size},msgtype:"m.audio",url:n};t<1/0&&(i.info.duration=t);const r=await tt.client.sendMessage(this.props.roomId,i);this.props.handlePending(i,r),this.props.done()}else alert("Before submitting, you need to record something")}render(e,t){return h(p,null,h("div",{onclick:this.clickHandler,id:"audioRecordingWrapper"},h("audio",{style:{display:t.recordingAvailable?"block":"none"},ref:this.mediaPreview}),"started"===t.recording?h(nv,{stream:this.stream}):null,this.recordingIcon()),this.state.progress?h("div",{id:"media-uploader-progress"},h("span",null,"Uploading recording"),h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null)}}function ly(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class cy extends m{constructor(e){super(e),ly(this,"chatWrapper",{current:null}),ly(this,"chatPanel",{current:null}),ly(this,"scrollAnchorTop",{current:null}),ly(this,"scrollAnchorBottom",{current:null}),ly(this,"messagePanel",{current:null}),ly(this,"resizeObserver",new ResizeObserver((e=>{const t=this.chatWrapper.current,n=t.scrollHeight-this.prevScrollHeight;this.elementFixed?this.elementFixed.scrollIntoView({block:"center"}):this.bottomFilling&&(t.scrollTop=t.scrollTop-n),this.prevScrollHeight=t.scrollHeight}))),ly(this,"handleTimeline",(e=>{this.props.focus?.getChild()===e.getRoomId()&&this.state.fullyScrolledDown&&this.timelinePromise.then((e=>this.timelineWindow.paginate(ge.EventTimeline.FORWARDS,1,!1))).then(this.updateEvents)})),ly(this,"handleDragenter",(e=>{this.setState({droppable:!0})})),ly(this,"handleDragleave",(e=>{"chat-drop-overlay"===e.target.id&&this.setState({droppable:!1})})),ly(this,"handleDrop",(e=>{e.preventDefault(),e.dataTransfer.files[0]&&this.messagePanel.current.setState({mode:"SendFile",file:e.dataTransfer.files[0]}),this.setState({droppable:!1})})),ly(this,"handleDragover",(e=>e.preventDefault())),ly(this,"tryTopfill",(e=>{this.topFilling=!0,!this.state.fullyScrolledUp&&this.scrollAnchorTop.current.isVisible?this.timelineWindow.canPaginate(ge.EventTimeline.BACKWARDS)?this.timelineWindow.paginate(ge.EventTimeline.BACKWARDS,10).then((e=>setTimeout((e=>{this.setState({events:this.timelineWindow.getEvents()},this.tryTopfill)}),100))):this.timelineWindow.getTimelineIndex(ge.EventTimeline.BACKWARDS)?this.setState({fullyScrolledUp:!0},this.finishTopFill()):setTimeout(this.tryTopfill,100):this.finishTopFill()})),ly(this,"finishTopFill",(e=>{this.topFilling=!1,this.bottomFilling||setTimeout((e=>delete this.elementFixed),250)})),ly(this,"tryBottomfill",(e=>{this.bottomFilling=!0,!this.state.fullyScrolledDown&&this.scrollAnchorBottom.current.isVisible?this.timelineWindow.canPaginate(ge.EventTimeline.FORWARDS)?this.timelineWindow.paginate(ge.EventTimeline.FORWARDS,10).then((e=>setTimeout((e=>{this.setState({events:this.timelineWindow.getEvents()},this.tryBottomfill)}),100))):this.timelineWindow.getTimelineIndex(ge.EventTimeline.FORWARDS)?this.setState({fullyScrolledDown:!0},this.finishBottomFill):setTimeout(this.tryBottomfill,100):this.finishBottomFill()})),ly(this,"finishBottomFill",(e=>{this.bottomFilling=!1,this.topFilling||setTimeout((e=>delete this.elementFixed),250)})),ly(this,"getTopic",(e=>this.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.topic","")?.getContent().topic||"")),ly(this,"updateEvents",(e=>{this.setState({topic:this.getTopic(),events:this.timelineWindow.getEvents()},this.updateReadReceipt)})),ly(this,"handleFocusNotFound",(e=>{un.set(h(p,null,h("h3",{id:"toast-header"},"Something wasn't available"),h("div",null,"Here's the error message:"),h("pre",null,e.message))),Pl.replace(`/${this.props.resourceAlias}/`)})),this.state={events:[],topic:"",fullyScrolledUp:!1,fullyScrolledDown:!e.eventFocused},this.handleTimeline=this.handleTimeline.bind(this)}componentDidMount(){tt.client.on("Room.timeline",this.handleTimeline),tt.client.on("Room.localEchoUpdated",this.updateEvents),this.prevScrollHeight=this.chatWrapper.current.scrollHeight,this.resizeObserver.observe(this.chatPanel.current),this.resetFocus()}componentWillUnmount(){tt.client.off("Room.timeline",this.handleTimeline),tt.client.off("Room.localEchoUpdated",this.updateEvents),this.resizeObserver.disconnect()}async componentDidUpdate(e){e.focus.getChild()===this.props.focus.getChild()&&e.eventFocused===this.props.eventFocused||this.resetFocus()}async loadTimelineWindow(e){try{await tt.client.joinRoom(this.props.focus.getChild(),{viaServers:this.props.focus.getVia()})}catch(e){return alert(e),void this.props.unsetFocus()}return this.room=await tt.client.getRoomWithState(e),this.timelineWindow=new ge.TimelineWindow(tt.client,this.room.getUnfilteredTimelineSet()),this.timelineWindow.load(this.props.eventFocused)}async updateReadReceipt(){clearTimeout(this.updateReadReceiptDebounce),this.updateReadReceiptDebounce=setTimeout((e=>{const t=this.state.events[this.state.events.length-1];if(!t)return;if(t.getAssociatedStatus())return;const n=t.getId(),i=this.room.getEventReadUpTo(tt.client.getUserId(),!0)!==n,r=n!==this.lastReceiptSentId;i&&r&&(console.log("sending receipt"),tt.client.setRoomReadMarkers(this.room.roomId,n,t).catch(console.log),tt.client.sendReadReceipt(t).then((e=>{this.room.setUnreadNotificationCount("total",0),this.room.setUnreadNotificationCount("highlight",0),this.lastReceiptSentId=n})).catch(console.log))}),200)}async resetFocus(){this.chatWrapper.current.scrollTop=0,this.timelinePromise=this.loadTimelineWindow(this.props.focus.getChild());try{await this.timelinePromise,this.setState({fullyScrolledUp:!1,fullyScrolledDown:!1,topic:this.getTopic(),events:this.timelineWindow.getEvents()},(e=>{this.updateReadReceipt(),this.prevScrollHeight=this.chatWrapper.current.scrollHeight,this.elementFixed=document.getElementById(this.props.eventFocused),this.tryTopfill(),this.tryBottomfill()}))}catch(e){if("M_NOT_FOUND"===e.name)return this.handleFocusNotFound(e);console.log(e)}}render(e,t){const n=e.resource.room?.getMember(tt.client.getUserId()),i=!!e.resource.room?.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).hasSufficientPowerLevelFor("redact",n.powerLevel),r={},s=t.events.filter((e=>"m.room.message"===e.getType()&&("m.text"===e.getContent().msgtype||"m.emote"===e.getContent().msgtype||"m.notice"===e.getContent().msgtype||"m.file"===e.getContent().msgtype||"m.image"===e.getContent().msgtype||"m.video"===e.getContent().msgtype||"m.audio"===e.getContent().msgtype||0===Object.keys(e.getContent()).length)));let o=null;const a=s.reduce(((t,n)=>{switch(o&&o.getSender()===n.getSender()||(t.push(h(gm,{key:`${n.getId()}-userinfo`,userId:n.getSender(),isMe:n.getSender()===tt.client.getUserId()})),o=n),n.getContent().msgtype){case"m.text":t.push(h(dv,{reactions:r,key:n.getId(),resourceAlias:e.resourceAlias,canRedact:i,event:n}));break;case"m.notice":t.push(h(mv,{reactions:r,key:n.getId(),resourceAlias:e.resourceAlias,canRedact:i,event:n}));break;case"m.file":t.push(h(fv,{reactions:r,key:n.getId(),canRedact:i,event:n}));break;case"m.emote":n.getContent()[$e]?t.push(h(uv,{reactions:r,resource:e.resource,resourceAlias:e.resourceAlias,secondaryFocus:e.secondaryFocus,setSecondaryFocus:e.setSecondaryFocus,roomId:e.focus.getChild(),key:n.getId(),canRedact:i,event:n})):t.push(h(hv,{reactions:r,key:n.getId(),canRedact:i,event:n}));break;case"m.image":t.push(h(vv,{reactions:r,key:n.getId(),canRedact:i,event:n}));break;case"m.video":t.push(h(yv,{reactions:r,key:n.getId(),canRedact:i,event:n}));break;case"m.audio":t.push(h(bv,{reactions:r,key:n.getId(),canRedact:i,event:n}));break;case void 0:o.getSender()===n.getSender()&&t.length>1&&t[t.length-1].type===dy?t[t.length-1].props.count=t[t.length-1].props.count+1:t.push(h(dy,{count:1,key:n.getId(),username:n.getSender(),isMe:n.getSender()===tt.client.getUserId()}))}return t}),[]);return t.events.forEach((e=>{"m.reaction"===e.getType()&&e.getContent()?.["m.relates_to"]?.event_id&&(r[e.getContent()["m.relates_to"].event_id]?r[e.getContent()["m.relates_to"].event_id].push(e):r[e.getContent()["m.relates_to"].event_id]=[e])})),h("div",{ref:this.chatWrapper,id:"chat-wrapper",class:e.class,ondragenter:this.handleDragenter,"data-droppable":t.droppable},t.droppable?h("div",{id:"chat-drop-overlay",ondrop:this.handleDrop,ondragover:this.handleDragover,ondragleave:this.handleDragleave}):null,h("div",{ref:this.chatPanel,id:"chat-panel"},h(hy,{ref:this.scrollAnchorBottom,chatWrapper:this.chatWrapper,tryFill:this.tryBottomfill,fullyScrolled:t.fullyScrolledDown},h(ny,{ref:this.messagePanel,hasSelection:e.hasSelection,generateLocation:e.generateLocation,resource:e.resource,resourceId:e.resource.room.roomId,focus:e.focus})),h("div",{id:"messages"},a,h(my,{key:e.focus.getChild(),roomId:e.focus.getChild()})),h(hy,{ref:this.scrollAnchorTop,chatWrapper:this.chatWrapper,tryFill:this.tryTopfill,fullyScrolled:t.fullyScrolledUp},h(uy,{focus:e.focus,resource:e.resource,topic:t.topic}))))}}class dy extends m{constructor(...e){super(...e),ly(this,"userColor",new we(this.props.username))}render(e){return e.isMe?h("div",{class:"redacted message-frame message-from-user",style:this.userColor.styleVariables},h("div",{class:"message-decoration"}),h("div",{class:"message-body"},e.count>1?`${e.count} messages deleted`:"message deleted")):h("div",{class:"redacted message-frame",style:this.userColor.styleVariables},h("div",{class:"message-decoration"}),h("div",{class:"message-body"},e.count>1?`${e.count} messages deleted`:"message deleted"))}}class hy extends m{constructor(...e){super(...e),ly(this,"scrollAnchorDiv",{current:null}),ly(this,"intersectionObserver",new IntersectionObserver((e=>{e.some((e=>e.isIntersecting))?this.isVisible=!0:this.isVisible=!1,this.props.tryFill()}),{root:this.props.chatWrapper.current}))}componentDidMount(){this.isVisible=!0,this.intersectionObserver.observe(this.scrollAnchorDiv.current)}componentWillUnmount(){this.intersectionObserver.disconnect()}render(e){return h("div",{ref:this.scrollAnchorDiv,id:e.fullyScrolled?null:"scroll-anchor"},e.fullyScrolled?e.children:h("svg",{width:"350px",height:"80px",viewBox:"0 0 350 80"},h("rect",{x:"0",y:"1",width:"120",height:"20",ry:"10",rx:"10"}),h("rect",{x:"130",y:"1",width:"180",height:"20",ry:"10",rx:"10"}),h("rect",{x:"0",y:"30",width:"180",height:"20",ry:"10",rx:"10"}),h("rect",{x:"190",y:"30",width:"120",height:"20",ry:"10",rx:"10"}),h("rect",{x:"0",y:"60",width:"50",height:"20",ry:"10",rx:"10"}),h("rect",{x:"60",y:"60",width:"150",height:"20",ry:"10",rx:"10"})))}}function uy(e){return h(p,null,h("div",{id:"anchor-preview-wrapper"},h(ov,{showPosition:!0,resource:e.resource,location:e.focus})),h(py,{focus:e.focus}),h("div",{id:"scroll-done"},"pending"===e.focus.getStatus()?"Awaiting your comment...":null))}class py extends m{constructor(...e){super(...e),ly(this,"handleError",(e=>{un.set(h(p,null,h("h3",{id:"toast-header"},"Couldn't mark as question"),h("div",null,"Maybe you don't have permission to edit this annotation? Here's the error message:"),h("pre",null,e.message)))})),ly(this,"toggleQuestion",(e=>{const t=tt.client.getRoom(this.props.focus.getChild()).getLiveTimeline().getState(ge.EventTimeline.FORWARDS);if(!t.maySendStateEvent(Ue,tt.client.getUserId()))return;const n=t.getStateEvents(Ue);for(const e of n){const t=new rs(e);if(!t.isValid())continue;const n=Object.assign({},t.location,{motivation:"questioning"});this.props.focus.isQuestion()&&delete n.motivation;const i={via:e.getContent().via,[We]:n};tt.client.sendStateEvent(this.props.focus.getChild(),Ue,i,this.props.focus.getParent()).catch((e=>alert(e)));const r={via:tt.client.getRoom(this.props.focus.getParent()).getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(Be,t.getChild()).getContent().via,[We]:n};r.via&&tt.client.sendStateEvent(this.props.focus.getParent(),Be,r,this.props.focus.getChild()).catch((e=>this.handleError(e)))}}))}render(e){return h("div",{id:"anchor-chat-flags"},h(Tr,{content:e.focus?.isQuestion()?"unmark as question":"mark as question"},h("button",{class:"small-icon",onclick:this.toggleQuestion,"data-active-flag":e.focus?.isQuestion()}," ",ln)))}}class my extends m{constructor(e){super(e),ly(this,"handleTypingNotification",((e,t)=>{if(t.roomId===this.props.roomId){const t=tt.client.getUserId(),n=e.getContent().user_ids.filter((e=>e!==t));this.setState({typing:n})}})),this.handleTypingNotifications=this.handleTypingNotification.bind(this),this.state={typing:[]}}componentDidMount(){tt.client.on("RoomMember.typing",this.handleTypingNotification)}componentWillUnmount(){tt.client.off("RoomMember.typing",this.handleTypingNotification)}render(e,t){const n=t.typing.map((e=>tt.client.getUser(e).displayName)),i=n.length;return 0===i?h("div",{class:"typing-indicator"},""):1===i?h("div",{class:"typing-indicator"},n[0]," is typing"):2===i?h("div",{class:"typing-indicator"},n[0]," and ",n[1]," are typing"):h("div",{class:"typing-indicator"},"several people are typing")}}var gy=__webpack_require__(1444),fy={};function vy(){return vy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},vy.apply(this,arguments)}function yy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}fy.styleTagTransform=Me(),fy.setAttributes=Ie(),fy.insert=Ce().bind(null,"head"),fy.domAPI=xe(),fy.insertStyleElement=Pe(),Ee()(gy.Z,fy),gy.Z&&gy.Z.locals&&gy.Z.locals;class by extends m{constructor(e){super(e),yy(this,"handleTypingNotification",((e,t)=>{tt.client.getRoom(this.props.roomId).getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(Be,t.roomId)&&this.setState((n=>{const i=tt.client.getUserId(),r=e.getContent().user_ids.filter((e=>e!==i));return{typing:{...n.typing,[t.roomId]:r}}}))})),yy(this,"handleKeydown",(e=>{e.altKey&&!e.shiftKey&&"Tab"===e.key&&this.props.focusNext(),e.altKey&&e.shiftKey&&"Tab"===e.key&&this.props.focusPrev()})),yy(this,"setFocus",(e=>this.setState({searchFocus:e}))),yy(this,"searchInput",{current:null}),yy(this,"byCreation",((e,t)=>e.event.getTs()>t.event.getTs()?-1:e.event.getTs()<t.event.getTs()?1:0)),yy(this,"byPage",((e,t)=>e.getPageIndex()>t.getPageIndex()?1:e.getPageIndex()<t.getPageIndex()?-1:0)),yy(this,"byActivity",((e,t)=>{const n=tt.client.getRoom(e.getChild()),i=tt.client.getRoom(t.getChild());if(n&&i){const e=n.getLastActiveTimestamp(),t=i.getLastActiveTimestamp();return e>t?-1:e<t?1:0}return n?-1:i?1:0})),yy(this,"sortByActivity",(e=>{"Activity"===this.state.sort?this.setState((e=>({sortOrder:-1*e.sortOrder}))):this.setState({sort:"Activity"})})),yy(this,"sortByPage",(e=>{"Page"===this.state.sort?this.setState((e=>({sortOrder:-1*e.sortOrder}))):this.setState({sort:"Page"})})),yy(this,"sortByCreation",(e=>{"Creation"===this.state.sort?this.setState((e=>({sortOrder:-1*e.sortOrder}))):this.setState({sort:"Creation"})})),yy(this,"flipSort",(e=>this.setState((e=>({sortOrder:-1*e.sortOrder}))))),yy(this,"flags",[{keyword:"me",description:"my annotations"},{keyword:"hour",description:"annotations from the last hour"},{keyword:"day",description:"annotations from the last day"},{keyword:"week",description:"annotations from the last week"},{keyword:"unread",description:"unread annotations"},{keyword:"question",description:"annotations asking questions"}]),yy(this,"popupActions",{"@":e=>h(nl,vy({roomId:this.props.roomId},e)),"~":e=>h(rl,vy({flags:this.flags},e))}),this.state={typing:{},sort:"Activity",sortOrder:1,searchFocus:!1},this.handleTypingNotification=this.handleTypingNotification.bind(this)}componentDidMount(){tt.client.on("RoomMember.typing",this.handleTypingNotification),document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){tt.client.off("RoomMember.typing",this.handleTypingNotification),document.removeEventListener("keydown",this.handleKeydown)}getSortFunc(){switch(this.state.sort){case"Page":return this.byPage;case"Activity":return this.byActivity;case"Creation":return this.byCreation}}render(e,t){const n=[],i=Date.now();let r=i,s=1,o=!1;for(const a of e.filteredAnnotationContents.sort(this.getSortFunc())){let l;if(o)switch(t.sort){case"Page":if(s<a.getPageIndex()){const e=a.getPageIndex();l=h("div",{class:"annotation-listing-divider"},h("span",null,"Page ",1===t.sortOrder?e:s)),s=e}else l=h("div",{class:"annotation-listing-divider"});break;case"Activity":{const e=tt.client.getRoom(a.getChild());if(e&&1===t.sortOrder){const t=i-e.getLastActiveTimestamp(),n=r-e.getLastActiveTimestamp();if(t<3e5&&n>6e4){r=e.getLastActiveTimestamp();const n=Math.floor(t/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${n} minute${1===n?"":"s"} ago`))}else if(t<36e5&&n>6e5){r=e.getLastActiveTimestamp();const n=Math.floor(t/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${n} minute${1===n?"":"s"} ago`))}else if(t<864e5&&n>36e5){r=e.getLastActiveTimestamp();const n=Math.floor(t/36e5);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${n} hour${1===n?"":"s"} ago`))}else n>864e5?(r=e.getLastActiveTimestamp(),l=h("div",{class:"annotation-listing-divider"},h("span",null,`on ${new Date(r).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`))):l=h("div",{class:"annotation-listing-divider"});break}}case"Creation":if(1===t.sortOrder){const e=i-a.event.getTs(),t=r-a.event.getTs();if(e<3e5&&t>6e4){r=a.event.getTs();const t=Math.floor(e/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${t} minute${1===t?"":"s"} ago`))}else if(e<36e5&&t>6e5){r=a.event.getTs();const t=Math.floor(e/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${t} minute${1===t?"":"s"} ago`))}else if(e<864e5&&t>36e5){r=a.event.getTs();const t=Math.floor(e/36e5);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${t} hour${1===t?"":"s"} ago`))}else t>864e5?(r=a.event.getTs(),l=h("div",{class:"annotation-listing-divider"},h("span",null,`on ${new Date(r).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`))):l=h("div",{class:"annotation-listing-divider"});break}default:l=h("div",{class:"annotation-listing-divider"})}else o=!0;n.push(l),n.push(h(wy,{key:a.getChild(),typing:t.typing[a.getChild()],resource:e.resource,annotationLocation:a,focusByRoomId:e.focusByRoomId,focus:e.focus,parentRoom:e.room}))}return h("div",{id:"annotation-panel",class:e.class},h("div",{id:"annotation-entries-wrapper",tabindex:"-1"},h("div",{id:"annotation-controls"},h("button",{class:"small-icon",style:"cursor: pointer",onClick:this.flipSort},1===t.sortOrder?$t:Wt),h("button",{"data-current-button":"Activity"===t.sort,onClick:this.sortByActivity,class:"styled-button"},"Activity"),h("button",{"data-current-button":"Creation"===t.sort,onClick:this.sortByCreation,class:"styled-button"},"Creation"),"application/pdf"===e.mimetype?h("button",{"data-current-button":"Page"===t.sort,onClick:this.sortByPage,class:"styled-button"},"Page"):null),0===Object.values(e.annotationContents).length?h("div",{class:"empty-marker"},h("b",null,"No annotations yet available")):0===e.filteredAnnotationContents.length?h("div",{class:"empty-marker"},h("b",null,"No annotations matching search")):1===t.sortOrder?n:n.reverse()),h("div",{id:"annotation-panel-button-wrapper","data-mode":t.searchFocus?"search":"navigation"},h(Za,{textValue:e.annotationFilter,textarea:this.searchInput,actions:this.popupActions,setTextValue:e.setAnnotationFilter}),h(fs,{hint:"/",searchInput:this.searchInput,search:e.annotationFilter,setSearch:e.setAnnotationFilter,setFocus:this.setFocus})))}}class wy extends m{constructor(e){super(e),yy(this,"handleTimeline",((e,t)=>{t.roomId===this.room?.roomId&&this.setState({})})),yy(this,"comment",{current:null}),yy(this,"entry",{current:null}),yy(this,"handleClick",(e=>{this.props.focusByRoomId(this.props.annotationLocation.getChild())})),yy(this,"creator",this.props.parentRoom.getMember(this.props.annotationLocation.getCreator())),yy(this,"userColor",new we(this.creator.userId)),this.state={topic:e.annotationLocation.getText()}}componentDidMount(){hm(this.comment.current),tt.client.on("Room.timeline",this.handleTimeline),tt.client.on("Room.accountData",this.handleTimeline),um(this.comment.current),this.setTopic()}componentWillUnmount(){tt.client.off("Room.timeline",this.handleTimeline),tt.client.off("Room.accountData",this.handleTimeline)}componentDidUpdate(e){e.focus?.getChild()!==this.props.annotationLocation.getChild()&&this.props.focus?.getChild()===this.props.annotationLocation.getChild()&&this.entry.current.scrollIntoView()}async setTopic(){this.room=await tt.client.getRoomWithState(this.props.annotationLocation.getChild()),this.setState({topic:this.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.topic","")?.getContent().topic||this.props.annotationLocation.getText()})}render(e,t){const n="object"==typeof e.typing&&Object.keys(e.typing).length>0||null,i=e.focus?.getChild()===e.annotationLocation.getChild();return e.annotationLocation.getType(),h("div",{style:this.userColor.styleVariables,"data-annotation-entry-typing":n,"data-annotation-entry-focused":i,ref:this.entry,onclick:this.handleClick,class:"annotation-listing-entry"},h(ov,{showPosition:!0,resource:e.resource,location:e.annotationLocation}),h(Sy,{creator:this.creator,unread:e.annotationLocation.getUnread(),commentRef:this.comment,annotationLocation:e.annotationLocation}))}}function Sy(e){const t=e.annotationLocation.getRootContent();if(t){let n;switch(t.msgtype){case"m.text":n=gv({content:t});break;case"m.notice":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a notice"));break;case"m.image":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a file"));break;case"m.video":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a video"));break;case"m.audio":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent an audio recording"));break;case"m.emote":n=t[$e]?h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent an annotation")):h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a message"));break;default:n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a message"))}return h(p,null,h("div",{ref:e.commentRef,class:e.unread?"annotation-listing-comment-unread":"annotation-listing-comment"}," ",n," "),h("div",{class:"annotation-listing-info"},h("div",{class:"annotation-listing-features"},e.annotationLocation.isQuestion()?ln:null,e.annotationLocation.isPrivate()?Xt:null,"parent"===e.annotationLocation.getOrientation()?qt:null),h("div",{class:"annotation-listing-creator"},h(as,{member:e.creator}))))}if("pending"===e.annotationLocation.getStatus())return h("div",{class:"annotation-listing-pending"},"awaiting your comment... ")}var _y=__webpack_require__(6213),Ey={};function ky(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ey.styleTagTransform=Me(),Ey.setAttributes=Ie(),Ey.insert=Ce().bind(null,"head"),Ey.domAPI=xe(),Ey.insertStyleElement=Pe(),Ee()(_y.Z,Ey),_y.Z&&_y.Z.locals&&_y.Z.locals;class xy extends m{constructor(e){super(e),ky(this,"resultListing",{current:null}),ky(this,"searchInput",{current:null}),ky(this,"setFocus",(e=>this.setState({focusedResult:e}))),ky(this,"focusNext",(e=>{null===this.state.focusedResult?this.setFocus(0):this.state.focusedResult+1<this.state.searchResults.length&&this.setFocus(this.state.focusedResult+1)})),ky(this,"focusPrev",(e=>{null===this.state.focusedResult&&this.setFocus(this.state.searchResults.length-1),this.state.focusedResult>0&&this.setFocus(this.state.focusedResult-1)})),ky(this,"handleScroll",(e=>{this.resultListing.current.scrollHeight-this.resultListing.current.clientHeight-this.resultListing.current.scrollTop<100&&!this.limitRaised&&(this.limitRaised=!0,this.setState((e=>({searchLimit:e.searchLimit+20}))))})),ky(this,"handleKeydown",(e=>{e.altKey&&!e.shiftKey&&"Tab"===e.key&&this.focusNext(),e.altKey&&e.shiftKey&&"Tab"===e.key&&this.focusPrev()})),ky(this,"handleBlur",(e=>{this.props.searchString.length<1&&this.props.endSearch()})),this.state={searchResults:[],searchLimit:20,focusedResult:null}}componentDidMount(){this.initializeSearch(),document.addEventListener("keydown",this.handleKeydown),this.searchInput.current.focus()}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}componentDidUpdate(e,t){this.props.searchString!==e.searchString&&this.props.pdfText?this.initializeSearch():this.state.searchLimit>t.searchLimit&&this.props.pdfText&&this.expandSearch()}resetSearch(){this.setState({searchResults:[],searchLimit:20,focusedResult:null})}initializeSearch(){if(this.props.searchString.length<3)return void this.resetSearch();const e=[],t=this.props.searchString.toLowerCase().replace(/[^a-zA-Z0-9]/gm,"");for(const[n,i]of Object.entries(this.props.pdfText)){const r=i.toLowerCase().replace(/[^a-zA-Z0-9]/gm,""),s=[];let o=r.indexOf(t),a=o+t.length;for(;o>-1;){let e=!0,n=0,l=0,c=0;for(const d of i){if(e&&c===o&&(e=!1),!e&&c===a){s.push(i.slice(Math.max(0,n-15),l+40)),o=r.indexOf(t,o+1),a=o+t.length;break}e&&n++,d.match(/[a-zA-Z0-9]/)&&c++,l++}}if(s.length>0&&e.push({page:n,contexts:s}),e.length>20)break}this.setState({focusedResult:null,searchResults:e,searchLimit:20})}expandSearch(){if(this.props.searchString.length<3)return void this.resetSearch();const e=this.state.searchResults,t=e.slice(-1)[0].page,n=this.props.searchString.toLowerCase().replace(/[^a-zA-Z0-9]/gm,"");for(const[i,r]of Object.entries(this.props.pdfText))if(parseInt(i,10)>parseInt(t,10)){const t=r.toLowerCase().replace(/[^a-zA-Z0-9]/gm,"");let s=t.indexOf(n),o=s+n.length;const a=[];for(;s>-1;){let e=!0,i=0,l=0,c=0;for(const d of r){if(e&&c===s&&(e=!1),!e&&c===o){a.push(r.slice(Math.max(0,i-15),l+40)),s=t.indexOf(n,s+1),o=s+n.length;break}e&&i++,d.match(/[a-zA-Z0-9]/)&&c++,l++}}if(a.length>0&&e.push({page:i,contexts:a}),e.length>this.state.searchLimit)break}this.setState({searchResults:e},(e=>{this.limitRaised=!1}))}render(e,t){return h("div",{ref:this.resultListing,id:"pdf-search-result-panel",onscroll:this.handleScroll,class:e.class},this.props.pdfText?h(p,null,h("div",{id:"pdf-search-term"},h("div",null,h("b",null,"Search Results For:")),h(fs,{hint:"Alt-/",searchInput:this.searchInput,onBlur:this.handleBlur,search:e.searchString,setSearch:e.setSearch})),t.searchResults.map(((n,i)=>h(Ty,{roomFocused:e.roomFocused,resourceAlias:e.resourceAlias,key:n.page,result:n,hideListing:e.hideListing,focusedResult:t.focusedResult,setFocus:this.setFocus,index:i})))):h("div",{id:"pdf-search-warn"},h("b",null,"Indexing Pdf, Please Wait...")))}}class Ty extends m{constructor(...e){super(...e),ky(this,"focus",(e=>{this.props.setFocus(this.props.index);const t=`/${encodeURIComponent(this.props.resourceAlias)}/${this.props.result.page}/${this.props.roomFocused?this.props.roomFocused:""}`;Pl.push(t),this.result.current.scrollIntoView(),document.body.offsetWidth<=600&&this.props.hideListing()})),ky(this,"result",{current:null})}componentDidUpdate(e){this.props.focusedResult!==e.focusedResult&&this.props.index===this.props.focusedResult&&this.focus()}render(e){return h("div",{ref:this.result,onClick:this.focus,"data-focused-result":e.index===e.focusedResult,class:"pdf-search-result"},e.result.contexts.map(((t,n)=>h("div",{key:`${e.result.page}-${n}`,class:"result-context"}," ",t," "))),h("div",{class:"page-data"},"page: ",e.result.page," "))}}function Cy(e,t,n){const i=t.offsetParent;t.style.left=e.left-i.offsetLeft/n+"px",t.style.top=e.top-i.offsetTop/n+"px",t.style.height=`${e.height}px`,t.style.width=`${e.width}px`}class Ay{static fromQuadArray([e,t,n,i,r,s,o,a]){return new Ay(e,t,n,i,r,s,o,a)}static fromRectIn(e,t,n){const i=72/(n||72),r=e.x,s=t.scrollHeight-e.y-e.height,o=e.x,a=t.scrollHeight-e.y,l=e.x+e.width,c=t.scrollHeight-e.y,d=e.x+e.width,h=t.scrollHeight-e.y-e.height;return new Ay(r*i,s*i,o*i,a*i,l*i,c*i,d*i,h*i)}constructor(e,t,n,i,r,s,o,a){this.x1=e,this.y1=t,this.x2=n,this.y2=i,this.x3=r,this.y3=s,this.x4=o,this.y4=a}toDOMRectInHeight(e,t){const n=72/(t||72),i=this.getBoundingRect();return new DOMRect(i.left*n,(e-i.top)*n,(i.right-i.left)*n,(i.top-i.bottom)*n)}getArray(){return[this.x1,this.y1,this.x2,this.y2,this.x3,this.y3,this.x4,this.y4].map(Math.round)}getBoundingRect(){return{left:Math.round(Math.min(this.x1,this.x2,this.x3,this.x4)),right:Math.round(Math.max(this.x1,this.x2,this.x3,this.x4)),top:Math.round(Math.max(this.y1,this.y2,this.y3,this.y4)),bottom:Math.round(Math.min(this.y1,this.y2,this.y3,this.y4))}}}var Iy=__webpack_require__(5047),Ry={};function Py(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ry.styleTagTransform=Me(),Ry.setAttributes=Ie(),Ry.insert=Ce().bind(null,"head"),Ry.domAPI=xe(),Ry.insertStyleElement=Pe(),Ee()(Iy.Z,Ry),Iy.Z&&Iy.Z.locals&&Iy.Z.locals;class Oy extends m{constructor(e){super(e),Py(this,"handleTypingNotification",((e,t)=>{tt.client.getRoom(this.props.roomId).getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(Be,t.roomId)&&this.setState((n=>{const i=tt.client.getUserId(),r=e.getContent().user_ids.filter((e=>e!==i));return{typing:{...n.typing,[t.roomId]:r}}}))})),Py(this,"filterAnnotations",(e=>e.getPageIndex()===parseInt(this.props.pageFocused,10))),Py(this,"sortAnnotations",((e,t)=>e.getRect()&&t.getRect()?e.getRect().top<t.getRect().top?1:t.getRect().top<e.getRect().top?-1:0:0)),this.state={typing:{}},this.handleTypingNotification=this.handleTypingNotification.bind(this)}componentDidMount(){tt.client.on("RoomMember.typing",this.handleTypingNotification)}componentDidUnmount(){tt.client.off("RoomMember.typing",this.handleTypingNotification)}updateGutter(e,t){for(const n in e)e[n].getRect().bottom>=t.getRect().top&&delete e[n];let n=0;for(;;){if(!e[n])return e[n]=t,n;n++}}getAnnotations(){const e=tt.client.getRoom(this.props.roomId),t=this.props.focus?.getChild();let n=[];if(e){let e=!1;const i=this.props.filteredAnnotationContents.filter((t=>(t.getChild()===this.props.focus?.getChild()&&(e=!0),this.filterAnnotations(t)))).sort(this.sortAnnotations);this.props.secondaryFocus&&this.filterAnnotations(this.props.secondaryFocus)&&i.push(this.props.secondaryFocus),this.props.focus&&this.filterAnnotations(this.props.focus)&&!e&&i.push(this.props.focus);const r={},s={};n=i.map((e=>{const n=e.getChild(),i=this.props.fixedSide?"right"===this.props.fixedSide:null;switch(e.getType()){case"text":return h(Dy,{key:e.event.getId(),focused:t===n,typing:this.state.typing[n],pdfWidthAdjustedPx:this.props.pdfWidthAdjustedPx,pdfHeightAdjustedPx:this.props.pdfHeightAdjustedPx,setFocus:this.props.setFocus,location:e});case"highlight":{let o;return o=i?this.updateGutter(s,e):this.updateGutter(r,e),h(Ly,{zoomFactor:this.props.zoomFactor,key:e.event.getId(),focused:t===n,typing:this.state.typing[n],rightSide:i,gutterDepth:o,setFocus:this.props.setFocus,pdfWidthAdjustedPx:this.props.pdfWidthAdjustedPx,pdfHeightAdjustedPx:this.props.pdfHeightAdjustedPx,location:e})}}}))}return n}render(e){return h("div",{ref:e.annotationLayerWrapper,"data-annotation-focused":!!e.focus,class:"annotation-layer"},this.getAnnotations(),e.pindropMode?.x?h(My,{coordinates:e.pindropMode}):null)}}function My(e){return h("span",{class:"annotation-pindrop annotation-pindrop-preview","data-annotation":!0,style:{left:`${e.coordinates.x}px`,top:`${e.coordinates.y}px`}},Yt)}class Dy extends m{constructor(...e){super(...e),Py(this,"setFocus",(e=>this.props.setFocus(this.props.location))),Py(this,"userColor",new we(this.props.location.getCreator())),Py(this,"left",this.props.location.getRect().left),Py(this,"top",this.props.pdfHeightAdjustedPx-this.props.location.getRect().top)}shouldComponentUpdate(e){if(0===e.pdfWidthAdjusted)return!1;e.pdfHeightAdjustedPx!==this.props.pdfHeightAdjustedPx&&(this.positioned||(this.left=this.props.location.getRect().left,this.top=e.pdfHeightAdjustedPx-this.props.location.getRect().top))}render(e){const t="object"==typeof e.typing&&Object.keys(e.typing).length>0||null;return h("span",{onclick:this.setFocus,class:"annotation-pindrop","data-focused":e.focused,"data-annotation-typing":t,"data-annotation":!0,style:{left:`${this.left}px`,top:`${this.top}px`,...this.userColor.styleVariables}},Yt)}}class Ly extends m{constructor(e){super(e),Py(this,"setFocus",(e=>this.props.setFocus(this.props.location))),Py(this,"roomId",this.props.location.getChild()),Py(this,"clientRects",this.props.location.getQuadPoints().map((e=>Ay.fromQuadArray(e).toDOMRectInHeight(this.props.pdfHeightAdjustedPx)))),Py(this,"boundingRect",new DOMRect(this.props.location.getRect().left,this.props.pdfHeightAdjustedPx-this.props.location.getRect().top,this.props.location.getRect().right-this.props.location.getRect().left,this.props.location.getRect().top-this.props.location.getRect().bottom)),Py(this,"userColor",new we(this.props.location.getCreator())),this.state={rightSide:this.calculateSide(e)}}calculateSide(e){return e.pdfWidthAdjustedPx>2*this.boundingRect.width?e.pdfWidthAdjustedPx-(this.boundingRect.width+this.boundingRect.x)<this.boundingRect.x:e.location.getChild().charCodeAt(1)%2==1}shouldComponentUpdate(e){if(0===e.pdfWidthAdjustedPx)return!1;e.pdfHeightAdjustedPx!==this.props.pdfHeightAdjustedPx&&(this.positioned||(this.boundingRect=new DOMRect(this.props.location.getRect().left,e.pdfHeightAdjustedPx-this.props.location.getRect().top,this.props.location.getRect().right-this.props.location.getRect().left,this.props.location.getRect().top-this.props.location.getRect().bottom),this.clientRects=this.props.location.getQuadPoints().map((t=>Ay.fromQuadArray(t).toDOMRectInHeight(e.pdfHeightAdjustedPx))),this.setState({rightSide:this.calculateSide(e)})))}render(e,t){if(!this.props.pdfWidthAdjustedPx)return null;const n=this.clientRects.map((e=>h(Ny,{pdfWidthAdjustedPx:this.props.pdfWidthAdjustedPx,key:e,zoomFactor:this.props.zoomFactor,setFocus:this.setFocus,rect:e}))),i="object"==typeof e.typing&&Object.keys(e.typing).length>0||null;return h("div",{style:this.userColor.styleVariables,"data-annotation-typing":i,"data-focused":e.focused,id:this.roomId},h(Fy,{pdfWidthAdjustedPx:e.pdfWidthAdjustedPx,rightSide:e.rightSide??t.rightSide,gutterDepth:e.gutterDepth,rect:this.boundingRect,zoomFactor:e.zoomFactor,setFocus:this.setFocus}),h("div",{class:"inline-annotations"},n))}}class Fy extends m{constructor(...e){super(...e),Py(this,"ref",{current:null}),Py(this,"getTabRect",(e=>this.props.rightSide?new DOMRect(this.props.pdfWidthAdjustedPx-10+10*this.props.gutterDepth,this.props.rect.y,3,this.props.rect.height):new DOMRect(5-10*this.props.gutterDepth,this.props.rect.y,3,this.props.rect.height)))}componentDidMount(){Cy(this.getTabRect(),this.ref.current,1)}componentDidUpdate(){Cy(this.getTabRect(),this.ref.current,this.props.zoomFactor)}render(e){return h("span",{onclick:e.setFocus,class:"annotation-bartab","data-annotation":!0,ref:this.ref})}}class Ny extends m{constructor(...e){super(...e),Py(this,"ref",{current:null})}componentDidMount(){Cy(this.props.rect,this.ref.current,this.props.zoomFactor)}componentDidUpdate(){Cy(this.props.rect,this.ref.current,this.props.zoomFactor)}render(e){return h("span",{onclick:e.setFocus,"data-annotation":!0,ref:this.ref})}}function jy(e){const t=e.getRangeAt(0);return Array.from(t.cloneContents().childNodes).map((e=>3===e.nodeType?e.data:1===e.nodeType?e.innerText:"")).join(" ").replace(/(.)-\s+/g,"$1")}function By(e,t,n){return n?e.nextSibling?By(e.nextSibling,t):e.parentNode?By(e.parentNode,t,!0):null:t(e)?e:e.firstChild?By(e.firstChild,t):e.nextSibling?By(e.nextSibling,t):e.parentNode?By(e.parentNode,t,!0):null}function Uy(e){const t=[],n=t=>3===t.nodeType||t===e;let i=By(e,n);if(i===e)return[e];for(t.push(i);(i=By(i,n,!0))!==e;)t.push(i);return t}function qy(e,t,n){const i=document.createRange();return i.selectNode(e),t&&i.setStart(e,t),n&&i.setEnd(e,n),i.getBoundingClientRect()}function zy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Vy extends m{constructor(e){super(e),zy(this,"textLayer",{current:null}),zy(this,"annotationLayer",{current:null}),zy(this,"annotationLayerWrapper",{current:null}),zy(this,"isTarget",(e=>e.target===this.annotationLayer.current.base)),zy(this,"setPdfFitRatio",(e=>this.setState({pdfFitRatio:e}))),zy(this,"generateLocation",(e=>{const t=jy(e),n=function(e,t,n){const i=e.getRangeAt(0);let r=[];if(i.startContainer!==i.endContainer){if(1===i.startContainer.nodeType){const e=Array.from(i.startContainer.childNodes).slice(i.startOffset).map(Uy).reduce(((e,t)=>e.concat(t)),[]);r=r.concat(e.map((e=>qy(e))))}if(3===i.startContainer.nodeType&&r.push(qy(i.startContainer,i.startOffset)),1===i.endContainer.nodeType){const e=Array.from(i.endContainer.childNodes).slice(0,i.endOffset).map(Uy).reduce(((e,t)=>e.concat(t)),[]);r=r.concat(e.map((e=>qy(e))))}3===i.endContainer.nodeType&&i.endOffset>0&&r.push(qy(i.endContainer,0,i.endOffset)),r=r.concat(function(e,t){const n=[],i=e=>3===e.nodeType||e===t;let r=e;for(;(r=By(r,i,!0))!==t;)n.push(r);return n}(i.startContainer,i.endContainer).map((e=>qy(e))))}else{if(1===i.startContainer.nodeType){const e=Array.from(i.startContainer.childNodes).slice(i.startOffset,i.endOffset).map(Uy).reduce(((e,t)=>e.concat(t)),[]);r=r.concat(e.map((e=>qy(e))))}3===i.startContainer.nodeType&&r.push(qy(i.startContainer,i.startOffset,i.endOffset))}return function(e){return e.filter((e=>e.width>1)).map((e=>(e.x=e.x-5,e.width=e.width+10,e)))}(r.map((e=>function(e,t,n){const i=e.getBoundingClientRect();return new DOMRect((t.x-i.x)/n,(t.y-i.y)/n,t.width/n,t.height/n)}(t,e,n))))}(e,this.annotationLayerWrapper.current,this.state.pdfFitRatio*this.props.zoomFactor),i=function(e){const t=e.map((e=>e.x)),n=e.map((e=>e.y)),i=e.map((e=>e.right)),r=e.map((e=>e.bottom)),s=Math.min(...t),o=Math.min(...n);return new DOMRect(s,o,Math.max(...i)-s,Math.max(...r)-o)}(n),r=n.map((e=>Ay.fromRectIn(e,this.annotationLayerWrapper.current))),s=Ay.fromRectIn(i,this.annotationLayerWrapper.current);return{[Ve]:{page_index:this.props.pageFocused,rect:s.getBoundingRect(),quad_points:r.map((e=>e.getArray())),contents:"",text_content:t},[Ge]:{activityStatus:"pending",creator:tt.client.getUserId()}}})),zy(this,"commitHighlight",(e=>{if(!mn())return;const t=window.getSelection();if(t.isCollapsed)return;const n=jy(t),i=tt.client.getDomain(),r=this.props.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.power_levels"),s=this.generateLocation(t);return tt.client.createRoom({visibility:"private",name:`highlighted passage on page ${this.props.pageFocused}`,power_level_content_override:{users:Object.assign({},r[0].getContent().users,{[tt.client.getUserId()]:100})},topic:n,initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}},{type:Ue,content:{via:[i],[We]:s},state_key:this.props.room.roomId}]}).then((e=>{t.removeAllRanges();const n={via:[i],[We]:s},r=new ge.MatrixEvent({type:"m.space.child",origin_server_ts:(new Date).getTime(),room_id:this.props.room.roomId,sender:tt.client.getUserId(),state_key:e.room_id,content:n});return tt.client.sendStateEvent(this.props.room.roomId,Be,n,e.room_id),r}))})),zy(this,"commitPin",((e,t)=>{if(!mn())return;const n=tt.client.getDomain(),i=this.props.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents("m.room.power_levels"),r=this.annotationLayerWrapper.current.scrollHeight-t,s={[He]:{page_index:this.props.pageFocused,rect:{left:e,right:e+10,top:r,bottom:r-10},name:"Comment",contents:""},[Ge]:{activityStatus:"pending",creator:tt.client.getUserId()}};return tt.client.createRoom({visibility:"private",name:`pindrop on page ${this.props.pageFocused}`,power_level_content_override:{users:Object.assign({},i[0].getContent().users,{[tt.client.getUserId()]:100})},initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}},{type:Ue,content:{via:[n],[We]:s},state_key:this.props.room.roomId}]}).then((e=>{const t={via:[n],[We]:s},i=new ge.MatrixEvent({type:"m.space.child",origin_server_ts:(new Date).getTime(),room_id:this.props.room.roomId,sender:tt.client.getUserId(),state_key:e.room_id,content:t});return tt.client.sendStateEvent(this.props.room.roomId,Be,t,e.room_id),i})).catch((e=>alert(e)))})),this.state={pdfFitRatio:1},this.pdfScale=3}hasSelection(){return!window.getSelection().isCollapsed&&this.textLayer.current.contains(window.getSelection().getRangeAt(0).endContainer)&&this.textLayer.current.contains(window.getSelection().getRangeAt(0).startContainer)}render(e,t){return h("div",{class:"page-wrapper",style:{"--pdfFitRatio":t.pdfFitRatio,"--pdfWidthPx":`${e.pdfWidthPx}px`,"--pdfHeightPx":`${e.pdfHeightPx}px`}},h(wn,{setPdfDimensions:e.setPdfDimensions,setPdfFitRatio:this.setPdfFitRatio,pdfScale:this.pdfScale,annotationLayer:this.annotationLayer,hasFetched:e.hasFetched,pdfPromise:e.pdfPromise,textLayer:this.textLayer,searchString:e.searchString,pageFocused:e.pageFocused,setPdfLoadingStatus:e.setPdfLoadingStatus}),h(Oy,{ref:this.annotationLayer,pindropMode:e.pindropMode,annotationLayerWrapper:this.annotationLayerWrapper,filteredAnnotationContents:e.filteredAnnotationContents,pdfWidthAdjustedPx:e.pdfWidthPx/t.pdfFitRatio,pdfHeightAdjustedPx:e.pdfHeightPx/t.pdfFitRatio,fixedSide:e.fixedSide,zoomFactor:e.zoomFactor,pageFocused:e.pageFocused,roomId:e.room.roomId,setFocus:e.setFocus,focus:e.focus,secondaryFocus:e.secondaryFocus}))}}function Ky(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Hy extends m{static positionToPage(e,t){const n=t?.getAccountData(Ne)?.getContent().position,i=parseInt(e,10);return Number.isInteger(i)?i:Number.isInteger(n)?n:1}constructor(e){super(e),Ky(this,"updateSavedLocation",(e=>{clearTimeout(this.saveLocationTimeout),this.saveLocationTimeout=setTimeout((e=>{tt.client.setRoomAccountData(this.props.room.roomId,Ne,{deviceId:tt.deviceId,position:this.props.pageFocused})}),1500)})),Ky(this,"handleBadPage",(e=>{if(this.props.resourceLength){console.log("fired");const e=this.props.pageFocused<this.props.resourceLength?1:this.props.resourceLength;Pl.replace(`/${encodeURIComponent(this.props.resourceAlias)}/${e}`+(this.props.roomFocused?`/${this.props.roomFocused}`:"")+(this.props.eventFocused?`/${this.props.eventFocused}`:""))}})),Ky(this,"mainPage",{current:null}),Ky(this,"secondaryPage",{current:null}),Ky(this,"getSecondaryHeight",(e=>this.state.showSecondary&&this.state.secondaryPageHeightPx||0)),Ky(this,"getSecondaryWidth",(e=>this.state.showSecondary&&this.state.secondaryPageWidthPx||0)),Ky(this,"setMainPageDimensions",((e,t)=>{this.setState({mainPageHeightPx:e,mainPageWidthPx:t},this.refreshDimensions)})),Ky(this,"setSecondaryPageDimensions",((e,t)=>{this.setState({secondaryPageHeightPx:e,secondaryPageWidthPx:t},this.refreshDimensions)})),Ky(this,"refreshDimensions",(e=>this.props.setContentDimensions(Math.max(this.state.mainPageHeightPx,this.getSecondaryHeight()),this.state.mainPageWidthPx+this.getSecondaryWidth()))),Ky(this,"toggleSecondary",(e=>{this.setState((e=>({showSecondary:!e.showSecondary})),this.refreshDimensions)})),Ky(this,"catchFetchPdfError",(e=>{un.set(h(p,null,h("h3",{id:"toast-header"},"Couldn't fetch the PDF..."),h("div",null,"Tried to fetch: "),h("pre",null,this.props.resourceAlias),h("div",null,"Here's the error message:"),h("pre",null,e.message))),Pl.push("/"),this.errorCondition=!0})),Ky(this,"gatherText",(async e=>{if(this.props.setPdfText){const e=await this.state.pdfPromise,t={};for(let n=1;n<e.numPages+1;n++){const i=await e.getPage(n),r=await i.getTextContent();t[n]=r.items.map((e=>e.str)).join(" ")}this.props.setPdfText(t)}})),Ky(this,"releasePin",(e=>{let t;if(this.mainPage.current.isTarget(e))t="primary";else{if(!this.secondaryPage?.current?.isTarget(e))return document.removeEventListener("click",this.releasePin),void this.props.setPindropMode(null);t="secondary"}const n=e.altKey?14*Math.round((e.offsetX-14)/14):e.offsetX-14,i=e.altKey?14*Math.round((e.offsetY-14)/14):e.offsetY-14;this.props.setPindropMode({x:n,y:i,page:t})})),Ky(this,"commitHighlight",(e=>{let t;if(this.mainPage.current.hasSelection())t=this.mainPage.current;else{if(!this.secondaryPage?.current?.hasSelection())return;t=this.secondaryPage.current}t.commitHighlight().then((e=>{this.props.setFocus(new rs(e)),this.props.showChat()})).catch((e=>alert(e)))})),Ky(this,"commitPin",((e,t,n)=>{if("primary"===n)n=this.mainPage.current;else{if("secondary"!==n)return;n=this.secondaryPage.current}n.commitPin(e,t).then((e=>{this.props.setFocus(new rs(e)),this.props.showChat()})).catch((e=>alert(e))),document.removeEventListener("click",this.releasePin),this.props.setPindropMode(null)})),Ky(this,"generateLocation",(e=>{const t=window.getSelection();if(!t.isCollapsed)return this.mainPage.current.hasSelection()?this.mainPage.current.generateLocation(t):this.secondaryPage?.current?.hasSelection()?this.secondaryPage?.current?.generateLocation(t):void 0})),Ky(this,"zoomMin",1),Ky(this,"zoomMax",5),Ky(this,"hasSelection",(e=>this.mainPage.current.hasSelection()||this.secondaryPage?.current?.hasSelection())),this.state={showSecondary:!1,mainPageWidthPx:null,mainPageHeightPx:null,secondaryPageWidthPx:null,secondaryPageHeightPx:null},this.hasFetched=new Promise(((e,t)=>{this.resolveFetch=e,this.rejectFetch=t}))}componentDidMount(){this.fetchPdf()}componentDidUpdate(e){this.props.resourceLength===e.resourceLength&&e.pageFocused===this.props.pageFocused||(this.props.pageFocused<1||this.props.pageFocused>this.props.resourceLength?this.handleBadPage():(this.updateSavedLocation(),this.props.pageFocused>e.pageFocused?this.props.contentContainer.current.scrollTop=0:this.props.pageFocused<e.pageFocused&&(this.props.contentContainer.current.scrollTop=this.props.contentContainer.current.scrollHeight)))}async fetchPdf(){const e=new is(this.props.room);Hy.PDFStore[e.url]?console.log(`found pdf for ${this.props.room.name} in store`):Hy.PDFStore[e.url]=window.fetch(e.httpUrl).then((async e=>{const t=e.clone(),n=+e.headers.get("Content-Length"),i=e.body.getReader();let r=0;for(;;){const{done:e,value:t}=await i.read();if(e)break;r+=t.length,this.props.setPdfLoadingStatus(r/n)}return t.arrayBuffer()})).then((e=>vn.getDocument(e).promise)).catch(this.catchFetchPdfError),this.errorCondition||this.setState({pdfPromise:Hy.PDFStore[e.url]},(t=>Hy.PDFStore[e.url].then((e=>this.props.setTotalPages(e.numPages))).then(this.resolveFetch).then(this.gatherText)))}render(e,t){const n=t.showSecondary&&e.pageFocused<e.totalPages,i="primary"===e.pindropMode?.page?e.pindropMode:null,r="secondary"===e.pindropMode?.page?e.pindropMode:null;return h("div",{style:{visibility:t.mainPageHeightPx?null:"hidden"},id:"document-view"},h(Vy,{filteredAnnotationContents:e.filteredAnnotationContents,focus:e.focus,pageFocused:e.pageFocused,pdfHeightPx:t.mainPageHeightPx,pdfWidthPx:t.mainPageWidthPx,fixedSide:n?"left":null,hasFetched:this.hasFetched,pdfPromise:t.pdfPromise,pindropMode:i,ref:this.mainPage,room:e.room,searchString:e.searchString,secondaryFocus:e.secondaryFocus,setFocus:e.setFocus,setPdfDimensions:this.setMainPageDimensions,setPdfLoadingStatus:e.setPdfLoadingStatus,zoomFactor:e.zoomFactor}),n?h(Vy,{filteredAnnotationContents:e.filteredAnnotationContents,focus:e.focus,fixedSide:n?"right":null,hasFetched:this.hasFetched,pdfPromise:t.pdfPromise,pageFocused:e.pageFocused+1,pdfHeightPx:t.secondaryPageHeightPx,pdfWidthPx:t.secondaryPageWidthPx,pindropMode:r,ref:this.secondaryPage,room:e.room,searchString:e.searchString,secondaryFocus:e.secondaryFocus,setFocus:e.setFocus,setPdfDimensions:this.setSecondaryPageDimensions,setPdfLoadingStatus:e.setPdfLoadingStatus,zoomFactor:e.zoomFactor}):null)}}Ky(Hy,"PDFStore",{});class Wy{constructor(e,t,n){this.wavesurfer=n,this.wrapper=n.drawer.wrapper,this.util=n.util,this.style=this.util.style,this.regionsUtil=t,this.vertical=n.drawer.params.vertical,this.id=null==e.id?n.util.getId():e.id,this.start=Number(e.start)||0,this.end=null==e.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(e.end),this.resize=void 0===e.resize||Boolean(e.resize),this.drag=void 0===e.drag||Boolean(e.drag),this.isResizing=!1,this.isDragging=!1,this.loop=Boolean(e.loop),this.color=e.color||"rgba(0, 0, 0, 0.1)",this.handleStyle=e.handleStyle||{left:{},right:{}},this.handleLeftEl=null,this.handleRightEl=null,this.data=e.data||{},this.attributes=e.attributes||{},this.showTooltip=e.showTooltip??!0,this.maxLength=e.maxLength,this.minLength=e.minLength,this._onRedraw=()=>this.updateRender(),this.scroll=!1!==e.scroll&&n.params.scrollParent,this.scrollSpeed=e.scrollSpeed||1,this.scrollThreshold=e.scrollThreshold||10,this.preventContextMenu=void 0!==e.preventContextMenu&&Boolean(e.preventContextMenu);let i=null==e.channelIdx?-1:parseInt(e.channelIdx);if(this.channelIdx=i,this.regionHeight="100%",this.marginTop="0px",-1!==i){let e=null!=this.wavesurfer.backend.buffer?this.wavesurfer.backend.buffer.numberOfChannels:-1;e>=0&&i<e&&(this.regionHeight=Math.floor(1/e*100)+"%",this.marginTop=this.wavesurfer.getHeight()*i+"px")}this.formatTimeCallback=e.formatTimeCallback,this.edgeScrollWidth=e.edgeScrollWidth,this.bindInOut(),this.render(),this.wavesurfer.on("zoom",this._onRedraw),this.wavesurfer.on("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-created",this)}update(e,t){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.handleStyle&&(this.handleStyle=e.handleStyle),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize),this.updateHandlesResize(this.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),null!=e.maxLength&&(this.maxLength=Number(e.maxLength)),null!=e.minLength&&(this.minLength=Number(e.minLength)),null!=e.attributes&&(this.attributes=e.attributes),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this,t)}remove(){this.element&&(this.wrapper.removeChild(this.element.domElement),this.element=null,this.fireEvent("remove"),this.wavesurfer.un("zoom",this._onRedraw),this.wavesurfer.un("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-removed",this))}play(e){const t=e||this.start;this.wavesurfer.play(t,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)}playLoop(e){this.loop=!0,this.play(e)}setLoop(e){this.loop=e}render(){this.element=this.util.withOrientation(this.wrapper.appendChild(document.createElement("region")),this.vertical),this.element.className="wavesurfer-region",this.showTooltip&&(this.element.title=this.formatTime(this.start,this.end)),this.element.setAttribute("data-id",this.id);for(const e in this.attributes)this.element.setAttribute("data-region-"+e,this.attributes[e]);if(this.style(this.element,{position:"absolute",zIndex:3,height:this.regionHeight,top:this.marginTop}),this.resize){this.handleLeftEl=this.util.withOrientation(this.element.appendChild(document.createElement("handle")),this.vertical),this.handleRightEl=this.util.withOrientation(this.element.appendChild(document.createElement("handle")),this.vertical),this.handleLeftEl.className="wavesurfer-handle wavesurfer-handle-start",this.handleRightEl.className="wavesurfer-handle wavesurfer-handle-end";const e={cursor:this.vertical?"row-resize":"col-resize",position:"absolute",top:"0px",width:"2px",height:"100%",backgroundColor:"rgba(0, 0, 0, 1)"},t="none"!==this.handleStyle.left?Object.assign({left:"0px"},e,this.handleStyle.left):null,n="none"!==this.handleStyle.right?Object.assign({right:"0px"},e,this.handleStyle.right):null;t&&this.style(this.handleLeftEl,t),n&&this.style(this.handleRightEl,n)}this.updateRender(),this.bindEvents()}formatTime(e,t){return this.formatTimeCallback?this.formatTimeCallback(e,t):(e==t?[e]:[e,t]).map((e=>[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":"))).join("-")}getWidth(){return this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio}updateRender(){const e=this.wavesurfer.getDuration(),t=this.getWidth();let n=this.start,i=this.end;if(n<0&&(n=0,i-=n),i>e&&(i=e,n=e-(i-n)),null!=this.minLength&&(i=Math.max(n+this.minLength,i)),null!=this.maxLength&&(i=Math.min(n+this.maxLength,i)),null!=this.element){const r=Math.round(n/e*t),s=Math.round(i/e*t)-r;this.style(this.element,{left:r+"px",width:s+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"});for(const e in this.attributes)this.element.setAttribute("data-region-"+e,this.attributes[e]);this.showTooltip&&(this.element.title=this.formatTime(this.start,this.end))}}bindInOut(){this.firedIn=!1,this.firedOut=!1;const e=e=>{let t=Math.round(10*this.start)/10,n=Math.round(10*this.end)/10;e=Math.round(10*e)/10,!this.firedOut&&this.firedIn&&(t>e||n<=e)&&(this.firedOut=!0,this.firedIn=!1,this.fireEvent("out"),this.wavesurfer.fireEvent("region-out",this)),!this.firedIn&&t<=e&&n>e&&(this.firedIn=!0,this.firedOut=!1,this.fireEvent("in"),this.wavesurfer.fireEvent("region-in",this))};this.wavesurfer.backend.on("audioprocess",e),this.on("remove",(()=>{this.wavesurfer.backend.un("audioprocess",e)})),this.on("out",(()=>{if(this.loop){const e=this.wavesurfer.getCurrentTime();e>=this.start&&e<=this.end&&this.wavesurfer.play(this.start)}}))}bindEvents(){const e=this.preventContextMenu;this.element.addEventListener("mouseenter",(e=>{this.fireEvent("mouseenter",e),this.wavesurfer.fireEvent("region-mouseenter",this,e)})),this.element.addEventListener("mouseleave",(e=>{this.fireEvent("mouseleave",e),this.wavesurfer.fireEvent("region-mouseleave",this,e)})),this.element.addEventListener("click",(e=>{e.preventDefault(),this.fireEvent("click",e),this.wavesurfer.fireEvent("region-click",this,e)})),this.element.addEventListener("dblclick",(e=>{e.stopPropagation(),e.preventDefault(),this.fireEvent("dblclick",e),this.wavesurfer.fireEvent("region-dblclick",this,e)})),this.element.addEventListener("contextmenu",(t=>{e&&t.preventDefault(),this.fireEvent("contextmenu",t),this.wavesurfer.fireEvent("region-contextmenu",this,t)})),(this.drag||this.resize)&&this.bindDragEvents()}bindDragEvents(){const e=this.wavesurfer.drawer.container,t=this.scrollSpeed;this.scrollThreshold;let n,i,r,s,o,a,l,c,d,h=!1;const u=e=>{let i=this.util.withOrientation(e,this.vertical);const h=this.wavesurfer.getDuration();if(!a||!r&&!o)return;const p=i.clientX;let m=0,g=0,f=0,v=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(e)*h);if(r)-1===a?(g=c*this.wavesurfer.params.minPxPerSec,m=p-l.left):(g=d*this.wavesurfer.params.minPxPerSec,m=l.right-p);else{let e=this.minLength;e||(e=0),"start"===o?(v>this.end-e&&(v=this.end-e,f=t*a),v<0&&(v=0)):"end"===o&&(v<this.start+e&&(v=this.start+e,f=t*a),v>h&&(v=h))}const y=this.wrapper.scrollLeft;if(-1===a){if(0===Math.round(y))return;if(Math.round(y-g+m)<=0)return}else{if(Math.round(y)===s)return;if(Math.round(y+g-m)>=s)return}let b=y-f+t*a;if(-1===a){const e=Math.max(0+g-m,b);this.wrapper.scrollLeft=b=e}else{const e=Math.min(s-g+m,b);this.wrapper.scrollLeft=b=e}const w=v-n;n=v,r?this.onDrag(w):this.onResize(w,o),window.requestAnimationFrame((()=>{u(e)}))},p=e=>{const t=this.wavesurfer.getDuration();e.touches&&e.touches.length>1||(i=e.targetTouches?e.targetTouches[0].identifier:null,(this.drag||this.resize)&&e.stopPropagation(),n=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(e,!0)*t),c=n-this.start,d=this.end-n,s=this.wrapper.scrollWidth-this.wrapper.clientWidth,l=this.util.withOrientation(this.wrapper.getBoundingClientRect(),this.vertical),this.isResizing=!1,this.isDragging=!1,"handle"===e.target.tagName.toLowerCase()?(this.isResizing=!0,o=e.target.classList.contains("wavesurfer-handle-start")?"start":"end"):(this.isDragging=!0,r=!0,o=!1))},m=e=>{e.touches&&e.touches.length>1||((r||o)&&(this.isDragging=!1,this.isResizing=!1,r=!1,a=null,o=!1),h&&(h=!1,this.util.preventClick(),this.fireEvent("update-end",e),this.wavesurfer.fireEvent("region-update-end",this,e)))},g=t=>{const s=this.wavesurfer.getDuration();let p=this.util.withOrientation(t,this.vertical);if(t.touches&&t.touches.length>1)return;if(t.targetTouches&&t.targetTouches[0].identifier!=i)return;if(!r&&!o)return;let m=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(t)*s);if(r){const e=this.wavesurfer.getDuration();m>e-d&&(m=e-d),m-c<0&&(m=c)}if(o){let e=this.minLength;e||(e=0),"start"===o?(m>this.end-e&&(m=this.end-e),m<0&&(m=0)):"end"===o&&(m<this.start+e&&(m=this.start+e),m>s&&(m=s))}let g=m-n;if(n=m,this.drag&&r&&(h=h||!!g,this.onDrag(g)),this.resize&&o&&(h=h||!!g,this.onResize(g,o)),this.scroll&&e.clientWidth<this.wrapper.scrollWidth){let e=p.clientX;a=e<l.left+this.edgeScrollWidth?-1:e>l.right-this.edgeScrollWidth?1:null,a&&u(t)}};this.element.addEventListener("mousedown",p),this.element.addEventListener("touchstart",p),document.body.addEventListener("mousemove",g),document.body.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("mouseup",m),document.body.addEventListener("touchend",m),this.on("remove",(()=>{document.removeEventListener("mouseup",m),document.body.removeEventListener("touchend",m),document.body.removeEventListener("mousemove",g),document.body.removeEventListener("touchmove",g)})),this.wavesurfer.on("destroy",(()=>{document.removeEventListener("mouseup",m),document.body.removeEventListener("touchend",m)}))}onDrag(e){const t=this.wavesurfer.getDuration();this.end+e>t&&(e=t-this.end),this.start+e<0&&(e=-1*this.start);const n={direction:this._getDragDirection(e),action:"drag"};this.update({start:this.start+e,end:this.end+e},n)}_getDragDirection(e){return e<0?"left":e>0?"right":null}onResize(e,t){const n=this.wavesurfer.getDuration(),i={action:"resize",direction:"start"===t?"left":"right"};"start"===t?(e>0&&this.end-(this.start+e)<this.minLength&&(e=this.end-this.minLength-this.start),e<0&&this.end-(this.start+e)>this.maxLength&&(e=this.end-this.start-this.maxLength),e<0&&this.start+e<0&&(e=-1*this.start),this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)},i)):(e<0&&this.end+e-this.start<this.minLength&&(e=this.start+this.minLength-this.end),e>0&&this.end+e-this.start>this.maxLength&&(e=this.maxLength-(this.end-this.start)),e>0&&this.end+e>n&&(e=n-this.end),this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)},i))}updateHandlesResize(e){let t;t=e?this.vertical?"row-resize":"col-resize":"auto",this.handleLeftEl&&this.style(this.handleLeftEl,{cursor:t}),this.handleRightEl&&this.style(this.handleRightEl,{cursor:t})}}class $y{static create(e){return{name:"regions",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{addRegion(e){return this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.add(e)},clearRegions(){this.regions&&this.regions.clear()},enableDragSelection(e){this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.enableDragSelection(e)},disableDragSelection(){this.regions.disableDragSelection()}},instance:$y}}constructor(e,t){this.params=e,this.wavesurfer=t,this.util={...t.util,getRegionSnapToGridValue:t=>this.getRegionSnapToGridValue(t,e)},this.maxRegions=e.maxRegions,this.regionsMinLength=e.regionsMinLength||null,Object.getOwnPropertyNames(this.util.Observer.prototype).forEach((e=>{Wy.prototype[e]=this.util.Observer.prototype[e]})),this.wavesurfer.Region=Wy,this._onBackendCreated=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.orientation=this.wavesurfer.drawer.orientation,this.defaultEdgeScrollWidth=.05*this.wrapper.clientWidth,this.params.regions&&this.params.regions.forEach((e=>{this.add(e)}))},this.list={},this._onReady=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.vertical=this.wavesurfer.drawer.params.vertical,this.params.dragSelection&&this.enableDragSelection(this.params),Object.keys(this.list).forEach((e=>{this.list[e].updateRender()}))}}init(){this.wavesurfer.isReady?(this._onBackendCreated(),this._onReady()):(this.wavesurfer.once("ready",this._onReady),this.wavesurfer.once("backend-created",this._onBackendCreated))}destroy(){this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("backend-created",this._onBackendCreated),this.wavesurfer.setDisabledEventEmissions(["region-removed"]),this.disableDragSelection(),this.clear()}wouldExceedMaxRegions(){return this.maxRegions&&Object.keys(this.list).length>=this.maxRegions}add(e){if(this.wouldExceedMaxRegions())return null;!(e={edgeScrollWidth:this.params.edgeScrollWidth||this.defaultEdgeScrollWidth,...e}).formatTimeCallback&&this.params.formatTimeCallback&&(e={...e,formatTimeCallback:this.params.formatTimeCallback}),!e.minLength&&this.regionsMinLength&&(e={...e,minLength:this.regionsMinLength});const t=new this.wavesurfer.Region(e,this.util,this.wavesurfer);return this.list[t.id]=t,t.on("remove",(()=>{delete this.list[t.id]})),t}clear(){Object.keys(this.list).forEach((e=>{this.list[e].remove()}))}enableDragSelection(e){this.disableDragSelection();const t=e.slop||2,n=this.wavesurfer.drawer.container,i=!1!==e.scroll&&this.wavesurfer.params.scrollParent,r=e.scrollSpeed||1,s=e.scrollThreshold||10;let o,a,l,c,d,h,u,p=this.wavesurfer.getDuration(),m=0;const g=e=>{if(!c||!h)return;let t=this.wrapper.scrollLeft+r*h;this.wrapper.scrollLeft=t=Math.min(a,Math.max(0,t));const n=this.wavesurfer.drawer.handleEvent(e);c.update({start:Math.min(n*p,l*p),end:Math.max(n*p,l*p)}),t<a&&t>0&&window.requestAnimationFrame((()=>{g(e)}))},f=t=>{if(!(t.touches&&t.touches.length>1)){if(p=this.wavesurfer.getDuration(),d=t.targetTouches?t.targetTouches[0].identifier:null,a=this.wrapper.scrollWidth-this.wrapper.clientWidth,u=this.util.withOrientation(this.wrapper.getBoundingClientRect(),this.vertical),this.wavesurfer.params.splitChannels){const n=(t.touches?t.touches[0].clientY:t.clientY)-u.top,i=null!=this.wavesurfer.backend.buffer?this.wavesurfer.backend.buffer.numberOfChannels:1,r=this.wrapper.clientHeight/i,s=Math.floor(n/r);e.channelIdx=s;const o=this.wavesurfer.params.splitChannelsOptions.channelColors[s];o&&o.dragColor&&(e.color=o.dragColor)}o=!0,l=this.wavesurfer.drawer.handleEvent(t,!0),c=null,h=null}};this.wrapper.addEventListener("mousedown",f),this.wrapper.addEventListener("touchstart",f),this.on("disable-drag-selection",(()=>{this.wrapper.removeEventListener("touchstart",f),this.wrapper.removeEventListener("mousedown",f)}));const v=e=>{e.touches&&e.touches.length>1||(o=!1,m=0,h=null,c&&(this.util.preventClick(),c.fireEvent("update-end",e),this.wavesurfer.fireEvent("region-update-end",c,e)),c=null)};this.wrapper.addEventListener("mouseleave",v),this.wrapper.addEventListener("mouseup",v),this.wrapper.addEventListener("touchend",v),document.body.addEventListener("mouseup",v),document.body.addEventListener("touchend",v),this.on("disable-drag-selection",(()=>{document.body.removeEventListener("mouseup",v),document.body.removeEventListener("touchend",v),this.wrapper.removeEventListener("touchend",v),this.wrapper.removeEventListener("mouseup",v),this.wrapper.removeEventListener("mouseleave",v)}));const y=r=>{if(!o)return;if(++m<=t)return;if(r.touches&&r.touches.length>1)return;if(r.targetTouches&&r.targetTouches[0].identifier!=d)return;if(!c&&(c=this.add(e||{}),!c))return;const a=this.wavesurfer.drawer.handleEvent(r),f=this.wavesurfer.regions.util.getRegionSnapToGridValue(l*p),v=this.wavesurfer.regions.util.getRegionSnapToGridValue(a*p);c.update({start:Math.min(v,f),end:Math.max(v,f)});let y=this.util.withOrientation(r,this.vertical);if(i&&n.clientWidth<this.wrapper.scrollWidth){const e=y.clientX-u.left;h=e<=s?-1:e>=u.right-s?1:null,h&&g(r)}};this.wrapper.addEventListener("mousemove",y),this.wrapper.addEventListener("touchmove",y),this.on("disable-drag-selection",(()=>{this.wrapper.removeEventListener("touchmove",y),this.wrapper.removeEventListener("mousemove",y)})),this.wavesurfer.on("region-created",(e=>{this.regionsMinLength&&(e.minLength=this.regionsMinLength)}))}disableDragSelection(){this.fireEvent("disable-drag-selection")}getCurrentRegion(){const e=this.wavesurfer.getCurrentTime();let t=null;return Object.keys(this.list).forEach((n=>{const i=this.list[n];i.start<=e&&i.end>=e&&(!t||i.end-i.start<t.end-t.start)&&(t=i)})),t}getRegionSnapToGridValue(e,t){if(t.snapToGridInterval){const n=t.snapToGridOffset||0;return Math.round((e-n)/t.snapToGridInterval)*t.snapToGridInterval+n}return e}}var Gy=__webpack_require__(8809),Yy={};function Xy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Yy.styleTagTransform=Me(),Yy.setAttributes=Ie(),Yy.insert=Ce().bind(null,"head"),Yy.domAPI=xe(),Yy.insertStyleElement=Pe(),Ee()(Gy.Z,Yy),Gy.Z&&Gy.Z.locals&&Gy.Z.locals;class Zy extends m{static positionToTimestamp(e,t){const n=t?.getAccountData(Ne)?.getContent().position,i=parseInt(e,10);return Number.isInteger(i)?i:Number.isInteger(n)?n:0}constructor(e){super(e),Xy(this,"mediaView",{current:null}),Xy(this,"videoElement",{current:null}),Xy(this,"videoOverlay",{current:null}),Xy(this,"video",{current:null}),Xy(this,"createSelection",((e,t)=>{const n=tt.client.getUserId(),i=new we(n).solid;this.clearSelection(),this.pause();const r=this.wavesurfer.addRegion({start:e,end:t,color:i,drag:!1,id:"active-selection"});this.setState({selection:r},(e=>document.dispatchEvent(new Event("selectionchange"))))})),Xy(this,"clearSelection",(e=>{this.state.selection&&(this.state.selection.remove(),this.video.current?.clearOverlayPosition(),this.setState({selection:null},(e=>document.dispatchEvent(new Event("selectionchange")))))})),Xy(this,"generateLocation",(e=>({[Ke]:{start:Math.floor(1e3*this.state.selection.start),end:Math.ceil(1e3*this.state.selection.end),...this.videoOverlay.current?{x:this.videoOverlay.current.spotlightX,y:this.videoOverlay.current.spotlightY,w:this.videoOverlay.current.spotlightWidth,h:this.videoOverlay.current.spotlightHeight}:null},[Ge]:{activityStatus:"pending",creator:tt.client.getUserId()}}))),Xy(this,"commitRegion",(e=>{if(!mn())return;const t=tt.client.getDomain(),n=this.props.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(ge.EventType.RoomPowerLevels,""),i=this.generateLocation();return tt.client.createRoom({visibility:"private",name:`highlighted interval from ${this.state.selection.start} to ${this.state.selection.end}`,power_level_content_override:{users:Object.assign({},n.getContent().users,{[tt.client.getUserId()]:100})},initial_state:[{type:ge.EventType.RoomJoinRules,state_key:"",content:{join_rule:"public"}},{type:Ue,content:{via:[t],[We]:i},state_key:this.props.room.roomId}]}).then((e=>{this.clearSelection();const n={via:[t],[We]:i},r=new ge.MatrixEvent({type:Be,origin_server_ts:(new Date).getTime(),room_id:this.props.room.roomId,sender:tt.client.getUserId(),state_key:e.room_id,content:n});tt.client.sendStateEvent(this.props.room.roomId,Be,n,e.room_id),this.props.setFocus(new rs(r)),this.props.showChat()}))})),Xy(this,"handlePointerdown",(e=>{if("WAVE"===e.target.tagName){clearTimeout(this.longPressTimeout);const t=(e.clientX+e.target.scrollLeft)/e.target.scrollWidth;this.longPressTimeout=setTimeout((e=>{this.wavesurfer.seekTo(t),this.createSelection(t*this.wavesurfer.getDuration(),t*this.wavesurfer.getDuration()+5)}),500)}else{if(["REGION","HANDLE"].includes(e.target.tagName))return;if(e.noClear||this.video.current?.base.contains(e.target))return;clearTimeout(this.longPressTimeout),this.clearSelection()}})),Xy(this,"getCurrentLocations",(e=>{const t=this.wavesurfer.getCurrentTime();return this.props.filteredAnnotationContents.filter((e=>!(t<e.getIntervalStart()/1e3)&&!(t>e.getIntervalEnd()/1e3)&&this.filterAnnotations(e)))})),Xy(this,"cancelPointer",(e=>clearTimeout(this.longPressTimeout))),Xy(this,"waveform",{current:null}),Xy(this,"play",(e=>{this.state.selection?this.state.selection.play():(this.wavesurfer.seekAndCenter(this.wavesurfer.getCurrentTime()/this.wavesurfer.getDuration()),this.lastLeft=this.wavesurfer.drawer.wrapper.scrollLeft,this.wavesurfer.drawer.params.autoCenter=!0,this.wavesurfer.play())})),Xy(this,"pause",(e=>this.wavesurfer.pause())),Xy(this,"playPause",(e=>{this.wavesurfer.isPlaying()?this.pause():this.play()})),Xy(this,"scrubRight",(e=>{clearTimeout(this.inertiaTimeout),this.wavesurfer.skip(1*this.rightInertia*(1/this.zoomFactor)),this.leftInertia=1,this.rightInertia+=.1,this.inertiaTimeout=setTimeout(this.resetInertia,500)})),Xy(this,"scrubLeft",(e=>{clearTimeout(this.inertiaTimeout),this.wavesurfer.skip(-1*this.leftInertia*(1/this.zoomFactor)),this.rightInertia=1,this.leftInertia+=.1,this.inertiaTimeout=setTimeout(this.resetInertia,500)})),Xy(this,"resetInertia",(e=>{this.leftInertia=1,this.rightInertia=1})),Xy(this,"selRight",(e=>{e.preventDefault(),this.state.selection?(clearTimeout(this.inertiaTimeout),e.shiftKey?(this.state.selection.onResize(.2*this.rightInertia*(1/this.zoomFactor),"start"),this.wavesurfer.seekAndCenter(this.state.selection.start/this.wavesurfer.getDuration())):(this.state.selection.onResize(.2*this.rightInertia*(1/this.zoomFactor)),this.wavesurfer.seekAndCenter(this.state.selection.end/this.wavesurfer.getDuration())),this.leftInertia=1,this.rightInertia+=.1,this.inertiaTimeout=setTimeout(this.resetInertia,500)):this.scrubRight()})),Xy(this,"selLeft",(e=>{e.preventDefault(),this.state.selection?(clearTimeout(this.inertiaTimeout),e.shiftKey?(this.state.selection.onResize(-.2*this.leftInertia*(1/this.zoomFactor),"start"),this.wavesurfer.seekAndCenter(this.state.selection.start/this.wavesurfer.getDuration())):(this.state.selection.onResize(-.2*this.leftInertia*(1/this.zoomFactor)),this.wavesurfer.seekAndCenter(this.state.selection.end/this.wavesurfer.getDuration())),this.rightInertia=1,this.leftInertia+=.1,this.inertiaTimeout=setTimeout(this.resetInertia,500)):this.scrubLeft()})),Xy(this,"centerLocation",(e=>{this.wavesurfer.seekAndCenter(e.getIntervalStart()/(1e3*this.wavesurfer.getDuration()))})),Xy(this,"setZoom",(e=>{this.zoomFactor=Math.max(1,Math.min(e,200)),this.wavesurfer.zoom(15*this.zoomFactor)})),Xy(this,"handleBadTimeStamp",(e=>{const t=Math.floor(this.props.timeStamp<0?0:this.wavesurfer.getDuration());Pl.replace(`/${encodeURIComponent(this.props.resourceAlias)}/${t}`+(this.props.roomFocused?`/${this.props.roomFocused}`:"")+(this.props.eventFocused?`/${this.props.eventFocused}`:""))})),Xy(this,"stampMatchesFocus",(e=>this.props.timeStamp==Math.floor(this.props.focus.getIntervalStart()/1e3))),Xy(this,"catchFetchMediaError",(e=>{un.set(h(p,null,h("h3",{id:"toast-header"},"Couldn't fetch the ",this.isVideo?"audio file":"video","..."),h("div",null,"Tried to fetch: "),h("pre",null,this.props.resourceAlias),h("div",null,"Here's the error message:"),h("pre",null,e.message))),Pl.push("/"),this.errorCondition=!0})),Xy(this,"drawMedia",(e=>async t=>{if(this.props.setMediaLoadingStatus("Rendering waveform..."),this.wavesurfer=new(_n().create)({container:"#waveform",backend:"MediaElement",barWidth:5,scrollParent:!0,plugins:[$y.create()]}),e)e=await e;else{e=[];const t=ve(fe(this.props.resourceAlias));for(let n=0;n<2048;n++)e.push(2*t()-1)}this.isVideo&&(this.videoElement.current.src=t),this.wavesurfer.load(this.videoElement.current||t,e),this.wavesurfer.on("ready",(e=>{this.wavesurfer.zoom(15),this.props.setMediaLoadingStatus(null);const t=document.body.clientWidth,n=document.body.clientHeight,i=Math.ceil(this.wavesurfer.getDuration());this.props.setMediaDuration(i),"timeStamp"in this.props&&(this.props.timeStamp<0||this.props.timeStamp>i?this.handleBadTimeStamp():this.props.focus&&this.stampMatchesFocus()?this.centerLocation(this.props.focus):this.wavesurfer.seekAndCenter(this.props.timeStamp/i)),this.props.setContentDimensions(n,t),this.setState({ready:!0})})),this.wavesurfer.on("seek",(e=>{this.state.ready&&(clearTimeout(this.seekTimeout),this.seekTimeout=setTimeout((e=>{const t=Math.floor(this.wavesurfer.getCurrentTime());if(t!==this.props.timeStamp&&Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${t}`+(this.props.roomFocused?`/${this.props.roomFocused}`:"")+(this.props.eventFocused?`/${this.props.eventFocused}`:"")),this.hasSelection){const e=this.wavesurfer.getCurrentTime();e<this.state.selection?.start-.01&&this.clearSelection(),e>this.state.selection?.end+.01&&this.clearSelection()}}),250)),this.updateSavedLocation(),this.updateVideoLocation()})),this.wavesurfer.on("scroll",(e=>{Math.abs(this.lastLeft-e.target.scrollLeft)>25?(this.wavesurfer.drawer.params.autoCenter=!1,this.cancelPointer()):this.lastLeft=e.target.scrollLeft})),this.wavesurfer.on("audioprocess",(e=>{this.updateSavedLocation(),!this.updateVideoLocationLocked&&this.updateVideoLocation()}))})),Xy(this,"filterAnnotations",(e=>"media-fragment"===e.getType())),Xy(this,"setVideo",(e=>this.setState({videoLocation:e}))),Xy(this,"updateSavedLocation",(e=>{clearTimeout(this.saveLocationTimeout),this.saveLocationTimeout=setTimeout((e=>{tt.client.setRoomAccountData(this.props.room.roomId,Ne,{deviceId:tt.deviceId,position:this.props.timeStamp})}),1500)})),Xy(this,"updateVideoLocation",(e=>{const t=this.getCurrentLocations();0==t.length?this.setVideo(null):(t.sort(((e,t)=>e.getIntervalStart()>t.getIntervalStart()?-1:e.getIntervalStart()<t.getIntervalStart()?1:0)),this.setVideo(t[0])),this.updateVideoLocationLocked=!0,setTimeout((e=>this.updateVideoLocationLocked=!1),250)})),this.hasFetched=new Promise(((e,t)=>{this.resolveFetch=e,this.rejectFetch=t})),this.isVideo=e.mimetype.match(/^video/),this.rightInertia=1,this.leftInertia=1,this.zoomFactor=1}componentDidMount(){this.fetchMedia()}componentWillUnmount(){clearTimeout(this.inertiaTimeout),clearTimeout(this.longPressTimeout),clearTimeout(this.saveLocationTimeout),this.wavesurfer&&this.wavesurfer.destroy()}componentDidUpdate(e){if(this.state.ready){const t=this.wavesurfer.getDuration(),n=this.wavesurfer.getCurrentTime();this.props.focus&&this.props.focus?.getChild()!==e.focus?.getChild()?this.stampMatchesFocus()?this.centerLocation(this.props.focus):this.props.timeStamp<0||this.props.timeStamp>t?this.handleBadTimeStamp():this.wavesurfer.seekAndCenter(this.props.timeStamp/t):"timeStamp"in this.props&&Math.abs(this.props.timeStamp-e.timeStamp)>2&&Math.abs(this.props.timeStamp-n)>2?this.props.timeStamp<0||this.props.timeStamp>t?this.handleBadTimeStamp():this.wavesurfer.seekAndCenter(this.props.timeStamp/t):this.props.secondaryFocus&&this.props.secondaryFocus?.getIntervalStart()!==e.secondaryFocus?.getIntervalStart()&&this.centerLocation(this.props.secondaryFocus),e.filteredAnnotationContents.length!==this.props.filteredAnnotationContents.length&&this.updateVideoLocation()}}hasSelection(){return!!this.state.selection}async fetchMedia(){const e=new is(this.props.room);Zy.MediaStore[e.url]?console.log(`found file for ${this.props.room.name} in store`):Zy.MediaStore[e.url]=window.fetch(e.httpUrl).then((async e=>{const t=e.clone(),n=+e.headers.get("Content-Length"),i=e.body.getReader();let r=0;for(;;){const{done:e,value:t}=await i.read();if(e)break;r+=t.length,this.props.setMediaLoadingStatus(r/n)}const s=await t.blob();return URL.createObjectURL(s)})).catch(this.catchFetchMediaError),e.pcm&&!Zy.MediaStore[e.pcm]?Zy.PCMStore[e.pcm]=window.fetch(tt.client.getHttpUriForMxcFromHS(e.pcm)).then((e=>e.json())).catch((e=>console.log("Couldn't fetch PCM data",e))):e.pcm&&console.log(`found PCM for ${this.props.room.name} in store`),this.isVideo&&this.props.setMobileButtonColor("var(--contrast-text)"),this.errorCondition||(Zy.MediaStore[e.url].then((e=>this.props.resource.resolveFetch(e))),Zy.MediaStore[e.url].then(this.drawMedia(Zy.PCMStore[e.pcm])))}getAnnotations(){let e=!1;const t=this.props.filteredAnnotationContents.filter((t=>(t.getChild()===this.props.focus?.getChild()&&(e=!0),this.filterAnnotations(t)))).sort(((e,t)=>e.getIntervalStart()>t.getIntervalStart()?1:e.getIntervalStart()<t.getIntervalStart()?-1:0));this.props.secondaryFocus&&this.filterAnnotations(this.props.secondaryFocus)&&t.push(this.props.secondaryFocus),this.props.focus&&this.filterAnnotations(this.props.focus)&&!e&&t.push(this.props.focus);const n={};return t.map((e=>{for(const t in n)n[t].getIntervalEnd()<=e.getIntervalStart()&&delete n[t];let t=0;for(;;){if(!n[t]){n[t]=e;break}t++}return h(Jy,{setFocus:this.props.setFocus,wavesurfer:this.wavesurfer,gutterDepth:t,key:e.event.getId(),focused:this.props.focus?.getChild()===e.getChild(),location:e})}))}render(e,t){return h("div",{id:"media-view",ref:this.mediaView,onPointerdown:this.handlePointerdown,onPointerup:this.cancelPointer,onPointerout:this.cancelPointer,"data-media-is-video":this.isVideo},this.isVideo?h(Qy,{ref:this.video,videoLocation:t.videoLocation,wavesurfer:this.wavesurfer,videoOverlay:this.videoOverlay,hasSelection:!!t.selection,createSelection:this.createSelection,clearSelection:this.clearSelection,videoElement:this.videoElement}):null,h("div",{ref:this.waveform,"data-annotations-focused":this.props.focus,id:"waveform"},t.ready?this.getAnnotations():null))}}Xy(Zy,"MediaStore",{}),Xy(Zy,"PCMStore",{});class Jy extends m{constructor(...e){super(...e),Xy(this,"setFocus",(e=>{this.props.focused||e.stopPropagation(),this.props.setFocus(this.props.location)}))}componentDidMount(){const e=new we(this.props.location.getCreator()).solid;this.region=this.props.wavesurfer.addRegion({start:this.props.location.getIntervalStart()/1e3,end:this.props.location.getIntervalEnd()/1e3,drag:!1,resize:!1,id:this.props.location.event.getId(),color:"rgba(0,0,0,0)"}),this.region.element.style.setProperty("--user_solid",e),this.region.element.style.setProperty("--gutter_level",this.props.gutterDepth),this.props.focused&&(this.region.element.dataset.focused=!0),this.region.on("click",this.setFocus)}componentDidUpdate(){this.props.focused?this.region.element.dataset.focused=!0:delete this.region.element.dataset.focused,this.region.element.style.setProperty("--gutter_level",this.props.gutterDepth)}componentWillUnmount(){this.region.remove()}render(){}}class Qy extends m{constructor(...e){super(...e),Xy(this,"setOverlayPosition",(e=>{const t=this.props.wavesurfer.getCurrentTime();this.props.hasSelection||this.props.createSelection(t,t+1);const n=this.props.videoElement.current.getBoundingClientRect(),i=this.props.videoElement.current.videoWidth,r=this.props.videoElement.current.videoHeight,s=n.width/i;this.setState({initialPosition:new DOMRect(Math.min(i-100/s,Math.round(e.offsetX/s)),Math.min(r-100/s,Math.round(e.offsetY/s)),Math.round(100/s),Math.round(100/s))})})),Xy(this,"clearOverlayPosition",(e=>{e&&(e.noClear=!0),this.setState({initialPosition:null})}))}render(e,t){return h("div",{id:"media-view-video"},h("div",{id:"media-view-video-wrapper"},h("video",{onclick:this.setOverlayPosition,ref:e.videoElement}),e.hasSelection?t.initialPosition?h(eb,{mutable:!0,ref:e.videoOverlay,videoElement:e.videoElement,clear:this.props.clearSelection,initialPosition:t.initialPosition}):null:e.videoLocation?.getMediaRect()?h(eb,{mutable:!1,ref:e.videoOverlay,videoElement:e.videoElement,initialPosition:e.videoLocation.getMediaRect()}):e.videoOverlay.current=null))}}class eb extends m{constructor(e){super(e),Xy(this,"overlay",{current:null}),Xy(this,"handleVideoResize",(e=>{this.spotlightScale=this.props.videoElement.current.getBoundingClientRect().width/this.props.videoElement.current.videoWidth,this.overlay.current.style.setProperty("--spotlightScale",`${this.spotlightScale}`)})),Xy(this,"handleDrag",(e=>{e.preventDefault();const t=this.props.videoElement.current.videoWidth,n=this.props.videoElement.current.videoHeight;this.spotlightX=Math.round(Math.min(Math.max(0,this.initialX+(e.clientX-this.initialClientX)/this.spotlightScale),t-this.spotlightWidth)),this.spotlightY=Math.round(Math.min(Math.max(0,this.initialY+(e.clientY-this.initialClientY)/this.spotlightScale),n-this.spotlightHeight)),this.overlay.current.style.setProperty("--spotlightX",`${this.spotlightX}px`),this.overlay.current.style.setProperty("--spotlightY",`${this.spotlightY}px`)})),Xy(this,"handleResizeX",(e=>{e.preventDefault();const t=this.props.videoElement.current.videoWidth;this.spotlightWidth=Math.round(Math.min(t-this.spotlightX,Math.max(40,this.initialWidth+(e.clientX-this.initialClientX)/this.spotlightScale))),this.overlay.current.style.setProperty("--spotlightWidth",`${this.spotlightWidth}px`)})),Xy(this,"handleResizeY",(e=>{e.preventDefault();const t=this.props.videoElement.current.videoHeight;this.spotlightHeight=Math.round(Math.min(t-this.spotlightY,Math.max(40,this.initialHeight+(e.clientY-this.initialClientY)/this.spotlightScale))),this.overlay.current.style.setProperty("--spotlightHeight",`${this.spotlightHeight}px`)})),Xy(this,"startDrag",(e=>{e.preventDefault(),this.initialX=this.spotlightX,this.initialY=this.spotlightY,this.initialClientX=e.clientX,this.initialClientY=e.clientY,this.overlay.current.setPointerCapture(e.pointerId),this.overlay.current.addEventListener("pointermove",this.handleDrag),this.overlay.current.addEventListener("pointerup",(t=>{delete this.initialX,delete this.initialY,delete this.initialClientX,delete this.initialClientY,this.overlay.current?.releasePointerCapture(e.pointerId),this.overlay.current?.removeEventListener("pointermove",this.handleDrag)}))})),Xy(this,"startResizeX",(e=>{e.preventDefault(),this.overlay.current.setPointerCapture(e.pointerId),this.initialWidth=this.spotlightWidth,this.initialClientX=e.clientX,this.overlay.current.addEventListener("pointermove",this.handleResizeX),this.overlay.current.addEventListener("pointerup",(t=>{delete this.initialWidth,delete this.initialClientX,this.overlay.current?.releasePointerCapture(e.pointerId),this.overlay.current?.removeEventListener("pointermove",this.handleResizeX)}))})),Xy(this,"startResizeY",(e=>{e.preventDefault(),this.overlay.current.setPointerCapture(e.pointerId),this.initialHeight=this.spotlightHeight,this.initialClientY=e.clientY,this.overlay.current.addEventListener("pointermove",this.handleResizeY),this.overlay.current.addEventListener("pointerup",(t=>{delete this.initialHeight,delete this.initialClientY,this.overlay.current?.releasePointerCapture(e.pointerId),this.overlay.current?.removeEventListener("pointermove",this.handleResizeY)}))})),this.spotlightScale=e.videoElement.current.getBoundingClientRect().width/e.videoElement.current.videoWidth,this.spotlightWidth=e.initialPosition.width,this.spotlightHeight=e.initialPosition.height,this.spotlightX=e.initialPosition.x,this.spotlightY=e.initialPosition.y}componentDidUpdate(e){e.mutable===this.props.mutable&&this.props.mutable||(this.spotlightWidth=this.props.initialPosition.width,this.spotlightHeight=this.props.initialPosition.height,this.spotlightX=this.props.initialPosition.x,this.spotlightY=this.props.initialPosition.y,this.overlay.current.style.setProperty("--spotlightX",`${this.spotlightX}px`),this.overlay.current.style.setProperty("--spotlightY",`${this.spotlightY}px`),this.overlay.current.style.setProperty("--spotlightWidth",`${this.spotlightWidth}px`),this.overlay.current.style.setProperty("--spotlightHeight",`${this.spotlightHeight}px`))}componentDidMount(){this.resizeObserver=new ResizeObserver(this.handleVideoResize),this.resizeObserver.observe(this.props.videoElement.current)}componentWillUnmount(){this.resizeObserver.disconnect()}render(e,t){const n={"--spotlightX":`${this.spotlightX}px`,"--spotlightY":`${this.spotlightY}px`,"--spotlightWidth":`${this.spotlightWidth}px`,"--spotlightHeight":`${this.spotlightHeight}px`,"--spotlightScale":this.spotlightScale};return h("div",{id:"media-view-video-overlay","data-media-selection-mutable":e.mutable,style:n,ref:this.overlay},h("div",{onpointerdown:e.mutable&&e.clear,id:"media-view-video-overlay-header"}),h("div",{onpointerdown:e.mutable&&e.clear,id:"media-view-video-overlay-left"}),h("div",{onpointerdown:e.mutable&&this.startDrag,id:"media-view-video-overlay-overlight"}),h("div",{onpointerdown:e.mutable&&this.startDrag,id:"media-view-video-overlay-leftlight"}),h("div",{onpointerdown:e.mutable&&this.startResizeX,id:"media-view-video-overlay-rightlight"}),h("div",{onpointerdown:e.mutable&&this.startResizeY,id:"media-view-video-overlay-underlight"}),h("div",{onpointerdown:e.mutable&&this.startDrag,id:"media-view-video-overlay-spotlight"}),h("div",{onpointerdown:e.mutable&&e.clear,id:"media-view-video-overlay-right"}),h("div",{onpointerdown:e.mutable&&e.clear,id:"media-view-video-overlay-footer"}))}}var tb=__webpack_require__(8816),nb={};function ib(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}nb.styleTagTransform=Me(),nb.setAttributes=Ie(),nb.insert=Ce().bind(null,"head"),nb.domAPI=xe(),nb.insertStyleElement=Pe(),Ee()(tb.Z,nb),tb.Z&&tb.Z.locals&&tb.Z.locals;class rb extends m{constructor(...e){super(...e),ib(this,"drawImage",(e=>{const t=new Image;t.src=e,t.onload=n=>{this.props.setContentDimensions(t.height,t.width);const i=this.props.contentContainer.current.offsetWidth/t.width;i<1&&this.props.setZoom((e=>i)),this.setState({imageUrl:e})}})),ib(this,"createSelection",(e=>{if(this.longPressTimeout)return;const t=e.offsetX,n=e.offsetY;this.longPressTimeout=setTimeout((e=>{this.setState({selection:new sb({x:Math.round(t),y:Math.round(n),h:100,w:100,imageWidth:this.props.contentWidthPx,imageHeight:this.props.contentHeightPx})},(e=>document.dispatchEvent(new Event("selectionchange"))))}),500)})),ib(this,"handlePointerCancel",(e=>{clearTimeout(this.longPressTimeout),delete this.longPressTimeout})),ib(this,"clearSelection",(e=>{this.setState({selection:null},(e=>document.dispatchEvent(new Event("selectionchange")))),this.longPressTimeout=setTimeout((e=>{}))})),ib(this,"generateLocation",(e=>({[Ke]:{x:this.state.selection.x,y:this.state.selection.y,w:this.state.selection.w,h:this.state.selection.h},[Ge]:{activityStatus:"pending",creator:tt.client.getUserId()}}))),ib(this,"zoomMax",10),ib(this,"commitRegion",(e=>{if(!mn())return;const t=tt.client.getDomain(),n=this.props.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(ge.EventType.RoomPowerLevels,""),i=this.generateLocation();return tt.client.createRoom({visibility:"private",name:`selected region at ${this.state.selection.x},${this.state.selection.y}`,power_level_content_override:{users:Object.assign({},n.getContent().users,{[tt.client.getUserId()]:100})},initial_state:[{type:ge.EventType.RoomJoinRules,state_key:"",content:{join_rule:"public"}},{type:Ue,content:{via:[t],[We]:i},state_key:this.props.room.roomId}]}).then((e=>{this.clearSelection();const n={via:[t],[We]:i},r=new ge.MatrixEvent({type:Be,origin_server_ts:(new Date).getTime(),room_id:this.props.room.roomId,sender:tt.client.getUserId(),state_key:e.room_id,content:n});tt.client.sendStateEvent(this.props.room.roomId,Be,n,e.room_id),this.props.setFocus(new rs(r)),this.props.showChat()}))}))}componentDidMount(){this.fetchImage()}async fetchImage(){const e=new is(this.props.room);rb.ImageStore[e.url]?console.log(`found file for ${this.props.room.name} in store`):rb.ImageStore[e.url]=window.fetch(e.httpUrl).then((async e=>{const t=e.clone(),n=+e.headers.get("Content-Length"),i=e.body.getReader();let r=0;for(;;){const{done:e,value:t}=await i.read();if(e)break;r+=t.length,this.props.setImageLoadingStatus(r/n)}const s=await t.blob();return URL.createObjectURL(s)})).catch(this.catchFetchImageError),rb.ImageStore[e.url].then((e=>this.props.resource.resolveFetch(e))),rb.ImageStore[e.url].then(this.drawImage)}hasSelection(){return!!this.state.selection}get zoomMin(){return this.props.contentWidthPx?Math.min(1,this.props.contentContainer.current.offsetWidth/this.props.contentWidthPx,this.props.contentContainer.current.offsetHeight/this.props.contentHeightPx):0}getAnnotations(){return this.props.filteredAnnotationContents.map((e=>new sb({location:e,focused:e.getChild()===this.props.focus?.getChild(),imageWidth:this.props.contentWidthPx,imageHeight:this.props.contentHeightPx,setFocus:this.props.setFocus})))}render(e,t){if(e.contentWidthPx)return h("div",{id:"image-view-wrapper"},h("div",{"data-image-selecting":!!t.selection,id:"image-view"},h("img",{src:t.imageUrl}),h(ob,{focus:e.focus,handlePointerCancel:this.handlePointerCancel,handlePointerDown:t.selection?this.clearSelection:this.createSelection,contentWidthPx:e.contentWidthPx,contentHeightPx:e.contentHeightPx},this.state.selection?this.state.selection:this.getAnnotations())))}}ib(rb,"ImageStore",{});class sb{constructor({x:e,y:t,h:n,w:i,location:r,focused:s,setFocus:o,imageHeight:a,imageWidth:l}){ib(this,"focusAnnotation",(e=>{e.stopPropagation(),this.setFocus(this.location)})),ib(this,"startDrag",(e=>{e.stopPropagation(),this.initialPointer||(this.initialX=this.x,this.initialY=this.y,this.initialOffsetX=e.offsetX,this.initialOffsetY=e.offsetY,this.initialPointer=e.pointerId,this.rectRef.current.setPointerCapture(e.pointerId),this.rectRef.current.addEventListener("pointermove",this.handleDrag),this.rectRef.current.addEventListener("pointerup",(e=>{e.pointerId===this.initialPointer&&(delete this.initialX,delete this.initialY,delete this.initialPointer,delete this.initialOffsetX,delete this.initialOffsetY,this.rectRef.current?.releasePointerCapture(e.pointerId),this.rectRef.current?.removeEventListener("pointermove",this.handleDrag))})))})),ib(this,"handleDrag",(e=>{e.preventDefault(),e.pointerId===this.initialPointer&&(this.x=Math.round(Math.min(Math.max(0,this.initialX+(e.offsetX-this.initialOffsetX)),this.imageWidth-this.w)),this.y=Math.round(Math.min(Math.max(0,this.initialY+(e.offsetY-this.initialOffsetY)),this.imageHeight-this.h)),requestAnimationFrame(this.updateSizes))})),ib(this,"updateSizes",(e=>{this.rectRef.current.setAttribute("x",this.x),this.rectRef.current.setAttribute("y",this.y),this.rectRef.current.setAttribute("width",this.w-20),this.rectRef.current.setAttribute("height",this.h-20),this.maskRef.current.setAttribute("x",this.x),this.maskRef.current.setAttribute("y",this.y),this.maskRef.current.setAttribute("width",this.w),this.maskRef.current.setAttribute("height",this.h),this.rectResizeWRef.current.setAttribute("y",this.y),this.rectResizeWRef.current.setAttribute("x",this.x+this.w-20),this.rectResizeWRef.current.setAttribute("height",this.h-20),this.rectResizeHRef.current.setAttribute("x",this.x),this.rectResizeHRef.current.setAttribute("width",this.w),this.rectResizeHRef.current.setAttribute("y",this.y+this.h-20)})),ib(this,"startResizeW",(e=>{e.stopPropagation(),this.initialPointer||(this.rectResizeWRef.current.setPointerCapture(e.pointerId),this.initialWidth=this.w,this.initialOffsetX=e.offsetX,this.initialPointer=e.pointerId,this.rectResizeWRef.current.addEventListener("pointermove",this.handleResizeW),this.rectResizeWRef.current.addEventListener("pointerup",(e=>{e.pointerId===this.initialPointer&&(delete this.initialPointer,delete this.initialWidth,delete this.initialOffsetX,this.rectResizeWRef.current?.releasePointerCapture(e.pointerId),this.rectResizeWRef.current?.removeEventListener("pointermove",this.handleResizeW))})))})),ib(this,"startResizeH",(e=>{e.stopPropagation(),this.initialPointer||(this.rectResizeHRef.current.setPointerCapture(e.pointerId),this.initialHeight=this.h,this.initialOffsetY=e.offsetY,this.initialPointer=e.pointerId,this.rectResizeHRef.current.addEventListener("pointermove",this.handleResizeH),this.rectResizeHRef.current.addEventListener("pointerup",(t=>{e.pointerId===this.initialPointer&&(delete this.initialHeight,delete this.initialOffsetY,delete this.initialPointer,this.rectResizeHRef.current?.releasePointerCapture(e.pointerId),this.rectResizeHRef.current?.removeEventListener("pointermove",this.handleResizeH))})))})),ib(this,"handleResizeW",(e=>{e.preventDefault(),e.pointerId===this.initialPointer&&(this.w=Math.round(Math.min(this.imageWidth-this.x,Math.max(40,this.initialWidth+(e.offsetX-this.initialOffsetX)))),this.updateSizes())})),ib(this,"handleResizeH",(e=>{e.preventDefault(),e.pointerId===this.initialPointer&&(this.h=Math.round(Math.min(this.imageHeight-this.y,Math.max(40,this.initialHeight+(e.offsetY-this.initialOffsetY)))),this.updateSizes())}));const c=r?.getMediaRect();this.x=c?.x||e,this.y=c?.y||t,this.h=c?.height||n,this.w=c?.width||i,this.location=r,this.imageHeight=a,this.selection=!r,this.setFocus=o,this.imageWidth=l,this.focused=s,this.maskRef={current:null},this.rectRef={current:null},this.rectResizeHRef={current:null},this.rectResizeWRef={current:null},this.key=Date.now()}}class ob extends m{constructor(...e){super(...e),ib(this,"getMasks",(e=>this.props.children?.map(this.toMask))),ib(this,"toMask",(e=>h("rect",{key:e.key,ref:e.maskRef,x:e.x,y:e.y,width:e.w,height:e.h}))),ib(this,"getRects",(e=>this.props.children?.map(this.toRect))),ib(this,"toRect",(e=>(e.focused&&(this.focusedRect=e.rectRef),h("rect",{key:e.key+1,ref:e.rectRef,mask:"url(#mask)",onpointerdown:e.focusAnnotation,class:"image-annotation-rect",x:e.x,y:e.y,width:e.w,height:e.h,"data-annotation-focused":e.focused})))),ib(this,"toSelection",(e=>h(p,null,h("rect",{key:e.key+2,ref:e.rectRef,mask:"url(#mask)",class:"image-annotation-rect-drag",x:e.x,y:e.y,onpointerdown:e.startDrag,width:e.w-20,height:e.h-20}),h("rect",{key:e.key+3,ref:e.rectResizeWRef,mask:"url(#mask)",class:"image-annotation-rect-resize-w",x:e.x+e.w-20,y:e.y,onpointerdown:e.startResizeW,width:20,height:e.h-20}),h("rect",{key:e.key+4,ref:e.rectResizeHRef,mask:"url(#mask)",class:"image-annotation-rect-resize-h",x:e.x,y:e.y+e.h-20,onpointerdown:e.startResizeH,width:e.w,height:20}))))}componentDidUpdate(e){e.focus?.getChild()!==this.props.focus?.getChild()&&this.focusedRect?.current?.scrollIntoView({block:"center",inline:"center"})}render(e,t){const n=`M0 0 h${e.contentWidthPx} v${e.contentHeightPx} h-${e.contentWidthPx}z`;return h("svg",{onPointerCancel:e.handlePointerCancel,onPointerUp:e.handlePointerCancel,onPointerDown:e.handlePointerDown,id:"image-overlay"},h("defs",null,h("mask",{id:"mask"},h("path",{fill:"white",d:n}),e.children?.selection?this.toMask(e.children):this.getMasks())),h("path",{mask:"url(#mask)",fill:"black",d:n}),e.children?.selection?this.toSelection(e.children):this.getRects())}}var ab=__webpack_require__(6145),lb={};function cb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}lb.styleTagTransform=Me(),lb.setAttributes=Ie(),lb.insert=Ce().bind(null,"head"),lb.domAPI=xe(),lb.insertStyleElement=Pe(),Ee()(ab.Z,lb),ab.Z&&ab.Z.locals&&ab.Z.locals;class db extends m{constructor(e){super(e),cb(this,"handleKeydown",(e=>{e.shiftKey||("j"!==e.key&&"ArrowRight"!==e.key||(e.preventDefault(),this.nextPage()),"k"!==e.key&&"ArrowLeft"!==e.key||(e.preventDefault(),this.prevPage()),"ArrowUp"===e.key&&(e.preventDefault(),this.props.contentContainer.current.scroll({top:this.props.contentContainer.current.scrollTop-100,left:this.props.contentContainer.current.scrollLeft})),"ArrowDown"===e.key&&(e.preventDefault(),this.props.contentContainer.current.scroll({top:this.props.contentContainer.current.scrollTop+100,left:this.props.contentContainer.current.scrollLeft})))})),cb(this,"pageTotal",{current:null}),cb(this,"pageInput",{current:null}),cb(this,"bottomWrapper",{current:null}),cb(this,"toolTipOffset",[0,30]),cb(this,"handleInput",(e=>{/^[0-9]*$/.test(e.target.value)?this.setState({value:e.target.value}):this.setState({value:""})})),cb(this,"prevPage",(e=>{const t=this.props.content.current.state.showSecondary?1:0;this.props.pageFocused>1&&Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${Math.max(1,this.props.pageFocused-(1+t))}`+(this.props.roomFocused?"/"+this.props.roomFocused:"")+(this.props.eventFocused?"/"+this.props.eventFocused:""))})),cb(this,"nextPage",(e=>{const t=this.props.content.current.state.showSecondary?1:0;this.props.pageFocused+t<this.props.total&&Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${Math.max(1,this.props.pageFocused+(1+t))}`+(this.props.roomFocused?"/"+this.props.roomFocused:"")+(this.props.eventFocused?"/"+this.props.eventFocused:""))})),cb(this,"handlePageFocus",(e=>this.setState({pageFocused:!0,value:""}))),cb(this,"handlePageBlur",(e=>this.setState({pageFocused:!1,value:this.props.pageFocused}))),cb(this,"handleSubmit",(e=>{e.preventDefault();const t=Number.isNaN(parseInt(this.state.value,10))?1:parseInt(this.state.value,10);t>0&&t<=this.props.total?Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${t}/`):alert("Out of range")})),cb(this,"handleClick",(e=>Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${parseInt(e.target.value,10)}`))),cb(this,"togglePageNav",(e=>this.setState({pageViewVisible:!this.state.pageViewVisible}))),cb(this,"toggleMoreOptions",(e=>{this.state.moreOptionsVisible?this.props.setNavHeight(75):this.props.setNavHeight(150),this.setState((e=>({moreOptionsVisible:!e.moreOptionsVisible})))})),cb(this,"mainMenu",(e=>Pl.push("/"))),cb(this,"download",(e=>{if(confirm("do you want to download the file you're annotating?")){const e=new is(this.props.room);window.open(e.httpUrl)}})),cb(this,"openMembership",(e=>hs.set(h(ws,{room:this.props.room}),"Manage Membership",`for ${this.props.room.name}`))),cb(this,"zoomOut",(e=>this.props.setZoom((e=>e-.1)))),cb(this,"zoomIn",(e=>this.props.setZoom((e=>e+.1))));const t=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS);this.canAnnotate=t.maySendStateEvent(Be,tt.client.getUserId()),this.state={value:e.pageFocused,pageViewVisible:!1,moreOptionsVisible:!1,pageFocused:!1}}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}componentDidUpdate(){this.pageInput.current&&(this.pageInput.current.style.width=`${this.pageTotal.current.scrollWidth}px`)}render(e,t){if(e.contentWidthPx)return h("nav",{id:"page-nav"},h(hb,{total:e.total,handleClick:this.handleClick,room:e.room,currentPageElement:this.currentPageElement,visibility:t.pageViewVisible,typing:t.typing,current:e.pageFocused}),h("div",{id:"nav-background"}),h("div",{class:"nav-button-wrapper top-wrapper"},h(Tr,{content:"Go to main menu (ESC)",offset:this.toolTipOffset},h("button",{onclick:this.mainMenu},rt)),h(Tr,{content:"Add annotation (Alt + a)",offset:this.toolTipOffset},h("button",{disabled:this.canAnnotate&&(e.hasSelection||e.pindropMode?.x)?null:"disabled",onclick:e.openAnnotation},Ct)),h(Tr,{content:"Go to previous annotation (Alt + Shift + Tab)",offset:this.toolTipOffset},h("button",{disabled:!e.hasAnnotations,onclick:e.focusPrev},Tt)),h(Tr,{content:"Go to previous page (k, )",offset:this.toolTipOffset},h("button",{disabled:e.pageFocused>1?null:"disabled",onclick:this.prevPage},Et)),h("form",{class:"nav-position",onSubmit:this.handleSubmit},h(Tr,{content:"Show page navigation",offset:this.toolTipOffset},h("button",{type:"button",class:t.pageViewVisible?"nav-toggled":null,onclick:this.togglePageNav},It)),h("input",{type:"text",id:"nav-page-input",ref:this.pageInput,value:t.pageFocused?t.value:e.pageFocused,onblur:this.handlePageBlur,onfocus:this.handlePageFocus,oninput:this.handleInput}),h("span",null,"/"),h("span",{ref:this.pageTotal,id:"nav-total-pages"},e.total)),h(Tr,{content:"Go to next page (j, )",offset:this.toolTipOffset},h("button",{disabled:e.total>e.pageFocused?null:"disabled",onclick:this.nextPage},kt)),h(Tr,{content:"Go to next annotation (Alt + Tab)",offset:[0,30]},h("button",{disabled:!e.hasAnnotations,onclick:e.focusNext},xt)),h(Tr,{content:"Remove annotation (Alt + r)",offset:this.toolTipOffset},h("button",{disabled:this.canAnnotate&&e.focus&&!e.hasSelection?null:"disabled",onclick:e.closeAnnotation},At)),h(Tr,{content:"More options",offset:this.toolTipOffset},h("button",{onClick:this.toggleMoreOptions},St))),h("div",{inert:!t.moreOptionsVisible,ref:this.bottomWrapper,class:"nav-button-wrapper bottom-wrapper"},h(Tr,{content:"Manage membership",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.openMembership},lt)),h(Tr,{content:"Download PDF",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.download},Qt," ")),h(Tr,{content:"Zoom out (-)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.zoomOut},Ht)),h(Tr,{content:"Zoom in (+)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.zoomIn},Kt)),h(Tr,{content:"Toggle annotation visibility (Alt + v)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:e.toggleAnnotations},e.annotationsVisible?qt:Ut)),h(Tr,{content:"Add Pin",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:e.startPindrop},Yt)),h(Tr,{content:"Toggle Two-Up View",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:e.content.current?.toggleSecondary},en)),h(Tr,{content:"Search Within PDF",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:e.showSearch},gt))))}}class hb extends m{constructor(e){super(e),cb(this,"handleTypingNotification",((e,t)=>{const n=tt.client.getRoom(this.props.room?.roomId).getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(Be,t.roomId);n&&this.setState((t=>{const i=new rs(n).location;return{typing:{...t.typing,[i]:e.getContent().user_ids}}}))})),cb(this,"currentPageElement",{current:null}),this.state={typing:{}},this.handleTypingNotifications=this.handleTypingNotification.bind(this)}componentDidUpdate(){this.currentPageElement.current?.scrollIntoView({inline:"center"})}componentDidMount(){tt.client.on("RoomMember.typing",this.handleTypingNotification)}componentWillUnmount(){tt.client.off("RoomMember.typing",this.handleTypingNotification)}render(e,t){const n=Array.from({length:e.total},((e,t)=>t+1)).map((n=>{let i,r;return t.typing[n]&&t.typing[n][0]&&(i="typing",r=new we(t.typing[n][0])),h("button",{value:n,key:n,class:i,tabIndex:e.visibility?0:-1,style:r?.styleVariables,onclick:e.handleClick},n)}));return n[e.current-1]=h("button",{ref:this.currentPageElement,tabIndex:e.visibility?0:-1,class:"currentpage"},e.current),h("div",{class:e.visibility?null:"nav-hidden",id:"nav-pages"},n)}}function ub(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class pb extends m{constructor(e){super(e),ub(this,"handleKeydown",(e=>{"j"===e.key&&this.props.content.current.scrubRight(),"k"===e.key&&this.props.content.current.scrubLeft(),"ArrowRight"===e.key&&this.props.content.current.selRight(e),"ArrowLeft"===e.key&&this.props.content.current.selLeft(e)," "!==e.key&&"Spacebar"!==e.key||this.props.content.current.playPause()})),ub(this,"timeCurrent",{current:null}),ub(this,"timeTotal",{current:null}),ub(this,"toolTipOffset",[0,30]),ub(this,"mainMenu",(e=>Pl.push("/"))),ub(this,"download",(e=>{if(confirm("do you want to download the file you're annotating?")){const e=new is(this.props.room);window.open(e.httpUrl)}})),ub(this,"play",(e=>this.props.content.current.play())),ub(this,"pause",(e=>this.props.content.current.pause())),ub(this,"zoomIn",(e=>this.props.content.current.setZoom(this.props.content.current.zoomFactor+.1))),ub(this,"zoomOut",(e=>this.props.content.current.setZoom(this.props.content.current.zoomFactor-.1))),ub(this,"toggleMoreOptions",(e=>{this.state.moreOptionsVisible?this.props.setNavHeight(75):this.props.setNavHeight(150),this.setState((e=>({moreOptionsVisible:!e.moreOptionsVisible})))})),ub(this,"openMembership",(e=>hs.set(h(ws,{room:this.props.room}),"Manage Membership",`for ${this.props.room.name}`)));const t=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS);this.canAnnotate=t.maySendStateEvent(Be,tt.client.getUserId())}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}render(e,t){const n=e.hasSelection?!this.canAnnotate&&"Annotation restricted":"Long press on waveform to select";if(e.contentWidthPx)return h("nav",{id:"page-nav"},h("div",{id:"nav-background"}),h("div",{class:"nav-button-wrapper top-wrapper"},h(Tr,{content:"Go to main menu (ESC)",offset:this.toolTipOffset},h("button",{onclick:this.mainMenu},rt)),h(Tr,{content:n||"Add annotation (Alt + a)",offset:this.toolTipOffset},h("div",{class:"nav-button-tip-wrapper"},h("button",{disabled:n?"disabled":null,onclick:e.openAnnotation},Ct))),h(Tr,{content:"Go to previous annotation (Alt + Shift + Tab)",offset:this.toolTipOffset},h("button",{disabled:!e.hasAnnotations,onclick:e.focusPrev},Tt)),h(Tr,{content:"Play",offset:this.toolTipOffset},h("button",{onclick:this.play},tn)),h(mb,{resourceAlias:e.resourceAlias,eventFocused:e.eventFocused,timeStamp:e.timeStamp,content:e.content,total:e.total,roomFocused:e.roomFocused}),h(Tr,{content:"Pause",offset:this.toolTipOffset},h("button",{onclick:this.pause},nn)),h(Tr,{content:"Go to next annotation (Alt + Tab)",offset:[0,30]},h("button",{disabled:!e.hasAnnotations,onclick:e.focusNext},xt)),h(Tr,{content:"Remove annotation (Alt + r)",offset:this.toolTipOffset},h("button",{disabled:e.focus&&!e.hasSelection?null:"disabled",onclick:e.closeAnnotation},At)),h(Tr,{content:"More options",offset:this.toolTipOffset},h("button",{onClick:this.toggleMoreOptions},St))),h("div",{ref:this.bottomWrapper,"data-searchFocused":t.searchFocused,class:"nav-button-wrapper bottom-wrapper"},h(Tr,{content:"Manage membership",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.openMembership},lt)),h(Tr,{content:"Download Media",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.download},Qt," ")),h(Tr,{content:"Zoom out (-)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.zoomOut},Ht)),h(Tr,{content:"Zoom in (+)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.zoomIn},Kt)),h(Tr,{content:"Toggle annotation visibility (Alt + v)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:e.toggleAnnotations},e.annotationsVisible?qt:Ut))))}}class mb extends m{constructor(...e){super(...e),ub(this,"updateTime",(e=>{if(this.updateLock)return;this.updateLock=!0;const t=Math.floor(this.props.content.current.wavesurfer.getCurrentTime());Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${t}`+(this.props.roomFocused?"/"+this.props.roomFocused:"")+(this.props.eventFocused?"/"+this.props.eventFocused:"")),setTimeout((e=>this.updateLock=!1),1e3)}))}componentDidMount(){this.props.content.current.wavesurfer.on("audioprocess",this.updateTime)}render(e){const t=pm(e.timeStamp),n=pm(e.total);return h("div",{class:"nav-position"},h("span",{ref:this.timeCurrent,style:{width:`${t.length+.5}ch`},id:"nav-time-elapsed"},t),h("span",null,"/"),h("span",{ref:this.timeTotal,style:{width:`${n.length+.5}ch`},id:"nav-time-total"},n))}}function gb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class fb extends m{constructor(e){super(e),gb(this,"handleKeydown",(e=>{})),gb(this,"timeCurrent",{current:null}),gb(this,"timeTotal",{current:null}),gb(this,"toolTipOffset",[0,30]),gb(this,"mainMenu",(e=>Pl.push("/"))),gb(this,"download",(e=>{if(confirm("do you want to download the image you're annotating?")){const e=new is(this.props.room);window.open(e.httpUrl)}})),gb(this,"play",(e=>this.props.content.current.play())),gb(this,"pause",(e=>this.props.content.current.pause())),gb(this,"zoomOut",(e=>this.props.setZoom((e=>e-.1)))),gb(this,"zoomIn",(e=>this.props.setZoom((e=>e+.1)))),gb(this,"toggleMoreOptions",(e=>{this.state.moreOptionsVisible?this.props.setNavHeight(75):this.props.setNavHeight(150),this.setState((e=>({moreOptionsVisible:!e.moreOptionsVisible})))})),gb(this,"openMembership",(e=>hs.set(h(ws,{room:this.props.room}),"Manage Membership",`for ${this.props.room.name}`)));const t=e.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS);this.canAnnotate=t.maySendStateEvent(Be,tt.client.getUserId())}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}render(e,t){const n=e.hasSelection?!this.canAnnotate&&"Annotation restricted":"Select an area to annotate";if(e.contentWidthPx)return h("nav",{id:"page-nav"},h("div",{id:"nav-background"}),h("div",{class:"nav-button-wrapper top-wrapper"},h(Tr,{content:"Go to main menu (ESC)",offset:this.toolTipOffset},h("button",{onclick:this.mainMenu},rt)),h(Tr,{content:n||"Add annotation (Alt + a)",offset:this.toolTipOffset},h("div",{class:"nav-button-tip-wrapper"},h("button",{disabled:n?"disabled":null,onclick:e.openAnnotation},Ct))),h(Tr,{content:"Go to previous annotation (Alt + Shift + Tab)",offset:this.toolTipOffset},h("button",{disabled:!e.hasAnnotations,onclick:e.focusPrev},Tt)),h(Tr,{content:"Zoom out (-)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.zoomOut},Ht)),h(Tr,{content:"Zoom in (+)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.zoomIn},Kt)),h(Tr,{content:"Go to next annotation (Alt + Tab)",offset:[0,30]},h("button",{disabled:!e.hasAnnotations,onclick:e.focusNext},xt)),h(Tr,{content:"Remove annotation (Alt + r)",offset:this.toolTipOffset},h("button",{disabled:e.focus&&!e.hasSelection?null:"disabled",onclick:e.closeAnnotation},At)),h(Tr,{content:"More options",offset:this.toolTipOffset},h("button",{onClick:this.toggleMoreOptions},St))),h("div",{ref:this.bottomWrapper,"data-searchFocused":t.searchFocused,class:"nav-button-wrapper bottom-wrapper"},h(Tr,{content:"Manage membership",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.openMembership},lt)),h(Tr,{content:"Download Media",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:this.download},Qt," ")),h(Tr,{content:"Toggle annotation visibility (Alt + v)",theme:"bordered"},h("button",{tabIndex:t.moreOptionsVisible?0:-1,onClick:e.toggleAnnotations},e.annotationsVisible?qt:Ut))))}}function vb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class yb extends m{constructor(e){super(e),vb(this,"handleStateUpdate",(e=>{e.getStateKey()===this.state.room?.roomId&&e.getType()===Ue&&(this.updateAnnotation(new rs(e)),e.getRoomId()===this.state.focus?.getChild()&&this.refreshFocus()),e.getRoomId()===this.state.room?.roomId&&e.getType()===Be&&(this.updateAnnotation(new rs(e)),e.getStateKey()===this.state.focus?.getChild()&&this.refreshFocus())})),vb(this,"handleAccountData",((e,t)=>{if(t.roomId===this.state.room?.roomId&&this.props.resourcePosition&&e.getType()===Ne){const t=e.getContent(),n=parseInt(this.props.resourcePosition,10);Number.isInteger(n)&&t.position!==n&&t.deviceId!==tt.deviceId&&un.set(h(p,null,h("h3",{id:"toast-header"},"Hey!"),h("div",null,"Another device is viewing a different position."),h("div",{style:"margin-top:10px"},h("button",{onclick:e=>{Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${t.page}/`),un.set(null)},class:"styled-button"},"Jump to there "))))}})),vb(this,"handleTouchStart",(e=>{this.contentContainer.current.dataset.touches=e.touches.length,2===e.touches.length&&(this.initialDistance=Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)**2+(e.touches[0].clientY-e.touches[1].clientY)**2),this.initialZoom=this.state.zoomFactor)})),vb(this,"handleTouchEnd",(e=>this.contentContainer.current.dataset.touches=e.touches.length)),vb(this,"handleTouchMove",(e=>{if(2===e.touches.length){const t=Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)**2+(e.touches[0].clientY-e.touches[1].clientY)**2);this.setZoom((e=>this.initialZoom*(t/this.initialDistance)))}})),vb(this,"contentContainer",{current:null}),vb(this,"content",{current:null}),vb(this,"touchCache",[]),vb(this,"setNavHeight",(e=>this.setState({navHeight:e}))),vb(this,"catchFetchResourceError",(e=>{un.set(h(p,null,h("h3",{id:"toast-header"},"Couldn't fetch the resource..."),h("div",null,"Tried to fetch: "),h("pre",null,this.props.resourceAlias),h("div",null,"Here's the error message:"),h("pre",null,e.message))),Pl.push("/"),this.errorCondition=!0})),vb(this,"fetchResource",(async e=>{await new Promise((e=>this.setState({room:null,mimetype:null,contentWidthPx:null,contentHeightPx:null,zoomFactor:null,resourceLength:null,loadingStatus:"loading..."},e)));const t=await tt.client.getRoomIdForAlias(`#${this.props.resourceAlias}`).catch(this.catchFetchResourceError);if(this.errorCondition)return;const{room_id:n,servers:i}=t;if(await tt.client.joinRoom(n,{viaServers:i}).catch(this.catchFetchResourceError),this.errorCondition)return;const r=await tt.client.getRoomWithState(n).catch(this.catchFetchResourceError);if(this.errorCondition)return;const s=new is(r),o=s.mimetype;this.setState({room:r,resource:s,mimetype:o},(e=>{this.initializeAnnotations(),this.props.roomFocused&&this.focusByRoomId(this.props.roomFocused,this.props.eventFocused)}))})),vb(this,"startPindrop",(e=>{setTimeout((e=>{this.setState({pindropMode:{}}),document.addEventListener("click",this.content.current.releasePin)}),200)})),vb(this,"setContentDimensions",((e,t)=>{const n=document.body.clientWidth,i=(document.body.clientHeight-this.state.navHeight-10)/e,r=n/t,s=this.state.zoomFactor||Math.max(Math.min(i,r,5),1);this.setState({contentHeightPx:e,contentWidthPx:t,zoomFactor:s})})),vb(this,"setSearchText",(e=>{this.searchText=e})),vb(this,"setAnnotationFilter",(e=>{const t=Object.assign({},this.annotationParentEvents,this.annotationChildEvents);this.setState({annotationFilter:e,filteredAnnotationContents:this.filterAnnotations(e,t)})})),vb(this,"setResourceLength",(e=>this.setState({resourceLength:e}))),vb(this,"setLoadingStatus",(e=>this.setState({loadingStatus:e}))),vb(this,"setSearch",(e=>this.setState({searchString:e}))),vb(this,"showSearch",(e=>{this.setState({listingType:"search"}),this.showListing()})),vb(this,"endSearch",(e=>this.setState({listingType:null}))),vb(this,"toggleAnnotations",(e=>this.setState((e=>({annotationsVisible:!e.annotationsVisible}))))),vb(this,"setMobileButtonColor",(e=>this.setState({mobileButtonColor:e}))),vb(this,"setZoom",(e=>{let t=e(this.state.zoomFactor);if(t<this.content.current.zoomMin)this.setState({zoomFactor:this.content.current.zoomMin});else{t=Math.min(t,this.content.current.zoomMax);const e=this.contentContainer.current.clientWidth/2,n=this.contentContainer.current.clientWidth/2/this.state.zoomFactor*t,i=this.contentContainer.current.scrollLeft/this.state.zoomFactor*t,r=this.contentContainer.current.clientHeight/2,s=this.contentContainer.current.clientHeight/2/this.state.zoomFactor*t,o=i+n-e,a=this.contentContainer.current.scrollTop/this.state.zoomFactor*t+s-r;this.contentContainer.current.scrollTo(o,a),this.setState({zoomFactor:t})}})),vb(this,"focusByRoomId",((e,t)=>{const n=Object.assign({},this.annotationParentEvents,this.annotationChildEvents);if(n[e]){const i=n[e];Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${i.getResourcePosition()}/${e}${t?"/"+t:""}`);const r=!(document.body.offsetWidth<=600)&&this.state.listingVisible;this.setState({focus:i,secondaryFocus:null,chatVisible:!0,listingVisible:r})}})),vb(this,"focusNextInArray",(e=>{let t=!this.state.focus;if(e){for(const n of e){const e=n.getChild();if(t)return void this.focusByRoomId(e);t=this.state.focus.getChild()===e}this.focusByRoomId(e[0].getChild())}})),vb(this,"focusNext",(e=>{this.focusNextInArray(this.state.filteredAnnotationContents)})),vb(this,"focusPrev",(e=>{const t=[...this.state.filteredAnnotationContents];this.focusNextInArray(t.reverse())})),vb(this,"hideChat",(e=>this.setState({chatVisible:!1}))),vb(this,"showChat",(e=>{document.body.offsetWidth<=768?this.setState({listingVisible:!1,chatVisible:!0}):this.setState({chatVisible:!0})})),vb(this,"toggleChat",(e=>this.setState((e=>{e.chatVisible?this.hideChat():this.showChat()})))),vb(this,"setPindropMode",(e=>this.setState({pindropMode:e}))),vb(this,"hideListing",(e=>this.setState({listingVisible:!1}))),vb(this,"showListing",(e=>{document.body.offsetWidth<=768?this.setState({listingVisible:!0,chatVisible:!1}):this.setState({listingVisible:!0})})),vb(this,"toggleListing",(e=>this.setState((e=>{e.listingVisible?this.hideListing():this.showListing()})))),vb(this,"openSidebar",(e=>this.setState((e=>this.focus?{chatVisible:!0}:{listingVisible:!0})))),vb(this,"checkForSelection",(e=>{const t=!!this.content.current?.hasSelection();this.state.hasSelection!==t&&this.setState({hasSelection:t})})),vb(this,"handleKeydown",(e=>{e.altKey&&"a"===e.key&&this.openAnnotation(),e.altKey&&"r"===e.key&&this.closeAnnotation(),e.altKey&&"v"===e.key&&this.toggleAnnotations(),"application/pdf"===this.state.mimetype&&e.altKey&&"/"===e.key&&this.showSearch(),e.ctrlKey||e.altKey||e.metaKey||("+"!==e.key&&"="!==e.key||this.setZoom((e=>e+.1)),"-"===e.key&&this.setZoom((e=>e-.1)),"Esc"!==e.key&&"Escape"!==e.key||Pl.push("/"))})),vb(this,"openAnnotation",(e=>{this.setState({annotationsVisible:!0}),"application/pdf"===this.state.mimetype?this.state.pindropMode?.x?this.content.current.commitPin(this.state.pindropMode.x,this.state.pindropMode.y,this.state.pindropMode.page):this.content.current.commitHighlight():this.state.mimetype?.match(/^audio|^video|^image/)&&this.content.current.commitRegion()})),vb(this,"closeAnnotation",(e=>{const t=tt.client.getUserId()===this.state.focus.getCreator(),n=this.state.room.getMember(tt.client.getUserId()).powerLevel>=50;if(!confirm("Are you sure you want to close this annotation?"))return;if(!t&&!n)return void alert("Only moderators can close annotations that they didn't create");const i=this.state.focus.getChild(),r=this.state.room.roomId;tt.client.sendStateEvent(r,Be,{},i),tt.client.sendStateEvent(i,Ue,{},r).catch((e=>{"M_FORBIDDEN"===e?un.set(h(p,null,h("div",null,"Annotation still visible to creator"),h("div",{style:"margin-top:10px"},"Because you're not a moderator for that annotation you just removed, it has been detatched but not deleted: it will remain visible to its creator and members, although it won't be visible to other viewers of this resource."))):console.log(e)})),this.unsetFocus()})),vb(this,"unsetFocus",(e=>{this.setState({secondaryFocus:null,focus:null},(e=>this.setState({chatVisible:!1}))),e?.replace?Pl.replace(`/${encodeURIComponent(this.props.resourceAlias)}/${this.props.resourcePosition}/`):Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${this.props.resourcePosition}`)})),vb(this,"setFocus",((e,t)=>{t?.replace?Pl.replace(`/${encodeURIComponent(this.props.resourceAlias)}/${t?.holdPosition?this.props.resourcePosition:e.getResourcePosition()}/${e.getChild()}/`):Pl.push(`/${encodeURIComponent(this.props.resourceAlias)}/${t?.holdPosition?this.props.resourcePosition:e.getResourcePosition()}/${e.getChild()}`),this.setState({secondaryFocus:null,focus:e,chatVisible:!0})})),vb(this,"refreshFocus",(e=>{if(this.state.room)if(this.props.roomFocused){const e=Object.assign({},this.annotationParentEvents,this.annotationChildEvents)[this.props.roomFocused];e&&this.setFocus(e,{replace:!0,holdPosition:!0})}else this.unsetFocus({replace:!0})})),vb(this,"setSecondaryFocus",(e=>this.setState({secondaryFocus:e}))),vb(this,"updateAnnotation",(e=>{let t;"child"===e.getOrientation()?t=this.annotationChildEvents:"parent"===e.getOrientation()&&(t=this.annotationParentEvents),this.setState((n=>{const i=this.filterAnnotations(n.annotationFilter,{null:e}),r=this.insertable(e);r?t[e.getChild()]=e:delete t[e.getChild()];let s=[...n.filteredAnnotationContents];if(i.length>0&&r){const t=s.findIndex((t=>t.getChild()===e.getChild()));t>-1?("parent"===s[t].getOrientation()&&(s[t]=e),"child"===e.getOrientation()&&(s[t]=e)):s.push(i[0])}else{const t=s.findIndex((t=>t.getChild()===e.getChild()));if(t>-1&&s[t].getOrientation()===e.getOrientation())switch(e.getOrientation()){case"child":{const n=this.annotationParentEvents[e.getChild()];n?s[t]=n:s=s.filter((t=>t.getChild()!==e.getChild()));break}case"parent":{const n=this.annotationChildEvents[e.getChild()];n?s[t]=n:s=s.filter((t=>t.getChild()!==e.getChild()));break}}}return{filteredAnnotationContents:s}}))})),vb(this,"initializeAnnotations",(e=>{if(this.state.room){this.annotationParentEvents={},this.annotationChildEvents={};const e=tt.client.getVisibleRooms().map((e=>e.getLiveTimeline())).map((e=>e.getState(ge.EventTimeline.FORWARDS).getStateEvents(Ue)));for(const t of[].concat(...e))if(t.getStateKey()===this.state.room.roomId){if(t.getTs()<1648936377334)continue;const e=new rs(t);this.insertable(e)&&(this.annotationParentEvents[e.getChild()]=e)}const t=this.state.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(Be).map((e=>new rs(e))).filter(this.insertable);for(const e of t)this.annotationChildEvents[e.getChild()]=e;const n=Object.assign({},this.annotationParentEvents,this.annotationChildEvents);this.setState({filteredAnnotationContents:this.filterAnnotations(this.state.annotationFilter,n)})}else setTimeout(this.initializeAnnotations,500)})),vb(this,"filterAnnotations",((e,t)=>{const n=Object.values(t),i=[],r=[],s=[],o=e.split(" ");for(const e of o)"@"===e.slice(0,1)?r.push(e.slice(1)):"~"===e.slice(0,1)?s.push(e.slice(1)):i.push(e);return n.filter((e=>{let t=!0;return s.includes("me")&&(t=t&&e.getCreator()===tt.client.getUserId()),s.includes("hour")&&(t=t&&e.event.getTs()>Date.now()-36e5),s.includes("day")&&(t=t&&e.event.getTs()>Date.now()-864e5),s.includes("week")&&(t=t&&e.event.getTs()>Date.now()-6048e5),s.includes("question")&&(t=t&&e.isQuestion()),s.includes("unread")&&(t=t&&e.getUnread()),(!r.length||r.some((t=>e.getCreator().toLowerCase().includes(t.toLowerCase()))))&&t&&i.every((t=>!e.getText()&&!e.getRootContent()||e.getText()?.toLowerCase().includes(t.toLowerCase())||e.getRootContent()?.body.toLowerCase().includes(t.toLowerCase())))}))}));const t=Pl.history.location.state;this.state={focus:null,secondaryFocus:null,resourceLength:null,navHeight:75,chatVisible:!1,listingType:null,listingVisible:!!t&&!!t.searchString,hasSelection:!1,annotationsVisible:!0,filteredAnnotationContents:[],pindropMode:null,annotationFilter:t?t.searchString:"",searchString:"",loadingStatus:"loading...",contentWidthPx:null,contentHeightPx:null,zoomFactor:null},this.annotationChildEvents={},this.annotationParentEvents={},this.prevScrollTop=0,this.userColor=new we(tt.client.getUserId())}componentDidMount(){document.addEventListener("selectionchange",this.checkForSelection),document.addEventListener("keydown",this.handleKeydown),tt.client.on("RoomState.events",this.handleStateUpdate),tt.client.on("Room.accountData",this.handleAccountData),this.fetchResource()}componentWillUnmount(){document.removeEventListener("selectionchange",this.checkForSelection),document.removeEventListener("keydown",this.handleKeydown),tt.client.off("RoomState.events",this.handleStateUpdate),tt.client.off("Room.accountData",this.handleAccountData)}componentDidUpdate(e,t){e.resourceAlias!==this.props.resourceAlias&&this.fetchResource(),e.roomFocused!==this.props.roomFocused&&this.refreshFocus()}getLoadingStatus(){return this.state.contentHeightPx?null:"string"==typeof this.state.loadingStatus?h("div",{id:"document-view-loading"},this.state.loadingStatus):"number"==typeof this.state.loadingStatus?h("div",{id:"document-view-loading"},h("span",null,"Downloading..."),h("progress",{class:"styled-progress",max:"1",value:this.state.loadingStatus})):void 0}insertable(e){return e.isValid()&&(!e.isPrivate()||"All"!==e.getUnread())&&("pending"!==e.getStatus()||"pending"===e.getStatus()&&e.getCreator()===tt.client.getUserId())}getContentComponent(){if("application/pdf"===this.state.mimetype){const e=Hy.positionToPage(this.props.resourcePosition,this.state.room);return this.props.resourcePosition!=e&&Pl.replace(`/${encodeURIComponent(this.props.resourceAlias)}/${e}`+(this.props.roomFocused?"/"+this.props.roomFocused:"")+(this.props.eventFocused?"/"+this.props.eventFocused:"")),h(Hy,{filteredAnnotationContents:this.state.filteredAnnotationContents,ref:this.content,focus:this.state.focus,pageFocused:e,totalPages:this.state.resourceLength,key:this.props.resourceAlias,resourceAlias:this.props.resourceAlias,resourceLength:this.state.resourceLength,pindropMode:this.state.pindropMode,setPindropMode:this.setPindropMode,room:this.state.room,roomFocused:this.props.roomFocused,eventFocused:this.props.eventFocused,searchString:this.state.searchString,secondaryFocus:this.state.secondaryFocus,setFocus:this.setFocus,contentContainer:this.contentContainer,setContentDimensions:this.setContentDimensions,setPdfLoadingStatus:this.setLoadingStatus,setPdfText:this.setSearchText,setTotalPages:this.setResourceLength,showChat:this.showChat,zoomFactor:this.state.zoomFactor})}if(this.state.mimetype?.match(/^audio|^video/)){const e=Zy.positionToTimestamp(this.props.resourcePosition,this.state.room);return this.props.resourcePosition!=e&&Pl.replace(`/${encodeURIComponent(this.props.resourceAlias)}/${e}`+(this.props.roomFocused?"/"+this.props.roomFocused:"")+(this.props.eventFocused?"/"+this.props.eventFocused:"")),h(Zy,{filteredAnnotationContents:this.state.filteredAnnotationContents,ref:this.content,key:this.props.resourceAlias,resourceAlias:this.props.resourceAlias,resource:this.state.resource,timeStamp:e,room:this.state.room,roomFocused:this.props.roomFocused,eventFocused:this.props.eventFocused,secondaryFocus:this.state.secondaryFocus,mimetype:this.state.mimetype,setFocus:this.setFocus,setMobileButtonColor:this.setMobileButtonColor,unsetFocus:this.unsetFocus,focus:this.state.focus,showChat:this.showChat,setMediaDuration:this.setResourceLength,setContentDimensions:this.setContentDimensions,setMediaLoadingStatus:this.setLoadingStatus})}return this.state.mimetype?.match(/^image/)?h(rb,{filteredAnnotationContents:this.state.filteredAnnotationContents,ref:this.content,key:this.props.resourceAlias,resourceAlias:this.props.resourceAlias,resource:this.state.resource,room:this.state.room,roomFocused:this.props.roomFocused,eventFocused:this.props.eventFocused,secondaryFocus:this.state.secondaryFocus,mimetype:this.state.mimetype,setFocus:this.setFocus,setMobileButtonColor:this.setMobileButtonColor,unsetFocus:this.unsetFocus,focus:this.state.focus,showChat:this.showChat,setContentDimensions:this.setContentDimensions,contentContainer:this.contentContainer,contentHeightPx:this.state.contentHeightPx,contentWidthPx:this.state.contentWidthPx,setImageLoadingStatus:this.setLoadingStatus,zoomFactor:this.state.zoomFactor,setZoom:this.setZoom}):null}getNavComponent(){if("application/pdf"===this.state.mimetype){const e=Hy.positionToPage(this.props.resourcePosition,this.state.room);return h(db,{hasSelection:this.state.hasSelection,annotationsVisible:this.state.annotationsVisible,openAnnotation:this.openAnnotation,closeAnnotation:this.closeAnnotation,hasAnnotations:this.state.filteredAnnotationContents.length>0,pageFocused:e,resourceAlias:this.props.resourceAlias,total:this.state.resourceLength,focus:this.state.focus,roomFocused:this.props.roomFocused,eventFocused:this.props.eventFocused,focusNext:this.focusNext,focusPrev:this.focusPrev,room:this.state.room,content:this.content,contentContainer:this.contentContainer,contentWidthPx:this.state.contentWidthPx,toggleAnnotations:this.toggleAnnotations,setNavHeight:this.setNavHeight,showSearch:this.showSearch,startPindrop:this.startPindrop,pindropMode:this.state.pindropMode,setZoom:this.setZoom})}if(this.state.mimetype?.match(/^audio|^video/)){const e=Zy.positionToTimestamp(this.props.resourcePosition,this.state.room);return h(pb,{hasSelection:this.state.hasSelection,annotationsVisible:this.state.annotationsVisible,openAnnotation:this.openAnnotation,closeAnnotation:this.closeAnnotation,hasAnnotations:this.state.filteredAnnotationContents.length>0,timeStamp:e,resourceAlias:this.props.resourceAlias,total:this.state.resourceLength,focus:this.state.focus,eventFocused:this.props.eventFocused,focusNext:this.focusNext,focusPrev:this.focusPrev,room:this.state.room,roomFocused:this.props.roomFocused,content:this.content,contentContainer:this.contentContainer,contentWidthPx:this.state.contentWidthPx,toggleAnnotations:this.toggleAnnotations,setNavHeight:this.setNavHeight})}return this.state.mimetype?.match(/^image/)?h(fb,{hasSelection:this.state.hasSelection,annotationsVisible:this.state.annotationsVisible,openAnnotation:this.openAnnotation,closeAnnotation:this.closeAnnotation,hasAnnotations:this.state.filteredAnnotationContents.length>0,resourceAlias:this.props.resourceAlias,total:this.state.resourceLength,focus:this.state.focus,eventFocused:this.props.eventFocused,focusNext:this.focusNext,focusPrev:this.focusPrev,room:this.state.room,roomFocused:this.props.roomFocused,content:this.content,contentContainer:this.contentContainer,contentWidthPx:this.state.contentWidthPx,toggleAnnotations:this.toggleAnnotations,setNavHeight:this.setNavHeight,setZoom:this.setZoom}):null}render(e,t){return h("div",{style:{"--zoomFactor":t.zoomFactor,"--navHeight":`${t.navHeight}px`,"--contentWidthPx":`${t.contentWidthPx}px`,"--contentHeightPx":`${t.contentHeightPx}px`,"--chatVisible":t.chatVisible?1:0,"--listingVisible":t.listingVisible?1:0,"--chatFocused":t.focus?1:0,"--selectColor":this.userColor.solid,"--mobileButtonColor":t.mobileButtonColor},id:"content-container",ref:this.contentContainer,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,onTouchCancel:this.handleTouchEnd,"data-annotations-hidden":!t.annotationsVisible,"data-pindrop-mode":!!t.pindropMode&&(t.pindropMode?.x?"placed":"unplaced"),onPointerMove:this.handlePointerMove},h(Qf,null),this.getLoadingStatus(),this.getContentComponent(),h("div",{id:"sidepanel"},h(bb,{visible:t.chatVisible,id:"panel-handle-1",offsetVar:"--dragOffset-1",contentContainer:this.contentContainer}),t.focus?h(cy,{class:"panel-widget-1",setSecondaryFocus:this.setSecondaryFocus,unsetFocus:this.unsetFocus,resource:t.resource,resourceAlias:e.resourceAlias,eventFocused:e.eventFocused,hasSelection:t.hasSelection,generateLocation:this.content.current.generateLocation,secondaryFocus:t.secondaryFocus,focus:t.focus}):h("div",{class:"panel-widget-1"}),h(bb,{visible:t.listingVisible,id:"panel-handle-2",offsetVar:"--dragOffset-2",contentContainer:this.contentContainer}),"search"===t.listingType?h(xy,{class:"panel-widget-2",searchString:t.searchString,setSearch:this.setSearch,endSearch:this.endSearch,hideListing:this.hideListing,pdfText:this.searchText,resourceAlias:e.resourceAlias,roomFocused:e.roomFocused}):h(by,{roomId:t.room?.roomId,class:"panel-widget-2",focus:t.focus,mimetype:t.mimetype,setAnnotationFilter:this.setAnnotationFilter,annotationFilter:t.annotationFilter,annotationContents:Object.assign({},this.annotationParentEvents,this.annotationChildEvents),filteredAnnotationContents:t.filteredAnnotationContents,focusByRoomId:this.focusByRoomId,focusNext:this.focusNext,focusPrev:this.focusPrev,resource:this.state.resource,room:t.room}),h("div",{class:"panel-widget-controls"},t.room?h(tc,{roomId:t.room.roomId,size:42,topic:t.room.getLiveTimeline().getState(ge.EventTimeline.FORWARDS).getStateEvents(ge.EventType.RoomTopic,"")?.getContent()?.topic,name:t.room.name,avatarUrl:t.room.getMxcAvatarUrl()}):null,h("hr",null),h(Tr,{placement:"left",content:"Show chat"},h("button",{"data-active":t.chatVisible,disabled:!t.focus,id:"show-chat",onclick:this.toggleChat},Gt)),h(Tr,{placement:"left",content:"Show annotation list"},h("button",{"data-active":t.listingVisible,id:"show-annotations",onclick:this.toggleListing},Rt)))),this.getNavComponent(),h("div",{id:"content-mobile-buttons"},h("button",{title:"open options",id:"panel-toggle",onclick:this.openSidebar},t.chatVisible||t.listingVisible?null:st)),h(Pv,null))}}class bb extends m{constructor(...e){super(...e),vb(this,"dragOffset",0),vb(this,"handlePointerMove",(e=>{e.clientX<20||this.startingClientX-e.clientX<0||(this.dragOffset=this.startingClientX-e.clientX,this.props.contentContainer.current.style.setProperty(this.props.offsetVar,`${this.dragOffset}px`))})),vb(this,"startDrag",(e=>{this.props.contentContainer.current.style.setProperty("--transitionSizing","unset"),this.props.contentContainer.current.setPointerCapture(e.pointerId),this.startingClientX=e.clientX+this.dragOffset,this.props.contentContainer.current.addEventListener("pointermove",this.handlePointerMove),this.props.contentContainer.current.addEventListener("pointerup",(t=>{this.props.contentContainer.current.style.removeProperty("--transitionSizing"),this.props.contentContainer.current.releasePointerCapture(e.pointerId),this.props.contentContainer.current.removeEventListener("pointermove",this.handlePointerMove)}))}))}render(e){if(e.visible)return h("div",{id:e.id,onpointerdown:this.startDrag,class:"panel-handle"},h("div",null,_t))}}var wb=__webpack_require__(5578),Sb={};Sb.styleTagTransform=Me(),Sb.setAttributes=Ie(),Sb.insert=Ce().bind(null,"head"),Sb.domAPI=xe(),Sb.insertStyleElement=Pe(),Ee()(wb.Z,Sb),wb.Z&&wb.Z.locals&&wb.Z.locals;class _b extends m{constructor(...e){var t,n;super(...e),n=async()=>{tt.client&&["PREPARED","SYNCING","ERROR"].includes(tt.client.getSyncState())?(this.props.setInitializationStage("initialized"),function(e){const t=new URLSearchParams(window.location.search),n=t.get("join"),i=t.getAll("via"),r=t.get("server");n&&i.length>0&&tt.client.joinRoom(n,{viaServers:i}),r&&r!==tt.client.getDomain()&&un.set(h(p,null,h("h3",{id:"toast-header"},"You might be in the wrong place"),h("div",null,"The link that brought you here requested",h("pre",null,r),"but you're already logged in to",h("pre",null,tt.client.getDomain()),"If you want join the server requested by the link you followed, log out and then follow the link again."),h("div",{style:"margin-top:10px"},h("button",{onclick:t=>{un.set(null),e()},class:"styled-button"},"Log out")))),window.history.replaceState({toastWarning:!0},"",window.location.pathname+window.location.hash)}(this.props.logoutHandler)):setTimeout(this.pollInitialized,1e3)},(t="pollInitialized")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}componentDidMount(){this.pollInitialized()}render(e){return h("div",{id:"splash-wrapper"},h(Eb,null),h("div",{id:"splash-loader"},e.initializationStage))}}function Eb(){return h("svg",{id:"splash-logo",width:"31mm",height:"31mm",version:"1.1",viewBox:"-4.5 -4.5 40 40",xmlns:"http://www.w3.org/2000/svg"},h("g",{transform:"translate(-15.196 -28.116)"},h("circle",{id:"splash-logo-back",cx:"30.696",cy:"43.616",r:"15",style:"paint-order:stroke fill markers"}),h("circle",{cx:"30.696",cy:"43.616",r:"15",fill:"#fff","stroke-linejoin":"round",style:"paint-order:stroke fill markers"}),h("g",{"stroke-width":".38504","aria-label":"P"},h("path",{d:"m27.477 32.835h4.066q1.9714 0 3.3883 0.70847t2.187 2.0638q0.77008 1.3245 0.77008 3.1727 0 1.4169-0.55445 2.5566-0.55445 1.1089-1.4785 1.879t-2.0946 1.1705q-1.1705 0.36964-2.4334 0.27723-1.2321-0.09241-2.4026-0.70847v-0.30803t0.52365 0.09241q0.52365 0.06161 1.3245 0.0308 0.83168-0.06161 1.725-0.33883 0.92409-0.30803 1.6942-1.0473 0.80088-0.73927 1.2013-2.0638 0.09241-0.33883 0.15402-0.83168 0.06161-0.52365 0.0308-1.0165-0.0308-2.1254-1.1089-3.4191-1.0781-1.2937-3.0495-1.2937h-3.6348t-0.09241-0.21562q-0.06161-0.24642-0.15402-0.46204-0.06161-0.24642-0.06161-0.24642zm0.40044 0v21.562h-2.0022v-21.562zm-1.9098 19.313v2.2486h-2.4642v-0.30803t0.18482 0q0.21562 0 0.21562 0 0.80088 0 1.3553-0.55445 0.58526-0.58526 0.61606-1.3861zm0-17.065h-0.09241q0-0.80088-0.58526-1.3553-0.58526-0.58526-1.3861-0.58526 0 0-0.18482 0t-0.18482 0l-0.0308-0.30803h2.4642zm1.8174 17.065h0.09241q0.0308 0.80088 0.58526 1.3861 0.58526 0.55445 1.3861 0.55445 0 0 0.18482 0 0.21562 0 0.21562 0v0.30803h-2.4642z"}))))}__webpack_require__.p,__webpack_require__.p,__webpack_require__.p,__webpack_require__.p,__webpack_require__.p,__webpack_require__.p,__webpack_require__.p,__webpack_require__.p;var kb=__webpack_require__(5812),xb={};xb.styleTagTransform=Me(),xb.setAttributes=Ie(),xb.insert=Ce().bind(null,"head"),xb.domAPI=xe(),xb.insertStyleElement=Pe(),Ee()(kb.Z,xb),kb.Z&&kb.Z.locals&&kb.Z.locals;var Tb=__webpack_require__(1386),Cb={};function Ab(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Cb.styleTagTransform=Me(),Cb.setAttributes=Ie(),Cb.insert=Ce().bind(null,"head"),Cb.domAPI=xe(),Cb.insertStyleElement=Pe(),Ee()(Tb.Z,Cb),Tb.Z&&Tb.Z.locals&&Tb.Z.locals,"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("service-worker.js").then((e=>{console.log("[Service Worker] registered")})).catch((e=>{console.log("[Service Worker] failed to register: ",e)}))})),window.recaptchaHandler=function(e){window.dispatchEvent(new CustomEvent("recaptcha",{detail:e}))},function(n,i,r){var s,a,l;t.__&&t.__(n,i),a=(s="function"==typeof r)?null:r&&r.__k||i.__k,l=[],C(i,n=(!s&&r||i).__k=h(p,null,[n]),a||o,o,void 0!==i.ownerSVGElement,!s&&r?[r]:a?null:i.firstChild?e.call(i.childNodes):null,l,!s&&r?r:a?a.__e:i.firstChild,s),A(l,n)}(h(class extends m{constructor(){super(),Ab(this,"setInitializationStage",(e=>this.setState({initializationStage:e}))),Ab(this,"logoutHandler",(e=>{localStorage.clear(),tt.restart(),this.setState({loggedIn:!1})})),Ab(this,"loginHandler",(e=>{tt.client.on("Session.logged_out",this.logoutHandler),localStorage.setItem("accessToken",tt.client.getAccessToken()),localStorage.setItem("userId",tt.client.getUserId()),tt.client.startClient().then((e=>{tt.client.getMediaConfig().then((e=>tt.mediaConfig=e)),this.setState({initializationStage:"performing initial sync",loggedIn:!0})}))})),this.state={initializationStage:"connecting to database",loggedIn:!0};const e=new URLSearchParams(window.location.search);this.loginToken=e.get("loginToken"),localStorage.getItem("scrollbars")?document.documentElement.dataset.scrollbars=localStorage.getItem("scrollbars"):document.documentElement.dataset.scrollbars="hidden",tt.isResumable()?tt.initClient().then(this.loginHandler):this.loginToken?tt.initClient().then((e=>tt.client.loginWithToken(this.loginToken,this.loginHandler))):this.setState({loggedIn:!1})}render(e,t){const n=t.loggedIn?"initialized"!==t.initializationStage?h(_b,{initializationStage:t.initializationStage,setInitializationStage:this.setInitializationStage,logoutHandler:this.logoutHandler}):h(me,{history:Pl.history},h(Fv,{path:"/",logoutHandler:this.logoutHandler}),h(yb,{path:"/:resourceAlias/:resourcePosition?/:roomFocused?/:eventFocused?"})):h(Hv,{loginHandler:this.loginHandler});return h(p,null,h(hs,null),h(un,null),n)}},null),document.body)})()})();