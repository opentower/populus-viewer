/*! For license information please see main.js.LICENSE.txt */
var Populus;(()=>{var __webpack_modules__={9713:e=>{e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},5318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},862:(e,t,r)=>{var n=r(8).default;function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r},e.exports.default=e.exports,e.exports.__esModule=!0},8:e=>{function t(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},9141:e=>{"use strict";for(var t=/[\\\"\x00-\x1F]/g,r={},n=0;n<32;++n)r[String.fromCharCode(n)]="\\U"+("0000"+n.toString(16)).slice(-4).toUpperCase();function i(e){return t.lastIndex=0,e.replace(t,(function(e){return r[e]}))}r["\b"]="\\b",r["\t"]="\\t",r["\n"]="\\n",r["\f"]="\\f",r["\r"]="\\r",r['"']='\\"',r["\\"]="\\\\",e.exports={stringify:function e(t){switch(typeof t){case"string":return'"'+i(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return null===t?"null":Array.isArray(t)?function(t){for(var r="[",n="",i=0;i<t.length;++i)n+=r,r=",",n+=e(t[i]);return","!=r?"[]":n+"]"}(t):function(t){var r="{",n="",s=Object.keys(t);s.sort();for(var o=0;o<s.length;++o){var a=s[o];n+=r+'"'+i(a)+'":',r=",",n+=e(t[a])}return","!=r?"{}":n+"}"}(t);default:throw new Error("Cannot stringify: "+typeof t)}}}},8162:(e,t,r)=>{"use strict";var n=r(9509).Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==t[o])throw new TypeError(s+" is ambiguous");t[o]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return n.alloc(0);var r=0;if(" "!==e[r]){for(var i=0,s=0;e[r]===c;)i++,r++;for(var o=(e.length-r)*l+1>>>0,u=new Uint8Array(o);e[r];){var h=t[e.charCodeAt(r)];if(255===h)return;for(var d=0,p=o-1;(0!==h||d<s)&&-1!==p;p--,d++)h+=a*u[p]>>>0,u[p]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");s=d,r++}if(" "!==e[r]){for(var f=o-s;f!==o&&0===u[f];)f++;var g=n.allocUnsafe(i+(o-f));g.fill(0,0,i);for(var m=i;f!==o;)g[m++]=u[f++];return g}}}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var r=0,i=0,s=0,o=t.length;s!==o&&0===t[s];)s++,r++;for(var l=(o-s)*u+1>>>0,h=new Uint8Array(l);s!==o;){for(var d=t[s],p=0,f=l-1;(0!==d||p<i)&&-1!==f;f--,p++)d+=256*h[f]>>>0,h[f]=d%a>>>0,d=d/a>>>0;if(0!==d)throw new Error("Non-zero carry");i=p,s++}for(var g=l-i;g!==l&&0===h[g];)g++;for(var m=c.repeat(r);g<l;++g)m+=e.charAt(h[g]);return m},decodeUnsafe:h,decode:function(e){var t=h(e);if(t)return t;throw new Error("Non-base"+a+" character")}}}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,s=c(e),o=s[0],a=s[1],l=new i(function(e,t,r){return 3*(t+r)/4-r}(0,o,a)),u=0,h=a>0?o-4:o;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[u++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],o=16383,a=0,c=n-i;a<c;a+=o)s.push(l(e,a,a+o>c?c:a+o));return 1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,n){for(var i,s,o=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},4770:function(e,t){var r,n;void 0===(n="function"==typeof(r=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");t.log={trace:n,debug:n,info:n,warn:n,error:n};function t(s,o){if("function"!=typeof o)throw new Error("Bad callback given: "+o);if(!s)throw new Error("No options given");var a=s.onResponse;if((s="string"==typeof s?{uri:s}:JSON.parse(JSON.stringify(s))).onResponse=a,s.verbose&&(t.log=function(){var e,t,r={},s=["trace","debug","info","warn","error"];for(t=0;t<s.length;t++)r[e=s[t]]=n,"undefined"!=typeof console&&console&&console[e]&&(r[e]=i(console,e));return r}()),s.url&&(s.uri=s.url,delete s.url),!s.uri&&""!==s.uri)throw new Error("options.uri is a required argument");if("string"!=typeof s.uri)throw new Error("options.uri must be a string");for(var c=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],l=0;l<c.length;l++)if(s[c[l]])throw new Error("options."+c[l]+" is not supported");if(s.callback=o,s.method=s.method||"GET",s.headers=s.headers||{},s.body=s.body||null,s.timeout=s.timeout||t.DEFAULT_TIMEOUT,s.headers.host)throw new Error("Options.headers.host is not supported");s.json&&(s.headers.accept=s.headers.accept||"application/json","GET"!==s.method&&(s.headers["content-type"]="application/json"),"boolean"!=typeof s.json?s.body=JSON.stringify(s.json):"string"!=typeof s.body&&(s.body=JSON.stringify(s.body)));var u=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")};if(s.qs){var h="string"==typeof s.qs?s.qs:u(s.qs);-1!==s.uri.indexOf("?")?s.uri=s.uri+"&"+h:s.uri=s.uri+"?"+h}if(s.form){if("string"==typeof s.form)throw"form name unsupported";if("POST"===s.method){var d=(s.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(s.headers["content-type"]=d,d){case"application/x-www-form-urlencoded":s.body=u(s.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+n+'"\n\n'+e[n]+"\n");return r.push("--"+t.boundry+"--"),t.body=r.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t}(s.form);s.body=p.body,s.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+d)}}}return s.onResponse=s.onResponse||n,!0===s.onResponse&&(s.onResponse=o,s.callback=n),!s.headers.authorization&&s.auth&&(s.headers.authorization="Basic "+function(e){var t,r,n,i,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,c=0,l="",u=[];if(!e)return e;do{t=(s=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,r=s>>12&63,n=s>>6&63,i=63&s,u[c++]=o.charAt(t)+o.charAt(r)+o.charAt(n)+o.charAt(i)}while(a<e.length);switch(l=u.join(""),e.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l}(s.auth.username+":"+s.auth.password)),function(n){var i=new e,s=!1,o=function(e){var t,r=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(e){(t=document.createElement("a")).href="",t=t.href}var n=r.exec(t.toLowerCase())||[],i=r.exec(e.toLowerCase());return!(!i||i[1]==n[1]&&i[2]==n[2]&&(i[3]||("http:"===i[1]?80:443))==(n[3]||("http:"===n[1]?80:443)))}(n.uri),a="withCredentials"in i;if(r+=1,i.seq_id=r,i.id=r+": "+n.method+" "+n.uri,i._id=i.id,o&&!a){var c=new Error("Browser does not support cross-origin request: "+n.uri);return c.cors="unsupported",n.callback(c,i)}function l(){s=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=n.timeout,t.log.error("Timeout",{id:i._id,milliseconds:n.timeout}),n.callback(e,i)}i.timeoutTimer=setTimeout(l,n.timeout);var u={response:!1,loading:!1,end:!1};return i.onreadystatechange=h,i.open(n.method,n.uri,!0),o&&(i.withCredentials=!!n.withCredentials),i.send(n.body),i;function h(r){if(s)return t.log.debug("Ignoring timed out state change",{state:i.readyState,id:i.id});if(t.log.debug("State change",{state:i.readyState,id:i.id,timed_out:s}),i.readyState===e.OPENED)for(var o in t.log.debug("Request started",{id:i.id}),n.headers)i.setRequestHeader(o,n.headers[o]);else i.readyState===e.HEADERS_RECEIVED?d():i.readyState===e.LOADING?(d(),p()):i.readyState===e.DONE&&(d(),p(),f())}function d(){if(!u.response){if(u.response=!0,t.log.debug("Got response",{id:i.id,status:i.status}),clearTimeout(i.timeoutTimer),i.statusCode=i.status,o&&0==i.statusCode){var e=new Error("CORS request rejected: "+n.uri);return e.cors="rejected",u.loading=!0,u.end=!0,n.callback(e,i)}n.onResponse(null,i)}}function p(){u.loading||(u.loading=!0,t.log.debug("Response body loading",{id:i.id}))}function f(){if(!u.end){if(u.end=!0,t.log.debug("Request done",{id:i.id}),i.body=i.responseText,n.json)try{i.body=JSON.parse(i.responseText)}catch(e){return n.callback(e,i)}n.callback(null,i,i.body)}}}(s)}var r=0;function n(){}function i(e,t){return function(r,n){return"object"==typeof n&&(r+=" "+JSON.stringify(n)),e[t].call(e,r)}}return t.withCredentials=!1,t.DEFAULT_TIMEOUT=18e4,t.defaults=function(e,r){var n=function(t){return function(r,n){for(var i in r="string"==typeof r?{uri:r}:JSON.parse(JSON.stringify(r)),e)void 0===r[i]&&(r[i]=e[i]);return t(r,n)}},i=n(t);return i.get=n(t.get),i.post=n(t.post),i.put=n(t.put),i.head=n(t.head),i},["get","put","post","head"].forEach((function(e){var r=e.toUpperCase();t[e.toLowerCase()]=function(e){"string"==typeof e?e={method:r,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=r;var n=[e].concat(Array.prototype.slice.apply(arguments,[1]));return t.apply(this,n)}})),t.couch=function(e,r){return"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,r=r||n,t(e,(function(e,t,n){if(e)return r(e,t,n);if((t.statusCode<200||t.statusCode>299)&&n.error){for(var i in e=new Error("CouchDB error: "+(n.error.reason||n.error.error)),n)e[i]=n[i];return r(e,t,n)}return r(e,t,n)}))},t})?r.apply(t,[]):r)||(e.exports=n)},7191:(e,t,r)=>{var n=r(8162);e.exports=n("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},8764:(e,t,r)=>{"use strict";const n=r(9742),i=r(645),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|g(e,t);let n=a(r);const i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return c.from(n,t,r);const i=function(e){if(c.isBuffer(e)){const t=0|f(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||X(e.length)?a(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|f(e))}function d(e){const t=e.length<0?0:0|f(e.length),r=a(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,c.prototype),n}function f(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function g(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return H(e).length;default:if(i)return n?-1:V(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,r);case"utf8":case"utf-8":return A(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return I(this,t,r);case"base64":return x(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function y(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),X(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:_(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):_(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,r,n,i){let s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(l(e,s)===l(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===c)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){let r=!0;for(let n=0;n<c;n++)if(l(e,s+n)!==l(t,n)){r=!1;break}if(r)return s}return-1}function b(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(X(n))return o;e[r+o]=n}return o}function w(e,t,r,n){return W(V(t,e.length-r),e,r,n)}function S(e,t,r,n){return W(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function k(e,t,r,n){return W(H(t),e,r,n)}function E(e,t,r,n){return W(function(e,t){let r,n,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function x(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function A(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[i+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(s=c));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(e){const t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=T));return r}(n)}t.kMaxLength=o,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,r){return function(e,t,r){return u(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},c.allocUnsafe=function(e){return h(e)},c.allocUnsafeSlow=function(e){return h(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(Y(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=c.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(Y(t,Uint8Array))i+t.length>n.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)y(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):m.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(e,t,r,n,i){if(Y(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(s,o),l=this.slice(n,i),u=e.slice(t,r);for(let e=0;e<a;++e)if(l[e]!==u[e]){s=l[e],o=u[e];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return w(this,e,t,r);case"ascii":case"latin1":case"binary":return S(this,e,t,r);case"base64":return k(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const T=4096;function C(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function I(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function R(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=J[e[n]];return i}function O(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function P(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,r,n,i,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function M(e,t,r,n,i){K(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function L(e,t,r,n,i){K(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function N(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function F(e,t,r,n,s){return t=+t,r>>>=0,s||N(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function B(e,t,r,n,s){return t=+t,r>>>=0,s||N(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=Q((function(e){z(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||$(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),c.prototype.readBigUInt64BE=Q((function(e){z(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||$(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=Q((function(e){z(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||$(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=Q((function(e){z(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||$(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||D(this,e,t,r,Math.pow(2,8*r)-1,0);let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||D(this,e,t,r,Math.pow(2,8*r)-1,0);let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=Q((function(e,t=0){return M(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=Q((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);D(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);D(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=Q((function(e,t=0){return M(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=Q((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,r){return F(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return F(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return B(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return B(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const s=c.isBuffer(e)?e:c.from(e,n),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%o]}return this};const U={};function q(e,t,r){U[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function j(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function K(e,t,r,n,i,s){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new U.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){z(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||$(t,e.length-(r+1))}(n,i,s)}function z(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function $(e,t,r){if(Math.floor(e)!==e)throw z(e,r),new U.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}q("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),q("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),q("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=j(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=j(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const G=/[^+/0-9A-Za-z-_]/g;function V(e,t){let r;t=t||1/0;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function H(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function Q(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},1924:(e,t,r)=>{"use strict";var n=r(210),i=r(5559),s=i(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?i(r):r}},5559:(e,t,r)=>{"use strict";var n=r(8612),i=r(210),s=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||n.call(o,s),c=i("%Object.getOwnPropertyDescriptor%",!0),l=i("%Object.defineProperty%",!0),u=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=a(n,o,arguments);if(c&&l){var r=c(t,"length");r.configurable&&l(t,"length",{value:1+u(0,e.length-(arguments.length-1))})}return t};var h=function(){return a(n,s,arguments)};l?l(e.exports,"apply",{value:h}):e.exports.apply=h},7811:(e,t)=>{"use strict";var r=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,n=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,i=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,o=/([\\"])/g,a=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(e){var t=String(e);if(i.test(t))return t;if(t.length>0&&!n.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(o,"\\$1")+'"'}function l(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,r=e.type;if(!r||!a.test(r))throw new TypeError("invalid type");var n=r;if(t&&"object"==typeof t)for(var s,o=Object.keys(t).sort(),l=0;l<o.length;l++){if(s=o[l],!i.test(s))throw new TypeError("invalid parameter name");n+="; "+s+"="+c(t[s])}return n},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var n=t.indexOf(";"),i=-1!==n?t.substr(0,n).trim():t.trim();if(!a.test(i))throw new TypeError("invalid media type");var o=new l(i.toLowerCase());if(-1!==n){var c,u,h;for(r.lastIndex=n;u=r.exec(t);){if(u.index!==n)throw new TypeError("invalid parameter format");n+=u[0].length,c=u[1].toLowerCase(),'"'===(h=u[2])[0]&&(h=h.substr(1,h.length-2).replace(s,"$1")),o.parameters[c]=h}if(n!==t.length)throw new TypeError("invalid parameter format")}return o}},5047:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,"#annotation-layer { \n    position: absolute;\n    line-height:1;\n    opacity: 0.2;\n    overflow:visible;\n    left: 0;\n    top: 0;\n}\n\n#annotation-layer span {\n    background-color:blue;\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    transform-origin: 0% 0%;\n}\n\n#annotation-layer > div[data-focused] > span {\n    background-color:red;\n}\n",""]);const s=i},5789:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,'/* workaround for chrome bug with resizing the chat panel itself */\n#chat-wrapper {\n    display:inline-flex;\n    flex-direction: column-reverse;\n    border: 1px solid #adadad;\n    height:100%;\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n    overflow-y: scroll;\n}\n\n/*chrome, safari, opera*/\n#chat-wrapper::-webkit-scrollbar {\n  display: none;\n}\n\n#chat-panel {\n    display:inline-flex;\n    flex-direction: column-reverse;\n    width:400px;\n}\n\n#scroll-anchor, #scroll-done {\n    padding:10px;\n    font-weight:bold;\n}\n\n#messageComposer > textarea,\n.messageEditor > textarea {\n    display:block;\n    min-height:100px;\n    width:100%;\n    margin:0px;\n    border:none;\n    padding:0px;\n    resize:vertical;\n    border-top: 1px solid #adadad;\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\r\n    -moz-box-sizing: border-box; /* Firefox, other Gecko */\r\n    box-sizing: border-box; /* Opera/IE 8+ */\r\n}\n\n#messageComposer > textarea:focus,\n.messageEditor > textarea:focus {\n    outline: none;\n    border: 1px solid black;\n    border-bottom: none;\n}\n\n#messageComposer > textarea {\n    min-height:350px;\n}\n\n#submit-button-wrapper > button,\n.messageEditor > button {\n    cursor:pointer;\n    outline:none;\n    border:2px solid black;\n    color:black;\n    font-weight:bold;\n    transition: background-color 0.5s ease;\n    background-color:white;\n}\n\n.messageEditor > button {\n    width:50%;\n    height:30px;\n}\n\n#submit-button-wrapper {\n    display:grid;\n    column-gap: 0px;\n    grid-template-columns: repeat(6,1fr) ;\n}\n\n#submit-button-wrapper > button {\n    height:40px;\n    font-size:14pt;\n    margin:0px;\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n}\n\n#submitButton { grid-column:1/4; }\n\n#sendFileButton { grid-column:4/5; }\n\n#sendImageButton { grid-column:5/6; }\n\n#moreButtom { grid-column:6/7; }\n\n#sendFileButton, #sendImageButton, #moreButton {\n    border-left:none !important;\n}\n\n#submit-button-wrapper > button:hover, \n.messageEditor > button:hover {\n    transition: background-color 0.5s ease;\n    background-color: var(--user_light);\n}\n\n#messageComposer > button:active {\n    background-color:var(--user_dark);\n}\n\n#chat-panel .message {\n    position:relative;\n    display: grid;\n    justify-items: left;\n    grid-template-areas: "ident content";\n    grid-template-columns: fit-content(10%) auto ; \n}\n\n#chat-panel .me {\n    grid-template-columns: auto fit-content(10%); \n    grid-template-areas: "content ident";\n}\n\n#chat-panel .message > .ident {\n    position:relative;\n    grid-area: ident;\n    width:0px;\n    padding-top:10px;\n    padding-bottom:10px;\n    padding-left:12px;\n    margin-right:15px;\n    border-right: 5px solid var(--user_light);\n    background: white;\n}\n\n#chat-panel .me > .ident {\n    padding-top:10px;\n    padding-bottom:10px;\n    padding-left:0px;\n    margin-right:0px;\n    padding-right:12px;\n    margin-left:15px;\n    border-right: none;\n    border-left: 5px solid var(--user_light);\n    background: white;\n}\n\n#chat-panel .message .info {\n    width:300px;\n    visibility:hidden;\n    position:absolute;\n    top:-27px;\n    left: 12px;\n}\n\n#chat-panel .message .info > button {\n    margin:0px;\n    margin-left:5px;\n    border:2px solid var(--user_light);\n    padding:4px;\n    background-color:white;\n}\n\n#chat-panel .message .info > button:first-child {\n    margin-left:0px;\n}\n\n#chat-panel .message .info > button:last-child {\n    margin-right:0px;\n}\n\n#chat-panel .me .info {\n    left:unset;\n    right: 12px;\n}\n\n#chat-panel .message:hover .info  {\n    visibility:visible;\n}\n\n.redacted {\n    font-size:10pt;\n    color:gray;\n}\n\n#chat-panel .message > .body {\n    display: inline-block;\n    text-align:left;\n    margin-top:5px;\n    margin-bottom:5px;\n    grid-area: content;\n}\n\n#chat-panel .message:hover {\n    background-color: var(--user_ultralight);\n}\n\n#chat-panel .me  {\n    padding-left:5px;\n}\n\n#chat-panel .message div[data-mx-maths] {\n    min-width:350px;\n}\n\n#chat-panel .message .upvotes {\n    position:relative;\n    width:0px;\n    right:8px;\n    padding:3px;\n    font-size:8pt;\n    background-color:white;\n    border-radius:25px;\n    border:2px solid var(--user_light);\n}\n\n#chat-panel .user-info-message {\n    padding:10px;\n    font-size:10pt;\n    font-weight:bold;\n    color: var(--user_dark);\n}\n\n#chat-panel .me .upvotes {\n    right:12px;\n}\n\n#chat-panel .me {\n    text-align:right;\n}\n',""]);const s=i},8046:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,"#content-container {\n    position: relative;\n    overflow:scroll;\n}\n\n#sidepanel {\n    visibility:hidden;\n    position:fixed;\n    right:0px;\n    top:0px;\n    bottom:0px;\n    padding:50px;\n    box-shadow: -2px 0 4px 0 rgba(0,0,0,.2);\n    background:white;\n    z-index:6;\n}\n\n#document-view {\n    position:relative;\n    display: inline-block;\n}\n\n#document-view > canvas {\n    position:relative;\n    z-index:-1; /* prevents an apparent stacking bug in chromium */\n}\n\n#panelToggle {\n    position:fixed;\n    z-index:7;\n    top:10px;\n    right:10px;\n    border:none;\n    outline:none;\n    font-size:24px;\n    width:40px;\n    height:40px;\n    text-align:center;\n    vertical-align:middle;\n    background:white;\n    cursor:pointer;\n}\n\n/* Extra small devices (phones, 600px and down) */\n@media only screen and (max-width: 600px) {\n\n} \n\n/* Small devices (portrait tablets and large phones, 600px and up) */\n@media only screen and (min-width: 600px) {\n} \n\n/* Medium devices (landscape tablets, 768px and up) */\n@media only screen and (min-width: 768px) {\n} \n\n/* Large devices (laptops/desktops, 992px and up) */\n@media only screen and (min-width: 992px) {\n    #sidepanel {\n        width:400px;\n    }\n} \n\n/* standard DPI */\n@media only screen and (min-width: 1280px) {\n    #sidepanel {\n        visibility:visible;\n        padding:0px;\n        width:350px;\n    }\n    #panelToggle {\n        visibility:hidden;\n    }\n}\n\n/* high DPI laptop */\n@media only screen and (min-width: 1400px) {\n    #sidepanel {\n        padding:50px;\n        width:400px;\n    }\n}\n\n/* larger monitor */\n@media only screen and (min-width: 1800px) {\n    #sidepanel {\n        width:800px;\n    }\n}\n\n/* ultrawide monitors */\n@media only screen and (min-width: 2000px) {\n    #document-view {\n        left:200px;\n    }\n}\n\n@media only screen and (min-width: 2200px) {\n    #document-view {\n        left:200px;\n    }\n}\n",""]);const s=i},5812:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,"@import url(https://rsms.me/inter/inter.css);"]),i.push([e.id,"html * { font-family: 'Inter', sans-serif; }\n\n@supports (font-variation-settings: normal) {\n  html * { font-family: 'Inter var', sans-serif; }\n}\n\nbody { \n    margin:0px; \n}\n",""]);const s=i},2462:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,"#loginModal, #registrationModal {\n    display: inline-block;\n    border: 1px solid black;\n    padding: 1em;\n    padding-bottom: 2em;\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%) translateY(-50%);\n    top: 50%;\n}\n\n#loginModal form, #registrationModal form {\n    display:grid;\n    grid-template-columns: 80px 1fr;\n}\n\n#loginModal label, #registrationModal label {\n    grid-column: 1 / 2 ;\n}\n\n#loginModal input, #registrationModal input {\n    grid-column: 2 / 3 ;\n}\n\n#loginModal div, #registrationModal div {\n    padding-top:.5em;\n    grid-column: 1 / 3 ;\n}\n\n#theRecaptcha {\n    padding:1em;\n}\n",""]);const s=i},6145:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,"#page-nav {\n    position:fixed;\n    bottom:0px;\n    width:100%;\n    height:75px;\n    background: black;\n    z-index:5;\n}\n\n@media only screen and (min-width: 2000px) {\n    #page-nav {\n        padding-left:200px;\n    }\n}\n\n#nav-pages {\n    display:flex;\n    position:absolute;\n    bottom:75px;\n    align-items: center;\n    height:50px;\n    max-width:100%;\n    overflow-y:scroll;\n}\n\n.nav-hidden {\n    display:none !important;\n}\n\n#nav-pages > button:first-child {\n    margin-left:auto\n}\n\n#nav-pages > button:last-child {\n    margin-right:auto\n}\n\n#nav-pages > button {\n    cursor:pointer;\n    background:white;\n    border:2px solid black;\n    min-width:30px;\n    min-height:30px;\n    border-radius:15px;\n    margin-left:5px;\n    margin-right:5px;\n}\n\n#nav-button-wrapper {\n    height:100%;\n    display: flex;\n    align-items: center;\n    justify-content:center;\n    max-width:100%;\n}\n\n#nav-button-wrapper > button {\n    cursor:pointer;\n    color:white;\n    background:black;\n    border:none;\n}\n\n#nav-button-wrapper > button[disabled] {\n    color:gray;\n}\n\n#nav-button-wrapper > form {\n    position: relative;\n    display:flex;\n    align-items: center;\n    justify-content: center;\n    background:white;\n    font-size: 1em;\n    padding-left:5px;\n    padding-right:5px;\n    border-radius:50px;\n}\n\n#nav-button-wrapper > form > input {\n    width:20px; /*this is going to need to be adjusted in JS*/\n    font-size: 1em;\n    margin:3px;\n    border:none;\n    text-align:right;\n}\n\n#nav-total-pages {\n    font-size: 1em;\n    text-align:left;\n    width:20px;\n    margin:3px;\n}\n",""]);const s=i},145:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,"#text-layer { \n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    overflow: hidden;\n    line-height:1;\n    opacity: 0.2;\n}\n\n#text-layer > span {\n    color:transparent;\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    transform-origin: 0% 0%;\n}\n",""]);const s=i},5188:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(3645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,"#welcome-header {\n    position:fixed;\n    width:100%;\n    display:flex;\n    justify-content:flex-end;\n    align-items:center;\n    top:0px;\n    background-color: white;\n    z-index:2;\n    height:50px;\n    box-shadow: 0px 2px 4px 0 rgba(0,0,0,.2);\n}\n\n#welcome-header-content {\n    width:100%;\n    display:flex;\n    justify-content:flex-end;\n    align-items:center;\n}\n\n#welcome-upload {\n    padding-right:0px;\n    padding-top:3px;\n    margin-right:13px; \n    flex-shrink:0;\n}\n\n#welcome-upload > svg {\n    cursor: pointer;\n}\n\n#welcome-profile {\n    width:22px;\n    height:22px;\n    margin-right:13px; \n    line-height:22px;\n    text-align:center;\n    font-weight: bold;\n    border:2px solid black;\n    border-radius:35px;\n    background-color: var(--user_light);\n    flex-shrink:0;\n}\n\n#welcome-container {\n    margin-top:50px;\n    max-width: 800px;\n    position: absolute;\n    padding:1em;\n}\n\n#welcome-search { \n    position:relative; \n    flex-shrink:2;\n    flex-grow:1;\n    margin-right:30px; \n    margin-left:13px; \n}\n\n#welcome-search > svg {\n    position:absolute;\n    right:0px;\n    top:3px;\n}\n\n#welcome-search-input {\n    width:100%;\n    margin:auto;\n    padding:7px;\n    border:none;\n    background:#ededed;\n}\n\n@media only screen and (min-width: 600px) {\n    #welcome-container {\n        left: 50%;\n        transform: translateX(-50%);\n    }\n\n    #welcome-header-content {\n        width:400px;\n    }\n} \n\n.roomListingEntry, #pdfUploadForm {\n    border: 1px black solid;\n    margin: 1em;\n    padding: 1em;\n}\n\n.roomListingEntry a {\n  color: #069;\n  text-decoration: underline;\n  cursor: pointer;\n}\n\n.roomListingEntry > div {\n    line-height:2em;\n}\n\n.memberPill {\n    background:#aadada;\n    border-radius:5px;\n    margin-right:5px;\n    padding:5px;\n}\n\n#pdfUploadForm {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n}\n\n#pdfUploadForm > label {\n    grid-column: 1 / 2 ;\n}\n\n#pdfUploadForm > input, #pdfUploadForm > textarea {\n    grid-column: 2 / 3 ;\n    margin-bottom:.5em;\n    border:none;\n    background:#ededed\n}\n\n#pdfUploadForm > textarea {\n    resize: vertical;\n    min-height:50px;\n}\n\n#pdfUploadForm div {\n    grid-column: 1 / 3 ;\n}\n\n@media only screen and (max-width: 600px) {\n    #pdfUploadForm {\n        grid-template-columns: 1fr;\n    }\n\n#pdfUploadForm > label {\n    grid-column: 1 / 2 ;\n}\n\n#pdfUploadForm > input, #pdfUploadForm > textarea {\n    grid-column: 1 / 2 ;\n    margin-bottom:.5em;\n    border:none;\n    background:#ededed\n}\n\n#pdfUploadForm > textarea {\n    resize: vertical;\n    min-height:50px;\n}\n\n#pdfUploadForm div {\n    grid-column: 1 / 2 ;\n}\n} \n",""]);const s=i},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=e(t);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,n){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(n)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(i[o]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);n&&i[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),t.push(c))}},t}},9996:e=>{"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===r}(e)}(e)},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function n(e,t){return!1!==t.clone&&t.isMergeableObject(e)?a((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function i(e,t,r){return e.concat(t).map((function(e){return n(e,r)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function o(e,t){try{return t in e}catch(e){return!1}}function a(e,r,c){(c=c||{}).arrayMerge=c.arrayMerge||i,c.isMergeableObject=c.isMergeableObject||t,c.cloneUnlessOtherwiseSpecified=n;var l=Array.isArray(r);return l===Array.isArray(e)?l?c.arrayMerge(e,r,c):function(e,t,r){var i={};return r.isMergeableObject(e)&&s(e).forEach((function(t){i[t]=n(e[t],r)})),s(t).forEach((function(s){(function(e,t){return o(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(o(e,s)&&r.isMergeableObject(t[s])?i[s]=function(e,t){if(!t.customMerge)return a;var r=t.customMerge(e);return"function"==typeof r?r:a}(s,r)(e[s],t[s],r):i[s]=n(t[s],r))})),i}(e,r,c):n(r,c)}a.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return a(e,r,t)}),{})};var c=a;e.exports=c},7837:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attributeNames=t.elementNames=void 0,t.elementNames=new Map([["altglyph","altGlyph"],["altglyphdef","altGlyphDef"],["altglyphitem","altGlyphItem"],["animatecolor","animateColor"],["animatemotion","animateMotion"],["animatetransform","animateTransform"],["clippath","clipPath"],["feblend","feBlend"],["fecolormatrix","feColorMatrix"],["fecomponenttransfer","feComponentTransfer"],["fecomposite","feComposite"],["feconvolvematrix","feConvolveMatrix"],["fediffuselighting","feDiffuseLighting"],["fedisplacementmap","feDisplacementMap"],["fedistantlight","feDistantLight"],["fedropshadow","feDropShadow"],["feflood","feFlood"],["fefunca","feFuncA"],["fefuncb","feFuncB"],["fefuncg","feFuncG"],["fefuncr","feFuncR"],["fegaussianblur","feGaussianBlur"],["feimage","feImage"],["femerge","feMerge"],["femergenode","feMergeNode"],["femorphology","feMorphology"],["feoffset","feOffset"],["fepointlight","fePointLight"],["fespecularlighting","feSpecularLighting"],["fespotlight","feSpotLight"],["fetile","feTile"],["feturbulence","feTurbulence"],["foreignobject","foreignObject"],["glyphref","glyphRef"],["lineargradient","linearGradient"],["radialgradient","radialGradient"],["textpath","textPath"]]),t.attributeNames=new Map([["definitionurl","definitionURL"],["attributename","attributeName"],["attributetype","attributeType"],["basefrequency","baseFrequency"],["baseprofile","baseProfile"],["calcmode","calcMode"],["clippathunits","clipPathUnits"],["diffuseconstant","diffuseConstant"],["edgemode","edgeMode"],["filterunits","filterUnits"],["glyphref","glyphRef"],["gradienttransform","gradientTransform"],["gradientunits","gradientUnits"],["kernelmatrix","kernelMatrix"],["kernelunitlength","kernelUnitLength"],["keypoints","keyPoints"],["keysplines","keySplines"],["keytimes","keyTimes"],["lengthadjust","lengthAdjust"],["limitingconeangle","limitingConeAngle"],["markerheight","markerHeight"],["markerunits","markerUnits"],["markerwidth","markerWidth"],["maskcontentunits","maskContentUnits"],["maskunits","maskUnits"],["numoctaves","numOctaves"],["pathlength","pathLength"],["patterncontentunits","patternContentUnits"],["patterntransform","patternTransform"],["patternunits","patternUnits"],["pointsatx","pointsAtX"],["pointsaty","pointsAtY"],["pointsatz","pointsAtZ"],["preservealpha","preserveAlpha"],["preserveaspectratio","preserveAspectRatio"],["primitiveunits","primitiveUnits"],["refx","refX"],["refy","refY"],["repeatcount","repeatCount"],["repeatdur","repeatDur"],["requiredextensions","requiredExtensions"],["requiredfeatures","requiredFeatures"],["specularconstant","specularConstant"],["specularexponent","specularExponent"],["spreadmethod","spreadMethod"],["startoffset","startOffset"],["stddeviation","stdDeviation"],["stitchtiles","stitchTiles"],["surfacescale","surfaceScale"],["systemlanguage","systemLanguage"],["tablevalues","tableValues"],["targetx","targetX"],["targety","targetY"],["textlength","textLength"],["viewbox","viewBox"],["viewtarget","viewTarget"],["xchannelselector","xChannelSelector"],["ychannelselector","yChannelSelector"],["zoomandpan","zoomAndPan"]])},7220:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(9960)),c=r(5863),l=r(7837),u=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]),h=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function d(e,t){void 0===t&&(t={});for(var r=Array.isArray(e)||e.cheerio?e:[e],n="",i=0;i<r.length;i++)n+=p(r[i],t);return n}function p(e,t){switch(e.type){case a.Root:return d(e.children,t);case a.Directive:case a.Doctype:return"<"+e.data+">";case a.Comment:return"\x3c!--"+e.data+"--\x3e";case a.CDATA:return function(e){return"<![CDATA["+e.children[0].data+"]]>"}(e);case a.Script:case a.Style:case a.Tag:return function(e,t){var r;"foreign"===t.xmlMode&&(e.name=null!==(r=l.elementNames.get(e.name))&&void 0!==r?r:e.name,e.parent&&f.has(e.parent.name)&&(t=n(n({},t),{xmlMode:!1}))),!t.xmlMode&&g.has(e.name)&&(t=n(n({},t),{xmlMode:"foreign"}));var i="<"+e.name,s=function(e,t){if(e)return Object.keys(e).map((function(r){var n,i,s=null!==(n=e[r])&&void 0!==n?n:"";return"foreign"===t.xmlMode&&(r=null!==(i=l.attributeNames.get(r))&&void 0!==i?i:r),t.emptyAttrs||t.xmlMode||""!==s?r+'="'+(t.decodeEntities?c.encodeXML(s):s.replace(/"/g,"&quot;"))+'"':r})).join(" ")}(e.attribs,t);return s&&(i+=" "+s),0===e.children.length&&(t.xmlMode?!1!==t.selfClosingTags:t.selfClosingTags&&h.has(e.name))?(t.xmlMode||(i+=" "),i+="/>"):(i+=">",e.children.length>0&&(i+=d(e.children,t)),!t.xmlMode&&h.has(e.name)||(i+="</"+e.name+">")),i}(e,t);case a.Text:return function(e,t){var r=e.data||"";return!t.decodeEntities||e.parent&&u.has(e.parent.name)||(r=c.encodeXML(r)),r}(e,t)}}t.default=d;var f=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),g=new Set(["svg","math"])},9960:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Doctype=t.CDATA=t.Tag=t.Style=t.Script=t.Comment=t.Directive=t.Text=t.Root=t.isTag=t.ElementType=void 0,function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"}(r=t.ElementType||(t.ElementType={})),t.isTag=function(e){return e.type===r.Tag||e.type===r.Script||e.type===r.Style},t.Root=r.Root,t.Text=r.Text,t.Directive=r.Directive,t.Comment=r.Comment,t.Script=r.Script,t.Style=r.Style,t.Tag=r.Tag,t.CDATA=r.CDATA,t.Doctype=r.Doctype},7915:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.DomHandler=void 0;var s=r(9960),o=r(7790);i(r(7790),t);var a=/\s+/g,c={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1},l=function(){function e(e,t,r){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof t&&(r=t,t=c),"object"==typeof e&&(t=e,e=void 0),this.callback=null!=e?e:null,this.options=null!=t?t:c,this.elementCB=null!=r?r:null}return e.prototype.onparserinit=function(e){this.parser=e},e.prototype.onreset=function(){var e;this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null!==(e=this.parser)&&void 0!==e?e:null},e.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},e.prototype.onerror=function(e){this.handleCallback(e)},e.prototype.onclosetag=function(){this.lastNode=null;var e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)},e.prototype.onopentag=function(e,t){var r=this.options.xmlMode?s.ElementType.Tag:void 0,n=new o.Element(e,t,void 0,r);this.addNode(n),this.tagStack.push(n)},e.prototype.ontext=function(e){var t=this.options.normalizeWhitespace,r=this.lastNode;if(r&&r.type===s.ElementType.Text)t?r.data=(r.data+e).replace(a," "):r.data+=e;else{t&&(e=e.replace(a," "));var n=new o.Text(e);this.addNode(n),this.lastNode=n}},e.prototype.oncomment=function(e){if(this.lastNode&&this.lastNode.type===s.ElementType.Comment)this.lastNode.data+=e;else{var t=new o.Comment(e);this.addNode(t),this.lastNode=t}},e.prototype.oncommentend=function(){this.lastNode=null},e.prototype.oncdatastart=function(){var e=new o.Text(""),t=new o.NodeWithChildren(s.ElementType.CDATA,[e]);this.addNode(t),e.parent=t,this.lastNode=e},e.prototype.oncdataend=function(){this.lastNode=null},e.prototype.onprocessinginstruction=function(e,t){var r=new o.ProcessingInstruction(e,t);this.addNode(r)},e.prototype.handleCallback=function(e){if("function"==typeof this.callback)this.callback(e,this.dom);else if(e)throw e},e.prototype.addNode=function(e){var t=this.tagStack[this.tagStack.length-1],r=t.children[t.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),t.children.push(e),r&&(e.prev=r,r.next=e),e.parent=t,this.lastNode=null},e}();t.DomHandler=l,t.default=l},7790:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.cloneNode=t.Element=t.Document=t.NodeWithChildren=t.ProcessingInstruction=t.Comment=t.Text=t.DataNode=t.Node=void 0;var o=r(9960),a=new Map([[o.ElementType.Tag,1],[o.ElementType.Script,1],[o.ElementType.Style,1],[o.ElementType.Directive,1],[o.ElementType.Text,3],[o.ElementType.CDATA,4],[o.ElementType.Comment,8],[o.ElementType.Root,9]]),c=function(){function e(e){this.type=e,this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(e.prototype,"nodeType",{get:function(){var e;return null!==(e=a.get(this.type))&&void 0!==e?e:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(e){return void 0===e&&(e=!1),m(this,e)},e}();t.Node=c;var l=function(e){function t(t,r){var n=e.call(this,t)||this;return n.data=r,n}return i(t,e),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.data},set:function(e){this.data=e},enumerable:!1,configurable:!0}),t}(c);t.DataNode=l;var u=function(e){function t(t){return e.call(this,o.ElementType.Text,t)||this}return i(t,e),t}(l);t.Text=u;var h=function(e){function t(t){return e.call(this,o.ElementType.Comment,t)||this}return i(t,e),t}(l);t.Comment=h;var d=function(e){function t(t,r){var n=e.call(this,o.ElementType.Directive,r)||this;return n.name=t,n}return i(t,e),t}(l);t.ProcessingInstruction=d;var p=function(e){function t(t,r){var n=e.call(this,t)||this;return n.children=r,n}return i(t,e),Object.defineProperty(t.prototype,"firstChild",{get:function(){var e;return null!==(e=this.children[0])&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.children},set:function(e){this.children=e},enumerable:!1,configurable:!0}),t}(c);t.NodeWithChildren=p;var f=function(e){function t(t){return e.call(this,o.ElementType.Root,t)||this}return i(t,e),t}(p);t.Document=f;var g=function(e){function t(t,r,n,i){void 0===n&&(n=[]),void 0===i&&(i="script"===t?o.ElementType.Script:"style"===t?o.ElementType.Style:o.ElementType.Tag);var s=e.call(this,i,n)||this;return s.name=t,s.attribs=r,s}return i(t,e),Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name},set:function(e){this.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){var e=this;return Object.keys(this.attribs).map((function(t){var r,n;return{name:t,value:e.attribs[t],namespace:null===(r=e["x-attribsNamespace"])||void 0===r?void 0:r[t],prefix:null===(n=e["x-attribsPrefix"])||void 0===n?void 0:n[t]}}))},enumerable:!1,configurable:!0}),t}(p);function m(e,t){var r;switch(void 0===t&&(t=!1),e.type){case o.ElementType.Text:r=new u(e.data);break;case o.ElementType.Directive:var n=e;r=new d(n.name,n.data),null!=n["x-name"]&&(r["x-name"]=n["x-name"],r["x-publicId"]=n["x-publicId"],r["x-systemId"]=n["x-systemId"]);break;case o.ElementType.Comment:r=new h(e.data);break;case o.ElementType.Tag:case o.ElementType.Script:case o.ElementType.Style:var i=e,a=t?y(i.children):[],c=new g(i.name,s({},i.attribs),a);a.forEach((function(e){return e.parent=c})),i["x-attribsNamespace"]&&(c["x-attribsNamespace"]=s({},i["x-attribsNamespace"])),i["x-attribsPrefix"]&&(c["x-attribsPrefix"]=s({},i["x-attribsPrefix"])),r=c;break;case o.ElementType.CDATA:a=t?y(e.children):[];var l=new p(e.type,a);a.forEach((function(e){return e.parent=l})),r=l;break;case o.ElementType.Root:var m=e,v=(a=t?y(m.children):[],new f(a));a.forEach((function(e){return e.parent=v})),m["x-mode"]&&(v["x-mode"]=m["x-mode"]),r=v;break;case o.ElementType.Doctype:throw new Error("Not implemented yet: ElementType.Doctype case")}return r.startIndex=e.startIndex,r.endIndex=e.endIndex,r}function y(e){for(var t=e.map((function(e){return m(e,!0)})),r=1;r<t.length;r++)t[r].prev=t[r-1],t[r-1].next=t[r];return t}t.Element=g,t.cloneNode=m},4975:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniqueSort=t.compareDocumentPosition=t.removeSubsets=void 0;var n=r(7611);function i(e,t){var r=[],i=[];if(e===t)return 0;for(var s=n.hasChildren(e)?e:e.parent;s;)r.unshift(s),s=s.parent;for(s=n.hasChildren(t)?t:t.parent;s;)i.unshift(s),s=s.parent;for(var o=Math.min(r.length,i.length),a=0;a<o&&r[a]===i[a];)a++;if(0===a)return 1;var c=r[a-1],l=c.children,u=r[a],h=i[a];return l.indexOf(u)>l.indexOf(h)?c===t?20:4:c===e?10:2}t.removeSubsets=function(e){for(var t=e.length;--t>=0;){var r=e[t];if(t>0&&e.lastIndexOf(r,t-1)>=0)e.splice(t,1);else for(var n=r.parent;n;n=n.parent)if(e.includes(n)){e.splice(t,1);break}}return e},t.compareDocumentPosition=i,t.uniqueSort=function(e){return(e=e.filter((function(e,t,r){return!r.includes(e,t+1)}))).sort((function(e,t){var r=i(e,t);return 2&r?-1:4&r?1:0})),e}},9432:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3346),t),i(r(5010),t),i(r(6765),t),i(r(8043),t),i(r(3905),t),i(r(4975),t),i(r(7611),t)},3905:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementsByTagType=t.getElementsByTagName=t.getElementById=t.getElements=t.testElement=void 0;var n=r(8043),i=r(7611),s={tag_name:function(e){return"function"==typeof e?function(t){return i.isTag(t)&&e(t.name)}:"*"===e?i.isTag:function(t){return i.isTag(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return i.isText(t)&&e(t.data)}:function(t){return i.isText(t)&&t.data===e}}};function o(e,t){return"function"==typeof t?function(r){return i.isTag(r)&&t(r.attribs[e])}:function(r){return i.isTag(r)&&r.attribs[e]===t}}function a(e,t){return function(r){return e(r)||t(r)}}function c(e){var t=Object.keys(e).map((function(t){var r=e[t];return t in s?s[t](r):o(t,r)}));return 0===t.length?null:t.reduce(a)}t.testElement=function(e,t){var r=c(e);return!r||r(t)},t.getElements=function(e,t,r,i){void 0===i&&(i=1/0);var s=c(e);return s?n.filter(s,t,r,i):[]},t.getElementById=function(e,t,r){return void 0===r&&(r=!0),Array.isArray(t)||(t=[t]),n.findOne(o("id",e),t,r)},t.getElementsByTagName=function(e,t,r,i){return void 0===r&&(r=!0),void 0===i&&(i=1/0),n.filter(s.tag_name(e),t,r,i)},t.getElementsByTagType=function(e,t,r,i){return void 0===r&&(r=!0),void 0===i&&(i=1/0),n.filter(s.tag_type(e),t,r,i)}},6765:(e,t)=>{"use strict";function r(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}}Object.defineProperty(t,"__esModule",{value:!0}),t.prepend=t.prependChild=t.append=t.appendChild=t.replaceElement=t.removeElement=void 0,t.removeElement=r,t.replaceElement=function(e,t){var r=t.prev=e.prev;r&&(r.next=t);var n=t.next=e.next;n&&(n.prev=t);var i=t.parent=e.parent;if(i){var s=i.children;s[s.lastIndexOf(e)]=t}},t.appendChild=function(e,t){if(r(t),t.next=null,t.parent=e,e.children.push(t)>1){var n=e.children[e.children.length-2];n.next=t,t.prev=n}else t.prev=null},t.append=function(e,t){r(t);var n=e.parent,i=e.next;if(t.next=i,t.prev=e,e.next=t,t.parent=n,i){if(i.prev=t,n){var s=n.children;s.splice(s.lastIndexOf(i),0,t)}}else n&&n.children.push(t)},t.prependChild=function(e,t){if(r(t),t.parent=e,t.prev=null,1!==e.children.unshift(t)){var n=e.children[1];n.prev=t,t.next=n}else t.next=null},t.prepend=function(e,t){r(t);var n=e.parent;if(n){var i=n.children;i.splice(i.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=n,t.prev=e.prev,t.next=e,e.prev=t}},8043:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=t.existsOne=t.findOne=t.findOneChild=t.find=t.filter=void 0;var n=r(7611);function i(e,t,r,s){for(var o=[],a=0,c=t;a<c.length;a++){var l=c[a];if(e(l)&&(o.push(l),--s<=0))break;if(r&&n.hasChildren(l)&&l.children.length>0){var u=i(e,l.children,r,s);if(o.push.apply(o,u),(s-=u.length)<=0)break}}return o}t.filter=function(e,t,r,n){return void 0===r&&(r=!0),void 0===n&&(n=1/0),Array.isArray(t)||(t=[t]),i(e,t,r,n)},t.find=i,t.findOneChild=function(e,t){return t.find(e)},t.findOne=function e(t,r,i){void 0===i&&(i=!0);for(var s=null,o=0;o<r.length&&!s;o++){var a=r[o];n.isTag(a)&&(t(a)?s=a:i&&a.children.length>0&&(s=e(t,a.children)))}return s},t.existsOne=function e(t,r){return r.some((function(r){return n.isTag(r)&&(t(r)||r.children.length>0&&e(t,r.children))}))},t.findAll=function(e,t){for(var r,i,s=[],o=t.filter(n.isTag);i=o.shift();){var a=null===(r=i.children)||void 0===r?void 0:r.filter(n.isTag);a&&a.length>0&&o.unshift.apply(o,a),e(i)&&s.push(i)}return s}},3346:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getText=t.getInnerHTML=t.getOuterHTML=void 0;var i=r(7611),s=n(r(7220));function o(e,t){return s.default(e,t)}t.getOuterHTML=o,t.getInnerHTML=function(e,t){return i.hasChildren(e)?e.children.map((function(e){return o(e,t)})).join(""):""},t.getText=function e(t){return Array.isArray(t)?t.map(e).join(""):i.isTag(t)?"br"===t.name?"\n":e(t.children):i.isCDATA(t)?e(t.children):i.isText(t)?t.data:""}},7611:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasChildren=t.isComment=t.isText=t.isCDATA=t.isTag=void 0;var n=r(9960);t.isTag=function(e){return n.isTag(e)},t.isCDATA=function(e){return e.type===n.ElementType.CDATA},t.isText=function(e){return e.type===n.ElementType.Text},t.isComment=function(e){return e.type===n.ElementType.Comment},t.hasChildren=function(e){return Object.prototype.hasOwnProperty.call(e,"children")}},5010:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prevElementSibling=t.nextElementSibling=t.getName=t.hasAttrib=t.getAttributeValue=t.getSiblings=t.getParent=t.getChildren=void 0;var n=r(7611),i=[];function s(e){var t;return null!==(t=e.children)&&void 0!==t?t:i}function o(e){return e.parent||null}t.getChildren=s,t.getParent=o,t.getSiblings=function(e){var t=o(e);if(null!=t)return s(t);for(var r=[e],n=e.prev,i=e.next;null!=n;)r.unshift(n),n=n.prev;for(;null!=i;)r.push(i),i=i.next;return r},t.getAttributeValue=function(e,t){var r;return null===(r=e.attribs)||void 0===r?void 0:r[t]},t.hasAttrib=function(e,t){return null!=e.attribs&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&null!=e.attribs[t]},t.getName=function(e){return e.name},t.nextElementSibling=function(e){for(var t=e.next;null!==t&&!n.isTag(t);)t=t.next;return t},t.prevElementSibling=function(e){for(var t=e.prev;null!==t&&!n.isTag(t);)t=t.prev;return t}},4076:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeHTML=t.decodeHTMLStrict=t.decodeXML=void 0;var i=n(r(4007)),s=n(r(7802)),o=n(r(2228)),a=n(r(26));function c(e){var t=Object.keys(e).join("|"),r=u(e),n=new RegExp("&(?:"+(t+="|#[xX][\\da-fA-F]+|#\\d+")+");","g");return function(e){return String(e).replace(n,r)}}t.decodeXML=c(o.default),t.decodeHTMLStrict=c(i.default);var l=function(e,t){return e<t?1:-1};function u(e){return function(t){if("#"===t.charAt(1)){var r=t.charAt(2);return"X"===r||"x"===r?a.default(parseInt(t.substr(3),16)):a.default(parseInt(t.substr(2),10))}return e[t.slice(1,-1)]}}t.decodeHTML=function(){for(var e=Object.keys(s.default).sort(l),t=Object.keys(i.default).sort(l),r=0,n=0;r<t.length;r++)e[n]===t[r]?(t[r]+=";?",n++):t[r]+=";";var o=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=u(i.default);function c(e){return";"!==e.substr(-1)&&(e+=";"),a(e)}return function(e){return String(e).replace(o,c)}}()},26:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(4589));t.default=function(e){if(e>=55296&&e<=57343||e>1114111)return"";e in i.default&&(e=i.default[e]);var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},7322:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.escape=t.encodeHTML=t.encodeXML=void 0;var i=c(n(r(2228)).default),s=l(i);t.encodeXML=d(i,s);var o=c(n(r(4007)).default),a=l(o);function c(e){return Object.keys(e).sort().reduce((function(t,r){return t[e[r]]="&"+r+";",t}),{})}function l(e){for(var t=[],r=[],n=0,i=Object.keys(e);n<i.length;n++){var s=i[n];1===s.length?t.push("\\"+s):r.push(s)}t.sort();for(var o=0;o<t.length-1;o++){for(var a=o;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var c=1+a-o;c<3||t.splice(o,c,t[o]+"-"+t[a])}return r.unshift("["+t.join("")+"]"),new RegExp(r.join("|"),"g")}t.encodeHTML=d(o,a);var u=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g;function h(e){return"&#x"+e.codePointAt(0).toString(16).toUpperCase()+";"}function d(e,t){return function(r){return r.replace(t,(function(t){return e[t]})).replace(u,h)}}var p=l(i);t.escape=function(e){return e.replace(p,h).replace(u,h)}},5863:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decodeStrict=t.decode=void 0;var n=r(4076),i=r(7322);t.decode=function(e,t){return(!t||t<=0?n.decodeXML:n.decodeHTML)(e)},t.decodeStrict=function(e,t){return(!t||t<=0?n.decodeXML:n.decodeHTMLStrict)(e)},t.encode=function(e,t){return(!t||t<=0?i.encodeXML:i.encodeHTML)(e)};var s=r(7322);Object.defineProperty(t,"encodeXML",{enumerable:!0,get:function(){return s.encodeXML}}),Object.defineProperty(t,"encodeHTML",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"escape",{enumerable:!0,get:function(){return s.escape}}),Object.defineProperty(t,"encodeHTML4",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"encodeHTML5",{enumerable:!0,get:function(){return s.encodeHTML}});var o=r(4076);Object.defineProperty(t,"decodeXML",{enumerable:!0,get:function(){return o.decodeXML}}),Object.defineProperty(t,"decodeHTML",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTMLStrict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML4",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML5",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML4Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML5Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeXMLStrict",{enumerable:!0,get:function(){return o.decodeXML}})},4589:e=>{"use strict";e.exports=JSON.parse('{"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}')},4007:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"","aacute":"","Abreve":"","abreve":"","ac":"","acd":"","acE":"","Acirc":"","acirc":"","acute":"","Acy":"","acy":"","AElig":"","aelig":"","af":"","Afr":"","afr":"","Agrave":"","agrave":"","alefsym":"","aleph":"","Alpha":"","alpha":"","Amacr":"","amacr":"","amalg":"","amp":"&","AMP":"&","andand":"","And":"","and":"","andd":"","andslope":"","andv":"","ang":"","ange":"","angle":"","angmsdaa":"","angmsdab":"","angmsdac":"","angmsdad":"","angmsdae":"","angmsdaf":"","angmsdag":"","angmsdah":"","angmsd":"","angrt":"","angrtvb":"","angrtvbd":"","angsph":"","angst":"","angzarr":"","Aogon":"","aogon":"","Aopf":"","aopf":"","apacir":"","ap":"","apE":"","ape":"","apid":"","apos":"\'","ApplyFunction":"","approx":"","approxeq":"","Aring":"","aring":"","Ascr":"","ascr":"","Assign":"","ast":"*","asymp":"","asympeq":"","Atilde":"","atilde":"","Auml":"","auml":"","awconint":"","awint":"","backcong":"","backepsilon":"","backprime":"","backsim":"","backsimeq":"","Backslash":"","Barv":"","barvee":"","barwed":"","Barwed":"","barwedge":"","bbrk":"","bbrktbrk":"","bcong":"","Bcy":"","bcy":"","bdquo":"","becaus":"","because":"","Because":"","bemptyv":"","bepsi":"","bernou":"","Bernoullis":"","Beta":"","beta":"","beth":"","between":"","Bfr":"","bfr":"","bigcap":"","bigcirc":"","bigcup":"","bigodot":"","bigoplus":"","bigotimes":"","bigsqcup":"","bigstar":"","bigtriangledown":"","bigtriangleup":"","biguplus":"","bigvee":"","bigwedge":"","bkarow":"","blacklozenge":"","blacksquare":"","blacktriangle":"","blacktriangledown":"","blacktriangleleft":"","blacktriangleright":"","blank":"","blk12":"","blk14":"","blk34":"","block":"","bne":"=","bnequiv":"","bNot":"","bnot":"","Bopf":"","bopf":"","bot":"","bottom":"","bowtie":"","boxbox":"","boxdl":"","boxdL":"","boxDl":"","boxDL":"","boxdr":"","boxdR":"","boxDr":"","boxDR":"","boxh":"","boxH":"","boxhd":"","boxHd":"","boxhD":"","boxHD":"","boxhu":"","boxHu":"","boxhU":"","boxHU":"","boxminus":"","boxplus":"","boxtimes":"","boxul":"","boxuL":"","boxUl":"","boxUL":"","boxur":"","boxuR":"","boxUr":"","boxUR":"","boxv":"","boxV":"","boxvh":"","boxvH":"","boxVh":"","boxVH":"","boxvl":"","boxvL":"","boxVl":"","boxVL":"","boxvr":"","boxvR":"","boxVr":"","boxVR":"","bprime":"","breve":"","Breve":"","brvbar":"","bscr":"","Bscr":"","bsemi":"","bsim":"","bsime":"","bsolb":"","bsol":"\\\\","bsolhsub":"","bull":"","bullet":"","bump":"","bumpE":"","bumpe":"","Bumpeq":"","bumpeq":"","Cacute":"","cacute":"","capand":"","capbrcup":"","capcap":"","cap":"","Cap":"","capcup":"","capdot":"","CapitalDifferentialD":"","caps":"","caret":"","caron":"","Cayleys":"","ccaps":"","Ccaron":"","ccaron":"","Ccedil":"","ccedil":"","Ccirc":"","ccirc":"","Cconint":"","ccups":"","ccupssm":"","Cdot":"","cdot":"","cedil":"","Cedilla":"","cemptyv":"","cent":"","centerdot":"","CenterDot":"","cfr":"","Cfr":"","CHcy":"","chcy":"","check":"","checkmark":"","Chi":"","chi":"","circ":"","circeq":"","circlearrowleft":"","circlearrowright":"","circledast":"","circledcirc":"","circleddash":"","CircleDot":"","circledR":"","circledS":"","CircleMinus":"","CirclePlus":"","CircleTimes":"","cir":"","cirE":"","cire":"","cirfnint":"","cirmid":"","cirscir":"","ClockwiseContourIntegral":"","CloseCurlyDoubleQuote":"","CloseCurlyQuote":"","clubs":"","clubsuit":"","colon":":","Colon":"","Colone":"","colone":"","coloneq":"","comma":",","commat":"@","comp":"","compfn":"","complement":"","complexes":"","cong":"","congdot":"","Congruent":"","conint":"","Conint":"","ContourIntegral":"","copf":"","Copf":"","coprod":"","Coproduct":"","copy":"","COPY":"","copysr":"","CounterClockwiseContourIntegral":"","crarr":"","cross":"","Cross":"","Cscr":"","cscr":"","csub":"","csube":"","csup":"","csupe":"","ctdot":"","cudarrl":"","cudarrr":"","cuepr":"","cuesc":"","cularr":"","cularrp":"","cupbrcap":"","cupcap":"","CupCap":"","cup":"","Cup":"","cupcup":"","cupdot":"","cupor":"","cups":"","curarr":"","curarrm":"","curlyeqprec":"","curlyeqsucc":"","curlyvee":"","curlywedge":"","curren":"","curvearrowleft":"","curvearrowright":"","cuvee":"","cuwed":"","cwconint":"","cwint":"","cylcty":"","dagger":"","Dagger":"","daleth":"","darr":"","Darr":"","dArr":"","dash":"","Dashv":"","dashv":"","dbkarow":"","dblac":"","Dcaron":"","dcaron":"","Dcy":"","dcy":"","ddagger":"","ddarr":"","DD":"","dd":"","DDotrahd":"","ddotseq":"","deg":"","Del":"","Delta":"","delta":"","demptyv":"","dfisht":"","Dfr":"","dfr":"","dHar":"","dharl":"","dharr":"","DiacriticalAcute":"","DiacriticalDot":"","DiacriticalDoubleAcute":"","DiacriticalGrave":"`","DiacriticalTilde":"","diam":"","diamond":"","Diamond":"","diamondsuit":"","diams":"","die":"","DifferentialD":"","digamma":"","disin":"","div":"","divide":"","divideontimes":"","divonx":"","DJcy":"","djcy":"","dlcorn":"","dlcrop":"","dollar":"$","Dopf":"","dopf":"","Dot":"","dot":"","DotDot":"","doteq":"","doteqdot":"","DotEqual":"","dotminus":"","dotplus":"","dotsquare":"","doublebarwedge":"","DoubleContourIntegral":"","DoubleDot":"","DoubleDownArrow":"","DoubleLeftArrow":"","DoubleLeftRightArrow":"","DoubleLeftTee":"","DoubleLongLeftArrow":"","DoubleLongLeftRightArrow":"","DoubleLongRightArrow":"","DoubleRightArrow":"","DoubleRightTee":"","DoubleUpArrow":"","DoubleUpDownArrow":"","DoubleVerticalBar":"","DownArrowBar":"","downarrow":"","DownArrow":"","Downarrow":"","DownArrowUpArrow":"","DownBreve":"","downdownarrows":"","downharpoonleft":"","downharpoonright":"","DownLeftRightVector":"","DownLeftTeeVector":"","DownLeftVectorBar":"","DownLeftVector":"","DownRightTeeVector":"","DownRightVectorBar":"","DownRightVector":"","DownTeeArrow":"","DownTee":"","drbkarow":"","drcorn":"","drcrop":"","Dscr":"","dscr":"","DScy":"","dscy":"","dsol":"","Dstrok":"","dstrok":"","dtdot":"","dtri":"","dtrif":"","duarr":"","duhar":"","dwangle":"","DZcy":"","dzcy":"","dzigrarr":"","Eacute":"","eacute":"","easter":"","Ecaron":"","ecaron":"","Ecirc":"","ecirc":"","ecir":"","ecolon":"","Ecy":"","ecy":"","eDDot":"","Edot":"","edot":"","eDot":"","ee":"","efDot":"","Efr":"","efr":"","eg":"","Egrave":"","egrave":"","egs":"","egsdot":"","el":"","Element":"","elinters":"","ell":"","els":"","elsdot":"","Emacr":"","emacr":"","empty":"","emptyset":"","EmptySmallSquare":"","emptyv":"","EmptyVerySmallSquare":"","emsp13":"","emsp14":"","emsp":"","ENG":"","eng":"","ensp":"","Eogon":"","eogon":"","Eopf":"","eopf":"","epar":"","eparsl":"","eplus":"","epsi":"","Epsilon":"","epsilon":"","epsiv":"","eqcirc":"","eqcolon":"","eqsim":"","eqslantgtr":"","eqslantless":"","Equal":"","equals":"=","EqualTilde":"","equest":"","Equilibrium":"","equiv":"","equivDD":"","eqvparsl":"","erarr":"","erDot":"","escr":"","Escr":"","esdot":"","Esim":"","esim":"","Eta":"","eta":"","ETH":"","eth":"","Euml":"","euml":"","euro":"","excl":"!","exist":"","Exists":"","expectation":"","exponentiale":"","ExponentialE":"","fallingdotseq":"","Fcy":"","fcy":"","female":"","ffilig":"","fflig":"","ffllig":"","Ffr":"","ffr":"","filig":"","FilledSmallSquare":"","FilledVerySmallSquare":"","fjlig":"fj","flat":"","fllig":"","fltns":"","fnof":"","Fopf":"","fopf":"","forall":"","ForAll":"","fork":"","forkv":"","Fouriertrf":"","fpartint":"","frac12":"","frac13":"","frac14":"","frac15":"","frac16":"","frac18":"","frac23":"","frac25":"","frac34":"","frac35":"","frac38":"","frac45":"","frac56":"","frac58":"","frac78":"","frasl":"","frown":"","fscr":"","Fscr":"","gacute":"","Gamma":"","gamma":"","Gammad":"","gammad":"","gap":"","Gbreve":"","gbreve":"","Gcedil":"","Gcirc":"","gcirc":"","Gcy":"","gcy":"","Gdot":"","gdot":"","ge":"","gE":"","gEl":"","gel":"","geq":"","geqq":"","geqslant":"","gescc":"","ges":"","gesdot":"","gesdoto":"","gesdotol":"","gesl":"","gesles":"","Gfr":"","gfr":"","gg":"","Gg":"","ggg":"","gimel":"","GJcy":"","gjcy":"","gla":"","gl":"","glE":"","glj":"","gnap":"","gnapprox":"","gne":"","gnE":"","gneq":"","gneqq":"","gnsim":"","Gopf":"","gopf":"","grave":"`","GreaterEqual":"","GreaterEqualLess":"","GreaterFullEqual":"","GreaterGreater":"","GreaterLess":"","GreaterSlantEqual":"","GreaterTilde":"","Gscr":"","gscr":"","gsim":"","gsime":"","gsiml":"","gtcc":"","gtcir":"","gt":">","GT":">","Gt":"","gtdot":"","gtlPar":"","gtquest":"","gtrapprox":"","gtrarr":"","gtrdot":"","gtreqless":"","gtreqqless":"","gtrless":"","gtrsim":"","gvertneqq":"","gvnE":"","Hacek":"","hairsp":"","half":"","hamilt":"","HARDcy":"","hardcy":"","harrcir":"","harr":"","hArr":"","harrw":"","Hat":"^","hbar":"","Hcirc":"","hcirc":"","hearts":"","heartsuit":"","hellip":"","hercon":"","hfr":"","Hfr":"","HilbertSpace":"","hksearow":"","hkswarow":"","hoarr":"","homtht":"","hookleftarrow":"","hookrightarrow":"","hopf":"","Hopf":"","horbar":"","HorizontalLine":"","hscr":"","Hscr":"","hslash":"","Hstrok":"","hstrok":"","HumpDownHump":"","HumpEqual":"","hybull":"","hyphen":"","Iacute":"","iacute":"","ic":"","Icirc":"","icirc":"","Icy":"","icy":"","Idot":"","IEcy":"","iecy":"","iexcl":"","iff":"","ifr":"","Ifr":"","Igrave":"","igrave":"","ii":"","iiiint":"","iiint":"","iinfin":"","iiota":"","IJlig":"","ijlig":"","Imacr":"","imacr":"","image":"","ImaginaryI":"","imagline":"","imagpart":"","imath":"","Im":"","imof":"","imped":"","Implies":"","incare":"","in":"","infin":"","infintie":"","inodot":"","intcal":"","int":"","Int":"","integers":"","Integral":"","intercal":"","Intersection":"","intlarhk":"","intprod":"","InvisibleComma":"","InvisibleTimes":"","IOcy":"","iocy":"","Iogon":"","iogon":"","Iopf":"","iopf":"","Iota":"","iota":"","iprod":"","iquest":"","iscr":"","Iscr":"","isin":"","isindot":"","isinE":"","isins":"","isinsv":"","isinv":"","it":"","Itilde":"","itilde":"","Iukcy":"","iukcy":"","Iuml":"","iuml":"","Jcirc":"","jcirc":"","Jcy":"","jcy":"","Jfr":"","jfr":"","jmath":"","Jopf":"","jopf":"","Jscr":"","jscr":"","Jsercy":"","jsercy":"","Jukcy":"","jukcy":"","Kappa":"","kappa":"","kappav":"","Kcedil":"","kcedil":"","Kcy":"","kcy":"","Kfr":"","kfr":"","kgreen":"","KHcy":"","khcy":"","KJcy":"","kjcy":"","Kopf":"","kopf":"","Kscr":"","kscr":"","lAarr":"","Lacute":"","lacute":"","laemptyv":"","lagran":"","Lambda":"","lambda":"","lang":"","Lang":"","langd":"","langle":"","lap":"","Laplacetrf":"","laquo":"","larrb":"","larrbfs":"","larr":"","Larr":"","lArr":"","larrfs":"","larrhk":"","larrlp":"","larrpl":"","larrsim":"","larrtl":"","latail":"","lAtail":"","lat":"","late":"","lates":"","lbarr":"","lBarr":"","lbbrk":"","lbrace":"{","lbrack":"[","lbrke":"","lbrksld":"","lbrkslu":"","Lcaron":"","lcaron":"","Lcedil":"","lcedil":"","lceil":"","lcub":"{","Lcy":"","lcy":"","ldca":"","ldquo":"","ldquor":"","ldrdhar":"","ldrushar":"","ldsh":"","le":"","lE":"","LeftAngleBracket":"","LeftArrowBar":"","leftarrow":"","LeftArrow":"","Leftarrow":"","LeftArrowRightArrow":"","leftarrowtail":"","LeftCeiling":"","LeftDoubleBracket":"","LeftDownTeeVector":"","LeftDownVectorBar":"","LeftDownVector":"","LeftFloor":"","leftharpoondown":"","leftharpoonup":"","leftleftarrows":"","leftrightarrow":"","LeftRightArrow":"","Leftrightarrow":"","leftrightarrows":"","leftrightharpoons":"","leftrightsquigarrow":"","LeftRightVector":"","LeftTeeArrow":"","LeftTee":"","LeftTeeVector":"","leftthreetimes":"","LeftTriangleBar":"","LeftTriangle":"","LeftTriangleEqual":"","LeftUpDownVector":"","LeftUpTeeVector":"","LeftUpVectorBar":"","LeftUpVector":"","LeftVectorBar":"","LeftVector":"","lEg":"","leg":"","leq":"","leqq":"","leqslant":"","lescc":"","les":"","lesdot":"","lesdoto":"","lesdotor":"","lesg":"","lesges":"","lessapprox":"","lessdot":"","lesseqgtr":"","lesseqqgtr":"","LessEqualGreater":"","LessFullEqual":"","LessGreater":"","lessgtr":"","LessLess":"","lesssim":"","LessSlantEqual":"","LessTilde":"","lfisht":"","lfloor":"","Lfr":"","lfr":"","lg":"","lgE":"","lHar":"","lhard":"","lharu":"","lharul":"","lhblk":"","LJcy":"","ljcy":"","llarr":"","ll":"","Ll":"","llcorner":"","Lleftarrow":"","llhard":"","lltri":"","Lmidot":"","lmidot":"","lmoustache":"","lmoust":"","lnap":"","lnapprox":"","lne":"","lnE":"","lneq":"","lneqq":"","lnsim":"","loang":"","loarr":"","lobrk":"","longleftarrow":"","LongLeftArrow":"","Longleftarrow":"","longleftrightarrow":"","LongLeftRightArrow":"","Longleftrightarrow":"","longmapsto":"","longrightarrow":"","LongRightArrow":"","Longrightarrow":"","looparrowleft":"","looparrowright":"","lopar":"","Lopf":"","lopf":"","loplus":"","lotimes":"","lowast":"","lowbar":"_","LowerLeftArrow":"","LowerRightArrow":"","loz":"","lozenge":"","lozf":"","lpar":"(","lparlt":"","lrarr":"","lrcorner":"","lrhar":"","lrhard":"","lrm":"","lrtri":"","lsaquo":"","lscr":"","Lscr":"","lsh":"","Lsh":"","lsim":"","lsime":"","lsimg":"","lsqb":"[","lsquo":"","lsquor":"","Lstrok":"","lstrok":"","ltcc":"","ltcir":"","lt":"<","LT":"<","Lt":"","ltdot":"","lthree":"","ltimes":"","ltlarr":"","ltquest":"","ltri":"","ltrie":"","ltrif":"","ltrPar":"","lurdshar":"","luruhar":"","lvertneqq":"","lvnE":"","macr":"","male":"","malt":"","maltese":"","Map":"","map":"","mapsto":"","mapstodown":"","mapstoleft":"","mapstoup":"","marker":"","mcomma":"","Mcy":"","mcy":"","mdash":"","mDDot":"","measuredangle":"","MediumSpace":"","Mellintrf":"","Mfr":"","mfr":"","mho":"","micro":"","midast":"*","midcir":"","mid":"","middot":"","minusb":"","minus":"","minusd":"","minusdu":"","MinusPlus":"","mlcp":"","mldr":"","mnplus":"","models":"","Mopf":"","mopf":"","mp":"","mscr":"","Mscr":"","mstpos":"","Mu":"","mu":"","multimap":"","mumap":"","nabla":"","Nacute":"","nacute":"","nang":"","nap":"","napE":"","napid":"","napos":"","napprox":"","natural":"","naturals":"","natur":"","nbsp":"","nbump":"","nbumpe":"","ncap":"","Ncaron":"","ncaron":"","Ncedil":"","ncedil":"","ncong":"","ncongdot":"","ncup":"","Ncy":"","ncy":"","ndash":"","nearhk":"","nearr":"","neArr":"","nearrow":"","ne":"","nedot":"","NegativeMediumSpace":"","NegativeThickSpace":"","NegativeThinSpace":"","NegativeVeryThinSpace":"","nequiv":"","nesear":"","nesim":"","NestedGreaterGreater":"","NestedLessLess":"","NewLine":"\\n","nexist":"","nexists":"","Nfr":"","nfr":"","ngE":"","nge":"","ngeq":"","ngeqq":"","ngeqslant":"","nges":"","nGg":"","ngsim":"","nGt":"","ngt":"","ngtr":"","nGtv":"","nharr":"","nhArr":"","nhpar":"","ni":"","nis":"","nisd":"","niv":"","NJcy":"","njcy":"","nlarr":"","nlArr":"","nldr":"","nlE":"","nle":"","nleftarrow":"","nLeftarrow":"","nleftrightarrow":"","nLeftrightarrow":"","nleq":"","nleqq":"","nleqslant":"","nles":"","nless":"","nLl":"","nlsim":"","nLt":"","nlt":"","nltri":"","nltrie":"","nLtv":"","nmid":"","NoBreak":"","NonBreakingSpace":"","nopf":"","Nopf":"","Not":"","not":"","NotCongruent":"","NotCupCap":"","NotDoubleVerticalBar":"","NotElement":"","NotEqual":"","NotEqualTilde":"","NotExists":"","NotGreater":"","NotGreaterEqual":"","NotGreaterFullEqual":"","NotGreaterGreater":"","NotGreaterLess":"","NotGreaterSlantEqual":"","NotGreaterTilde":"","NotHumpDownHump":"","NotHumpEqual":"","notin":"","notindot":"","notinE":"","notinva":"","notinvb":"","notinvc":"","NotLeftTriangleBar":"","NotLeftTriangle":"","NotLeftTriangleEqual":"","NotLess":"","NotLessEqual":"","NotLessGreater":"","NotLessLess":"","NotLessSlantEqual":"","NotLessTilde":"","NotNestedGreaterGreater":"","NotNestedLessLess":"","notni":"","notniva":"","notnivb":"","notnivc":"","NotPrecedes":"","NotPrecedesEqual":"","NotPrecedesSlantEqual":"","NotReverseElement":"","NotRightTriangleBar":"","NotRightTriangle":"","NotRightTriangleEqual":"","NotSquareSubset":"","NotSquareSubsetEqual":"","NotSquareSuperset":"","NotSquareSupersetEqual":"","NotSubset":"","NotSubsetEqual":"","NotSucceeds":"","NotSucceedsEqual":"","NotSucceedsSlantEqual":"","NotSucceedsTilde":"","NotSuperset":"","NotSupersetEqual":"","NotTilde":"","NotTildeEqual":"","NotTildeFullEqual":"","NotTildeTilde":"","NotVerticalBar":"","nparallel":"","npar":"","nparsl":"","npart":"","npolint":"","npr":"","nprcue":"","nprec":"","npreceq":"","npre":"","nrarrc":"","nrarr":"","nrArr":"","nrarrw":"","nrightarrow":"","nRightarrow":"","nrtri":"","nrtrie":"","nsc":"","nsccue":"","nsce":"","Nscr":"","nscr":"","nshortmid":"","nshortparallel":"","nsim":"","nsime":"","nsimeq":"","nsmid":"","nspar":"","nsqsube":"","nsqsupe":"","nsub":"","nsubE":"","nsube":"","nsubset":"","nsubseteq":"","nsubseteqq":"","nsucc":"","nsucceq":"","nsup":"","nsupE":"","nsupe":"","nsupset":"","nsupseteq":"","nsupseteqq":"","ntgl":"","Ntilde":"","ntilde":"","ntlg":"","ntriangleleft":"","ntrianglelefteq":"","ntriangleright":"","ntrianglerighteq":"","Nu":"","nu":"","num":"#","numero":"","numsp":"","nvap":"","nvdash":"","nvDash":"","nVdash":"","nVDash":"","nvge":"","nvgt":">","nvHarr":"","nvinfin":"","nvlArr":"","nvle":"","nvlt":"<","nvltrie":"","nvrArr":"","nvrtrie":"","nvsim":"","nwarhk":"","nwarr":"","nwArr":"","nwarrow":"","nwnear":"","Oacute":"","oacute":"","oast":"","Ocirc":"","ocirc":"","ocir":"","Ocy":"","ocy":"","odash":"","Odblac":"","odblac":"","odiv":"","odot":"","odsold":"","OElig":"","oelig":"","ofcir":"","Ofr":"","ofr":"","ogon":"","Ograve":"","ograve":"","ogt":"","ohbar":"","ohm":"","oint":"","olarr":"","olcir":"","olcross":"","oline":"","olt":"","Omacr":"","omacr":"","Omega":"","omega":"","Omicron":"","omicron":"","omid":"","ominus":"","Oopf":"","oopf":"","opar":"","OpenCurlyDoubleQuote":"","OpenCurlyQuote":"","operp":"","oplus":"","orarr":"","Or":"","or":"","ord":"","order":"","orderof":"","ordf":"","ordm":"","origof":"","oror":"","orslope":"","orv":"","oS":"","Oscr":"","oscr":"","Oslash":"","oslash":"","osol":"","Otilde":"","otilde":"","otimesas":"","Otimes":"","otimes":"","Ouml":"","ouml":"","ovbar":"","OverBar":"","OverBrace":"","OverBracket":"","OverParenthesis":"","para":"","parallel":"","par":"","parsim":"","parsl":"","part":"","PartialD":"","Pcy":"","pcy":"","percnt":"%","period":".","permil":"","perp":"","pertenk":"","Pfr":"","pfr":"","Phi":"","phi":"","phiv":"","phmmat":"","phone":"","Pi":"","pi":"","pitchfork":"","piv":"","planck":"","planckh":"","plankv":"","plusacir":"","plusb":"","pluscir":"","plus":"+","plusdo":"","plusdu":"","pluse":"","PlusMinus":"","plusmn":"","plussim":"","plustwo":"","pm":"","Poincareplane":"","pointint":"","popf":"","Popf":"","pound":"","prap":"","Pr":"","pr":"","prcue":"","precapprox":"","prec":"","preccurlyeq":"","Precedes":"","PrecedesEqual":"","PrecedesSlantEqual":"","PrecedesTilde":"","preceq":"","precnapprox":"","precneqq":"","precnsim":"","pre":"","prE":"","precsim":"","prime":"","Prime":"","primes":"","prnap":"","prnE":"","prnsim":"","prod":"","Product":"","profalar":"","profline":"","profsurf":"","prop":"","Proportional":"","Proportion":"","propto":"","prsim":"","prurel":"","Pscr":"","pscr":"","Psi":"","psi":"","puncsp":"","Qfr":"","qfr":"","qint":"","qopf":"","Qopf":"","qprime":"","Qscr":"","qscr":"","quaternions":"","quatint":"","quest":"?","questeq":"","quot":"\\"","QUOT":"\\"","rAarr":"","race":"","Racute":"","racute":"","radic":"","raemptyv":"","rang":"","Rang":"","rangd":"","range":"","rangle":"","raquo":"","rarrap":"","rarrb":"","rarrbfs":"","rarrc":"","rarr":"","Rarr":"","rArr":"","rarrfs":"","rarrhk":"","rarrlp":"","rarrpl":"","rarrsim":"","Rarrtl":"","rarrtl":"","rarrw":"","ratail":"","rAtail":"","ratio":"","rationals":"","rbarr":"","rBarr":"","RBarr":"","rbbrk":"","rbrace":"}","rbrack":"]","rbrke":"","rbrksld":"","rbrkslu":"","Rcaron":"","rcaron":"","Rcedil":"","rcedil":"","rceil":"","rcub":"}","Rcy":"","rcy":"","rdca":"","rdldhar":"","rdquo":"","rdquor":"","rdsh":"","real":"","realine":"","realpart":"","reals":"","Re":"","rect":"","reg":"","REG":"","ReverseElement":"","ReverseEquilibrium":"","ReverseUpEquilibrium":"","rfisht":"","rfloor":"","rfr":"","Rfr":"","rHar":"","rhard":"","rharu":"","rharul":"","Rho":"","rho":"","rhov":"","RightAngleBracket":"","RightArrowBar":"","rightarrow":"","RightArrow":"","Rightarrow":"","RightArrowLeftArrow":"","rightarrowtail":"","RightCeiling":"","RightDoubleBracket":"","RightDownTeeVector":"","RightDownVectorBar":"","RightDownVector":"","RightFloor":"","rightharpoondown":"","rightharpoonup":"","rightleftarrows":"","rightleftharpoons":"","rightrightarrows":"","rightsquigarrow":"","RightTeeArrow":"","RightTee":"","RightTeeVector":"","rightthreetimes":"","RightTriangleBar":"","RightTriangle":"","RightTriangleEqual":"","RightUpDownVector":"","RightUpTeeVector":"","RightUpVectorBar":"","RightUpVector":"","RightVectorBar":"","RightVector":"","ring":"","risingdotseq":"","rlarr":"","rlhar":"","rlm":"","rmoustache":"","rmoust":"","rnmid":"","roang":"","roarr":"","robrk":"","ropar":"","ropf":"","Ropf":"","roplus":"","rotimes":"","RoundImplies":"","rpar":")","rpargt":"","rppolint":"","rrarr":"","Rrightarrow":"","rsaquo":"","rscr":"","Rscr":"","rsh":"","Rsh":"","rsqb":"]","rsquo":"","rsquor":"","rthree":"","rtimes":"","rtri":"","rtrie":"","rtrif":"","rtriltri":"","RuleDelayed":"","ruluhar":"","rx":"","Sacute":"","sacute":"","sbquo":"","scap":"","Scaron":"","scaron":"","Sc":"","sc":"","sccue":"","sce":"","scE":"","Scedil":"","scedil":"","Scirc":"","scirc":"","scnap":"","scnE":"","scnsim":"","scpolint":"","scsim":"","Scy":"","scy":"","sdotb":"","sdot":"","sdote":"","searhk":"","searr":"","seArr":"","searrow":"","sect":"","semi":";","seswar":"","setminus":"","setmn":"","sext":"","Sfr":"","sfr":"","sfrown":"","sharp":"","SHCHcy":"","shchcy":"","SHcy":"","shcy":"","ShortDownArrow":"","ShortLeftArrow":"","shortmid":"","shortparallel":"","ShortRightArrow":"","ShortUpArrow":"","shy":"","Sigma":"","sigma":"","sigmaf":"","sigmav":"","sim":"","simdot":"","sime":"","simeq":"","simg":"","simgE":"","siml":"","simlE":"","simne":"","simplus":"","simrarr":"","slarr":"","SmallCircle":"","smallsetminus":"","smashp":"","smeparsl":"","smid":"","smile":"","smt":"","smte":"","smtes":"","SOFTcy":"","softcy":"","solbar":"","solb":"","sol":"/","Sopf":"","sopf":"","spades":"","spadesuit":"","spar":"","sqcap":"","sqcaps":"","sqcup":"","sqcups":"","Sqrt":"","sqsub":"","sqsube":"","sqsubset":"","sqsubseteq":"","sqsup":"","sqsupe":"","sqsupset":"","sqsupseteq":"","square":"","Square":"","SquareIntersection":"","SquareSubset":"","SquareSubsetEqual":"","SquareSuperset":"","SquareSupersetEqual":"","SquareUnion":"","squarf":"","squ":"","squf":"","srarr":"","Sscr":"","sscr":"","ssetmn":"","ssmile":"","sstarf":"","Star":"","star":"","starf":"","straightepsilon":"","straightphi":"","strns":"","sub":"","Sub":"","subdot":"","subE":"","sube":"","subedot":"","submult":"","subnE":"","subne":"","subplus":"","subrarr":"","subset":"","Subset":"","subseteq":"","subseteqq":"","SubsetEqual":"","subsetneq":"","subsetneqq":"","subsim":"","subsub":"","subsup":"","succapprox":"","succ":"","succcurlyeq":"","Succeeds":"","SucceedsEqual":"","SucceedsSlantEqual":"","SucceedsTilde":"","succeq":"","succnapprox":"","succneqq":"","succnsim":"","succsim":"","SuchThat":"","sum":"","Sum":"","sung":"","sup1":"","sup2":"","sup3":"","sup":"","Sup":"","supdot":"","supdsub":"","supE":"","supe":"","supedot":"","Superset":"","SupersetEqual":"","suphsol":"","suphsub":"","suplarr":"","supmult":"","supnE":"","supne":"","supplus":"","supset":"","Supset":"","supseteq":"","supseteqq":"","supsetneq":"","supsetneqq":"","supsim":"","supsub":"","supsup":"","swarhk":"","swarr":"","swArr":"","swarrow":"","swnwar":"","szlig":"","Tab":"\\t","target":"","Tau":"","tau":"","tbrk":"","Tcaron":"","tcaron":"","Tcedil":"","tcedil":"","Tcy":"","tcy":"","tdot":"","telrec":"","Tfr":"","tfr":"","there4":"","therefore":"","Therefore":"","Theta":"","theta":"","thetasym":"","thetav":"","thickapprox":"","thicksim":"","ThickSpace":"","ThinSpace":"","thinsp":"","thkap":"","thksim":"","THORN":"","thorn":"","tilde":"","Tilde":"","TildeEqual":"","TildeFullEqual":"","TildeTilde":"","timesbar":"","timesb":"","times":"","timesd":"","tint":"","toea":"","topbot":"","topcir":"","top":"","Topf":"","topf":"","topfork":"","tosa":"","tprime":"","trade":"","TRADE":"","triangle":"","triangledown":"","triangleleft":"","trianglelefteq":"","triangleq":"","triangleright":"","trianglerighteq":"","tridot":"","trie":"","triminus":"","TripleDot":"","triplus":"","trisb":"","tritime":"","trpezium":"","Tscr":"","tscr":"","TScy":"","tscy":"","TSHcy":"","tshcy":"","Tstrok":"","tstrok":"","twixt":"","twoheadleftarrow":"","twoheadrightarrow":"","Uacute":"","uacute":"","uarr":"","Uarr":"","uArr":"","Uarrocir":"","Ubrcy":"","ubrcy":"","Ubreve":"","ubreve":"","Ucirc":"","ucirc":"","Ucy":"","ucy":"","udarr":"","Udblac":"","udblac":"","udhar":"","ufisht":"","Ufr":"","ufr":"","Ugrave":"","ugrave":"","uHar":"","uharl":"","uharr":"","uhblk":"","ulcorn":"","ulcorner":"","ulcrop":"","ultri":"","Umacr":"","umacr":"","uml":"","UnderBar":"_","UnderBrace":"","UnderBracket":"","UnderParenthesis":"","Union":"","UnionPlus":"","Uogon":"","uogon":"","Uopf":"","uopf":"","UpArrowBar":"","uparrow":"","UpArrow":"","Uparrow":"","UpArrowDownArrow":"","updownarrow":"","UpDownArrow":"","Updownarrow":"","UpEquilibrium":"","upharpoonleft":"","upharpoonright":"","uplus":"","UpperLeftArrow":"","UpperRightArrow":"","upsi":"","Upsi":"","upsih":"","Upsilon":"","upsilon":"","UpTeeArrow":"","UpTee":"","upuparrows":"","urcorn":"","urcorner":"","urcrop":"","Uring":"","uring":"","urtri":"","Uscr":"","uscr":"","utdot":"","Utilde":"","utilde":"","utri":"","utrif":"","uuarr":"","Uuml":"","uuml":"","uwangle":"","vangrt":"","varepsilon":"","varkappa":"","varnothing":"","varphi":"","varpi":"","varpropto":"","varr":"","vArr":"","varrho":"","varsigma":"","varsubsetneq":"","varsubsetneqq":"","varsupsetneq":"","varsupsetneqq":"","vartheta":"","vartriangleleft":"","vartriangleright":"","vBar":"","Vbar":"","vBarv":"","Vcy":"","vcy":"","vdash":"","vDash":"","Vdash":"","VDash":"","Vdashl":"","veebar":"","vee":"","Vee":"","veeeq":"","vellip":"","verbar":"|","Verbar":"","vert":"|","Vert":"","VerticalBar":"","VerticalLine":"|","VerticalSeparator":"","VerticalTilde":"","VeryThinSpace":"","Vfr":"","vfr":"","vltri":"","vnsub":"","vnsup":"","Vopf":"","vopf":"","vprop":"","vrtri":"","Vscr":"","vscr":"","vsubnE":"","vsubne":"","vsupnE":"","vsupne":"","Vvdash":"","vzigzag":"","Wcirc":"","wcirc":"","wedbar":"","wedge":"","Wedge":"","wedgeq":"","weierp":"","Wfr":"","wfr":"","Wopf":"","wopf":"","wp":"","wr":"","wreath":"","Wscr":"","wscr":"","xcap":"","xcirc":"","xcup":"","xdtri":"","Xfr":"","xfr":"","xharr":"","xhArr":"","Xi":"","xi":"","xlarr":"","xlArr":"","xmap":"","xnis":"","xodot":"","Xopf":"","xopf":"","xoplus":"","xotime":"","xrarr":"","xrArr":"","Xscr":"","xscr":"","xsqcup":"","xuplus":"","xutri":"","xvee":"","xwedge":"","Yacute":"","yacute":"","YAcy":"","yacy":"","Ycirc":"","ycirc":"","Ycy":"","ycy":"","yen":"","Yfr":"","yfr":"","YIcy":"","yicy":"","Yopf":"","yopf":"","Yscr":"","yscr":"","YUcy":"","yucy":"","yuml":"","Yuml":"","Zacute":"","zacute":"","Zcaron":"","zcaron":"","Zcy":"","zcy":"","Zdot":"","zdot":"","zeetrf":"","ZeroWidthSpace":"","Zeta":"","zeta":"","zfr":"","Zfr":"","ZHcy":"","zhcy":"","zigrarr":"","zopf":"","Zopf":"","Zscr":"","zscr":"","zwj":"","zwnj":""}')},7802:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"","aacute":"","Acirc":"","acirc":"","acute":"","AElig":"","aelig":"","Agrave":"","agrave":"","amp":"&","AMP":"&","Aring":"","aring":"","Atilde":"","atilde":"","Auml":"","auml":"","brvbar":"","Ccedil":"","ccedil":"","cedil":"","cent":"","copy":"","COPY":"","curren":"","deg":"","divide":"","Eacute":"","eacute":"","Ecirc":"","ecirc":"","Egrave":"","egrave":"","ETH":"","eth":"","Euml":"","euml":"","frac12":"","frac14":"","frac34":"","gt":">","GT":">","Iacute":"","iacute":"","Icirc":"","icirc":"","iexcl":"","Igrave":"","igrave":"","iquest":"","Iuml":"","iuml":"","laquo":"","lt":"<","LT":"<","macr":"","micro":"","middot":"","nbsp":"","not":"","Ntilde":"","ntilde":"","Oacute":"","oacute":"","Ocirc":"","ocirc":"","Ograve":"","ograve":"","ordf":"","ordm":"","Oslash":"","oslash":"","Otilde":"","otilde":"","Ouml":"","ouml":"","para":"","plusmn":"","pound":"","quot":"\\"","QUOT":"\\"","raquo":"","reg":"","REG":"","sect":"","shy":"","sup1":"","sup2":"","sup3":"","szlig":"","THORN":"","thorn":"","times":"","Uacute":"","uacute":"","Ucirc":"","ucirc":"","Ugrave":"","ugrave":"","uml":"","Uuml":"","uuml":"","Yacute":"","yacute":"","yen":"","yuml":""}')},2228:e=>{"use strict";e.exports=JSON.parse('{"amp":"&","apos":"\'","gt":">","lt":"<","quot":"\\""}')},7187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var i,s,o,l;if(a(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,l=u,console&&console.warn&&console.warn(l)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=u.bind(n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){n.once&&e.removeEventListener(t,i),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,u=f(c,l);for(r=0;r<l;++r)n(u[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,s,o;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",r=Array.prototype.slice,n=Object.prototype.toString,i="[object Function]";e.exports=function(e){var s=this;if("function"!=typeof s||n.call(s)!==i)throw new TypeError(t+s);for(var o,a=r.call(arguments,1),c=function(){if(this instanceof o){var t=s.apply(this,a.concat(r.call(arguments)));return Object(t)===t?t:this}return s.apply(e,a.concat(r.call(arguments)))},l=Math.max(0,s.length-a.length),u=[],h=0;h<l;h++)u.push("$"+h);if(o=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(c),s.prototype){var d=function(){};d.prototype=s.prototype,o.prototype=new d,d.prototype=null}return o}},8612:(e,t,r)=>{"use strict";var n=r(7648);e.exports=Function.prototype.bind||n},210:(e,t,r)=>{"use strict";var n,i=SyntaxError,s=Function,o=TypeError,a=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l=function(){throw new o},u=c?function(){try{return l}catch(e){try{return c(arguments,"callee").get}catch(e){return l}}}():l,h=r(1405)(),d=Object.getPrototypeOf||function(e){return e.__proto__},p={},f="undefined"==typeof Uint8Array?n:d(Uint8Array),g={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":h?d([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?d(d([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?d((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?d((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?d(""[Symbol.iterator]()):n,"%Symbol%":h?Symbol:n,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":f,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},m=function e(t){var r;if("%AsyncFunction%"===t)r=a("async function () {}");else if("%GeneratorFunction%"===t)r=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=a("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(r=d(i.prototype))}return g[t]=r,r},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},v=r(8612),_=r(7642),b=v.call(Function.call,Array.prototype.concat),w=v.call(Function.apply,Array.prototype.splice),S=v.call(Function.call,String.prototype.replace),k=v.call(Function.call,String.prototype.slice),E=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,x=/\\(\\)?/g,A=function(e){var t=k(e,0,1),r=k(e,-1);if("%"===t&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return S(e,E,(function(e,t,r,i){n[n.length]=r?S(i,x,"$1"):t||e})),n},T=function(e,t){var r,n=e;if(_(y,n)&&(n="%"+(r=y[n])[0]+"%"),_(g,n)){var s=g[n];if(s===p&&(s=m(n)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:s}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var r=A(e),n=r.length>0?r[0]:"",s=T("%"+n+"%",t),a=s.name,l=s.value,u=!1,h=s.alias;h&&(n=h[0],w(r,b([0,1],h)));for(var d=1,p=!0;d<r.length;d+=1){var f=r[d],m=k(f,0,1),y=k(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===y||"'"===y||"`"===y)&&m!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==f&&p||(u=!0),_(g,a="%"+(n+="."+f)+"%"))l=g[a];else if(null!=l){if(!(f in l)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&d+1>=r.length){var v=c(l,f);l=(p=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:l[f]}else p=_(l,f),l=l[f];p&&!u&&(g[a]=l)}}return l}},1405:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(5419);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},7642:(e,t,r)=>{"use strict";var n=r(8612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},3870:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseFeed=t.FeedHandler=void 0;var l,u,h=c(r(7915)),d=a(r(9432)),p=r(763);!function(e){e[e.image=0]="image",e[e.audio=1]="audio",e[e.video=2]="video",e[e.document=3]="document",e[e.executable=4]="executable"}(l||(l={})),function(e){e[e.sample=0]="sample",e[e.full=1]="full",e[e.nonstop=2]="nonstop"}(u||(u={}));var f=function(e){function t(t,r){return"object"==typeof t&&(r=t=void 0),e.call(this,t,r)||this}return i(t,e),t.prototype.onend=function(){var e,t,r=y(w,this.dom);if(r){var n={};if("feed"===r.name){var i=r.children;n.type="atom",b(n,"id","id",i),b(n,"title","title",i);var s=_("href",y("link",i));s&&(n.link=s),b(n,"description","subtitle",i),(o=v("updated",i))&&(n.updated=new Date(o)),b(n,"author","email",i,!0),n.items=m("entry",i).map((function(e){var t={},r=e.children;b(t,"id","id",r),b(t,"title","title",r);var n=_("href",y("link",r));n&&(t.link=n);var i=v("summary",r)||v("content",r);i&&(t.description=i);var s=v("updated",r);return s&&(t.pubDate=new Date(s)),t.media=g(r),t}))}else{var o;i=null!==(t=null===(e=y("channel",r.children))||void 0===e?void 0:e.children)&&void 0!==t?t:[],n.type=r.name.substr(0,3),n.id="",b(n,"title","title",i),b(n,"link","link",i),b(n,"description","description",i),(o=v("lastBuildDate",i))&&(n.updated=new Date(o)),b(n,"author","managingEditor",i,!0),n.items=m("item",r.children).map((function(e){var t={},r=e.children;b(t,"id","guid",r),b(t,"title","title",r),b(t,"link","link",r),b(t,"description","description",r);var n=v("pubDate",r);return n&&(t.pubDate=new Date(n)),t.media=g(r),t}))}this.feed=n,this.handleCallback(null)}else this.handleCallback(new Error("couldn't find root of feed"))},t}(h.default);function g(e){return m("media:content",e).map((function(e){var t={medium:e.attribs.medium,isDefault:!!e.attribs.isDefault};return e.attribs.url&&(t.url=e.attribs.url),e.attribs.fileSize&&(t.fileSize=parseInt(e.attribs.fileSize,10)),e.attribs.type&&(t.type=e.attribs.type),e.attribs.expression&&(t.expression=e.attribs.expression),e.attribs.bitrate&&(t.bitrate=parseInt(e.attribs.bitrate,10)),e.attribs.framerate&&(t.framerate=parseInt(e.attribs.framerate,10)),e.attribs.samplingrate&&(t.samplingrate=parseInt(e.attribs.samplingrate,10)),e.attribs.channels&&(t.channels=parseInt(e.attribs.channels,10)),e.attribs.duration&&(t.duration=parseInt(e.attribs.duration,10)),e.attribs.height&&(t.height=parseInt(e.attribs.height,10)),e.attribs.width&&(t.width=parseInt(e.attribs.width,10)),e.attribs.lang&&(t.lang=e.attribs.lang),t}))}function m(e,t){return d.getElementsByTagName(e,t,!0)}function y(e,t){return d.getElementsByTagName(e,t,!0,1)[0]}function v(e,t,r){return void 0===r&&(r=!1),d.getText(d.getElementsByTagName(e,t,r,1)).trim()}function _(e,t){return t?t.attribs[e]:null}function b(e,t,r,n,i){void 0===i&&(i=!1);var s=v(r,n,i);s&&(e[t]=s)}function w(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}t.FeedHandler=f,t.parseFeed=function(e,t){void 0===t&&(t={xmlMode:!0});var r=new f(t);return new p.Parser(r,t).end(e),r.feed}},763:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var i=n(r(9889)),s=new Set(["input","option","optgroup","select","button","datalist","textarea"]),o=new Set(["p"]),a={tr:new Set(["tr","th","td"]),th:new Set(["th"]),td:new Set(["thead","th","td"]),body:new Set(["head","link","script"]),li:new Set(["li"]),p:o,h1:o,h2:o,h3:o,h4:o,h5:o,h6:o,select:s,input:s,output:s,button:s,datalist:s,textarea:s,option:new Set(["option"]),optgroup:new Set(["optgroup","option"]),dd:new Set(["dt","dd"]),dt:new Set(["dt","dd"]),address:o,article:o,aside:o,blockquote:o,details:o,div:o,dl:o,fieldset:o,figcaption:o,figure:o,footer:o,form:o,header:o,hr:o,main:o,nav:o,ol:o,pre:o,section:o,table:o,ul:o,rt:new Set(["rt","rp"]),rp:new Set(["rt","rp"]),tbody:new Set(["thead","tbody"]),tfoot:new Set(["thead","tbody"])},c=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),l=new Set(["math","svg"]),u=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),h=/\s|\//,d=function(){function e(e,t){var r,n,s,o,a;void 0===t&&(t={}),this.startIndex=0,this.endIndex=null,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.options=t,this.cbs=null!=e?e:{},this.lowerCaseTagNames=null!==(r=t.lowerCaseTags)&&void 0!==r?r:!t.xmlMode,this.lowerCaseAttributeNames=null!==(n=t.lowerCaseAttributeNames)&&void 0!==n?n:!t.xmlMode,this.tokenizer=new(null!==(s=t.Tokenizer)&&void 0!==s?s:i.default)(this.options,this),null===(a=(o=this.cbs).onparserinit)||void 0===a||a.call(o,this)}return e.prototype.updatePosition=function(e){null===this.endIndex?this.tokenizer.sectionStart<=e?this.startIndex=0:this.startIndex=this.tokenizer.sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this.tokenizer.getAbsoluteIndex()},e.prototype.ontext=function(e){var t,r;this.updatePosition(1),this.endIndex--,null===(r=(t=this.cbs).ontext)||void 0===r||r.call(t,e)},e.prototype.onopentagname=function(e){var t,r;if(this.lowerCaseTagNames&&(e=e.toLowerCase()),this.tagname=e,!this.options.xmlMode&&Object.prototype.hasOwnProperty.call(a,e))for(var n=void 0;this.stack.length>0&&a[e].has(n=this.stack[this.stack.length-1]);)this.onclosetag(n);!this.options.xmlMode&&c.has(e)||(this.stack.push(e),l.has(e)?this.foreignContext.push(!0):u.has(e)&&this.foreignContext.push(!1)),null===(r=(t=this.cbs).onopentagname)||void 0===r||r.call(t,e),this.cbs.onopentag&&(this.attribs={})},e.prototype.onopentagend=function(){var e,t;this.updatePosition(1),this.attribs&&(null===(t=(e=this.cbs).onopentag)||void 0===t||t.call(e,this.tagname,this.attribs),this.attribs=null),!this.options.xmlMode&&this.cbs.onclosetag&&c.has(this.tagname)&&this.cbs.onclosetag(this.tagname),this.tagname=""},e.prototype.onclosetag=function(e){if(this.updatePosition(1),this.lowerCaseTagNames&&(e=e.toLowerCase()),(l.has(e)||u.has(e))&&this.foreignContext.pop(),!this.stack.length||!this.options.xmlMode&&c.has(e))this.options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this.closeCurrentTag());else{var t=this.stack.lastIndexOf(e);if(-1!==t)if(this.cbs.onclosetag)for(t=this.stack.length-t;t--;)this.cbs.onclosetag(this.stack.pop());else this.stack.length=t;else"p"!==e||this.options.xmlMode||(this.onopentagname(e),this.closeCurrentTag())}},e.prototype.onselfclosingtag=function(){this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?this.closeCurrentTag():this.onopentagend()},e.prototype.closeCurrentTag=function(){var e,t,r=this.tagname;this.onopentagend(),this.stack[this.stack.length-1]===r&&(null===(t=(e=this.cbs).onclosetag)||void 0===t||t.call(e,r),this.stack.pop())},e.prototype.onattribname=function(e){this.lowerCaseAttributeNames&&(e=e.toLowerCase()),this.attribname=e},e.prototype.onattribdata=function(e){this.attribvalue+=e},e.prototype.onattribend=function(e){var t,r;null===(r=(t=this.cbs).onattribute)||void 0===r||r.call(t,this.attribname,this.attribvalue,e),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribname="",this.attribvalue=""},e.prototype.getInstructionName=function(e){var t=e.search(h),r=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(r=r.toLowerCase()),r},e.prototype.ondeclaration=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("!"+t,"!"+e)}},e.prototype.onprocessinginstruction=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("?"+t,"?"+e)}},e.prototype.oncomment=function(e){var t,r,n,i;this.updatePosition(4),null===(r=(t=this.cbs).oncomment)||void 0===r||r.call(t,e),null===(i=(n=this.cbs).oncommentend)||void 0===i||i.call(n)},e.prototype.oncdata=function(e){var t,r,n,i,s,o;this.updatePosition(1),this.options.xmlMode||this.options.recognizeCDATA?(null===(r=(t=this.cbs).oncdatastart)||void 0===r||r.call(t),null===(i=(n=this.cbs).ontext)||void 0===i||i.call(n,e),null===(o=(s=this.cbs).oncdataend)||void 0===o||o.call(s)):this.oncomment("[CDATA["+e+"]]")},e.prototype.onerror=function(e){var t,r;null===(r=(t=this.cbs).onerror)||void 0===r||r.call(t,e)},e.prototype.onend=function(){var e,t;if(this.cbs.onclosetag)for(var r=this.stack.length;r>0;this.cbs.onclosetag(this.stack[--r]));null===(t=(e=this.cbs).onend)||void 0===t||t.call(e)},e.prototype.reset=function(){var e,t,r,n;null===(t=(e=this.cbs).onreset)||void 0===t||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack=[],null===(n=(r=this.cbs).onparserinit)||void 0===n||n.call(r,this)},e.prototype.parseComplete=function(e){this.reset(),this.end(e)},e.prototype.write=function(e){this.tokenizer.write(e)},e.prototype.end=function(e){this.tokenizer.end(e)},e.prototype.pause=function(){this.tokenizer.pause()},e.prototype.resume=function(){this.tokenizer.resume()},e.prototype.parseChunk=function(e){this.write(e)},e.prototype.done=function(e){this.end(e)},e}();t.Parser=d},9889:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(26)),s=n(r(4007)),o=n(r(7802)),a=n(r(2228));function c(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function l(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function u(e,t,r){var n=e.toLowerCase();return e===n?function(e,i){i===n?e._state=t:(e._state=r,e._index--)}:function(i,s){s===n||s===e?i._state=t:(i._state=r,i._index--)}}function h(e,t){var r=e.toLowerCase();return function(n,i){i===r||i===e?n._state=t:(n._state=3,n._index--)}}var d=u("C",24,16),p=u("D",25,16),f=u("A",26,16),g=u("T",27,16),m=u("A",28,16),y=h("R",35),v=h("I",36),_=h("P",37),b=h("T",38),w=u("R",40,1),S=u("I",41,1),k=u("P",42,1),E=u("T",43,1),x=h("Y",45),A=h("L",46),T=h("E",47),C=u("Y",49,1),I=u("L",50,1),R=u("E",51,1),O=h("I",54),P=h("T",55),D=h("L",56),M=h("E",57),L=u("I",58,1),N=u("T",59,1),F=u("L",60,1),B=u("E",61,1),U=u("#",63,64),q=u("X",66,65),j=function(){function e(e,t){var r;this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1,this.cbs=t,this.xmlMode=!!(null==e?void 0:e.xmlMode),this.decodeEntities=null===(r=null==e?void 0:e.decodeEntities)||void 0===r||r}return e.prototype.reset=function(){this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1},e.prototype.write=function(e){this.ended&&this.cbs.onerror(Error(".write() after done!")),this.buffer+=e,this.parse()},e.prototype.end=function(e){this.ended&&this.cbs.onerror(Error(".end() after done!")),e&&this.write(e),this.ended=!0,this.running&&this.finish()},e.prototype.pause=function(){this.running=!1},e.prototype.resume=function(){this.running=!0,this._index<this.buffer.length&&this.parse(),this.ended&&this.finish()},e.prototype.getAbsoluteIndex=function(){return this.bufferOffset+this._index},e.prototype.stateText=function(e){"<"===e?(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this._state=2,this.sectionStart=this._index):!this.decodeEntities||"&"!==e||1!==this.special&&4!==this.special||(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this.baseState=1,this._state=62,this.sectionStart=this._index)},e.prototype.stateBeforeTagName=function(e){"/"===e?this._state=5:"<"===e?(this.cbs.ontext(this.getSection()),this.sectionStart=this._index):">"===e||1!==this.special||c(e)?this._state=1:"!"===e?(this._state=15,this.sectionStart=this._index+1):"?"===e?(this._state=17,this.sectionStart=this._index+1):l(e)?(this._state=this.xmlMode||"s"!==e&&"S"!==e?this.xmlMode||"t"!==e&&"T"!==e?3:52:32,this.sectionStart=this._index):this._state=1},e.prototype.stateInTagName=function(e){("/"===e||">"===e||c(e))&&(this.emitToken("onopentagname"),this._state=8,this._index--)},e.prototype.stateBeforeClosingTagName=function(e){c(e)||(">"===e?this._state=1:1!==this.special?4===this.special||"s"!==e&&"S"!==e?4!==this.special||"t"!==e&&"T"!==e?(this._state=1,this._index--):this._state=53:this._state=33:l(e)?(this._state=6,this.sectionStart=this._index):(this._state=20,this.sectionStart=this._index))},e.prototype.stateInClosingTagName=function(e){(">"===e||c(e))&&(this.emitToken("onclosetag"),this._state=7,this._index--)},e.prototype.stateAfterClosingTagName=function(e){">"===e&&(this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeAttributeName=function(e){">"===e?(this.cbs.onopentagend(),this._state=1,this.sectionStart=this._index+1):"/"===e?this._state=4:c(e)||(this._state=9,this.sectionStart=this._index)},e.prototype.stateInSelfClosingTag=function(e){">"===e?(this.cbs.onselfclosingtag(),this._state=1,this.sectionStart=this._index+1,this.special=1):c(e)||(this._state=8,this._index--)},e.prototype.stateInAttributeName=function(e){("="===e||"/"===e||">"===e||c(e))&&(this.cbs.onattribname(this.getSection()),this.sectionStart=-1,this._state=10,this._index--)},e.prototype.stateAfterAttributeName=function(e){"="===e?this._state=11:"/"===e||">"===e?(this.cbs.onattribend(void 0),this._state=8,this._index--):c(e)||(this.cbs.onattribend(void 0),this._state=9,this.sectionStart=this._index)},e.prototype.stateBeforeAttributeValue=function(e){'"'===e?(this._state=12,this.sectionStart=this._index+1):"'"===e?(this._state=13,this.sectionStart=this._index+1):c(e)||(this._state=14,this.sectionStart=this._index,this._index--)},e.prototype.handleInAttributeValue=function(e,t){e===t?(this.emitToken("onattribdata"),this.cbs.onattribend(t),this._state=8):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateInAttributeValueDoubleQuotes=function(e){this.handleInAttributeValue(e,'"')},e.prototype.stateInAttributeValueSingleQuotes=function(e){this.handleInAttributeValue(e,"'")},e.prototype.stateInAttributeValueNoQuotes=function(e){c(e)||">"===e?(this.emitToken("onattribdata"),this.cbs.onattribend(null),this._state=8,this._index--):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateBeforeDeclaration=function(e){this._state="["===e?23:"-"===e?18:16},e.prototype.stateInDeclaration=function(e){">"===e&&(this.cbs.ondeclaration(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateInProcessingInstruction=function(e){">"===e&&(this.cbs.onprocessinginstruction(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeComment=function(e){"-"===e?(this._state=19,this.sectionStart=this._index+1):this._state=16},e.prototype.stateInComment=function(e){"-"===e&&(this._state=21)},e.prototype.stateInSpecialComment=function(e){">"===e&&(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index)),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateAfterComment1=function(e){this._state="-"===e?22:19},e.prototype.stateAfterComment2=function(e){">"===e?(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"-"!==e&&(this._state=19)},e.prototype.stateBeforeCdata6=function(e){"["===e?(this._state=29,this.sectionStart=this._index+1):(this._state=16,this._index--)},e.prototype.stateInCdata=function(e){"]"===e&&(this._state=30)},e.prototype.stateAfterCdata1=function(e){this._state="]"===e?31:29},e.prototype.stateAfterCdata2=function(e){">"===e?(this.cbs.oncdata(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"]"!==e&&(this._state=29)},e.prototype.stateBeforeSpecialS=function(e){"c"===e||"C"===e?this._state=34:"t"===e||"T"===e?this._state=44:(this._state=3,this._index--)},e.prototype.stateBeforeSpecialSEnd=function(e){2!==this.special||"c"!==e&&"C"!==e?3!==this.special||"t"!==e&&"T"!==e?this._state=1:this._state=48:this._state=39},e.prototype.stateBeforeSpecialLast=function(e,t){("/"===e||">"===e||c(e))&&(this.special=t),this._state=3,this._index--},e.prototype.stateAfterSpecialLast=function(e,t){">"===e||c(e)?(this.special=1,this._state=6,this.sectionStart=this._index-t,this._index--):this._state=1},e.prototype.parseFixedEntity=function(e){if(void 0===e&&(e=this.xmlMode?a.default:s.default),this.sectionStart+1<this._index){var t=this.buffer.substring(this.sectionStart+1,this._index);Object.prototype.hasOwnProperty.call(e,t)&&(this.emitPartial(e[t]),this.sectionStart=this._index+1)}},e.prototype.parseLegacyEntity=function(){for(var e=this.sectionStart+1,t=Math.min(this._index-e,6);t>=2;){var r=this.buffer.substr(e,t);if(Object.prototype.hasOwnProperty.call(o.default,r))return this.emitPartial(o.default[r]),void(this.sectionStart+=t+1);t--}},e.prototype.stateInNamedEntity=function(e){";"===e?(this.parseFixedEntity(),1===this.baseState&&this.sectionStart+1<this._index&&!this.xmlMode&&this.parseLegacyEntity(),this._state=this.baseState):(e<"0"||e>"9")&&!l(e)&&(this.xmlMode||this.sectionStart+1===this._index||(1!==this.baseState?"="!==e&&this.parseFixedEntity(o.default):this.parseLegacyEntity()),this._state=this.baseState,this._index--)},e.prototype.decodeNumericEntity=function(e,t,r){var n=this.sectionStart+e;if(n!==this._index){var s=this.buffer.substring(n,this._index),o=parseInt(s,t);this.emitPartial(i.default(o)),this.sectionStart=r?this._index+1:this._index}this._state=this.baseState},e.prototype.stateInNumericEntity=function(e){";"===e?this.decodeNumericEntity(2,10,!0):(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(2,10,!1),this._index--)},e.prototype.stateInHexEntity=function(e){";"===e?this.decodeNumericEntity(3,16,!0):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(3,16,!1),this._index--)},e.prototype.cleanup=function(){this.sectionStart<0?(this.buffer="",this.bufferOffset+=this._index,this._index=0):this.running&&(1===this._state?(this.sectionStart!==this._index&&this.cbs.ontext(this.buffer.substr(this.sectionStart)),this.buffer="",this.bufferOffset+=this._index,this._index=0):this.sectionStart===this._index?(this.buffer="",this.bufferOffset+=this._index,this._index=0):(this.buffer=this.buffer.substr(this.sectionStart),this._index-=this.sectionStart,this.bufferOffset+=this.sectionStart),this.sectionStart=0)},e.prototype.parse=function(){for(;this._index<this.buffer.length&&this.running;){var e=this.buffer.charAt(this._index);1===this._state?this.stateText(e):12===this._state?this.stateInAttributeValueDoubleQuotes(e):9===this._state?this.stateInAttributeName(e):19===this._state?this.stateInComment(e):20===this._state?this.stateInSpecialComment(e):8===this._state?this.stateBeforeAttributeName(e):3===this._state?this.stateInTagName(e):6===this._state?this.stateInClosingTagName(e):2===this._state?this.stateBeforeTagName(e):10===this._state?this.stateAfterAttributeName(e):13===this._state?this.stateInAttributeValueSingleQuotes(e):11===this._state?this.stateBeforeAttributeValue(e):5===this._state?this.stateBeforeClosingTagName(e):7===this._state?this.stateAfterClosingTagName(e):32===this._state?this.stateBeforeSpecialS(e):21===this._state?this.stateAfterComment1(e):14===this._state?this.stateInAttributeValueNoQuotes(e):4===this._state?this.stateInSelfClosingTag(e):16===this._state?this.stateInDeclaration(e):15===this._state?this.stateBeforeDeclaration(e):22===this._state?this.stateAfterComment2(e):18===this._state?this.stateBeforeComment(e):33===this._state?this.stateBeforeSpecialSEnd(e):53===this._state?L(this,e):39===this._state?w(this,e):40===this._state?S(this,e):41===this._state?k(this,e):34===this._state?y(this,e):35===this._state?v(this,e):36===this._state?_(this,e):37===this._state?b(this,e):38===this._state?this.stateBeforeSpecialLast(e,2):42===this._state?E(this,e):43===this._state?this.stateAfterSpecialLast(e,6):44===this._state?x(this,e):29===this._state?this.stateInCdata(e):45===this._state?A(this,e):46===this._state?T(this,e):47===this._state?this.stateBeforeSpecialLast(e,3):48===this._state?C(this,e):49===this._state?I(this,e):50===this._state?R(this,e):51===this._state?this.stateAfterSpecialLast(e,5):52===this._state?O(this,e):54===this._state?P(this,e):55===this._state?D(this,e):56===this._state?M(this,e):57===this._state?this.stateBeforeSpecialLast(e,4):58===this._state?N(this,e):59===this._state?F(this,e):60===this._state?B(this,e):61===this._state?this.stateAfterSpecialLast(e,5):17===this._state?this.stateInProcessingInstruction(e):64===this._state?this.stateInNamedEntity(e):23===this._state?d(this,e):62===this._state?U(this,e):24===this._state?p(this,e):25===this._state?f(this,e):30===this._state?this.stateAfterCdata1(e):31===this._state?this.stateAfterCdata2(e):26===this._state?g(this,e):27===this._state?m(this,e):28===this._state?this.stateBeforeCdata6(e):66===this._state?this.stateInHexEntity(e):65===this._state?this.stateInNumericEntity(e):63===this._state?q(this,e):this.cbs.onerror(Error("unknown _state"),this._state),this._index++}this.cleanup()},e.prototype.finish=function(){this.sectionStart<this._index&&this.handleTrailingData(),this.cbs.onend()},e.prototype.handleTrailingData=function(){var e=this.buffer.substr(this.sectionStart);29===this._state||30===this._state||31===this._state?this.cbs.oncdata(e):19===this._state||21===this._state||22===this._state?this.cbs.oncomment(e):64!==this._state||this.xmlMode?65!==this._state||this.xmlMode?66!==this._state||this.xmlMode?3!==this._state&&8!==this._state&&11!==this._state&&10!==this._state&&9!==this._state&&13!==this._state&&12!==this._state&&14!==this._state&&6!==this._state&&this.cbs.ontext(e):(this.decodeNumericEntity(3,16,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.decodeNumericEntity(2,10,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.parseLegacyEntity(),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData()))},e.prototype.getSection=function(){return this.buffer.substring(this.sectionStart,this._index)},e.prototype.emitToken=function(e){this.cbs[e](this.getSection()),this.sectionStart=-1},e.prototype.emitPartial=function(e){1!==this.baseState?this.cbs.onattribdata(e):this.cbs.ontext(e)},e}();t.default=j},3719:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RssHandler=t.DefaultHandler=t.DomUtils=t.ElementType=t.Tokenizer=t.createDomStream=t.parseDOM=t.parseDocument=t.DomHandler=t.Parser=void 0;var c=r(763);Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return c.Parser}});var l=r(7915);function u(e,t){var r=new l.DomHandler(void 0,t);return new c.Parser(r,t).end(e),r.root}Object.defineProperty(t,"DomHandler",{enumerable:!0,get:function(){return l.DomHandler}}),Object.defineProperty(t,"DefaultHandler",{enumerable:!0,get:function(){return l.DomHandler}}),t.parseDocument=u,t.parseDOM=function(e,t){return u(e,t).children},t.createDomStream=function(e,t,r){var n=new l.DomHandler(e,t,r);return new c.Parser(n,t)};var h=r(9889);Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return a(h).default}});var d=s(r(9960));t.ElementType=d,o(r(3870),t),t.DomUtils=s(r(9432));var p=r(3870);Object.defineProperty(t,"RssHandler",{enumerable:!0,get:function(){return p.FeedHandler}})},645:(e,t)=>{t.read=function(e,t,r,n,i){var s,o,a=8*i-n-1,c=(1<<a)-1,l=c>>1,u=-7,h=r?i-1:0,d=r?-1:1,p=e[t+h];for(h+=d,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=l}return(p?-1:1)*o*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var o,a,c,l=8*s-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,f=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+p]=255&a,p+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[r+p]=255&o,p+=f,o/=256,l-=8);e[r+p-f]|=128*g}},527:function(e){var t;"undefined"!=typeof self&&self,t=function(){return function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return Qn}});var r=function e(t,r){this.position=void 0;var n,i="KaTeX parse error: "+t,s=r&&r.loc;if(s&&s.start<=s.end){var o=s.lexer.input;n=s.start;var a=s.end;n===o.length?i+=" at end of input: ":i+=" at position "+(n+1)+": ";var c=o.slice(n,a).replace(/[^]/g,"$&");i+=(n>15?""+o.slice(n-15,n):o.slice(0,n))+c+(a+15<o.length?o.slice(a,a+15)+"":o.slice(a))}var l=new Error(i);return l.name="ParseError",l.__proto__=e.prototype,l.position=n,l};r.prototype.__proto__=Error.prototype;var n=r,i=/([A-Z])/g,s={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},o=/[&><"']/g,a=function e(t){return"ordgroup"===t.type||"color"===t.type?1===t.body.length?e(t.body[0]):t:"font"===t.type?e(t.body):t},c=function(e,t){return-1!==e.indexOf(t)},l=function(e,t){return void 0===e?t:e},u=function(e){return String(e).replace(o,(function(e){return s[e]}))},h=function(e){return e.replace(i,"-$1").toLowerCase()},d=a,p=function(e){var t=a(e);return"mathord"===t.type||"textord"===t.type||"atom"===t.type},f=function(e){var t=/^\s*([^\\/#]*?)(?::|&#0*58|&#x0*3a)/i.exec(e);return null!=t?t[1]:"_relative"},g=function(){function e(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{},this.displayMode=l(e.displayMode,!1),this.output=l(e.output,"htmlAndMathml"),this.leqno=l(e.leqno,!1),this.fleqn=l(e.fleqn,!1),this.throwOnError=l(e.throwOnError,!0),this.errorColor=l(e.errorColor,"#cc0000"),this.macros=e.macros||{},this.minRuleThickness=Math.max(0,l(e.minRuleThickness,0)),this.colorIsTextColor=l(e.colorIsTextColor,!1),this.strict=l(e.strict,"warn"),this.trust=l(e.trust,!1),this.maxSize=Math.max(0,l(e.maxSize,1/0)),this.maxExpand=Math.max(0,l(e.maxExpand,1e3)),this.globalGroup=l(e.globalGroup,!1)}var t=e.prototype;return t.reportNonstrict=function(e,t,r){var i=this.strict;if("function"==typeof i&&(i=i(e,t,r)),i&&"ignore"!==i){if(!0===i||"error"===i)throw new n("LaTeX-incompatible input and strict mode is set to 'error': "+t+" ["+e+"]",r);"warn"===i?"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"):"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+i+"': "+t+" ["+e+"]")}},t.useStrictBehavior=function(e,t,r){var n=this.strict;if("function"==typeof n)try{n=n(e,t,r)}catch(e){n="error"}return!(!n||"ignore"===n||!0!==n&&"error"!==n&&("warn"===n?("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"),1):("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+n+"': "+t+" ["+e+"]"),1)))},t.isTrusted=function(e){e.url&&!e.protocol&&(e.protocol=f(e.url));var t="function"==typeof this.trust?this.trust(e):this.trust;return Boolean(t)},e}(),m=function(){function e(e,t,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=r}var t=e.prototype;return t.sup=function(){return y[v[this.id]]},t.sub=function(){return y[_[this.id]]},t.fracNum=function(){return y[b[this.id]]},t.fracDen=function(){return y[w[this.id]]},t.cramp=function(){return y[S[this.id]]},t.text=function(){return y[k[this.id]]},t.isTight=function(){return this.size>=2},e}(),y=[new m(0,0,!1),new m(1,0,!0),new m(2,1,!1),new m(3,1,!0),new m(4,2,!1),new m(5,2,!0),new m(6,3,!1),new m(7,3,!0)],v=[4,5,4,5,6,7,6,7],_=[5,5,5,5,7,7,7,7],b=[2,3,4,5,6,7,6,7],w=[3,3,5,5,7,7,7,7],S=[1,1,3,3,5,5,7,7],k=[0,1,2,3,2,3,2,3],E={DISPLAY:y[0],TEXT:y[2],SCRIPT:y[4],SCRIPTSCRIPT:y[6]},x=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}],A=[];function T(e){for(var t=0;t<A.length;t+=2)if(e>=A[t]&&e<=A[t+1])return!0;return!1}x.forEach((function(e){return e.blocks.forEach((function(e){return A.push.apply(A,e)}))}));var C={doubleleftarrow:"M262 157\nl10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3\n 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28\n 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5\nc2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5\n 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87\n-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7\n-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z\nm8 0v40h399730v-40zm0 194v40h399730v-40z",doublerightarrow:"M399738 392l\n-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5\n 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88\n-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68\n-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18\n-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782\nc-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3\n-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z",leftarrow:"M400000 241H110l3-3c68.7-52.7 113.7-120\n 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8\n-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247\nc-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208\n 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3\n 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202\n l-3-3h399890zM100 241v40h399900v-40z",leftbrace:"M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117\n-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7\n 5-6 9-10 13-.7 1-7.3 1-20 1H6z",leftbraceunder:"M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13\n 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688\n 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7\n-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z",leftgroup:"M400000 80\nH435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0\n 435 0h399565z",leftgroupunder:"M400000 262\nH435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219\n 435 219h399565z",leftharpoon:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3\n-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5\n-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7\n-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z",leftharpoonplus:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5\n 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3\n-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7\n-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z\nm0 0v40h400000v-40z",leftharpoondown:"M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333\n 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5\n 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667\n-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z",leftharpoondownplus:"M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12\n 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7\n-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0\nv40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z",lefthook:"M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5\n-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3\n-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21\n 71.5 23h399859zM103 281v-40h399897v40z",leftlinesegment:"M40 281 V428 H0 V94 H40 V241 H400000 v40z\nM40 281 V428 H0 V94 H40 V241 H400000 v40z",leftmapsto:"M40 281 V448H0V74H40V241H400000v40z\nM40 281 V448H0V74H40V241H400000v40z",leftToFrom:"M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23\n-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8\nc28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3\n 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z",longequal:"M0 50 h400000 v40H0z m0 194h40000v40H0z\nM0 50 h400000 v40H0z m0 194h40000v40H0z",midbrace:"M200428 334\nc-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14\n-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7\n 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11\n 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z",midbraceunder:"M199572 214\nc100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14\n 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3\n 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0\n-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z",oiintSize1:"M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6\n-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z\nm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8\n60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z",oiintSize2:"M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8\n-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z\nm502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2\nc0 110 84 276 504 276s502.4-166 502.4-276z",oiiintSize1:"M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6\n-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z\nm525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0\n85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z",oiiintSize2:"M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8\n-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z\nm770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1\nc0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z",rightarrow:"M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z",rightbrace:"M400000 542l\n-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5\ns-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1\nc124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z",rightbraceunder:"M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3\n 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237\n-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z",rightgroup:"M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0\n 3-1 3-3v-38c-76-158-257-219-435-219H0z",rightgroupunder:"M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18\n 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z",rightharpoon:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3\n-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2\n-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58\n 69.2 92 94.5zm0 0v40h399900v-40z",rightharpoonplus:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11\n-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7\n 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z\nm0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z",rightharpoondown:"M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8\n 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5\n-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95\n-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z",rightharpoondownplus:"M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8\n 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3\n 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3\n-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z\nm0-194v40h400000v-40zm0 0v40h400000v-40z",righthook:"M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3\n 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0\n-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21\n 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z",rightlinesegment:"M399960 241 V94 h40 V428 h-40 V281 H0 v-40z\nM399960 241 V94 h40 V428 h-40 V281 H0 v-40z",rightToFrom:"M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23\n 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32\n-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142\n-167z M100 147v40h399900v-40zM0 341v40h399900v-40z",twoheadleftarrow:"M0 167c68 40\n 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69\n-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3\n-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19\n-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101\n 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z",twoheadrightarrow:"M400000 167\nc-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3\n 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42\n 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333\n-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70\n 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z",tilde1:"M200 55.538c-77 0-168 73.953-177 73.953-3 0-7\n-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0\n 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0\n 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128\n-68.267.847-113-73.952-191-73.952z",tilde2:"M344 55.266c-142 0-300.638 81.316-311.5 86.418\n-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9\n 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114\nc1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751\n 181.476 676 181.476c-149 0-189-126.21-332-126.21z",tilde3:"M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457\n-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0\n 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697\n 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696\n -338 0-409-156.573-744-156.573z",tilde4:"M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345\n-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409\n 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9\n 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409\n -175.236-744-175.236z",vec:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z",widehat1:"M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z",widehat2:"M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat3:"M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat4:"M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widecheck1:"M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,\n-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z",widecheck2:"M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck3:"M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck4:"M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",baraboveleftarrow:"M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202\nc4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5\nc-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130\ns-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47\n121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6\ns2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11\nc0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z\nM100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z",rightarrowabovebar:"M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32\n-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0\n13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39\n-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5\n-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z",baraboveshortleftharpoon:"M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17\nc2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21\nc-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40\nc-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z\nM0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z",rightharpoonaboveshortbar:"M0,241 l0,40c399126,0,399993,0,399993,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z",shortbaraboveleftharpoon:"M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,\n1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,\n-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z\nM93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z",shortrightharpoonabovebar:"M53,241l0,40c398570,0,399437,0,399437,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z"},I=function(){function e(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}var t=e.prototype;return t.hasClass=function(e){return c(this.classes,e)},t.toNode=function(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e},t.toMarkup=function(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e},t.toText=function(){return this.children.map((function(e){return e.toText()})).join("")},e}(),R=function(e){return e.filter((function(e){return e})).join(" ")},O=function(e,t,r){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},t){t.style.isTight()&&this.classes.push("mtight");var n=t.getColor();n&&(this.style.color=n)}},P=function(e){var t=document.createElement(e);for(var r in t.className=R(this.classes),this.style)this.style.hasOwnProperty(r)&&(t.style[r]=this.style[r]);for(var n in this.attributes)this.attributes.hasOwnProperty(n)&&t.setAttribute(n,this.attributes[n]);for(var i=0;i<this.children.length;i++)t.appendChild(this.children[i].toNode());return t},D=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+u(R(this.classes))+'"');var r="";for(var n in this.style)this.style.hasOwnProperty(n)&&(r+=h(n)+":"+this.style[n]+";");for(var i in r&&(t+=' style="'+u(r)+'"'),this.attributes)this.attributes.hasOwnProperty(i)&&(t+=" "+i+'="'+u(this.attributes[i])+'"');t+=">";for(var s=0;s<this.children.length;s++)t+=this.children[s].toMarkup();return t+"</"+e+">"},M=function(){function e(e,t,r,n){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,O.call(this,e,r,n),this.children=t||[]}var t=e.prototype;return t.setAttribute=function(e,t){this.attributes[e]=t},t.hasClass=function(e){return c(this.classes,e)},t.toNode=function(){return P.call(this,"span")},t.toMarkup=function(){return D.call(this,"span")},e}(),L=function(){function e(e,t,r,n){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,O.call(this,t,n),this.children=r||[],this.setAttribute("href",e)}var t=e.prototype;return t.setAttribute=function(e,t){this.attributes[e]=t},t.hasClass=function(e){return c(this.classes,e)},t.toNode=function(){return P.call(this,"a")},t.toMarkup=function(){return D.call(this,"a")},e}(),N=function(){function e(e,t,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=r}var t=e.prototype;return t.hasClass=function(e){return c(this.classes,e)},t.toNode=function(){var e=document.createElement("img");for(var t in e.src=this.src,e.alt=this.alt,e.className="mord",this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e},t.toMarkup=function(){var e="<img  src='"+this.src+" 'alt='"+this.alt+"' ",t="";for(var r in this.style)this.style.hasOwnProperty(r)&&(t+=h(r)+":"+this.style[r]+";");return t&&(e+=' style="'+u(t)+'"'),e+"'/>"},e}(),F={:"",:"",:"",:""},B=function(){function e(e,t,r,n,i,s,o,a){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=r||0,this.italic=n||0,this.skew=i||0,this.width=s||0,this.classes=o||[],this.style=a||{},this.maxFontSize=0;var c=function(e){for(var t=0;t<x.length;t++)for(var r=x[t],n=0;n<r.blocks.length;n++){var i=r.blocks[n];if(e>=i[0]&&e<=i[1])return r.name}return null}(this.text.charCodeAt(0));c&&this.classes.push(c+"_fallback"),/[]/.test(this.text)&&(this.text=F[this.text])}var t=e.prototype;return t.hasClass=function(e){return c(this.classes,e)},t.toNode=function(){var e=document.createTextNode(this.text),t=null;for(var r in this.italic>0&&((t=document.createElement("span")).style.marginRight=this.italic+"em"),this.classes.length>0&&((t=t||document.createElement("span")).className=R(this.classes)),this.style)this.style.hasOwnProperty(r)&&((t=t||document.createElement("span")).style[r]=this.style[r]);return t?(t.appendChild(e),t):e},t.toMarkup=function(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=u(R(this.classes)),t+='"');var r="";for(var n in this.italic>0&&(r+="margin-right:"+this.italic+"em;"),this.style)this.style.hasOwnProperty(n)&&(r+=h(n)+":"+this.style[n]+";");r&&(e=!0,t+=' style="'+u(r)+'"');var i=u(this.text);return e?(t+=">",t+=i,t+="</span>"):i},e}(),U=function(){function e(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}var t=e.prototype;return t.toNode=function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);for(var r=0;r<this.children.length;r++)e.appendChild(this.children[r].toNode());return e},t.toMarkup=function(){var e="<svg";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+"='"+this.attributes[t]+"'");e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+"</svg>"},e}(),q=function(){function e(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}var t=e.prototype;return t.toNode=function(){var e=document.createElementNS("http://www.w3.org/2000/svg","path");return this.alternate?e.setAttribute("d",this.alternate):e.setAttribute("d",C[this.pathName]),e},t.toMarkup=function(){return this.alternate?"<path d='"+this.alternate+"'/>":"<path d='"+C[this.pathName]+"'/>"},e}(),j=function(){function e(e){this.attributes=void 0,this.attributes=e||{}}var t=e.prototype;return t.toNode=function(){var e=document.createElementNS("http://www.w3.org/2000/svg","line");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);return e},t.toMarkup=function(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+"='"+this.attributes[t]+"'");return e+"/>"},e}();function K(e){if(e instanceof B)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}var z={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.12,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,1],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.67,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.9,0,0,.278],8943:[-.19,.31,0,0,1.172],8945:[-.1,.82,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.744,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.744,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},$={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},G={:"A",:"C",:"D",:"o",:"a",:"c",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function V(e,t,r){if(!z[t])throw new Error("Font metrics not found for font: "+t+".");var n=e.charCodeAt(0),i=z[t][n];if(!i&&e[0]in G&&(n=G[e[0]].charCodeAt(0),i=z[t][n]),i||"text"!==r||T(n)&&(i=z[t][77]),i)return{depth:i[0],height:i[1],italic:i[2],skew:i[3],width:i[4]}}var H={},W={bin:1,close:1,inner:1,open:1,punct:1,rel:1},Y={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},X={math:{},text:{}},J=X;function Q(e,t,r,n,i,s){X[e][i]={font:t,group:r,replace:n},s&&n&&(X[e][n]=X[e][i])}var Z="math",ee="text",te="main",re="ams",ne="accent-token",ie="bin",se="close",oe="inner",ae="mathord",ce="op-token",le="open",ue="punct",he="rel",de="spacing",pe="textord";Q(Z,te,he,"","\\equiv",!0),Q(Z,te,he,"","\\prec",!0),Q(Z,te,he,"","\\succ",!0),Q(Z,te,he,"","\\sim",!0),Q(Z,te,he,"","\\perp"),Q(Z,te,he,"","\\preceq",!0),Q(Z,te,he,"","\\succeq",!0),Q(Z,te,he,"","\\simeq",!0),Q(Z,te,he,"","\\mid",!0),Q(Z,te,he,"","\\ll",!0),Q(Z,te,he,"","\\gg",!0),Q(Z,te,he,"","\\asymp",!0),Q(Z,te,he,"","\\parallel"),Q(Z,te,he,"","\\bowtie",!0),Q(Z,te,he,"","\\smile",!0),Q(Z,te,he,"","\\sqsubseteq",!0),Q(Z,te,he,"","\\sqsupseteq",!0),Q(Z,te,he,"","\\doteq",!0),Q(Z,te,he,"","\\frown",!0),Q(Z,te,he,"","\\ni",!0),Q(Z,te,he,"","\\propto",!0),Q(Z,te,he,"","\\vdash",!0),Q(Z,te,he,"","\\dashv",!0),Q(Z,te,he,"","\\owns"),Q(Z,te,ue,".","\\ldotp"),Q(Z,te,ue,"","\\cdotp"),Q(Z,te,pe,"#","\\#"),Q(ee,te,pe,"#","\\#"),Q(Z,te,pe,"&","\\&"),Q(ee,te,pe,"&","\\&"),Q(Z,te,pe,"","\\aleph",!0),Q(Z,te,pe,"","\\forall",!0),Q(Z,te,pe,"","\\hbar",!0),Q(Z,te,pe,"","\\exists",!0),Q(Z,te,pe,"","\\nabla",!0),Q(Z,te,pe,"","\\flat",!0),Q(Z,te,pe,"","\\ell",!0),Q(Z,te,pe,"","\\natural",!0),Q(Z,te,pe,"","\\clubsuit",!0),Q(Z,te,pe,"","\\wp",!0),Q(Z,te,pe,"","\\sharp",!0),Q(Z,te,pe,"","\\diamondsuit",!0),Q(Z,te,pe,"","\\Re",!0),Q(Z,te,pe,"","\\heartsuit",!0),Q(Z,te,pe,"","\\Im",!0),Q(Z,te,pe,"","\\spadesuit",!0),Q(ee,te,pe,"","\\S",!0),Q(ee,te,pe,"","\\P",!0),Q(Z,te,pe,"","\\dag"),Q(ee,te,pe,"","\\dag"),Q(ee,te,pe,"","\\textdagger"),Q(Z,te,pe,"","\\ddag"),Q(ee,te,pe,"","\\ddag"),Q(ee,te,pe,"","\\textdaggerdbl"),Q(Z,te,se,"","\\rmoustache",!0),Q(Z,te,le,"","\\lmoustache",!0),Q(Z,te,se,"","\\rgroup",!0),Q(Z,te,le,"","\\lgroup",!0),Q(Z,te,ie,"","\\mp",!0),Q(Z,te,ie,"","\\ominus",!0),Q(Z,te,ie,"","\\uplus",!0),Q(Z,te,ie,"","\\sqcap",!0),Q(Z,te,ie,"","\\ast"),Q(Z,te,ie,"","\\sqcup",!0),Q(Z,te,ie,"","\\bigcirc",!0),Q(Z,te,ie,"","\\bullet"),Q(Z,te,ie,"","\\ddagger"),Q(Z,te,ie,"","\\wr",!0),Q(Z,te,ie,"","\\amalg"),Q(Z,te,ie,"&","\\And"),Q(Z,te,he,"","\\longleftarrow",!0),Q(Z,te,he,"","\\Leftarrow",!0),Q(Z,te,he,"","\\Longleftarrow",!0),Q(Z,te,he,"","\\longrightarrow",!0),Q(Z,te,he,"","\\Rightarrow",!0),Q(Z,te,he,"","\\Longrightarrow",!0),Q(Z,te,he,"","\\leftrightarrow",!0),Q(Z,te,he,"","\\longleftrightarrow",!0),Q(Z,te,he,"","\\Leftrightarrow",!0),Q(Z,te,he,"","\\Longleftrightarrow",!0),Q(Z,te,he,"","\\mapsto",!0),Q(Z,te,he,"","\\longmapsto",!0),Q(Z,te,he,"","\\nearrow",!0),Q(Z,te,he,"","\\hookleftarrow",!0),Q(Z,te,he,"","\\hookrightarrow",!0),Q(Z,te,he,"","\\searrow",!0),Q(Z,te,he,"","\\leftharpoonup",!0),Q(Z,te,he,"","\\rightharpoonup",!0),Q(Z,te,he,"","\\swarrow",!0),Q(Z,te,he,"","\\leftharpoondown",!0),Q(Z,te,he,"","\\rightharpoondown",!0),Q(Z,te,he,"","\\nwarrow",!0),Q(Z,te,he,"","\\rightleftharpoons",!0),Q(Z,re,he,"","\\nless",!0),Q(Z,re,he,"","\\@nleqslant"),Q(Z,re,he,"","\\@nleqq"),Q(Z,re,he,"","\\lneq",!0),Q(Z,re,he,"","\\lneqq",!0),Q(Z,re,he,"","\\@lvertneqq"),Q(Z,re,he,"","\\lnsim",!0),Q(Z,re,he,"","\\lnapprox",!0),Q(Z,re,he,"","\\nprec",!0),Q(Z,re,he,"","\\npreceq",!0),Q(Z,re,he,"","\\precnsim",!0),Q(Z,re,he,"","\\precnapprox",!0),Q(Z,re,he,"","\\nsim",!0),Q(Z,re,he,"","\\@nshortmid"),Q(Z,re,he,"","\\nmid",!0),Q(Z,re,he,"","\\nvdash",!0),Q(Z,re,he,"","\\nvDash",!0),Q(Z,re,he,"","\\ntriangleleft"),Q(Z,re,he,"","\\ntrianglelefteq",!0),Q(Z,re,he,"","\\subsetneq",!0),Q(Z,re,he,"","\\@varsubsetneq"),Q(Z,re,he,"","\\subsetneqq",!0),Q(Z,re,he,"","\\@varsubsetneqq"),Q(Z,re,he,"","\\ngtr",!0),Q(Z,re,he,"","\\@ngeqslant"),Q(Z,re,he,"","\\@ngeqq"),Q(Z,re,he,"","\\gneq",!0),Q(Z,re,he,"","\\gneqq",!0),Q(Z,re,he,"","\\@gvertneqq"),Q(Z,re,he,"","\\gnsim",!0),Q(Z,re,he,"","\\gnapprox",!0),Q(Z,re,he,"","\\nsucc",!0),Q(Z,re,he,"","\\nsucceq",!0),Q(Z,re,he,"","\\succnsim",!0),Q(Z,re,he,"","\\succnapprox",!0),Q(Z,re,he,"","\\ncong",!0),Q(Z,re,he,"","\\@nshortparallel"),Q(Z,re,he,"","\\nparallel",!0),Q(Z,re,he,"","\\nVDash",!0),Q(Z,re,he,"","\\ntriangleright"),Q(Z,re,he,"","\\ntrianglerighteq",!0),Q(Z,re,he,"","\\@nsupseteqq"),Q(Z,re,he,"","\\supsetneq",!0),Q(Z,re,he,"","\\@varsupsetneq"),Q(Z,re,he,"","\\supsetneqq",!0),Q(Z,re,he,"","\\@varsupsetneqq"),Q(Z,re,he,"","\\nVdash",!0),Q(Z,re,he,"","\\precneqq",!0),Q(Z,re,he,"","\\succneqq",!0),Q(Z,re,he,"","\\@nsubseteqq"),Q(Z,re,ie,"","\\unlhd"),Q(Z,re,ie,"","\\unrhd"),Q(Z,re,he,"","\\nleftarrow",!0),Q(Z,re,he,"","\\nrightarrow",!0),Q(Z,re,he,"","\\nLeftarrow",!0),Q(Z,re,he,"","\\nRightarrow",!0),Q(Z,re,he,"","\\nleftrightarrow",!0),Q(Z,re,he,"","\\nLeftrightarrow",!0),Q(Z,re,he,"","\\vartriangle"),Q(Z,re,pe,"","\\hslash"),Q(Z,re,pe,"","\\triangledown"),Q(Z,re,pe,"","\\lozenge"),Q(Z,re,pe,"","\\circledS"),Q(Z,re,pe,"","\\circledR"),Q(ee,re,pe,"","\\circledR"),Q(Z,re,pe,"","\\measuredangle",!0),Q(Z,re,pe,"","\\nexists"),Q(Z,re,pe,"","\\mho"),Q(Z,re,pe,"","\\Finv",!0),Q(Z,re,pe,"","\\Game",!0),Q(Z,re,pe,"","\\backprime"),Q(Z,re,pe,"","\\blacktriangle"),Q(Z,re,pe,"","\\blacktriangledown"),Q(Z,re,pe,"","\\blacksquare"),Q(Z,re,pe,"","\\blacklozenge"),Q(Z,re,pe,"","\\bigstar"),Q(Z,re,pe,"","\\sphericalangle",!0),Q(Z,re,pe,"","\\complement",!0),Q(Z,re,pe,"","\\eth",!0),Q(ee,te,pe,"",""),Q(Z,re,pe,"","\\diagup"),Q(Z,re,pe,"","\\diagdown"),Q(Z,re,pe,"","\\square"),Q(Z,re,pe,"","\\Box"),Q(Z,re,pe,"","\\Diamond"),Q(Z,re,pe,"","\\yen",!0),Q(ee,re,pe,"","\\yen",!0),Q(Z,re,pe,"","\\checkmark",!0),Q(ee,re,pe,"","\\checkmark"),Q(Z,re,pe,"","\\beth",!0),Q(Z,re,pe,"","\\daleth",!0),Q(Z,re,pe,"","\\gimel",!0),Q(Z,re,pe,"","\\digamma",!0),Q(Z,re,pe,"","\\varkappa"),Q(Z,re,le,"","\\@ulcorner",!0),Q(Z,re,se,"","\\@urcorner",!0),Q(Z,re,le,"","\\@llcorner",!0),Q(Z,re,se,"","\\@lrcorner",!0),Q(Z,re,he,"","\\leqq",!0),Q(Z,re,he,"","\\leqslant",!0),Q(Z,re,he,"","\\eqslantless",!0),Q(Z,re,he,"","\\lesssim",!0),Q(Z,re,he,"","\\lessapprox",!0),Q(Z,re,he,"","\\approxeq",!0),Q(Z,re,ie,"","\\lessdot"),Q(Z,re,he,"","\\lll",!0),Q(Z,re,he,"","\\lessgtr",!0),Q(Z,re,he,"","\\lesseqgtr",!0),Q(Z,re,he,"","\\lesseqqgtr",!0),Q(Z,re,he,"","\\doteqdot"),Q(Z,re,he,"","\\risingdotseq",!0),Q(Z,re,he,"","\\fallingdotseq",!0),Q(Z,re,he,"","\\backsim",!0),Q(Z,re,he,"","\\backsimeq",!0),Q(Z,re,he,"","\\subseteqq",!0),Q(Z,re,he,"","\\Subset",!0),Q(Z,re,he,"","\\sqsubset",!0),Q(Z,re,he,"","\\preccurlyeq",!0),Q(Z,re,he,"","\\curlyeqprec",!0),Q(Z,re,he,"","\\precsim",!0),Q(Z,re,he,"","\\precapprox",!0),Q(Z,re,he,"","\\vartriangleleft"),Q(Z,re,he,"","\\trianglelefteq"),Q(Z,re,he,"","\\vDash",!0),Q(Z,re,he,"","\\Vvdash",!0),Q(Z,re,he,"","\\smallsmile"),Q(Z,re,he,"","\\smallfrown"),Q(Z,re,he,"","\\bumpeq",!0),Q(Z,re,he,"","\\Bumpeq",!0),Q(Z,re,he,"","\\geqq",!0),Q(Z,re,he,"","\\geqslant",!0),Q(Z,re,he,"","\\eqslantgtr",!0),Q(Z,re,he,"","\\gtrsim",!0),Q(Z,re,he,"","\\gtrapprox",!0),Q(Z,re,ie,"","\\gtrdot"),Q(Z,re,he,"","\\ggg",!0),Q(Z,re,he,"","\\gtrless",!0),Q(Z,re,he,"","\\gtreqless",!0),Q(Z,re,he,"","\\gtreqqless",!0),Q(Z,re,he,"","\\eqcirc",!0),Q(Z,re,he,"","\\circeq",!0),Q(Z,re,he,"","\\triangleq",!0),Q(Z,re,he,"","\\thicksim"),Q(Z,re,he,"","\\thickapprox"),Q(Z,re,he,"","\\supseteqq",!0),Q(Z,re,he,"","\\Supset",!0),Q(Z,re,he,"","\\sqsupset",!0),Q(Z,re,he,"","\\succcurlyeq",!0),Q(Z,re,he,"","\\curlyeqsucc",!0),Q(Z,re,he,"","\\succsim",!0),Q(Z,re,he,"","\\succapprox",!0),Q(Z,re,he,"","\\vartriangleright"),Q(Z,re,he,"","\\trianglerighteq"),Q(Z,re,he,"","\\Vdash",!0),Q(Z,re,he,"","\\shortmid"),Q(Z,re,he,"","\\shortparallel"),Q(Z,re,he,"","\\between",!0),Q(Z,re,he,"","\\pitchfork",!0),Q(Z,re,he,"","\\varpropto"),Q(Z,re,he,"","\\blacktriangleleft"),Q(Z,re,he,"","\\therefore",!0),Q(Z,re,he,"","\\backepsilon"),Q(Z,re,he,"","\\blacktriangleright"),Q(Z,re,he,"","\\because",!0),Q(Z,re,he,"","\\llless"),Q(Z,re,he,"","\\gggtr"),Q(Z,re,ie,"","\\lhd"),Q(Z,re,ie,"","\\rhd"),Q(Z,re,he,"","\\eqsim",!0),Q(Z,te,he,"","\\Join"),Q(Z,re,he,"","\\Doteq",!0),Q(Z,re,ie,"","\\dotplus",!0),Q(Z,re,ie,"","\\smallsetminus"),Q(Z,re,ie,"","\\Cap",!0),Q(Z,re,ie,"","\\Cup",!0),Q(Z,re,ie,"","\\doublebarwedge",!0),Q(Z,re,ie,"","\\boxminus",!0),Q(Z,re,ie,"","\\boxplus",!0),Q(Z,re,ie,"","\\divideontimes",!0),Q(Z,re,ie,"","\\ltimes",!0),Q(Z,re,ie,"","\\rtimes",!0),Q(Z,re,ie,"","\\leftthreetimes",!0),Q(Z,re,ie,"","\\rightthreetimes",!0),Q(Z,re,ie,"","\\curlywedge",!0),Q(Z,re,ie,"","\\curlyvee",!0),Q(Z,re,ie,"","\\circleddash",!0),Q(Z,re,ie,"","\\circledast",!0),Q(Z,re,ie,"","\\centerdot"),Q(Z,re,ie,"","\\intercal",!0),Q(Z,re,ie,"","\\doublecap"),Q(Z,re,ie,"","\\doublecup"),Q(Z,re,ie,"","\\boxtimes",!0),Q(Z,re,he,"","\\dashrightarrow",!0),Q(Z,re,he,"","\\dashleftarrow",!0),Q(Z,re,he,"","\\leftleftarrows",!0),Q(Z,re,he,"","\\leftrightarrows",!0),Q(Z,re,he,"","\\Lleftarrow",!0),Q(Z,re,he,"","\\twoheadleftarrow",!0),Q(Z,re,he,"","\\leftarrowtail",!0),Q(Z,re,he,"","\\looparrowleft",!0),Q(Z,re,he,"","\\leftrightharpoons",!0),Q(Z,re,he,"","\\curvearrowleft",!0),Q(Z,re,he,"","\\circlearrowleft",!0),Q(Z,re,he,"","\\Lsh",!0),Q(Z,re,he,"","\\upuparrows",!0),Q(Z,re,he,"","\\upharpoonleft",!0),Q(Z,re,he,"","\\downharpoonleft",!0),Q(Z,te,he,"","\\origof",!0),Q(Z,te,he,"","\\imageof",!0),Q(Z,re,he,"","\\multimap",!0),Q(Z,re,he,"","\\leftrightsquigarrow",!0),Q(Z,re,he,"","\\rightrightarrows",!0),Q(Z,re,he,"","\\rightleftarrows",!0),Q(Z,re,he,"","\\twoheadrightarrow",!0),Q(Z,re,he,"","\\rightarrowtail",!0),Q(Z,re,he,"","\\looparrowright",!0),Q(Z,re,he,"","\\curvearrowright",!0),Q(Z,re,he,"","\\circlearrowright",!0),Q(Z,re,he,"","\\Rsh",!0),Q(Z,re,he,"","\\downdownarrows",!0),Q(Z,re,he,"","\\upharpoonright",!0),Q(Z,re,he,"","\\downharpoonright",!0),Q(Z,re,he,"","\\rightsquigarrow",!0),Q(Z,re,he,"","\\leadsto"),Q(Z,re,he,"","\\Rrightarrow",!0),Q(Z,re,he,"","\\restriction"),Q(Z,te,pe,"","`"),Q(Z,te,pe,"$","\\$"),Q(ee,te,pe,"$","\\$"),Q(ee,te,pe,"$","\\textdollar"),Q(Z,te,pe,"%","\\%"),Q(ee,te,pe,"%","\\%"),Q(Z,te,pe,"_","\\_"),Q(ee,te,pe,"_","\\_"),Q(ee,te,pe,"_","\\textunderscore"),Q(Z,te,pe,"","\\angle",!0),Q(Z,te,pe,"","\\infty",!0),Q(Z,te,pe,"","\\prime"),Q(Z,te,pe,"","\\triangle"),Q(Z,te,pe,"","\\Gamma",!0),Q(Z,te,pe,"","\\Delta",!0),Q(Z,te,pe,"","\\Theta",!0),Q(Z,te,pe,"","\\Lambda",!0),Q(Z,te,pe,"","\\Xi",!0),Q(Z,te,pe,"","\\Pi",!0),Q(Z,te,pe,"","\\Sigma",!0),Q(Z,te,pe,"","\\Upsilon",!0),Q(Z,te,pe,"","\\Phi",!0),Q(Z,te,pe,"","\\Psi",!0),Q(Z,te,pe,"","\\Omega",!0),Q(Z,te,pe,"A",""),Q(Z,te,pe,"B",""),Q(Z,te,pe,"E",""),Q(Z,te,pe,"Z",""),Q(Z,te,pe,"H",""),Q(Z,te,pe,"I",""),Q(Z,te,pe,"K",""),Q(Z,te,pe,"M",""),Q(Z,te,pe,"N",""),Q(Z,te,pe,"O",""),Q(Z,te,pe,"P",""),Q(Z,te,pe,"T",""),Q(Z,te,pe,"X",""),Q(Z,te,pe,"","\\neg",!0),Q(Z,te,pe,"","\\lnot"),Q(Z,te,pe,"","\\top"),Q(Z,te,pe,"","\\bot"),Q(Z,te,pe,"","\\emptyset"),Q(Z,re,pe,"","\\varnothing"),Q(Z,te,ae,"","\\alpha",!0),Q(Z,te,ae,"","\\beta",!0),Q(Z,te,ae,"","\\gamma",!0),Q(Z,te,ae,"","\\delta",!0),Q(Z,te,ae,"","\\epsilon",!0),Q(Z,te,ae,"","\\zeta",!0),Q(Z,te,ae,"","\\eta",!0),Q(Z,te,ae,"","\\theta",!0),Q(Z,te,ae,"","\\iota",!0),Q(Z,te,ae,"","\\kappa",!0),Q(Z,te,ae,"","\\lambda",!0),Q(Z,te,ae,"","\\mu",!0),Q(Z,te,ae,"","\\nu",!0),Q(Z,te,ae,"","\\xi",!0),Q(Z,te,ae,"","\\omicron",!0),Q(Z,te,ae,"","\\pi",!0),Q(Z,te,ae,"","\\rho",!0),Q(Z,te,ae,"","\\sigma",!0),Q(Z,te,ae,"","\\tau",!0),Q(Z,te,ae,"","\\upsilon",!0),Q(Z,te,ae,"","\\phi",!0),Q(Z,te,ae,"","\\chi",!0),Q(Z,te,ae,"","\\psi",!0),Q(Z,te,ae,"","\\omega",!0),Q(Z,te,ae,"","\\varepsilon",!0),Q(Z,te,ae,"","\\vartheta",!0),Q(Z,te,ae,"","\\varpi",!0),Q(Z,te,ae,"","\\varrho",!0),Q(Z,te,ae,"","\\varsigma",!0),Q(Z,te,ae,"","\\varphi",!0),Q(Z,te,ie,"","*"),Q(Z,te,ie,"+","+"),Q(Z,te,ie,"","-"),Q(Z,te,ie,"","\\cdot",!0),Q(Z,te,ie,"","\\circ"),Q(Z,te,ie,"","\\div",!0),Q(Z,te,ie,"","\\pm",!0),Q(Z,te,ie,"","\\times",!0),Q(Z,te,ie,"","\\cap",!0),Q(Z,te,ie,"","\\cup",!0),Q(Z,te,ie,"","\\setminus"),Q(Z,te,ie,"","\\land"),Q(Z,te,ie,"","\\lor"),Q(Z,te,ie,"","\\wedge",!0),Q(Z,te,ie,"","\\vee",!0),Q(Z,te,pe,"","\\surd"),Q(Z,te,le,"","\\langle",!0),Q(Z,te,le,"","\\lvert"),Q(Z,te,le,"","\\lVert"),Q(Z,te,se,"?","?"),Q(Z,te,se,"!","!"),Q(Z,te,se,"","\\rangle",!0),Q(Z,te,se,"","\\rvert"),Q(Z,te,se,"","\\rVert"),Q(Z,te,he,"=","="),Q(Z,te,he,":",":"),Q(Z,te,he,"","\\approx",!0),Q(Z,te,he,"","\\cong",!0),Q(Z,te,he,"","\\ge"),Q(Z,te,he,"","\\geq",!0),Q(Z,te,he,"","\\gets"),Q(Z,te,he,">","\\gt",!0),Q(Z,te,he,"","\\in",!0),Q(Z,te,he,"","\\@not"),Q(Z,te,he,"","\\subset",!0),Q(Z,te,he,"","\\supset",!0),Q(Z,te,he,"","\\subseteq",!0),Q(Z,te,he,"","\\supseteq",!0),Q(Z,re,he,"","\\nsubseteq",!0),Q(Z,re,he,"","\\nsupseteq",!0),Q(Z,te,he,"","\\models"),Q(Z,te,he,"","\\leftarrow",!0),Q(Z,te,he,"","\\le"),Q(Z,te,he,"","\\leq",!0),Q(Z,te,he,"<","\\lt",!0),Q(Z,te,he,"","\\rightarrow",!0),Q(Z,te,he,"","\\to"),Q(Z,re,he,"","\\ngeq",!0),Q(Z,re,he,"","\\nleq",!0),Q(Z,te,de,"","\\ "),Q(Z,te,de,"","~"),Q(Z,te,de,"","\\space"),Q(Z,te,de,"","\\nobreakspace"),Q(ee,te,de,"","\\ "),Q(ee,te,de,""," "),Q(ee,te,de,"","~"),Q(ee,te,de,"","\\space"),Q(ee,te,de,"","\\nobreakspace"),Q(Z,te,de,null,"\\nobreak"),Q(Z,te,de,null,"\\allowbreak"),Q(Z,te,ue,",",","),Q(Z,te,ue,";",";"),Q(Z,re,ie,"","\\barwedge",!0),Q(Z,re,ie,"","\\veebar",!0),Q(Z,te,ie,"","\\odot",!0),Q(Z,te,ie,"","\\oplus",!0),Q(Z,te,ie,"","\\otimes",!0),Q(Z,te,pe,"","\\partial",!0),Q(Z,te,ie,"","\\oslash",!0),Q(Z,re,ie,"","\\circledcirc",!0),Q(Z,re,ie,"","\\boxdot",!0),Q(Z,te,ie,"","\\bigtriangleup"),Q(Z,te,ie,"","\\bigtriangledown"),Q(Z,te,ie,"","\\dagger"),Q(Z,te,ie,"","\\diamond"),Q(Z,te,ie,"","\\star"),Q(Z,te,ie,"","\\triangleleft"),Q(Z,te,ie,"","\\triangleright"),Q(Z,te,le,"{","\\{"),Q(ee,te,pe,"{","\\{"),Q(ee,te,pe,"{","\\textbraceleft"),Q(Z,te,se,"}","\\}"),Q(ee,te,pe,"}","\\}"),Q(ee,te,pe,"}","\\textbraceright"),Q(Z,te,le,"{","\\lbrace"),Q(Z,te,se,"}","\\rbrace"),Q(Z,te,le,"[","\\lbrack",!0),Q(ee,te,pe,"[","\\lbrack",!0),Q(Z,te,se,"]","\\rbrack",!0),Q(ee,te,pe,"]","\\rbrack",!0),Q(Z,te,le,"(","\\lparen",!0),Q(Z,te,se,")","\\rparen",!0),Q(ee,te,pe,"<","\\textless",!0),Q(ee,te,pe,">","\\textgreater",!0),Q(Z,te,le,"","\\lfloor",!0),Q(Z,te,se,"","\\rfloor",!0),Q(Z,te,le,"","\\lceil",!0),Q(Z,te,se,"","\\rceil",!0),Q(Z,te,pe,"\\","\\backslash"),Q(Z,te,pe,"","|"),Q(Z,te,pe,"","\\vert"),Q(ee,te,pe,"|","\\textbar",!0),Q(Z,te,pe,"","\\|"),Q(Z,te,pe,"","\\Vert"),Q(ee,te,pe,"","\\textbardbl"),Q(ee,te,pe,"~","\\textasciitilde"),Q(ee,te,pe,"\\","\\textbackslash"),Q(ee,te,pe,"^","\\textasciicircum"),Q(Z,te,he,"","\\uparrow",!0),Q(Z,te,he,"","\\Uparrow",!0),Q(Z,te,he,"","\\downarrow",!0),Q(Z,te,he,"","\\Downarrow",!0),Q(Z,te,he,"","\\updownarrow",!0),Q(Z,te,he,"","\\Updownarrow",!0),Q(Z,te,ce,"","\\coprod"),Q(Z,te,ce,"","\\bigvee"),Q(Z,te,ce,"","\\bigwedge"),Q(Z,te,ce,"","\\biguplus"),Q(Z,te,ce,"","\\bigcap"),Q(Z,te,ce,"","\\bigcup"),Q(Z,te,ce,"","\\int"),Q(Z,te,ce,"","\\intop"),Q(Z,te,ce,"","\\iint"),Q(Z,te,ce,"","\\iiint"),Q(Z,te,ce,"","\\prod"),Q(Z,te,ce,"","\\sum"),Q(Z,te,ce,"","\\bigotimes"),Q(Z,te,ce,"","\\bigoplus"),Q(Z,te,ce,"","\\bigodot"),Q(Z,te,ce,"","\\oint"),Q(Z,te,ce,"","\\oiint"),Q(Z,te,ce,"","\\oiiint"),Q(Z,te,ce,"","\\bigsqcup"),Q(Z,te,ce,"","\\smallint"),Q(ee,te,oe,"","\\textellipsis"),Q(Z,te,oe,"","\\mathellipsis"),Q(ee,te,oe,"","\\ldots",!0),Q(Z,te,oe,"","\\ldots",!0),Q(Z,te,oe,"","\\@cdots",!0),Q(Z,te,oe,"","\\ddots",!0),Q(Z,te,pe,"","\\varvdots"),Q(Z,te,ne,"","\\acute"),Q(Z,te,ne,"","\\grave"),Q(Z,te,ne,"","\\ddot"),Q(Z,te,ne,"~","\\tilde"),Q(Z,te,ne,"","\\bar"),Q(Z,te,ne,"","\\breve"),Q(Z,te,ne,"","\\check"),Q(Z,te,ne,"^","\\hat"),Q(Z,te,ne,"","\\vec"),Q(Z,te,ne,"","\\dot"),Q(Z,te,ne,"","\\mathring"),Q(Z,te,ae,"","\\@imath"),Q(Z,te,ae,"","\\@jmath"),Q(Z,te,pe,"",""),Q(Z,te,pe,"",""),Q(ee,te,pe,"","\\i",!0),Q(ee,te,pe,"","\\j",!0),Q(ee,te,pe,"","\\ss",!0),Q(ee,te,pe,"","\\ae",!0),Q(ee,te,pe,"","\\oe",!0),Q(ee,te,pe,"","\\o",!0),Q(ee,te,pe,"","\\AE",!0),Q(ee,te,pe,"","\\OE",!0),Q(ee,te,pe,"","\\O",!0),Q(ee,te,ne,"","\\'"),Q(ee,te,ne,"","\\`"),Q(ee,te,ne,"","\\^"),Q(ee,te,ne,"","\\~"),Q(ee,te,ne,"","\\="),Q(ee,te,ne,"","\\u"),Q(ee,te,ne,"","\\."),Q(ee,te,ne,"","\\r"),Q(ee,te,ne,"","\\v"),Q(ee,te,ne,"",'\\"'),Q(ee,te,ne,"","\\H"),Q(ee,te,ne,"","\\textcircled");var fe={"--":!0,"---":!0,"``":!0,"''":!0};Q(ee,te,pe,"","--",!0),Q(ee,te,pe,"","\\textendash"),Q(ee,te,pe,"","---",!0),Q(ee,te,pe,"","\\textemdash"),Q(ee,te,pe,"","`",!0),Q(ee,te,pe,"","\\textquoteleft"),Q(ee,te,pe,"","'",!0),Q(ee,te,pe,"","\\textquoteright"),Q(ee,te,pe,"","``",!0),Q(ee,te,pe,"","\\textquotedblleft"),Q(ee,te,pe,"","''",!0),Q(ee,te,pe,"","\\textquotedblright"),Q(Z,te,pe,"","\\degree",!0),Q(ee,te,pe,"","\\degree"),Q(ee,te,pe,"","\\textdegree",!0),Q(Z,te,pe,"","\\pounds"),Q(Z,te,pe,"","\\mathsterling",!0),Q(ee,te,pe,"","\\pounds"),Q(ee,te,pe,"","\\textsterling",!0),Q(Z,re,pe,"","\\maltese"),Q(ee,re,pe,"","\\maltese");for(var ge='0123456789/@."',me=0;me<ge.length;me++){var ye=ge.charAt(me);Q(Z,te,pe,ye,ye)}for(var ve='0123456789!@*()-=+";:?/.,',_e=0;_e<ve.length;_e++){var be=ve.charAt(_e);Q(ee,te,pe,be,be)}for(var we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Se=0;Se<we.length;Se++){var ke=we.charAt(Se);Q(Z,te,ae,ke,ke),Q(ee,te,pe,ke,ke)}Q(Z,re,pe,"C",""),Q(ee,re,pe,"C",""),Q(Z,re,pe,"H",""),Q(ee,re,pe,"H",""),Q(Z,re,pe,"N",""),Q(ee,re,pe,"N",""),Q(Z,re,pe,"P",""),Q(ee,re,pe,"P",""),Q(Z,re,pe,"Q",""),Q(ee,re,pe,"Q",""),Q(Z,re,pe,"R",""),Q(ee,re,pe,"R",""),Q(Z,re,pe,"Z",""),Q(ee,re,pe,"Z",""),Q(Z,te,ae,"h",""),Q(ee,te,ae,"h","");for(var Ee="",xe=0;xe<we.length;xe++){var Ae=we.charAt(xe);Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56320+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56372+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56424+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56580+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56736+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56788+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56840+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56944+xe)),Q(ee,te,pe,Ae,Ee),xe<26&&(Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56632+xe)),Q(ee,te,pe,Ae,Ee),Q(Z,te,ae,Ae,Ee=String.fromCharCode(55349,56476+xe)),Q(ee,te,pe,Ae,Ee))}Q(Z,te,ae,"k",Ee=String.fromCharCode(55349,56668)),Q(ee,te,pe,"k",Ee);for(var Te=0;Te<10;Te++){var Ce=Te.toString();Q(Z,te,ae,Ce,Ee=String.fromCharCode(55349,57294+Te)),Q(ee,te,pe,Ce,Ee),Q(Z,te,ae,Ce,Ee=String.fromCharCode(55349,57314+Te)),Q(ee,te,pe,Ce,Ee),Q(Z,te,ae,Ce,Ee=String.fromCharCode(55349,57324+Te)),Q(ee,te,pe,Ce,Ee),Q(Z,te,ae,Ce,Ee=String.fromCharCode(55349,57334+Te)),Q(ee,te,pe,Ce,Ee)}for(var Ie="",Re=0;Re<Ie.length;Re++){var Oe=Ie.charAt(Re);Q(Z,te,ae,Oe,Oe),Q(ee,te,pe,Oe,Oe)}var Pe=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["","",""],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],De=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],Me=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],Le=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],Ne=function(e,t){return t.size<2?e:Me[e-1][t.size-1]},Fe=function(){function e(t){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=t.style,this.color=t.color,this.size=t.size||e.BASESIZE,this.textSize=t.textSize||this.size,this.phantom=!!t.phantom,this.font=t.font||"",this.fontFamily=t.fontFamily||"",this.fontWeight=t.fontWeight||"",this.fontShape=t.fontShape||"",this.sizeMultiplier=Le[this.size-1],this.maxSize=t.maxSize,this.minRuleThickness=t.minRuleThickness,this._fontMetrics=void 0}var t=e.prototype;return t.extend=function(t){var r={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return new e(r)},t.havingStyle=function(e){return this.style===e?this:this.extend({style:e,size:Ne(this.textSize,e)})},t.havingCrampedStyle=function(){return this.havingStyle(this.style.cramp())},t.havingSize=function(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:Le[e-1]})},t.havingBaseStyle=function(t){t=t||this.style.text();var r=Ne(e.BASESIZE,t);return this.size===r&&this.textSize===e.BASESIZE&&this.style===t?this:this.extend({style:t,size:r})},t.havingBaseSizing=function(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})},t.withColor=function(e){return this.extend({color:e})},t.withPhantom=function(){return this.extend({phantom:!0})},t.withFont=function(e){return this.extend({font:e})},t.withTextFontFamily=function(e){return this.extend({fontFamily:e,font:""})},t.withTextFontWeight=function(e){return this.extend({fontWeight:e,font:""})},t.withTextFontShape=function(e){return this.extend({fontShape:e,font:""})},t.sizingClasses=function(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]},t.baseSizingClasses=function(){return this.size!==e.BASESIZE?["sizing","reset-size"+this.size,"size"+e.BASESIZE]:[]},t.fontMetrics=function(){return this._fontMetrics||(this._fontMetrics=function(e){var t;if(!H[t=e>=5?0:e>=3?1:2]){var r=H[t]={cssEmPerMu:$.quad[t]/18};for(var n in $)$.hasOwnProperty(n)&&(r[n]=$[n][t])}return H[t]}(this.size)),this._fontMetrics},t.getColor=function(){return this.phantom?"transparent":this.color},e}();Fe.BASESIZE=6;var Be=Fe,Ue={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:1.00375,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:1.00375},qe={ex:!0,em:!0,mu:!0},je=function(e){return"string"!=typeof e&&(e=e.unit),e in Ue||e in qe||"ex"===e},Ke=function(e,t){var r;if(e.unit in Ue)r=Ue[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if("mu"===e.unit)r=t.fontMetrics().cssEmPerMu;else{var i;if(i=t.style.isTight()?t.havingStyle(t.style.text()):t,"ex"===e.unit)r=i.fontMetrics().xHeight;else{if("em"!==e.unit)throw new n("Invalid unit: '"+e.unit+"'");r=i.fontMetrics().quad}i!==t&&(r*=i.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*r,t.maxSize)},ze=function(e,t,r){return J[r][e]&&J[r][e].replace&&(e=J[r][e].replace),{value:e,metrics:V(e,t,r)}},$e=function(e,t,r,n,i){var s,o=ze(e,t,r),a=o.metrics;if(e=o.value,a){var c=a.italic;("text"===r||n&&"mathit"===n.font)&&(c=0),s=new B(e,a.height,a.depth,c,a.skew,a.width,i)}else"undefined"!=typeof console&&console.warn("No character metrics for '"+e+"' in style '"+t+"' and mode '"+r+"'"),s=new B(e,0,0,0,0,0,i);if(n){s.maxFontSize=n.sizeMultiplier,n.style.isTight()&&s.classes.push("mtight");var l=n.getColor();l&&(s.style.color=l)}return s},Ge=function(e,t){if(R(e.classes)!==R(t.classes)||e.skew!==t.skew||e.maxFontSize!==t.maxFontSize)return!1;if(1===e.classes.length){var r=e.classes[0];if("mbin"===r||"mord"===r)return!1}for(var n in e.style)if(e.style.hasOwnProperty(n)&&e.style[n]!==t.style[n])return!1;for(var i in t.style)if(t.style.hasOwnProperty(i)&&e.style[i]!==t.style[i])return!1;return!0},Ve=function(e){for(var t=0,r=0,n=0,i=0;i<e.children.length;i++){var s=e.children[i];s.height>t&&(t=s.height),s.depth>r&&(r=s.depth),s.maxFontSize>n&&(n=s.maxFontSize)}e.height=t,e.depth=r,e.maxFontSize=n},He=function(e,t,r,n){var i=new M(e,t,r,n);return Ve(i),i},We=function(e,t,r,n){return new M(e,t,r,n)},Ye=function(e){var t=new I(e);return Ve(t),t},Xe=function(e,t,r){var n="";switch(e){case"amsrm":n="AMS";break;case"textrm":n="Main";break;case"textsf":n="SansSerif";break;case"texttt":n="Typewriter";break;default:n=e}return n+"-"+("textbf"===t&&"textit"===r?"BoldItalic":"textbf"===t?"Bold":"textit"===t?"Italic":"Regular")},Je={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},Qe={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},Ze={fontMap:Je,makeSymbol:$e,mathsym:function(e,t,r,n){return void 0===n&&(n=[]),"boldsymbol"===r.font&&ze(e,"Main-Bold",t).metrics?$e(e,"Main-Bold",t,r,n.concat(["mathbf"])):"\\"===e||"main"===J[t][e].font?$e(e,"Main-Regular",t,r,n):$e(e,"AMS-Regular",t,r,n.concat(["amsrm"]))},makeSpan:He,makeSvgSpan:We,makeLineSpan:function(e,t,r){var n=He([e],[],t);return n.height=Math.max(r||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),n.style.borderBottomWidth=n.height+"em",n.maxFontSize=1,n},makeAnchor:function(e,t,r,n){var i=new L(e,t,r,n);return Ve(i),i},makeFragment:Ye,wrapFragment:function(e,t){return e instanceof I?He([],[e],t):e},makeVList:function(e,t){for(var r=function(e){if("individualShift"===e.positionType){for(var t=e.children,r=[t[0]],n=-t[0].shift-t[0].elem.depth,i=n,s=1;s<t.length;s++){var o=-t[s].shift-i-t[s].elem.depth,a=o-(t[s-1].elem.height+t[s-1].elem.depth);i+=o,r.push({type:"kern",size:a}),r.push(t[s])}return{children:r,depth:n}}var c;if("top"===e.positionType){for(var l=e.positionData,u=0;u<e.children.length;u++){var h=e.children[u];l-="kern"===h.type?h.size:h.elem.height+h.elem.depth}c=l}else if("bottom"===e.positionType)c=-e.positionData;else{var d=e.children[0];if("elem"!==d.type)throw new Error('First child must have type "elem".');if("shift"===e.positionType)c=-d.elem.depth-e.positionData;else{if("firstBaseline"!==e.positionType)throw new Error("Invalid positionType "+e.positionType+".");c=-d.elem.depth}}return{children:e.children,depth:c}}(e),n=r.children,i=r.depth,s=0,o=0;o<n.length;o++){var a=n[o];if("elem"===a.type){var c=a.elem;s=Math.max(s,c.maxFontSize,c.height)}}s+=2;var l=He(["pstrut"],[]);l.style.height=s+"em";for(var u=[],h=i,d=i,p=i,f=0;f<n.length;f++){var g=n[f];if("kern"===g.type)p+=g.size;else{var m=g.elem,y=g.wrapperClasses||[],v=g.wrapperStyle||{},_=He(y,[l,m],void 0,v);_.style.top=-s-p-m.depth+"em",g.marginLeft&&(_.style.marginLeft=g.marginLeft),g.marginRight&&(_.style.marginRight=g.marginRight),u.push(_),p+=m.height+m.depth}h=Math.min(h,p),d=Math.max(d,p)}var b,w=He(["vlist"],u);if(w.style.height=d+"em",h<0){var S=He([],[]),k=He(["vlist"],[S]);k.style.height=-h+"em";var E=He(["vlist-s"],[new B("")]);b=[He(["vlist-r"],[w,E]),He(["vlist-r"],[k])]}else b=[He(["vlist-r"],[w])];var x=He(["vlist-t"],b);return 2===b.length&&x.classes.push("vlist-t2"),x.height=d,x.depth=-h,x},makeOrd:function(e,t,r){var i=e.mode,s=e.text,o=["mord"],a="math"===i||"text"===i&&t.font,c=a?t.font:t.fontFamily;if(55349===s.charCodeAt(0)){var l=function(e,t){var r=1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536,i="math"===t?0:1;if(119808<=r&&r<120484){var s=Math.floor((r-119808)/26);return[Pe[s][2],Pe[s][i]]}if(120782<=r&&r<=120831){var o=Math.floor((r-120782)/10);return[De[o][2],De[o][i]]}if(120485===r||120486===r)return[Pe[0][2],Pe[0][i]];if(120486<r&&r<120782)return["",""];throw new n("Unsupported character: "+e)}(s,i),u=l[0],h=l[1];return $e(s,u,i,t,o.concat(h))}if(c){var d,p;if("boldsymbol"===c){var f=function(e,t,r,n,i){return"textord"!==i&&ze(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}}(s,i,0,0,r);d=f.fontName,p=[f.fontClass]}else a?(d=Je[c].fontName,p=[c]):(d=Xe(c,t.fontWeight,t.fontShape),p=[c,t.fontWeight,t.fontShape]);if(ze(s,d,i).metrics)return $e(s,d,i,t,o.concat(p));if(fe.hasOwnProperty(s)&&"Typewriter"===d.substr(0,10)){for(var g=[],m=0;m<s.length;m++)g.push($e(s[m],d,i,t,o.concat(p)));return Ye(g)}}if("mathord"===r)return $e(s,"Math-Italic",i,t,o.concat(["mathnormal"]));if("textord"===r){var y=J[i][s]&&J[i][s].font;if("ams"===y){var v=Xe("amsrm",t.fontWeight,t.fontShape);return $e(s,v,i,t,o.concat("amsrm",t.fontWeight,t.fontShape))}if("main"!==y&&y){var _=Xe(y,t.fontWeight,t.fontShape);return $e(s,_,i,t,o.concat(_,t.fontWeight,t.fontShape))}var b=Xe("textrm",t.fontWeight,t.fontShape);return $e(s,b,i,t,o.concat(t.fontWeight,t.fontShape))}throw new Error("unexpected type: "+r+" in makeOrd")},makeGlue:function(e,t){var r=He(["mspace"],[],t),n=Ke(e,t);return r.style.marginRight=n+"em",r},staticSvg:function(e,t){var r=Qe[e],n=r[0],i=r[1],s=r[2],o=new q(n),a=new U([o],{width:i+"em",height:s+"em",style:"width:"+i+"em",viewBox:"0 0 "+1e3*i+" "+1e3*s,preserveAspectRatio:"xMinYMin"}),c=We(["overlay"],[a],t);return c.height=s,c.style.height=s+"em",c.style.width=i+"em",c},svgData:Qe,tryCombineChars:function(e){for(var t=0;t<e.length-1;t++){var r=e[t],n=e[t+1];r instanceof B&&n instanceof B&&Ge(r,n)&&(r.text+=n.text,r.height=Math.max(r.height,n.height),r.depth=Math.max(r.depth,n.depth),r.italic=n.italic,e.splice(t+1,1),t--)}return e}},et={number:3,unit:"mu"},tt={number:4,unit:"mu"},rt={number:5,unit:"mu"},nt={mord:{mop:et,mbin:tt,mrel:rt,minner:et},mop:{mord:et,mop:et,mrel:rt,minner:et},mbin:{mord:tt,mop:tt,mopen:tt,minner:tt},mrel:{mord:rt,mop:rt,mopen:rt,minner:rt},mopen:{},mclose:{mop:et,mbin:tt,mrel:rt,minner:et},mpunct:{mord:et,mop:et,mrel:rt,mopen:et,mclose:et,mpunct:et,minner:et},minner:{mord:et,mop:et,mbin:tt,mrel:rt,mopen:et,mpunct:et,minner:et}},it={mord:{mop:et},mop:{mord:et,mop:et},mbin:{},mrel:{},mopen:{},mclose:{mop:et},mpunct:{},minner:{mop:et}},st={},ot={},at={};function ct(e){for(var t=e.type,r=e.names,n=e.props,i=e.handler,s=e.htmlBuilder,o=e.mathmlBuilder,a={type:t,numArgs:n.numArgs,argTypes:n.argTypes,allowedInArgument:!!n.allowedInArgument,allowedInText:!!n.allowedInText,allowedInMath:void 0===n.allowedInMath||n.allowedInMath,numOptionalArgs:n.numOptionalArgs||0,infix:!!n.infix,primitive:!!n.primitive,handler:i},c=0;c<r.length;++c)st[r[c]]=a;t&&(s&&(ot[t]=s),o&&(at[t]=o))}function lt(e){ct({type:e.type,names:[],props:{numArgs:0},handler:function(){throw new Error("Should never be called.")},htmlBuilder:e.htmlBuilder,mathmlBuilder:e.mathmlBuilder})}var ut=function(e){return"ordgroup"===e.type&&1===e.body.length?e.body[0]:e},ht=function(e){return"ordgroup"===e.type?e.body:[e]},dt=Ze.makeSpan,pt=["leftmost","mbin","mopen","mrel","mop","mpunct"],ft=["rightmost","mrel","mclose","mpunct"],gt={display:E.DISPLAY,text:E.TEXT,script:E.SCRIPT,scriptscript:E.SCRIPTSCRIPT},mt={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},yt=function(e,t,r,n){void 0===n&&(n=[null,null]);for(var i=[],s=0;s<e.length;s++){var o=kt(e[s],t);if(o instanceof I){var a=o.children;i.push.apply(i,a)}else i.push(o)}if(Ze.tryCombineChars(i),!r)return i;var l=t;if(1===e.length){var u=e[0];"sizing"===u.type?l=t.havingSize(u.size):"styling"===u.type&&(l=t.havingStyle(gt[u.style]))}var h=dt([n[0]||"leftmost"],[],t),d=dt([n[1]||"rightmost"],[],t),p="root"===r;return vt(i,(function(e,t){var r=t.classes[0],n=e.classes[0];"mbin"===r&&c(ft,n)?t.classes[0]="mord":"mbin"===n&&c(pt,r)&&(e.classes[0]="mord")}),{node:h},d,p),vt(i,(function(e,t){var r=wt(t),n=wt(e),i=r&&n?e.hasClass("mtight")?it[r][n]:nt[r][n]:null;if(i)return Ze.makeGlue(i,l)}),{node:h},d,p),i},vt=function e(t,r,n,i,s){i&&t.push(i);for(var o=0;o<t.length;o++){var a=t[o],c=_t(a);if(c)e(c.children,r,n,null,s);else{var l=!a.hasClass("mspace");if(l){var u=r(a,n.node);u&&(n.insertAfter?n.insertAfter(u):(t.unshift(u),o++))}l?n.node=a:s&&a.hasClass("newline")&&(n.node=dt(["leftmost"])),n.insertAfter=function(e){return function(r){t.splice(e+1,0,r),o++}}(o)}}i&&t.pop()},_t=function(e){return e instanceof I||e instanceof L||e instanceof M&&e.hasClass("enclosing")?e:null},bt=function e(t,r){var n=_t(t);if(n){var i=n.children;if(i.length){if("right"===r)return e(i[i.length-1],"right");if("left"===r)return e(i[0],"left")}}return t},wt=function(e,t){return e?(t&&(e=bt(e,t)),mt[e.classes[0]]||null):null},St=function(e,t){var r=["nulldelimiter"].concat(e.baseSizingClasses());return dt(t.concat(r))},kt=function(e,t,r){if(!e)return dt();if(ot[e.type]){var i=ot[e.type](e,t);if(r&&t.size!==r.size){i=dt(t.sizingClasses(r),[i],t);var s=t.sizeMultiplier/r.sizeMultiplier;i.height*=s,i.depth*=s}return i}throw new n("Got group of unknown type: '"+e.type+"'")};function Et(e,t){var r=dt(["base"],e,t),n=dt(["strut"]);return n.style.height=r.height+r.depth+"em",n.style.verticalAlign=-r.depth+"em",r.children.unshift(n),r}function xt(e,t){var r=null;1===e.length&&"tag"===e[0].type&&(r=e[0].tag,e=e[0].body);var n,i=yt(e,t,"root");2===i.length&&i[1].hasClass("tag")&&(n=i.pop());for(var s,o=[],a=[],c=0;c<i.length;c++)if(a.push(i[c]),i[c].hasClass("mbin")||i[c].hasClass("mrel")||i[c].hasClass("allowbreak")){for(var l=!1;c<i.length-1&&i[c+1].hasClass("mspace")&&!i[c+1].hasClass("newline");)c++,a.push(i[c]),i[c].hasClass("nobreak")&&(l=!0);l||(o.push(Et(a,t)),a=[])}else i[c].hasClass("newline")&&(a.pop(),a.length>0&&(o.push(Et(a,t)),a=[]),o.push(i[c]));a.length>0&&o.push(Et(a,t)),r?((s=Et(yt(r,t,!0))).classes=["tag"],o.push(s)):n&&o.push(n);var u=dt(["katex-html"],o);if(u.setAttribute("aria-hidden","true"),s){var h=s.children[0];h.style.height=u.height+u.depth+"em",h.style.verticalAlign=-u.depth+"em"}return u}function At(e){return new I(e)}var Tt=function(){function e(e,t,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=r||[]}var t=e.prototype;return t.setAttribute=function(e,t){this.attributes[e]=t},t.getAttribute=function(e){return this.attributes[e]},t.toNode=function(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=R(this.classes));for(var r=0;r<this.children.length;r++)e.appendChild(this.children[r].toNode());return e},t.toMarkup=function(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=u(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+u(R(this.classes))+'"'),e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+"</"+this.type+">"},t.toText=function(){return this.children.map((function(e){return e.toText()})).join("")},e}(),Ct=function(){function e(e){this.text=void 0,this.text=e}var t=e.prototype;return t.toNode=function(){return document.createTextNode(this.text)},t.toMarkup=function(){return u(this.toText())},t.toText=function(){return this.text},e}(),It={MathNode:Tt,TextNode:Ct,SpaceNode:function(){function e(e){this.width=void 0,this.character=void 0,this.width=e,this.character=e>=.05555&&e<=.05556?"":e>=.1666&&e<=.1667?"":e>=.2222&&e<=.2223?"":e>=.2777&&e<=.2778?"":e>=-.05556&&e<=-.05555?"":e>=-.1667&&e<=-.1666?"":e>=-.2223&&e<=-.2222?"":e>=-.2778&&e<=-.2777?"":null}var t=e.prototype;return t.toNode=function(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",this.width+"em"),e},t.toMarkup=function(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+this.width+'em"/>'},t.toText=function(){return this.character?this.character:" "},e}(),newDocumentFragment:At},Rt=function(e,t,r){return!J[t][e]||!J[t][e].replace||55349===e.charCodeAt(0)||fe.hasOwnProperty(e)&&r&&(r.fontFamily&&"tt"===r.fontFamily.substr(4,2)||r.font&&"tt"===r.font.substr(4,2))||(e=J[t][e].replace),new It.TextNode(e)},Ot=function(e){return 1===e.length?e[0]:new It.MathNode("mrow",e)},Pt=function(e,t){if("texttt"===t.fontFamily)return"monospace";if("textsf"===t.fontFamily)return"textit"===t.fontShape&&"textbf"===t.fontWeight?"sans-serif-bold-italic":"textit"===t.fontShape?"sans-serif-italic":"textbf"===t.fontWeight?"bold-sans-serif":"sans-serif";if("textit"===t.fontShape&&"textbf"===t.fontWeight)return"bold-italic";if("textit"===t.fontShape)return"italic";if("textbf"===t.fontWeight)return"bold";var r=t.font;if(!r||"mathnormal"===r)return null;var n=e.mode;if("mathit"===r)return"italic";if("boldsymbol"===r)return"textord"===e.type?"bold":"bold-italic";if("mathbf"===r)return"bold";if("mathbb"===r)return"double-struck";if("mathfrak"===r)return"fraktur";if("mathscr"===r||"mathcal"===r)return"script";if("mathsf"===r)return"sans-serif";if("mathtt"===r)return"monospace";var i=e.text;return c(["\\imath","\\jmath"],i)?null:(J[n][i]&&J[n][i].replace&&(i=J[n][i].replace),V(i,Ze.fontMap[r].fontName,n)?Ze.fontMap[r].variant:null)},Dt=function(e,t,r){if(1===e.length){var n=Lt(e[0],t);return r&&n instanceof Tt&&"mo"===n.type&&(n.setAttribute("lspace","0em"),n.setAttribute("rspace","0em")),[n]}for(var i,s=[],o=0;o<e.length;o++){var a=Lt(e[o],t);if(a instanceof Tt&&i instanceof Tt){if("mtext"===a.type&&"mtext"===i.type&&a.getAttribute("mathvariant")===i.getAttribute("mathvariant")){var c;(c=i.children).push.apply(c,a.children);continue}if("mn"===a.type&&"mn"===i.type){var l;(l=i.children).push.apply(l,a.children);continue}if("mi"===a.type&&1===a.children.length&&"mn"===i.type){var u=a.children[0];if(u instanceof Ct&&"."===u.text){var h;(h=i.children).push.apply(h,a.children);continue}}else if("mi"===i.type&&1===i.children.length){var d=i.children[0];if(d instanceof Ct&&""===d.text&&("mo"===a.type||"mi"===a.type||"mn"===a.type)){var p=a.children[0];p instanceof Ct&&p.text.length>0&&(p.text=p.text.slice(0,1)+""+p.text.slice(1),s.pop())}}}s.push(a),i=a}return s},Mt=function(e,t,r){return Ot(Dt(e,t,r))},Lt=function(e,t){if(!e)return new It.MathNode("mrow");if(at[e.type])return at[e.type](e,t);throw new n("Got group of unknown type: '"+e.type+"'")};function Nt(e,t,r,n,i){var s,o=Dt(e,r);s=1===o.length&&o[0]instanceof Tt&&c(["mrow","mtable"],o[0].type)?o[0]:new It.MathNode("mrow",o);var a=new It.MathNode("annotation",[new It.TextNode(t)]);a.setAttribute("encoding","application/x-tex");var l=new It.MathNode("semantics",[s,a]),u=new It.MathNode("math",[l]);return u.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),n&&u.setAttribute("display","block"),Ze.makeSpan([i?"katex":"katex-mathml"],[u])}var Ft=function(e){return new Be({style:e.displayMode?E.DISPLAY:E.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},Bt=function(e,t){if(t.displayMode){var r=["katex-display"];t.leqno&&r.push("leqno"),t.fleqn&&r.push("fleqn"),e=Ze.makeSpan(r,[e])}return e},Ut={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\\\cdrightarrow":"","\\\\cdleftarrow":"","\\\\cdlongequal":"="},qt={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},jt=function(e){var t=new It.MathNode("mo",[new It.TextNode(Ut[e])]);return t.setAttribute("stretchy","true"),t},Kt=function(e,t){var r=function(){var r=4e5,n=e.label.substr(1);if(c(["widehat","widecheck","widetilde","utilde"],n)){var i,s,o,a="ordgroup"===(f=e.base).type?f.body.length:1;if(a>5)"widehat"===n||"widecheck"===n?(i=420,r=2364,o=.42,s=n+"4"):(i=312,r=2340,o=.34,s="tilde4");else{var l=[1,1,2,2,3,3][a];"widehat"===n||"widecheck"===n?(r=[0,1062,2364,2364,2364][l],i=[0,239,300,360,420][l],o=[0,.24,.3,.3,.36,.42][l],s=n+l):(r=[0,600,1033,2339,2340][l],i=[0,260,286,306,312][l],o=[0,.26,.286,.3,.306,.34][l],s="tilde"+l)}var u=new q(s),h=new U([u],{width:"100%",height:o+"em",viewBox:"0 0 "+r+" "+i,preserveAspectRatio:"none"});return{span:Ze.makeSvgSpan([],[h],t),minWidth:0,height:o}}var d,p,f,g=[],m=qt[n],y=m[0],v=m[1],_=m[2],b=_/1e3,w=y.length;if(1===w)d=["hide-tail"],p=[m[3]];else if(2===w)d=["halfarrow-left","halfarrow-right"],p=["xMinYMin","xMaxYMin"];else{if(3!==w)throw new Error("Correct katexImagesData or update code here to support\n                    "+w+" children.");d=["brace-left","brace-center","brace-right"],p=["xMinYMin","xMidYMin","xMaxYMin"]}for(var S=0;S<w;S++){var k=new q(y[S]),E=new U([k],{width:"400em",height:b+"em",viewBox:"0 0 "+r+" "+_,preserveAspectRatio:p[S]+" slice"}),x=Ze.makeSvgSpan([d[S]],[E],t);if(1===w)return{span:x,minWidth:v,height:b};x.style.height=b+"em",g.push(x)}return{span:Ze.makeSpan(["stretchy"],g,t),minWidth:v,height:b}}(),n=r.span,i=r.minWidth,s=r.height;return n.height=s,n.style.height=s+"em",i>0&&(n.style.minWidth=i+"em"),n};function zt(e,t){if(!e||e.type!==t)throw new Error("Expected node of type "+t+", but got "+(e?"node of type "+e.type:String(e)));return e}function $t(e){var t=Gt(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return t}function Gt(e){return e&&("atom"===e.type||Y.hasOwnProperty(e.type))?e:null}var Vt=function(e,t){var r,n,i;e&&"supsub"===e.type?(r=(n=zt(e.base,"accent")).base,e.base=r,i=function(e){if(e instanceof M)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}(kt(e,t)),e.base=n):r=(n=zt(e,"accent")).base;var s=kt(r,t.havingCrampedStyle()),o=0;if(n.isShifty&&p(r)){var a=d(r);o=K(kt(a,t.havingCrampedStyle())).skew}var c,l=Math.min(s.height,t.fontMetrics().xHeight);if(n.isStretchy)c=Kt(n,t),c=Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"elem",elem:c,wrapperClasses:["svg-align"],wrapperStyle:o>0?{width:"calc(100% - "+2*o+"em)",marginLeft:2*o+"em"}:void 0}]},t);else{var u,h;"\\vec"===n.label?(u=Ze.staticSvg("vec",t),h=Ze.svgData.vec[1]):((u=K(u=Ze.makeOrd({mode:n.mode,text:n.label},t,"textord"))).italic=0,h=u.width),c=Ze.makeSpan(["accent-body"],[u]);var f="\\textcircled"===n.label;f&&(c.classes.push("accent-full"),l=s.height);var g=o;f||(g-=h/2),c.style.left=g+"em","\\textcircled"===n.label&&(c.style.top=".2em"),c=Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:-l},{type:"elem",elem:c}]},t)}var m=Ze.makeSpan(["mord","accent"],[c],t);return i?(i.children[0]=m,i.height=Math.max(m.height,i.height),i.classes[0]="mord",i):m},Ht=function(e,t){var r=e.isStretchy?jt(e.label):new It.MathNode("mo",[Rt(e.label,e.mode)]),n=new It.MathNode("mover",[Lt(e.base,t),r]);return n.setAttribute("accent","true"),n},Wt=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map((function(e){return"\\"+e})).join("|"));ct({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:function(e,t){var r=ut(t[0]),n=!Wt.test(e.funcName),i=!n||"\\widehat"===e.funcName||"\\widetilde"===e.funcName||"\\widecheck"===e.funcName;return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:n,isShifty:i,base:r}},htmlBuilder:Vt,mathmlBuilder:Ht}),ct({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!1,argTypes:["primitive"]},handler:function(e,t){var r=t[0];return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:!1,isShifty:!0,base:r}},htmlBuilder:Vt,mathmlBuilder:Ht}),ct({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:function(e,t){var r=e.parser,n=e.funcName,i=t[0];return{type:"accentUnder",mode:r.mode,label:n,base:i}},htmlBuilder:function(e,t){var r=kt(e.base,t),n=Kt(e,t),i="\\utilde"===e.label?.12:0,s=Ze.makeVList({positionType:"top",positionData:r.height,children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:i},{type:"elem",elem:r}]},t);return Ze.makeSpan(["mord","accentunder"],[s],t)},mathmlBuilder:function(e,t){var r=jt(e.label),n=new It.MathNode("munder",[Lt(e.base,t),r]);return n.setAttribute("accentunder","true"),n}});var Yt=function(e){var t=new It.MathNode("mpadded",e?[e]:[]);return t.setAttribute("width","+0.6em"),t.setAttribute("lspace","0.3em"),t};ct({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler:function(e,t,r){var n=e.parser,i=e.funcName;return{type:"xArrow",mode:n.mode,label:i,body:t[0],below:r[0]}},htmlBuilder:function(e,t){var r,n=t.style,i=t.havingStyle(n.sup()),s=Ze.wrapFragment(kt(e.body,i,t),t),o="\\x"===e.label.slice(0,2)?"x":"cd";s.classes.push(o+"-arrow-pad"),e.below&&(i=t.havingStyle(n.sub()),(r=Ze.wrapFragment(kt(e.below,i,t),t)).classes.push(o+"-arrow-pad"));var a,c=Kt(e,t),l=-t.fontMetrics().axisHeight+.5*c.height,u=-t.fontMetrics().axisHeight-.5*c.height-.111;if((s.depth>.25||"\\xleftequilibrium"===e.label)&&(u-=s.depth),r){var h=-t.fontMetrics().axisHeight+r.height+.5*c.height+.111;a=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:u},{type:"elem",elem:c,shift:l},{type:"elem",elem:r,shift:h}]},t)}else a=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:u},{type:"elem",elem:c,shift:l}]},t);return a.children[0].children[0].children[1].classes.push("svg-align"),Ze.makeSpan(["mrel","x-arrow"],[a],t)},mathmlBuilder:function(e,t){var r,n=jt(e.label);if(n.setAttribute("minsize","x"===e.label.charAt(0)?"1.75em":"3.0em"),e.body){var i=Yt(Lt(e.body,t));if(e.below){var s=Yt(Lt(e.below,t));r=new It.MathNode("munderover",[n,s,i])}else r=new It.MathNode("mover",[n,i])}else if(e.below){var o=Yt(Lt(e.below,t));r=new It.MathNode("munder",[n,o])}else r=Yt(),r=new It.MathNode("mover",[n,r]);return r}});var Xt={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},Jt=function(e){return"textord"===e.type&&"@"===e.text};function Qt(e,t,r){var n=Xt[e];switch(n){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return r.callFunction(n,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":var i={type:"atom",text:n,mode:"math",family:"rel"},s={type:"ordgroup",mode:"math",body:[r.callFunction("\\\\cdleft",[t[0]],[]),r.callFunction("\\Big",[i],[]),r.callFunction("\\\\cdright",[t[1]],[])]};return r.callFunction("\\\\cdparent",[s],[]);case"\\\\cdlongequal":return r.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":return r.callFunction("\\Big",[{type:"textord",text:"\\Vert",mode:"math"}],[]);default:return{type:"textord",text:" ",mode:"math"}}}ct({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler:function(e,t){var r=e.parser,n=e.funcName;return{type:"cdlabel",mode:r.mode,side:n.slice(4),label:t[0]}},htmlBuilder:function(e,t){var r=t.havingStyle(t.style.sup()),n=Ze.wrapFragment(kt(e.label,r,t),t);return n.classes.push("cd-label-"+e.side),n.style.bottom=.8-n.depth+"em",n.height=0,n.depth=0,n},mathmlBuilder:function(e,t){var r=new It.MathNode("mrow",[Lt(e.label,t)]);return(r=new It.MathNode("mpadded",[r])).setAttribute("width","0"),"left"===e.side&&r.setAttribute("lspace","-1width"),r.setAttribute("voffset","0.7em"),(r=new It.MathNode("mstyle",[r])).setAttribute("displaystyle","false"),r.setAttribute("scriptlevel","1"),r}}),ct({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler:function(e,t){return{type:"cdlabelparent",mode:e.parser.mode,fragment:t[0]}},htmlBuilder:function(e,t){var r=Ze.wrapFragment(kt(e.fragment,t),t);return r.classes.push("cd-vert-arrow"),r},mathmlBuilder:function(e,t){return new It.MathNode("mrow",[Lt(e.fragment,t)])}}),ct({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler:function(e,t){for(var r=e.parser,i=zt(t[0],"ordgroup").body,s="",o=0;o<i.length;o++)s+=zt(i[o],"textord").text;var a=parseInt(s);if(isNaN(a))throw new n("\\@char has non-numeric argument "+s);return{type:"textord",mode:r.mode,text:String.fromCharCode(a)}}});var Zt=function(e,t){var r=yt(e.body,t.withColor(e.color),!1);return Ze.makeFragment(r)},er=function(e,t){var r=Dt(e.body,t.withColor(e.color)),n=new It.MathNode("mstyle",r);return n.setAttribute("mathcolor",e.color),n};ct({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler:function(e,t){var r=e.parser,n=zt(t[0],"color-token").color,i=t[1];return{type:"color",mode:r.mode,color:n,body:ht(i)}},htmlBuilder:Zt,mathmlBuilder:er}),ct({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler:function(e,t){var r=e.parser,n=e.breakOnTokenText,i=zt(t[0],"color-token").color;r.gullet.macros.set("\\current@color",i);var s=r.parseExpression(!0,n);return{type:"color",mode:r.mode,color:i,body:s}},htmlBuilder:Zt,mathmlBuilder:er}),ct({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:1,argTypes:["size"],allowedInText:!0},handler:function(e,t,r){var n=e.parser,i=r[0],s=!n.settings.displayMode||!n.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:n.mode,newLine:s,size:i&&zt(i,"size").value}},htmlBuilder:function(e,t){var r=Ze.makeSpan(["mspace"],[],t);return e.newLine&&(r.classes.push("newline"),e.size&&(r.style.marginTop=Ke(e.size,t)+"em")),r},mathmlBuilder:function(e,t){var r=new It.MathNode("mspace");return e.newLine&&(r.setAttribute("linebreak","newline"),e.size&&r.setAttribute("height",Ke(e.size,t)+"em")),r}});var tr={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},rr=function(e){var t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new n("Expected a control sequence",e);return t},nr=function(e,t,r,n){var i=e.gullet.macros.get(r.text);null==i&&(r.noexpand=!0,i={tokens:[r],numArgs:0,unexpandable:!e.gullet.isExpandable(r.text)}),e.gullet.macros.set(t,i,n)};ct({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler:function(e){var t=e.parser,r=e.funcName;t.consumeSpaces();var i=t.fetch();if(tr[i.text])return"\\global"!==r&&"\\\\globallong"!==r||(i.text=tr[i.text]),zt(t.parseFunction(),"internal");throw new n("Invalid token after macro prefix",i)}}),ct({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler:function(e){var t=e.parser,r=e.funcName,i=t.gullet.popToken(),s=i.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(s))throw new n("Expected a control sequence",i);for(var o,a=0,c=[[]];"{"!==t.gullet.future().text;)if("#"===(i=t.gullet.popToken()).text){if("{"===t.gullet.future().text){o=t.gullet.future(),c[a].push("{");break}if(i=t.gullet.popToken(),!/^[1-9]$/.test(i.text))throw new n('Invalid argument number "'+i.text+'"');if(parseInt(i.text)!==a+1)throw new n('Argument number "'+i.text+'" out of order');a++,c.push([])}else{if("EOF"===i.text)throw new n("Expected a macro definition");c[a].push(i.text)}var l=t.gullet.consumeArg().tokens;return o&&l.unshift(o),"\\edef"!==r&&"\\xdef"!==r||(l=t.gullet.expandTokens(l)).reverse(),t.gullet.macros.set(s,{tokens:l,numArgs:a,delimiters:c},r===tr[r]),{type:"internal",mode:t.mode}}}),ct({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler:function(e){var t=e.parser,r=e.funcName,n=rr(t.gullet.popToken());t.gullet.consumeSpaces();var i=function(e){var t=e.gullet.popToken();return"="===t.text&&" "===(t=e.gullet.popToken()).text&&(t=e.gullet.popToken()),t}(t);return nr(t,n,i,"\\\\globallet"===r),{type:"internal",mode:t.mode}}}),ct({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler:function(e){var t=e.parser,r=e.funcName,n=rr(t.gullet.popToken()),i=t.gullet.popToken(),s=t.gullet.popToken();return nr(t,n,s,"\\\\globalfuture"===r),t.gullet.pushToken(s),t.gullet.pushToken(i),{type:"internal",mode:t.mode}}});var ir=function(e,t,r){var n=V(J.math[e]&&J.math[e].replace||e,t,r);if(!n)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return n},sr=function(e,t,r,n){var i=r.havingBaseStyle(t),s=Ze.makeSpan(n.concat(i.sizingClasses(r)),[e],r),o=i.sizeMultiplier/r.sizeMultiplier;return s.height*=o,s.depth*=o,s.maxFontSize=i.sizeMultiplier,s},or=function(e,t,r){var n=t.havingBaseStyle(r),i=(1-t.sizeMultiplier/n.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=i+"em",e.height-=i,e.depth+=i},ar=function(e,t,r,n,i,s){var o=function(e,t,r,n){return Ze.makeSymbol(e,"Size"+t+"-Regular",r,n)}(e,t,i,n),a=sr(Ze.makeSpan(["delimsizing","size"+t],[o],n),E.TEXT,n,s);return r&&or(a,n,E.TEXT),a},cr=function(e,t,r){return{type:"elem",elem:Ze.makeSpan(["delimsizinginner","Size1-Regular"===t?"delim-size1":"delim-size4"],[Ze.makeSpan([],[Ze.makeSymbol(e,t,r)])])}},lr=function(e,t,r){var n=z["Size4-Regular"][e.charCodeAt(0)]?z["Size4-Regular"][e.charCodeAt(0)][4].toFixed(3):z["Size1-Regular"][e.charCodeAt(0)][4].toFixed(3),i=new q("inner",function(e,t){switch(e){case"":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145zM367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z";case"":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257zM478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z";default:return""}}(e,Math.round(1e3*t))),s=new U([i],{width:n+"em",height:t+"em",style:"width:"+n+"em",viewBox:"0 0 "+1e3*n+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),o=Ze.makeSvgSpan([],[s],r);return o.height=t,o.style.height=t+"em",o.style.width=n+"em",{type:"elem",elem:o}},ur={type:"kern",size:-.008},hr=["|","\\lvert","\\rvert","\\vert"],dr=["\\|","\\lVert","\\rVert","\\Vert"],pr=function(e,t,r,n,i,s){var o,a,l,u;o=l=u=e,a=null;var h="Size1-Regular";"\\uparrow"===e?l=u="":"\\Uparrow"===e?l=u="":"\\downarrow"===e?o=l="":"\\Downarrow"===e?o=l="":"\\updownarrow"===e?(o="\\uparrow",l="",u="\\downarrow"):"\\Updownarrow"===e?(o="\\Uparrow",l="",u="\\Downarrow"):c(hr,e)?l="":c(dr,e)?l="":"["===e||"\\lbrack"===e?(o="",l="",u="",h="Size4-Regular"):"]"===e||"\\rbrack"===e?(o="",l="",u="",h="Size4-Regular"):"\\lfloor"===e||""===e?(l=o="",u="",h="Size4-Regular"):"\\lceil"===e||""===e?(o="",l=u="",h="Size4-Regular"):"\\rfloor"===e||""===e?(l=o="",u="",h="Size4-Regular"):"\\rceil"===e||""===e?(o="",l=u="",h="Size4-Regular"):"("===e||"\\lparen"===e?(o="",l="",u="",h="Size4-Regular"):")"===e||"\\rparen"===e?(o="",l="",u="",h="Size4-Regular"):"\\{"===e||"\\lbrace"===e?(o="",a="",u="",l="",h="Size4-Regular"):"\\}"===e||"\\rbrace"===e?(o="",a="",u="",l="",h="Size4-Regular"):"\\lgroup"===e||""===e?(o="",u="",l="",h="Size4-Regular"):"\\rgroup"===e||""===e?(o="",u="",l="",h="Size4-Regular"):"\\lmoustache"===e||""===e?(o="",u="",l="",h="Size4-Regular"):"\\rmoustache"!==e&&""!==e||(o="",u="",l="",h="Size4-Regular");var d=ir(o,h,i),p=d.height+d.depth,f=ir(l,h,i),g=f.height+f.depth,m=ir(u,h,i),y=m.height+m.depth,v=0,_=1;if(null!==a){var b=ir(a,h,i);v=b.height+b.depth,_=2}var w=p+y+v,S=w+Math.max(0,Math.ceil((t-w)/(_*g)))*_*g,k=n.fontMetrics().axisHeight;r&&(k*=n.sizeMultiplier);var x=S/2-k,A=[];if(A.push(cr(u,h,i)),A.push(ur),null===a){var T=S-p-y+.016;A.push(lr(l,T,n))}else{var C=(S-p-y-v)/2+.016;A.push(lr(l,C,n)),A.push(ur),A.push(cr(a,h,i)),A.push(ur),A.push(lr(l,C,n))}A.push(ur),A.push(cr(o,h,i));var I=n.havingBaseStyle(E.TEXT),R=Ze.makeVList({positionType:"bottom",positionData:x,children:A},I);return sr(Ze.makeSpan(["delimsizing","mult"],[R],I),E.TEXT,n,s)},fr=.08,gr=function(e,t,r,n,i){var s=function(e,t,r){t*=1e3;var n="";switch(e){case"sqrtMain":n=function(e,t){return"M95,"+(622+e+80)+"\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl"+e/2.075+" -"+e+"\nc5.3,-9.3,12,-14,20,-14\nH400000v"+(40+e)+"H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM"+(834+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize1":n=function(e,t){return"M263,"+(601+e+80)+"c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl"+e/2.084+" -"+e+"\nc4.7,-7.3,11,-11,19,-11\nH40000v"+(40+e)+"H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM"+(1001+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize2":n=function(e,t){return"M983 "+(10+e+80)+"\nl"+e/3.13+" -"+e+"\nc4,-6.7,10,-10,18,-10 H400000v"+(40+e)+"\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM"+(1001+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize3":n=function(e,t){return"M424,"+(2398+e+80)+"\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl"+e/4.223+" -"+e+"c4,-6.7,10,-10,18,-10 H400000\nv"+(40+e)+"H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M"+(1001+e)+" 80\nh400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize4":n=function(e,t){return"M473,"+(2713+e+80)+"\nc339.3,-1799.3,509.3,-2700,510,-2702 l"+e/5.298+" -"+e+"\nc3.3,-7.3,9.3,-11,18,-11 H400000v"+(40+e)+"H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM"+(1001+e)+" 80h400000v"+(40+e)+"H1017.7z"}(t);break;case"sqrtTall":n=function(e,t,r){return"M702 "+(e+80)+"H400000"+(40+e)+"\nH742v"+(r-54-80-e)+"l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1\nh-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170\nc-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667\n219 661 l218 661zM702 80H400000v"+(40+e)+"H742z"}(t,0,r)}return n}(e,n,r),o=new q(e,s),a=new U([o],{width:"400em",height:t+"em",viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return Ze.makeSvgSpan(["hide-tail"],[a],i)},mr=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],yr=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],vr=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],_r=[0,1.2,1.8,2.4,3],br=[{type:"small",style:E.SCRIPTSCRIPT},{type:"small",style:E.SCRIPT},{type:"small",style:E.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],wr=[{type:"small",style:E.SCRIPTSCRIPT},{type:"small",style:E.SCRIPT},{type:"small",style:E.TEXT},{type:"stack"}],Sr=[{type:"small",style:E.SCRIPTSCRIPT},{type:"small",style:E.SCRIPT},{type:"small",style:E.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],kr=function(e){if("small"===e.type)return"Main-Regular";if("large"===e.type)return"Size"+e.size+"-Regular";if("stack"===e.type)return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},Er=function(e,t,r,n){for(var i=Math.min(2,3-n.style.size);i<r.length&&"stack"!==r[i].type;i++){var s=ir(e,kr(r[i]),"math"),o=s.height+s.depth;if("small"===r[i].type&&(o*=n.havingBaseStyle(r[i].style).sizeMultiplier),o>t)return r[i]}return r[r.length-1]},xr=function(e,t,r,n,i,s){var o;"<"===e||"\\lt"===e||""===e?e="\\langle":">"!==e&&"\\gt"!==e&&""!==e||(e="\\rangle"),o=c(vr,e)?br:c(mr,e)?Sr:wr;var a=Er(e,t,o,n);return"small"===a.type?function(e,t,r,n,i,s){var o=Ze.makeSymbol(e,"Main-Regular",i,n),a=sr(o,t,n,s);return r&&or(a,n,t),a}(e,a.style,r,n,i,s):"large"===a.type?ar(e,a.size,r,n,i,s):pr(e,t,r,n,i,s)},Ar=function(e,t,r,i,s){if("<"===e||"\\lt"===e||""===e?e="\\langle":">"!==e&&"\\gt"!==e&&""!==e||(e="\\rangle"),c(mr,e)||c(vr,e))return ar(e,t,!1,r,i,s);if(c(yr,e))return pr(e,_r[t],!1,r,i,s);throw new n("Illegal delimiter: '"+e+"'")},Tr=_r,Cr=xr,Ir=function(e,t,r,n,i,s){var o=n.fontMetrics().axisHeight*n.sizeMultiplier,a=5/n.fontMetrics().ptPerEm,c=Math.max(t-o,r+o),l=Math.max(c/500*901,2*c-a);return xr(e,l,!0,n,i,s)},Rr={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},Or=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function Pr(e,t){var r=Gt(e);if(r&&c(Or,r.text))return r;throw new n(r?"Invalid delimiter '"+r.text+"' after '"+t.funcName+"'":"Invalid delimiter type '"+e.type+"'",e)}function Dr(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}ct({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:function(e,t){var r=Pr(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:Rr[e.funcName].size,mclass:Rr[e.funcName].mclass,delim:r.text}},htmlBuilder:function(e,t){return"."===e.delim?Ze.makeSpan([e.mclass]):Ar(e.delim,e.size,t,e.mode,[e.mclass])},mathmlBuilder:function(e){var t=[];"."!==e.delim&&t.push(Rt(e.delim,e.mode));var r=new It.MathNode("mo",t);return"mopen"===e.mclass||"mclose"===e.mclass?r.setAttribute("fence","true"):r.setAttribute("fence","false"),r.setAttribute("stretchy","true"),r.setAttribute("minsize",Tr[e.size]+"em"),r.setAttribute("maxsize",Tr[e.size]+"em"),r}}),ct({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:function(e,t){var r=e.parser.gullet.macros.get("\\current@color");if(r&&"string"!=typeof r)throw new n("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:Pr(t[0],e).text,color:r}}}),ct({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:function(e,t){var r=Pr(t[0],e),n=e.parser;++n.leftrightDepth;var i=n.parseExpression(!1);--n.leftrightDepth,n.expect("\\right",!1);var s=zt(n.parseFunction(),"leftright-right");return{type:"leftright",mode:n.mode,body:i,left:r.text,right:s.delim,rightColor:s.color}},htmlBuilder:function(e,t){Dr(e);for(var r,n,i=yt(e.body,t,!0,["mopen","mclose"]),s=0,o=0,a=!1,c=0;c<i.length;c++)i[c].isMiddle?a=!0:(s=Math.max(i[c].height,s),o=Math.max(i[c].depth,o));if(s*=t.sizeMultiplier,o*=t.sizeMultiplier,r="."===e.left?St(t,["mopen"]):Ir(e.left,s,o,t,e.mode,["mopen"]),i.unshift(r),a)for(var l=1;l<i.length;l++){var u=i[l].isMiddle;u&&(i[l]=Ir(u.delim,s,o,u.options,e.mode,[]))}if("."===e.right)n=St(t,["mclose"]);else{var h=e.rightColor?t.withColor(e.rightColor):t;n=Ir(e.right,s,o,h,e.mode,["mclose"])}return i.push(n),Ze.makeSpan(["minner"],i,t)},mathmlBuilder:function(e,t){Dr(e);var r=Dt(e.body,t);if("."!==e.left){var n=new It.MathNode("mo",[Rt(e.left,e.mode)]);n.setAttribute("fence","true"),r.unshift(n)}if("."!==e.right){var i=new It.MathNode("mo",[Rt(e.right,e.mode)]);i.setAttribute("fence","true"),e.rightColor&&i.setAttribute("mathcolor",e.rightColor),r.push(i)}return Ot(r)}}),ct({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:function(e,t){var r=Pr(t[0],e);if(!e.parser.leftrightDepth)throw new n("\\middle without preceding \\left",r);return{type:"middle",mode:e.parser.mode,delim:r.text}},htmlBuilder:function(e,t){var r;if("."===e.delim)r=St(t,[]);else{r=Ar(e.delim,1,t,e.mode,[]);var n={delim:e.delim,options:t};r.isMiddle=n}return r},mathmlBuilder:function(e,t){var r="\\vert"===e.delim||"|"===e.delim?Rt("|","text"):Rt(e.delim,e.mode),n=new It.MathNode("mo",[r]);return n.setAttribute("fence","true"),n.setAttribute("lspace","0.05em"),n.setAttribute("rspace","0.05em"),n}});var Mr=function(e,t){var r,n,i,s=Ze.wrapFragment(kt(e.body,t),t),o=e.label.substr(1),a=t.sizeMultiplier,c=0,l=p(e.body);if("sout"===o)(r=Ze.makeSpan(["stretchy","sout"])).height=t.fontMetrics().defaultRuleThickness/a,c=-.5*t.fontMetrics().xHeight;else if("phase"===o){var u=Ke({number:.6,unit:"pt"},t),h=Ke({number:.35,unit:"ex"},t);a/=t.havingBaseSizing().sizeMultiplier;var d=s.height+s.depth+u+h;s.style.paddingLeft=d/2+u+"em";var f=Math.floor(1e3*d*a),g="M400000 "+(n=f)+" H0 L"+n/2+" 0 l65 45 L145 "+(n-80)+" H400000z",m=new U([new q("phase",g)],{width:"400em",height:f/1e3+"em",viewBox:"0 0 400000 "+f,preserveAspectRatio:"xMinYMin slice"});(r=Ze.makeSvgSpan(["hide-tail"],[m],t)).style.height=d+"em",c=s.depth+u+h}else{/cancel/.test(o)?l||s.classes.push("cancel-pad"):"angl"===o?s.classes.push("anglpad"):s.classes.push("boxpad");var y=0,v=0,_=0;/box/.test(o)?(_=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness),v=y=t.fontMetrics().fboxsep+("colorbox"===o?0:_)):"angl"===o?(y=4*(_=Math.max(t.fontMetrics().defaultRuleThickness,t.minRuleThickness)),v=Math.max(0,.25-s.depth)):v=y=l?.2:0,r=function(e,t,r,n,i){var s,o=e.height+e.depth+r+n;if(/fbox|color|angl/.test(t)){if(s=Ze.makeSpan(["stretchy",t],[],i),"fbox"===t){var a=i.color&&i.getColor();a&&(s.style.borderColor=a)}}else{var c=[];/^[bx]cancel$/.test(t)&&c.push(new j({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&c.push(new j({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var l=new U(c,{width:"100%",height:o+"em"});s=Ze.makeSvgSpan([],[l],i)}return s.height=o,s.style.height=o+"em",s}(s,o,y,v,t),/fbox|boxed|fcolorbox/.test(o)?(r.style.borderStyle="solid",r.style.borderWidth=_+"em"):"angl"===o&&.049!==_&&(r.style.borderTopWidth=_+"em",r.style.borderRightWidth=_+"em"),c=s.depth+v,e.backgroundColor&&(r.style.backgroundColor=e.backgroundColor,e.borderColor&&(r.style.borderColor=e.borderColor))}if(e.backgroundColor)i=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:r,shift:c},{type:"elem",elem:s,shift:0}]},t);else{var b=/cancel|phase/.test(o)?["svg-align"]:[];i=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:0},{type:"elem",elem:r,shift:c,wrapperClasses:b}]},t)}return/cancel/.test(o)&&(i.height=s.height,i.depth=s.depth),/cancel/.test(o)&&!l?Ze.makeSpan(["mord","cancel-lap"],[i],t):Ze.makeSpan(["mord"],[i],t)},Lr=function(e,t){var r=0,n=new It.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Lt(e.body,t)]);switch(e.label){case"\\cancel":n.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":n.setAttribute("notation","downdiagonalstrike");break;case"\\phase":n.setAttribute("notation","phasorangle");break;case"\\sout":n.setAttribute("notation","horizontalstrike");break;case"\\fbox":n.setAttribute("notation","box");break;case"\\angl":n.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(r=t.fontMetrics().fboxsep*t.fontMetrics().ptPerEm,n.setAttribute("width","+"+2*r+"pt"),n.setAttribute("height","+"+2*r+"pt"),n.setAttribute("lspace",r+"pt"),n.setAttribute("voffset",r+"pt"),"\\fcolorbox"===e.label){var i=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness);n.setAttribute("style","border: "+i+"em solid "+String(e.borderColor))}break;case"\\xcancel":n.setAttribute("notation","updiagonalstrike downdiagonalstrike")}return e.backgroundColor&&n.setAttribute("mathbackground",e.backgroundColor),n};ct({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler:function(e,t,r){var n=e.parser,i=e.funcName,s=zt(t[0],"color-token").color,o=t[1];return{type:"enclose",mode:n.mode,label:i,backgroundColor:s,body:o}},htmlBuilder:Mr,mathmlBuilder:Lr}),ct({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler:function(e,t,r){var n=e.parser,i=e.funcName,s=zt(t[0],"color-token").color,o=zt(t[1],"color-token").color,a=t[2];return{type:"enclose",mode:n.mode,label:i,backgroundColor:o,borderColor:s,body:a}},htmlBuilder:Mr,mathmlBuilder:Lr}),ct({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler:function(e,t){return{type:"enclose",mode:e.parser.mode,label:"\\fbox",body:t[0]}}}),ct({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler:function(e,t){var r=e.parser,n=e.funcName,i=t[0];return{type:"enclose",mode:r.mode,label:n,body:i}},htmlBuilder:Mr,mathmlBuilder:Lr}),ct({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler:function(e,t){return{type:"enclose",mode:e.parser.mode,label:"\\angl",body:t[0]}}});var Nr={};function Fr(e){for(var t=e.type,r=e.names,n=e.props,i=e.handler,s=e.htmlBuilder,o=e.mathmlBuilder,a={type:t,numArgs:n.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:i},c=0;c<r.length;++c)Nr[r[c]]=a;s&&(ot[t]=s),o&&(at[t]=o)}function Br(e){var t=[];e.consumeSpaces();for(var r=e.fetch().text;"\\hline"===r||"\\hdashline"===r;)e.consume(),t.push("\\hdashline"===r),e.consumeSpaces(),r=e.fetch().text;return t}var Ur=function(e){if(!e.parser.settings.displayMode)throw new n("{"+e.envName+"} can be used only in display mode.")};function qr(e,t,r){var i=t.hskipBeforeAndAfter,s=t.addJot,o=t.cols,a=t.arraystretch,c=t.colSeparationType,l=t.addEqnNum,u=t.singleRow,h=t.maxNumCols,d=t.leqno;if(e.gullet.beginGroup(),u||e.gullet.macros.set("\\cr","\\\\\\relax"),!a){var p=e.gullet.expandMacroAsText("\\arraystretch");if(null==p)a=1;else if(!(a=parseFloat(p))||a<0)throw new n("Invalid \\arraystretch: "+p)}e.gullet.beginGroup();var f=[],g=[f],m=[],y=[];for(y.push(Br(e));;){var v=e.parseExpression(!1,u?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),v={type:"ordgroup",mode:e.mode,body:v},r&&(v={type:"styling",mode:e.mode,style:r,body:[v]}),f.push(v);var _=e.fetch().text;if("&"===_){if(h&&f.length===h){if(u||c)throw new n("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else{if("\\end"===_){1===f.length&&"styling"===v.type&&0===v.body[0].body.length&&g.pop(),y.length<g.length+1&&y.push([]);break}if("\\\\"!==_)throw new n("Expected & or \\\\ or \\cr or \\end",e.nextToken);e.consume();var b=void 0;" "!==e.gullet.future().text&&(b=e.parseSizeGroup(!0)),m.push(b?b.value:null),y.push(Br(e)),f=[],g.push(f)}}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:s,arraystretch:a,body:g,cols:o,rowGaps:m,hskipBeforeAndAfter:i,hLinesBeforeRow:y,colSeparationType:c,addEqnNum:l,leqno:d}}function jr(e){return"d"===e.substr(0,1)?"display":"text"}var Kr=function(e,t){var r,i,s=e.body.length,o=e.hLinesBeforeRow,a=0,c=new Array(s),u=[],h=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),d=1/t.fontMetrics().ptPerEm,p=5*d;e.colSeparationType&&"small"===e.colSeparationType&&(p=t.havingStyle(E.SCRIPT).sizeMultiplier/t.sizeMultiplier*.2778);var f="CD"===e.colSeparationType?Ke({number:3,unit:"ex"},t):12*d,g=3*d,m=e.arraystretch*f,y=.7*m,v=.3*m,_=0;function b(e){for(var t=0;t<e.length;++t)t>0&&(_+=.25),u.push({pos:_,isDashed:e[t]})}for(b(o[0]),r=0;r<e.body.length;++r){var w=e.body[r],S=y,k=v;a<w.length&&(a=w.length);var x=new Array(w.length);for(i=0;i<w.length;++i){var A=kt(w[i],t);k<A.depth&&(k=A.depth),S<A.height&&(S=A.height),x[i]=A}var T=e.rowGaps[r],C=0;T&&(C=Ke(T,t))>0&&(k<(C+=v)&&(k=C),C=0),e.addJot&&(k+=g),x.height=S,x.depth=k,_+=S,x.pos=_,_+=k+C,c[r]=x,b(o[r+1])}var I,R,O=_/2+t.fontMetrics().axisHeight,P=e.cols||[],D=[],M=[];if(e.addEqnNum)for(r=0;r<s;++r){var L=c[r],N=L.pos-O,F=Ze.makeSpan(["eqn-num"],[],t);F.depth=L.depth,F.height=L.height,M.push({type:"elem",elem:F,shift:N})}for(i=0,R=0;i<a||R<P.length;++i,++R){for(var B=P[R]||{},U=!0;"separator"===B.type;){if(U||((I=Ze.makeSpan(["arraycolsep"],[])).style.width=t.fontMetrics().doubleRuleSep+"em",D.push(I)),"|"!==B.separator&&":"!==B.separator)throw new n("Invalid separator type: "+B.separator);var q="|"===B.separator?"solid":"dashed",j=Ze.makeSpan(["vertical-separator"],[],t);j.style.height=_+"em",j.style.borderRightWidth=h+"em",j.style.borderRightStyle=q,j.style.margin="0 -"+h/2+"em",j.style.verticalAlign=-(_-O)+"em",D.push(j),B=P[++R]||{},U=!1}if(!(i>=a)){var K=void 0;(i>0||e.hskipBeforeAndAfter)&&0!==(K=l(B.pregap,p))&&((I=Ze.makeSpan(["arraycolsep"],[])).style.width=K+"em",D.push(I));var z=[];for(r=0;r<s;++r){var $=c[r],G=$[i];if(G){var V=$.pos-O;G.depth=$.depth,G.height=$.height,z.push({type:"elem",elem:G,shift:V})}}z=Ze.makeVList({positionType:"individualShift",children:z},t),z=Ze.makeSpan(["col-align-"+(B.align||"c")],[z]),D.push(z),(i<a-1||e.hskipBeforeAndAfter)&&0!==(K=l(B.postgap,p))&&((I=Ze.makeSpan(["arraycolsep"],[])).style.width=K+"em",D.push(I))}}if(c=Ze.makeSpan(["mtable"],D),u.length>0){for(var H=Ze.makeLineSpan("hline",t,h),W=Ze.makeLineSpan("hdashline",t,h),Y=[{type:"elem",elem:c,shift:0}];u.length>0;){var X=u.pop(),J=X.pos-O;X.isDashed?Y.push({type:"elem",elem:W,shift:J}):Y.push({type:"elem",elem:H,shift:J})}c=Ze.makeVList({positionType:"individualShift",children:Y},t)}if(e.addEqnNum){var Q=Ze.makeVList({positionType:"individualShift",children:M},t);return Q=Ze.makeSpan(["tag"],[Q],t),Ze.makeFragment([c,Q])}return Ze.makeSpan(["mord"],[c],t)},zr={c:"center ",l:"left ",r:"right "},$r=function(e,t){for(var r=[],n=new It.MathNode("mtd",[],["mtr-glue"]),i=new It.MathNode("mtd",[],["mml-eqn-num"]),s=0;s<e.body.length;s++){for(var o=e.body[s],a=[],c=0;c<o.length;c++)a.push(new It.MathNode("mtd",[Lt(o[c],t)]));e.addEqnNum&&(a.unshift(n),a.push(n),e.leqno?a.unshift(i):a.push(i)),r.push(new It.MathNode("mtr",a))}var l=new It.MathNode("mtable",r),u=.5===e.arraystretch?.1:.16+e.arraystretch-1+(e.addJot?.09:0);l.setAttribute("rowspacing",u.toFixed(4)+"em");var h="",d="";if(e.cols&&e.cols.length>0){var p=e.cols,f="",g=!1,m=0,y=p.length;"separator"===p[0].type&&(h+="top ",m=1),"separator"===p[p.length-1].type&&(h+="bottom ",y-=1);for(var v=m;v<y;v++)"align"===p[v].type?(d+=zr[p[v].align],g&&(f+="none "),g=!0):"separator"===p[v].type&&g&&(f+="|"===p[v].separator?"solid ":"dashed ",g=!1);l.setAttribute("columnalign",d.trim()),/[sd]/.test(f)&&l.setAttribute("columnlines",f.trim())}if("align"===e.colSeparationType){for(var _=e.cols||[],b="",w=1;w<_.length;w++)b+=w%2?"0em ":"1em ";l.setAttribute("columnspacing",b.trim())}else"alignat"===e.colSeparationType||"gather"===e.colSeparationType?l.setAttribute("columnspacing","0em"):"small"===e.colSeparationType?l.setAttribute("columnspacing","0.2778em"):"CD"===e.colSeparationType?l.setAttribute("columnspacing","0.5em"):l.setAttribute("columnspacing","1em");var S="",k=e.hLinesBeforeRow;h+=k[0].length>0?"left ":"",h+=k[k.length-1].length>0?"right ":"";for(var E=1;E<k.length-1;E++)S+=0===k[E].length?"none ":k[E][0]?"dashed ":"solid ";return/[sd]/.test(S)&&l.setAttribute("rowlines",S.trim()),""!==h&&(l=new It.MathNode("menclose",[l])).setAttribute("notation",h.trim()),e.arraystretch&&e.arraystretch<1&&(l=new It.MathNode("mstyle",[l])).setAttribute("scriptlevel","1"),l},Gr=function(e,t){-1===e.envName.indexOf("ed")&&Ur(e);var r,i=[],s=e.envName.indexOf("at")>-1?"alignat":"align",o=qr(e.parser,{cols:i,addJot:!0,addEqnNum:"align"===e.envName||"alignat"===e.envName,colSeparationType:s,maxNumCols:"split"===e.envName?2:void 0,leqno:e.parser.settings.leqno},"display"),a=0,c={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&"ordgroup"===t[0].type){for(var l="",u=0;u<t[0].body.length;u++)l+=zt(t[0].body[u],"textord").text;r=Number(l),a=2*r}var h=!a;o.body.forEach((function(e){for(var t=1;t<e.length;t+=2){var i=zt(e[t],"styling");zt(i.body[0],"ordgroup").body.unshift(c)}if(h)a<e.length&&(a=e.length);else{var s=e.length/2;if(r<s)throw new n("Too many math in a row: expected "+r+", but got "+s,e[0])}}));for(var d=0;d<a;++d){var p="r",f=0;d%2==1?p="l":d>0&&h&&(f=1),i[d]={type:"align",align:p,pregap:f,postgap:0}}return o.colSeparationType=h?"align":"alignat",o};Fr({type:"array",names:["array","darray"],props:{numArgs:1},handler:function(e,t){var r=(Gt(t[0])?[t[0]]:zt(t[0],"ordgroup").body).map((function(e){var t=$t(e).text;if(-1!=="lcr".indexOf(t))return{type:"align",align:t};if("|"===t)return{type:"separator",separator:"|"};if(":"===t)return{type:"separator",separator:":"};throw new n("Unknown column alignment: "+t,e)})),i={cols:r,hskipBeforeAndAfter:!0,maxNumCols:r.length};return qr(e.parser,i,jr(e.envName))},htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler:function(e){var t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],r="c",i={hskipBeforeAndAfter:!1,cols:[{type:"align",align:r}]};if("*"===e.envName.charAt(e.envName.length-1)){var s=e.parser;if(s.consumeSpaces(),"["===s.fetch().text){if(s.consume(),s.consumeSpaces(),r=s.fetch().text,-1==="lcr".indexOf(r))throw new n("Expected l or c or r",s.nextToken);s.consume(),s.consumeSpaces(),s.expect("]"),s.consume(),i.cols=[{type:"align",align:r}]}}var o=qr(e.parser,i,jr(e.envName));return o.cols=new Array(o.body[0].length).fill({type:"align",align:r}),t?{type:"leftright",mode:e.mode,body:[o],left:t[0],right:t[1],rightColor:void 0}:o},htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["smallmatrix"],props:{numArgs:0},handler:function(e){var t=qr(e.parser,{arraystretch:.5},"script");return t.colSeparationType="small",t},htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["subarray"],props:{numArgs:1},handler:function(e,t){var r=(Gt(t[0])?[t[0]]:zt(t[0],"ordgroup").body).map((function(e){var t=$t(e).text;if(-1!=="lc".indexOf(t))return{type:"align",align:t};throw new n("Unknown column alignment: "+t,e)}));if(r.length>1)throw new n("{subarray} can contain only one column");var i={cols:r,hskipBeforeAndAfter:!1,arraystretch:.5};if((i=qr(e.parser,i,"script")).body.length>0&&i.body[0].length>1)throw new n("{subarray} can contain only one column");return i},htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler:function(e){var t=qr(e.parser,{arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},jr(e.envName));return{type:"leftright",mode:e.mode,body:[t],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:Gr,htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler:function(e){c(["gather","gather*"],e.envName)&&Ur(e);var t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",addEqnNum:"gather"===e.envName,leqno:e.parser.settings.leqno};return qr(e.parser,t,"display")},htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:Gr,htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["equation","equation*"],props:{numArgs:0},handler:function(e){Ur(e);var t={addEqnNum:"equation"===e.envName,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return qr(e.parser,t,"display")},htmlBuilder:Kr,mathmlBuilder:$r}),Fr({type:"array",names:["CD"],props:{numArgs:0},handler:function(e){return Ur(e),function(e){var t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var r=e.fetch().text;if("&"!==r&&"\\\\"!==r){if("\\end"===r){0===t[t.length-1].length&&t.pop();break}throw new n("Expected \\\\ or \\cr or \\end",e.nextToken)}e.consume()}for(var i,s,o=[],a=[o],c=0;c<t.length;c++){for(var l=t[c],u={type:"styling",body:[],mode:"math",style:"display"},h=0;h<l.length;h++)if(Jt(l[h])){o.push(u);var d=$t(l[h+=1]).text,p=new Array(2);if(p[0]={type:"ordgroup",mode:"math",body:[]},p[1]={type:"ordgroup",mode:"math",body:[]},"=|.".indexOf(d)>-1);else{if(!("<>AV".indexOf(d)>-1))throw new n('Expected one of "<>AV=|." after @',l[h]);for(var f=0;f<2;f++){for(var g=!0,m=h+1;m<l.length;m++){if(s=d,("mathord"===(i=l[m]).type||"atom"===i.type)&&i.text===s){g=!1,h=m;break}if(Jt(l[m]))throw new n("Missing a "+d+" character to complete a CD arrow.",l[m]);p[f].body.push(l[m])}if(g)throw new n("Missing a "+d+" character to complete a CD arrow.",l[h])}}var y={type:"styling",body:[Qt(d,p,e)],mode:"math",style:"display"};o.push(y),u={type:"styling",body:[],mode:"math",style:"display"}}else u.body.push(l[h]);c%2==0?o.push(u):o.shift(),o=[],a.push(o)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:"math",body:a,arraystretch:1,addJot:!0,rowGaps:[null],cols:new Array(a[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25}),colSeparationType:"CD",hLinesBeforeRow:new Array(a.length+1).fill([])}}(e.parser)},htmlBuilder:Kr,mathmlBuilder:$r}),ct({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler:function(e,t){throw new n(e.funcName+" valid only within array environment")}});var Vr=Nr;ct({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler:function(e,t){var r=e.parser,i=e.funcName,s=t[0];if("ordgroup"!==s.type)throw new n("Invalid environment name",s);for(var o="",a=0;a<s.body.length;++a)o+=zt(s.body[a],"textord").text;if("\\begin"===i){if(!Vr.hasOwnProperty(o))throw new n("No such environment: "+o,s);var c=Vr[o],l=r.parseArguments("\\begin{"+o+"}",c),u=l.args,h=l.optArgs,d={mode:r.mode,envName:o,parser:r},p=c.handler(d,u,h);r.expect("\\end",!1);var f=r.nextToken,g=zt(r.parseFunction(),"environment");if(g.name!==o)throw new n("Mismatch: \\begin{"+o+"} matched by \\end{"+g.name+"}",f);return p}return{type:"environment",mode:r.mode,name:o,nameGroup:s}}});var Hr=Ze.makeSpan;function Wr(e,t){var r=yt(e.body,t,!0);return Hr([e.mclass],r,t)}function Yr(e,t){var r,n=Dt(e.body,t);return"minner"===e.mclass?It.newDocumentFragment(n):("mord"===e.mclass?e.isCharacterBox?(r=n[0]).type="mi":r=new It.MathNode("mi",n):(e.isCharacterBox?(r=n[0]).type="mo":r=new It.MathNode("mo",n),"mbin"===e.mclass?(r.attributes.lspace="0.22em",r.attributes.rspace="0.22em"):"mpunct"===e.mclass?(r.attributes.lspace="0em",r.attributes.rspace="0.17em"):"mopen"!==e.mclass&&"mclose"!==e.mclass||(r.attributes.lspace="0em",r.attributes.rspace="0em")),r)}ct({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler:function(e,t){var r=e.parser,n=e.funcName,i=t[0];return{type:"mclass",mode:r.mode,mclass:"m"+n.substr(5),body:ht(i),isCharacterBox:p(i)}},htmlBuilder:Wr,mathmlBuilder:Yr});var Xr=function(e){var t="ordgroup"===e.type&&e.body.length?e.body[0]:e;return"atom"!==t.type||"bin"!==t.family&&"rel"!==t.family?"mord":"m"+t.family};ct({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler:function(e,t){return{type:"mclass",mode:e.parser.mode,mclass:Xr(t[0]),body:ht(t[1]),isCharacterBox:p(t[1])}}}),ct({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler:function(e,t){var r,n=e.parser,i=e.funcName,s=t[1],o=t[0];r="\\stackrel"!==i?Xr(s):"mrel";var a={type:"op",mode:s.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:"\\stackrel"!==i,body:ht(s)},c={type:"supsub",mode:o.mode,base:a,sup:"\\underset"===i?null:o,sub:"\\underset"===i?o:null};return{type:"mclass",mode:n.mode,mclass:r,body:[c],isCharacterBox:p(c)}},htmlBuilder:Wr,mathmlBuilder:Yr});var Jr=function(e,t){var r=e.font,n=t.withFont(r);return kt(e.body,n)},Qr=function(e,t){var r=e.font,n=t.withFont(r);return Lt(e.body,n)},Zr={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};ct({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:function(e,t){var r=e.parser,n=e.funcName,i=ut(t[0]),s=n;return s in Zr&&(s=Zr[s]),{type:"font",mode:r.mode,font:s.slice(1),body:i}},htmlBuilder:Jr,mathmlBuilder:Qr}),ct({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:function(e,t){var r=e.parser,n=t[0],i=p(n);return{type:"mclass",mode:r.mode,mclass:Xr(n),body:[{type:"font",mode:r.mode,font:"boldsymbol",body:n}],isCharacterBox:i}}}),ct({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:function(e,t){var r=e.parser,n=e.funcName,i=e.breakOnTokenText,s=r.mode,o=r.parseExpression(!0,i);return{type:"font",mode:s,font:"math"+n.slice(1),body:{type:"ordgroup",mode:r.mode,body:o}}},htmlBuilder:Jr,mathmlBuilder:Qr});var en=function(e,t){var r=t;return"display"===e?r=r.id>=E.SCRIPT.id?r.text():E.DISPLAY:"text"===e&&r.size===E.DISPLAY.size?r=E.TEXT:"script"===e?r=E.SCRIPT:"scriptscript"===e&&(r=E.SCRIPTSCRIPT),r},tn=function(e,t){var r,n=en(e.size,t.style),i=n.fracNum(),s=n.fracDen();r=t.havingStyle(i);var o=kt(e.numer,r,t);if(e.continued){var a=8.5/t.fontMetrics().ptPerEm,c=3.5/t.fontMetrics().ptPerEm;o.height=o.height<a?a:o.height,o.depth=o.depth<c?c:o.depth}r=t.havingStyle(s);var l,u,h,d,p,f,g,m,y,v,_=kt(e.denom,r,t);if(e.hasBarLine?(e.barSize?(u=Ke(e.barSize,t),l=Ze.makeLineSpan("frac-line",t,u)):l=Ze.makeLineSpan("frac-line",t),u=l.height,h=l.height):(l=null,u=0,h=t.fontMetrics().defaultRuleThickness),n.size===E.DISPLAY.size||"display"===e.size?(d=t.fontMetrics().num1,p=u>0?3*h:7*h,f=t.fontMetrics().denom1):(u>0?(d=t.fontMetrics().num2,p=h):(d=t.fontMetrics().num3,p=3*h),f=t.fontMetrics().denom2),l){var b=t.fontMetrics().axisHeight;d-o.depth-(b+.5*u)<p&&(d+=p-(d-o.depth-(b+.5*u))),b-.5*u-(_.height-f)<p&&(f+=p-(b-.5*u-(_.height-f))),g=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:_,shift:f},{type:"elem",elem:l,shift:-(b-.5*u)},{type:"elem",elem:o,shift:-d}]},t)}else{var w=d-o.depth-(_.height-f);w<p&&(d+=.5*(p-w),f+=.5*(p-w)),g=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:_,shift:f},{type:"elem",elem:o,shift:-d}]},t)}return r=t.havingStyle(n),g.height*=r.sizeMultiplier/t.sizeMultiplier,g.depth*=r.sizeMultiplier/t.sizeMultiplier,m=n.size===E.DISPLAY.size?t.fontMetrics().delim1:t.fontMetrics().delim2,y=null==e.leftDelim?St(t,["mopen"]):Cr(e.leftDelim,m,!0,t.havingStyle(n),e.mode,["mopen"]),v=e.continued?Ze.makeSpan([]):null==e.rightDelim?St(t,["mclose"]):Cr(e.rightDelim,m,!0,t.havingStyle(n),e.mode,["mclose"]),Ze.makeSpan(["mord"].concat(r.sizingClasses(t)),[y,Ze.makeSpan(["mfrac"],[g]),v],t)},rn=function(e,t){var r=new It.MathNode("mfrac",[Lt(e.numer,t),Lt(e.denom,t)]);if(e.hasBarLine){if(e.barSize){var n=Ke(e.barSize,t);r.setAttribute("linethickness",n+"em")}}else r.setAttribute("linethickness","0px");var i=en(e.size,t.style);if(i.size!==t.style.size){r=new It.MathNode("mstyle",[r]);var s=i.size===E.DISPLAY.size?"true":"false";r.setAttribute("displaystyle",s),r.setAttribute("scriptlevel","0")}if(null!=e.leftDelim||null!=e.rightDelim){var o=[];if(null!=e.leftDelim){var a=new It.MathNode("mo",[new It.TextNode(e.leftDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}if(o.push(r),null!=e.rightDelim){var c=new It.MathNode("mo",[new It.TextNode(e.rightDelim.replace("\\",""))]);c.setAttribute("fence","true"),o.push(c)}return Ot(o)}return r};ct({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:function(e,t){var r,n=e.parser,i=e.funcName,s=t[0],o=t[1],a=null,c=null,l="auto";switch(i){case"\\dfrac":case"\\frac":case"\\tfrac":r=!0;break;case"\\\\atopfrac":r=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":r=!1,a="(",c=")";break;case"\\\\bracefrac":r=!1,a="\\{",c="\\}";break;case"\\\\brackfrac":r=!1,a="[",c="]";break;default:throw new Error("Unrecognized genfrac command")}switch(i){case"\\dfrac":case"\\dbinom":l="display";break;case"\\tfrac":case"\\tbinom":l="text"}return{type:"genfrac",mode:n.mode,continued:!1,numer:s,denom:o,hasBarLine:r,leftDelim:a,rightDelim:c,size:l,barSize:null}},htmlBuilder:tn,mathmlBuilder:rn}),ct({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:function(e,t){var r=e.parser,n=(e.funcName,t[0]),i=t[1];return{type:"genfrac",mode:r.mode,continued:!0,numer:n,denom:i,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}}),ct({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler:function(e){var t,r=e.parser,n=e.funcName,i=e.token;switch(n){case"\\over":t="\\frac";break;case"\\choose":t="\\binom";break;case"\\atop":t="\\\\atopfrac";break;case"\\brace":t="\\\\bracefrac";break;case"\\brack":t="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:r.mode,replaceWith:t,token:i}}});var nn=["display","text","script","scriptscript"],sn=function(e){var t=null;return e.length>0&&(t="."===(t=e)?null:t),t};ct({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler:function(e,t){var r,n=e.parser,i=t[4],s=t[5],o=ut(t[0]),a="atom"===o.type&&"open"===o.family?sn(o.text):null,c=ut(t[1]),l="atom"===c.type&&"close"===c.family?sn(c.text):null,u=zt(t[2],"size"),h=null;r=!!u.isBlank||(h=u.value).number>0;var d="auto",p=t[3];if("ordgroup"===p.type){if(p.body.length>0){var f=zt(p.body[0],"textord");d=nn[Number(f.text)]}}else p=zt(p,"textord"),d=nn[Number(p.text)];return{type:"genfrac",mode:n.mode,numer:i,denom:s,continued:!1,hasBarLine:r,barSize:h,leftDelim:a,rightDelim:l,size:d}},htmlBuilder:tn,mathmlBuilder:rn}),ct({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler:function(e,t){var r=e.parser,n=(e.funcName,e.token);return{type:"infix",mode:r.mode,replaceWith:"\\\\abovefrac",size:zt(t[0],"size").value,token:n}}}),ct({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:function(e,t){var r=e.parser,n=(e.funcName,t[0]),i=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e}(zt(t[1],"infix").size),s=t[2],o=i.number>0;return{type:"genfrac",mode:r.mode,numer:n,denom:s,continued:!1,hasBarLine:o,barSize:i,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:tn,mathmlBuilder:rn});var on=function(e,t){var r,n,i=t.style;"supsub"===e.type?(r=e.sup?kt(e.sup,t.havingStyle(i.sup()),t):kt(e.sub,t.havingStyle(i.sub()),t),n=zt(e.base,"horizBrace")):n=zt(e,"horizBrace");var s,o=kt(n.base,t.havingBaseStyle(E.DISPLAY)),a=Kt(n,t);if(n.isOver?(s=Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"kern",size:.1},{type:"elem",elem:a}]},t)).children[0].children[0].children[1].classes.push("svg-align"):(s=Ze.makeVList({positionType:"bottom",positionData:o.depth+.1+a.height,children:[{type:"elem",elem:a},{type:"kern",size:.1},{type:"elem",elem:o}]},t)).children[0].children[0].children[0].classes.push("svg-align"),r){var c=Ze.makeSpan(["mord",n.isOver?"mover":"munder"],[s],t);s=n.isOver?Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:c},{type:"kern",size:.2},{type:"elem",elem:r}]},t):Ze.makeVList({positionType:"bottom",positionData:c.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:c}]},t)}return Ze.makeSpan(["mord",n.isOver?"mover":"munder"],[s],t)};ct({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler:function(e,t){var r=e.parser,n=e.funcName;return{type:"horizBrace",mode:r.mode,label:n,isOver:/^\\over/.test(n),base:t[0]}},htmlBuilder:on,mathmlBuilder:function(e,t){var r=jt(e.label);return new It.MathNode(e.isOver?"mover":"munder",[Lt(e.base,t),r])}}),ct({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:function(e,t){var r=e.parser,n=t[1],i=zt(t[0],"url").url;return r.settings.isTrusted({command:"\\href",url:i})?{type:"href",mode:r.mode,href:i,body:ht(n)}:r.formatUnsupportedCmd("\\href")},htmlBuilder:function(e,t){var r=yt(e.body,t,!1);return Ze.makeAnchor(e.href,[],r,t)},mathmlBuilder:function(e,t){var r=Mt(e.body,t);return r instanceof Tt||(r=new Tt("mrow",[r])),r.setAttribute("href",e.href),r}}),ct({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:function(e,t){var r=e.parser,n=zt(t[0],"url").url;if(!r.settings.isTrusted({command:"\\url",url:n}))return r.formatUnsupportedCmd("\\url");for(var i=[],s=0;s<n.length;s++){var o=n[s];"~"===o&&(o="\\textasciitilde"),i.push({type:"textord",mode:"text",text:o})}var a={type:"text",mode:r.mode,font:"\\texttt",body:i};return{type:"href",mode:r.mode,href:n,body:ht(a)}}}),ct({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler:function(e,t){return{type:"hbox",mode:e.parser.mode,body:ht(t[0])}},htmlBuilder:function(e,t){var r=yt(e.body,t,!1);return Ze.makeFragment(r)},mathmlBuilder:function(e,t){return new It.MathNode("mrow",Dt(e.body,t))}}),ct({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:function(e,t){var r,i=e.parser,s=e.funcName,o=(e.token,zt(t[0],"raw").string),a=t[1];i.settings.strict&&i.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var c={};switch(s){case"\\htmlClass":c.class=o,r={command:"\\htmlClass",class:o};break;case"\\htmlId":c.id=o,r={command:"\\htmlId",id:o};break;case"\\htmlStyle":c.style=o,r={command:"\\htmlStyle",style:o};break;case"\\htmlData":for(var l=o.split(","),u=0;u<l.length;u++){var h=l[u].split("=");if(2!==h.length)throw new n("Error parsing key-value for \\htmlData");c["data-"+h[0].trim()]=h[1].trim()}r={command:"\\htmlData",attributes:c};break;default:throw new Error("Unrecognized html command")}return i.settings.isTrusted(r)?{type:"html",mode:i.mode,attributes:c,body:ht(a)}:i.formatUnsupportedCmd(s)},htmlBuilder:function(e,t){var r=yt(e.body,t,!1),n=["enclosing"];e.attributes.class&&n.push.apply(n,e.attributes.class.trim().split(/\s+/));var i=Ze.makeSpan(n,r,t);for(var s in e.attributes)"class"!==s&&e.attributes.hasOwnProperty(s)&&i.setAttribute(s,e.attributes[s]);return i},mathmlBuilder:function(e,t){return Mt(e.body,t)}}),ct({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:function(e,t){return{type:"htmlmathml",mode:e.parser.mode,html:ht(t[0]),mathml:ht(t[1])}},htmlBuilder:function(e,t){var r=yt(e.html,t,!1);return Ze.makeFragment(r)},mathmlBuilder:function(e,t){return Mt(e.mathml,t)}});var an=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new n("Invalid size: '"+e+"' in \\includegraphics");var r={number:+(t[1]+t[2]),unit:t[3]};if(!je(r))throw new n("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};ct({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:function(e,t,r){var i=e.parser,s={number:0,unit:"em"},o={number:.9,unit:"em"},a={number:0,unit:"em"},c="";if(r[0])for(var l=zt(r[0],"raw").string.split(","),u=0;u<l.length;u++){var h=l[u].split("=");if(2===h.length){var d=h[1].trim();switch(h[0].trim()){case"alt":c=d;break;case"width":s=an(d);break;case"height":o=an(d);break;case"totalheight":a=an(d);break;default:throw new n("Invalid key: '"+h[0]+"' in \\includegraphics.")}}}var p=zt(t[0],"url").url;return""===c&&(c=(c=(c=p).replace(/^.*[\\/]/,"")).substring(0,c.lastIndexOf("."))),i.settings.isTrusted({command:"\\includegraphics",url:p})?{type:"includegraphics",mode:i.mode,alt:c,width:s,height:o,totalheight:a,src:p}:i.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:function(e,t){var r=Ke(e.height,t),n=0;e.totalheight.number>0&&(n=Ke(e.totalheight,t)-r,n=Number(n.toFixed(2)));var i=0;e.width.number>0&&(i=Ke(e.width,t));var s={height:r+n+"em"};i>0&&(s.width=i+"em"),n>0&&(s.verticalAlign=-n+"em");var o=new N(e.src,e.alt,s);return o.height=r,o.depth=n,o},mathmlBuilder:function(e,t){var r=new It.MathNode("mglyph",[]);r.setAttribute("alt",e.alt);var n=Ke(e.height,t),i=0;if(e.totalheight.number>0&&(i=(i=Ke(e.totalheight,t)-n).toFixed(2),r.setAttribute("valign","-"+i+"em")),r.setAttribute("height",n+i+"em"),e.width.number>0){var s=Ke(e.width,t);r.setAttribute("width",s+"em")}return r.setAttribute("src",e.src),r}}),ct({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler:function(e,t){var r=e.parser,n=e.funcName,i=zt(t[0],"size");if(r.settings.strict){var s="m"===n[1],o="mu"===i.value.unit;s?(o||r.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+n+" supports only mu units, not "+i.value.unit+" units"),"math"!==r.mode&&r.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+n+" works only in math mode")):o&&r.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+n+" doesn't support mu units")}return{type:"kern",mode:r.mode,dimension:i.value}},htmlBuilder:function(e,t){return Ze.makeGlue(e.dimension,t)},mathmlBuilder:function(e,t){var r=Ke(e.dimension,t);return new It.SpaceNode(r)}}),ct({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:function(e,t){var r=e.parser,n=e.funcName,i=t[0];return{type:"lap",mode:r.mode,alignment:n.slice(5),body:i}},htmlBuilder:function(e,t){var r;"clap"===e.alignment?(r=Ze.makeSpan([],[kt(e.body,t)]),r=Ze.makeSpan(["inner"],[r],t)):r=Ze.makeSpan(["inner"],[kt(e.body,t)]);var n=Ze.makeSpan(["fix"],[]),i=Ze.makeSpan([e.alignment],[r,n],t),s=Ze.makeSpan(["strut"]);return s.style.height=i.height+i.depth+"em",s.style.verticalAlign=-i.depth+"em",i.children.unshift(s),i=Ze.makeSpan(["thinbox"],[i],t),Ze.makeSpan(["mord","vbox"],[i],t)},mathmlBuilder:function(e,t){var r=new It.MathNode("mpadded",[Lt(e.body,t)]);if("rlap"!==e.alignment){var n="llap"===e.alignment?"-1":"-0.5";r.setAttribute("lspace",n+"width")}return r.setAttribute("width","0px"),r}}),ct({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler:function(e,t){var r=e.funcName,n=e.parser,i=n.mode;n.switchMode("math");var s="\\("===r?"\\)":"$",o=n.parseExpression(!1,s);return n.expect(s),n.switchMode(i),{type:"styling",mode:n.mode,style:"text",body:o}}}),ct({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler:function(e,t){throw new n("Mismatched "+e.funcName)}});var cn=function(e,t){switch(t.style.size){case E.DISPLAY.size:return e.display;case E.TEXT.size:return e.text;case E.SCRIPT.size:return e.script;case E.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};ct({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:function(e,t){return{type:"mathchoice",mode:e.parser.mode,display:ht(t[0]),text:ht(t[1]),script:ht(t[2]),scriptscript:ht(t[3])}},htmlBuilder:function(e,t){var r=cn(e,t),n=yt(r,t,!1);return Ze.makeFragment(n)},mathmlBuilder:function(e,t){var r=cn(e,t);return Mt(r,t)}});var ln=function(e,t,r,n,i,s,o){var a,c,l;if(e=Ze.makeSpan([],[e]),t){var u=kt(t,n.havingStyle(i.sup()),n);c={elem:u,kern:Math.max(n.fontMetrics().bigOpSpacing1,n.fontMetrics().bigOpSpacing3-u.depth)}}if(r){var h=kt(r,n.havingStyle(i.sub()),n);a={elem:h,kern:Math.max(n.fontMetrics().bigOpSpacing2,n.fontMetrics().bigOpSpacing4-h.height)}}if(c&&a){var d=n.fontMetrics().bigOpSpacing5+a.elem.height+a.elem.depth+a.kern+e.depth+o;l=Ze.makeVList({positionType:"bottom",positionData:d,children:[{type:"kern",size:n.fontMetrics().bigOpSpacing5},{type:"elem",elem:a.elem,marginLeft:-s+"em"},{type:"kern",size:a.kern},{type:"elem",elem:e},{type:"kern",size:c.kern},{type:"elem",elem:c.elem,marginLeft:s+"em"},{type:"kern",size:n.fontMetrics().bigOpSpacing5}]},n)}else if(a){var p=e.height-o;l=Ze.makeVList({positionType:"top",positionData:p,children:[{type:"kern",size:n.fontMetrics().bigOpSpacing5},{type:"elem",elem:a.elem,marginLeft:-s+"em"},{type:"kern",size:a.kern},{type:"elem",elem:e}]},n)}else{if(!c)return e;var f=e.depth+o;l=Ze.makeVList({positionType:"bottom",positionData:f,children:[{type:"elem",elem:e},{type:"kern",size:c.kern},{type:"elem",elem:c.elem,marginLeft:s+"em"},{type:"kern",size:n.fontMetrics().bigOpSpacing5}]},n)}return Ze.makeSpan(["mop","op-limits"],[l],n)},un=["\\smallint"],hn=function(e,t){var r,n,i,s=!1;"supsub"===e.type?(r=e.sup,n=e.sub,i=zt(e.base,"op"),s=!0):i=zt(e,"op");var o,a=t.style,l=!1;if(a.size===E.DISPLAY.size&&i.symbol&&!c(un,i.name)&&(l=!0),i.symbol){var u=l?"Size2-Regular":"Size1-Regular",h="";if("\\oiint"!==i.name&&"\\oiiint"!==i.name||(h=i.name.substr(1),i.name="oiint"===h?"\\iint":"\\iiint"),o=Ze.makeSymbol(i.name,u,"math",t,["mop","op-symbol",l?"large-op":"small-op"]),h.length>0){var d=o.italic,p=Ze.staticSvg(h+"Size"+(l?"2":"1"),t);o=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:0},{type:"elem",elem:p,shift:l?.08:0}]},t),i.name="\\"+h,o.classes.unshift("mop"),o.italic=d}}else if(i.body){var f=yt(i.body,t,!0);1===f.length&&f[0]instanceof B?(o=f[0]).classes[0]="mop":o=Ze.makeSpan(["mop"],f,t)}else{for(var g=[],m=1;m<i.name.length;m++)g.push(Ze.mathsym(i.name[m],i.mode,t));o=Ze.makeSpan(["mop"],g,t)}var y=0,v=0;return(o instanceof B||"\\oiint"===i.name||"\\oiiint"===i.name)&&!i.suppressBaseShift&&(y=(o.height-o.depth)/2-t.fontMetrics().axisHeight,v=o.italic),s?ln(o,r,n,t,a,v,y):(y&&(o.style.position="relative",o.style.top=y+"em"),o)},dn=function(e,t){var r;if(e.symbol)r=new Tt("mo",[Rt(e.name,e.mode)]),c(un,e.name)&&r.setAttribute("largeop","false");else if(e.body)r=new Tt("mo",Dt(e.body,t));else{r=new Tt("mi",[new Ct(e.name.slice(1))]);var n=new Tt("mo",[Rt("","text")]);r=e.parentIsSupSub?new Tt("mrow",[r,n]):At([r,n])}return r},pn={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};ct({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:function(e,t){var r=e.parser,n=e.funcName;return 1===n.length&&(n=pn[n]),{type:"op",mode:r.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:n}},htmlBuilder:hn,mathmlBuilder:dn}),ct({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:function(e,t){var r=e.parser,n=t[0];return{type:"op",mode:r.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:ht(n)}},htmlBuilder:hn,mathmlBuilder:dn});var fn={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};ct({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler:function(e){var t=e.parser,r=e.funcName;return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:r}},htmlBuilder:hn,mathmlBuilder:dn}),ct({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler:function(e){var t=e.parser,r=e.funcName;return{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:r}},htmlBuilder:hn,mathmlBuilder:dn}),ct({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0},handler:function(e){var t=e.parser,r=e.funcName;return 1===r.length&&(r=fn[r]),{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:hn,mathmlBuilder:dn});var gn=function(e,t){var r,n,i,s,o=!1;if("supsub"===e.type?(r=e.sup,n=e.sub,i=zt(e.base,"operatorname"),o=!0):i=zt(e,"operatorname"),i.body.length>0){for(var a=i.body.map((function(e){var t=e.text;return"string"==typeof t?{type:"textord",mode:e.mode,text:t}:e})),c=yt(a,t.withFont("mathrm"),!0),l=0;l<c.length;l++){var u=c[l];u instanceof B&&(u.text=u.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}s=Ze.makeSpan(["mop"],c,t)}else s=Ze.makeSpan(["mop"],[],t);return o?ln(s,r,n,t,t.style,0,0):s};function mn(e,t,r){for(var n=yt(e,t,!1),i=t.sizeMultiplier/r.sizeMultiplier,s=0;s<n.length;s++){var o=n[s].classes.indexOf("sizing");o<0?Array.prototype.push.apply(n[s].classes,t.sizingClasses(r)):n[s].classes[o+1]==="reset-size"+t.size&&(n[s].classes[o+1]="reset-size"+r.size),n[s].height*=i,n[s].depth*=i}return Ze.makeFragment(n)}ct({type:"operatorname",names:["\\operatorname","\\operatorname*"],props:{numArgs:1},handler:function(e,t){var r=e.parser,n=e.funcName,i=t[0];return{type:"operatorname",mode:r.mode,body:ht(i),alwaysHandleSupSub:"\\operatorname*"===n,limits:!1,parentIsSupSub:!1}},htmlBuilder:gn,mathmlBuilder:function(e,t){for(var r=Dt(e.body,t.withFont("mathrm")),n=!0,i=0;i<r.length;i++){var s=r[i];if(s instanceof It.SpaceNode);else if(s instanceof It.MathNode)switch(s.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":var o=s.children[0];1===s.children.length&&o instanceof It.TextNode?o.text=o.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):n=!1;break;default:n=!1}else n=!1}if(n){var a=r.map((function(e){return e.toText()})).join("");r=[new It.TextNode(a)]}var c=new It.MathNode("mi",r);c.setAttribute("mathvariant","normal");var l=new It.MathNode("mo",[Rt("","text")]);return e.parentIsSupSub?new It.MathNode("mrow",[c,l]):It.newDocumentFragment([c,l])}}),lt({type:"ordgroup",htmlBuilder:function(e,t){return e.semisimple?Ze.makeFragment(yt(e.body,t,!1)):Ze.makeSpan(["mord"],yt(e.body,t,!0),t)},mathmlBuilder:function(e,t){return Mt(e.body,t,!0)}}),ct({type:"overline",names:["\\overline"],props:{numArgs:1},handler:function(e,t){var r=e.parser,n=t[0];return{type:"overline",mode:r.mode,body:n}},htmlBuilder:function(e,t){var r=kt(e.body,t.havingCrampedStyle()),n=Ze.makeLineSpan("overline-line",t),i=t.fontMetrics().defaultRuleThickness,s=Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:r},{type:"kern",size:3*i},{type:"elem",elem:n},{type:"kern",size:i}]},t);return Ze.makeSpan(["mord","overline"],[s],t)},mathmlBuilder:function(e,t){var r=new It.MathNode("mo",[new It.TextNode("")]);r.setAttribute("stretchy","true");var n=new It.MathNode("mover",[Lt(e.body,t),r]);return n.setAttribute("accent","true"),n}}),ct({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:function(e,t){var r=e.parser,n=t[0];return{type:"phantom",mode:r.mode,body:ht(n)}},htmlBuilder:function(e,t){var r=yt(e.body,t.withPhantom(),!1);return Ze.makeFragment(r)},mathmlBuilder:function(e,t){var r=Dt(e.body,t);return new It.MathNode("mphantom",r)}}),ct({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:function(e,t){var r=e.parser,n=t[0];return{type:"hphantom",mode:r.mode,body:n}},htmlBuilder:function(e,t){var r=Ze.makeSpan([],[kt(e.body,t.withPhantom())]);if(r.height=0,r.depth=0,r.children)for(var n=0;n<r.children.length;n++)r.children[n].height=0,r.children[n].depth=0;return r=Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:r}]},t),Ze.makeSpan(["mord"],[r],t)},mathmlBuilder:function(e,t){var r=Dt(ht(e.body),t),n=new It.MathNode("mphantom",r),i=new It.MathNode("mpadded",[n]);return i.setAttribute("height","0px"),i.setAttribute("depth","0px"),i}}),ct({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:function(e,t){var r=e.parser,n=t[0];return{type:"vphantom",mode:r.mode,body:n}},htmlBuilder:function(e,t){var r=Ze.makeSpan(["inner"],[kt(e.body,t.withPhantom())]),n=Ze.makeSpan(["fix"],[]);return Ze.makeSpan(["mord","rlap"],[r,n],t)},mathmlBuilder:function(e,t){var r=Dt(ht(e.body),t),n=new It.MathNode("mphantom",r),i=new It.MathNode("mpadded",[n]);return i.setAttribute("width","0px"),i}}),ct({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler:function(e,t){var r=e.parser,n=zt(t[0],"size").value,i=t[1];return{type:"raisebox",mode:r.mode,dy:n,body:i}},htmlBuilder:function(e,t){var r=kt(e.body,t),n=Ke(e.dy,t);return Ze.makeVList({positionType:"shift",positionData:-n,children:[{type:"elem",elem:r}]},t)},mathmlBuilder:function(e,t){var r=new It.MathNode("mpadded",[Lt(e.body,t)]),n=e.dy.number+e.dy.unit;return r.setAttribute("voffset",n),r}}),ct({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler:function(e,t,r){var n=e.parser,i=r[0],s=zt(t[0],"size"),o=zt(t[1],"size");return{type:"rule",mode:n.mode,shift:i&&zt(i,"size").value,width:s.value,height:o.value}},htmlBuilder:function(e,t){var r=Ze.makeSpan(["mord","rule"],[],t),n=Ke(e.width,t),i=Ke(e.height,t),s=e.shift?Ke(e.shift,t):0;return r.style.borderRightWidth=n+"em",r.style.borderTopWidth=i+"em",r.style.bottom=s+"em",r.width=n,r.height=i+s,r.depth=-s,r.maxFontSize=1.125*i*t.sizeMultiplier,r},mathmlBuilder:function(e,t){var r=Ke(e.width,t),n=Ke(e.height,t),i=e.shift?Ke(e.shift,t):0,s=t.color&&t.getColor()||"black",o=new It.MathNode("mspace");o.setAttribute("mathbackground",s),o.setAttribute("width",r+"em"),o.setAttribute("height",n+"em");var a=new It.MathNode("mpadded",[o]);return i>=0?a.setAttribute("height","+"+i+"em"):(a.setAttribute("height",i+"em"),a.setAttribute("depth","+"+-i+"em")),a.setAttribute("voffset",i+"em"),a}});var yn=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];ct({type:"sizing",names:yn,props:{numArgs:0,allowedInText:!0},handler:function(e,t){var r=e.breakOnTokenText,n=e.funcName,i=e.parser,s=i.parseExpression(!1,r);return{type:"sizing",mode:i.mode,size:yn.indexOf(n)+1,body:s}},htmlBuilder:function(e,t){var r=t.havingSize(e.size);return mn(e.body,r,t)},mathmlBuilder:function(e,t){var r=t.havingSize(e.size),n=Dt(e.body,r),i=new It.MathNode("mstyle",n);return i.setAttribute("mathsize",r.sizeMultiplier+"em"),i}}),ct({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:function(e,t,r){var n=e.parser,i=!1,s=!1,o=r[0]&&zt(r[0],"ordgroup");if(o)for(var a="",c=0;c<o.body.length;++c)if("t"===(a=o.body[c].text))i=!0;else{if("b"!==a){i=!1,s=!1;break}s=!0}else i=!0,s=!0;var l=t[0];return{type:"smash",mode:n.mode,body:l,smashHeight:i,smashDepth:s}},htmlBuilder:function(e,t){var r=Ze.makeSpan([],[kt(e.body,t)]);if(!e.smashHeight&&!e.smashDepth)return r;if(e.smashHeight&&(r.height=0,r.children))for(var n=0;n<r.children.length;n++)r.children[n].height=0;if(e.smashDepth&&(r.depth=0,r.children))for(var i=0;i<r.children.length;i++)r.children[i].depth=0;var s=Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:r}]},t);return Ze.makeSpan(["mord"],[s],t)},mathmlBuilder:function(e,t){var r=new It.MathNode("mpadded",[Lt(e.body,t)]);return e.smashHeight&&r.setAttribute("height","0px"),e.smashDepth&&r.setAttribute("depth","0px"),r}}),ct({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler:function(e,t,r){var n=e.parser,i=r[0],s=t[0];return{type:"sqrt",mode:n.mode,body:s,index:i}},htmlBuilder:function(e,t){var r=kt(e.body,t.havingCrampedStyle());0===r.height&&(r.height=t.fontMetrics().xHeight),r=Ze.wrapFragment(r,t);var n=t.fontMetrics().defaultRuleThickness,i=n;t.style.id<E.TEXT.id&&(i=t.fontMetrics().xHeight);var s=n+i/4,o=function(e,t){var r,n,i=t.havingBaseSizing(),s=Er("\\surd",e*i.sizeMultiplier,Sr,i),o=i.sizeMultiplier,a=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),c=0,l=0,u=0;return"small"===s.type?(e<1?o=1:e<1.4&&(o=.7),l=(1+a)/o,(r=gr("sqrtMain",c=(1+a+fr)/o,u=1e3+1e3*a+80,a,t)).style.minWidth="0.853em",n=.833/o):"large"===s.type?(u=1080*_r[s.size],l=(_r[s.size]+a)/o,c=(_r[s.size]+a+fr)/o,(r=gr("sqrtSize"+s.size,c,u,a,t)).style.minWidth="1.02em",n=1/o):(c=e+a+fr,l=e+a,u=Math.floor(1e3*e+a)+80,(r=gr("sqrtTall",c,u,a,t)).style.minWidth="0.742em",n=1.056),r.height=l,r.style.height=c+"em",{span:r,advanceWidth:n,ruleWidth:(t.fontMetrics().sqrtRuleThickness+a)*o}}(r.height+r.depth+s+n,t),a=o.span,c=o.ruleWidth,l=o.advanceWidth,u=a.height-c;u>r.height+r.depth+s&&(s=(s+u-r.height-r.depth)/2);var h=a.height-r.height-s-c;r.style.paddingLeft=l+"em";var d=Ze.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:-(r.height+h)},{type:"elem",elem:a},{type:"kern",size:c}]},t);if(e.index){var p=t.havingStyle(E.SCRIPTSCRIPT),f=kt(e.index,p,t),g=.6*(d.height-d.depth),m=Ze.makeVList({positionType:"shift",positionData:-g,children:[{type:"elem",elem:f}]},t),y=Ze.makeSpan(["root"],[m]);return Ze.makeSpan(["mord","sqrt"],[y,d],t)}return Ze.makeSpan(["mord","sqrt"],[d],t)},mathmlBuilder:function(e,t){var r=e.body,n=e.index;return n?new It.MathNode("mroot",[Lt(r,t),Lt(n,t)]):new It.MathNode("msqrt",[Lt(r,t)])}});var vn={display:E.DISPLAY,text:E.TEXT,script:E.SCRIPT,scriptscript:E.SCRIPTSCRIPT};ct({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler:function(e,t){var r=e.breakOnTokenText,n=e.funcName,i=e.parser,s=i.parseExpression(!0,r),o=n.slice(1,n.length-5);return{type:"styling",mode:i.mode,style:o,body:s}},htmlBuilder:function(e,t){var r=vn[e.style],n=t.havingStyle(r).withFont("");return mn(e.body,n,t)},mathmlBuilder:function(e,t){var r=vn[e.style],n=t.havingStyle(r),i=Dt(e.body,n),s=new It.MathNode("mstyle",i),o={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]}[e.style];return s.setAttribute("scriptlevel",o[0]),s.setAttribute("displaystyle",o[1]),s}});lt({type:"supsub",htmlBuilder:function(e,t){var r=function(e,t){var r=e.base;return r?"op"===r.type?r.limits&&(t.style.size===E.DISPLAY.size||r.alwaysHandleSupSub)?hn:null:"operatorname"===r.type?r.alwaysHandleSupSub&&(t.style.size===E.DISPLAY.size||r.limits)?gn:null:"accent"===r.type?p(r.base)?Vt:null:"horizBrace"===r.type&&!e.sub===r.isOver?on:null:null}(e,t);if(r)return r(e,t);var n,i,s,o=e.base,a=e.sup,c=e.sub,l=kt(o,t),u=t.fontMetrics(),h=0,d=0,f=o&&p(o);if(a){var g=t.havingStyle(t.style.sup());n=kt(a,g,t),f||(h=l.height-g.fontMetrics().supDrop*g.sizeMultiplier/t.sizeMultiplier)}if(c){var m=t.havingStyle(t.style.sub());i=kt(c,m,t),f||(d=l.depth+m.fontMetrics().subDrop*m.sizeMultiplier/t.sizeMultiplier)}s=t.style===E.DISPLAY?u.sup1:t.style.cramped?u.sup3:u.sup2;var y,v=t.sizeMultiplier,_=.5/u.ptPerEm/v+"em",b=null;if(i){var w=e.base&&"op"===e.base.type&&e.base.name&&("\\oiint"===e.base.name||"\\oiiint"===e.base.name);(l instanceof B||w)&&(b=-l.italic+"em")}if(n&&i){h=Math.max(h,s,n.depth+.25*u.xHeight),d=Math.max(d,u.sub2);var S=4*u.defaultRuleThickness;if(h-n.depth-(i.height-d)<S){d=S-(h-n.depth)+i.height;var k=.8*u.xHeight-(h-n.depth);k>0&&(h+=k,d-=k)}y=Ze.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:d,marginRight:_,marginLeft:b},{type:"elem",elem:n,shift:-h,marginRight:_}]},t)}else if(i){d=Math.max(d,u.sub1,i.height-.8*u.xHeight),y=Ze.makeVList({positionType:"shift",positionData:d,children:[{type:"elem",elem:i,marginLeft:b,marginRight:_}]},t)}else{if(!n)throw new Error("supsub must have either sup or sub.");h=Math.max(h,s,n.depth+.25*u.xHeight),y=Ze.makeVList({positionType:"shift",positionData:-h,children:[{type:"elem",elem:n,marginRight:_}]},t)}var x=wt(l,"right")||"mord";return Ze.makeSpan([x],[l,Ze.makeSpan(["msupsub"],[y])],t)},mathmlBuilder:function(e,t){var r,n=!1;e.base&&"horizBrace"===e.base.type&&!!e.sup===e.base.isOver&&(n=!0,r=e.base.isOver),!e.base||"op"!==e.base.type&&"operatorname"!==e.base.type||(e.base.parentIsSupSub=!0);var i,s=[Lt(e.base,t)];if(e.sub&&s.push(Lt(e.sub,t)),e.sup&&s.push(Lt(e.sup,t)),n)i=r?"mover":"munder";else if(e.sub)if(e.sup){var o=e.base;i=o&&"op"===o.type&&o.limits&&t.style===E.DISPLAY||o&&"operatorname"===o.type&&o.alwaysHandleSupSub&&(t.style===E.DISPLAY||o.limits)?"munderover":"msubsup"}else{var a=e.base;i=a&&"op"===a.type&&a.limits&&(t.style===E.DISPLAY||a.alwaysHandleSupSub)||a&&"operatorname"===a.type&&a.alwaysHandleSupSub&&(a.limits||t.style===E.DISPLAY)?"munder":"msub"}else{var c=e.base;i=c&&"op"===c.type&&c.limits&&(t.style===E.DISPLAY||c.alwaysHandleSupSub)||c&&"operatorname"===c.type&&c.alwaysHandleSupSub&&(c.limits||t.style===E.DISPLAY)?"mover":"msup"}return new It.MathNode(i,s)}}),lt({type:"atom",htmlBuilder:function(e,t){return Ze.mathsym(e.text,e.mode,t,["m"+e.family])},mathmlBuilder:function(e,t){var r=new It.MathNode("mo",[Rt(e.text,e.mode)]);if("bin"===e.family){var n=Pt(e,t);"bold-italic"===n&&r.setAttribute("mathvariant",n)}else"punct"===e.family?r.setAttribute("separator","true"):"open"!==e.family&&"close"!==e.family||r.setAttribute("stretchy","false");return r}});var _n={mi:"italic",mn:"normal",mtext:"normal"};lt({type:"mathord",htmlBuilder:function(e,t){return Ze.makeOrd(e,t,"mathord")},mathmlBuilder:function(e,t){var r=new It.MathNode("mi",[Rt(e.text,e.mode,t)]),n=Pt(e,t)||"italic";return n!==_n[r.type]&&r.setAttribute("mathvariant",n),r}}),lt({type:"textord",htmlBuilder:function(e,t){return Ze.makeOrd(e,t,"textord")},mathmlBuilder:function(e,t){var r,n=Rt(e.text,e.mode,t),i=Pt(e,t)||"normal";return r="text"===e.mode?new It.MathNode("mtext",[n]):/[0-9]/.test(e.text)?new It.MathNode("mn",[n]):"\\prime"===e.text?new It.MathNode("mo",[n]):new It.MathNode("mi",[n]),i!==_n[r.type]&&r.setAttribute("mathvariant",i),r}});var bn={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},wn={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};lt({type:"spacing",htmlBuilder:function(e,t){if(wn.hasOwnProperty(e.text)){var r=wn[e.text].className||"";if("text"===e.mode){var i=Ze.makeOrd(e,t,"textord");return i.classes.push(r),i}return Ze.makeSpan(["mspace",r],[Ze.mathsym(e.text,e.mode,t)],t)}if(bn.hasOwnProperty(e.text))return Ze.makeSpan(["mspace",bn[e.text]],[],t);throw new n('Unknown type of space "'+e.text+'"')},mathmlBuilder:function(e,t){if(!wn.hasOwnProperty(e.text)){if(bn.hasOwnProperty(e.text))return new It.MathNode("mspace");throw new n('Unknown type of space "'+e.text+'"')}return new It.MathNode("mtext",[new It.TextNode("")])}});var Sn=function(){var e=new It.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};lt({type:"tag",mathmlBuilder:function(e,t){var r=new It.MathNode("mtable",[new It.MathNode("mtr",[Sn(),new It.MathNode("mtd",[Mt(e.body,t)]),Sn(),new It.MathNode("mtd",[Mt(e.tag,t)])])]);return r.setAttribute("width","100%"),r}});var kn={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},En={"\\textbf":"textbf","\\textmd":"textmd"},xn={"\\textit":"textit","\\textup":"textup"},An=function(e,t){var r=e.font;return r?kn[r]?t.withTextFontFamily(kn[r]):En[r]?t.withTextFontWeight(En[r]):t.withTextFontShape(xn[r]):t};ct({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler:function(e,t){var r=e.parser,n=e.funcName,i=t[0];return{type:"text",mode:r.mode,body:ht(i),font:n}},htmlBuilder:function(e,t){var r=An(e,t),n=yt(e.body,r,!0);return Ze.makeSpan(["mord","text"],n,r)},mathmlBuilder:function(e,t){var r=An(e,t);return Mt(e.body,r)}}),ct({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler:function(e,t){return{type:"underline",mode:e.parser.mode,body:t[0]}},htmlBuilder:function(e,t){var r=kt(e.body,t),n=Ze.makeLineSpan("underline-line",t),i=t.fontMetrics().defaultRuleThickness,s=Ze.makeVList({positionType:"top",positionData:r.height,children:[{type:"kern",size:i},{type:"elem",elem:n},{type:"kern",size:3*i},{type:"elem",elem:r}]},t);return Ze.makeSpan(["mord","underline"],[s],t)},mathmlBuilder:function(e,t){var r=new It.MathNode("mo",[new It.TextNode("")]);r.setAttribute("stretchy","true");var n=new It.MathNode("munder",[Lt(e.body,t),r]);return n.setAttribute("accentunder","true"),n}}),ct({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler:function(e,t){return{type:"vcenter",mode:e.parser.mode,body:t[0]}},htmlBuilder:function(e,t){var r=kt(e.body,t),n=t.fontMetrics().axisHeight,i=.5*(r.height-n-(r.depth+n));return Ze.makeVList({positionType:"shift",positionData:i,children:[{type:"elem",elem:r}]},t)},mathmlBuilder:function(e,t){return new It.MathNode("mpadded",[Lt(e.body,t)],["vcenter"])}}),ct({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler:function(e,t,r){throw new n("\\verb ended by end of line instead of matching delimiter")},htmlBuilder:function(e,t){for(var r=Tn(e),n=[],i=t.havingStyle(t.style.text()),s=0;s<r.length;s++){var o=r[s];"~"===o&&(o="\\textasciitilde"),n.push(Ze.makeSymbol(o,"Typewriter-Regular",e.mode,i,["mord","texttt"]))}return Ze.makeSpan(["mord","text"].concat(i.sizingClasses(t)),Ze.tryCombineChars(n),i)},mathmlBuilder:function(e,t){var r=new It.TextNode(Tn(e)),n=new It.MathNode("mtext",[r]);return n.setAttribute("mathvariant","monospace"),n}});var Tn=function(e){return e.body.replace(/ /g,e.star?"":"")},Cn=st,In=function(){function e(e,t,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=r}return e.range=function(t,r){return r?t&&t.loc&&r.loc&&t.loc.lexer===r.loc.lexer?new e(t.loc.lexer,t.loc.start,r.loc.end):null:t&&t.loc},e}(),Rn=function(){function e(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}return e.prototype.range=function(t,r){return new e(r,In.range(this,t))},e}(),On=new RegExp("^(\\\\[a-zA-Z@]+)[ \r\n\t]*$"),Pn=new RegExp("[-]+$"),Dn=function(){function e(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp("([ \r\n\t]+)|([!-\\[\\]---][-]*|[\ud800-\udbff][\udc00-\udfff][-]*|\\\\verb\\*([^]).*?\\3|\\\\verb([^*a-zA-Z]).*?\\4|\\\\operatorname\\*|\\\\[a-zA-Z@]+[ \r\n\t]*|\\\\[^\ud800-\udfff])","g"),this.catcodes={"%":14}}var t=e.prototype;return t.setCatcode=function(e,t){this.catcodes[e]=t},t.lex=function(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new Rn("EOF",new In(this,t,t));var r=this.tokenRegex.exec(e);if(null===r||r.index!==t)throw new n("Unexpected character: '"+e[t]+"'",new Rn(e[t],new In(this,t,t+1)));var i=r[2]||" ";if(14===this.catcodes[i]){var s=e.indexOf("\n",this.tokenRegex.lastIndex);return-1===s?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=s+1,this.lex()}var o=i.match(On);return o&&(i=o[1]),new Rn(i,new In(this,t,this.tokenRegex.lastIndex))},e}(),Mn=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}var t=e.prototype;return t.beginGroup=function(){this.undefStack.push({})},t.endGroup=function(){if(0===this.undefStack.length)throw new n("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(void 0===e[t]?delete this.current[t]:this.current[t]=e[t])},t.has=function(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)},t.get=function(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]},t.set=function(e,t,r){if(void 0===r&&(r=!1),r){for(var n=0;n<this.undefStack.length;n++)delete this.undefStack[n][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var i=this.undefStack[this.undefStack.length-1];i&&!i.hasOwnProperty(e)&&(i[e]=this.current[e])}this.current[e]=t},e}(),Ln={},Nn=Ln;function Fn(e,t){Ln[e]=t}Fn("\\noexpand",(function(e){var t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}})),Fn("\\expandafter",(function(e){var t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}})),Fn("\\@firstoftwo",(function(e){return{tokens:e.consumeArgs(2)[0],numArgs:0}})),Fn("\\@secondoftwo",(function(e){return{tokens:e.consumeArgs(2)[1],numArgs:0}})),Fn("\\@ifnextchar",(function(e){var t=e.consumeArgs(3);e.consumeSpaces();var r=e.future();return 1===t[0].length&&t[0][0].text===r.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}})),Fn("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),Fn("\\TextOrMath",(function(e){var t=e.consumeArgs(2);return"text"===e.mode?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}}));var Bn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};Fn("\\char",(function(e){var t,r=e.popToken(),i="";if("'"===r.text)t=8,r=e.popToken();else if('"'===r.text)t=16,r=e.popToken();else if("`"===r.text)if("\\"===(r=e.popToken()).text[0])i=r.text.charCodeAt(1);else{if("EOF"===r.text)throw new n("\\char` missing argument");i=r.text.charCodeAt(0)}else t=10;if(t){if(null==(i=Bn[r.text])||i>=t)throw new n("Invalid base-"+t+" digit "+r.text);for(var s;null!=(s=Bn[e.future().text])&&s<t;)i*=t,i+=s,e.popToken()}return"\\@char{"+i+"}"}));var Un=function(e,t,r){var i=e.consumeArg().tokens;if(1!==i.length)throw new n("\\newcommand's first argument must be a macro name");var s=i[0].text,o=e.isDefined(s);if(o&&!t)throw new n("\\newcommand{"+s+"} attempting to redefine "+s+"; use \\renewcommand");if(!o&&!r)throw new n("\\renewcommand{"+s+"} when command "+s+" does not yet exist; use \\newcommand");var a=0;if(1===(i=e.consumeArg().tokens).length&&"["===i[0].text){for(var c="",l=e.expandNextToken();"]"!==l.text&&"EOF"!==l.text;)c+=l.text,l=e.expandNextToken();if(!c.match(/^\s*[0-9]+\s*$/))throw new n("Invalid number of arguments: "+c);a=parseInt(c),i=e.consumeArg().tokens}return e.macros.set(s,{tokens:i,numArgs:a}),""};Fn("\\newcommand",(function(e){return Un(e,!1,!0)})),Fn("\\renewcommand",(function(e){return Un(e,!0,!1)})),Fn("\\providecommand",(function(e){return Un(e,!0,!0)})),Fn("\\message",(function(e){var t=e.consumeArgs(1)[0];return console.log(t.reverse().map((function(e){return e.text})).join("")),""})),Fn("\\errmessage",(function(e){var t=e.consumeArgs(1)[0];return console.error(t.reverse().map((function(e){return e.text})).join("")),""})),Fn("\\show",(function(e){var t=e.popToken(),r=t.text;return console.log(t,e.macros.get(r),Cn[r],J.math[r],J.text[r]),""})),Fn("\\bgroup","{"),Fn("\\egroup","}"),Fn("\\lq","`"),Fn("\\rq","'"),Fn("\\aa","\\r a"),Fn("\\AA","\\r A"),Fn("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}"),Fn("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}"),Fn("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}"),Fn("","\\mathscr{B}"),Fn("","\\mathscr{E}"),Fn("","\\mathscr{F}"),Fn("","\\mathscr{H}"),Fn("","\\mathscr{I}"),Fn("","\\mathscr{L}"),Fn("","\\mathscr{M}"),Fn("","\\mathscr{R}"),Fn("","\\mathfrak{C}"),Fn("","\\mathfrak{H}"),Fn("","\\mathfrak{Z}"),Fn("\\Bbbk","\\Bbb{k}"),Fn("","\\cdotp"),Fn("\\llap","\\mathllap{\\textrm{#1}}"),Fn("\\rlap","\\mathrlap{\\textrm{#1}}"),Fn("\\clap","\\mathclap{\\textrm{#1}}"),Fn("\\mathstrut","\\vphantom{(}"),Fn("\\underbar","\\underline{\\text{#1}}"),Fn("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}'),Fn("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}"),Fn("\\ne","\\neq"),Fn("","\\neq"),Fn("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}"),Fn("","\\notin"),Fn("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}"),Fn("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}"),Fn("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}"),Fn("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}"),Fn("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}"),Fn("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}"),Fn("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}"),Fn("","\\perp"),Fn("","\\mathclose{!\\mkern-0.8mu!}"),Fn("","\\notni"),Fn("","\\ulcorner"),Fn("","\\urcorner"),Fn("","\\llcorner"),Fn("","\\lrcorner"),Fn("","\\copyright"),Fn("","\\textregistered"),Fn("","\\textregistered"),Fn("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}'),Fn("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}'),Fn("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}'),Fn("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}'),Fn("\\vdots","\\mathord{\\varvdots\\rule{0pt}{15pt}}"),Fn("","\\vdots"),Fn("\\varGamma","\\mathit{\\Gamma}"),Fn("\\varDelta","\\mathit{\\Delta}"),Fn("\\varTheta","\\mathit{\\Theta}"),Fn("\\varLambda","\\mathit{\\Lambda}"),Fn("\\varXi","\\mathit{\\Xi}"),Fn("\\varPi","\\mathit{\\Pi}"),Fn("\\varSigma","\\mathit{\\Sigma}"),Fn("\\varUpsilon","\\mathit{\\Upsilon}"),Fn("\\varPhi","\\mathit{\\Phi}"),Fn("\\varPsi","\\mathit{\\Psi}"),Fn("\\varOmega","\\mathit{\\Omega}"),Fn("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),Fn("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu"),Fn("\\boxed","\\fbox{$\\displaystyle{#1}$}"),Fn("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),Fn("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),Fn("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");var qn={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};Fn("\\dots",(function(e){var t="\\dotso",r=e.expandAfterFuture().text;return r in qn?t=qn[r]:("\\not"===r.substr(0,4)||r in J.math&&c(["bin","rel"],J.math[r].group))&&(t="\\dotsb"),t}));var jn={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};Fn("\\dotso",(function(e){return e.future().text in jn?"\\ldots\\,":"\\ldots"})),Fn("\\dotsc",(function(e){var t=e.future().text;return t in jn&&","!==t?"\\ldots\\,":"\\ldots"})),Fn("\\cdots",(function(e){return e.future().text in jn?"\\@cdots\\,":"\\@cdots"})),Fn("\\dotsb","\\cdots"),Fn("\\dotsm","\\cdots"),Fn("\\dotsi","\\!\\cdots"),Fn("\\dotsx","\\ldots\\,"),Fn("\\DOTSI","\\relax"),Fn("\\DOTSB","\\relax"),Fn("\\DOTSX","\\relax"),Fn("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),Fn("\\,","\\tmspace+{3mu}{.1667em}"),Fn("\\thinspace","\\,"),Fn("\\>","\\mskip{4mu}"),Fn("\\:","\\tmspace+{4mu}{.2222em}"),Fn("\\medspace","\\:"),Fn("\\;","\\tmspace+{5mu}{.2777em}"),Fn("\\thickspace","\\;"),Fn("\\!","\\tmspace-{3mu}{.1667em}"),Fn("\\negthinspace","\\!"),Fn("\\negmedspace","\\tmspace-{4mu}{.2222em}"),Fn("\\negthickspace","\\tmspace-{5mu}{.277em}"),Fn("\\enspace","\\kern.5em "),Fn("\\enskip","\\hskip.5em\\relax"),Fn("\\quad","\\hskip1em\\relax"),Fn("\\qquad","\\hskip2em\\relax"),Fn("\\tag","\\@ifstar\\tag@literal\\tag@paren"),Fn("\\tag@paren","\\tag@literal{({#1})}"),Fn("\\tag@literal",(function(e){if(e.macros.get("\\df@tag"))throw new n("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"})),Fn("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),Fn("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),Fn("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),Fn("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),Fn("\\pmb","\\html@mathml{\\@binrel{#1}{\\mathrlap{#1}\\kern0.5px#1}}{\\mathbf{#1}}"),Fn("\\newline","\\\\\\relax"),Fn("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var Kn=z["Main-Regular"]["T".charCodeAt(0)][1]-.7*z["Main-Regular"]["A".charCodeAt(0)][1]+"em";Fn("\\LaTeX","\\textrm{\\html@mathml{L\\kern-.36em\\raisebox{"+Kn+"}{\\scriptstyle A}\\kern-.15em\\TeX}{LaTeX}}"),Fn("\\KaTeX","\\textrm{\\html@mathml{K\\kern-.17em\\raisebox{"+Kn+"}{\\scriptstyle A}\\kern-.15em\\TeX}{KaTeX}}"),Fn("\\hspace","\\@ifstar\\@hspacer\\@hspace"),Fn("\\@hspace","\\hskip #1\\relax"),Fn("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),Fn("\\ordinarycolon",":"),Fn("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),Fn("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}'),Fn("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}'),Fn("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}'),Fn("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}'),Fn("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}'),Fn("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}'),Fn("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}'),Fn("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}'),Fn("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}'),Fn("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}'),Fn("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}'),Fn("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}'),Fn("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}'),Fn("","\\dblcolon"),Fn("","\\eqcolon"),Fn("","\\coloneqq"),Fn("","\\eqqcolon"),Fn("","\\Coloneqq"),Fn("\\ratio","\\vcentcolon"),Fn("\\coloncolon","\\dblcolon"),Fn("\\colonequals","\\coloneqq"),Fn("\\coloncolonequals","\\Coloneqq"),Fn("\\equalscolon","\\eqqcolon"),Fn("\\equalscoloncolon","\\Eqqcolon"),Fn("\\colonminus","\\coloneq"),Fn("\\coloncolonminus","\\Coloneq"),Fn("\\minuscolon","\\eqcolon"),Fn("\\minuscoloncolon","\\Eqcolon"),Fn("\\coloncolonapprox","\\Colonapprox"),Fn("\\coloncolonsim","\\Colonsim"),Fn("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),Fn("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}"),Fn("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),Fn("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}"),Fn("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}"),Fn("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),Fn("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),Fn("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),Fn("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),Fn("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}"),Fn("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}"),Fn("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}"),Fn("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}"),Fn("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}"),Fn("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}"),Fn("\\ngeqq","\\html@mathml{\\@ngeqq}{}"),Fn("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}"),Fn("\\nleqq","\\html@mathml{\\@nleqq}{}"),Fn("\\nleqslant","\\html@mathml{\\@nleqslant}{}"),Fn("\\nshortmid","\\html@mathml{\\@nshortmid}{}"),Fn("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}"),Fn("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}"),Fn("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}"),Fn("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}"),Fn("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}"),Fn("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}"),Fn("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}"),Fn("\\imath","\\html@mathml{\\@imath}{}"),Fn("\\jmath","\\html@mathml{\\@jmath}{}"),Fn("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}"),Fn("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}"),Fn("","\\llbracket"),Fn("","\\rrbracket"),Fn("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}"),Fn("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}"),Fn("","\\lBrace"),Fn("","\\rBrace"),Fn("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}"),Fn("","\\minuso"),Fn("\\darr","\\downarrow"),Fn("\\dArr","\\Downarrow"),Fn("\\Darr","\\Downarrow"),Fn("\\lang","\\langle"),Fn("\\rang","\\rangle"),Fn("\\uarr","\\uparrow"),Fn("\\uArr","\\Uparrow"),Fn("\\Uarr","\\Uparrow"),Fn("\\N","\\mathbb{N}"),Fn("\\R","\\mathbb{R}"),Fn("\\Z","\\mathbb{Z}"),Fn("\\alef","\\aleph"),Fn("\\alefsym","\\aleph"),Fn("\\Alpha","\\mathrm{A}"),Fn("\\Beta","\\mathrm{B}"),Fn("\\bull","\\bullet"),Fn("\\Chi","\\mathrm{X}"),Fn("\\clubs","\\clubsuit"),Fn("\\cnums","\\mathbb{C}"),Fn("\\Complex","\\mathbb{C}"),Fn("\\Dagger","\\ddagger"),Fn("\\diamonds","\\diamondsuit"),Fn("\\empty","\\emptyset"),Fn("\\Epsilon","\\mathrm{E}"),Fn("\\Eta","\\mathrm{H}"),Fn("\\exist","\\exists"),Fn("\\harr","\\leftrightarrow"),Fn("\\hArr","\\Leftrightarrow"),Fn("\\Harr","\\Leftrightarrow"),Fn("\\hearts","\\heartsuit"),Fn("\\image","\\Im"),Fn("\\infin","\\infty"),Fn("\\Iota","\\mathrm{I}"),Fn("\\isin","\\in"),Fn("\\Kappa","\\mathrm{K}"),Fn("\\larr","\\leftarrow"),Fn("\\lArr","\\Leftarrow"),Fn("\\Larr","\\Leftarrow"),Fn("\\lrarr","\\leftrightarrow"),Fn("\\lrArr","\\Leftrightarrow"),Fn("\\Lrarr","\\Leftrightarrow"),Fn("\\Mu","\\mathrm{M}"),Fn("\\natnums","\\mathbb{N}"),Fn("\\Nu","\\mathrm{N}"),Fn("\\Omicron","\\mathrm{O}"),Fn("\\plusmn","\\pm"),Fn("\\rarr","\\rightarrow"),Fn("\\rArr","\\Rightarrow"),Fn("\\Rarr","\\Rightarrow"),Fn("\\real","\\Re"),Fn("\\reals","\\mathbb{R}"),Fn("\\Reals","\\mathbb{R}"),Fn("\\Rho","\\mathrm{P}"),Fn("\\sdot","\\cdot"),Fn("\\sect","\\S"),Fn("\\spades","\\spadesuit"),Fn("\\sub","\\subset"),Fn("\\sube","\\subseteq"),Fn("\\supe","\\supseteq"),Fn("\\Tau","\\mathrm{T}"),Fn("\\thetasym","\\vartheta"),Fn("\\weierp","\\wp"),Fn("\\Zeta","\\mathrm{Z}"),Fn("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),Fn("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),Fn("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),Fn("\\bra","\\mathinner{\\langle{#1}|}"),Fn("\\ket","\\mathinner{|{#1}\\rangle}"),Fn("\\braket","\\mathinner{\\langle{#1}\\rangle}"),Fn("\\Bra","\\left\\langle#1\\right|"),Fn("\\Ket","\\left|#1\\right\\rangle"),Fn("\\angln","{\\angl n}"),Fn("\\blue","\\textcolor{##6495ed}{#1}"),Fn("\\orange","\\textcolor{##ffa500}{#1}"),Fn("\\pink","\\textcolor{##ff00af}{#1}"),Fn("\\red","\\textcolor{##df0030}{#1}"),Fn("\\green","\\textcolor{##28ae7b}{#1}"),Fn("\\gray","\\textcolor{gray}{#1}"),Fn("\\purple","\\textcolor{##9d38bd}{#1}"),Fn("\\blueA","\\textcolor{##ccfaff}{#1}"),Fn("\\blueB","\\textcolor{##80f6ff}{#1}"),Fn("\\blueC","\\textcolor{##63d9ea}{#1}"),Fn("\\blueD","\\textcolor{##11accd}{#1}"),Fn("\\blueE","\\textcolor{##0c7f99}{#1}"),Fn("\\tealA","\\textcolor{##94fff5}{#1}"),Fn("\\tealB","\\textcolor{##26edd5}{#1}"),Fn("\\tealC","\\textcolor{##01d1c1}{#1}"),Fn("\\tealD","\\textcolor{##01a995}{#1}"),Fn("\\tealE","\\textcolor{##208170}{#1}"),Fn("\\greenA","\\textcolor{##b6ffb0}{#1}"),Fn("\\greenB","\\textcolor{##8af281}{#1}"),Fn("\\greenC","\\textcolor{##74cf70}{#1}"),Fn("\\greenD","\\textcolor{##1fab54}{#1}"),Fn("\\greenE","\\textcolor{##0d923f}{#1}"),Fn("\\goldA","\\textcolor{##ffd0a9}{#1}"),Fn("\\goldB","\\textcolor{##ffbb71}{#1}"),Fn("\\goldC","\\textcolor{##ff9c39}{#1}"),Fn("\\goldD","\\textcolor{##e07d10}{#1}"),Fn("\\goldE","\\textcolor{##a75a05}{#1}"),Fn("\\redA","\\textcolor{##fca9a9}{#1}"),Fn("\\redB","\\textcolor{##ff8482}{#1}"),Fn("\\redC","\\textcolor{##f9685d}{#1}"),Fn("\\redD","\\textcolor{##e84d39}{#1}"),Fn("\\redE","\\textcolor{##bc2612}{#1}"),Fn("\\maroonA","\\textcolor{##ffbde0}{#1}"),Fn("\\maroonB","\\textcolor{##ff92c6}{#1}"),Fn("\\maroonC","\\textcolor{##ed5fa6}{#1}"),Fn("\\maroonD","\\textcolor{##ca337c}{#1}"),Fn("\\maroonE","\\textcolor{##9e034e}{#1}"),Fn("\\purpleA","\\textcolor{##ddd7ff}{#1}"),Fn("\\purpleB","\\textcolor{##c6b9fc}{#1}"),Fn("\\purpleC","\\textcolor{##aa87ff}{#1}"),Fn("\\purpleD","\\textcolor{##7854ab}{#1}"),Fn("\\purpleE","\\textcolor{##543b78}{#1}"),Fn("\\mintA","\\textcolor{##f5f9e8}{#1}"),Fn("\\mintB","\\textcolor{##edf2df}{#1}"),Fn("\\mintC","\\textcolor{##e0e5cc}{#1}"),Fn("\\grayA","\\textcolor{##f6f7f7}{#1}"),Fn("\\grayB","\\textcolor{##f0f1f2}{#1}"),Fn("\\grayC","\\textcolor{##e3e5e6}{#1}"),Fn("\\grayD","\\textcolor{##d6d8da}{#1}"),Fn("\\grayE","\\textcolor{##babec2}{#1}"),Fn("\\grayF","\\textcolor{##888d93}{#1}"),Fn("\\grayG","\\textcolor{##626569}{#1}"),Fn("\\grayH","\\textcolor{##3b3e40}{#1}"),Fn("\\grayI","\\textcolor{##21242c}{#1}"),Fn("\\kaBlue","\\textcolor{##314453}{#1}"),Fn("\\kaGreen","\\textcolor{##71B307}{#1}");var zn={"\\relax":!0,"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0},$n=function(){function e(e,t,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new Mn(Nn,t.macros),this.mode=r,this.stack=[]}var t=e.prototype;return t.feed=function(e){this.lexer=new Dn(e,this.settings)},t.switchMode=function(e){this.mode=e},t.beginGroup=function(){this.macros.beginGroup()},t.endGroup=function(){this.macros.endGroup()},t.future=function(){return 0===this.stack.length&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]},t.popToken=function(){return this.future(),this.stack.pop()},t.pushToken=function(e){this.stack.push(e)},t.pushTokens=function(e){var t;(t=this.stack).push.apply(t,e)},t.scanArgument=function(e){var t,r,n;if(e){if(this.consumeSpaces(),"["!==this.future().text)return null;t=this.popToken();var i=this.consumeArg(["]"]);n=i.tokens,r=i.end}else{var s=this.consumeArg();n=s.tokens,t=s.start,r=s.end}return this.pushToken(new Rn("EOF",r.loc)),this.pushTokens(n),t.range(r,"")},t.consumeSpaces=function(){for(;" "===this.future().text;)this.stack.pop()},t.consumeArg=function(e){var t=[],r=e&&e.length>0;r||this.consumeSpaces();var i,s=this.future(),o=0,a=0;do{if(i=this.popToken(),t.push(i),"{"===i.text)++o;else if("}"===i.text){if(-1==--o)throw new n("Extra }",i)}else if("EOF"===i.text)throw new n("Unexpected end of input in a macro argument, expected '"+(e&&r?e[a]:"}")+"'",i);if(e&&r)if((0===o||1===o&&"{"===e[a])&&i.text===e[a]){if(++a===e.length){t.splice(-a,a);break}}else a=0}while(0!==o||r);return"{"===s.text&&"}"===t[t.length-1].text&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:s,end:i}},t.consumeArgs=function(e,t){if(t){if(t.length!==e+1)throw new n("The length of delimiters doesn't match the number of args!");for(var r=t[0],i=0;i<r.length;i++){var s=this.popToken();if(r[i]!==s.text)throw new n("Use of the macro doesn't match its definition",s)}}for(var o=[],a=0;a<e;a++)o.push(this.consumeArg(t&&t[a+1]).tokens);return o},t.expandOnce=function(e){var t=this.popToken(),r=t.text,i=t.noexpand?null:this._getExpansion(r);if(null==i||e&&i.unexpandable){if(e&&null==i&&"\\"===r[0]&&!this.isDefined(r))throw new n("Undefined control sequence: "+r);return this.pushToken(t),t}if(this.expansionCount++,this.expansionCount>this.settings.maxExpand)throw new n("Too many expansions: infinite loop or need to increase maxExpand setting");var s=i.tokens,o=this.consumeArgs(i.numArgs,i.delimiters);if(i.numArgs)for(var a=(s=s.slice()).length-1;a>=0;--a){var c=s[a];if("#"===c.text){if(0===a)throw new n("Incomplete placeholder at end of macro body",c);if("#"===(c=s[--a]).text)s.splice(a+1,1);else{if(!/^[1-9]$/.test(c.text))throw new n("Not a valid argument number",c);var l;(l=s).splice.apply(l,[a,2].concat(o[+c.text-1]))}}}return this.pushTokens(s),s},t.expandAfterFuture=function(){return this.expandOnce(),this.future()},t.expandNextToken=function(){for(;;){var e=this.expandOnce();if(e instanceof Rn){if("\\relax"!==e.text&&!e.treatAsRelax)return this.stack.pop();this.stack.pop()}}throw new Error},t.expandMacro=function(e){return this.macros.has(e)?this.expandTokens([new Rn(e)]):void 0},t.expandTokens=function(e){var t=[],r=this.stack.length;for(this.pushTokens(e);this.stack.length>r;){var n=this.expandOnce(!0);n instanceof Rn&&(n.treatAsRelax&&(n.noexpand=!1,n.treatAsRelax=!1),t.push(this.stack.pop()))}return t},t.expandMacroAsText=function(e){var t=this.expandMacro(e);return t?t.map((function(e){return e.text})).join(""):t},t._getExpansion=function(e){var t=this.macros.get(e);if(null==t)return t;var r="function"==typeof t?t(this):t;if("string"==typeof r){var n=0;if(-1!==r.indexOf("#"))for(var i=r.replace(/##/g,"");-1!==i.indexOf("#"+(n+1));)++n;for(var s=new Dn(r,this.settings),o=[],a=s.lex();"EOF"!==a.text;)o.push(a),a=s.lex();return o.reverse(),{tokens:o,numArgs:n}}return r},t.isDefined=function(e){return this.macros.has(e)||Cn.hasOwnProperty(e)||J.math.hasOwnProperty(e)||J.text.hasOwnProperty(e)||zn.hasOwnProperty(e)},t.isExpandable=function(e){var t=this.macros.get(e);return null!=t?"string"==typeof t||"function"==typeof t||!t.unexpandable:Cn.hasOwnProperty(e)&&!Cn[e].primitive},e}(),Gn={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"}},Vn={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},Hn=function(){function e(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new $n(e,t,this.mode),this.settings=t,this.leftrightDepth=0}var t=e.prototype;return t.expect=function(e,t){if(void 0===t&&(t=!0),this.fetch().text!==e)throw new n("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()},t.consume=function(){this.nextToken=null},t.fetch=function(){return null==this.nextToken&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken},t.switchMode=function(e){this.mode=e,this.gullet.switchMode(e)},t.parse=function(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e},t.parseExpression=function(t,r){for(var n=[];;){"math"===this.mode&&this.consumeSpaces();var i=this.fetch();if(-1!==e.endOfExpression.indexOf(i.text))break;if(r&&i.text===r)break;if(t&&Cn[i.text]&&Cn[i.text].infix)break;var s=this.parseAtom(r);if(!s)break;"internal"!==s.type&&n.push(s)}return"text"===this.mode&&this.formLigatures(n),this.handleInfixNodes(n)},t.handleInfixNodes=function(e){for(var t,r=-1,i=0;i<e.length;i++)if("infix"===e[i].type){if(-1!==r)throw new n("only one infix operator per group",e[i].token);r=i,t=e[i].replaceWith}if(-1!==r&&t){var s,o,a=e.slice(0,r),c=e.slice(r+1);return s=1===a.length&&"ordgroup"===a[0].type?a[0]:{type:"ordgroup",mode:this.mode,body:a},o=1===c.length&&"ordgroup"===c[0].type?c[0]:{type:"ordgroup",mode:this.mode,body:c},["\\\\abovefrac"===t?this.callFunction(t,[s,e[r],o],[]):this.callFunction(t,[s,o],[])]}return e},t.handleSupSubscript=function(e){var t=this.fetch(),r=t.text;this.consume(),this.consumeSpaces();var i=this.parseGroup(e);if(!i)throw new n("Expected group after '"+r+"'",t);return i},t.formatUnsupportedCmd=function(e){for(var t=[],r=0;r<e.length;r++)t.push({type:"textord",mode:"text",text:e[r]});var n={type:"text",mode:this.mode,body:t};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[n]}},t.parseAtom=function(e){var t,r,i=this.parseGroup("atom",e);if("text"===this.mode)return i;for(;;){this.consumeSpaces();var s=this.fetch();if("\\limits"===s.text||"\\nolimits"===s.text){if(i&&"op"===i.type){var o="\\limits"===s.text;i.limits=o,i.alwaysHandleSupSub=!0}else{if(!i||"operatorname"!==i.type||!i.alwaysHandleSupSub)throw new n("Limit controls must follow a math operator",s);var a="\\limits"===s.text;i.limits=a}this.consume()}else if("^"===s.text){if(t)throw new n("Double superscript",s);t=this.handleSupSubscript("superscript")}else if("_"===s.text){if(r)throw new n("Double subscript",s);r=this.handleSupSubscript("subscript")}else{if("'"!==s.text)break;if(t)throw new n("Double superscript",s);var c={type:"textord",mode:this.mode,text:"\\prime"},l=[c];for(this.consume();"'"===this.fetch().text;)l.push(c),this.consume();"^"===this.fetch().text&&l.push(this.handleSupSubscript("superscript")),t={type:"ordgroup",mode:this.mode,body:l}}}return t||r?{type:"supsub",mode:this.mode,base:i,sup:t,sub:r}:i},t.parseFunction=function(e,t){var r=this.fetch(),i=r.text,s=Cn[i];if(!s)return null;if(this.consume(),t&&"atom"!==t&&!s.allowedInArgument)throw new n("Got function '"+i+"' with no arguments"+(t?" as "+t:""),r);if("text"===this.mode&&!s.allowedInText)throw new n("Can't use function '"+i+"' in text mode",r);if("math"===this.mode&&!1===s.allowedInMath)throw new n("Can't use function '"+i+"' in math mode",r);var o=this.parseArguments(i,s),a=o.args,c=o.optArgs;return this.callFunction(i,a,c,r,e)},t.callFunction=function(e,t,r,i,s){var o={funcName:e,parser:this,token:i,breakOnTokenText:s},a=Cn[e];if(a&&a.handler)return a.handler(o,t,r);throw new n("No function handler for "+e)},t.parseArguments=function(e,t){var r=t.numArgs+t.numOptionalArgs;if(0===r)return{args:[],optArgs:[]};for(var i=[],s=[],o=0;o<r;o++){var a=t.argTypes&&t.argTypes[o],c=o<t.numOptionalArgs;(t.primitive&&null==a||"sqrt"===t.type&&1===o&&null==s[0])&&(a="primitive");var l=this.parseGroupOfType("argument to '"+e+"'",a,c);if(c)s.push(l);else{if(null==l)throw new n("Null argument, please report this as a bug");i.push(l)}}return{args:i,optArgs:s}},t.parseGroupOfType=function(e,t,r){switch(t){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,t);case"hbox":var i=this.parseArgumentGroup(r,"text");return null!=i?{type:"styling",mode:i.mode,body:[i],style:"text"}:null;case"raw":var s=this.parseStringGroup("raw",r);return null!=s?{type:"raw",mode:"text",string:s.text}:null;case"primitive":if(r)throw new n("A primitive argument cannot be optional");var o=this.parseGroup(e);if(null==o)throw new n("Expected group as "+e,this.fetch());return o;case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new n("Unknown group type as "+e,this.fetch())}},t.consumeSpaces=function(){for(;" "===this.fetch().text;)this.consume()},t.parseStringGroup=function(e,t){var r=this.gullet.scanArgument(t);if(null==r)return null;for(var n,i="";"EOF"!==(n=this.fetch()).text;)i+=n.text,this.consume();return this.consume(),r.text=i,r},t.parseRegexGroup=function(e,t){for(var r,i=this.fetch(),s=i,o="";"EOF"!==(r=this.fetch()).text&&e.test(o+r.text);)o+=(s=r).text,this.consume();if(""===o)throw new n("Invalid "+t+": '"+i.text+"'",i);return i.range(s,o)},t.parseColorGroup=function(e){var t=this.parseStringGroup("color",e);if(null==t)return null;var r=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!r)throw new n("Invalid color: '"+t.text+"'",t);var i=r[0];return/^[0-9a-f]{6}$/i.test(i)&&(i="#"+i),{type:"color-token",mode:this.mode,color:i}},t.parseSizeGroup=function(e){var t,r=!1;if(this.gullet.consumeSpaces(),!(t=e||"{"===this.gullet.future().text?this.parseStringGroup("size",e):this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size")))return null;e||0!==t.text.length||(t.text="0pt",r=!0);var i=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!i)throw new n("Invalid size: '"+t.text+"'",t);var s={number:+(i[1]+i[2]),unit:i[3]};if(!je(s))throw new n("Invalid unit: '"+s.unit+"'",t);return{type:"size",mode:this.mode,value:s,isBlank:r}},t.parseUrlGroup=function(e){this.gullet.lexer.setCatcode("%",13);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),null==t)return null;var r=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}},t.parseArgumentGroup=function(e,t){var r=this.gullet.scanArgument(e);if(null==r)return null;var n=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var i=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var s={type:"ordgroup",mode:this.mode,loc:r.loc,body:i};return t&&this.switchMode(n),s},t.parseGroup=function(e,t){var r,i=this.fetch(),s=i.text;if("{"===s||"\\begingroup"===s){this.consume();var o="{"===s?"}":"\\endgroup";this.gullet.beginGroup();var a=this.parseExpression(!1,o),c=this.fetch();this.expect(o),this.gullet.endGroup(),r={type:"ordgroup",mode:this.mode,loc:In.range(i,c),body:a,semisimple:"\\begingroup"===s||void 0}}else if(null==(r=this.parseFunction(t,e)||this.parseSymbol())&&"\\"===s[0]&&!zn.hasOwnProperty(s)){if(this.settings.throwOnError)throw new n("Undefined control sequence: "+s,i);r=this.formatUnsupportedCmd(s),this.consume()}return r},t.formLigatures=function(e){for(var t=e.length-1,r=0;r<t;++r){var n=e[r],i=n.text;"-"===i&&"-"===e[r+1].text&&(r+1<t&&"-"===e[r+2].text?(e.splice(r,3,{type:"textord",mode:"text",loc:In.range(n,e[r+2]),text:"---"}),t-=2):(e.splice(r,2,{type:"textord",mode:"text",loc:In.range(n,e[r+1]),text:"--"}),t-=1)),"'"!==i&&"`"!==i||e[r+1].text!==i||(e.splice(r,2,{type:"textord",mode:"text",loc:In.range(n,e[r+1]),text:i+i}),t-=1)}},t.parseSymbol=function(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var r=t.slice(5),i="*"===r.charAt(0);if(i&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new n("\\verb assertion failed --\n                    please report what input caused this bug");return{type:"verb",mode:"text",body:r=r.slice(1,-1),star:i}}Vn.hasOwnProperty(t[0])&&!J[this.mode][t[0]]&&(this.settings.strict&&"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=Vn[t[0]]+t.substr(1));var s,o=Pn.exec(t);if(o&&("i"===(t=t.substring(0,o.index))?t="":"j"===t&&(t="")),J[this.mode][t]){this.settings.strict&&"math"===this.mode&&Ie.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var a,c=J[this.mode][t].group,l=In.range(e);if(W.hasOwnProperty(c)){var u=c;a={type:"atom",mode:this.mode,family:u,loc:l,text:t}}else a={type:c,mode:this.mode,loc:l,text:t};s=a}else{if(!(t.charCodeAt(0)>=128))return null;this.settings.strict&&(T(t.charCodeAt(0))?"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'" ('+t.charCodeAt(0)+")",e)),s={type:"textord",mode:"text",loc:In.range(e),text:t}}if(this.consume(),o)for(var h=0;h<o[0].length;h++){var d=o[0][h];if(!Gn[d])throw new n("Unknown accent ' "+d+"'",e);var p=Gn[d][this.mode];if(!p)throw new n("Accent "+d+" unsupported in "+this.mode+" mode",e);s={type:"accent",mode:this.mode,loc:In.range(e),label:p,isStretchy:!1,isShifty:!0,base:s}}return s},e}();Hn.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var Wn=function(e,t){if(!("string"==typeof e||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new Hn(e,t);delete r.gullet.macros.current["\\df@tag"];var i=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new n("\\tag works only in display equations");r.gullet.feed("\\df@tag"),i=[{type:"tag",mode:"text",body:i,tag:r.parse()}]}return i},Yn=function(e,t,r){t.textContent="";var n=Jn(e,r).toNode();t.appendChild(n)};"undefined"!=typeof document&&"CSS1Compat"!==document.compatMode&&("undefined"!=typeof console&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),Yn=function(){throw new n("KaTeX doesn't work in quirks mode.")});var Xn=function(e,t,r){if(r.throwOnError||!(e instanceof n))throw e;var i=Ze.makeSpan(["katex-error"],[new B(t)]);return i.setAttribute("title",e.toString()),i.setAttribute("style","color:"+r.errorColor),i},Jn=function(e,t){var r=new g(t);try{return function(e,t,r){var n,i=Ft(r);if("mathml"===r.output)return Nt(e,t,i,r.displayMode,!0);if("html"===r.output){var s=xt(e,i);n=Ze.makeSpan(["katex"],[s])}else{var o=Nt(e,t,i,r.displayMode,!1),a=xt(e,i);n=Ze.makeSpan(["katex"],[o,a])}return Bt(n,r)}(Wn(e,r),e,r)}catch(t){return Xn(t,e,r)}},Qn={version:"0.13.2",render:Yn,renderToString:function(e,t){return Jn(e,t).toMarkup()},ParseError:n,__parse:function(e,t){var r=new g(t);return Wn(e,r)},__renderToDomTree:Jn,__renderToHTMLTree:function(e,t){var r=new g(t);try{return function(e,t,r){var n=xt(e,Ft(r)),i=Ze.makeSpan(["katex"],[n]);return Bt(i,r)}(Wn(e,r),0,r)}catch(t){return Xn(t,e,r)}},__setFontMetrics:function(e,t){z[e]=t},__defineSymbol:Q,__defineMacro:Fn,__domTree:{Span:M,Anchor:L,SymbolNode:B,SvgNode:U,PathNode:q,LineNode:j}};return t.default}()},e.exports=t()},3059:(e,t)=>{t.klona=function e(t){if("object"!=typeof t)return t;var r,n,i=Object.prototype.toString.call(t);if("[object Object]"===i){if(t.constructor!==Object&&"function"==typeof t.constructor)for(r in n=new t.constructor,t)n.hasOwnProperty(r)&&n[r]!==t[r]&&(n[r]=e(t[r]));else for(r in n={},t)"__proto__"===r?Object.defineProperty(n,r,{value:e(t[r]),configurable:!0,enumerable:!0,writable:!0}):n[r]=e(t[r]);return n}if("[object Array]"===i){for(r=t.length,n=Array(r);r--;)n[r]=e(t[r]);return n}return"[object Set]"===i?(n=new Set,t.forEach((function(t){n.add(e(t))})),n):"[object Map]"===i?(n=new Map,t.forEach((function(t,r){n.set(e(r),e(t))})),n):"[object Date]"===i?new Date(+t):"[object RegExp]"===i?((n=new RegExp(t.source,t.flags)).lastIndex=t.lastIndex,n):"[object DataView]"===i?new t.constructor(e(t.buffer)):"[object ArrayBuffer]"===i?t.slice(0):"Array]"===i.slice(-6)?new t.constructor(t):t}},2043:function(e,t,r){var n,i;!function(s,o){"use strict";void 0===(i="function"==typeof(n=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function i(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&r?s:void 0!==console[n]?i(console,n):void 0!==console.log?i(console,"log"):e)}function a(t,r){for(var i=0;i<n.length;i++){var s=n[i];this[s]=i<t?e:this.methodFactory(s,t,r)}this.log=this.debug}function c(e,r,n){return function(){typeof console!==t&&(a.call(this,r,n),this[e].apply(this,arguments))}}function l(e,t,r){return o(e)||c.apply(this,arguments)}function u(e,r,i){var s,o=this,c="loglevel";function u(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(c)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||l,o.getLevel=function(){return s},o.setLevel=function(r,i){if("string"==typeof r&&void 0!==o.levels[r.toUpperCase()]&&(r=o.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==i&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+r+";"}catch(e){}}}(r),a.call(o,r,e),typeof console===t&&r<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){u()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var h=u();null==h&&(h=null==r?"WARN":r),o.setLevel(h,!1)}var h=new u,d={};h.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new u(e,h.getLevel(),h.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return h.noConflict=function(){return typeof window!==t&&window.log===h&&(window.log=p),h},h.getLoggers=function(){return d},h.default=h,h})?n.call(t,r,t,e):n)||(e.exports=i)}()},2481:(e,t)=>{"use strict";let r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.RoomType=t.RoomCreateTypeField=t.MsgType=t.EventType=void 0,t.EventType=r,function(e){e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomAliases="m.room.aliases",e.SpaceChild="org.matrix.msc1772.space.child",e.SpaceParent="org.matrix.msc1772.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallReplaces="m.call.replaces",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.RoomMessageFeedback="m.room.message.feedback",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy"}(r||(t.EventType=r={})),t.MsgType=n,function(e){e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video"}(n||(t.MsgType=n={})),t.RoomCreateTypeField="org.matrix.msc1772.type",t.RoomType=i,function(e){e.Space="org.matrix.msc1772.space"}(i||(t.RoomType=i={}))},771:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReEmitter=void 0;var i=n(r(9713));t.ReEmitter=class{constructor(e){(0,i.default)(this,"target",void 0),this.target=e}reEmit(e,t){for(const r of t){const t=(...t)=>{"error"===r&&0===this.target.listenerCount("error")||this.target.emit(r,...t,e)};e.on(r,t)}}}},9118:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDiscovery=void 0;var n=r(7434),i=r(8575);class s{static get ERROR_INVALID(){return"Invalid homeserver discovery response"}static get ERROR_GENERIC_FAILURE(){return"Failed to get autodiscovery configuration from server"}static get ERROR_INVALID_HS_BASE_URL(){return"Invalid base_url for m.homeserver"}static get ERROR_INVALID_HOMESERVER(){return"Homeserver URL does not appear to be a valid Matrix homeserver"}static get ERROR_INVALID_IS_BASE_URL(){return"Invalid base_url for m.identity_server"}static get ERROR_INVALID_IDENTITY_SERVER(){return"Identity server URL does not appear to be a valid identity server"}static get ERROR_INVALID_IS(){return"Invalid identity server discovery response"}static get ERROR_MISSING_WELLKNOWN(){return"No .well-known JSON file found"}static get ERROR_INVALID_JSON(){return"Invalid JSON"}static get ALL_ERRORS(){return[s.ERROR_INVALID,s.ERROR_GENERIC_FAILURE,s.ERROR_INVALID_HS_BASE_URL,s.ERROR_INVALID_HOMESERVER,s.ERROR_INVALID_IS_BASE_URL,s.ERROR_INVALID_IDENTITY_SERVER,s.ERROR_INVALID_IS,s.ERROR_MISSING_WELLKNOWN,s.ERROR_INVALID_JSON]}static get FAIL_ERROR(){return"FAIL_ERROR"}static get FAIL_PROMPT(){return"FAIL_PROMPT"}static get PROMPT(){return"PROMPT"}static get SUCCESS(){return"SUCCESS"}static async fromDiscoveryConfig(e){const t={"m.homeserver":{state:s.FAIL_ERROR,error:s.ERROR_INVALID,base_url:null},"m.identity_server":{state:s.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return n.logger.error("No m.homeserver key in config"),t["m.homeserver"].state=s.FAIL_PROMPT,t["m.homeserver"].error=s.ERROR_INVALID,Promise.resolve(t);if(!e["m.homeserver"].base_url)return n.logger.error("No m.homeserver base_url in config"),t["m.homeserver"].state=s.FAIL_PROMPT,t["m.homeserver"].error=s.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const r=this._sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!r)return n.logger.error("Invalid base_url for m.homeserver"),t["m.homeserver"].error=s.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const i=await this._fetchWellKnownObject(`${r}/_matrix/client/versions`);if(!i||!i.raw.versions)return n.logger.error("Invalid /versions response"),t["m.homeserver"].error=s.ERROR_INVALID_HOMESERVER,t["m.homeserver"].base_url=r,Promise.resolve(t);t["m.homeserver"]={state:s.SUCCESS,error:null,base_url:r};let o="";if(e["m.identity_server"]){const r={"m.homeserver":t["m.homeserver"],"m.identity_server":{state:s.FAIL_PROMPT,error:s.ERROR_INVALID_IS,base_url:null}};if(o=this._sanitizeWellKnownUrl(e["m.identity_server"].base_url),!o)return n.logger.error("Invalid base_url for m.identity_server"),r["m.identity_server"].error=s.ERROR_INVALID_IS_BASE_URL,Promise.resolve(r);const i=await this._fetchWellKnownObject(`${o}/_matrix/identity/api/v1`);if(!i||!i.raw||"SUCCESS"!==i.action)return n.logger.error("Invalid /api/v1 response"),r["m.identity_server"].error=s.ERROR_INVALID_IDENTITY_SERVER,r["m.identity_server"].base_url=o,Promise.resolve(r)}return o&&o.length>0&&(t["m.identity_server"]={state:s.SUCCESS,error:null,base_url:o}),Object.keys(e).map((r=>{if("m.homeserver"===r||"m.identity_server"===r){const n=["error","state","base_url"];for(const i of Object.keys(e[r]))n.includes(i)||(t[r][i]=e[r][i])}else t[r]=e[r]})),Promise.resolve(t)}static async findClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:s.FAIL_ERROR,error:s.ERROR_INVALID,base_url:null},"m.identity_server":{state:s.PROMPT,error:null,base_url:null}},r=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return r&&"SUCCESS"===r.action?s.fromDiscoveryConfig(r.raw):(n.logger.error("No response or error when parsing .well-known"),r.reason&&n.logger.error(r.reason),"IGNORE"===r.action?t["m.homeserver"]={state:s.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=s.FAIL_PROMPT,t["m.homeserver"].error=s.ERROR_INVALID),Promise.resolve(t))}static async getRawClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t&&t.raw||{}}static _sanitizeWellKnownUrl(e){if(!e)return!1;try{let t=null;try{t=i.URL?new i.URL(e):new URL(e)}catch(r){t=new URL(e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;const r=t.port?`:${t.port}`:"",n=t.pathname?t.pathname:"";let s=`${t.protocol}//${t.hostname}${r}${n}`;return s.endsWith("/")&&(s=s.substring(0,s.length-1)),s}catch(e){return n.logger.error(e),!1}}static async _fetchWellKnownObject(e){return new Promise((function(t,n){const i=r(8070).getRequest();if(!i)throw new Error("No request library available");i({method:"GET",uri:e,timeout:5e3},((e,r,n)=>{if(e||r&&(r.statusCode<200||r.statusCode>=300)){let n="FAIL_PROMPT",i=(e?e.message:null)||"General failure";return r&&404===r.statusCode&&(n="IGNORE",i=s.ERROR_MISSING_WELLKNOWN),void t({raw:{},action:n,reason:i,error:e})}try{t({raw:JSON.parse(n),action:"SUCCESS"})}catch(e){let r=s.ERROR_INVALID;"SyntaxError"===e.name&&(r=s.ERROR_INVALID_JSON),t({raw:{},action:"FAIL_PROMPT",reason:r,error:e})}}))}))}}t.AutoDiscovery=s},2246:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixBaseApis=u;var i=r(1415),s=r(7434),o=r(1707),a=n(r(3102)),c=r(7715);function l(e,t){switch(e){case i.SERVICE_TYPES.IS:return t+c.PREFIX_IDENTITY_V2+"/terms";case i.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}function u(e){a.checkObjectHasKeys(e,["baseUrl","request"]),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer;const t={baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:c.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader};this._http=new c.MatrixHttpApi(this,t),this._txnCtr=0}u.prototype.getHomeserverUrl=function(){return this.baseUrl},u.prototype.getIdentityServerUrl=function(e=!1){return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl},u.prototype.setIdentityServerUrl=function(e){this.idBaseUrl=a.ensureNoTrailingSlash(e),this._http.setIdBaseUrl(this.idBaseUrl)},u.prototype.getAccessToken=function(){return this._http.opts.accessToken||null},u.prototype.isLoggedIn=function(){return void 0!==this._http.opts.accessToken},u.prototype.makeTxnId=function(){return"m"+(new Date).getTime()+"."+this._txnCtr++},u.prototype.isUsernameAvailable=function(e){return this._http.authedRequest(void 0,"GET","/register/available",{username:e}).then((e=>e.available))},u.prototype.register=function(e,t,r,n,i,s,o,a){!0===i?i={email:!0}:null==i&&(i={}),"function"==typeof o&&(a=o,o=void 0),r&&(n.session=r);const c={auth:n};return null!=e&&(c.username=e),null!=t&&(c.password=t),i.email&&(c.bind_email=!0),i.msisdn&&(c.bind_msisdn=!0),null!=s&&(c.guest_access_token=s),null!=o&&(c.inhibit_login=o),null!=t&&(c.x_show_msisdn=!0),this.registerRequest(c,void 0,a)},u.prototype.registerGuest=function(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)},u.prototype.registerRequest=function(e,t,r){const n={};return t&&(n.kind=t),this._http.request(r,"POST","/register",n,e)},u.prototype.loginFlows=function(e){return this._http.request(e,"GET","/login")},u.prototype.login=function(e,t,r){const n={type:e};return a.extend(n,t),this._http.authedRequest(((e,t)=>{t&&t.access_token&&t.user_id&&(this._http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),r&&r(e,t)}),"POST","/login",void 0,n)},u.prototype.loginWithPassword=function(e,t,r){return this.login("m.login.password",{user:e,password:t},r)},u.prototype.loginWithSAML2=function(e,t){return this.login("m.login.saml2",{relay_state:e},t)},u.prototype.getCasLoginUrl=function(e){return this.getSsoLoginUrl(e,"cas")},u.prototype.getSsoLoginUrl=function(e,t,r){void 0===t&&(t="sso");let n=c.PREFIX_R0,i="/login/"+t+"/redirect";return r&&(i+="/"+r,n="/_matrix/client/unstable/org.matrix.msc2858"),this._http.getUrl(i,{redirectUrl:e},n)},u.prototype.loginWithToken=function(e,t){return this.login("m.login.token",{token:e},t)},u.prototype.logout=function(e){return this._http.authedRequest(e,"POST","/logout")},u.prototype.deactivateAccount=function(e,t){if("function"==typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");const r={};return e&&(r.auth=e),void 0!==t&&(r.erase=t),this._http.authedRequest(void 0,"POST","/account/deactivate",void 0,r)},u.prototype.getFallbackAuthUrl=function(e,t){const r=a.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this._http.getUrl(r,{session:t},c.PREFIX_R0)},u.prototype.createRoom=async function(e,t){const r=(e.invite_3pid||[]).filter((e=>!e.id_access_token));if(r.length>0&&this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();if(e)for(const t of r)t.id_access_token=e}return this._http.authedRequest(t,"POST","/createRoom",void 0,e)},u.prototype.fetchRelations=async function(e,t,r,n,i){const s={};i.from&&(s.from=i.from);const o=a.encodeParams(s),l=a.encodeUri("/rooms/$roomId/relations/$eventId/$relationType/$eventType?"+o,{$roomId:e,$eventId:t,$relationType:r,$eventType:n});return await this._http.authedRequest(void 0,"GET",l,null,null,{prefix:c.PREFIX_UNSTABLE})},u.prototype.roomState=function(e,t){const r=a.encodeUri("/rooms/$roomId/state",{$roomId:e});return this._http.authedRequest(t,"GET",r)},u.prototype.fetchRoomEvent=function(e,t,r){const n=a.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(r,"GET",n)},u.prototype.members=function(e,t,r,n,i){const s={};t&&(s.membership=t),r&&(s.not_membership=r),n&&(s.at=n);const o=a.encodeParams(s),c=a.encodeUri("/rooms/$roomId/members?"+o,{$roomId:e});return this._http.authedRequest(i,"GET",c)},u.prototype.upgradeRoom=function(e,t){const r=a.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this._http.authedRequest(void 0,"POST",r,void 0,{new_version:t})},u.prototype.getGroupSummary=function(e){const t=a.encodeUri("/groups/$groupId/summary",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},u.prototype.getGroupProfile=function(e){const t=a.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},u.prototype.setGroupProfile=function(e,t){const r=a.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"POST",r,void 0,t)},u.prototype.setGroupJoinPolicy=function(e,t){const r=a.encodeUri("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this._http.authedRequest(void 0,"PUT",r,void 0,{"m.join_policy":t})},u.prototype.getGroupUsers=function(e){const t=a.encodeUri("/groups/$groupId/users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},u.prototype.getGroupInvitedUsers=function(e){const t=a.encodeUri("/groups/$groupId/invited_users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},u.prototype.getGroupRooms=function(e){const t=a.encodeUri("/groups/$groupId/rooms",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},u.prototype.inviteUserToGroup=function(e,t){const r=a.encodeUri("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{})},u.prototype.removeUserFromGroup=function(e,t){const r=a.encodeUri("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",r,void 0,{})},u.prototype.addUserToGroupSummary=function(e,t,r){const n=a.encodeUri(r?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:r,$userId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},u.prototype.removeUserFromGroupSummary=function(e,t){const r=a.encodeUri("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"DELETE",r,void 0,{})},u.prototype.addRoomToGroupSummary=function(e,t,r){const n=a.encodeUri(r?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:r,$roomId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},u.prototype.removeRoomFromGroupSummary=function(e,t){const r=a.encodeUri("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",r,void 0,{})},u.prototype.addRoomToGroup=function(e,t,r){void 0===r&&(r=!0);const n=a.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{"m.visibility":{type:r?"public":"private"}})},u.prototype.updateGroupRoomVisibility=function(e,t,r){const n=a.encodeUri("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{type:r?"public":"private"})},u.prototype.removeRoomFromGroup=function(e,t){const r=a.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",r,void 0,{})},u.prototype.acceptGroupInvite=function(e,t=null){const r=a.encodeUri("/groups/$groupId/self/accept_invite",{$groupId:e});return this._http.authedRequest(void 0,"PUT",r,void 0,t||{})},u.prototype.joinGroup=function(e){const t=a.encodeUri("/groups/$groupId/self/join",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},u.prototype.leaveGroup=function(e){const t=a.encodeUri("/groups/$groupId/self/leave",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},u.prototype.getJoinedGroups=function(){const e=a.encodeUri("/joined_groups");return this._http.authedRequest(void 0,"GET",e)},u.prototype.createGroup=function(e){const t=a.encodeUri("/create_group");return this._http.authedRequest(void 0,"POST",t,void 0,e)},u.prototype.getPublicisedGroups=function(e){const t=a.encodeUri("/publicised_groups");return this._http.authedRequest(void 0,"POST",t,void 0,{user_ids:e})},u.prototype.setGroupPublicity=function(e,t){const r=a.encodeUri("/groups/$groupId/self/update_publicity",{$groupId:e});return this._http.authedRequest(void 0,"PUT",r,void 0,{publicise:t})},u.prototype.getStateEvent=function(e,t,r,n){const i={$roomId:e,$eventType:t,$stateKey:r};let s=a.encodeUri("/rooms/$roomId/state/$eventType",i);return void 0!==r&&(s=a.encodeUri(s+"/$stateKey",i)),this._http.authedRequest(n,"GET",s)},u.prototype.sendStateEvent=function(e,t,r,n,i){const s={$roomId:e,$eventType:t,$stateKey:n};let o=a.encodeUri("/rooms/$roomId/state/$eventType",s);return void 0!==n&&(o=a.encodeUri(o+"/$stateKey",s)),this._http.authedRequest(i,"PUT",o,void 0,r)},u.prototype.roomInitialSync=function(e,t,r){a.isFunction(t)&&(r=t,t=void 0);const n=a.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return t||(t=30),this._http.authedRequest(r,"GET",n,{limit:t})},u.prototype.setRoomReadMarkersHttpRequest=function(e,t,r,n){const i=a.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),s={"m.fully_read":t,"m.read":r,"m.hidden":Boolean(!!n&&n.hidden)};return this._http.authedRequest(void 0,"POST",i,void 0,s)},u.prototype.getJoinedRooms=function(){const e=a.encodeUri("/joined_rooms");return this._http.authedRequest(void 0,"GET",e)},u.prototype.getJoinedRoomMembers=function(e){const t=a.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this._http.authedRequest(void 0,"GET",t)},u.prototype.publicRooms=function(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});const r={};return e.server&&(r.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(r).length?this._http.authedRequest(t,"GET","/publicRooms"):this._http.authedRequest(t,"POST","/publicRooms",r,e)},u.prototype.createAlias=function(e,t,r){const n=a.encodeUri("/directory/room/$alias",{$alias:e}),i={room_id:t};return this._http.authedRequest(r,"PUT",n,void 0,i)},u.prototype.deleteAlias=function(e,t){const r=a.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"DELETE",r,void 0,void 0)},u.prototype.unstableGetLocalAliases=function(e,t){const r=a.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),n=c.PREFIX_UNSTABLE+"/org.matrix.msc2432";return this._http.authedRequest(t,"GET",r,null,null,{prefix:n})},u.prototype.getRoomIdForAlias=function(e,t){const r=a.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"GET",r)},u.prototype.resolveRoomAlias=function(e,t){const r=a.encodeUri("/directory/room/$alias",{$alias:e});return this._http.request(t,"GET",r)},u.prototype.getRoomDirectoryVisibility=function(e,t){const r=a.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(t,"GET",r)},u.prototype.setRoomDirectoryVisibility=function(e,t,r){const n=a.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(r,"PUT",n,void 0,{visibility:t})},u.prototype.setRoomDirectoryVisibilityAppService=function(e,t,r,n){const i=a.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this._http.authedRequest(n,"PUT",i,void 0,{visibility:r})},u.prototype.searchUserDirectory=function(e){const t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this._http.authedRequest(void 0,"POST","/user_directory/search",void 0,t)},u.prototype.uploadContent=function(e,t){return this._http.uploadContent(e,t)},u.prototype.cancelUpload=function(e){return this._http.cancelUpload(e)},u.prototype.getCurrentUploads=function(){return this._http.getCurrentUploads()},u.prototype.getProfileInfo=function(e,t,r){a.isFunction(t)&&(r=t,t=void 0);const n=t?a.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):a.encodeUri("/profile/$userId",{$userId:e});return this._http.authedRequest(r,"GET",n)},u.prototype.getThreePids=function(e){return this._http.authedRequest(e,"GET","/account/3pid",void 0,void 0)},u.prototype.addThreePid=function(e,t,r){const n={threePidCreds:e,bind:t};return this._http.authedRequest(r,"POST","/account/3pid",null,n)},u.prototype.addThreePidOnly=async function(e){const t=await this.isVersionSupported("r0.6.0")?c.PREFIX_R0:c.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST","/account/3pid/add",null,e,{prefix:t})},u.prototype.bindThreePid=async function(e){const t=await this.isVersionSupported("r0.6.0")?c.PREFIX_R0:c.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST","/account/3pid/bind",null,e,{prefix:t})},u.prototype.unbindThreePid=async function(e,t){const r={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},n=await this.isVersionSupported("r0.6.0")?c.PREFIX_R0:c.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST","/account/3pid/unbind",null,r,{prefix:n})},u.prototype.deleteThreePid=function(e,t){const r={medium:e,address:t};return this._http.authedRequest(void 0,"POST","/account/3pid/delete",null,r)},u.prototype.setPassword=function(e,t,r){const n={auth:e,new_password:t};return this._http.authedRequest(r,"POST","/account/password",null,n)},u.prototype.getDevices=function(){return this._http.authedRequest(void 0,"GET","/devices",void 0,void 0)},u.prototype.setDeviceDetails=function(e,t){const r=a.encodeUri("/devices/$device_id",{$device_id:e});return this._http.authedRequest(void 0,"PUT",r,void 0,t)},u.prototype.deleteDevice=function(e,t){const r=a.encodeUri("/devices/$device_id",{$device_id:e}),n={};return t&&(n.auth=t),this._http.authedRequest(void 0,"DELETE",r,void 0,n)},u.prototype.deleteMultipleDevices=function(e,t){const r={devices:e};return t&&(r.auth=t),this._http.authedRequest(void 0,"POST","/delete_devices",void 0,r)},u.prototype.getPushers=function(e){return this._http.authedRequest(e,"GET","/pushers",void 0,void 0)},u.prototype.setPusher=function(e,t){return this._http.authedRequest(t,"POST","/pushers/set",null,e)},u.prototype.getPushRules=function(e){return this._http.authedRequest(e,"GET","/pushrules/").then((e=>o.PushProcessor.rewriteDefaultRules(e)))},u.prototype.addPushRule=function(e,t,r,n,i){const s=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this._http.authedRequest(i,"PUT",s,void 0,n)},u.prototype.deletePushRule=function(e,t,r,n){const i=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this._http.authedRequest(n,"DELETE",i)},u.prototype.setPushRuleEnabled=function(e,t,r,n,i){const s=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:r});return this._http.authedRequest(i,"PUT",s,void 0,{enabled:n})},u.prototype.setPushRuleActions=function(e,t,r,n,i){const s=a.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:r});return this._http.authedRequest(i,"PUT",s,void 0,{actions:n})},u.prototype.search=function(e,t){const r={};return e.next_batch&&(r.next_batch=e.next_batch),this._http.authedRequest(t,"POST","/search",r,e.body)},u.prototype.uploadKeysRequest=function(e,t,r){return this._http.authedRequest(r,"POST","/keys/upload",void 0,e)},u.prototype.uploadKeySignatures=function(e){return this._http.authedRequest(void 0,"POST","/keys/signatures/upload",void 0,e,{prefix:c.PREFIX_UNSTABLE})},u.prototype.downloadKeysForUsers=function(e,t){if(a.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");const r={device_keys:{}};return"token"in(t=t||{})&&(r.token=t.token),e.forEach((e=>{r.device_keys[e]=[]})),this._http.authedRequest(void 0,"POST","/keys/query",void 0,r)},u.prototype.claimOneTimeKeys=function(e,t,r){const n={};void 0===t&&(t="signed_curve25519");for(let r=0;r<e.length;++r){const i=e[r][0],s=e[r][1],o=n[i]||{};n[i]=o,o[s]=t}const i={one_time_keys:n};return r&&(i.timeout=r),this._http.authedRequest(void 0,"POST","/keys/claim",void 0,i)},u.prototype.getKeyChanges=function(e,t){const r={from:e,to:t};return this._http.authedRequest(void 0,"GET","/keys/changes",r,void 0)},u.prototype.uploadDeviceSigningKeys=function(e,t){const r=Object.assign({},t);return e&&Object.assign(r,{auth:e}),this._http.authedRequest(void 0,"POST","/keys/device_signing/upload",void 0,r,{prefix:c.PREFIX_UNSTABLE})},u.prototype.registerWithIdentityServer=function(e){if(!this.idBaseUrl)throw new Error("No Identity Server base URL set");const t=this.idBaseUrl+c.PREFIX_IDENTITY_V2+"/account/register";return this._http.requestOtherUrl(void 0,"POST",t,null,e)},u.prototype.requestEmailToken=async function(e,t,r,n,i,s){const o={client_secret:t,email:e,send_attempt:r,next_link:n};return await this._http.idServerRequest(i,"POST","/validate/email/requestToken",o,c.PREFIX_IDENTITY_V2,s)},u.prototype.requestMsisdnToken=async function(e,t,r,n,i,s,o){const a={client_secret:r,country:e,phone_number:t,send_attempt:n,next_link:i};return await this._http.idServerRequest(s,"POST","/validate/msisdn/requestToken",a,c.PREFIX_IDENTITY_V2,o)},u.prototype.submitMsisdnToken=async function(e,t,r,n){const i={sid:e,client_secret:t,token:r};return await this._http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",i,c.PREFIX_IDENTITY_V2,n)},u.prototype.submitMsisdnTokenOtherUrl=function(e,t,r,n){const i={sid:t,client_secret:r,token:n};return this._http.requestOtherUrl(void 0,"POST",e,void 0,i)},u.prototype.getIdentityHashDetails=function(e){return this._http.idServerRequest(void 0,"GET","/hash_details",null,c.PREFIX_IDENTITY_V2,e)},u.prototype.identityHashedLookup=async function(e,t){const n={},i=await this.getIdentityHashDetails(t);if(!i||!i.lookup_pepper||!i.algorithms)throw new Error("Unsupported identity server: bad response");n.pepper=i.lookup_pepper;const s={};if(i.algorithms.includes("sha256")){const t=new r.g.Olm.Utility;n.addresses=e.map((e=>{const r=e[0].toLowerCase(),i=e[1].toLowerCase(),o=t.sha256(`${r} ${i} ${n.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return s[o]=e[0],o})),n.algorithm="sha256"}else{if(!i.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");n.addresses=e.map((e=>{const t=`${e[0].toLowerCase()} ${e[1].toLowerCase()}`;return s[t]=e[0],t})),n.algorithm="none"}const o=await this._http.idServerRequest(void 0,"POST","/lookup",n,c.PREFIX_IDENTITY_V2,t);if(!o||!o.mappings)return[];const a=[];for(const e of Object.keys(o.mappings)){const t=o.mappings[e],r=s[e];if(!r)throw new Error("Identity server returned more results than expected");a.push({address:r,mxid:t})}return a},u.prototype.lookupThreePid=async function(e,t,r,n){const i=(await this.identityHashedLookup([[t,e]],n)).find((e=>e.address===t));if(!i)return r&&r(null,{}),{};const s={address:t,medium:e,mxid:i.mxid};return r&&r(null,s),s},u.prototype.bulkLookupThreePids=async function(e,t){const r=await this.identityHashedLookup(e.map((e=>[e[1],e[0]])),t),n=[];for(const t of r){const r=e.find((e=>e[1]===t.address));if(!r)throw new Error("Identity sever returned unexpected results");n.push([r[0],t.address,t.mxid])}return{threepids:n}},u.prototype.getIdentityAccount=function(e){return this._http.idServerRequest(void 0,"GET","/account",void 0,c.PREFIX_IDENTITY_V2,e)},u.prototype.sendToDevice=function(e,t,r){const n=a.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),i={messages:t},o=Object.keys(t).reduce(((e,r)=>(e[r]=Object.keys(t[r]),e)),{});return s.logger.log(`PUT ${n}`,o),this._http.authedRequest(void 0,"PUT",n,void 0,i)},u.prototype.getThirdpartyProtocols=function(){return this._http.authedRequest(void 0,"GET","/thirdparty/protocols",void 0,void 0).then((e=>{if(!e||"object"!=typeof e)throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e}))},u.prototype.getThirdpartyLocation=function(e,t){const r=a.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",r,t,void 0)},u.prototype.getThirdpartyUser=function(e,t){const r=a.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",r,t,void 0)},u.prototype.getTerms=function(e,t){const r=l(e,t);return this._http.requestOtherUrl(void 0,"GET",r)},u.prototype.agreeToTerms=function(e,t,r,n){const i=l(e,t),s={Authorization:"Bearer "+r};return this._http.requestOtherUrl(void 0,"POST",i,null,{user_accepts:n},{headers:s})},u.prototype.reportEvent=function(e,t,r,n){const i=a.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(void 0,"POST",i,null,{score:r,reason:n})},u.prototype.getSpaceSummary=function(e,t,r,n,i,s){const o=a.encodeUri("/rooms/$roomId/spaces",{$roomId:e});return this._http.authedRequest(void 0,"POST",o,null,{max_rooms_per_space:t,suggested_only:r,auto_join_only:n,limit:i,batch:s},{prefix:"/_matrix/client/unstable/org.matrix.msc2946"})}},8743:(e,t,r)=>{"use strict";var n=r(5318),i=r(862);Object.defineProperty(t,"__esModule",{value:!0});var s={};t.default=void 0;var o=i(r(8070));Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(s,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(r(4770)),c=n(r(129));let l;o.request((function(e,t){return e.qs=c.default.stringify(e.qs||{},e.qsStringifyOptions),(0,a.default)(e,t)}));try{l=r.g.indexedDB}catch(e){}l&&o.setCryptoStoreFactory((function(){return new o.IndexedDBCryptoStore(l,"matrix-js-sdk:crypto")}));var u=o;t.default=u,r.g.matrixcs=o},2168:(e,t,r)=>{"use strict";var n=r(862),i=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixClient=N,t.CRYPTO_ENABLED=void 0;var s=i(r(8575)),o=r(7187),a=r(2246),c=r(7906),l=r(4551),u=r(4369),h=r(8910),d=r(1398),p=r(5641),f=r(9679),g=r(2931),m=n(r(3102)),y=r(7715),v=r(3667),_=n(r(4656)),b=n(r(2772)),w=r(771),S=r(635),k=r(7434),E=r(2600),x=r(4077),A=r(1597),T=r(8401),C=r(1707),I=r(3998),R=r(9118),O=r(4830);const P=(0,E.isCryptoAvailable)();t.CRYPTO_ENABLED=P;const D=6e5;function M(e,t,r){const n=[];for(const[i,s]of Object.entries(e))try{const e=L(s,t);e.session_id=i,e.room_id=r,n.push(e)}catch(e){k.logger.log("Failed to decrypt megolm session from backup",e)}return n}function L(e,t){return JSON.parse(t.decrypt(e.session_data.ephemeral,e.session_data.mac,e.session_data.ciphertext))}function N(e){e.baseUrl=m.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=m.ensureNoTrailingSlash(e.idBaseUrl),a.MatrixBaseApis.call(this,e),this.olmVersion=null,this.reEmitter=new w.ReEmitter(this),this.usingExternalCrypto=e.usingExternalCrypto,this.store=e.store||new p.StubStore,this.deviceId=e.deviceId||null;const t=e.userId||null;if(this.credentials={userId:t},e.deviceToImport?this.deviceId?k.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?k.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this._exportedOlmDeviceToImport=e.deviceToImport.olmDevice):k.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler){const e=this;this.scheduler.setProcessFunction((async function(t){const r=e.getRoom(t.getRoomId());t.status!==u.EventStatus.SENDING&&q(r,t,u.EventStatus.SENDING);const n=await j(e,t);return r&&r.updatePendingEvent(t,u.EventStatus.SENT,n.event_id),n}))}this.clientRunning=!1;const r=(0,f.createNewMatrixCall)(this);this._supportsVoip=!1,r?(this._callEventHandler=new g.CallEventHandler(this),this._supportsVoip=!0):this._callEventHandler=null,this._syncingRetry=null,this._syncApi=null,this._peekSync=null,this._isGuest=!1,this._ongoingScrollbacks={},this.timelineSupport=Boolean(e.timelineSupport),this.urlPreviewCache={},this._notifTimelineSet=null,this.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,this._crypto=null,this._cryptoStore=e.cryptoStore,this._sessionStore=e.sessionStore,this._verificationMethods=e.verificationMethods,this._cryptoCallbacks=e.cryptoCallbacks||{},this._forceTURN=e.forceTURN||!1,this._iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this._supportsCallTransfer=e.supportsCallTransfer||!1,this._fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this._roomList=new S.RoomList(this._cryptoStore),this._pushProcessor=new C.PushProcessor(this),this._serverVersionsPromise=null,this._cachedCapabilities=null,this._clientWellKnown=void 0,this._clientWellKnownPromise=void 0,this._turnServers=[],this._turnServersExpiry=0,this._checkTurnServersIntervalID=null,this.on("Event.decrypted",(e=>{const t=e.getPushActions(),r=this._pushProcessor.actionsForEvent(e);e.setPushActions(r);const n=this.getRoom(e.getRoomId());if(!n)return;const i=n.getUnreadNotificationCount("highlight"),s=!(!t||!t.tweaks||!t.tweaks.highlight),o=!(!r||!r.tweaks||!r.tweaks.highlight);if((s!==o||i>0)&&!n.hasUserReadEvent(this.getUserId(),e.getId())){let e=i;o&&!s&&e++,!o&&s&&e--,n.setUnreadNotificationCount("highlight",e),n.getUnreadNotificationCount("total")<e&&n.setUnreadNotificationCount("total",e)}})),this.on("Room.receipt",((e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const r=e.getContent();if(!(Object.keys(r).filter((e=>Object.keys(r[e]["m.read"]).includes(this.getUserId()))).length>0))return;const n=20,i=t.getLiveTimeline().getEvents();let s=0;for(let e=i.length-1;e>=0;e--){if(e===i.length-n)return;const r=i[e];if(t.hasUserReadEvent(this.getUserId(),r.getId()))break;const o=this.getPushActionsForEvent(r);s+=o.tweaks&&o.tweaks.highlight?1:0}t.setUnreadNotificationCount("highlight",s)}}))}async function F(e,t,r,n,i,s){if(!e._crypto)throw new Error("End-to-End encryption disabled");await e._crypto.setDeviceVerification(t,r,n,i,s)}function B(e,t){for(const r of t)e.prototype[r]=function(...e){if(!this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto[r](...e)}}function U(e,t,r,n){return Promise.resolve().then((function(){const n=function(e,t,r){if(t.isEncrypted())return null;if(!e.isRoomEncrypted(t.getRoomId()))return null;if(!e._crypto&&e.usingExternalCrypto)return null;if("m.reaction"===t.getType())return null;if(!e._crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return e._crypto.encryptEvent(t,r)}(e,r,t);return n?(q(t,r,u.EventStatus.ENCRYPTING),n.then((()=>{q(t,r,u.EventStatus.SENDING)}))):null})).then((function(){let n;return e.scheduler&&(n=e.scheduler.queueEvent(r),n&&e.scheduler.getQueueForEvent(r).length>1&&q(t,r,u.EventStatus.QUEUED)),n||(n=j(e,r),t&&(n=n.then((e=>(t.updatePendingEvent(r,u.EventStatus.SENT,e.event_id),e))))),n})).then((function(e){return n&&n(null,e),e}),(function(e){k.logger.error("Error sending event",e.stack||e);try{r.error=e,q(t,r,u.EventStatus.NOT_SENT),e.event=r,n&&n(e)}catch(t){k.logger.error("Exception in error handler!",t.stack||e)}throw e}))}function q(e,t,r){e?e.updatePendingEvent(t,r):t.setStatus(r)}function j(e,t){let r=t.getTxnId();r||(r=e.makeTxnId(),t.setTxnId(r));const n={$roomId:t.getRoomId(),$eventType:t.getWireType(),$stateKey:t.getStateKey(),$txnId:r};let i;if(t.isState()){let e="/rooms/$roomId/state/$eventType";t.getStateKey()&&t.getStateKey().length>0&&(e="/rooms/$roomId/state/$eventType/$stateKey"),i=m.encodeUri(e,n)}else if(t.isRedaction()){const e="/rooms/$roomId/redact/$redactsEventId/$txnId";i=m.encodeUri(e,Object.assign({$redactsEventId:t.event.redacts},n))}else i=m.encodeUri("/rooms/$roomId/send/$eventType/$txnId",n);return e._http.authedRequest(void 0,"PUT",i,void 0,t.getWireContent()).then((e=>(k.logger.log(`Event sent to ${t.getRoomId()} with event id ${e.event_id}`),e)))}function K(e,t,r,n,i,s){m.isFunction(i)&&(s=i,i=void 0);const o=m.encodeUri("/rooms/$room_id/$membership",{$room_id:t,$membership:n});return e._http.authedRequest(s,"POST",o,void 0,{user_id:r,reason:i})}function z(e,t,r){e&&e(r),t(r)}function $(e,t,r){e&&e(null,r),t(r)}function G(e,t){const r=Boolean(t&&t.preventReEmit);return function(t){const n=new u.MatrixEvent(t);return n.isEncrypted()&&(r||e.reEmitter.reEmit(n,["Event.decrypted"]),n.attemptDecryption(e._crypto)),r||e.reEmitter.reEmit(n,["Event.replaced"]),n}}m.inherits(N,o.EventEmitter),m.extend(N.prototype,a.MatrixBaseApis.prototype),N.prototype.rehydrateDevice=async function(){if(this._crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this._cryptoCallbacks.getDehydrationKey)return;let e;try{e=await this._http.authedRequest(void 0,"GET","/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){return void k.logger.info("could not get dehydrated device",e.toString())}if(!e.device_data||!e.device_id)return void k.logger.info("no dehydrated device found");const t=new r.g.Olm.Account;try{const r=e.device_data;if(r.algorithm!==O.DEHYDRATION_ALGORITHM)return void k.logger.warn("Wrong algorithm for dehydrated device");k.logger.log("unpickling dehydrated device");const n=await this._cryptoCallbacks.getDehydrationKey(r,(e=>{t.unpickle(new Uint8Array(e),r.account)}));if(t.unpickle(n,r.account),k.logger.log("unpickled device"),!0===(await this._http.authedRequest(void 0,"POST","/dehydrated_device/claim",void 0,{device_id:e.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=e.device_id,k.logger.info("using dehydrated device");const r=this.pickleKey||"DEFAULT_KEY";return this._exportedOlmDeviceToImport={pickledAccount:t.pickle(r),sessions:[],pickleKey:r},t.free(),this.deviceId}return t.free(),void k.logger.info("not using dehydrated device")}catch(e){t.free(),k.logger.warn("could not unpickle",e)}},N.prototype.setDehydrationKey=async function(e,t={},r){if(this._crypto)return await this._crypto._dehydrationManager.setKeyAndQueueDehydration(e,t,r);k.logger.warn("not dehydrating device if crypto is not enabled")},N.prototype.createDehydratedDevice=async function(e,t={},r){if(this._crypto)return await this._crypto._dehydrationManager.setKey(e,t,r),await this._crypto._dehydrationManager.dehydrateDevice();k.logger.warn("not dehydrating device if crypto is not enabled")},N.prototype.exportDevice=async function(){if(this._crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:await this._crypto._olmDevice.export()};k.logger.warn("not exporting device if crypto is not enabled")},N.prototype.clearStores=function(){if(this._clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];return e.push(this.store.deleteAllData()),this._cryptoStore&&e.push(this._cryptoStore.deleteAllData()),Promise.all(e)},N.prototype.getUserId=function(){return this.credentials&&this.credentials.userId?this.credentials.userId:null},N.prototype.getDomain=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null},N.prototype.getUserIdLocalpart=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null},N.prototype.getDeviceId=function(){return this.deviceId},N.prototype.supportsVoip=function(){return this._supportsVoip},N.prototype.setForceTURN=function(e){this._forceTURN=e},N.prototype.setSupportsCallTransfer=function(e){this._supportsCallTransfer=e},N.prototype.getSyncState=function(){return this._syncApi?this._syncApi.getSyncState():null},N.prototype.getSyncStateData=function(){return this._syncApi?this._syncApi.getSyncStateData():null},N.prototype.isInitialSyncComplete=function(){const e=this.getSyncState();return!!e&&("PREPARED"===e||"SYNCING"===e)},N.prototype.isGuest=function(){return this._isGuest},N.prototype.getScheduler=function(){return this.scheduler},N.prototype.setGuest=function(e){this._isGuest=e},N.prototype.retryImmediately=function(){return this._syncApi.retryImmediately()},N.prototype.getNotifTimelineSet=function(){return this._notifTimelineSet},N.prototype.setNotifTimelineSet=function(e){this._notifTimelineSet=e},N.prototype.getCapabilities=function(e=!1){const t=(new Date).getTime();return this._cachedCapabilities&&!e&&t<this._cachedCapabilities.expiration?(k.logger.log("Returning cached capabilities"),Promise.resolve(this._cachedCapabilities.capabilities)):this._http.authedRequest(void 0,"GET","/capabilities").catch((e=>(k.logger.error(e),null))).then((e=>{e||(e={});const r=e.capabilities||{},n=Object.keys(r).length?216e5:6e4+5e3*Math.random();return this._cachedCapabilities={capabilities:r,expiration:t+n},k.logger.log("Caching capabilities: ",r),r}))},N.prototype.initCrypto=async function(){if(!(0,E.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this._crypto)return void k.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this._sessionStore)throw new Error("Cannot enable encryption: no sessionStore provided");if(!this._cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");k.logger.log("Crypto: Starting up crypto store..."),await this._cryptoStore.startup(),k.logger.log("Crypto: initialising roomlist..."),await this._roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new E.Crypto(this,this._sessionStore,e,this.deviceId,this.store,this._cryptoStore,this._roomList,this._verificationMethods);this.reEmitter.reEmit(t,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","crypto.willUpdateDevices","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),k.logger.log("Crypto: initialising crypto object..."),await t.init({exportedOlmDevice:this._exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this._exportedOlmDeviceToImport,this.olmVersion=E.Crypto.getOlmVersion(),t.registerEventHandlers(this),this._crypto=t},N.prototype.isCryptoEnabled=function(){return null!==this._crypto},N.prototype.getDeviceEd25519Key=function(){return this._crypto?this._crypto.getDeviceEd25519Key():null},N.prototype.getDeviceCurve25519Key=function(){return this._crypto?this._crypto.getDeviceCurve25519Key():null},N.prototype.uploadKeys=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.uploadDeviceKeys()},N.prototype.downloadKeys=function(e,t){return null===this._crypto?Promise.reject(new Error("End-to-end encryption disabled")):this._crypto.downloadKeys(e,t)},N.prototype.getStoredDevicesForUser=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevicesForUser(e)||[]},N.prototype.getStoredDevice=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevice(e,t)||null},N.prototype.setDeviceVerified=function(e,t,r){void 0===r&&(r=!0);const n=F(this,e,t,r,null);return e==this.credentials.userId&&this._crypto.checkKeyBackup(),n},N.prototype.setDeviceBlocked=function(e,t,r){return void 0===r&&(r=!0),F(this,e,t,null,r)},N.prototype.setDeviceKnown=function(e,t,r){return void 0===r&&(r=!0),F(this,e,t,null,null,r)},N.prototype.requestVerificationDM=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerificationDM(e,t)},N.prototype.findVerificationRequestDMInProgress=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.findVerificationRequestDMInProgress(e)},N.prototype.getVerificationRequestsToDeviceInProgress=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getVerificationRequestsToDeviceInProgress(e)},N.prototype.requestVerification=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerification(e,t)},N.prototype.beginKeyVerification=function(e,t,r){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.beginKeyVerification(e,t,r)},N.prototype.setGlobalBlacklistUnverifiedDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalBlacklistUnverifiedDevices(e)},N.prototype.getGlobalBlacklistUnverifiedDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalBlacklistUnverifiedDevices()},N.prototype.setGlobalErrorOnUnknownDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalErrorOnUnknownDevices(e)},N.prototype.getGlobalErrorOnUnknownDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalErrorOnUnknownDevices()},B(N,["getCrossSigningId","getStoredCrossSigningForUser","checkUserTrust","checkDeviceTrust","checkOwnCrossSigningTrust","checkCrossSigningPrivateKey","legacyDeviceVerification","prepareToEncrypt","isCrossSigningReady","bootstrapCrossSigning","getCryptoTrustCrossSignedDevices","setCryptoTrustCrossSignedDevices","countSessionsNeedingBackup"]),B(N,["getEventEncryptionInfo","createRecoveryKeyFromPassphrase","isSecretStorageReady","bootstrapSecretStorage","addSecretStorageKey","hasSecretStorageKey","storeSecret","getSecret","isSecretStored","requestSecret","getDefaultSecretStorageKeyId","setDefaultSecretStorageKeyId","checkSecretStorageKey","checkSecretStoragePrivateKey"]),N.prototype.getEventSenderDeviceInfo=async function(e){return this._crypto?this._crypto.getEventSenderDeviceInfo(e):null},N.prototype.isEventSenderVerified=async function(e){const t=await this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()},N.prototype.cancelAndResendEventRoomKeyRequest=function(e){return e.cancelAndResendKeyRequest(this._crypto,this.getUserId())},N.prototype.setRoomEncryption=function(e,t){if(!this._crypto)throw new Error("End-to-End encryption disabled");return this._crypto.setRoomEncryption(e,t)},N.prototype.isRoomEncrypted=function(e){const t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents("m.room.encryption","")||this._roomList.isRoomEncrypted(e))},N.prototype.forceDiscardSession=function(e){if(!this._crypto)throw new Error("End-to-End encryption disabled");this._crypto.forceDiscardSession(e)},N.prototype.exportRoomKeys=function(){return this._crypto?this._crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))},N.prototype.importRoomKeys=function(e,t){if(!this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.importRoomKeys(e,t)},N.prototype.checkKeyBackup=function(){return this._crypto.checkKeyBackup()},N.prototype.getKeyBackupVersion=function(){return this._http.authedRequest(void 0,"GET","/room_keys/version",void 0,void 0,{prefix:y.PREFIX_UNSTABLE}).then((e=>{if(e.algorithm!==b.MEGOLM_BACKUP_ALGORITHM){const t="Unknown backup algorithm: "+e.algorithm;return Promise.reject(t)}if("object"==typeof e.auth_data&&e.auth_data.public_key)return e;{const e="Invalid backup data returned";return Promise.reject(e)}})).catch((e=>{if("M_NOT_FOUND"===e.errcode)return null;throw e}))},N.prototype.isKeyBackupTrusted=function(e){return this._crypto.isKeyBackupTrusted(e)},N.prototype.getKeyBackupEnabled=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto._checkedForBackup?Boolean(this._crypto.backupKey):null},N.prototype.enableKeyBackup=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=e,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=new r.g.Olm.PkEncryption,this._crypto.backupKey.set_recipient_key(e.auth_data.public_key),this.emit("crypto.keyBackupStatus",!0),this._crypto.scheduleKeyBackupSend()},N.prototype.disableKeyBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=null,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=null,this.emit("crypto.keyBackupStatus",!1)},N.prototype.prepareKeyBackupVersion=async function(e,{secureSecretStorage:t=!1}={}){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const{keyInfo:r,encodedPrivateKey:n,privateKey:i}=await this.createRecoveryKeyFromPassphrase(e);t&&(await this.storeSecret("m.megolm_backup.v1",(0,b.encodeBase64)(i)),k.logger.info("Key backup private key stored in secret storage"));const s={public_key:r.pubkey};return r.passphrase&&(s.private_key_salt=r.passphrase.salt,s.private_key_iterations=r.passphrase.iterations),{algorithm:b.MEGOLM_BACKUP_ALGORITHM,auth_data:s,recovery_key:n}},N.prototype.isKeyBackupKeyStored=async function(){return this.isSecretStored("m.megolm_backup.v1",!1)},N.prototype.createKeyBackupVersion=async function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const t={algorithm:e.algorithm,auth_data:e.auth_data};await this._crypto._signObject(t.auth_data),this._cryptoCallbacks.getCrossSigningKey&&this._crypto._crossSigningInfo.getId()&&await this._crypto._crossSigningInfo.signObject(t.auth_data,"master");const r=await this._http.authedRequest(void 0,"POST","/room_keys/version",void 0,t,{prefix:y.PREFIX_UNSTABLE});return await this.checkKeyBackup(),this.getKeyBackupEnabled()||k.logger.error("Key backup not usable even though we just created it"),r},N.prototype.deleteKeyBackupVersion=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo&&this._crypto.backupInfo.version===e&&this.disableKeyBackup();const t=m.encodeUri("/room_keys/version/$version",{$version:e});return this._http.authedRequest(void 0,"DELETE",t,void 0,void 0,{prefix:y.PREFIX_UNSTABLE})},N.prototype._makeKeyBackupPath=function(e,t,r){let n;return n=void 0!==t?m.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?m.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",{path:n,queryData:void 0===r?void 0:{version:r}}},N.prototype.sendKeyBackup=function(e,t,r,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const i=this._makeKeyBackupPath(e,t,r);return this._http.authedRequest(void 0,"PUT",i.path,i.queryData,n,{prefix:y.PREFIX_UNSTABLE})},N.prototype.scheduleAllGroupSessionsForBackup=async function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");await this._crypto.scheduleAllGroupSessionsForBackup()},N.prototype.flagAllGroupSessionsForBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.flagAllGroupSessionsForBackup()},N.prototype.isValidRecoveryKey=function(e){try{return(0,x.decodeRecoveryKey)(e),!0}catch(e){return!1}},N.prototype.keyBackupKeyFromPassword=function(e,t){return(0,A.keyFromAuthData)(t.auth_data,e)},N.prototype.keyBackupKeyFromRecoveryKey=function(e){return(0,x.decodeRecoveryKey)(e)},N.RESTORE_BACKUP_ERROR_BAD_KEY="RESTORE_BACKUP_ERROR_BAD_KEY",N.prototype.restoreKeyBackupWithPassword=async function(e,t,r,n,i){const s=await(0,A.keyFromAuthData)(n.auth_data,e);return this._restoreKeyBackup(s,t,r,n,i)},N.prototype.restoreKeyBackupWithSecretStorage=async function(e,t,r,n){const i=await this.getSecret("m.megolm_backup.v1"),s=(0,E.fixBackupKey)(i);if(s){const[e]=await this._crypto.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",s,[e])}const o=(0,b.decodeBase64)(s||i);return this._restoreKeyBackup(o,t,r,e,n)},N.prototype.restoreKeyBackupWithRecoveryKey=function(e,t,r,n,i){const s=(0,x.decodeRecoveryKey)(e);return this._restoreKeyBackup(s,t,r,n,i)},N.prototype.restoreKeyBackupWithCache=async function(e,t,r,n){const i=await this._crypto.getSessionBackupPrivateKey();if(!i)throw new Error("Couldn't get key");return this._restoreKeyBackup(i,e,t,r,n)},N.prototype._restoreKeyBackup=function(e,t,n,i,{cacheCompleteCallback:s,progressCallback:o}={}){if(null===this._crypto)throw new Error("End-to-end encryption disabled");let a=0,c=[];const l=this._makeKeyBackupPath(t,n,i.version),u=new r.g.Olm.PkDecryption;let h;try{h=u.init_with_private_key(e)}catch(e){throw u.free(),e}return h!==i.auth_data.public_key?Promise.reject({errcode:N.RESTORE_BACKUP_ERROR_BAD_KEY}):(this._crypto.storeSessionBackupPrivateKey(e).catch((e=>{k.logger.warn("Error caching session backup key:",e)})).then(s),o&&o({stage:"fetch"}),this._http.authedRequest(void 0,"GET",l.path,l.queryData,void 0,{prefix:y.PREFIX_UNSTABLE}).then((e=>{if(e.rooms)for(const[t,r]of Object.entries(e.rooms)){if(!r.sessions)continue;a+=Object.keys(r.sessions).length;const e=M(r.sessions,u,t);for(const r of e)r.room_id=t,c.push(r)}else if(e.sessions)a=Object.keys(e.sessions).length,c=M(e.sessions,u,t);else{a=1;try{const r=L(e,u);r.room_id=t,r.session_id=n,c.push(r)}catch(e){k.logger.log("Failed to decrypt megolm session from backup",e)}}return this.importRoomKeys(c,{progressCallback:o,untrusted:!0,source:"backup"})})).then((()=>this._crypto.setTrustedBackupPubKey(h))).then((()=>({total:a,imported:c.length}))).finally((()=>{u.free()})))},N.prototype.deleteKeysFromBackup=function(e,t,r){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const n=this._makeKeyBackupPath(e,t,r);return this._http.authedRequest(void 0,"DELETE",n.path,n.queryData,void 0,{prefix:y.PREFIX_UNSTABLE})},N.prototype.getGroup=function(e){return this.store.getGroup(e)},N.prototype.getGroups=function(){return this.store.getGroups()},N.prototype.getMediaConfig=function(e){return this._http.authedRequest(e,"GET","/config",void 0,void 0,{prefix:y.PREFIX_MEDIA_R0})},N.prototype.getRoom=function(e){return this.store.getRoom(e)},N.prototype.getRooms=function(){return this.store.getRooms()},N.prototype.getVisibleRooms=function(){const e=this.store.getRooms(),t=new Set;for(const r of e){const e=r.currentState.getStateEvents("m.room.create","");if(e){const r=e.getContent().predecessor;r&&r.room_id&&t.add(r.room_id)}}return e.filter((e=>!e.currentState.getStateEvents("m.room.tombstone","")||!t.has(e.roomId)))},N.prototype.getUser=function(e){return this.store.getUser(e)},N.prototype.getUsers=function(){return this.store.getUsers()},N.prototype.setAccountData=function(e,t,r){const n=m.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),i=(0,y.retryNetworkOperation)(5,(()=>this._http.authedRequest(void 0,"PUT",n,void 0,t)));return r&&i.then((e=>r(null,e)),r),i},N.prototype.getAccountData=function(e){return this.store.getAccountData(e)},N.prototype.getAccountDataFromServer=async function(e){if(this.isInitialSyncComplete()){const t=this.store.getAccountData(e);return t?t.getContent():null}const t=m.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this._http.authedRequest(void 0,"GET",t,void 0)}catch(e){if(e.data&&"M_NOT_FOUND"===e.data.errcode)return null;throw e}},N.prototype.getIgnoredUsers=function(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]},N.prototype.setIgnoredUsers=function(e,t){const r={ignored_users:{}};return e.map((e=>r.ignored_users[e]={})),this.setAccountData("m.ignored_user_list",r,t)},N.prototype.isUserIgnored=function(e){return-1!==this.getIgnoredUsers().indexOf(e)},N.prototype.joinRoom=function(e,t,r){if(m.isFunction(t))throw new Error("Expected 'opts' object, got function.");void 0===(t=t||{}).syncRoom&&(t.syncRoom=!0);const n=this.getRoom(e);if(n&&n.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(n);let i=Promise.resolve();t.inviteSignUrl&&(i=this._http.requestOtherUrl(void 0,"POST",t.inviteSignUrl,{mxid:this.credentials.userId}));const s={};t.viaServers&&(s.server_name=t.viaServers);const o={qsStringifyOptions:{arrayFormat:"repeat"}},a=this;return new Promise(((n,c)=>{i.then((function(t){const r={};t&&(r.third_party_signed=t);const n=m.encodeUri("/join/$roomid",{$roomid:e});return a._http.authedRequest(void 0,"POST",n,s,r,o)})).then((function(e){const r=e.room_id,n=new l.SyncApi(a,a._clientOpts).createRoom(r);return t.syncRoom,Promise.resolve(n)})).then((function(e){$(r,n,e)}),(function(e){z(r,c,e)}))}))},N.prototype.resendEvent=function(e,t){return q(t,e,u.EventStatus.SENDING),U(this,t,e)},N.prototype.cancelPendingEvent=function(e){if([u.EventStatus.QUEUED,u.EventStatus.NOT_SENT].indexOf(e.status)<0)throw new Error("cannot cancel an event with status "+e.status);this.scheduler&&this.scheduler.removeEventFromQueue(e),q(this.getRoom(e.getRoomId()),e,u.EventStatus.CANCELLED)},N.prototype.setRoomName=function(e,t,r){return this.sendStateEvent(e,"m.room.name",{name:t},void 0,r)},N.prototype.setRoomTopic=function(e,t,r){return this.sendStateEvent(e,"m.room.topic",{topic:t},void 0,r)},N.prototype.getRoomTags=function(e,t){const r=m.encodeUri("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this._http.authedRequest(t,"GET",r,void 0)},N.prototype.setRoomTag=function(e,t,r,n){const i=m.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(n,"PUT",i,void 0,r)},N.prototype.deleteRoomTag=function(e,t,r){const n=m.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(r,"DELETE",n,void 0,void 0)},N.prototype.setRoomAccountData=function(e,t,r,n){const i=m.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this._http.authedRequest(n,"PUT",i,void 0,r)},N.prototype.setPowerLevel=function(e,t,r,n,i){let s={users:{}};n&&"m.room.power_levels"===n.getType()&&(s=m.deepCopy(n.getContent())),s.users[t]=r;const o=m.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this._http.authedRequest(i,"PUT",o,void 0,s)},N.prototype.sendEvent=function(e,t,r,n,i){return this._sendCompleteEvent(e,{type:t,content:r},n,i)},N.prototype._sendCompleteEvent=function(e,t,r,n){m.isFunction(r)&&(n=r,r=void 0),r||(r=this.makeTxnId());const i=new u.MatrixEvent(Object.assign(t,{event_id:"~"+e+":"+r,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),s=this.getRoom(e),o=i.getAssociatedId();if(o&&o.startsWith("~")){const e=s.getPendingEvents().find((e=>e.getId()===o));e.once("Event.localEventIdReplaced",(()=>{i.updateAssociatedId(e.getId())}))}const a=i.getType();return k.logger.log(`sendEvent of type ${a} in ${e} with txnId ${r}`),i.setTxnId(r),i.setStatus(u.EventStatus.SENDING),s&&s.addPendingEvent(i,r),i.status===u.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):U(this,s,i,n)},N.prototype.redactEvent=function(e,t,r,n){const i=("object"==typeof n?n:{}).reason,s="function"==typeof n?n:void 0;return this._sendCompleteEvent(e,{type:"m.room.redaction",content:{reason:i},redacts:t},r,s)},N.prototype.sendMessage=function(e,t,r,n){return m.isFunction(r)&&(n=r,r=void 0),this.sendEvent(e,"m.room.message",t,r,n)},N.prototype.sendTextMessage=function(e,t,r,n){const i=_.makeTextMessage(t);return this.sendMessage(e,i,r,n)},N.prototype.sendNotice=function(e,t,r,n){const i=_.makeNotice(t);return this.sendMessage(e,i,r,n)},N.prototype.sendEmoteMessage=function(e,t,r,n){const i=_.makeEmoteMessage(t);return this.sendMessage(e,i,r,n)},N.prototype.sendImageMessage=function(e,t,r,n,i){m.isFunction(n)&&(i=n,n=void 0),n||(n="Image");const s={msgtype:"m.image",url:t,info:r,body:n};return this.sendMessage(e,s,i)},N.prototype.sendStickerMessage=function(e,t,r,n,i){m.isFunction(n)&&(i=n,n=void 0),n||(n="Sticker");const s={url:t,info:r,body:n};return this.sendEvent(e,"m.sticker",s,i,void 0)},N.prototype.sendHtmlMessage=function(e,t,r,n){const i=_.makeHtmlMessage(t,r);return this.sendMessage(e,i,n)},N.prototype.sendHtmlNotice=function(e,t,r,n){const i=_.makeHtmlNotice(t,r);return this.sendMessage(e,i,n)},N.prototype.sendHtmlEmote=function(e,t,r,n){const i=_.makeHtmlEmote(t,r);return this.sendMessage(e,i,n)},N.prototype.sendReceipt=function(e,t,r,n){if("function"==typeof r&&(n=r,r={}),this.isGuest())return Promise.resolve({});const i=m.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),s=this._http.authedRequest(n,"POST",i,void 0,r||{}),o=this.getRoom(e.getRoomId());return o&&o._addLocalEchoReceipt(this.credentials.userId,e,t),s},N.prototype.sendReadReceipt=async function(e,t,r){"function"==typeof t&&(r=t,t={}),t||(t={});const n=e.getId(),i=this.getRoom(e.getRoomId());if(i&&i.hasPendingEvent(n))throw new Error(`Cannot set read receipt to a pending event (${n})`);const s={"m.hidden":Boolean(t.hidden)};return this.sendReceipt(e,"m.read",s,r)},N.prototype.setRoomReadMarkers=async function(e,t,r,n){const i=this.getRoom(e);if(i&&i.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let s;if(r){if(s=r.getId(),i&&i.hasPendingEvent(s))throw new Error(`Cannot set read receipt to a pending event (${s})`);i&&i._addLocalEchoReceipt(this.credentials.userId,r,"m.read")}return this.setRoomReadMarkersHttpRequest(e,t,s,n)},N.prototype.getUrlPreview=function(e,t,r){const n=(t=6e4*Math.floor(t/6e4))+"_"+e,i=this.urlPreviewCache[n];if(i)return r&&i.then(r).catch(r),i;const s=this._http.authedRequest(r,"GET","/preview_url",{url:e,ts:t},void 0,{prefix:y.PREFIX_MEDIA_R0});return this.urlPreviewCache[n]=s,s},N.prototype.sendTyping=function(e,t,r,n){if(this.isGuest())return Promise.resolve({});const i=m.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),s={typing:t};return t&&(s.timeout=r||2e4),this._http.authedRequest(n,"PUT",i,void 0,s)},N.prototype.getRoomUpgradeHistory=function(e,t=!1){let r=this.getRoom(e);if(!r)return[];const n=[r];let i=r.currentState.getStateEvents("m.room.create","");for(;i;){k.logger.log(`Looking at ${i.getId()}`);const e=i.getContent().predecessor;if(!e||!e.room_id)break;{k.logger.log(`Looking at predecessor ${e.room_id}`);const r=this.getRoom(e.room_id);if(!r)break;if(t){const e=r.currentState.getStateEvents("m.room.tombstone","");if(!e||e.getContent().replacement_room!==r.roomId)break}n.splice(0,0,r),i=r.currentState.getStateEvents("m.room.create","")}}let s=r.currentState.getStateEvents("m.room.tombstone","");for(;s;){const e=this.getRoom(s.getContent().replacement_room);if(!e)break;if(e.roomId===r.roomId)break;if(t){if(i=e.currentState.getStateEvents("m.room.create",""),!i||!i.getContent().predecessor)break;if(i.getContent().predecessor.room_id!==r.roomId)break}if(n.push(e),new Set(n.map((e=>e.roomId))).size<n.length)return n.slice(0,n.length-1);r=e,s=r.currentState.getStateEvents("m.room.tombstone","")}return n},N.prototype.invite=function(e,t,r,n){return K(this,e,t,"invite",n,r)},N.prototype.inviteByEmail=function(e,t,r){return this.inviteByThreePid(e,"email",t,r)},N.prototype.inviteByThreePid=async function(e,t,r,n){const i=m.encodeUri("/rooms/$roomId/invite",{$roomId:e}),s=this.getIdentityServerUrl(!0);if(!s)return Promise.reject(new y.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const o={id_server:s,medium:t,address:r};if(this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(o.id_access_token=e)}return this._http.authedRequest(n,"POST",i,void 0,o)},N.prototype.leave=function(e,t){return K(this,e,void 0,"leave",void 0,t)},N.prototype.leaveRoomChain=function(e,t=!0){const r=this.getRoomUpgradeHistory(e);let n=r;if(!t){n=[];for(const t of r)if(n.push(t),t.roomId===e)break}const i={},s=[],o=e=>this.leave(e).then((()=>{i[e]=null})).catch((t=>(i[e]=t,null)));for(const e of n)s.push(o(e.roomId));return Promise.all(s).then((()=>i))},N.prototype.ban=function(e,t,r,n){return K(this,e,t,"ban",r,n)},N.prototype.forget=function(e,t,r){void 0===t&&(t=!0);const n=K(this,e,void 0,"forget",void 0,r);if(!t)return n;const i=this;return n.then((function(t){return i.store.removeRoom(e),i.emit("deleteRoom",e),t}))},N.prototype.unban=function(e,t,r){const n=m.encodeUri("/rooms/$roomId/unban",{$roomId:e}),i={user_id:t};return this._http.authedRequest(r,"POST",n,void 0,i)},N.prototype.kick=function(e,t,r,n){return function(e,t,r,n,i,s){m.isFunction(i)&&(s=i,i=void 0);const o=m.encodeUri("/rooms/$roomId/state/m.room.member/$userId",{$roomId:t,$userId:r});return e._http.authedRequest(s,"PUT",o,void 0,{membership:"leave",reason:i})}(this,e,t,0,r,n)},N.prototype.getPushActionsForEvent=function(e){return e.getPushActions()||e.setPushActions(this._pushProcessor.actionsForEvent(e)),e.getPushActions()},N.prototype.setProfileInfo=function(e,t,r){const n=m.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this._http.authedRequest(r,"PUT",n,void 0,t)},N.prototype.setDisplayName=async function(e,t){const r=await this.setProfileInfo("displayname",{displayname:e},t),n=this.getUser(this.getUserId());return n&&(n.displayName=e,n.emit("User.displayName",n.events.presence,n)),r},N.prototype.setAvatarUrl=async function(e,t){const r=await this.setProfileInfo("avatar_url",{avatar_url:e},t),n=this.getUser(this.getUserId());return n&&(n.avatarUrl=e,n.emit("User.avatarUrl",n.events.presence,n)),r},N.prototype.mxcUrlToHttp=function(e,t,r,n,i){return(0,v.getHttpUriForMxc)(this.baseUrl,e,t,r,n,i)},N.prototype._unstable_setStatusMessage=function(e){const t="im.vector.user_status";return Promise.all(this.getRooms().map((r=>{const n="join"===r.getMyMembership(),i=2===r.getInvitedAndJoinedMemberCount();return n&&i&&r.currentState.mayClientSendStateEvent(t,this)?this.sendStateEvent(r.roomId,t,{status:e},this.getUserId()):Promise.resolve()})))},N.prototype.setPresence=function(e,t){const r=m.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});if("string"==typeof e&&(e={presence:e}),-1==["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this._http.authedRequest(t,"PUT",r,void 0,e)},N.prototype.getPresence=function(e,t){const r=m.encodeUri("/presence/$userId/status",{$userId:e});return this._http.authedRequest(t,"GET",r,void 0,void 0)},N.prototype.scrollback=function(e,t,r){m.isFunction(t)&&(r=t,t=void 0),t=t||30;let n=0,i=this._ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){const e=Date.now()-i.errorTs;n=Math.max(3e3-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const s=this.store.scrollback(e,t).length;if(s===t)return Promise.resolve(e);t-=s;const o=this,a=new Promise(((i,s)=>{(0,m.sleep)(n).then((function(){return o._createMessagesRequest(e.roomId,e.oldState.paginationToken,t,"b")})).then((function(t){const n=m.map(t.chunk,G(o));if(t.state){const r=m.map(t.state,G(o));e.currentState.setUnknownStateEvents(r)}e.addEventsToTimeline(n,!0,e.getLiveTimeline()),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),o.store.storeEvents(e,n,t.end,!0),o._ongoingScrollbacks[e.roomId]=null,$(r,i,e)}),(function(t){o._ongoingScrollbacks[e.roomId]={errorTs:Date.now()},z(r,s,t)}))}));return i={promise:a,errorTs:null},this._ongoingScrollbacks[e.roomId]=i,a},N.prototype.getEventTimeline=function(e,t){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));const r=m.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let n;this._clientOpts.lazyLoadMembers&&(n={filter:JSON.stringify(c.Filter.LAZY_LOADING_MESSAGES_FILTER)});const i=this;return i._http.authedRequest(void 0,"GET",r,n).then((function(r){if(!r.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);r.events_after.reverse();const n=r.events_after.concat([r.event]).concat(r.events_before),s=m.map(n,i.getEventMapper());let o=e.getTimelineForEvent(s[0].getId());if(o){const e=m.map(r.state,i.getEventMapper());o.getState(h.EventTimeline.BACKWARDS).setUnknownStateEvents(e)}else o=e.addTimeline(),o.initialiseState(m.map(r.state,i.getEventMapper())),o.getState(h.EventTimeline.FORWARDS).paginationToken=r.end;return e.addEventsToTimeline(s,!0,o,r.start),e.getTimelineForEvent(t)||o}))},N.prototype._createMessagesRequest=function(e,t,r,n,i){const s=m.encodeUri("/rooms/$roomId/messages",{$roomId:e});void 0===r&&(r=30);const o={from:t,limit:r,dir:n};let a=null;return this._clientOpts.lazyLoadMembers&&(a=Object.assign({},c.Filter.LAZY_LOADING_MESSAGES_FILTER)),i&&(a=a||{},Object.assign(a,i.getRoomTimelineFilterComponent())),a&&(o.filter=JSON.stringify(a)),this._http.authedRequest(void 0,"GET",s,o)},N.prototype.paginateEventTimeline=function(e,t){const r=e.getTimelineSet()===this._notifTimelineSet,n=(t=t||{}).backwards||!1;if(r&&!n)throw new Error("paginateNotifTimeline can only paginate backwards");const i=n?h.EventTimeline.BACKWARDS:h.EventTimeline.FORWARDS,s=e.getPaginationToken(i);if(!s)return Promise.resolve(!1);const o=e._paginationRequests[i];if(o)return o;let a,c,l;const u=this;if(r)a="/notifications",c={limit:"limit"in t?t.limit:30,only:"highlight"},s&&"end"!==s&&(c.from=s),l=this._http.authedRequest(void 0,"GET","/notifications",c,void 0).then((function(t){const r=t.next_token,s=[];for(let e=0;e<t.notifications.length;e++){const r=t.notifications[e],n=u.getEventMapper()(r.event);n.setPushActions(C.PushProcessor.actionListToActionsObject(r.actions)),n.event.room_id=r.room_id,s[e]=n}return e.getTimelineSet().addEventsToTimeline(s,n,e,r),n&&!t.next_token&&e.setPaginationToken(null,i),!!t.next_token})).finally((function(){e._paginationRequests[i]=null})),e._paginationRequests[i]=l;else{if(!this.getRoom(e.getRoomId()))throw new Error("Unknown room "+e.getRoomId());l=this._createMessagesRequest(e.getRoomId(),s,t.limit,i,e.getFilter()),l.then((function(t){if(t.state){const r=e.getState(i),n=m.map(t.state,u.getEventMapper());r.setUnknownStateEvents(n)}const r=t.end,s=m.map(t.chunk,u.getEventMapper());return e.getTimelineSet().addEventsToTimeline(s,n,e,r),n&&t.end==t.start&&e.setPaginationToken(null,i),t.end!=t.start})).finally((function(){e._paginationRequests[i]=null})),e._paginationRequests[i]=l}return l},N.prototype.resetNotifTimelineSet=function(){this._notifTimelineSet&&this._notifTimelineSet.resetLiveTimeline("end",null)},N.prototype.peekInRoom=function(e){return this._peekSync&&this._peekSync.stopPeeking(),this._peekSync=new l.SyncApi(this,this._clientOpts),this._peekSync.peek(e)},N.prototype.stopPeeking=function(){this._peekSync&&(this._peekSync.stopPeeking(),this._peekSync=null)},N.prototype.setGuestAccess=function(e,t){const r=this.sendStateEvent(e,"m.room.guest_access",{guest_access:t.allowJoin?"can_join":"forbidden"});let n=Promise.resolve();return t.allowRead&&(n=this.sendStateEvent(e,"m.room.history_visibility",{history_visibility:"world_readable"})),Promise.all([n,r])},N.prototype.requestRegisterEmailToken=function(e,t,r,n){return this._requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:n})},N.prototype.requestRegisterMsisdnToken=function(e,t,r,n,i){return this._requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:n,next_link:i})},N.prototype.requestAdd3pidEmailToken=function(e,t,r,n){return this._requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:n})},N.prototype.requestAdd3pidMsisdnToken=function(e,t,r,n,i){return this._requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:n,next_link:i})},N.prototype.requestPasswordEmailToken=function(e,t,r,n){return this._requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:n})},N.prototype.requestPasswordMsisdnToken=function(e,t,r,n,i){return this._requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:n,next_link:i})},N.prototype._requestTokenFromEndpoint=async function(e,t){const r=Object.assign({},t);if(!await this.doesServerSupportSeparateAddAndBind()&&this.idBaseUrl){const e=s.default.parse(this.idBaseUrl);if(!e.host)throw new Error("Invalid ID server URL: "+this.idBaseUrl);if(r.id_server=e.host,this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(r.id_access_token=e)}}return this._http.request(void 0,"POST",e,void 0,r)},N.prototype.getRoomPushRule=function(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(let r=0;r<this.pushRules[e].room.length;r++){const n=this.pushRules[e].room[r];if(n.rule_id===t)return n}},N.prototype.setRoomMutePushRule=function(e,t,r){const n=this;let i,s;const o=this.getRoomPushRule(e,t);if(o&&0<=o.actions.indexOf("dont_notify")&&(s=!0),r?o?s||(i=m.defer(),this.deletePushRule(e,"room",o.rule_id).then((function(){n.addPushRule(e,"room",t,{actions:["dont_notify"]}).then((function(){i.resolve()}),(function(e){i.reject(e)}))}),(function(e){i.reject(e)})),i=i.promise):i=this.addPushRule(e,"room",t,{actions:["dont_notify"]}):s&&(i=this.deletePushRule(e,"room",o.rule_id)),i)return new Promise(((e,t)=>{i.then((function(){n.getPushRules().then((function(t){n.pushRules=t,e()}),(function(e){t(e)}))}),(function(e){n.getPushRules().then((function(r){n.pushRules=r,t(e)}),(function(r){t(e)}))}))}))},N.prototype.searchMessageText=function(e,t){const r={search_term:e.query};return"keys"in e&&(r.keys=e.keys),this.search({body:{search_categories:{room_events:r}}},t)},N.prototype.searchRoomEvents=function(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:"recent",event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:t,results:[],highlights:[]};return this.search({body:t}).then(this._processRoomEventsSearch.bind(this,r))},N.prototype.backPaginateRoomEventsSearch=function(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},r=this.search(t).then(this._processRoomEventsSearch.bind(this,e)).finally((function(){e.pendingRequest=null}));return e.pendingRequest=r,r},N.prototype._processRoomEventsSearch=function(e,t){const r=t.search_categories.room_events;e.count=r.count,e.next_batch=r.next_batch;const n={};r.highlights.forEach((function(e){n[e]=1})),e.highlights.forEach((function(e){n[e]=1})),e.highlights=Object.keys(n);for(let t=0;t<r.results.length;t++){const n=d.SearchResult.fromJson(r.results[t],this.getEventMapper());e.results.push(n)}return e},N.prototype.syncLeftRooms=function(){if(this._syncedLeftRooms)return Promise.resolve([]);if(this._syncLeftRoomsPromise)return this._syncLeftRoomsPromise;const e=this,t=new l.SyncApi(this,this._clientOpts);return this._syncLeftRoomsPromise=t.syncLeftRooms(),this._syncLeftRoomsPromise.then((function(t){k.logger.log("Marking success of sync left room request"),e._syncedLeftRooms=!0})).finally((function(){e._syncLeftRoomsPromise=null})),this._syncLeftRoomsPromise},N.prototype.createFilter=function(e){const t=this,r=m.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",r,void 0,e).then((function(r){const n=c.Filter.fromJson(t.credentials.userId,r.filter_id,e);return t.store.storeFilter(n),n}))},N.prototype.getFilter=function(e,t,r){if(r){const r=this.store.getFilter(e,t);if(r)return Promise.resolve(r)}const n=this,i=m.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this._http.authedRequest(void 0,"GET",i,void 0,void 0).then((function(r){const i=c.Filter.fromJson(e,t,r);return n.store.storeFilter(i),i}))},N.prototype.getOrCreateFilter=async function(e,t){const r=this.store.getFilterIdByName(e);let n;if(r){try{const e=await this.getFilter(this.credentials.userId,r,!0);if(e){const i=e.getDefinition(),s=t.getDefinition();m.deepCompare(i,s)&&(n=r)}}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}n||this.store.setFilterIdByName(e,void 0)}if(n)return n;const i=await this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,i.filterId),i.filterId},N.prototype.getOpenIdToken=function(){const e=m.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",e,void 0,{})},N.prototype.turnServer=function(e){return this._http.authedRequest(e,"GET","/voip/turnServer")},N.prototype.getTurnServers=function(){return this._turnServers||[]},N.prototype.getTurnServersExpiry=function(){return this._turnServersExpiry},N.prototype._checkTurnServers=async function(){if(!this._supportsVoip)return;let e=!1;const t=this._turnServersExpiry-Date.now();if(t>D)k.logger.debug("TURN creds are valid for another "+t+" ms: not fetching new ones."),e=!0;else{k.logger.debug("Fetching new TURN credentials");try{const t=await this.turnServer();if(t.uris){k.logger.log("Got TURN URIs: "+t.uris+" refresh in "+t.ttl+" secs");const r={urls:t.uris,username:t.username,credential:t.password};this._turnServers=[r],this._turnServersExpiry=Date.now()+1e3*t.ttl,e=!0}}catch(e){k.logger.error("Failed to get TURN URIs",e),403===e.httpStatus&&(k.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this._checkTurnServersIntervalID&&r.g.clearInterval(this._checkTurnServersIntervalID),this._checkTurnServersIntervalID=null)}}return e},N.prototype.setFallbackICEServerAllowed=function(e){this._fallbackICEServerAllowed=e},N.prototype.isFallbackICEServerAllowed=function(){return this._fallbackICEServerAllowed},N.prototype.isSynapseAdministrator=function(){const e=m.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this._http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:""}).then((e=>e.admin))},N.prototype.whoisSynapseUser=function(e){const t=m.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this._http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:""})},N.prototype.deactivateSynapseUser=function(e){const t=m.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this._http.authedRequest(void 0,"POST",t,void 0,void 0,{prefix:""})},N.prototype.startClient=async function(e){if(this.clientRunning)return;this.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e});const t=this.getUserId();t&&this.store.storeUser(new I.User(t)),this._crypto&&(this._crypto.uploadDeviceKeys(),this._crypto.start()),this._supportsVoip&&(this._checkTurnServersIntervalID=setInterval((()=>{this._checkTurnServers()}),D),this._checkTurnServers()),this._syncApi&&(k.logger.error("Still have sync object whilst not running: stopping old one"),this._syncApi.stop()),(e=Object.assign({},e)).crypto=this._crypto,e.canResetEntireTimeline=e=>!!this._canResetTimelineCallback&&this._canResetTimelineCallback(e),this._clientOpts=e,this._syncApi=new l.SyncApi(this,e),this._syncApi.sync(),void 0!==e.clientWellKnownPollPeriod&&(this._clientWellKnownIntervalID=setInterval((()=>{this._fetchClientWellKnown()}),1e3*e.clientWellKnownPollPeriod),this._fetchClientWellKnown())},N.prototype._fetchClientWellKnown=async function(){this._clientWellKnownPromise=R.AutoDiscovery.getRawClientConfig(this.getDomain()),this._clientWellKnown=await this._clientWellKnownPromise,this.emit("WellKnown.client",this._clientWellKnown)},N.prototype.getClientWellKnown=function(){return this._clientWellKnown},N.prototype.waitForClientWellKnown=function(){return this._clientWellKnownPromise},N.prototype._storeClientOptions=function(){const e=["boolean","string","number"],t=Object.entries(this._clientOpts).filter((([t,r])=>e.includes(typeof r))).reduce(((e,[t,r])=>(e[t]=r,e)),{});return this.store.storeClientOptions(t)},N.prototype._unstable_getSharedRooms=async function(e){if(!await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666"))throw Error("Server does not support shared_rooms API");const t=m.encodeUri("/uk.half-shot.msc2666/user/shared_rooms/$userId",{$userId:e});return(await this._http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:y.PREFIX_UNSTABLE})).joined},N.prototype.stopClient=function(){k.logger.log("stopping MatrixClient"),this.clientRunning=!1,this._syncApi&&(this._syncApi.stop(),this._syncApi=null),this._crypto&&this._crypto.stop(),this._peekSync&&this._peekSync.stopPeeking(),this._callEventHandler&&(this._callEventHandler.stop(),this._callEventHandler=null),r.g.clearInterval(this._checkTurnServersIntervalID),void 0!==this._clientWellKnownIntervalID&&r.g.clearInterval(this._clientWellKnownIntervalID)},N.prototype.getVersions=function(){return this._serverVersionsPromise||(this._serverVersionsPromise=this._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((e=>{throw this._serverVersionsPromise=null,e}))),this._serverVersionsPromise},N.prototype.isVersionSupported=async function(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)},N.prototype.doesServerSupportLazyLoading=async function(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,r=e.unstable_features;return t&&t.includes("r0.5.0")||r&&r["m.lazy_load_members"]},N.prototype.doesServerRequireIdServerParam=async function(){const e=await this.getVersions();if(!e)return!0;const t=e.versions;if(t&&t.includes("r0.6.0"))return!1;const r=e.unstable_features;return!r||void 0===r["m.require_identity_server"]||r["m.require_identity_server"]},N.prototype.doesServerAcceptIdentityAccessToken=async function(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,r=e.unstable_features;return t&&t.includes("r0.6.0")||r&&r["m.id_access_token"]},N.prototype.doesServerSupportSeparateAddAndBind=async function(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,r=e.unstable_features;return t&&t.includes("r0.6.0")||r&&r["m.separate_add_and_bind"]},N.prototype.doesServerSupportUnstableFeature=async function(e){const t=await this.getVersions();if(!t)return!1;const r=t.unstable_features;return r&&!!r[e]},N.prototype.doesServerForceEncryptionForPreset=async function(e){const t=await this.getVersions();if(!t)return!1;const r=t.unstable_features;return r&&!!r[`io.element.e2ee_forced.${e}`]},N.prototype.hasLazyLoadMembersEnabled=function(){return!!this._clientOpts.lazyLoadMembers},N.prototype.setCanResetTimelineCallback=function(e){this._canResetTimelineCallback=e},N.prototype.getCanResetTimelineCallback=function(){return this._canResetTimelineCallback},N.prototype.relations=async function(e,t,r,n,i={}){const s=function(e,t,r){return"m.reaction"===r?r:e.isRoomEncrypted(t)?"m.room.encrypted":r}(this,e,n),o=await this.fetchRelations(e,t,r,s,i),a=this.getEventMapper();let c;o.original_event&&(c=a(o.original_event));let l=o.chunk.map(a);if("m.room.encrypted"===s){const e=c?l.concat(c):l;await Promise.all(e.map((e=>new Promise((t=>e.once("Event.decrypted",t)))))),l=l.filter((e=>e.getType()===n))}return c&&"m.replace"===r&&(l=l.filter((e=>e.getSender()===c.getSender()))),{originalEvent:c,events:l,nextBatch:o.next_batch}},N.prototype.getEventMapper=function(e){return G(this,e)},N.prototype.getCrossSigningCacheCallbacks=function(){return this._crypto&&this._crypto._crossSigningInfo.getCacheCallbacks()},N.prototype.generateClientSecret=function(){return(0,T.randomString)(32)}},4656:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeHtmlMessage=function(e,t){return{msgtype:"m.text",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlNotice=function(e,t){return{msgtype:"m.notice",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlEmote=function(e,t){return{msgtype:"m.emote",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeTextMessage=function(e){return{msgtype:"m.text",body:e}},t.makeNotice=function(e){return{msgtype:"m.notice",body:e}},t.makeEmoteMessage=function(e){return{msgtype:"m.emote",body:e}}},3667:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=function(e,t,r,n,s,o){if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return o?t:"";let a=t.slice(6),c="/_matrix/media/r0/download/";const l={};r&&(l.width=Math.round(r)),n&&(l.height=Math.round(n)),s&&(l.method=s),i.keys(l).length>0&&(c="/_matrix/media/r0/thumbnail/");const u=a.indexOf("#");let h="";return u>=0&&(h=a.substr(u),a=a.substr(0,u)),e+c+a+(0===i.keys(l).length?"":"?"+i.encodeParams(l))+h};var i=n(r(3102))},3075:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:async function(r,i){const s=await new Promise((t=>e.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(n=>{e.getSecretStorePrivateKey(n,t,r)}))));if(s&&s.ciphertext){const e=Buffer.from(t._pickleKey),i=await(0,a.decryptAES)(s,e,r);return(0,n.decodeBase64)(i)}return s},storeCrossSigningKeyCache:async function(r,i){if(!(i instanceof Uint8Array))throw new Error(`storeCrossSigningKeyCache expects Uint8Array, got ${i}`);const s=Buffer.from(t._pickleKey);return i=await(0,a.encryptAES)((0,n.encodeBase64)(i),s,r),e.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.storeSecretStorePrivateKey(t,r,i)}))}}},t.requestKeysDuringVerification=async function(e,t,r){if(e.getUserId()===t)return s.logger.log("Cross-signing: Self-verification done; requesting keys"),new Promise(((t,i)=>{const o=e,a=o._crypto._crossSigningInfo,c=new l(a.userId,{getCrossSigningKey:async e=>{s.logger.debug("Cross-signing: requesting secret",e,r);const{promise:t}=o.requestSecret(`m.cross_signing.${e}`,[r]),i=await t,a=(0,n.decodeBase64)(i);return Uint8Array.from(a)}},a._cacheCallbacks);c.keys=a.keys;const u=new Promise(((e,t)=>{setTimeout(e,6e4,new Error("Timeout"))})),h=new Promise((async e=>{if(!await o._crypto.getSessionBackupPrivateKey()){s.logger.info("No cached backup key found. Requesting...");const e=o.requestSecret("m.megolm_backup.v1",[r]),t=await e.promise;s.logger.info("Got key backup key, decoding...");const i=(0,n.decodeBase64)(t);s.logger.info("Decoded backup key, storing..."),o._crypto.storeSessionBackupPrivateKey(Uint8Array.from(i)),s.logger.info("Backup key stored. Starting backup restore...");const a=await o.getKeyBackupVersion();o.restoreKeyBackupWithCache(void 0,void 0,a).then((()=>{s.logger.info("Backup restored.")}))}e()}));return Promise.race([Promise.all([c.getCrossSigningKey("master"),c.getCrossSigningKey("self_signing"),c.getCrossSigningKey("user_signing"),h]),u]).then(t,i)})).catch((e=>{s.logger.warn("Cross-signing: failure while requesting keys:",e)}))},t.DeviceTrustLevel=t.UserTrustLevel=t.CrossSigningLevel=t.CrossSigningInfo=void 0;var n=r(2772),i=r(7187),s=r(7434),o=r(7585),a=r(2611);function c(e){return Object.values(e.keys)[0]}class l extends i.EventEmitter{constructor(e,t,r){super(),Object.defineProperty(this,"userId",{enumerable:!0,value:e}),this._callbacks=t||{},this._cacheCallbacks=r||{},this.keys={},this.firstUse=!0,this.crossSigningVerifiedBefore=!1}static fromStorage(e,t){const r=new l(t);for(const t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}async getCrossSigningKey(e,t){const n=["master","self_signing","user_signing"].indexOf(e)>=0;if(!this._callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function i(e){if(!e)return;const n=new r.g.Olm.PkSigning,i=n.init_with_seed(e);if(i===t)return[i,n];n.free()}let s;void 0===t&&(t=this.getId(e)),this._cacheCallbacks.getCrossSigningKeyCache&&n&&(s=await this._cacheCallbacks.getCrossSigningKeyCache(e,t));const o=i(s);if(o)return o;s=await this._callbacks.getCrossSigningKey(e,t);const a=i(s);if(a)return this._cacheCallbacks.storeCrossSigningKeyCache&&n&&await this._cacheCallbacks.storeCrossSigningKeyCache(e,s),a;if(!s)throw new Error("getCrossSigningKey callback for "+e+" returned falsey");throw new Error("Key type "+e+" from getCrossSigningKey callback did not match")}async isStoredInSecretStorage(e){const t=await e.isStored("m.cross_signing.master",!1)||{};function r(e){for(const r of Object.keys(t))e[r]||delete t[r]}for(const t of["self_signing","user_signing"])r(await e.isStored(`m.cross_signing.${t}`,!1)||{});return Object.keys(t).length?t:null}static async storeInSecretStorage(e,t){for(const[r,i]of e){const e=(0,n.encodeBase64)(i);await t.store(`m.cross_signing.${r}`,e)}}static async getFromSecretStorage(e,t){const r=await t.get(`m.cross_signing.${e}`);return r?(0,n.decodeBase64)(r):null}async isStoredInKeyCache(e){const t=this._cacheCallbacks;if(!t)return!1;const r=e?[e]:["master","self_signing","user_signing"];for(const e of r)if(!await t.getCrossSigningKeyCache(e))return!1;return!0}async getCrossSigningKeysFromCache(){const e=new Map,t=this._cacheCallbacks;if(!t)return e;for(const r of["master","self_signing","user_signing"]){const n=await t.getCrossSigningKeyCache(r);n&&e.set(r,n)}return e}getId(e){return e=e||"master",this.keys[e]?c(this.keys[e]):null}async resetKeys(e){if(!this._callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===e||e&u.MASTER||!this.keys.master)e=u.MASTER|u.USER_SIGNING|u.SELF_SIGNING;else if(0===e)return;const t={},i={};let s,o;try{if(e&u.MASTER?(s=new r.g.Olm.PkSigning,t.master=s.generate_seed(),o=s.init_with_seed(t.master),i.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+o]:o}}):[o,s]=await this.getCrossSigningKey("master"),e&u.SELF_SIGNING){const e=new r.g.Olm.PkSigning;try{t.self_signing=e.generate_seed();const r=e.init_with_seed(t.self_signing);i.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+r]:r}},(0,n.pkSign)(i.self_signing,s,this.userId,o)}finally{e.free()}}if(e&u.USER_SIGNING){const e=new r.g.Olm.PkSigning;try{t.user_signing=e.generate_seed();const r=e.init_with_seed(t.user_signing);i.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+r]:r}},(0,n.pkSign)(i.user_signing,s,this.userId,o)}finally{e.free()}}Object.assign(this.keys,i),this._callbacks.saveCrossSigningKeys(t)}finally{s&&s.free()}}clearKeys(){this.keys={}}setKeys(e){const t={};if(e.master){if(e.master.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw s.logger.error(t),new Error(t)}this.keys.master?c(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}const r=c(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw s.logger.error(t),new Error(t)}try{(0,n.pkVerify)(e.user_signing,r,this.userId)}catch(e){throw s.logger.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw s.logger.error(t),new Error(t)}try{(0,n.pkVerify)(e.self_signing,r,this.userId)}catch(e){throw s.logger.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}async signObject(e,t){if(!this.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");const[r,i]=await this.getCrossSigningKey(t);try{return(0,n.pkSign)(e,i,this.userId,r),e}finally{i.free()}}async signUser(e){if(this.keys.user_signing)return this.signObject(e.keys.master,"user_signing");s.logger.info("No user signing key: not signing user")}async signDevice(e,t){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing");s.logger.info("No self signing key: not signing device")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new h(!0,!0,this.firstUse);if(!this.keys.user_signing)return new h(!1,!1,e.firstUse);let t;const r=e.keys.master,i=this.getId("user_signing");try{(0,n.pkVerify)(r,i,this.userId),t=!0}catch(e){t=!1}return new h(t,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,t,r,i){const s=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new d(!1,!1,r,i);const a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,n.pkVerify)(o,e.getId(),e.userId),(0,n.pkVerify)(a,c(o),e.userId),d.fromUserTrustLevel(s,r,i)}catch(e){return new d(!1,!1,r,i)}}getCacheCallbacks(){return this._cacheCallbacks}}t.CrossSigningInfo=l;const u={MASTER:4,USER_SIGNING:2,SELF_SIGNING:1};t.CrossSigningLevel=u;class h{constructor(e,t,r){this._crossSigningVerified=e,this._crossSigningVerifiedBefore=t,this._tofu=r}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this._crossSigningVerified}wasCrossSigningVerified(){return this._crossSigningVerifiedBefore}isTofu(){return this._tofu}}t.UserTrustLevel=h;class d{constructor(e,t,r,n){this._crossSigningVerified=e,this._tofu=t,this._localVerified=r,this._trustCrossSignedDevices=n}static fromUserTrustLevel(e,t,r){return new d(e._crossSigningVerified,e._tofu,t,r)}isVerified(){return Boolean(this.isLocallyVerified()||this._trustCrossSignedDevices&&this.isCrossSigningVerified())}isCrossSigningVerified(){return this._crossSigningVerified}isLocallyVerified(){return this._localVerified}isTofu(){return this._tofu}}t.DeviceTrustLevel=d},6670:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceList=void 0;var i=r(7187),s=r(7434),o=r(3272),a=r(3075),c=n(r(2772)),l=r(7585),u=r(3102);class h extends i.EventEmitter{constructor(e,t,r){super(),this._cryptoStore=t,this._devices={},this._crossSigningInfo={},this._userByIdentityKey={},this._deviceTrackingStatus={},this._syncToken=null,this._serialiser=new d(e,r,this),this._keyDownloadsInProgressByUser={},this._dirty=!1,this._savePromise=null,this._resolveSavePromise=null,this._savePromiseTime=null,this._saveTimer=null,this._hasFetched=null}async load(){await this._cryptoStore.doTxn("readonly",[l.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this._cryptoStore.getEndToEndDeviceData(e,(e=>{this._hasFetched=Boolean(e&&e.devices),this._devices=e?e.devices:{},this._crossSigningInfo=e&&e.crossSigningInfo||{},this._deviceTrackingStatus=e?e.trackingStatus:{},this._syncToken=e?e.syncToken:null,this._userByIdentityKey={};for(const e of Object.keys(this._devices)){const t=this._devices[e];for(const r of Object.keys(t)){const n=t[r].keys["curve25519:"+r];void 0!==n&&(this._userByIdentityKey[n]=e)}}}))}));for(const e of Object.keys(this._deviceTrackingStatus))2==this._deviceTrackingStatus[e]&&(this._deviceTrackingStatus[e]=1)}stop(){null!==this._saveTimer&&clearTimeout(this._saveTimer)}async saveIfDirty(e){if(!this._dirty)return Promise.resolve(!1);void 0===e&&(e=500);const t=Date.now+e;this._savePromiseTime&&t<this._savePromiseTime&&(clearTimeout(this._saveTimer),this._saveTimer=null,this._savePromiseTime=null);let r=this._savePromise;if(null===r&&(r=new Promise(((e,t)=>{this._resolveSavePromise=e})),this._savePromise=r),null===this._saveTimer){const r=this._resolveSavePromise;this._savePromiseTime=t,this._saveTimer=setTimeout((()=>{s.logger.log("Saving device tracking data",this._syncToken),this._savePromiseTime=null,this._saveTimer=null,this._savePromise=null,this._resolveSavePromise=null,this._cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this._cryptoStore.storeEndToEndDeviceData({devices:this._devices,crossSigningInfo:this._crossSigningInfo,trackingStatus:this._deviceTrackingStatus,syncToken:this._syncToken},e)})).then((()=>{this._dirty=!1,r()}),(e=>{s.logger.error("Failed to save device tracking data",this._syncToken),s.logger.error(e)}))}),e)}return r}getSyncToken(){return this._syncToken}setSyncToken(e){this._syncToken=e}downloadKeys(e,t){const r=[],n=[];if(e.forEach((e=>{const i=this._deviceTrackingStatus[e];this._keyDownloadsInProgressByUser[e]?(s.logger.log(`downloadKeys: already have a download in progress for ${e}: awaiting its result`),n.push(this._keyDownloadsInProgressByUser[e])):(t||3!=i)&&r.push(e)})),0!=r.length){s.logger.log("downloadKeys: downloading for",r);const e=this._doKeyDownload(r);n.push(e)}return 0===n.length&&s.logger.log("downloadKeys: already have all necessary keys"),Promise.all(n).then((()=>this._getDevicesFromStore(e)))}_getDevicesFromStore(e){const t={},r=this;return e.map((function(e){t[e]={},(r.getStoredDevicesForUser(e)||[]).map((function(r){t[e][r.deviceId]=r}))})),t}getKnownUserIds(){return Object.keys(this._devices)}getStoredDevicesForUser(e){const t=this._devices[e];if(!t)return null;const r=[];for(const e in t)t.hasOwnProperty(e)&&r.push(o.DeviceInfo.fromStorage(t[e],e));return r}getRawStoredDevicesForUser(e){return this._devices[e]}getStoredCrossSigningForUser(e){return this._crossSigningInfo[e]?a.CrossSigningInfo.fromStorage(this._crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this._crossSigningInfo[e]=t,this._dirty=!0}getStoredDevice(e,t){const r=this._devices[e];if(r&&r[t])return o.DeviceInfo.fromStorage(r[t],t)}getUserByIdentityKey(e,t){return e!==c.OLM_ALGORITHM&&e!==c.MEGOLM_ALGORITHM?null:this._userByIdentityKey[t]}getDeviceByIdentityKey(e,t){const r=this.getUserByIdentityKey(e,t);if(!r)return null;const n=this._devices[r];if(!n)return null;for(const e in n){if(!n.hasOwnProperty(e))continue;const r=n[e];for(const n in r.keys)if(r.keys.hasOwnProperty(n)&&0===n.indexOf("curve25519:")&&r.keys[n]==t)return o.DeviceInfo.fromStorage(r,e)}return null}storeDevicesForUser(e,t){if(void 0!==this._devices[e])for(const[t,r]of Object.entries(this._devices[e])){const e=r.keys["curve25519:"+t];delete this._userByIdentityKey[e]}this._devices[e]=t;for(const[r,n]of Object.entries(t)){const t=n.keys["curve25519:"+r];this._userByIdentityKey[t]=e}this._dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this._deviceTrackingStatus[e]||(s.logger.log("Now tracking device list for "+e),this._deviceTrackingStatus[e]=1,this._dirty=!0)}stopTrackingDeviceList(e){this._deviceTrackingStatus[e]&&(s.logger.log("No longer tracking device list for "+e),this._deviceTrackingStatus[e]=0,this._dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this._deviceTrackingStatus))this._deviceTrackingStatus[e]=0;this._dirty=!0}invalidateUserDeviceList(e){this._deviceTrackingStatus[e]&&(s.logger.log("Marking device list outdated for",e),this._deviceTrackingStatus[e]=1,this._dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const t of Object.keys(this._deviceTrackingStatus))1==this._deviceTrackingStatus[t]&&e.push(t);return this._doKeyDownload(e)}_setRawStoredDevicesForUser(e,t){if(void 0!==this._devices[e])for(const[t,r]of Object.entries(this._devices[e])){const e=r.keys["curve25519:"+t];delete this._userByIdentityKey[e]}this._devices[e]=t;for(const[r,n]of Object.entries(t)){const t=n.keys["curve25519:"+r];this._userByIdentityKey[t]=e}}setRawStoredCrossSigningForUser(e,t){this._crossSigningInfo[e]=t}_doKeyDownload(e){if(0===e.length)return Promise.resolve();const t=this._serialiser.updateDevicesForUsers(e,this._syncToken).then((()=>{r(!0)}),(t=>{throw s.logger.error("Error downloading keys for "+e+":",t),r(!1),t}));e.forEach((e=>{this._keyDownloadsInProgressByUser[e]=t,1==this._deviceTrackingStatus[e]&&(this._deviceTrackingStatus[e]=2)}));const r=r=>{this.emit("crypto.willUpdateDevices",e,!this._hasFetched),e.forEach((e=>{this._dirty=!0,this._keyDownloadsInProgressByUser[e]===t?(delete this._keyDownloadsInProgressByUser[e],2==this._deviceTrackingStatus[e]&&(r?(this._deviceTrackingStatus[e]=3,s.logger.log("Device list for",e,"now up to date")):this._deviceTrackingStatus[e]=1)):s.logger.log("Another update in the queue for",e,"- not marking up-to-date")})),this.saveIfDirty(),this.emit("crypto.devicesUpdated",e,!this._hasFetched),this._hasFetched=!0};return t}}t.DeviceList=h;class d{constructor(e,t,r){this._baseApis=e,this._olmDevice=t,this._deviceList=r,this._downloadInProgress=!1,this._keyDownloadsQueuedByUser={},this._queuedQueryDeferred=null,this._syncToken=null}updateDevicesForUsers(e,t){return e.forEach((e=>{this._keyDownloadsQueuedByUser[e]=!0})),this._queuedQueryDeferred||(this._queuedQueryDeferred=(0,u.defer)()),this._syncToken=t,this._downloadInProgress?(s.logger.log("Queued key download for",e),this._queuedQueryDeferred.promise):this._doQueuedQueries()}_doQueuedQueries(){if(this._downloadInProgress)throw new Error("DeviceListUpdateSerialiser._doQueuedQueries called with request active");const e=Object.keys(this._keyDownloadsQueuedByUser);this._keyDownloadsQueuedByUser={};const t=this._queuedQueryDeferred;this._queuedQueryDeferred=null,s.logger.log("Starting key download for",e),this._downloadInProgress=!0;const r={};return this._syncToken&&(r.token=this._syncToken),this._baseApis.downloadKeysForUsers(e,r).then((async t=>{const r=t.device_keys||{},n=t.master_keys||{},i=t.self_signing_keys||{},o=t.user_signing_keys||{};for(const t of e){await(0,u.sleep)(5);try{await this._processQueryResponseForUser(t,r[t],{master:n[t],self_signing:i[t],user_signing:o[t]})}catch(e){s.logger.error(`Error processing keys for ${t}:`,e)}}})).then((()=>{s.logger.log("Completed key download for "+e),this._downloadInProgress=!1,t.resolve(),this._queuedQueryDeferred&&this._doQueuedQueries()}),(r=>{s.logger.warn("Error downloading keys for "+e+":",r),this._downloadInProgress=!1,t.reject(r)})),t.promise}async _processQueryResponseForUser(e,t,r){s.logger.log("got device keys for "+e+":",t),s.logger.log("got cross-signing keys for "+e+":",r);{const r={},n=this._deviceList.getRawStoredDevicesForUser(e);n&&Object.keys(n).forEach((e=>{const t=o.DeviceInfo.fromStorage(n[e],e);r[e]=t})),await async function(e,t,r,n,i,o){let a=!1;for(const e in r)if(r.hasOwnProperty(e)&&!(e in n)){if(t===i&&e===o){s.logger.warn(`Local device ${e} missing from sync, skipping removal`);continue}s.logger.log("Device "+t+":"+e+" has been removed"),delete r[e],a=!0}for(const i in n){if(!n.hasOwnProperty(i))continue;const o=n[i];o.user_id===t?o.device_id===i?await p(e,r,o)&&(a=!0):s.logger.warn("Mismatched device_id "+o.device_id+" in keys from "+t+":"+i):s.logger.warn("Mismatched user_id "+o.user_id+" in keys from "+t+":"+i)}return a}(this._olmDevice,e,r,t||{},this._baseApis.getUserId(),this._baseApis.deviceId);const i={};Object.keys(r).forEach((e=>{i[e]=r[e].toStorage()})),this._deviceList._setRawStoredDevicesForUser(e,i)}if(r&&(r.master||r.self_signing||r.user_signing)){const t=this._deviceList.getStoredCrossSigningForUser(e)||new a.CrossSigningInfo(e);t.setKeys(r),this._deviceList.setRawStoredCrossSigningForUser(e,t.toStorage()),this._deviceList.emit("userCrossSigningUpdated",e)}}}async function p(e,t,r){if(!r.keys)return!1;const n=r.device_id,i=r.user_id,a="ed25519:"+n,l=r.keys[a];if(!l)return s.logger.warn("Device "+i+":"+n+" has no ed25519 key"),!1;const u=r.unsigned||{},h=r.signatures||{};try{await c.verifySignature(e,r,i,n,l)}catch(e){return s.logger.warn("Unable to verify signature on device "+i+":"+n+":"+e),!1}let d;if(n in t){if(d=t[n],d.getFingerprint()!=l)return s.logger.warn("Ed25519 key for device "+i+":"+n+" has changed"),!1}else t[n]=d=new o.DeviceInfo(n);return d.keys=r.keys||{},d.algorithms=r.algorithms||[],d.unsigned=u,d.signatures=h,!0}},636:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionSetupOperation=t.EncryptionSetupBuilder=void 0;var n=r(7434),i=r(4369),s=r(7187),o=r(3075),a=r(7585),c=r(7715);t.EncryptionSetupBuilder=class{constructor(e,t){this.accountDataClientAdapter=new u(e),this.crossSigningCallbacks=new h,this.ssssCryptoCallbacks=new d(t),this._crossSigningKeys=null,this._keySignatures=null,this._keyBackupInfo=null}addCrossSigningKeys(e,t){this._crossSigningKeys={authUpload:e,keys:t}}addSessionBackup(e){this._keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this._sessionBackupPrivateKey=e}addKeySignature(e,t,r){this._keySignatures||(this._keySignatures={});const n=this._keySignatures[e]||{};this._keySignatures[e]=n,n[t]=r}setAccountData(e,t){return this.accountDataClientAdapter.setAccountData(e,t)}buildOperation(){const e=this.accountDataClientAdapter._values;return new l(e,this._crossSigningKeys,this._keyBackupInfo,this._keySignatures)}async persist(e){if(this._crossSigningKeys){const t=(0,o.createCryptoStoreCacheCallbacks)(e._cryptoStore,e._olmDevice);for(const e of["master","self_signing","user_signing"]){n.logger.log(`Cache ${e} cross-signing private key locally`);const r=this.crossSigningCallbacks.privateKeys.get(e);await t.storeCrossSigningKeyCache(e,r)}await e._cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e._cryptoStore.storeCrossSigningKeys(t,this._crossSigningKeys.keys)}))}this._sessionBackupPrivateKey&&await e.storeSessionBackupPrivateKey(this._sessionBackupPrivateKey)}};class l{constructor(e,t,r,n){this._accountData=e,this._crossSigningKeys=t,this._keyBackupInfo=r,this._keySignatures=n}async apply(e){const t=e._baseApis;if(this._crossSigningKeys){const r={};for(const[e,t]of Object.entries(this._crossSigningKeys.keys))r[e+"_key"]=t;await this._crossSigningKeys.authUpload((e=>t.uploadDeviceSigningKeys(e,r))),e._crossSigningInfo.setKeys(this._crossSigningKeys.keys)}if(this._accountData)for(const[e,r]of this._accountData)await t.setAccountData(e,r);this._keySignatures&&await t.uploadKeySignatures(this._keySignatures),this._keyBackupInfo&&(this._keyBackupInfo.version?await t._http.authedRequest(void 0,"PUT","/room_keys/version/"+this._keyBackupInfo.version,void 0,{algorithm:this._keyBackupInfo.algorithm,auth_data:this._keyBackupInfo.auth_data},{prefix:c.PREFIX_UNSTABLE}):await t._http.authedRequest(void 0,"POST","/room_keys/version",void 0,this._keyBackupInfo,{prefix:c.PREFIX_UNSTABLE}))}}t.EncryptionSetupOperation=l;class u extends s.EventEmitter{constructor(e){super(),this._existingValues=e,this._values=new Map}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){const t=this._values.get(e);if(t)return t;const r=this._existingValues[e];return r?r.getContent():null}setAccountData(e,t){const r=this._values.get(e);return this._values.set(e,t),Promise.resolve().then((()=>{const n=new i.MatrixEvent({type:e,content:t});this.emit("accountData",n,r)}))}}class h{constructor(){this.privateKeys=new Map}getCrossSigningKeyCache(e,t){return this.getCrossSigningKey(e,t)}storeCrossSigningKeyCache(e,t){return this.privateKeys.set(e,t),Promise.resolve()}getCrossSigningKey(e,t){return Promise.resolve(this.privateKeys.get(e))}saveCrossSigningKeys(e){for(const[t,r]of Object.entries(e))this.privateKeys.set(t,r)}}class d{constructor(e){this._privateKeys=new Map,this._delegateCryptoCallbacks=e}async getSecretStorageKey({keys:e},t){for(const t of Object.keys(e)){const e=this._privateKeys.get(t);if(e)return[t,e]}if(this._delegateCryptoCallbacks){const r=await this._delegateCryptoCallbacks.getSecretStorageKey({keys:e},t);if(r){const[e,t]=r;this._privateKeys.set(e,t)}return r}}addPrivateKey(e,t,r){this._privateKeys.set(e,r),this._delegateCryptoCallbacks&&this._delegateCryptoCallbacks.cacheSecretStorageKey&&this._delegateCryptoCallbacks.cacheSecretStorageKey(e,t,r)}}},2573:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.OlmDevice=c,t.WITHHELD_MESSAGES=void 0;var i=r(7434),s=r(7585),o=n(r(1994));function a(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152){const t=new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is 49152 bytes.");throw t.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"},t}}function c(e){this._cryptoStore=e,this._pickleKey="DEFAULT_KEY",this.deviceCurve25519Key=null,this.deviceEd25519Key=null,this._maxOneTimeKeys=null,this._outboundGroupSessionStore={},this._inboundGroupSessionMessageIndexes={},this._sessionsInProgress={},this._olmPrekeyPromise=Promise.resolve()}c.prototype.init=async function(e={}){let t;const n=new r.g.Olm.Account,{pickleKey:o,fromExportedDevice:a}=e;try{a?(o&&i.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this._pickleKey=a.pickleKey,await async function(e,t,r,n){await t.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(r=>{t.storeAccount(r,e.pickledAccount),e.sessions.forEach((e=>{const{deviceKey:n,sessionId:i}=e,s={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};t.storeEndToEndSession(n,i,s,r)}))})),n.unpickle(r,e.pickledAccount)}(a,this._cryptoStore,this._pickleKey,n)):(o&&(this._pickleKey=o),await async function(e,t,r){await e.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(n=>{e.getAccount(n,(i=>{null!==i?r.unpickle(t,i):(r.create(),i=r.pickle(t),e.storeAccount(n,i))}))}))}(this._cryptoStore,this._pickleKey,n)),t=JSON.parse(n.identity_keys()),this._maxOneTimeKeys=n.max_number_of_one_time_keys()}finally{n.free()}this.deviceCurve25519Key=t.curve25519,this.deviceEd25519Key=t.ed25519},c.getOlmVersion=function(){return r.g.Olm.get_library_version()},c.prototype._getAccount=function(e,t){this._cryptoStore.getAccount(e,(e=>{const n=new r.g.Olm.Account;try{n.unpickle(this._pickleKey,e),t(n)}finally{n.free()}}))},c.prototype._storeAccount=function(e,t){this._cryptoStore.storeAccount(e,t.pickle(this._pickleKey))},c.prototype.export=async function(){const e={pickleKey:this._pickleKey};return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this._cryptoStore.getAccount(t,(t=>{e.pickledAccount=t})),e.sessions=[],this._cryptoStore.getAllEndToEndSessions(t,(t=>{e.sessions.push(t)}))})),e},c.prototype._getSession=function(e,t,r,n){this._cryptoStore.getEndToEndSession(e,t,r,(e=>{this._unpickleSession(e,n)}))},c.prototype._unpickleSession=function(e,t){const n=new r.g.Olm.Session;try{n.unpickle(this._pickleKey,e.session),t(Object.assign({},e,{session:n}))}finally{n.free()}},c.prototype._saveSession=function(e,t,r){const n=t.session.session_id(),i=Object.assign(t,{session:t.session.pickle(this._pickleKey)});this._cryptoStore.storeEndToEndSession(e,n,i,r)},c.prototype._getUtility=function(e){const t=new r.g.Olm.Utility;try{return e(t)}finally{t.free()}},c.prototype.sign=async function(e){let t;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(r=>{this._getAccount(r,(r=>{t=r.sign(e)}))})),t},c.prototype.getOneTimeKeys=async function(){let e;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._getAccount(t,(t=>{e=JSON.parse(t.one_time_keys())}))})),e},c.prototype.maxNumberOfOneTimeKeys=function(){return this._maxOneTimeKeys},c.prototype.markKeysAsPublished=async function(){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this._getAccount(e,(t=>{t.mark_keys_as_published(),this._storeAccount(e,t)}))}))},c.prototype.generateOneTimeKeys=function(e){return this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._getAccount(t,(r=>{r.generate_one_time_keys(e),this._storeAccount(t,r)}))}))},c.prototype.generateFallbackKey=async function(){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this._getAccount(e,(t=>{t.generate_fallback_key(),this._storeAccount(e,t)}))}))},c.prototype.getFallbackKey=async function(){let e;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._getAccount(t,(t=>{e=JSON.parse(t.fallback_key())}))})),e},c.prototype.createOutboundSession=async function(e,t){let n;return await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(i=>{this._getAccount(i,(s=>{const o=new r.g.Olm.Session;try{o.create_outbound(s,e,t),n=o.session_id(),this._storeAccount(i,s);const r={session:o,lastReceivedMessageTs:Date.now()};this._saveSession(e,r,i)}finally{o.free()}}))}),i.logger.withPrefix("[createOutboundSession]")),n},c.prototype.createInboundSession=async function(e,t,n){if(0!==t)throw new Error("Need messageType == 0 to create inbound session");let o;return await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(i=>{this._getAccount(i,(s=>{const a=new r.g.Olm.Session;try{a.create_inbound_from(s,e,n),s.remove_one_time_keys(a),this._storeAccount(i,s);const r=a.decrypt(t,n),c={session:a,lastReceivedMessageTs:Date.now()};this._saveSession(e,c,i),o={payload:r,session_id:a.session_id()}}finally{a.free()}}))}),i.logger.withPrefix("[createInboundSession]")),o},c.prototype.getSessionIdsForDevice=async function(e){const t=i.logger.withPrefix("[getSessionIdsForDevice]");if(this._sessionsInProgress[e]){t.debug(`Waiting for Olm session for ${e} to be created`);try{await this._sessionsInProgress[e]}catch(e){}}let r;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this._cryptoStore.getEndToEndSessions(e,t,(e=>{r=Object.keys(e)}))}),t),r},c.prototype.getSessionIdForDevice=async function(e,t,r){const n=await this.getSessionInfoForDevice(e,t,r);if(0===n.length)return null;let i=0;for(let e=1;e<n.length;e++){const t=n[e],r=void 0===t.lastReceivedMessageTs?0:t.lastReceivedMessageTs,s=n[i],o=void 0===s.lastReceivedMessageTs?0:s.lastReceivedMessageTs;(r>o||r===o&&t.sessionId<s.sessionId)&&(i=e)}return n[i].sessionId},c.prototype.getSessionInfoForDevice=async function(e,t,r=i.logger){if(r=r.withPrefix("[getSessionInfoForDevice]"),this._sessionsInProgress[e]&&!t){r.debug(`Waiting for Olm session for ${e} to be created`);try{await this._sessionsInProgress[e]}catch(e){}}const n=[];return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this._cryptoStore.getEndToEndSessions(e,t,(e=>{const t=Object.keys(e).sort();for(const r of t)this._unpickleSession(e[r],(e=>{n.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:r})}))}))}),r),n},c.prototype.encryptMessage=async function(e,t,r){let n;return a(r),await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_SESSIONS],(s=>{this._getSession(e,t,s,(o=>{const a=o.session.describe();i.logger.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+a),n=o.session.encrypt(r),this._saveSession(e,o,s)}))}),i.logger.withPrefix("[encryptMessage]")),n},c.prototype.decryptMessage=async function(e,t,r,n){let o;return await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_SESSIONS],(s=>{this._getSession(e,t,s,(a=>{const c=a.session.describe();i.logger.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+c),o=a.session.decrypt(r,n),a.lastReceivedMessageTs=Date.now(),this._saveSession(e,a,s)}))}),i.logger.withPrefix("[decryptMessage]")),o},c.prototype.matchesSession=async function(e,t,r,n){if(0!==r)return!1;let o;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_SESSIONS],(r=>{this._getSession(e,t,r,(e=>{o=e.session.matches_inbound(n)}))}),i.logger.withPrefix("[matchesSession]")),o},c.prototype.recordSessionProblem=async function(e,t,r){await this._cryptoStore.storeEndToEndSessionProblem(e,t,r)},c.prototype.sessionMayHaveProblems=async function(e,t){return await this._cryptoStore.getEndToEndSessionProblem(e,t)},c.prototype.filterOutNotifiedErrorDevices=async function(e){return await this._cryptoStore.filterOutNotifiedErrorDevices(e)},c.prototype._saveOutboundGroupSession=function(e){const t=e.pickle(this._pickleKey);this._outboundGroupSessionStore[e.session_id()]=t},c.prototype._getOutboundGroupSession=function(e,t){const n=this._outboundGroupSessionStore[e];if(void 0===n)throw new Error("Unknown outbound group session "+e);const i=new r.g.Olm.OutboundGroupSession;try{return i.unpickle(this._pickleKey,n),t(i)}finally{i.free()}},c.prototype.createOutboundGroupSession=function(){const e=new r.g.Olm.OutboundGroupSession;try{return e.create(),this._saveOutboundGroupSession(e),e.session_id()}finally{e.free()}},c.prototype.encryptGroupMessage=function(e,t){const r=this;return i.logger.log(`encrypting msg with megolm session ${e}`),a(t),this._getOutboundGroupSession(e,(function(e){const n=e.encrypt(t);return r._saveOutboundGroupSession(e),n}))},c.prototype.getOutboundGroupSessionKey=function(e){return this._getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))},c.prototype._unpickleInboundGroupSession=function(e,t){const n=new r.g.Olm.InboundGroupSession;try{return n.unpickle(this._pickleKey,e.session),t(n)}finally{n.free()}},c.prototype._getInboundGroupSession=function(e,t,r,n,i){this._cryptoStore.getEndToEndInboundGroupSession(t,r,n,((t,r)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this._unpickleInboundGroupSession(t,(e=>{i(e,t,r)}))}else i(null,null,r)}))},c.prototype.addInboundGroupSession=async function(e,t,n,o,a,c,l,u={}){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this._getInboundGroupSession(e,t,o,s,((h,d)=>{const p=new r.g.Olm.InboundGroupSession;try{if(l?p.import_session(a):p.create(a),o!=p.session_id())throw new Error("Mismatched group session ID from senderKey: "+t);if(h&&(i.logger.log("Update for megolm session "+t+"/"+o),h.first_known_index()<=p.first_known_index()&&(h.first_known_index()!=p.first_known_index()||u.untrusted||!d.untrusted)))return void i.logger.log(`Keeping existing megolm session ${o}`);i.logger.info("Storing megolm session "+t+"/"+o+" with first index "+p.first_known_index());const r=Object.assign({},u,{room_id:e,session:p.pickle(this._pickleKey),keysClaimed:c,forwardingCurve25519KeyChain:n});this._cryptoStore.storeEndToEndInboundGroupSession(t,o,r,s)}finally{p.free()}}))}),i.logger.withPrefix("[addInboundGroupSession]"))},c.prototype.addInboundGroupSessionWithheld=async function(e,t,r,n,i){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this._cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,r,{room_id:e,code:n,reason:i},s)}))};const l={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function u(e){return e.code&&e.code in l?l[e.code]:e.reason?e.reason:"decryption key withheld"}t.WITHHELD_MESSAGES=l,c.prototype.decryptGroupMessage=async function(e,t,r,n,a,c){let l,h;if(await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(i=>{this._getInboundGroupSession(e,t,r,i,((e,s,d)=>{if(null===e)return d&&(h=new o.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",u(d),{session:t+"|"+r})),void(l=null);let p;try{p=e.decrypt(n)}catch(e){return void(h=e&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.message&&d?new o.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",u(d),{session:t+"|"+r}):e)}let f=p.plaintext;if(void 0===f)f=p;else{const e=t+"|"+r+"|"+p.message_index;if(e in this._inboundGroupSessionMessageIndexes){const t=this._inboundGroupSessionMessageIndexes[e];if(t.id!==a||t.timestamp!==c)return void(h=new Error("Duplicate message index, possible replay attack: "+e))}this._inboundGroupSessionMessageIndexes[e]={id:a,timestamp:c}}s.session=e.pickle(this._pickleKey),this._cryptoStore.storeEndToEndInboundGroupSession(t,r,s,i),l={result:f,keysClaimed:s.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:s.forwardingCurve25519KeyChain||[],untrusted:s.untrusted}}))}),i.logger.withPrefix("[decryptGroupMessage]")),h)throw h;return l},c.prototype.hasInboundSessionKeys=async function(e,t,r){let n;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this._cryptoStore.getEndToEndInboundGroupSession(t,r,s,(s=>{null!==s?e!==s.room_id?(i.logger.warn(`requested keys for inbound group session ${t}|${r}, with incorrect room_id (expected ${s.room_id}, was ${e})`),n=!1):n=!0:n=!1}))}),i.logger.withPrefix("[hasInboundSessionKeys]")),n},c.prototype.getInboundGroupSessionKey=async function(e,t,r,n){let o;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(i=>{this._getInboundGroupSession(e,t,r,i,((e,t)=>{if(null===e)return void(o=null);void 0===n&&(n=e.first_known_index());const r=e.export_session(n),i=(t.keysClaimed||{}).ed25519||null;o={chain_index:n,key:r,forwarding_curve25519_key_chain:t.forwardingCurve25519KeyChain||[],sender_claimed_ed25519_key:i}}))}),i.logger.withPrefix("[getInboundGroupSessionKey]")),o},c.prototype.exportInboundGroupSession=function(e,t,r){return this._unpickleInboundGroupSession(r,(n=>{const i=n.first_known_index();return{sender_key:e,sender_claimed_keys:r.keysClaimed,room_id:r.room_id,session_id:t,session_key:n.export_session(i),forwarding_curve25519_key_chain:n.forwardingCurve25519KeyChain||[],first_known_index:n.first_known_index()}}))},c.prototype.verifySignature=function(e,t,r){this._getUtility((function(n){n.ed25519_verify(e,t,r)}))}},6617:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.OutgoingRoomKeyRequestManager=t.ROOM_KEY_REQUEST_STATES=void 0;var i=r(7434),s=n(r(3102));const o={UNSENT:0,SENT:1,CANCELLATION_PENDING:2,CANCELLATION_PENDING_AND_WILL_RESEND:3};function a(e){return e.room_id+" / "+e.session_id}function c(e){return"["+s.map(e,(e=>`${e.userId}:${e.deviceId}`)).join(",")+"]"}t.ROOM_KEY_REQUEST_STATES=o,t.OutgoingRoomKeyRequestManager=class{constructor(e,t,r){this._baseApis=e,this._deviceId=t,this._cryptoStore=r,this._sendOutgoingRoomKeyRequestsTimer=null,this._sendOutgoingRoomKeyRequestsRunning=!1,this._clientRunning=!1}start(){this._clientRunning=!0}stop(){i.logger.log("stopping OutgoingRoomKeyRequestManager"),this._clientRunning=!1}sendQueuedRequests(){this._startTimer()}async queueRoomKeyRequest(e,t,r=!1){const n=await this._cryptoStore.getOutgoingRoomKeyRequest(e);if(n)switch(n.state){case o.CANCELLATION_PENDING_AND_WILL_RESEND:case o.UNSENT:return;case o.CANCELLATION_PENDING:{const e=r?o.CANCELLATION_PENDING_AND_WILL_RESEND:o.SENT;await this._cryptoStore.updateOutgoingRoomKeyRequest(n.requestId,o.CANCELLATION_PENDING,{state:e,cancellationTxnId:this._baseApis.makeTxnId()});break}case o.SENT:if(r){const s=o.CANCELLATION_PENDING_AND_WILL_RESEND,a=await this._cryptoStore.updateOutgoingRoomKeyRequest(n.requestId,o.SENT,{state:s,cancellationTxnId:this._baseApis.makeTxnId(),requestTxnId:this._baseApis.makeTxnId()});if(!a)return await this.queueRoomKeyRequest(e,t,r);try{await this._sendOutgoingRoomKeyRequestCancellation(a,!0)}catch(e){i.logger.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+n.state)}else await this._cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:this._baseApis.makeTxnId(),state:o.UNSENT})}cancelRoomKeyRequest(e){return this._cryptoStore.getOutgoingRoomKeyRequest(e).then((t=>{if(t)switch(t.state){case o.CANCELLATION_PENDING:case o.CANCELLATION_PENDING_AND_WILL_RESEND:return;case o.UNSENT:return i.logger.log("deleting unnecessary room key request for "+a(e)),this._cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,o.UNSENT);case o.SENT:return this._cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,o.SENT,{state:o.CANCELLATION_PENDING,cancellationTxnId:this._baseApis.makeTxnId()}).then((t=>{t?this._sendOutgoingRoomKeyRequestCancellation(t).catch((e=>{i.logger.error("Error sending room key request cancellation; will retry later.",e),this._startTimer()})):i.logger.log("Tried to cancel room key request for "+a(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+t.state)}}))}getOutgoingSentRoomKeyRequest(e,t){return this._cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[o.SENT])}async cancelAndResendAllOutgoingRequests(){const e=await this._cryptoStore.getAllOutgoingRoomKeyRequestsByState(o.SENT);return Promise.all(e.map((({requestBody:e,recipients:t})=>this.queueRoomKeyRequest(e,t,!0))))}_startTimer(){this._sendOutgoingRoomKeyRequestsTimer||(this._sendOutgoingRoomKeyRequestsTimer=r.g.setTimeout((()=>{if(this._sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this._sendOutgoingRoomKeyRequestsRunning=!0,this._sendOutgoingRoomKeyRequests().finally((()=>{this._sendOutgoingRoomKeyRequestsRunning=!1})).catch((e=>{i.logger.warn(`error in OutgoingRoomKeyRequestManager: ${e}`)}))}),500))}_sendOutgoingRoomKeyRequests(){return this._clientRunning?this._cryptoStore.getOutgoingRoomKeyRequestByState([o.CANCELLATION_PENDING,o.CANCELLATION_PENDING_AND_WILL_RESEND,o.UNSENT]).then((e=>{if(!e)return void(this._sendOutgoingRoomKeyRequestsTimer=null);let t;switch(e.state){case o.UNSENT:t=this._sendOutgoingRoomKeyRequest(e);break;case o.CANCELLATION_PENDING:t=this._sendOutgoingRoomKeyRequestCancellation(e);break;case o.CANCELLATION_PENDING_AND_WILL_RESEND:t=this._sendOutgoingRoomKeyRequestCancellation(e,!0)}return t.then((()=>this._sendOutgoingRoomKeyRequests())).catch((e=>{i.logger.error("Error sending room key request; will retry later.",e),this._sendOutgoingRoomKeyRequestsTimer=null}))})):(this._sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}_sendOutgoingRoomKeyRequest(e){i.logger.log(`Requesting keys for ${a(e.requestBody)} from ${c(e.recipients)}(id ${e.requestId})`);const t={action:"request",requesting_device_id:this._deviceId,request_id:e.requestId,body:e.requestBody};return this._sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then((()=>this._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,o.UNSENT,{state:o.SENT})))}_sendOutgoingRoomKeyRequestCancellation(e,t){i.logger.log(`Sending cancellation for key request for ${a(e.requestBody)} to ${c(e.recipients)} (cancellation id ${e.cancellationTxnId})`);const r={action:"request_cancellation",requesting_device_id:this._deviceId,request_id:e.requestId};return this._sendMessageToDevices(r,e.recipients,e.cancellationTxnId).then((()=>t?this._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,o.CANCELLATION_PENDING_AND_WILL_RESEND,{state:o.UNSENT}):this._cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,o.CANCELLATION_PENDING)))}_sendMessageToDevices(e,t,r){const n={};for(const r of t)n[r.userId]||(n[r.userId]={}),n[r.userId][r.deviceId]=e;return this._baseApis.sendToDevice("m.room_key_request",n,r)}}},635:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var n=r(7585);t.RoomList=class{constructor(e){this._cryptoStore=e,this._roomEncryption={}}async init(){await this._cryptoStore.doTxn("readwrite",[n.IndexedDBCryptoStore.STORE_ROOMS],(e=>{this._cryptoStore.getEndToEndRooms(e,(e=>{this._roomEncryption=e}))}))}getRoomEncryption(e){return this._roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}async setRoomEncryption(e,t){this._roomEncryption[e]=t,await this._cryptoStore.doTxn("readwrite",[n.IndexedDBCryptoStore.STORE_ROOMS],(r=>{this._cryptoStore.storeEndToEndRoom(e,t,r)}))}}},4823:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.SecretStorage=t.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var i=r(7187),s=r(7434),o=n(r(2772)),a=r(8401),c=r(2611);const l="m.secret_storage.v1.aes-hmac-sha2";t.SECRET_STORAGE_ALGORITHM_V1_AES=l;class u extends i.EventEmitter{constructor(e,t){super(),this._baseApis=e,this._cryptoCallbacks=t,this._requests={},this._incomingRequests={}}async getDefaultKeyId(){const e=await this._baseApis.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise((async(t,r)=>{const n=r=>{"m.secret_storage.default_key"===r.getType()&&r.getContent().key===e&&(this._baseApis.removeListener("accountData",n),t())};this._baseApis.on("accountData",n);try{await this._baseApis.setAccountData("m.secret_storage.default_key",{key:e})}catch(e){this._baseApis.removeListener("accountData",n),r(e)}}))}async addKey(e,t,r){const n={algorithm:e};if(t||(t={}),t.name&&(n.name=t.name),e!==l)throw new Error(`Unknown key algorithm ${t.algorithm}`);if(t.passphrase&&(n.passphrase=t.passphrase),t.key){const{iv:e,mac:r}=await u._calculateKeyCheck(t.key);n.iv=e,n.mac=r}if(!r)do{r=(0,a.randomString)(32)}while(await this._baseApis.getAccountDataFromServer(`m.secret_storage.key.${r}`));return await this._baseApis.setAccountData(`m.secret_storage.key.${r}`,n),{keyId:r,keyInfo:n}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const t=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e);return t?[e,t]:null}async hasKey(e){return!!await this.getKey(e)}async checkKey(e,t){if(t.algorithm===l){if(t.mac){const{mac:r}=await u._calculateKeyCheck(e,t.iv);return t.mac.replace(/=+$/g,"")===r.replace(/=+$/g,"")}return!0}throw new Error("Unknown algorithm")}static async _calculateKeyCheck(e,t){return await(0,c.encryptAES)("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",e,"",t)}async store(e,t,r){const n={};if(!r){const e=await this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");r=[e]}if(0===r.length)throw new Error("Zero keys given to encrypt with!");for(const i of r){const r=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+i);if(!r)throw new Error("Unknown key: "+i);if(r.algorithm===l){const s={[i]:r},[,o]=await this._getSecretStorageKey(s,e);n[i]=await o.encrypt(t)}else s.logger.warn("unknown algorithm for secret storage key "+i+": "+r.algorithm)}await this._baseApis.setAccountData(e,{encrypted:n})}async _fixupStoredSecret(e,t){const r=Object.keys(t);return 1===r.length&&"encrypted"!==r[0]&&t[r[0]].passthrough&&await this.hasKey(r[0])?(s.logger.log("Fixing up passthrough secret: "+e),await this.storePassthrough(e,r[0]),await this._baseApis.getAccountDataFromServer(e)):null}async get(e){let t=await this._baseApis.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted&&(t=await this._fixupStoredSecret(e,t),!t||!t.encrypted))throw new Error("Content is not encrypted!");const r={};for(const e of Object.keys(t.encrypted)){const n=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e),i=t.encrypted[e];n.algorithm===l&&i.iv&&i.ciphertext&&i.mac&&(r[e]=n)}if(0===Object.keys(r).length)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);let n,i;try{[n,i]=await this._getSecretStorageKey(r,e);const s=t.encrypted[n];return s.passthrough?(0,o.encodeBase64)(i.get_private_key()):await i.decrypt(s)}finally{i&&i.free&&i.free()}}async isStored(e,t){let r=await this._baseApis.getAccountDataFromServer(e);if(!r)return null;if(!r.encrypted&&(r=await this._fixupStoredSecret(e,r),!r||!r.encrypted))return null;void 0===t&&(t=!0);const n={};for(const e of Object.keys(r.encrypted)){const t=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e);if(!t)continue;const i=r.encrypted[e];t.algorithm===l&&i.iv&&i.ciphertext&&i.mac&&(n[e]=t)}return Object.keys(n).length?n:null}request(e,t){const r=this._baseApis.makeTxnId(),n=this._requests[r]={name:e,devices:t},i=new Promise(((e,t)=>{n.resolve=e,n.reject=t})),o={name:e,action:"request",requesting_device_id:this._baseApis.deviceId,request_id:r},a={};for(const e of t)a[e]=o;return s.logger.info(`Request secret ${e} from ${t}, id ${r}`),this._baseApis.sendToDevice("m.secret.request",{[this._baseApis.getUserId()]:a}),{request_id:r,promise:i,cancel:e=>{const i={action:"request_cancellation",requesting_device_id:this._baseApis.deviceId,request_id:r},s={};for(const e of t)s[e]=i;this._baseApis.sendToDevice("m.secret.request",{[this._baseApis.getUserId()]:s}),n.reject(new Error(e||"Cancelled"))}}}async _onRequestReceived(e){const t=e.getSender(),r=e.getContent();if(t!==this._baseApis.getUserId()||!(r.name&&r.action&&r.requesting_device_id&&r.request_id))return;const n=r.requesting_device_id;if("request_cancellation"===r.action)this._incomingRequests[n]&&this._incomingRequests[n][r.request_id]&&(s.logger.info("received request cancellation for secret ("+t+", "+n+", "+r.request_id+")"),this.baseApis.emit("crypto.secrets.requestCancelled",{user_id:t,device_id:n,request_id:r.request_id}));else if("request"===r.action){if(n===this._baseApis.deviceId)return;if(s.logger.info("received request for secret ("+t+", "+n+", "+r.request_id+")"),!this._cryptoCallbacks.onSecretRequested)return;const e=await this._cryptoCallbacks.onSecretRequested(t,n,r.request_id,r.name,this._baseApis.checkDeviceTrust(t,n));if(e){s.logger.info(`Preparing ${r.name} secret for ${n}`);const i={type:"m.secret.send",content:{request_id:r.request_id,secret:e}},a={algorithm:o.OLM_ALGORITHM,sender_key:this._baseApis._crypto._olmDevice.deviceCurve25519Key,ciphertext:{}};await o.ensureOlmSessionsForDevices(this._baseApis._crypto._olmDevice,this._baseApis,{[t]:[this._baseApis.getStoredDevice(t,n)]}),await o.encryptMessageForDevice(a.ciphertext,this._baseApis.getUserId(),this._baseApis.deviceId,this._baseApis._crypto._olmDevice,t,this._baseApis.getStoredDevice(t,n),i);const c={[t]:{[n]:a}};s.logger.info(`Sending ${r.name} secret for ${n}`),this._baseApis.sendToDevice("m.room.encrypted",c)}else s.logger.info(`Request denied for ${r.name} secret for ${n}`)}}_onSecretReceived(e){if(e.getSender()!==this._baseApis.getUserId())return;const t=e.getContent();s.logger.log("got secret share for request",t.request_id);const r=this._requests[t.request_id];if(r){const n=this._baseApis._crypto._deviceList.getDeviceByIdentityKey(o.OLM_ALGORITHM,e.getSenderKey());if(!n)return void s.logger.log("secret share from unknown device with key",e.getSenderKey());if(!r.devices.includes(n.deviceId))return void s.logger.log("unsolicited secret share from device",n.deviceId);s.logger.log(`Successfully received secret ${r.name} from ${n.deviceId}`),r.resolve(t.secret)}}async _getSecretStorageKey(e,t){if(!this._cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const r=await this._cryptoCallbacks.getSecretStorageKey({keys:e},t);if(!r)throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[n,i]=r;if(!e[n])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[n].algorithm===l)return[n,{encrypt:async function(e){return await(0,c.encryptAES)(e,i,t)},decrypt:async function(e){return await(0,c.decryptAES)(e,i,t)}}];throw new Error("Unknown key type: "+e[n].algorithm)}}t.SecretStorage=u},2611:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAES=function(...e){return s?async function(e,t,r,n){let o;n?o=(0,i.decodeBase64)(n):(o=new Uint8Array(16),window.crypto.getRandomValues(o)),o[8]&=127;const[a,l]=await c(t,r),u=(new TextEncoder).encode(e),h=await s.encrypt({name:"AES-CTR",counter:o,length:64},a,u),d=await s.sign({name:"HMAC"},l,h);return{iv:(0,i.encodeBase64)(o),ciphertext:(0,i.encodeBase64)(h),mac:(0,i.encodeBase64)(d)}}(...e):async function(e,t,r,s){const o=(0,n.getCrypto)();if(!o)throw new Error("No usable crypto implementation");let c;c=s?(0,i.decodeBase64)(s):o.randomBytes(16),c[8]&=127;const[l,u]=a(t,r),h=o.createCipheriv("aes-256-ctr",l,c),d=h.update(e,"utf-8","base64")+h.final("base64"),p=o.createHmac("sha256",u).update(d,"base64").digest("base64");return{iv:(0,i.encodeBase64)(c),ciphertext:d,mac:p}}(...e)},t.decryptAES=function(...e){return s?async function(e,t,r){const[n,o]=await c(t,r),a=(0,i.decodeBase64)(e.ciphertext);if(!await s.verify({name:"HMAC"},o,(0,i.decodeBase64)(e.mac),a))throw new Error(`Error decrypting secret ${r}: bad MAC`);const l=await s.decrypt({name:"AES-CTR",counter:(0,i.decodeBase64)(e.iv),length:64},n,a);return(new TextDecoder).decode(new Uint8Array(l))}(...e):async function(e,t,r){const s=(0,n.getCrypto)();if(!s)throw new Error("No usable crypto implementation");const[o,c]=a(t,r);if(s.createHmac("sha256",c).update(e.ciphertext,"base64").digest("base64").replace(/=+$/g,"")!==e.mac.replace(/=+$/g,""))throw new Error(`Error decrypting secret ${r}: bad MAC`);const l=s.createDecipheriv("aes-256-ctr",o,(0,i.decodeBase64)(e.iv));return l.update(e.ciphertext,"base64","utf-8")+l.final("utf-8")}(...e)};var n=r(3102),i=r(2772);const s="undefined"!=typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,o=new Uint8Array(8);function a(e,t){const r=(0,n.getCrypto)(),i=r.createHmac("sha256",o).update(e).digest(),s=Buffer.alloc(1,1),a=r.createHmac("sha256",i).update(t,"utf-8").update(s).digest();return s[0]=2,[a,r.createHmac("sha256",i).update(a).update(t,"utf-8").update(s).digest()]}async function c(e,t){const r=await s.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),n=await s.deriveBits({name:"HKDF",salt:o,info:(new TextEncoder).encode(t),hash:"SHA-256"},r,512),i=n.slice(0,32),a=n.slice(32),c=s.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),l=s.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return await Promise.all([c,l])}},1897:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerAlgorithm=function(e,t,i){r[e]=t,n[e]=i},t.UnknownDeviceError=t.DecryptionError=t.DecryptionAlgorithm=t.EncryptionAlgorithm=t.DECRYPTION_CLASSES=t.ENCRYPTION_CLASSES=void 0;const r={};t.ENCRYPTION_CLASSES=r;const n={};t.DECRYPTION_CLASSES=n,t.EncryptionAlgorithm=class{constructor(e){this._userId=e.userId,this._deviceId=e.deviceId,this._crypto=e.crypto,this._olmDevice=e.olmDevice,this._baseApis=e.baseApis,this._roomId=e.roomId}prepareToEncrypt(e){}onRoomMembership(e,t,r){}},t.DecryptionAlgorithm=class{constructor(e){this._userId=e.userId,this._crypto=e.crypto,this._olmDevice=e.olmDevice,this._baseApis=e.baseApis,this._roomId=e.roomId}onRoomKeyEvent(e){}importRoomKey(e){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){}};class i extends Error{constructor(e,t,r){super(t),this.code=e,this.name="DecryptionError",this.detailedString=function(e,t){let r=e.name+"[msg: "+e.message;return t&&(r+=", "+Object.keys(t).map((e=>e+": "+t[e])).join(", ")),r+="]",r}(this,r)}}t.DecryptionError=i;class s extends Error{constructor(e,t){super(e),this.name="UnknownDeviceError",this.devices=t}}t.UnknownDeviceError=s},1994:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(3072),r(7125);var n=r(1897);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))}))},7125:(e,t,r)=>{"use strict";var n=r(862),i=r(7434),s=n(r(3102)),o=n(r(2772)),a=r(1897),c=r(2573);function l(e){this.sessionId=e,this.useCount=0,this.creationTime=(new Date).getTime(),this.sharedWithDevices={},this.blockedDevicesNotified={}}function u(e){(0,s.polyfillSuper)(this,a.EncryptionAlgorithm,e),this._setupPromise=Promise.resolve(),this._outboundSessions={},this._sessionRotationPeriodMsgs=100,this._sessionRotationPeriodMs=6048e5,void 0!==e.config.rotation_period_ms&&(this._sessionRotationPeriodMs=e.config.rotation_period_ms),void 0!==e.config.rotation_period_msgs&&(this._sessionRotationPeriodMsgs=e.config.rotation_period_msgs)}function h(e){(0,s.polyfillSuper)(this,a.DecryptionAlgorithm,e),this._pendingEvents={},this.olmlib=o}l.prototype.needsRotation=function(e,t){const r=(new Date).getTime()-this.creationTime;return(this.useCount>=e||r>=t)&&(i.logger.log("Rotating megolm session after "+this.useCount+" messages, "+r+"ms"),!0)},l.prototype.markSharedWithDevice=function(e,t,r){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]=r},l.prototype.markNotifiedBlockedDevice=function(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0},l.prototype.sharedWithTooManyDevices=function(e){for(const t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return i.logger.log("Starting new megolm session because we shared with "+t),!0;for(const r in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(r)&&!e[t].hasOwnProperty(r))return i.logger.log("Starting new megolm session because we shared with "+t+":"+r),!0}},s.inherits(u,a.EncryptionAlgorithm),u.prototype._ensureOutboundSession=async function(e,t,r){let n;function s(){return n}const a=this._setupPromise.then((async s=>{n=s,n&&n.needsRotation(this._sessionRotationPeriodMsgs,this._sessionRotationPeriodMs)&&(i.logger.log("Starting new megolm session because we need to rotate."),n=null),n&&n.sharedWithTooManyDevices(e)&&(n=null),n||(i.logger.log(`Starting new megolm session for room ${this._roomId}`),n=await this._prepareNewSession(),i.logger.log(`Started new megolm session ${n.sessionId} for room ${this._roomId}`),this._outboundSessions[n.sessionId]=n);const a={};for(const[t,r]of Object.entries(e))for(const[e,i]of Object.entries(r))i.getIdentityKey()!=this._olmDevice.deviceCurve25519Key&&(n.sharedWithDevices[t]&&void 0!==n.sharedWithDevices[t][e]||(a[t]=a[t]||[],a[t].push(i)));const c=this._olmDevice.getOutboundGroupSessionKey(n.sessionId),l={type:"m.room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:this._roomId,session_id:n.sessionId,session_key:c.key,chain_index:c.chain_index}},[u,h]=await o.getExistingOlmSessions(this._olmDevice,this._baseApis,a);await Promise.all([(async()=>{i.logger.debug(`Sharing keys with existing Olm sessions in ${this._roomId}`),await this._shareKeyWithOlmSessions(n,c,l,h),i.logger.debug(`Shared keys with existing Olm sessions in ${this._roomId}`)})(),(async()=>{i.logger.debug(`Sharing keys (start phase 1) with new Olm sessions in ${this._roomId}`);const e=[],t=Date.now(),s=[];await this._shareKeyWithDevices(n,c,l,u,e,r?1e4:2e3,s),i.logger.debug(`Shared keys (end phase 1) with new Olm sessions in ${this._roomId}`),!r&&Date.now()-t<1e4?(async()=>{const t={},r=new Set;for(const e of s)r.add(e);const o=[];for(const{userId:n,deviceInfo:i}of e){const e=n.slice(n.indexOf(":")+1);r.has(e)?(t[n]=t[n]||[],t[n].push(i)):o.push({userId:n,deviceInfo:i})}i.logger.debug(`Sharing keys (start phase 2) with new Olm sessions in ${this._roomId}`),await this._shareKeyWithDevices(n,c,l,t,o,3e4),i.logger.debug(`Shared keys (end phase 2) with new Olm sessions in ${this._roomId}`),await this._notifyFailedOlmDevices(n,c,o)})():await this._notifyFailedOlmDevices(n,c,e),i.logger.debug(`Shared keys (all phases done) with new Olm sessions in ${this._roomId}`)})(),(async()=>{i.logger.debug(`Notifying blocked devices in ${this._roomId}`);const e={};let r=0;for(const[i,s]of Object.entries(t))for(const[t,o]of Object.entries(s))n.blockedDevicesNotified[i]&&void 0!==n.blockedDevicesNotified[i][t]||(e[i]=e[i]||{},e[i][t]={device:o},r++);await this._notifyBlockedDevices(n,e),i.logger.debug(`Notified ${r} blocked devices in ${this._roomId}`)})()])}));return a.catch((e=>{i.logger.error(`Failed to ensure outbound session in ${this._roomId}`,e)})),this._setupPromise=a.then(s,s),a.then(s)},u.prototype._prepareNewSession=async function(){const e=this._olmDevice.createOutboundGroupSession(),t=this._olmDevice.getOutboundGroupSessionKey(e);return await this._olmDevice.addInboundGroupSession(this._roomId,this._olmDevice.deviceCurve25519Key,[],e,t.key,{ed25519:this._olmDevice.deviceEd25519Key}),this._crypto.backupGroupSession(this._roomId,this._olmDevice.deviceCurve25519Key,[],e,t.key),new l(e)},u.prototype._getDevicesWithoutSessions=function(e,t,r){r=r||[];for(const[n,i]of Object.entries(t)){const t=e[n];for(const e of i){const i=e.deviceId;t[i].sessionId||(r.push({userId:n,deviceInfo:e}),delete t[i])}}return r},u.prototype._splitDevices=function(e){let t=[];const r=[t];for(const[n,i]of Object.entries(e)){for(const e of Object.values(i))t.push({userId:n,deviceInfo:e.device});t.length>20&&(t=[],r.push(t))}return 0===t.length&&r.pop(),r},u.prototype._encryptAndSendKeysToDevices=function(e,t,r,n){const s={},a=[];for(let e=0;e<r.length;e++){const t={algorithm:o.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}},i=r[e],c=i.userId,l=i.deviceInfo,u=l.deviceId;s[c]||(s[c]={}),s[c][u]=t,a.push(o.encryptMessageForDevice(t.ciphertext,this._userId,this._deviceId,this._olmDevice,c,l,n))}return Promise.all(a).then((()=>{for(const e of Object.keys(s)){for(const t of Object.keys(s[e]))0===Object.keys(s[e][t].ciphertext).length&&(i.logger.log("No ciphertext for device "+e+":"+t+": pruning"),delete s[e][t]);0===Object.keys(s[e]).length&&(i.logger.log("Pruned all devices for user "+e),delete s[e])}if(0!==Object.keys(s).length)return this._baseApis.sendToDevice("m.room.encrypted",s).then((()=>{for(const r of Object.keys(s))for(const n of Object.keys(s[r]))e.markSharedWithDevice(r,n,t)}));i.logger.log("No users left to send to: aborting")}))},u.prototype._sendBlockedNotificationsToDevices=async function(e,t,r){const n={};for(const e of t){const t=e.userId,i=e.deviceInfo,s=i.deviceInfo.deviceId,o=Object.assign({},r);o.code=i.code,o.reason=i.reason,"m.no_olm"===o.code&&(delete o.room_id,delete o.session_id),n[t]||(n[t]={}),n[t][s]=o}await this._baseApis.sendToDevice("org.matrix.room_key.withheld",n);for(const t of Object.keys(n))for(const r of Object.keys(n[t]))e.markNotifiedBlockedDevice(t,r)},u.prototype.reshareKeyWithDevice=async function(e,t,r,n){const s=this._outboundSessions[t];if(!s)return void i.logger.debug(`megolm session ${t} not found: not re-sharing keys`);if(void 0===s.sharedWithDevices[r])return void i.logger.debug(`megolm session ${t} never shared with user ${r}`);const a=s.sharedWithDevices[r][n.deviceId];if(void 0===a)return void i.logger.debug("megolm session ID "+t+" never shared with device "+r+":"+n.deviceId);const c=await this._olmDevice.getInboundGroupSessionKey(this._roomId,e,t,a);if(!c)return void i.logger.warn(`No inbound session key found for megolm ${t}: not re-sharing keys`);await o.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[r]:[n]});const l={type:"m.forwarded_room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:this._roomId,session_id:t,session_key:c.key,chain_index:c.chain_index,sender_key:e,sender_claimed_ed25519_key:c.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:c.forwarding_curve25519_key_chain}},u={algorithm:o.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await o.encryptMessageForDevice(u.ciphertext,this._userId,this._deviceId,this._olmDevice,r,n,l),await this._baseApis.sendToDevice("m.room.encrypted",{[r]:{[n.deviceId]:u}}),i.logger.debug(`Re-shared key for megolm session ${t} with ${r}:${n.deviceId}`)},u.prototype._shareKeyWithDevices=async function(e,t,r,n,s,a,c){i.logger.debug(`Ensuring Olm sessions for devices in ${this._roomId}`);const l=await o.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,n,a,c,i.logger.withPrefix(`[${this._roomId}]`));i.logger.debug(`Ensured Olm sessions for devices in ${this._roomId}`),this._getDevicesWithoutSessions(l,n,s),i.logger.debug(`Sharing keys with Olm sessions in ${this._roomId}`),await this._shareKeyWithOlmSessions(e,t,r,l),i.logger.debug(`Shared keys with Olm sessions in ${this._roomId}`)},u.prototype._shareKeyWithOlmSessions=async function(e,t,r,n){const s=this._splitDevices(n);for(let n=0;n<s.length;n++){const o=`megolm keys for ${e.sessionId} in ${this._roomId} (slice ${n+1}/${s.length})`;try{i.logger.debug(`Sharing ${o}`),await this._encryptAndSendKeysToDevices(e,t.chain_index,s[n],r),i.logger.debug(`Shared ${o}`)}catch(e){throw i.logger.error(`Failed to share ${o}`),e}}},u.prototype._notifyFailedOlmDevices=async function(e,t,r){i.logger.debug(`Notifying ${r.length} devices we failed to create Olm sessions in ${this._roomId}`);for(const{userId:n,deviceInfo:i}of r){const r=i.deviceId;e.markSharedWithDevice(n,r,t.chain_index)}const n=await this._olmDevice.filterOutNotifiedErrorDevices(r);i.logger.debug(`Filtered down to ${n.length} error devices in ${this._roomId}`);const s={};for(const{userId:e,deviceInfo:t}of n)s[e]=s[e]||{},s[e][t.deviceId]={device:{code:"m.no_olm",reason:c.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:t}};await this._notifyBlockedDevices(e,s),i.logger.debug(`Notified ${n.length} devices we failed to create Olm sessions in ${this._roomId}`)},u.prototype._notifyBlockedDevices=async function(e,t){const r={room_id:this._roomId,session_id:e.sessionId,algorithm:o.MEGOLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key},n=this._splitDevices(t);for(let t=0;t<n.length;t++)try{await this._sendBlockedNotificationsToDevices(e,n[t],r),i.logger.log(`Completed blacklist notification for ${e.sessionId} in ${this._roomId} (slice ${t+1}/${n.length})`)}catch(r){throw i.logger.log(`blacklist notification for ${e.sessionId} in ${this._roomId} (slice ${t+1}/${n.length}) failed`),r}},u.prototype.prepareToEncrypt=function(e){if(this.encryptionPreparation){const e=Date.now()-this.encryptionPreparationMetadata.startTime;i.logger.debug(`Already started preparing to encrypt for ${this._roomId} ${e} ms ago, skipping`)}else i.logger.debug(`Preparing to encrypt events for ${this._roomId}`),this.encryptionPreparationMetadata={startTime:Date.now()},this.encryptionPreparation=(async()=>{try{i.logger.debug(`Getting devices in ${this._roomId}`);const[t,r]=await this._getDevicesInRoom(e);this._crypto.getGlobalErrorOnUnknownDevices()&&this._removeUnknownDevices(t),i.logger.debug(`Ensuring outbound session in ${this._roomId}`),await this._ensureOutboundSession(t,r,!0),i.logger.debug(`Ready to encrypt events for ${this._roomId}`)}catch(e){i.logger.error(`Failed to prepare to encrypt events for ${this._roomId}`,e)}finally{delete this.encryptionPreparationMetadata,delete this.encryptionPreparation}})()},u.prototype.encryptMessage=async function(e,t,r){if(i.logger.log(`Starting to encrypt event for ${this._roomId}`),this.encryptionPreparation)try{await this.encryptionPreparation}catch(e){}const[n,s]=await this._getDevicesInRoom(e);this._crypto.getGlobalErrorOnUnknownDevices()&&this._checkForUnknownDevices(n);const a=await this._ensureOutboundSession(n,s),c={room_id:this._roomId,type:t,content:r},l=this._olmDevice.encryptGroupMessage(a.sessionId,JSON.stringify(c)),u={algorithm:o.MEGOLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:l,session_id:a.sessionId,device_id:this._deviceId};return a.useCount++,u},u.prototype.forceDiscardSession=function(){this._setupPromise=this._setupPromise.then((()=>null))},u.prototype._checkForUnknownDevices=function(e){const t={};if(Object.keys(e).forEach((r=>{Object.keys(e[r]).forEach((n=>{const i=e[r][n];i.isUnverified()&&!i.isKnown()&&(t[r]||(t[r]={}),t[r][n]=i)}))})),Object.keys(t).length)throw new a.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)},u.prototype._removeUnknownDevices=function(e){for(const[t,r]of Object.entries(e)){for(const[e,t]of Object.entries(r))t.isUnverified()&&!t.isKnown()&&delete r[e];0===Object.keys(r).length&&delete e[t]}},u.prototype._getDevicesInRoom=async function(e){const t=await e.getEncryptionTargetMembers(),r=s.map(t,(function(e){return e.userId}));let n=this._crypto.getGlobalBlacklistUnverifiedDevices();"boolean"==typeof e.getBlacklistUnverifiedDevices()&&(n=e.getBlacklistUnverifiedDevices());const i=await this._crypto.downloadKeys(r,!1),o={};for(const e in i){if(!i.hasOwnProperty(e))continue;const t=i[e];for(const r in t){if(!t.hasOwnProperty(r))continue;const i=this._crypto.checkDeviceTrust(e,r);if(t[r].isBlocked()||!i.isVerified()&&n){o[e]||(o[e]={});const n=t[r].isBlocked()?{code:"m.blacklisted",reason:c.WITHHELD_MESSAGES["m.blacklisted"]}:{code:"m.unverified",reason:c.WITHHELD_MESSAGES["m.unverified"]};n.deviceInfo=t[r],o[e][r]=n,delete t[r]}}}return[i,o]},s.inherits(h,a.DecryptionAlgorithm);const d={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};h.prototype.decryptEvent=async function(e){const t=e.getWireContent();if(!t.sender_key||!t.session_id||!t.ciphertext)throw new a.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");let r;this._addEventToPendingList(e);try{r=await this._olmDevice.decryptGroupMessage(e.getRoomId(),t.sender_key,t.session_id,t.ciphertext,e.getId(),e.getTs())}catch(r){if("DecryptionError"===r.name)throw r;let n="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw r&&"OLM.UNKNOWN_MESSAGE_INDEX"===r.message&&(this._requestKeysForEvent(e),n="OLM_UNKNOWN_MESSAGE_INDEX"),new a.DecryptionError(n,r?r.toString():"Unknown Error: Error is undefined",{session:t.sender_key+"|"+t.session_id})}if(null===r){this._requestKeysForEvent(e);const r=await this._olmDevice.sessionMayHaveProblems(t.sender_key,e.getTs()-12e4);if(r){let e=d[r.type]||d.unknown;throw r.fixed&&(e+=" Trying to create a new secure channel and re-requesting the keys."),new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e,{session:t.sender_key+"|"+t.session_id})}throw new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:t.sender_key+"|"+t.session_id})}this._removeEventFromPendingList(e);const n=JSON.parse(r.result);if(n.room_id!==e.getRoomId())throw new a.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+n.room_id);return{clearEvent:n,senderCurve25519Key:r.senderKey,claimedEd25519Key:r.keysClaimed.ed25519,forwardingCurve25519KeyChain:r.forwardingCurve25519KeyChain,untrusted:r.untrusted}},h.prototype._requestKeysForEvent=function(e){const t=e.getWireContent(),r=e.getKeyRequestRecipients(this._userId);this._crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},r)},h.prototype._addEventToPendingList=function(e){const t=e.getWireContent(),r=t.sender_key,n=t.session_id;this._pendingEvents[r]||(this._pendingEvents[r]=new Map);const i=this._pendingEvents[r];i.has(n)||i.set(n,new Set),i.get(n).add(e)},h.prototype._removeEventFromPendingList=function(e){const t=e.getWireContent(),r=t.sender_key,n=t.session_id,i=this._pendingEvents[r],s=i&&i.get(n);s&&(s.delete(e),0===s.size&&i.delete(r),0===i.size&&delete this._pendingEvents[r])},h.prototype.onRoomKeyEvent=function(e){const t=e.getContent(),r=t.session_id;let n,o=e.getSenderKey(),a=[],c=!1;if(t.room_id&&r&&t.session_key){if(o){if("m.forwarded_room_key"==e.getType()){if(c=!0,a=t.forwarding_curve25519_key_chain,s.isArray(a)||(a=[]),a=a.slice(),a.push(o),o=t.sender_key,!o)return void i.logger.error("forwarded_room_key event is missing sender_key field");const e=t.sender_claimed_ed25519_key;if(!e)return void i.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");n={ed25519:e}}else n=e.getKeysClaimed();return this._olmDevice.addInboundGroupSession(t.room_id,o,a,r,t.session_key,n,c).then((()=>{this._retryDecryption(o,r).then((e=>{e&&this._crypto.cancelRoomKeyRequest({algorithm:t.algorithm,room_id:t.room_id,session_id:t.session_id,sender_key:o})}))})).then((()=>{this._crypto.backupGroupSession(t.room_id,o,a,t.session_id,t.session_key,n,c)})).catch((e=>{i.logger.error(`Error handling m.room_key_event: ${e}`)}))}i.logger.error("key event has no sender key (not encrypted?)")}else i.logger.error("key event is missing fields")},h.prototype.onRoomKeyWithheldEvent=async function(e){const t=e.getContent(),r=t.sender_key;if("m.no_olm"===t.code){const n=e.getSender();if(i.logger.warn(`${n}:${r} was unable to establish an olm session with us`),await this._olmDevice.getSessionIdForDevice(r))return i.logger.debug("New session already created.  Not creating a new one."),await this._olmDevice.recordSessionProblem(r,"no_olm",!0),void this.retryDecryptionFromSender(r);let s=this._crypto._deviceList.getDeviceByIdentityKey(t.algorithm,r);if(!s&&(await this._crypto.downloadKeys([n],!1),s=this._crypto._deviceList.getDeviceByIdentityKey(t.algorithm,r),!s))return i.logger.info("Couldn't find device for identity key "+r+": not establishing session"),await this._olmDevice.recordSessionProblem(r,"no_olm",!1),void this.retryDecryptionFromSender(r);await o.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[n]:[s]},!1);const a={algorithm:o.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await o.encryptMessageForDevice(a.ciphertext,this._userId,this._deviceId,this._olmDevice,n,s,{type:"m.dummy"}),await this._olmDevice.recordSessionProblem(r,"no_olm",!0),this.retryDecryptionFromSender(r),await this._baseApis.sendToDevice("m.room.encrypted",{[n]:{[s.deviceId]:a}})}else await this._olmDevice.addInboundGroupSessionWithheld(t.room_id,r,t.session_id,t.code,t.reason)},h.prototype.hasKeysForKeyRequest=function(e){const t=e.requestBody;return this._olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)},h.prototype.shareKeysWithDevice=function(e){const t=e.userId,r=e.deviceId,n=this._crypto.getStoredDevice(t,r),s=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[t]:[n]}).then((e=>e[t][r].sessionId?(i.logger.log("sharing keys for session "+s.sender_key+"|"+s.session_id+" with device "+t+":"+r),this._buildKeyForwardingMessage(s.room_id,s.sender_key,s.session_id)):null)).then((e=>{const i={algorithm:o.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};return this.olmlib.encryptMessageForDevice(i.ciphertext,this._userId,this._deviceId,this._olmDevice,t,n,e).then((()=>{const e={[t]:{[r]:i}};return this._baseApis.sendToDevice("m.room.encrypted",e)}))}))},h.prototype._buildKeyForwardingMessage=async function(e,t,r){const n=await this._olmDevice.getInboundGroupSessionKey(e,t,r);return{type:"m.forwarded_room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:n.sender_claimed_ed25519_key,session_id:r,session_key:n.key,chain_index:n.chain_index,forwarding_curve25519_key_chain:n.forwarding_curve25519_key_chain}}},h.prototype.importRoomKey=function(e,t={}){return this._olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,t.untrusted?{untrusted:t.untrusted}:{}).then((()=>{"backup"!==t.source&&this._crypto.backupGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0).catch((e=>{i.logger.log("Failed to back up megolm session",e)})),this._retryDecryption(e.sender_key,e.session_id)}))},h.prototype._retryDecryption=async function(e,t){const r=this._pendingEvents[e];if(!r)return!0;const n=r.get(t);return!n||(i.logger.debug("Retrying decryption on events",[...n]),await Promise.all([...n].map((async e=>{try{await e.attemptDecryption(this._crypto,!0)}catch(e){}}))),!(this._pendingEvents[e]||{})[t])},h.prototype.retryDecryptionFromSender=async function(e){const t=this._pendingEvents[e];return!t||(delete this._pendingEvents[e],await Promise.all([...t].map((async([e,t])=>{await Promise.all([...t].map((async e=>{try{await e.attemptDecryption(this._crypto)}catch(e){}})))}))),!this._pendingEvents[e])},(0,a.registerAlgorithm)(o.MEGOLM_ALGORITHM,u,h)},3072:(e,t,r)=>{"use strict";var n=r(862),i=r(7434),s=n(r(3102)),o=n(r(2772)),a=r(3272),c=r(1897);const l=a.DeviceInfo.DeviceVerification;function u(e){(0,s.polyfillSuper)(this,c.EncryptionAlgorithm,e),this._sessionPrepared=!1,this._prepPromise=null}function h(e){(0,s.polyfillSuper)(this,c.DecryptionAlgorithm,e)}s.inherits(u,c.EncryptionAlgorithm),u.prototype._ensureSession=function(e){if(this._prepPromise)return this._prepPromise;if(this._sessionPrepared)return Promise.resolve();const t=this;return this._prepPromise=t._crypto.downloadKeys(e).then((function(r){return t._crypto.ensureOlmSessionsForUsers(e)})).then((function(){t._sessionPrepared=!0})).finally((function(){t._prepPromise=null})),this._prepPromise},u.prototype.encryptMessage=async function(e,t,r){const n=await e.getEncryptionTargetMembers(),i=s.map(n,(function(e){return e.userId})),a=this;await this._ensureSession(i);const c={room_id:e.roomId,type:t,content:r},u={algorithm:o.OLM_ALGORITHM,sender_key:a._olmDevice.deviceCurve25519Key,ciphertext:{}},h=[];for(let e=0;e<i.length;++e){const t=i[e],r=a._crypto.getStoredDevicesForUser(t);for(let e=0;e<r.length;++e){const n=r[e];n.getIdentityKey()!=a._olmDevice.deviceCurve25519Key&&n.verified!=l.BLOCKED&&h.push(o.encryptMessageForDevice(u.ciphertext,a._userId,a._deviceId,a._olmDevice,t,n,c))}}return await Promise.all(h).then((()=>u))},s.inherits(h,c.DecryptionAlgorithm),h.prototype.decryptEvent=async function(e){const t=e.getWireContent(),r=t.sender_key,n=t.ciphertext;if(!n)throw new c.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this._olmDevice.deviceCurve25519Key in n))throw new c.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const i=n[this._olmDevice.deviceCurve25519Key];let s;try{s=await this._decryptMessage(r,i)}catch(e){throw new c.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:r,err:e})}const o=JSON.parse(s);if(o.recipient!=this._userId)throw new c.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+o.recipient);if(o.recipient_keys.ed25519!=this._olmDevice.deviceEd25519Key)throw new c.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:o.recipient_keys.ed25519,our_key:this._olmDevice.deviceEd25519Key});if(o.sender!=e.getSender())throw new c.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+o.sender,{reported_sender:e.getSender()});if(o.room_id!==e.getRoomId())throw new c.DecryptionError("OLM_BAD_ROOM","Message intended for room "+o.room_id,{reported_room:e.room_id});return{clearEvent:o,senderCurve25519Key:r,claimedEd25519Key:(o.keys||{}).ed25519||null}},h.prototype._decryptMessage=async function(e,t){if(0!==t.type)return this._reallyDecryptMessage(e,t);{const r=this._olmDevice._olmPrekeyPromise.then((()=>this._reallyDecryptMessage(e,t)));return this._olmDevice._olmPrekeyPromise=r.catch((()=>{})),await r}},h.prototype._reallyDecryptMessage=async function(e,t){const r=await this._olmDevice.getSessionIdsForDevice(e),n={};for(let s=0;s<r.length;s++){const o=r[s];try{const r=await this._olmDevice.decryptMessage(e,o,t.type,t.body);return i.logger.log("Decrypted Olm message from "+e+" with session "+o),r}catch(r){if(await this._olmDevice.matchesSession(e,o,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+o+": "+r.message);n[o]=r.message}}if(0!==t.type){if(0===r.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(n))}let s;try{s=await this._olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw n["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(n))}return i.logger.log("created new inbound Olm session ID "+s.session_id+" with "+e),s.payload},(0,c.registerAlgorithm)(o.OLM_ALGORITHM,u,h)},4830:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DehydrationManager=t.DEHYDRATION_ALGORITHM=void 0;var i=n(r(9713)),s=r(2772),o=r(7585),a=r(2611),c=n(r(9141)),l=r(7434);const u="org.matrix.msc2697.v1.olm.libolm_pickle";t.DEHYDRATION_ALGORITHM=u;const h=6048e5;t.DehydrationManager=class{constructor(e){this.crypto=e,(0,i.default)(this,"inProgress",!1),(0,i.default)(this,"timeoutId",void 0),(0,i.default)(this,"key",void 0),(0,i.default)(this,"keyInfo",void 0),(0,i.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}async getDehydrationKeyFromCache(){return await this.crypto._cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto._cryptoStore.getSecretStorePrivateKey(e,(async e=>{if(e){const{key:t,keyInfo:n,deviceDisplayName:i,time:o}=e,c=Buffer.from(this.crypto._olmDevice._pickleKey),l=await(0,a.decryptAES)(t,c,u);this.key=(0,s.decodeBase64)(l),this.keyInfo=n,this.deviceDisplayName=i;const d=Date.now(),p=Math.max(1,o+h-d);this.timeoutId=r.g.setTimeout(this.dehydrateDevice.bind(this),p)}}),"dehydration")}))}async setKeyAndQueueDehydration(e,t={},r){await this.setKey(e,t,r)||this.dehydrateDevice()}async setKey(e,t={},n){if(!e)return this.timeoutId&&(r.g.clearTimeout(this.timeoutId),this.timeoutId=void 0),await this.crypto._cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto._cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)})),this.key=void 0,void(this.keyInfo=void 0);let i=this.key&&e.length==this.key.length;for(let t=0;i&&t<e.length;t++)e[t]!=this.key[t]&&(i=!1);return i||(this.key=e,this.keyInfo=t,this.deviceDisplayName=n),i}async dehydrateDevice(){if(this.inProgress)l.logger.log("Dehydration already in progress -- not starting new dehydration");else{this.inProgress=!0,this.timeoutId&&(r.g.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const e=Buffer.from(this.crypto._olmDevice._pickleKey),t=await(0,a.encryptAES)((0,s.encodeBase64)(this.key),e,u);await this.crypto._cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto._cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:this.keyInfo,key:t,deviceDisplayName:this.deviceDisplayName,time:Date.now()})})),l.logger.log("Attempting to dehydrate device"),l.logger.log("Creating account");const n=new r.g.Olm.Account;n.create();const i=JSON.parse(n.identity_keys()),d=n.max_number_of_one_time_keys();n.generate_one_time_keys(d/2),n.generate_fallback_key();const p=JSON.parse(n.one_time_keys()),f=JSON.parse(n.fallback_key());n.mark_keys_as_published();const g=n.pickle(new Uint8Array(this.key)),m={algorithm:u,account:g};this.keyInfo.passphrase&&(m.passphrase=this.keyInfo.passphrase),l.logger.log("Uploading account to server");const y=(await this.crypto._baseApis._http.authedRequest(void 0,"PUT","/dehydrated_device",void 0,{device_data:m,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;l.logger.log("Preparing device keys",y);const v={algorithms:this.crypto._supportedAlgorithms,device_id:y,user_id:this.crypto._userId,keys:{[`ed25519:${y}`]:i.ed25519,[`curve25519:${y}`]:i.curve25519}},_=n.sign(c.default.stringify(v));v.signatures={[this.crypto._userId]:{[`ed25519:${y}`]:_}},this.crypto._crossSigningInfo.getId("self_signing")&&await this.crypto._crossSigningInfo.signObject(v,"self_signing"),l.logger.log("Preparing one-time keys");const b={};for(const[e,t]of Object.entries(p.curve25519)){const r={key:t},i=n.sign(c.default.stringify(r));r.signatures={[this.crypto._userId]:{[`ed25519:${y}`]:i}},b[`signed_curve25519:${e}`]=r}l.logger.log("Preparing fallback keys");const w={};for(const[e,t]of Object.entries(f.curve25519)){const r={key:t,fallback:!0},i=n.sign(c.default.stringify(r));r.signatures={[this.crypto._userId]:{[`ed25519:${y}`]:i}},w[`signed_curve25519:${e}`]=r}return l.logger.log("Uploading keys to server"),await this.crypto._baseApis._http.authedRequest(void 0,"POST","/keys/upload/"+encodeURI(y),void 0,{device_keys:v,one_time_keys:b,"org.matrix.msc2732.fallback_keys":w}),l.logger.log("Done dehydrating"),this.timeoutId=r.g.setTimeout(this.dehydrateDevice.bind(this),h),y}finally{this.inProgress=!1}}}stop(){this.timeoutId&&(r.g.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}},3272:(e,t)=>{"use strict";function r(e){Object.defineProperty(this,"deviceId",{enumerable:!0,value:e}),this.algorithms=[],this.keys={},this.verified=n.UNVERIFIED,this.known=!1,this.unsigned={},this.signatures={}}Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=r,r.fromStorage=function(e,t){const n=new r(t);for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},r.prototype.toStorage=function(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}},r.prototype.getFingerprint=function(){return this.keys["ed25519:"+this.deviceId]},r.prototype.getIdentityKey=function(){return this.keys["curve25519:"+this.deviceId]},r.prototype.getDisplayName=function(){return this.unsigned.device_display_name||null},r.prototype.isBlocked=function(){return this.verified==n.BLOCKED},r.prototype.isVerified=function(){return this.verified==n.VERIFIED},r.prototype.isUnverified=function(){return this.verified==n.UNVERIFIED},r.prototype.isKnown=function(){return 1==this.known},r.DeviceVerification={VERIFIED:1,UNVERIFIED:0,BLOCKED:-1};const n=r.DeviceVerification},2600:(e,t,r)=>{"use strict";var n=r(862),i=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.isCryptoAvailable=function(){return Boolean(r.g.Olm)},t.Crypto=L,t.fixBackupKey=N,t.verificationMethods=void 0;var s=i(r(9141)),o=r(7187),a=r(771),c=r(7434),l=n(r(3102)),u=r(2573),h=n(r(2772)),d=r(6670),p=r(3272),f=n(r(1994)),g=r(3075),m=r(636),y=r(4823),v=r(6617),_=r(7585),b=r(1696),w=r(6381),S=r(1597),k=r(4077),E=r(5279),x=r(2842),A=r(9588),T=r(4028),C=r(9489),I=r(2611),R=r(4830),O=r(4369);const P=p.DeviceInfo.DeviceVerification,D={[b.ReciprocateQRCode.NAME]:b.ReciprocateQRCode,[w.SAS.NAME]:w.SAS,[b.SHOW_QR_CODE_METHOD]:T.IllegalMethod,[b.SCAN_QR_CODE_METHOD]:T.IllegalMethod},M={RECIPROCATE_QR_CODE:b.ReciprocateQRCode.NAME,SAS:w.SAS.NAME};function L(e,t,r,n,i,s,o,h){if(this._onDeviceListUserCrossSigningUpdated=this._onDeviceListUserCrossSigningUpdated.bind(this),this._trustCrossSignedDevices=!0,this._reEmitter=new a.ReEmitter(this),this._baseApis=e,this._sessionStore=t,this._userId=r,this._deviceId=n,this._clientStore=i,this._cryptoStore=s,this._roomList=o,h){this._verificationMethods=new Map;for(const e of h)"string"==typeof e?D[e]&&this._verificationMethods.set(e,D[e]):e.NAME?this._verificationMethods.set(e.NAME,e):c.logger.warn(`Excluding unknown verification method ${e}`)}else this._verificationMethods=D;this.backupInfo=null,this.backupKey=null,this._checkedForBackup=!1,this._sendingBackups=!1,this._olmDevice=new u.OlmDevice(s),this._deviceList=new d.DeviceList(e,s,this._olmDevice),this._deviceList.on("userCrossSigningUpdated",this._onDeviceListUserCrossSigningUpdated),this._reEmitter.reEmit(this._deviceList,["crypto.devicesUpdated","crypto.willUpdateDevices"]),this._lastOneTimeKeyCheck=null,this._oneTimeKeyCheckInProgress=!1,this._roomEncryptors={},this._roomDecryptors={},this._supportedAlgorithms=l.keys(f.DECRYPTION_CLASSES),this._deviceKeys={},this._globalBlacklistUnverifiedDevices=!1,this._globalErrorOnUnknownDevices=!0,this._outgoingRoomKeyRequestManager=new v.OutgoingRoomKeyRequestManager(e,this._deviceId,this._cryptoStore),this._receivedRoomKeyRequests=[],this._receivedRoomKeyRequestCancellations=[],this._processingRoomKeyRequests=!1,this._lazyLoadMembers=!1,this._roomDeviceTrackingState={},this._lastNewSessionForced={},this._toDeviceVerificationRequests=new A.ToDeviceRequests,this._inRoomVerificationRequests=new x.InRoomRequests,this._sendKeyRequestsImmediately=!1;const p=this._baseApis._cryptoCallbacks||{},m=(0,g.createCryptoStoreCacheCallbacks)(s,this._olmDevice);this._crossSigningInfo=new g.CrossSigningInfo(r,p,m),this._secretStorage=new y.SecretStorage(e,p),this._dehydrationManager=new R.DehydrationManager(this),!p.getCrossSigningKey&&p.getSecretStorageKey&&(p.getCrossSigningKey=async e=>g.CrossSigningInfo.getFromSecretStorage(e,this._secretStorage))}function N(e){if("string"!=typeof e||e.indexOf(",")<0)return null;const t=Uint8Array.from(e.split(","),(e=>parseInt(e)));return h.encodeBase64(t)}async function F(e){const t=[],r={};if(e.getNeedsNewFallback()){const n=await e._olmDevice.getFallbackKey();for(const[i,s]of Object.entries(n.curve25519)){const n={key:s,fallback:!0};r["signed_curve25519:"+i]=n,t.push(e._signObject(n))}e.setNeedsNewFallback(!1)}const n=await e._olmDevice.getOneTimeKeys(),i={};for(const r in n.curve25519)if(n.curve25519.hasOwnProperty(r)){const s={key:n.curve25519[r]};i["signed_curve25519:"+r]=s,t.push(e._signObject(s))}await Promise.all(t);const s=await e._baseApis.uploadKeysRequest({one_time_keys:i,"org.matrix.msc2732.fallback_keys":r});return await e._olmDevice.markKeysAsPublished(),s}t.verificationMethods=M,l.inherits(L,o.EventEmitter),L.prototype.init=async function(e){const{exportedOlmDevice:t,pickleKey:n}=e||{};c.logger.log("Crypto: initialising Olm..."),await r.g.Olm.init(),c.logger.log(t?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),await this._olmDevice.init({fromExportedDevice:t,pickleKey:n}),c.logger.log("Crypto: loading device list..."),await this._deviceList.load(),this._deviceKeys["ed25519:"+this._deviceId]=this._olmDevice.deviceEd25519Key,this._deviceKeys["curve25519:"+this._deviceId]=this._olmDevice.deviceCurve25519Key,c.logger.log("Crypto: fetching own devices...");let i=this._deviceList.getRawStoredDevicesForUser(this._userId);if(i||(i={}),!i[this._deviceId]){c.logger.log("Crypto: adding this device to the store...");const e={keys:this._deviceKeys,algorithms:this._supportedAlgorithms,verified:P.VERIFIED,known:!0};i[this._deviceId]=e,this._deviceList.storeDevicesForUser(this._userId,i),this._deviceList.saveIfDirty()}await this._cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this._cryptoStore.getCrossSigningKeys(e,(e=>{e&&0!==Object.keys(e).length&&(c.logger.log("Loaded cross-signing public keys from crypto store"),this._crossSigningInfo.setKeys(e))}))})),this._deviceList.startTrackingDeviceList(this._userId),c.logger.log("Crypto: checking for key backup..."),this._checkAndStartKeyBackup()},L.prototype.getCryptoTrustCrossSignedDevices=function(){return this._trustCrossSignedDevices},L.prototype.setCryptoTrustCrossSignedDevices=function(e){this._trustCrossSignedDevices=e;for(const e of this._deviceList.getKnownUserIds()){const t=this._deviceList.getRawStoredDevicesForUser(e);for(const r of Object.keys(t)){const t=this.checkDeviceTrust(e,r);if(!t.isLocallyVerified()&&t.isCrossSigningVerified()){const t=this._deviceList.getStoredDevice(e,r);this.emit("deviceVerificationChanged",e,r,t)}}}},L.prototype.createRecoveryKeyFromPassphrase=async function(e){const t=new r.g.Olm.PkDecryption;try{const r={};if(e){const n=await(0,S.keyFromPassphrase)(e);r.passphrase={algorithm:"m.pbkdf2",iterations:n.iterations,salt:n.salt},r.pubkey=t.init_with_private_key(n.key)}else r.pubkey=t.generate_key();const n=t.get_private_key();return{keyInfo:r,encodedPrivateKey:(0,k.encodeRecoveryKey)(n),privateKey:n}}finally{t&&t.free()}},L.prototype.isCrossSigningReady=async function(){const e=this._crossSigningInfo.getId(),t=await this._crossSigningInfo.isStoredInKeyCache()||await this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage);return!(!e||!t)},L.prototype.isSecretStorageReady=async function(){const e=await this._secretStorage.hasKey(),t=await this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage),r=!this._baseApis.getKeyBackupEnabled()||this._baseApis.isKeyBackupKeyStored();return!!(e&&t&&r)},L.prototype.bootstrapCrossSigning=async function({authUploadDeviceSigningKeys:e,setupNewCrossSigning:t}={}){c.logger.log("Bootstrapping cross-signing");const r=this._baseApis._cryptoCallbacks,n=new m.EncryptionSetupBuilder(this._baseApis.store.accountData,r),i=new g.CrossSigningInfo(this._userId,n.crossSigningCallbacks,n.crossSigningCallbacks),s=this._crossSigningInfo.getId(),o=await this._crossSigningInfo.isStoredInKeyCache(),a=await this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage),l=o||a;c.logger.log({setupNewCrossSigning:t,publicKeysOnDevice:s,privateKeysInCache:o,privateKeysInStorage:a,privateKeysExistSomewhere:l}),!l||t?(c.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),await(async()=>{i.resetKeys(),await this._signObject(i.keys.master),n.addCrossSigningKeys(e,i.keys);const t=this._deviceList.getStoredDevice(this._userId,this._deviceId),r=await i.signDevice(this._userId,t);n.addKeySignature(this._userId,this._deviceId,r),this.backupInfo&&(await i.signObject(this.backupInfo.auth_data,"master"),n.addSessionBackup(this.backupInfo))})()):s&&o?c.logger.log("Cross-signing public keys trusted and private keys found locally"):a&&(c.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),await this.checkOwnCrossSigningTrust());const u=n.crossSigningCallbacks.privateKeys;if(u.size&&!this._baseApis._cryptoCallbacks.saveCrossSigningKeys){const e=new y.SecretStorage(n.accountDataClientAdapter,n.ssssCryptoCallbacks);await e.hasKey()&&(c.logger.log("Storing new cross-signing private keys in secret storage"),await g.CrossSigningInfo.storeInSecretStorage(u,e))}const h=n.buildOperation();await h.apply(this),await n.persist(this),c.logger.log("Cross-signing ready")},L.prototype.bootstrapSecretStorage=async function({createSecretStorageKey:e=(async()=>({})),keyBackupInfo:t,setupNewKeyBackup:r,setupNewSecretStorage:n,getKeyBackupPassphrase:i}={}){c.logger.log("Bootstrapping Secure Secret Storage");const s=this._baseApis._cryptoCallbacks,o=new m.EncryptionSetupBuilder(this._baseApis.store.accountData,s),a=new y.SecretStorage(o.accountDataClientAdapter,o.ssssCryptoCallbacks);let l=null;const u=async(e,t)=>{e=e||{},t&&(e.key=t);const{keyId:r,keyInfo:n}=await a.addKey(y.SECRET_STORAGE_ALGORITHM_V1_AES,e);return t&&o.ssssCryptoCallbacks.addPrivateKey(r,n,t),await a.setDefaultKeyId(r),r},d=async e=>{if(this._crossSigningInfo.getId()&&await this._crossSigningInfo.isStoredInKeyCache("master"))try{c.logger.log("Adding cross-signing signature to key backup"),await this._crossSigningInfo.signObject(e,"master")}catch(e){c.logger.error("Signing key backup with cross-signing keys failed",e)}else c.logger.warn("Cross-signing keys not available, skipping signature on key backup")},p=await this.getSecretStorageKey(),[f,v]=p||[null,null],_=!n&&v&&v.algorithm===y.SECRET_STORAGE_ALGORITHM_V1_AES;if(c.logger.log({keyBackupInfo:t,setupNewKeyBackup:r,setupNewSecretStorage:n,storageExists:_,oldKeyInfo:v}),_||t)if(!_&&t){c.logger.log("Secret storage does not exist, using key backup key");const e=await this.getSessionBackupPrivateKey()||await i(),r={};t.auth_data.private_key_salt&&t.auth_data.private_key_iterations&&(r.passphrase={algorithm:"m.pbkdf2",iterations:t.auth_data.private_key_iterations,salt:t.auth_data.private_key_salt,bits:256}),l=await u(r,e),await a.store("m.megolm_backup.v1",h.encodeBase64(e),[l]),await d(t.auth_data),o.addSessionBackup(t)}else c.logger.log("Secret storage exists"),v&&v.algorithm===y.SECRET_STORAGE_ALGORITHM_V1_AES&&await(async(e,t)=>{if(!t.mac){const r=await this._baseApis._cryptoCallbacks.getSecretStorageKey({keys:{[e]:t}},"");if(r){const n=r[1];o.ssssCryptoCallbacks.addPrivateKey(e,t,n);const{iv:i,mac:s}=await y.SecretStorage._calculateKeyCheck(n);t.iv=i,t.mac=s,await o.setAccountData(`m.secret_storage.key.${e}`,t)}}})(f,v);else{c.logger.log("Secret storage does not exist, creating new storage key");const{keyInfo:t,privateKey:r}=await e();l=await u(t,r)}if(!this._baseApis._cryptoCallbacks.saveCrossSigningKeys&&await this.isCrossSigningReady()&&(l||!await this._crossSigningInfo.isStoredInSecretStorage(a))){c.logger.log("Copying cross-signing private keys from cache to secret storage");const e=await this._crossSigningInfo.getCrossSigningKeysFromCache();await g.CrossSigningInfo.storeInSecretStorage(e,a)}if(r&&!t){c.logger.log("Creating new message key backup version");const e=await this._baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),t=(0,k.decodeRecoveryKey)(e.recovery_key);await a.store("m.megolm_backup.v1",h.encodeBase64(t));const r={algorithm:e.algorithm,auth_data:e.auth_data};await d(r.auth_data),await this._signObject(r.auth_data),o.addSessionBackup(r)}const b=await a.get("m.megolm_backup.v1");if(b){c.logger.info("Got session backup key from secret storage: caching");const e=N(b);e&&await a.store("m.megolm_backup.v1",e,[l||f]);const t=new Uint8Array(h.decodeBase64(e||b));await o.addSessionBackupPrivateKeyToCache(t)}const w=o.buildOperation();await w.apply(this),await o.persist(this),c.logger.log("Secure Secret Storage ready")},L.prototype.addSecretStorageKey=function(e,t,r){return this._secretStorage.addKey(e,t,r)},L.prototype.hasSecretStorageKey=function(e){return this._secretStorage.hasKey(e)},L.prototype.getSecretStorageKey=function(e){return this._secretStorage.getKey(e)},L.prototype.storeSecret=function(e,t,r){return this._secretStorage.store(e,t,r)},L.prototype.getSecret=function(e){return this._secretStorage.get(e)},L.prototype.isSecretStored=function(e,t){return this._secretStorage.isStored(e,t)},L.prototype.requestSecret=function(e,t){return t||(t=Object.keys(this._deviceList.getRawStoredDevicesForUser(this._userId))),this._secretStorage.request(e,t)},L.prototype.getDefaultSecretStorageKeyId=function(){return this._secretStorage.getDefaultKeyId()},L.prototype.setDefaultSecretStorageKeyId=function(e){return this._secretStorage.setDefaultKeyId(e)},L.prototype.checkSecretStorageKey=function(e,t){return this._secretStorage.checkKey(e,t)},L.prototype.checkSecretStoragePrivateKey=function(e,t){let n=null;try{return n=new r.g.Olm.PkDecryption,n.init_with_private_key(e)===t}finally{n&&n.free()}},L.prototype.getSessionBackupPrivateKey=async function(){let e=await new Promise((e=>{this._cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")}))}));if(e&&"string"==typeof e&&(e=new Uint8Array(h.decodeBase64(N(e)||e)),await this.storeSessionBackupPrivateKey(e)),e&&e.ciphertext){const t=Buffer.from(this._olmDevice._pickleKey),r=await(0,I.decryptAES)(e,t,"m.megolm_backup.v1");e=h.decodeBase64(r)}return e},L.prototype.storeSessionBackupPrivateKey=async function(e){if(!(e instanceof Uint8Array))throw new Error(`storeSessionBackupPrivateKey expects Uint8Array, got ${e}`);const t=Buffer.from(this._olmDevice._pickleKey);return e=await(0,I.encryptAES)(h.encodeBase64(e),t,"m.megolm_backup.v1"),this._cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._cryptoStore.storeSecretStorePrivateKey(t,"m.megolm_backup.v1",e)}))},L.prototype.checkCrossSigningPrivateKey=function(e,t){let n=null;try{return n=new r.g.Olm.PkSigning,n.init_with_seed(e)===t}finally{n&&n.free()}},L.prototype._afterCrossSigningLocalKeyChange=async function(){c.logger.info("Starting cross-signing key change post-processing");const e=this._deviceList.getStoredDevice(this._userId,this._deviceId),t=await this._crossSigningInfo.signDevice(this._userId,e);c.logger.info(`Starting background key sig upload for ${this._deviceId}`);const r=({shouldEmit:e})=>this._baseApis.uploadKeySignatures({[this._userId]:{[this._deviceId]:t}}).then((t=>{const{failures:n}=t||{};if(Object.keys(n||[]).length>0)throw e&&this._baseApis.emit("crypto.keySignatureUploadFailure",n,"_afterCrossSigningLocalKeyChange",r),new C.KeySignatureUploadError("Key upload failed",{failures:n});c.logger.info(`Finished background key sig upload for ${this._deviceId}`)})).catch((e=>{c.logger.error(`Error during background key sig upload for ${this._deviceId}`,e)}));r({shouldEmit:!0});const n=this._baseApis._cryptoCallbacks.shouldUpgradeDeviceVerifications;if(n){c.logger.info("Starting device verification upgrade");const e={};for(const[t,r]of Object.entries(this._deviceList._crossSigningInfo)){const n=await this._checkForDeviceVerificationUpgrade(t,g.CrossSigningInfo.fromStorage(r,t));n&&(e[t]=n)}if(Object.keys(e).length>0){c.logger.info(`Found ${Object.keys(e).length} verif users to upgrade`);try{const t=await n({users:e});if(t)for(const r of t)r in e&&await this._baseApis.setDeviceVerified(r,e[r].crossSigningInfo.getId())}catch(e){c.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}}c.logger.info("Finished device verification upgrade")}c.logger.info("Finished cross-signing key change post-processing")},L.prototype._checkForDeviceVerificationUpgrade=async function(e,t){const r=this._crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!r.verified){const r=this._deviceList.getRawStoredDevicesForUser(e),n=await this._checkForValidDeviceSignature(e,t.keys.master,r);if(n.length)return{devices:n.map((e=>p.DeviceInfo.fromStorage(r[e],e))),crossSigningInfo:t}}},L.prototype._checkForValidDeviceSignature=async function(e,t,r){const n=[];if(r&&t.signatures&&t.signatures[e])for(const i of Object.keys(t.signatures[e])){const[,s]=i.split(":",2);if(s in r&&r[s].verified===P.VERIFIED)try{await h.verifySignature(this._olmDevice,t,e,s,r[s].keys[i]),n.push(s)}catch(e){}}return n},L.prototype.getCrossSigningId=function(e){return this._crossSigningInfo.getId(e)},L.prototype.getStoredCrossSigningForUser=function(e){return this._deviceList.getStoredCrossSigningForUser(e)},L.prototype.checkUserTrust=function(e){const t=this._deviceList.getStoredCrossSigningForUser(e);return t?this._crossSigningInfo.checkUserTrust(t):new g.UserTrustLevel(!1,!1,!1)},L.prototype.checkDeviceTrust=function(e,t){const r=this._deviceList.getStoredDevice(e,t);return this._checkDeviceInfoTrust(e,r)},L.prototype._checkDeviceInfoTrust=function(e,t){const r=!(!t||!t.isVerified()),n=this._deviceList.getStoredCrossSigningForUser(e);if(t&&n){const i=this._trustCrossSignedDevices||e===this._userId;return this._crossSigningInfo.checkDeviceTrust(n,t,r,i)}return new g.DeviceTrustLevel(!1,!1,r,!1)},L.prototype._onDeviceListUserCrossSigningUpdated=async function(e){if(e===this._userId){const t=this._deviceList.getStoredCrossSigningForUser(e),r=t?t.getId():null,n=this._crossSigningInfo.getId(),i=n!==r;n&&r&&!i?await this.checkOwnCrossSigningTrust():(this._storeTrustedSelfKeys(null),this.emit("crossSigning.keysChanged",{}),this.emit("userTrustStatusChanged",this._userId,this.checkUserTrust(e)))}else{await this._checkDeviceVerifications(e);const t=this._deviceList.getStoredCrossSigningForUser(e);t&&(t.updateCrossSigningVerifiedBefore(this.checkUserTrust(e).isCrossSigningVerified()),this._deviceList.setRawStoredCrossSigningForUser(e,t.toStorage())),this.emit("userTrustStatusChanged",e,this.checkUserTrust(e))}},L.prototype.checkOwnCrossSigningTrust=async function(){const e=this._userId;await this.downloadKeys([this._userId]);const t=this._deviceList.getStoredCrossSigningForUser(e);if(!t)return void c.logger.error("Got cross-signing update event for user "+e+" but no new cross-signing information found!");const r=t.getId(),n=this._crossSigningInfo.getId()!==r;if(n){c.logger.info("Got new master public key",r),c.logger.info("Attempting to retrieve cross-signing master private key");let e=null;try{e=(await this._crossSigningInfo.getCrossSigningKey("master",r))[1],c.logger.info("Got cross-signing master private key")}catch(e){c.logger.error("Cross-signing master private key not available",e)}finally{e&&e.free()}}const i=this._crossSigningInfo.getId("self_signing"),s=this._crossSigningInfo.getId("user_signing");this._storeTrustedSelfKeys(t.keys);const o=i!==t.getId("self_signing"),a=s!==t.getId("user_signing"),l={};if(o){c.logger.info("Got new self-signing key",t.getId("self_signing")),c.logger.info("Attempting to retrieve cross-signing self-signing private key");let e=null;try{e=(await this._crossSigningInfo.getCrossSigningKey("self_signing",t.getId("self_signing")))[1],c.logger.info("Got cross-signing self-signing private key")}catch(e){c.logger.error("Cross-signing self-signing private key not available",e)}finally{e&&e.free()}const r=this._deviceList.getStoredDevice(this._userId,this._deviceId),n=await this._crossSigningInfo.signDevice(this._userId,r);l[this._deviceId]=n}if(a){c.logger.info("Got new user-signing key",t.getId("user_signing")),c.logger.info("Attempting to retrieve cross-signing user-signing private key");let e=null;try{e=(await this._crossSigningInfo.getCrossSigningKey("user_signing",t.getId("user_signing")))[1],c.logger.info("Got cross-signing user-signing private key")}catch(e){c.logger.error("Cross-signing user-signing private key not available",e)}finally{e&&e.free()}}if(n){const e=this._crossSigningInfo.keys.master;await this._signObject(e);const t=e.signatures[this._userId]["ed25519:"+this._deviceId];l[this._crossSigningInfo.getId()]=Object.assign({},e,{signatures:{[this._userId]:{["ed25519:"+this._deviceId]:t}}})}const u=Object.keys(l);if(u.length){const e=({shouldEmit:t})=>(c.logger.info(`Starting background key sig upload for ${u}`),this._baseApis.uploadKeySignatures({[this._userId]:l}).then((r=>{const{failures:n}=r||{};if(c.logger.info(`Finished background key sig upload for ${u}`),Object.keys(n||[]).length>0)throw t&&this._baseApis.emit("crypto.keySignatureUploadFailure",n,"checkOwnCrossSigningTrust",e),new C.KeySignatureUploadError("Key upload failed",{failures:n})})).catch((e=>{c.logger.error(`Error during background key sig upload for ${u}`,e)})));e({shouldEmit:!0})}this.emit("userTrustStatusChanged",e,this.checkUserTrust(e)),n&&(this._baseApis.emit("crossSigning.keysChanged",{}),await this._afterCrossSigningLocalKeyChange()),await this.checkKeyBackup()},L.prototype._storeTrustedSelfKeys=async function(e){e?this._crossSigningInfo.setKeys(e):this._crossSigningInfo.clearKeys(),await this._cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this._cryptoStore.storeCrossSigningKeys(e,this._crossSigningInfo.keys)}))},L.prototype._checkDeviceVerifications=async function(e){const t=this._baseApis._cryptoCallbacks.shouldUpgradeDeviceVerifications;if(t){if(c.logger.info(`Starting device verification upgrade for ${e}`),this._crossSigningInfo.keys.user_signing){const r=this._deviceList.getStoredCrossSigningForUser(e);if(r){const n=await this._checkForDeviceVerificationUpgrade(e,r);n&&(await t({users:{[e]:n}})).includes(e)&&await this._baseApis.setDeviceVerified(e,r.getId())}}c.logger.info(`Finished device verification upgrade for ${e}`)}},L.prototype._checkAndStartKeyBackup=async function(){if(c.logger.log("Checking key backup status..."),this._baseApis.isGuest())return c.logger.log("Skipping key backup check since user is guest"),this._checkedForBackup=!0,null;let e;try{e=await this._baseApis.getKeyBackupVersion()}catch(e){return c.logger.log("Error checking for active key backup",e),404===e.httpStatus&&(this._checkedForBackup=!0),null}this._checkedForBackup=!0;const t=await this.isKeyBackupTrusted(e);return t.usable&&!this.backupInfo?(c.logger.log("Found usable key backup v"+e.version+": enabling key backups"),this._baseApis.enableKeyBackup(e)):!t.usable&&this.backupInfo?(c.logger.log("No usable key backup: disabling key backup"),this._baseApis.disableKeyBackup()):t.usable||this.backupInfo?t.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(c.logger.log("On backup version "+this.backupInfo.version+" but found version "+e.version+": switching."),this._baseApis.disableKeyBackup(),this._baseApis.enableKeyBackup(e),await this.scheduleAllGroupSessionsForBackup()):c.logger.log("Backup version "+e.version+" still current")):c.logger.log("No usable key backup: not enabling key backup"),{backupInfo:e,trustInfo:t}},L.prototype.setTrustedBackupPubKey=async function(e){this._sessionStore.setLocalTrustedBackupPubKey(e),await this.checkKeyBackup()},L.prototype.checkKeyBackup=async function(){return this._checkedForBackup=!1,this._checkAndStartKeyBackup()},L.prototype.isKeyBackupTrusted=async function(e){const t={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.public_key&&e.auth_data.signatures))return c.logger.info("Key backup is absent or missing required data"),t;const r=this._sessionStore.getLocalTrustedBackupPubKey();e.auth_data.public_key===r&&(c.logger.info("Backup public key "+r+" is trusted locally"),t.trusted_locally=!0);const n=e.auth_data.signatures[this._userId]||[];for(const r of Object.keys(n)){const n=r.split(":");if("ed25519"!==n[0]){c.logger.log("Ignoring unknown signature type: "+n[0]);continue}const i={deviceId:n[1]},s=this._crossSigningInfo.getId();if(s===i.deviceId){i.crossSigningId=!0;try{await h.verifySignature(this._olmDevice,e.auth_data,this._userId,i.deviceId,s),i.valid=!0}catch(e){c.logger.warning("Bad signature from cross signing key "+s,e),i.valid=!1}t.sigs.push(i);continue}const o=this._deviceList.getStoredDevice(this._userId,i.deviceId);if(o){i.device=o,i.deviceTrust=await this.checkDeviceTrust(this._userId,i.deviceId);try{await h.verifySignature(this._olmDevice,e.auth_data,this._userId,o.deviceId,o.getFingerprint()),i.valid=!0}catch(t){c.logger.info("Bad signature from key ID "+r+" userID "+this._userId+" device ID "+o.deviceId+" fingerprint: "+o.getFingerprint(),e.auth_data,t),i.valid=!1}}else i.valid=null,c.logger.info("Ignoring signature from unknown key "+r);t.sigs.push(i)}return t.usable=t.sigs.some((e=>e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId))),t.usable|=t.trusted_locally,t},L.prototype.enableLazyLoading=function(){this._lazyLoadMembers=!0},L.prototype.registerEventHandlers=function(e){const t=this;e.on("RoomMember.membership",(function(e,r,n){try{t._onRoomMembership(e,r,n)}catch(e){c.logger.error("Error handling membership change:",e)}})),e.on("toDeviceEvent",t._onToDeviceEvent.bind(t));const r=t._onTimelineEvent.bind(t);e.on("Room.timeline",r),e.on("Event.decrypted",r)},L.prototype.start=function(){this._outgoingRoomKeyRequestManager.start()},L.prototype.stop=function(){this._outgoingRoomKeyRequestManager.stop(),this._deviceList.stop(),this._dehydrationManager.stop()},L.getOlmVersion=function(){return u.OlmDevice.getOlmVersion()},L.prototype.getDeviceEd25519Key=function(){return this._olmDevice.deviceEd25519Key},L.prototype.getDeviceCurve25519Key=function(){return this._olmDevice.deviceCurve25519Key},L.prototype.setGlobalBlacklistUnverifiedDevices=function(e){this._globalBlacklistUnverifiedDevices=e},L.prototype.getGlobalBlacklistUnverifiedDevices=function(){return this._globalBlacklistUnverifiedDevices},L.prototype.setGlobalErrorOnUnknownDevices=function(e){this._globalErrorOnUnknownDevices=e},L.prototype.getGlobalErrorOnUnknownDevices=function(){return this._globalErrorOnUnknownDevices},L.prototype.uploadDeviceKeys=function(){const e=this,t=e._userId,r=e._deviceId,n={algorithms:e._supportedAlgorithms,device_id:r,keys:e._deviceKeys,user_id:t};return e._signObject(n).then((()=>e._baseApis.uploadKeysRequest({device_keys:n})))},L.prototype.updateOneTimeKeyCount=function(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this._oneTimeKeyCount=e},L.prototype.setNeedsNewFallback=function(e){this._needsNewFallback=!!e},L.prototype.getNeedsNewFallback=function(){return this._needsNewFallback},L.prototype.downloadKeys=function(e,t){return this._deviceList.downloadKeys(e,t)},L.prototype.getStoredDevicesForUser=function(e){return this._deviceList.getStoredDevicesForUser(e)},L.prototype.getStoredDevice=function(e,t){return this._deviceList.getStoredDevice(e,t)},L.prototype.saveDeviceList=function(e){return this._deviceList.saveIfDirty(e)},L.prototype.setDeviceVerification=async function(e,t,r,n,i){void 0===r&&(r=null),void 0===n&&(n=null),void 0===i&&(i=null);const s=this._deviceList.getStoredCrossSigningForUser(e);if(s&&s.getId()===t){if(null!==n||null!==i)throw new Error("Cannot set blocked or known for a cross-signing key");if(!r)throw new Error("Cannot set a cross-signing key as unverified");if(this._crossSigningInfo.getId()||e!==this._crossSigningInfo.userId||(this._storeTrustedSelfKeys(s.keys),this.emit("userTrustStatusChanged",this._userId,this.checkUserTrust(e))),e!==this._userId){c.logger.info("Master key "+s.getId()+" for "+e+" marked verified. Signing...");const r=await this._crossSigningInfo.signUser(s);if(r){const n=async({shouldEmit:i})=>{c.logger.info("Uploading signature for "+e+"...");const s=await this._baseApis.uploadKeySignatures({[e]:{[t]:r}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw i&&this._baseApis.emit("crypto.keySignatureUploadFailure",o,"setDeviceVerification",n),new C.KeySignatureUploadError("Key upload failed",{failures:o})};await n({shouldEmit:!0})}return r}return s}const o=this._deviceList.getRawStoredDevicesForUser(e);if(!o||!o[t])throw new Error("Unknown device "+e+":"+t);const a=o[t];let l=a.verified;r?l=P.VERIFIED:null!==r&&l==P.VERIFIED&&(l=P.UNVERIFIED),n?l=P.BLOCKED:null!==n&&l==P.BLOCKED&&(l=P.UNVERIFIED);let u=a.known;if(null!==i&&(u=i),a.verified===l&&a.known===u||(a.verified=l,a.known=u,this._deviceList.storeDevicesForUser(e,o),this._deviceList.saveIfDirty()),r&&e===this._userId){let r;if(c.logger.info("Own device "+t+" marked verified: signing"),this.checkDeviceTrust(e,t).isCrossSigningVerified()?c.logger.log(`Own device ${t} already cross-signing verified`):r=await this._crossSigningInfo.signDevice(e,p.DeviceInfo.fromStorage(a,t)),r){const n=async({shouldEmit:i})=>{c.logger.info("Uploading signature for "+t);const s=await this._baseApis.uploadKeySignatures({[e]:{[t]:r}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw i&&this._baseApis.emit("crypto.keySignatureUploadFailure",o,"setDeviceVerification",n),new C.KeySignatureUploadError("Key upload failed",{failures:o})};await n({shouldEmit:!0})}}const h=p.DeviceInfo.fromStorage(a,t);return this.emit("deviceVerificationChanged",e,t,h),h},L.prototype.findVerificationRequestDMInProgress=function(e){return this._inRoomVerificationRequests.findRequestInProgress(e)},L.prototype.getVerificationRequestsToDeviceInProgress=function(e){return this._toDeviceVerificationRequests.getRequestsInProgress(e)},L.prototype.requestVerificationDM=function(e,t){const r=this._inRoomVerificationRequests.findRequestInProgress(t);if(r)return Promise.resolve(r);const n=new x.InRoomChannel(this._baseApis,t,e);return this._requestVerificationWithChannel(e,n,this._inRoomVerificationRequests)},L.prototype.requestVerification=function(e,t){t||(t=Object.keys(this._deviceList.getRawStoredDevicesForUser(e)));const r=this._toDeviceVerificationRequests.findRequestInProgress(e,t);if(r)return Promise.resolve(r);const n=new A.ToDeviceChannel(this._baseApis,e,t,A.ToDeviceChannel.makeTransactionId());return this._requestVerificationWithChannel(e,n,this._toDeviceVerificationRequests)},L.prototype._requestVerificationWithChannel=async function(e,t,r){let n=new E.VerificationRequest(t,this._verificationMethods,this._baseApis);t.transactionId&&r.setRequestByChannel(t,n),await n.sendRequest();const i=r.getRequestByChannel(t);return i?n=i:(c.logger.log(`Crypto: adding new request to requestsByTxnId with id ${t.transactionId} ${t.roomId}`),r.setRequestByChannel(t,n)),n},L.prototype.beginKeyVerification=function(e,t,r,n=null){let i;if(n){if(i=this._toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,n),!i)throw new Error(`No request found for user ${t} with transactionId ${n}`)}else{n=A.ToDeviceChannel.makeTransactionId();const e=new A.ToDeviceChannel(this._baseApis,t,[r],n,r);i=new E.VerificationRequest(e,this._verificationMethods,this._baseApis),this._toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,n,i)}return i.beginKeyVerification(e,{userId:t,deviceId:r})},L.prototype.legacyDeviceVerification=async function(e,t,r){const n=A.ToDeviceChannel.makeTransactionId(),i=new A.ToDeviceChannel(this._baseApis,e,[t],n,t),s=new E.VerificationRequest(i,this._verificationMethods,this._baseApis);this._toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,n,s);const o=s.beginKeyVerification(r,{userId:e,deviceId:t});return await Promise.race([o.verify(),s.waitFor((e=>e.started))]),s},L.prototype.getOlmSessionsForUser=async function(e){const t=this.getStoredDevicesForUser(e)||[],r={};for(let e=0;e<t.length;++e){const n=t[e],i=n.getIdentityKey(),s=await this._olmDevice.getSessionInfoForDevice(i);r[n.deviceId]={deviceIdKey:i,sessions:s}}return r},L.prototype.getEventSenderDeviceInfo=function(e){const t=e.getSenderKey(),r=e.getWireContent().algorithm;if(!t||!r)return null;if(e.getForwardingCurve25519KeyChain().length>0)return null;if(e.isKeySourceUntrusted())return null;const n=this._deviceList.getDeviceByIdentityKey(r,t);if(null===n)return null;const i=e.getClaimedEd25519Key();return i?i!==n.getFingerprint()?(c.logger.warn("Event "+e.getId()+" claims ed25519 key "+i+" but sender device has key "+n.getFingerprint()),null):n:(c.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)},L.prototype.getEventEncryptionInfo=function(e){const t={};if(t.senderKey=e.getSenderKey(),t.algorithm=e.getWireContent().algorithm,!t.senderKey||!t.algorithm)return t.encrypted=!1,t;t.encrypted=!0,e.getForwardingCurve25519KeyChain().length>0||e.isKeySourceUntrusted()?t.authenticated=!1:t.authenticated=!0,t.sender=this._deviceList.getDeviceByIdentityKey(t.algorithm,t.senderKey);const r=e.getClaimedEd25519Key();return r||(c.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),t.mismatchedSender=!0),t.sender&&r!==t.sender.getFingerprint()&&(c.logger.warn("Event "+e.getId()+" claims ed25519 key "+r+"but sender device has key "+t.sender.getFingerprint()),t.mismatchedSender=!0),t},L.prototype.forceDiscardSession=function(e){const t=this._roomEncryptors[e];if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()},L.prototype.setRoomEncryption=async function(e,t,r){if(!t.algorithm)return void c.logger.log("Ignoring setRoomEncryption with no algorithm");const n=this._roomList.getRoomEncryption(e);if(n&&JSON.stringify(n)!=JSON.stringify(t))return void c.logger.error("Ignoring m.room.encryption event which requests a change of config in "+e);if(this._roomEncryptors[e])return;let i=null;n||(i=this._roomList.setRoomEncryption(e,t));const s=f.ENCRYPTION_CLASSES[t.algorithm];if(!s)throw new Error("Unable to encrypt with "+t.algorithm);const o=new s({userId:this._userId,deviceId:this._deviceId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:e,config:t});this._roomEncryptors[e]=o,i&&await i,this._lazyLoadMembers?c.logger.log("Enabling encryption in "+e):(c.logger.log("Enabling encryption in "+e+"; starting to track device lists for all users therein"),await this.trackRoomDevices(e),this.inhibitDeviceQuery||this._deviceList.refreshOutdatedDeviceLists())},L.prototype.trackRoomDevices=function(e){let t=this._roomDeviceTrackingState[e];return t||(t=(async()=>{if(!this._roomEncryptors[e])return;const t=this._clientStore.getRoom(e);if(!t)throw new Error(`Unable to start tracking devices in unknown room ${e}`);c.logger.log(`Starting to track devices for room ${e} ...`),(await t.getEncryptionTargetMembers()).forEach((e=>{this._deviceList.startTrackingDeviceList(e.userId)}))})(),this._roomDeviceTrackingState[e]=t.catch((t=>{throw this._roomDeviceTrackingState[e]=null,t}))),t},L.prototype.ensureOlmSessionsForUsers=function(e){const t={};for(let r=0;r<e.length;++r){const n=e[r];t[n]=[];const i=this.getStoredDevicesForUser(n)||[];for(let e=0;e<i.length;++e){const r=i[e];r.getIdentityKey()!=this._olmDevice.deviceCurve25519Key&&r.verified!=P.BLOCKED&&t[n].push(r)}}return h.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,t)},L.prototype.exportRoomKeys=async function(){const e=[];return await this._cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(t=>{this._cryptoStore.getAllEndToEndInboundGroupSessions(t,(t=>{if(null===t)return;const r=this._olmDevice.exportInboundGroupSession(t.senderKey,t.sessionId,t.sessionData);delete r.first_known_index,r.algorithm=h.MEGOLM_ALGORITHM,e.push(r)}))})),e},L.prototype.importRoomKeys=function(e,t={}){let r=0,n=0;const i=e.length;function s(){t.progressCallback({stage:"load_keys",successes:r,failures:n,total:i})}return Promise.all(e.map((e=>e.room_id&&e.algorithm?this._getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally((e=>{r++,t.progressCallback&&s()})):(c.logger.warn("ignoring room key entry with missing fields",e),n++,t.progressCallback&&s(),null))))},L.prototype.scheduleKeyBackupSend=async function(e=1e4){if(!this._sendingBackups){this._sendingBackups=!0;try{const t=Math.random()*e;await(0,l.sleep)(t);let r=0;for(;;){if(!this.backupKey)return;try{if(0===await this._backupPendingKeys(200))return;r=0}catch(e){if(r++,c.logger.log("Key backup request failed",e),e.data&&("M_NOT_FOUND"==e.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==e.data.errcode))throw await this.checkKeyBackup(),this.emit("crypto.keyBackupFailed",e.data.errcode),e}r&&await(0,l.sleep)(1e3*Math.pow(2,Math.min(r-1,4)))}}finally{this._sendingBackups=!1}}},L.prototype._backupPendingKeys=async function(e){const t=await this._cryptoStore.getSessionsNeedingBackup(e);if(!t.length)return 0;let r=await this._cryptoStore.countSessionsNeedingBackup();this.emit("crypto.keyBackupSessionsRemaining",r);const n={};for(const e of t){const t=e.sessionData.room_id;void 0===n[t]&&(n[t]={sessions:{}});const r=await this._olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);r.algorithm=h.MEGOLM_ALGORITHM,delete r.session_id,delete r.room_id;const i=r.first_known_index;delete r.first_known_index;const s=this.backupKey.encrypt(JSON.stringify(r)),o=(r.forwarding_curve25519_key_chain||[]).length,a=this._deviceList.getUserByIdentityKey(h.MEGOLM_ALGORITHM,e.senderKey),c=this._deviceList.getDeviceByIdentityKey(h.MEGOLM_ALGORITHM,e.senderKey),l=this._checkDeviceInfoTrust(a,c).isVerified();n[t].sessions[e.sessionId]={first_message_index:i,forwarded_count:o,is_verified:l,session_data:s}}return await this._baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:n}),await this._cryptoStore.unmarkSessionsNeedingBackup(t),r=await this._cryptoStore.countSessionsNeedingBackup(),this.emit("crypto.keyBackupSessionsRemaining",r),t.length},L.prototype.backupGroupSession=async function(e,t,r,n,i,s,o){await this._cryptoStore.markSessionsNeedingBackup([{senderKey:t,sessionId:n}]),this.backupInfo&&this.scheduleKeyBackupSend()},L.prototype.scheduleAllGroupSessionsForBackup=async function(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)},L.prototype.flagAllGroupSessionsForBackup=async function(){await this._cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,_.IndexedDBCryptoStore.STORE_BACKUP],(e=>{this._cryptoStore.getAllEndToEndInboundGroupSessions(e,(t=>{null!==t&&this._cryptoStore.markSessionsNeedingBackup([t],e)}))}));const e=await this._cryptoStore.countSessionsNeedingBackup();return this.emit("crypto.keyBackupSessionsRemaining",e),e},L.prototype.countSessionsNeedingBackup=function(){return this._cryptoStore.countSessionsNeedingBackup()},L.prototype.prepareToEncrypt=function(e){const t=e.roomId,r=this._roomEncryptors[t];r&&r.prepareToEncrypt(e)},L.prototype.encryptEvent=async function(e,t){if(!t)throw new Error("Cannot send encrypted messages in unknown rooms");const r=e.getRoomId(),n=this._roomEncryptors[r];if(!n)throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");this._roomDeviceTrackingState[r]||this.trackRoomDevices(r),await this._roomDeviceTrackingState[r];let i=e.getContent();const s=i["m.relates_to"];s&&(i=Object.assign({},i),delete i["m.relates_to"]);const o=await n.encryptMessage(t,e.getType(),i);s&&(o["m.relates_to"]=s),e.makeEncrypted("m.room.encrypted",o,this._olmDevice.deviceCurve25519Key,this._olmDevice.deviceEd25519Key)},L.prototype.decryptEvent=async function(e){if(e.isRedacted()){const t=new O.MatrixEvent(e.getUnsigned().redacted_because),r=await this.decryptEvent(t);return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:r.clearEvent}}}}{const t=e.getWireContent(),r=this._getRoomDecryptor(e.getRoomId(),t.algorithm);return await r.decryptEvent(e)}},L.prototype.handleDeviceListChanges=async function(e,t){e.oldSyncToken&&await this._evalDeviceListChanges(t)},L.prototype.requestRoomKey=function(e,t,r=!1){return this._outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,r).then((()=>{this._sendKeyRequestsImmediately&&this._outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((e=>{c.logger.error("Error requesting key for event",e)}))},L.prototype.cancelRoomKeyRequest=function(e){this._outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((e=>{c.logger.warn("Error clearing pending room key requests",e)}))},L.prototype.cancelAndResendAllOutgoingKeyRequests=function(){return this._outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()},L.prototype.onCryptoEvent=async function(e){const t=e.getRoomId(),r=e.getContent();try{await this.setRoomEncryption(t,r,!0)}catch(e){c.logger.error("Error configuring encryption in room "+t+":",e)}},L.prototype.onSyncWillProcess=async function(e){e.oldSyncToken||(c.logger.log("Initial sync performed - resetting device tracking state"),this._deviceList.stopTrackingAllDeviceLists(),this._deviceList.startTrackingDeviceList(this._userId),this._roomDeviceTrackingState={}),this._sendKeyRequestsImmediately=!1},L.prototype.onSyncCompleted=async function(e){const t=e.nextSyncToken;this._deviceList.setSyncToken(e.nextSyncToken),this._deviceList.saveIfDirty(),this._deviceList.lastKnownSyncToken=t,this._deviceList.startTrackingDeviceList(this._userId),this._deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(function(e){if(e._oneTimeKeyCheckInProgress)return;const t=Date.now();if(null!==e._lastOneTimeKeyCheck&&t-e._lastOneTimeKeyCheck<6e4)return;e._lastOneTimeKeyCheck=t;const r=e._olmDevice.maxNumberOfOneTimeKeys(),n=Math.floor(r/2);e._oneTimeKeyCheckInProgress=!0,Promise.resolve().then((()=>void 0!==e._oneTimeKeyCount?Promise.resolve(e._oneTimeKeyCount):e._baseApis.uploadKeysRequest({}).then((e=>e.one_time_key_counts.signed_curve25519||0)))).then((t=>async function(t){for(;n>t||e.getNeedsNewFallback();){if(n>t){c.logger.info("generating oneTimeKeys");const r=Math.min(n-t,5);await e._olmDevice.generateOneTimeKeys(r)}e.getNeedsNewFallback()&&(c.logger.info("generating fallback key"),await e._olmDevice.generateFallbackKey()),c.logger.info("calling _uploadOneTimeKeys");const r=await F(e);if(!r.one_time_key_counts||!r.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");t=r.one_time_key_counts.signed_curve25519}}(t))).catch((e=>{c.logger.error("Error uploading one-time keys",e.stack||e)})).finally((()=>{e._oneTimeKeyCount=void 0,e._oneTimeKeyCheckInProgress=!1}))}(this),this._processReceivedRoomKeyRequests(),this._outgoingRoomKeyRequestManager.sendQueuedRequests(),this._sendKeyRequestsImmediately=!0)},L.prototype._evalDeviceListChanges=async function(e){if(e.changed&&Array.isArray(e.changed)&&e.changed.forEach((e=>{this._deviceList.invalidateUserDeviceList(e)})),e.left&&Array.isArray(e.left)&&e.left.length){const t=new Set(await this._getTrackedE2eUsers());e.left.forEach((e=>{t.has(e)||this._deviceList.stopTrackingDeviceList(e)}))}},L.prototype._getTrackedE2eUsers=async function(){const e=[];for(const t of this._getTrackedE2eRooms()){const r=await t.getEncryptionTargetMembers();for(const t of r)e.push(t.userId)}return e},L.prototype._getTrackedE2eRooms=function(){return this._clientStore.getRooms().filter((e=>{if(!this._roomEncryptors[e.roomId])return!1;if(!this._roomDeviceTrackingState[e.roomId])return!1;const t=e.getMyMembership();return"join"===t||"invite"===t}))},L.prototype._onToDeviceEvent=function(e){try{c.logger.log(`received to_device ${e.getType()} from: ${e.getSender()} id: ${e.getId()}`),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this._onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this._onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this._secretStorage._onRequestReceived(e):"m.secret.send"===e.getType()?this._secretStorage._onSecretReceived(e):"org.matrix.room_key.withheld"===e.getType()?this._onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this._onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this._onToDeviceBadEncrypted(e):e.isBeingDecrypted()&&e.once("Event.decrypted",(e=>{this._onToDeviceEvent(e)}))}catch(e){c.logger.error("Error handling toDeviceEvent:",e)}},L.prototype._onRoomKeyEvent=function(e){const t=e.getContent();t.room_id&&t.algorithm?(this._checkedForBackup||this._checkAndStartKeyBackup(),this._getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):c.logger.error("key event is missing fields")},L.prototype._onRoomKeyWithheldEvent=function(e){const t=e.getContent();if(!(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key))return void c.logger.error("key withheld event is missing fields");c.logger.info(`Got room key withheld event from ${e.getSender()} (${t.sender_key}) for ${t.algorithm}/${t.room_id}/${t.session_id} with reason ${t.code} (${t.reason})`);const r=this._getRoomDecryptor(t.room_id,t.algorithm);if(r.onRoomKeyWithheldEvent&&r.onRoomKeyWithheldEvent(e),!t.room_id){const e=this._getRoomDecryptors(t.algorithm);for(const r of e)r.retryDecryptionFromSender(t.sender_key)}},L.prototype._onKeyVerificationMessage=function(e){A.ToDeviceChannel.validateEvent(e,this._baseApis)&&this._handleVerificationEvent(e,this._toDeviceVerificationRequests,(e=>{if(!A.ToDeviceChannel.canCreateRequest(A.ToDeviceChannel.getEventType(e)))return;const t=e.getContent(),r=t&&t.from_device;if(!r)return;const n=e.getSender(),i=new A.ToDeviceChannel(this._baseApis,n,[r]);return new E.VerificationRequest(i,this._verificationMethods,this._baseApis)}))},L.prototype._onTimelineEvent=function(e,t,r,n,{liveEvent:i}={}){x.InRoomChannel.validateEvent(e,this._baseApis)&&this._handleVerificationEvent(e,this._inRoomVerificationRequests,(e=>{const t=new x.InRoomChannel(this._baseApis,e.getRoomId());return new E.VerificationRequest(t,this._verificationMethods,this._baseApis)}),i)},L.prototype._handleVerificationEvent=async function(e,t,r,n=!0){let i=t.getRequest(e),s=!1;if(!i){if(i=r(e),!i)return void c.logger.log(`Crypto: could not find VerificationRequest for ${e.getType()}, and could not create one, so ignoring.`);s=!0,t.setRequest(e,i)}e.setVerificationRequest(i);try{await i.channel.handleEvent(e,i,n)}catch(e){c.logger.error("error while handling verification event: "+e.message)}s&&!i.initiatedByMe&&!i.invalid&&!i.observeOnly&&this._baseApis.emit("crypto.verification.request",i)},L.prototype._onToDeviceBadEncrypted=async function(e){const t=e.getWireContent(),r=e.getSender(),n=t.algorithm,i=t.sender_key,s=()=>{const e=this._getRoomDecryptors(h.MEGOLM_ALGORITHM);for(const t of e)t.retryDecryptionFromSender(i)};if(void 0===r||void 0===i||void 0===i)return;this._lastNewSessionForced[r]=this._lastNewSessionForced[r]||{};const o=this._lastNewSessionForced[r][i]||0;if(o+36e5>Date.now())return c.logger.debug("New session already forced with device "+r+":"+i+" at "+o+": not forcing another"),await this._olmDevice.recordSessionProblem(i,"wedged",!0),void s();let a=this._deviceList.getDeviceByIdentityKey(n,i);if(!a&&(await this.downloadKeys([r],!1),a=this._deviceList.getDeviceByIdentityKey(n,i),!a))return c.logger.info("Couldn't find device for identity key "+i+": not re-establishing session"),await this._olmDevice.recordSessionProblem(i,"wedged",!1),void s();const l={};l[r]=[a],await h.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,l,!0),this._lastNewSessionForced[r][i]=Date.now();const u={algorithm:h.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await h.encryptMessageForDevice(u.ciphertext,this._userId,this._deviceId,this._olmDevice,r,a,{type:"m.dummy"}),await this._olmDevice.recordSessionProblem(i,"wedged",!0),s(),await this._baseApis.sendToDevice("m.room.encrypted",{[r]:{[a.deviceId]:u}});const d=await this._outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(r,a.deviceId);for(const e of d)this.requestRoomKey(e.requestBody,e.recipients,!0)},L.prototype._onRoomMembership=function(e,t,r){const n=t.roomId,i=this._roomEncryptors[n];i&&(this._roomDeviceTrackingState[n]&&("join"==t.membership?(c.logger.log("Join event for "+t.userId+" in "+n),this._deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this._clientStore.getRoom(n).shouldEncryptForInvitedMembers()&&(c.logger.log("Invite event for "+t.userId+" in "+n),this._deviceList.startTrackingDeviceList(t.userId))),i.onRoomMembership(e,t,r))},L.prototype._onRoomKeyRequestEvent=function(e){const t=e.getContent();if("request"===t.action){const t=new B(e);this._receivedRoomKeyRequests.push(t)}else if("request_cancellation"===t.action){const t=new U(e);this._receivedRoomKeyRequestCancellations.push(t)}},L.prototype._processReceivedRoomKeyRequests=async function(){if(!this._processingRoomKeyRequests){this._processingRoomKeyRequests=!0;try{const e=this._receivedRoomKeyRequests;this._receivedRoomKeyRequests=[];const t=this._receivedRoomKeyRequestCancellations;this._receivedRoomKeyRequestCancellations=[],await Promise.all(e.map((e=>this._processReceivedRoomKeyRequest(e)))),await Promise.all(t.map((e=>this._processReceivedRoomKeyRequestCancellation(e))))}catch(e){c.logger.error(`Error processing room key requsts: ${e}`)}finally{this._processingRoomKeyRequests=!1}}},L.prototype._processReceivedRoomKeyRequest=async function(e){const t=e.userId,r=e.deviceId,n=e.requestBody,i=n.room_id,s=n.algorithm;if(c.logger.log(`m.room_key_request from ${t}:${r} for ${i} / ${n.session_id} (id ${e.requestId})`),t!==this._userId){if(!this._roomEncryptors[i])return void c.logger.debug(`room key request for unencrypted room ${i}`);const e=this._roomEncryptors[i],s=this._deviceList.getStoredDevice(t,r);if(!s)return void c.logger.debug(`Ignoring keyshare for unknown device ${t}:${r}`);try{await e.reshareKeyWithDevice(n.sender_key,n.session_id,t,s)}catch(e){c.logger.warn("Failed to re-share keys for session "+n.session_id+" with device "+t+":"+s.deviceId,e)}return}if(r===this._deviceId)return void c.logger.log("Ignoring room key request from ourselves");if(!this._roomDecryptors[i])return void c.logger.log(`room key request for unencrypted room ${i}`);const o=this._roomDecryptors[i][s];if(o)if(await o.hasKeysForKeyRequest(e)){if(e.share=()=>{o.shareKeysWithDevice(e)},this.checkDeviceTrust(t,r).isVerified())return c.logger.log("device is already verified: sharing keys"),void e.share();this.emit("crypto.roomKeyRequest",e)}else c.logger.log(`room key request for unknown session ${i} / `+n.session_id);else c.logger.log(`room key request for unknown alg ${s} in room ${i}`)},L.prototype._processReceivedRoomKeyRequestCancellation=async function(e){c.logger.log(`m.room_key_request cancellation for ${e.userId}:${e.deviceId} (id ${e.requestId})`),this.emit("crypto.roomKeyRequestCancellation",e)},L.prototype._getRoomDecryptor=function(e,t){let r,n;if((e=e||null)&&(r=this._roomDecryptors[e],r||(this._roomDecryptors[e]=r={}),n=r[t],n))return n;const i=f.DECRYPTION_CLASSES[t];if(!i)throw new f.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return n=new i({userId:this._userId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:e}),r&&(r[t]=n),n},L.prototype._getRoomDecryptors=function(e){const t=[];for(const r of Object.values(this._roomDecryptors))e in r&&t.push(r[e]);return t},L.prototype._signObject=async function(e){const t=e.signatures||{},r=e.unsigned;delete e.signatures,delete e.unsigned,t[this._userId]=t[this._userId]||{},t[this._userId]["ed25519:"+this._deviceId]=await this._olmDevice.sign(s.default.stringify(e)),e.signatures=t,void 0!==r&&(e.unsigned=r)};class B{constructor(e){const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}class U{constructor(e){const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}},1597:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyFromAuthData=async function(e,t){if(!r.g.Olm)throw new Error("Olm is not available");if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return await s(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits||256)},t.keyFromPassphrase=async function(e){if(!r.g.Olm)throw new Error("Olm is not available");const t=(0,n.randomString)(32);return{key:await s(e,t,i,256),salt:t,iterations:i}},t.deriveKey=s;var n=r(8401);const i=5e5;async function s(e,t,n,i=256){const s=r.g.crypto.subtle,o=r.g.TextEncoder;if(!s||!o)throw new Error("Password-based backup is not avaiable on this platform");const a=await s.importKey("raw",(new o).encode(e),{name:"PBKDF2"},!1,["deriveBits"]),c=await s.deriveBits({name:"PBKDF2",salt:(new o).encode(t),iterations:n,hash:"SHA-512"},a,i);return new Uint8Array(c)}},2772:(e,t,r)=>{"use strict";var n=r(5318),i=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMessageForDevice=async function(e,t,r,n,i,a,c){const l=a.getIdentityKey(),u=await n.getSessionIdForDevice(l);if(null===u)return;s.logger.log("Using sessionid "+u+" for device "+i+":"+a.deviceId);const h={sender:t,sender_device:r,keys:{ed25519:n.deviceEd25519Key},recipient:i,recipient_keys:{ed25519:a.getFingerprint()}};o.extend(h,c),e[l]=await n.encryptMessage(l,u,JSON.stringify(h))},t.getExistingOlmSessions=async function(e,t,r){const n={},i={},s=[];for(const[t,o]of Object.entries(r))for(const r of o){const o=r.deviceId,a=r.getIdentityKey();s.push((async()=>{const s=await e.getSessionIdForDevice(a,!0);null===s?(n[t]=n[t]||[],n[t].push(r)):(i[t]=i[t]||{},i[t][o]={device:r,sessionId:s})})())}return await Promise.all(s),[n,i]},t.ensureOlmSessionsForDevices=async function(e,t,r,n,i,o,a){"number"==typeof n&&(a=o,o=i,i=n,n=!1),a||(a=s.logger);const l=[],u={},h={};for(const[,t]of Object.entries(r))for(const r of t){const t=r.getIdentityKey();t!==e.deviceCurve25519Key&&(e._sessionsInProgress[t]||(e._sessionsInProgress[t]=new Promise((r=>{h[t]=(...n)=>{delete e._sessionsInProgress[t],r(...n)}}))))}for(const[t,i]of Object.entries(r)){u[t]={};for(const r of i){const i=r.deviceId,s=r.getIdentityKey();if(s===e.deviceCurve25519Key){a.info("Attempted to start session with ourself! Ignoring"),u[t][i]={device:r,sessionId:null};continue}const o=`for ${s} (${t}:${i})`,c=await e.getSessionIdForDevice(s,h[s],a);null!==c&&h[s]&&h[s](),(null===c||n)&&(n?a.info(`Forcing new Olm session ${o}`):a.info(`Making new Olm session ${o}`),l.push([t,i])),u[t][i]={device:r,sessionId:c}}}if(0===l.length)return u;let d,p=`one-time keys for ${l.length} devices`;try{a.debug(`Claiming ${p}`),d=await t.claimOneTimeKeys(l,"signed_curve25519",i),a.debug(`Claimed ${p}`)}catch(e){for(const e of Object.values(h))e();throw a.log(`Failed to claim ${p}`,e,l),e}o&&"failures"in d&&o.push(...Object.keys(d.failures));const f=d.one_time_keys||{},g=[];for(const[t,i]of Object.entries(r)){const r=f[t]||{};for(let s=0;s<i.length;s++){const o=i[s],l=o.deviceId,d=o.getIdentityKey();if(d===e.deviceCurve25519Key)continue;if(u[t][l].sessionId&&!n)continue;const p=r[l]||{};let f=null;for(const e in p)0===e.indexOf("signed_curve25519:")&&(f=p[e]);f?g.push(c(e,f,t,o).then((e=>{h[d]&&h[d](e),u[t][l].sessionId=e}),(e=>{throw h[d]&&h[d](),e}))):(a.warn(`No one-time keys (alg=signed_curve25519) for device ${t}:${l}`),h[d]&&h[d]())}}return p=`Olm sessions for ${g.length} devices`,a.debug(`Starting ${p}`),await Promise.all(g),a.debug(`Started ${p}`),u},t.verifySignature=l,t.pkSign=function(e,t,n,i){let s=!1;if(t instanceof Uint8Array){const e=new r.g.Olm.PkSigning;i=e.init_with_seed(t),t=e,s=!0}const o=e.signatures||{};delete e.signatures;const c=e.unsigned;e.unsigned&&delete e.unsigned;try{const r=o[n]||{};return o[n]=r,r["ed25519:"+i]=t.sign(a.default.stringify(e))}finally{e.signatures=o,c&&(e.unsigned=c),s&&t.free()}},t.pkVerify=function(e,t,n){const i="ed25519:"+t;if(!(e.signatures&&e.signatures[n]&&e.signatures[n][i]))throw new Error("No signature");const s=e.signatures[n][i],o=new r.g.Olm.Utility,c=e.signatures;delete e.signatures;const l=e.unsigned;e.unsigned&&delete e.unsigned;try{o.ed25519_verify(t,a.default.stringify(e),s)}finally{e.signatures=c,l&&(e.unsigned=l),o.free()}},t.encodeBase64=u,t.encodeUnpaddedBase64=function(e){return u(e).replace(/=+$/g,"")},t.decodeBase64=function(e){return Buffer.from(e,"base64")},t.MEGOLM_BACKUP_ALGORITHM=t.MEGOLM_ALGORITHM=t.OLM_ALGORITHM=void 0;var s=r(7434),o=i(r(3102)),a=n(r(9141));async function c(e,t,r,n){const i=n.deviceId;try{await l(e,t,r,i,n.getFingerprint())}catch(e){return s.logger.error("Unable to verify signature on one-time key for device "+r+":"+i+":",e),null}let o;try{o=await e.createOutboundSession(n.getIdentityKey(),t.key)}catch(e){return s.logger.error("Error starting olm session with device "+r+":"+i+": "+e),null}return s.logger.log("Started new olm sessionid "+o+" for device "+r+":"+i),o}async function l(e,t,r,n,i){const s="ed25519:"+n,o=((t.signatures||{})[r]||{})[s];if(!o)throw Error("No signature");const c=Object.assign({},t);delete c.unsigned,delete c.signatures;const l=a.default.stringify(c);e.verifySignature(i,l,o)}function u(e){return Buffer.from(e).toString("base64")}t.OLM_ALGORITHM="m.olm.v1.curve25519-aes-sha2",t.MEGOLM_ALGORITHM="m.megolm.v1.aes-sha2",t.MEGOLM_BACKUP_ALGORITHM="m.megolm_backup.v1.curve25519-aes-sha2"},4077:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeRecoveryKey=function(e){const t=new Buffer(s.length+e.length+1);t.set(s,0),t.set(e,s.length);let r=0;for(let e=0;e<t.length-1;++e)r^=t[e];return t[t.length-1]=r,i.default.encode(t).match(/.{1,4}/g).join(" ")},t.decodeRecoveryKey=function(e){const t=i.default.decode(e.replace(/ /g,""));let n=0;for(const e of t)n^=e;if(0!==n)throw new Error("Incorrect parity");for(let e=0;e<s.length;++e)if(t[e]!==s[e])throw new Error("Incorrect prefix");if(t.length!==s.length+r.g.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(s.length,s.length+r.g.Olm.PRIVATE_KEY_LENGTH))};var i=n(r(7191));const s=[139,1]},5251:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeDatabase=function(e,t){i.logger.log(`Upgrading IndexedDBCryptoStore from version ${t} to 9`),t<1&&function(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e),t<2&&e.createObjectStore("account"),t<3&&e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey"),t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]}),t<5&&e.createObjectStore("device_data"),t<6&&e.createObjectStore("rooms"),t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]}),t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]}),t<9&&(e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]}))},t.Backend=t.VERSION=void 0;var i=r(7434),s=n(r(3102));function o(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function a(e){return new Promise(((t,r)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&r(e._mx_abortexception),t()},e.onerror=t=>{void 0!==e._mx_abortexception?r(e._mx_abortexception):(i.logger.log("Error performing indexeddb txn",t),r(t.target.error))},e.onabort=t=>{void 0!==e._mx_abortexception?r(e._mx_abortexception):(i.logger.log("Error performing indexeddb txn",t),r(t.target.error))}}))}t.VERSION=9,t.Backend=class{constructor(e){this._db=e,this._nextTxnId=0,e.onversionchange=t=>{i.logger.log(`versionchange for indexeddb ${this._dbName}: closing`),e.close()}}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise(((r,n)=>{const s=this._db.transaction("outgoingRoomKeyRequests","readwrite");s.onerror=n,this._getOutgoingRoomKeyRequest(s,t,(n=>{if(n)return i.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),void r(n);i.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),s.oncomplete=()=>{r(e)},s.objectStore("outgoingRoomKeyRequests").add(e)}))}))}getOutgoingRoomKeyRequest(e){return new Promise(((t,r)=>{const n=this._db.transaction("outgoingRoomKeyRequests","readonly");n.onerror=r,this._getOutgoingRoomKeyRequest(n,e,(e=>{t(e)}))}))}_getOutgoingRoomKeyRequest(e,t,r){e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]).onsuccess=e=>{const n=e.target.result;if(!n)return void r(null);const i=n.value;s.deepCompare(i.requestBody,t)?r(i):n.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,r=0;const n=this._db.transaction("outgoingRoomKeyRequests","readonly"),i=n.objectStore("outgoingRoomKeyRequests"),s=e[r];return i.index("state").openCursor(s).onsuccess=function n(i){const s=i.target.result;if(s)return void(t=s.value);if(r++,r>=e.length)return;const o=e[r];i.target.source.openCursor(o).onsuccess=n},a(n).then((()=>t))}getAllOutgoingRoomKeyRequestsByState(e){return new Promise(((t,r)=>{const n=this._db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);n.onsuccess=e=>t(e.target.result),n.onerror=e=>r(e.target.error)}))}getOutgoingRoomKeyRequestsByTarget(e,t,r){let n=0;const i=[],s=this._db.transaction("outgoingRoomKeyRequests","readonly"),o=s.objectStore("outgoingRoomKeyRequests"),c=r[n];return o.index("state").openCursor(c).onsuccess=function s(o){const a=o.target.result;if(a){const r=a.value;r.recipients.includes({userId:e,deviceId:t})&&i.push(r),a.continue()}else{if(n++,n>=r.length)return;const e=r[n];o.target.source.openCursor(e).onsuccess=s}},a(s).then((()=>i))}updateOutgoingRoomKeyRequest(e,t,r){let n=null;const s=this._db.transaction("outgoingRoomKeyRequests","readwrite");return s.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(e){const s=e.target.result;if(!s)return;const o=s.value;o.state==t?(Object.assign(o,r),s.update(o),n=o):i.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${o.state}`)},a(s).then((()=>n))}deleteOutgoingRoomKeyRequest(e,t){const r=this._db.transaction("outgoingRoomKeyRequests","readwrite");return r.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=e=>{const r=e.target.result;if(!r)return;const n=r.value;n.state==t?r.delete():i.logger.warn(`Cannot delete room key request in state ${n.state} (expected ${t})`)},a(r)}getAccount(e,t){const r=e.objectStore("account").get("-");r.onsuccess=function(){try{t(r.result||null)}catch(t){o(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const r=e.objectStore("account").get("crossSigningKeys");r.onsuccess=function(){try{t(r.result||null)}catch(t){o(e,t)}}}getSecretStorePrivateKey(e,t,r){const n=e.objectStore("account").get(`ssss_cache:${r}`);n.onsuccess=function(){try{t(n.result||null)}catch(t){o(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,r){e.objectStore("account").put(r,`ssss_cache:${t}`)}countEndToEndSessions(e,t){const r=e.objectStore("sessions").count();r.onsuccess=function(){try{t(r.result)}catch(t){o(e,t)}}}getEndToEndSessions(e,t,r){const n=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};n.onsuccess=function(){const e=n.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{r(i)}catch(e){o(t,e)}}}getEndToEndSession(e,t,r,n){const i=r.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?n({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):n(null)}catch(e){o(r,e)}}}getAllEndToEndSessions(e,t){const r=e.objectStore("sessions").openCursor();r.onsuccess=function(){try{const e=r.result;e?(t(e.value),e.continue()):t(null)}catch(t){o(e,t)}}}storeEndToEndSession(e,t,r,n){n.objectStore("sessions").put({deviceKey:e,sessionId:t,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,t,r){const n=this._db.transaction("session_problems","readwrite");return n.objectStore("session_problems").put({deviceKey:e,type:t,fixed:r,time:Date.now()}),a(n)}async getEndToEndSessionProblem(e,t){let r;const n=this._db.transaction("session_problems","readwrite"),i=n.objectStore("session_problems").index("deviceKey").getAll(e);return i.onsuccess=e=>{const n=i.result;if(!n.length)return void(r=null);n.sort(((e,t)=>e.time-t.time));const s=n[n.length-1];for(const e of n)if(e.time>t)return void(r=Object.assign({},e,{fixed:s.fixed}));r=s.fixed?null:s},await a(n),r}async filterOutNotifiedErrorDevices(e){const t=this._db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),r=[];return await Promise.all(e.map((e=>new Promise((n=>{const{userId:i,deviceInfo:s}=e,o=t.get([i,s.deviceId]);o.onsuccess=function(){o.result||(t.put({userId:i,deviceId:s.deviceId}),r.push(e)),n()}}))))),r}getEndToEndInboundGroupSession(e,t,r,n){let i=!1,s=!1;const a=r.objectStore("inbound_group_sessions").get([e,t]);a.onsuccess=function(){try{i=a.result?a.result.session:null,!1!==s&&n(i,s)}catch(e){o(r,e)}};const c=r.objectStore("inbound_group_sessions_withheld").get([e,t]);c.onsuccess=function(){try{s=c.result?c.result.session:null,!1!==i&&n(i,s)}catch(e){o(r,e)}}}getAllEndToEndInboundGroupSessions(e,t){const r=e.objectStore("inbound_group_sessions").openCursor();r.onsuccess=function(){const n=r.result;if(n){try{t({senderKey:n.value.senderCurve25519Key,sessionId:n.value.sessionId,sessionData:n.value.session})}catch(t){o(e,t)}n.continue()}else try{t(null)}catch(t){o(e,t)}}}addEndToEndInboundGroupSession(e,t,r,n){const s=n.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:r});s.onerror=r=>{"ConstraintError"===s.error.name?(r.stopPropagation(),r.preventDefault(),i.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):o(n,new Error("Failed to add inbound group session: "+s.error))}}storeEndToEndInboundGroupSession(e,t,r,n){n.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:r})}storeEndToEndInboundGroupSessionWithheld(e,t,r,n){n.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:r})}getEndToEndDeviceData(e,t){const r=e.objectStore("device_data").get("-");r.onsuccess=function(){try{t(r.result||null)}catch(t){o(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,r){r.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){const r={},n=e.objectStore("rooms").openCursor();n.onsuccess=function(){const i=n.result;if(i)r[i.key]=i.value,i.continue();else try{t(r)}catch(t){o(e,t)}}}getSessionsNeedingBackup(e){return new Promise(((t,r)=>{const n=[],i=this._db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");i.onerror=r,i.oncomplete=function(){t(n)};const s=i.objectStore("sessions_needing_backup"),o=i.objectStore("inbound_group_sessions"),a=s.openCursor();a.onsuccess=function(){const t=a.result;if(t){const r=o.get(t.key);r.onsuccess=function(){n.push({senderKey:r.result.senderCurve25519Key,sessionId:r.result.sessionId,sessionData:r.result.session})},(!e||n.length<e)&&t.continue()}}}))}countSessionsNeedingBackup(e){e||(e=this._db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise(((e,r)=>{const n=t.count();n.onerror=r,n.onsuccess=()=>e(n.result)}))}unmarkSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const r=t.objectStore("sessions_needing_backup");return Promise.all(e.map((e=>new Promise(((t,n)=>{const i=r.delete([e.senderKey,e.sessionId]);i.onsuccess=t,i.onerror=n})))))}markSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const r=t.objectStore("sessions_needing_backup");return Promise.all(e.map((e=>new Promise(((t,n)=>{const i=r.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=n})))))}doTxn(e,t,r,n=i.logger){const s=this._db.transaction(t,e),o=a(s),c=r(s);return o.then((()=>c))}}},7585:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var i=r(7434),s=r(4250),o=r(1045),a=n(r(5251)),c=r(9489),l=n(r(3415));class u{constructor(e,t){this._indexedDB=e,this._dbName=t,this._backendPromise=null,this._backend=null}static exists(e,t){return l.exists(e,t)}startup(){return this._backendPromise||(this._backendPromise=new Promise(((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));i.logger.log(`connecting to indexeddb ${this._dbName}`);const r=this._indexedDB.open(this._dbName,a.VERSION);r.onupgradeneeded=e=>{const t=e.target.result,r=e.oldVersion;a.upgradeDatabase(t,r)},r.onblocked=()=>{i.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=e=>{i.logger.log("Error connecting to indexeddb",e),t(e.target.error)},r.onsuccess=t=>{const r=t.target.result;i.logger.log(`connected to indexeddb ${this._dbName}`),e(new a.Backend(r))}})).then((e=>e.doTxn("readonly",[u.STORE_INBOUND_GROUP_SESSIONS,u.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(t=>{e.getEndToEndInboundGroupSession("","",t,(()=>{}))})).then((()=>e)))).catch((e=>{if("VersionError"===e.name)throw i.logger.warn("Crypto DB is too new for us to use!",e),new c.InvalidCryptoStoreError(c.InvalidCryptoStoreError.TOO_NEW);i.logger.warn(`unable to connect to indexeddb ${this._dbName}: falling back to localStorage store: ${e}`);try{return new s.LocalStorageCryptoStore(r.g.localStorage)}catch(e){return i.logger.warn(`unable to open localStorage: falling back to in-memory store: ${e}`),new o.MemoryCryptoStore}})).then((e=>{this._backend=e}))),this._backendPromise}deleteAllData(){return new Promise(((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));i.logger.log(`Removing indexeddb instance: ${this._dbName}`);const r=this._indexedDB.deleteDatabase(this._dbName);r.onblocked=()=>{i.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=e=>{i.logger.log("Error deleting data from indexeddb",e),t(e.target.error)},r.onsuccess=()=>{i.logger.log(`Removed indexeddb instance: ${this._dbName}`),e()}})).catch((e=>{i.logger.warn(`unable to delete IndexedDBCryptoStore: ${e}`)}))}getOrAddOutgoingRoomKeyRequest(e){return this._backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this._backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this._backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this._backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,r){return this._backend.getOutgoingRoomKeyRequestsByTarget(e,t,r)}updateOutgoingRoomKeyRequest(e,t,r){return this._backend.updateOutgoingRoomKeyRequest(e,t,r)}deleteOutgoingRoomKeyRequest(e,t){return this._backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this._backend.getAccount(e,t)}storeAccount(e,t){this._backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this._backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,r){this._backend.getSecretStorePrivateKey(e,t,r)}storeCrossSigningKeys(e,t){this._backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,r){this._backend.storeSecretStorePrivateKey(e,t,r)}countEndToEndSessions(e,t){this._backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,r,n){this._backend.getEndToEndSession(e,t,r,n)}getEndToEndSessions(e,t,r){this._backend.getEndToEndSessions(e,t,r)}getAllEndToEndSessions(e,t){this._backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,r,n){this._backend.storeEndToEndSession(e,t,r,n)}storeEndToEndSessionProblem(e,t,r){return this._backend.storeEndToEndSessionProblem(e,t,r)}getEndToEndSessionProblem(e,t){return this._backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this._backend.filterOutNotifiedErrorDevices(e)}getEndToEndInboundGroupSession(e,t,r,n){this._backend.getEndToEndInboundGroupSession(e,t,r,n)}getAllEndToEndInboundGroupSessions(e,t){this._backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,r,n){this._backend.addEndToEndInboundGroupSession(e,t,r,n)}storeEndToEndInboundGroupSession(e,t,r,n){this._backend.storeEndToEndInboundGroupSession(e,t,r,n)}storeEndToEndInboundGroupSessionWithheld(e,t,r,n){this._backend.storeEndToEndInboundGroupSessionWithheld(e,t,r,n)}storeEndToEndDeviceData(e,t){this._backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this._backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,r){this._backend.storeEndToEndRoom(e,t,r)}getEndToEndRooms(e,t){this._backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this._backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this._backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this._backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this._backend.markSessionsNeedingBackup(e,t)}doTxn(e,t,r,n){return this._backend.doTxn(e,t,r,n)}}t.IndexedDBCryptoStore=u,u.STORE_ACCOUNT="account",u.STORE_SESSIONS="sessions",u.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",u.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",u.STORE_DEVICE_DATA="device_data",u.STORE_ROOMS="rooms",u.STORE_BACKUP="sessions_needing_backup"},4250:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageCryptoStore=void 0;var n=r(7434),i=r(1045);const s="crypto.account",o="crypto.cross_signing_keys",a="crypto.notified_error_devices",c="crypto.device_data",l="crypto.inboundgroupsessions/",u="crypto.sessionsneedingbackup";function h(e){return"crypto.sessions/"+e}function d(e){return"crypto.session.problems/"+e}function p(e,t){return l+e+"/"+t}function f(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function g(e){return"crypto.rooms/"+e}class m extends i.MemoryCryptoStore{constructor(e){super(),this.store=e}static exists(e){const t=e.length;for(let r=0;r<t;r++)if(e.key(r).startsWith("crypto."))return!0;return!1}countEndToEndSessions(e,t){let r=0;for(let e=0;e<this.store.length;++e)this.store.key(e).startsWith(h(""))&&++r;t(r)}_getEndToEndSessions(e,t,r){const n=y(this.store,h(e)),i={};for(const[e,t]of Object.entries(n||{}))i[e]="string"==typeof t?{session:t}:t;return i}getEndToEndSession(e,t,r,n){n(this._getEndToEndSessions(e)[t]||{})}getEndToEndSessions(e,t,r){r(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let e=0;e<this.store.length;++e)if(this.store.key(e).startsWith(h(""))){const r=this.store.key(e).split("/")[1];for(const e of Object.values(this._getEndToEndSessions(r)))t(e)}}storeEndToEndSession(e,t,r,n){const i=this._getEndToEndSessions(e)||{};i[t]=r,v(this.store,h(e),i)}async storeEndToEndSessionProblem(e,t,r){const n=d(e),i=y(this.store,n)||[];i.push({type:t,fixed:r,time:Date.now()}),i.sort(((e,t)=>e.time-t.time)),v(this.store,n,i)}async getEndToEndSessionProblem(e,t){const r=d(e),n=y(this.store,r)||[];if(!n.length)return null;const i=n[n.length-1];for(const e of n)if(e.time>t)return Object.assign({},e,{fixed:i.fixed});return i.fixed?null:i}async filterOutNotifiedErrorDevices(e){const t=y(this.store,a)||{},r=[];for(const n of e){const{userId:e,deviceInfo:i}=n;e in t?i.deviceId in t[e]||(r.push(n),t[e][i.deviceId]=!0):(r.push(n),t[e]={[i.deviceId]:!0})}return v(this.store,a,t),r}getEndToEndInboundGroupSession(e,t,r,n){n(y(this.store,p(e,t)),y(this.store,f(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let e=0;e<this.store.length;++e){const r=this.store.key(e);r.startsWith(l)&&t({senderKey:r.substr(l.length,43),sessionId:r.substr(l.length+44),sessionData:y(this.store,r)})}t(null)}addEndToEndInboundGroupSession(e,t,r,n){y(this.store,p(e,t))||this.storeEndToEndInboundGroupSession(e,t,r,n)}storeEndToEndInboundGroupSession(e,t,r,n){v(this.store,p(e,t),r)}storeEndToEndInboundGroupSessionWithheld(e,t,r,n){v(this.store,f(e,t),r)}getEndToEndDeviceData(e,t){t(y(this.store,c))}storeEndToEndDeviceData(e,t){v(this.store,c,e)}storeEndToEndRoom(e,t,r){v(this.store,g(e),t)}getEndToEndRooms(e,t){const r={},n=g("");for(let e=0;e<this.store.length;++e){const t=this.store.key(e);t.startsWith(n)&&(r[t.substr(n.length)]=y(this.store,t))}t(r)}getSessionsNeedingBackup(e){const t=y(this.store,u)||{},r=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const t=n.substr(0,43),i=n.substr(44);if(this.getEndToEndInboundGroupSession(t,i,null,(e=>{r.push({senderKey:t,sessionId:i,sessionData:e})})),e&&n.length>=e)break}return Promise.resolve(r)}countSessionsNeedingBackup(){const e=y(this.store,u)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=y(this.store,u)||{};for(const r of e)delete t[r.senderKey+"/"+r.sessionId];return v(this.store,u,t),Promise.resolve()}markSessionsNeedingBackup(e){const t=y(this.store,u)||{};for(const r of e)t[r.senderKey+"/"+r.sessionId]=!0;return v(this.store,u,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(s),Promise.resolve()}getAccount(e,t){t(y(this.store,s))}storeAccount(e,t){v(this.store,s,t)}getCrossSigningKeys(e,t){t(y(this.store,o))}getSecretStorePrivateKey(e,t,r){t(y(this.store,`crypto.ssss_cache.${r}`))}storeCrossSigningKeys(e,t){v(this.store,o,t)}storeSecretStorePrivateKey(e,t,r){v(this.store,`crypto.ssss_cache.${t}`,r)}doTxn(e,t,r){return Promise.resolve(r(null))}}function y(e,t){try{return JSON.parse(e.getItem(t))}catch(e){n.logger.log("Error: Failed to get key %s: %s",t,e.stack||e),n.logger.log(e.stack)}return null}function v(e,t,r){e.setItem(t,JSON.stringify(r))}t.LocalStorageCryptoStore=m},1045:(e,t,r)=>{"use strict";var n=r(862),i=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var s=i(r(9713)),o=r(7434),a=n(r(3102));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.MemoryCryptoStore=class{constructor(){this._outgoingRoomKeyRequests=[],this._account=null,this._crossSigningKeys=null,this._privateKeys={},this._backupKeys={},this._sessions={},this._sessionProblems={},this._notifiedErrorDevices={},this._inboundGroupSessions={},this._inboundGroupSessionsWithheld={},this._deviceData=null,this._rooms={},this._sessionsNeedingBackup={}}async startup(){return this}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return a.promiseTry((()=>{const r=this._getOutgoingRoomKeyRequest(t);return r?(o.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),r):(o.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this._outgoingRoomKeyRequests.push(e),e)}))}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this._outgoingRoomKeyRequests)if(a.deepCompare(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this._outgoingRoomKeyRequests)for(const r of e)if(t.state===r)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this._outgoingRoomKeyRequests.filter((t=>t.state==e)))}getOutgoingRoomKeyRequestsByTarget(e,t,r){const n=[];for(const i of this._outgoingRoomKeyRequests)for(const s of r)i.state===s&&i.recipients.includes({userId:e,deviceId:t})&&n.push(i);return Promise.resolve(n)}updateOutgoingRoomKeyRequest(e,t,r){for(const n of this._outgoingRoomKeyRequests)if(n.requestId===e)return n.state!=t?(o.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${n.state}`),Promise.resolve(null)):(Object.assign(n,r),Promise.resolve(n));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let r=0;r<this._outgoingRoomKeyRequests.length;r++){const n=this._outgoingRoomKeyRequests[r];if(n.requestId===e)return n.state!=t?(o.logger.warn(`Cannot delete room key request in state ${n.state} (expected ${t})`),Promise.resolve(null)):(this._outgoingRoomKeyRequests.splice(r,1),Promise.resolve(n))}return Promise.resolve(null)}getAccount(e,t){t(this._account)}storeAccount(e,t){this._account=t}getCrossSigningKeys(e,t){t(this._crossSigningKeys)}getSecretStorePrivateKey(e,t,r){return t(this._privateKeys[r]||null)}storeCrossSigningKeys(e,t){this._crossSigningKeys=t}storeSecretStorePrivateKey(e,t,r){this._privateKeys[t]=r}countEndToEndSessions(e,t){return Object.keys(this._sessions).length}getEndToEndSession(e,t,r,n){n((this._sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,r){r(this._sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this._sessions).forEach((([e,r])=>{Object.entries(r).forEach((([r,n])=>{t(l(l({},n),{},{deviceKey:e,sessionId:r}))}))}))}storeEndToEndSession(e,t,r,n){let i=this._sessions[e];void 0===i&&(i={},this._sessions[e]=i),i[t]=r}async storeEndToEndSessionProblem(e,t,r){const n=this._sessionProblems[e]=this._sessionProblems[e]||[];n.push({type:t,fixed:r,time:Date.now()}),n.sort(((e,t)=>e.time-t.time))}async getEndToEndSessionProblem(e,t){const r=this._sessionProblems[e]||[];if(!r.length)return null;const n=r[r.length-1];for(const e of r)if(e.time>t)return Object.assign({},e,{fixed:n.fixed});return n.fixed?null:n}async filterOutNotifiedErrorDevices(e){const t=this._notifiedErrorDevices,r=[];for(const n of e){const{userId:e,deviceInfo:i}=n;e in t?i.deviceId in t[e]||(r.push(n),t[e][i.deviceId]=!0):(r.push(n),t[e]={[i.deviceId]:!0})}return r}getEndToEndInboundGroupSession(e,t,r,n){const i=e+"/"+t;n(this._inboundGroupSessions[i]||null,this._inboundGroupSessionsWithheld[i]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const e of Object.keys(this._inboundGroupSessions))t({senderKey:e.substr(0,43),sessionId:e.substr(44),sessionData:this._inboundGroupSessions[e]});t(null)}addEndToEndInboundGroupSession(e,t,r,n){const i=e+"/"+t;void 0===this._inboundGroupSessions[i]&&(this._inboundGroupSessions[i]=r)}storeEndToEndInboundGroupSession(e,t,r,n){this._inboundGroupSessions[e+"/"+t]=r}storeEndToEndInboundGroupSessionWithheld(e,t,r,n){const i=e+"/"+t;this._inboundGroupSessionsWithheld[i]=r}getEndToEndDeviceData(e,t){t(this._deviceData)}storeEndToEndDeviceData(e,t){this._deviceData=e}storeEndToEndRoom(e,t,r){this._rooms[e]=t}getEndToEndRooms(e,t){t(this._rooms)}getSessionsNeedingBackup(e){const t=[];for(const r in this._sessionsNeedingBackup)if(this._inboundGroupSessions[r]&&(t.push({senderKey:r.substr(0,43),sessionId:r.substr(44),sessionData:this._inboundGroupSessions[r]}),e&&r.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this._sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this._sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this._sessionsNeedingBackup[e]=!0}return Promise.resolve()}doTxn(e,t,r){return Promise.resolve(r(null))}}},1631:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationBase=t.SwitchStartEventError=void 0;var n=r(4369),i=r(7187),s=r(7434),o=r(3272),a=r(6702),c=r(3075);const l=new Error("Verification timed out");class u extends Error{constructor(e){super(),this.startEvent=e}}t.SwitchStartEventError=u;class h extends i.EventEmitter{constructor(e,t,r,n,i,s){super(),this._channel=e,this._baseApis=t,this.userId=r,this.deviceId=n,this.startEvent=i,this.request=s,this.cancelled=!1,this._done=!1,this._promise=null,this._transactionTimeoutTimer=null}get initiatedByMe(){if(!this.startEvent)return!0;const e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this._baseApis.getUserId()&&t.from_device===this._baseApis.getDeviceId()}_resetTimer(){s.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this._transactionTimeoutTimer&&clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=setTimeout((()=>{this._done||this.cancelled||(s.logger.info("Triggering verification timeout"),this.cancel(l))}),6e5)}_endTimer(){null!==this._transactionTimeoutTimer&&(clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=null)}_send(e,t){return this._channel.send(e,t)}_waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));const t=this.request.getEventFromOtherParty(e);return t?Promise.resolve(t):(this._expectedEvent=e,new Promise(((e,t)=>{this._resolveEvent=e,this._rejectEvent=t})))}canSwitchStartEvent(){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(s.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this._rejectEvent}),this._rejectEvent){const t=this._rejectEvent;this._rejectEvent=void 0,t(new u(e))}else this.startEvent=e}handleEvent(e){if(!this._done)if(e.getType()===this._expectedEvent)"m.key.verification.done"!==this._expectedEvent&&(this._expectedEvent=void 0,this._rejectEvent=void 0,this._resetTimer(),this._resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){const t=this._reject;if(this._reject=void 0,t){const r=e.getContent(),{reason:n,code:i}=r;t(new Error(`Other side cancelled verification because ${n} (${i})`))}}else if(this._expectedEvent){const t=new Error("Unexpected message: expecting "+this._expectedEvent+" but got "+e.getType());if(this._expectedEvent=void 0,this._rejectEvent){const e=this._rejectEvent;this._rejectEvent=void 0,e(t)}this.cancel(t)}}done(){if(this._endTimer(),!this._done)return this.request.onVerifierFinished(),this._resolve(),(0,c.requestKeysDuringVerification)(this._baseApis,this.userId,this.deviceId)}cancel(e){if(this._endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===l){const e=(0,a.newTimeoutError)();this._send(e.getType(),e.getContent())}else if(e instanceof n.MatrixEvent){if(e.getSender()!==this.userId){const t=e.getContent();"m.key.verification.cancel"===e.getType()?(t.code=t.code||"m.unknown",t.reason=t.reason||t.body||"Unknown reason",this._send("m.key.verification.cancel",t)):this._send("m.key.verification.cancel",{code:"m.unknown",reason:t.body||"Unknown reason"})}}else this._send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this._promise?this._reject&&this._reject(e):this._promise=Promise.reject(e),this.emit("cancel",e)}}verify(){return this._promise||(this._promise=new Promise(((e,t)=>{this._resolve=(...t)=>{this._done=!0,this._endTimer(),e(...t)},this._reject=(...e)=>{this._done=!0,this._endTimer(),t(...e)}})),this._doVerification&&!this._started&&(this._started=!0,this._resetTimer(),Promise.resolve(this._doVerification()).then(this.done.bind(this),this.cancel.bind(this)))),this._promise}async _verifyKeys(e,t,r){const n=[];for(const[i,a]of Object.entries(t)){const t=i.split(":",2)[1],c=this._baseApis.getStoredDevice(e,t);if(c)await r(i,c,a),n.push(t);else{const c=this._baseApis._crypto._deviceList.getStoredCrossSigningForUser(e);c&&c.getId()===t?(await r(i,o.DeviceInfo.fromStorage({keys:{[i]:t}},t),a),n.push(t)):s.logger.warn(`verification: Could not find device ${t} to verify`)}}if(!n.length)throw new Error("No devices could be verified");s.logger.info("Verification completed! Marking devices verified: ",n);for(const t of n)await this._baseApis.setDeviceVerified(e,t)}}t.VerificationBase=h},6702:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newVerificationError=i,t.errorFactory=s,t.errorFromEvent=function(e){const t=e.getContent();if(t){const{code:e,reason:r}=t;return{code:e,reason:r}}return{code:"Unknown error",reason:"m.unknown"}},t.newInvalidMessageError=t.newUserMismatchError=t.newKeyMismatchError=t.newUnexpectedMessageError=t.newUnknownMethodError=t.newUnknownTransactionError=t.newTimeoutError=t.newUserCancelledError=void 0;var n=r(4369);function i(e,t,r){const i=Object.assign({},{code:e,reason:t},r);return new n.MatrixEvent({type:"m.key.verification.cancel",content:i})}function s(e,t){return function(r){return i(e,t,r)}}const o=s("m.user","Cancelled by user");t.newUserCancelledError=o;const a=s("m.timeout","Timed out");t.newTimeoutError=a;const c=s("m.unknown_transaction","Unknown transaction");t.newUnknownTransactionError=c;const l=s("m.unknown_method","Unknown method");t.newUnknownMethodError=l;const u=s("m.unexpected_message","Unexpected message");t.newUnexpectedMessageError=u;const h=s("m.key_mismatch","Key mismatch");t.newKeyMismatchError=h;const d=s("m.user_error","User mismatch");t.newUserMismatchError=d;const p=s("m.invalid_message","Invalid message");t.newInvalidMessageError=p},4028:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IllegalMethod=void 0;var n=r(1631);class i extends n.VerificationBase{static factory(...e){return new i(...e)}static get NAME(){return"org.matrix.illegal_method"}async _doVerification(){throw new Error("Verification is not possible with this method")}}t.IllegalMethod=i},1696:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QRCodeData=t.ReciprocateQRCode=t.SCAN_QR_CODE_METHOD=t.SHOW_QR_CODE_METHOD=void 0;var n=r(1631),i=r(6702),s=r(2772),o=r(7434);t.SHOW_QR_CODE_METHOD="m.qr_code.show.v1",t.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1";class a extends n.VerificationBase{static factory(...e){return new a(...e)}static get NAME(){return"m.reciprocate.v1"}async _doVerification(){if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:e}=this.request;if(this.startEvent.getContent().secret!==e.encodedSharedSecret)throw(0,i.newKeyMismatchError)();await new Promise(((e,t)=>{this.reciprocateQREvent={confirm:e,cancel:()=>t((0,i.newUserCancelledError)())},this.emit("show_reciprocate_qr",this.reciprocateQREvent)}));const t={};switch(e.mode){case c:{const r=e.otherUserMasterKey;t[`ed25519:${r}`]=r;break}case l:{const r=this.request.targetDevice.deviceId;t[`ed25519:${r}`]=e.otherDeviceKey;break}case u:{const r=e.myMasterKey;t[`ed25519:${r}`]=r;break}}await this._verifyKeys(this.userId,t,((e,r,n)=>{const s=t[e];if(!s)throw(0,i.newKeyMismatchError)();if(n!==s)throw o.logger.error("key ID from key info does not match"),(0,i.newKeyMismatchError)();for(const e in r.keys){if(!e.startsWith("ed25519"))continue;const n=t[e];if(!n)throw(0,i.newKeyMismatchError)();if(r.keys[e]!==n)throw o.logger.error("master key does not match"),(0,i.newKeyMismatchError)()}}))}}t.ReciprocateQRCode=a;const c=0,l=1,u=2;class h{constructor(e,t,r,n,i,s){this._sharedSecret=t,this._mode=e,this._otherUserMasterKey=r,this._otherDeviceKey=n,this._myMasterKey=i,this._buffer=s}static async create(e,t){const r=h._generateSharedSecret(),n=h._determineMode(e,t);let i=null,s=null,o=null;if(n===c)i=t.getStoredCrossSigningForUser(e.otherUserId).getId("master");else if(n===l)s=await h._getOtherDeviceKey(e,t);else if(n===u){const e=t.getUserId();o=t.getStoredCrossSigningForUser(e).getId("master")}const a=h._generateQrData(e,t,n,r,i,s,o),d=h._generateBuffer(a);return new h(n,r,i,s,o,d)}get buffer(){return this._buffer}get mode(){return this._mode}get otherDeviceKey(){return this._otherDeviceKey}get otherUserMasterKey(){return this._otherUserMasterKey}get myMasterKey(){return this._myMasterKey}get encodedSharedSecret(){return this._sharedSecret}static _generateSharedSecret(){const e=new Uint8Array(11);return r.g.crypto.getRandomValues(e),(0,s.encodeUnpaddedBase64)(e)}static async _getOtherDeviceKey(e,t){const r=t.getUserId(),n=e.targetDevice,i=n?n.deviceId:null,s=t.getStoredDevice(r,i);if(!s)throw new Error("could not find device "+i);return s.getFingerprint()}static _determineMode(e,t){const r=t.getUserId(),n=e.otherUserId;let i=c;return r===n&&(i=t.checkUserTrust(r).isCrossSigningVerified()?l:u),i}static _generateQrData(e,t,r,n,i,s,o){const a=t.getUserId(),h={prefix:"MATRIX",version:2,mode:r,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:n},d=t.getStoredCrossSigningForUser(a);return r===c?(h.firstKeyB64=d.getId("master"),h.secondKeyB64=i):r===l?(h.firstKeyB64=d.getId("master"),h.secondKeyB64=s):r===u&&(h.firstKeyB64=t.getDeviceEd25519Key(),h.secondKeyB64=o),h}static _generateBuffer(e){let t=Buffer.alloc(0);const r=e=>{const r=Buffer.from([e]);t=Buffer.concat([t,r])},n=(e,r,n=!0)=>{const i=Buffer.from(e,r);n&&(e=>{const r=Buffer.alloc(2);r.writeInt16BE(e,0),t=Buffer.concat([t,r])})(i.byteLength),t=Buffer.concat([t,i])},i=e=>{const r=(0,s.decodeBase64)(e),n=Buffer.from(r);t=Buffer.concat([t,n])};return n(e.prefix,"ascii",!1),r(e.version),r(e.mode),n(e.transactionId,"utf-8"),i(e.firstKeyB64),i(e.secondKeyB64),i(e.secretB64),t}}t.QRCodeData=h},6381:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SAS=void 0;var i=r(1631),s=n(r(9141)),o=r(6702),a=r(7434);const c="m.key.verification.start",l=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"];let u;const h=(0,o.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),d=(0,o.errorFactory)("m.mismatched_commitment","Mismatched commitment"),p=[["","dog"],["","cat"],["","lion"],["","horse"],["","unicorn"],["","pig"],["","elephant"],["","rabbit"],["","panda"],["","rooster"],["","penguin"],["","turtle"],["","fish"],["","octopus"],["","butterfly"],["","flower"],["","tree"],["","cactus"],["","mushroom"],["","globe"],["","moon"],["","cloud"],["","fire"],["","banana"],["","apple"],["","strawberry"],["","corn"],["","pizza"],["","cake"],["","heart"],["","smiley"],["","robot"],["","hat"],["","glasses"],["","spanner"],["","santa"],["","thumbs up"],["","umbrella"],["","hourglass"],["","clock"],["","gift"],["","light bulb"],["","book"],["","pencil"],["","paperclip"],["","scissors"],["","lock"],["","key"],["","hammer"],["","telephone"],["","flag"],["","train"],["","bicycle"],["","aeroplane"],["","rocket"],["","trophy"],["","ball"],["","guitar"],["","trumpet"],["","bell"],["","anchor"],["","headphones"],["","folder"],["","pin"]],f={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((e=>p[e]))}};function g(e,t){const r={};for(const n of t)n in f&&(r[n]=f[n](e));return r}const m={"hkdf-hmac-sha256":"calculate_mac","hmac-sha256":"calculate_mac_long_kdf"};function y(e,t){return function(...r){const n=e[m[t]].apply(e,r);return a.logger.log("SAS calculateMAC:",t,r,n),n}}const v={"curve25519-hkdf-sha256":function(e,t,r){const n=`${e._baseApis.getUserId()}|${e._baseApis.deviceId}|${e.ourSASPubKey}|`,i=`${e.userId}|${e.deviceId}|${e.theirSASPubKey}|`,s="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?n+i:i+n)+e._channel.transactionId;return t.generate_bytes(s,r)},curve25519:function(e,t,r){const n=`${e._baseApis.getUserId()}${e._baseApis.deviceId}`,i=`${e.userId}${e.deviceId}`,s="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?n+i:i+n)+e._channel.transactionId;return t.generate_bytes(s,r)}},_=["curve25519-hkdf-sha256","curve25519"],b=["sha256"],w=["hkdf-hmac-sha256","hmac-sha256"],S=Object.keys(f),k=new Set(_),E=new Set(b),x=new Set(w),A=new Set(S);function T(e,t){return e instanceof Array?e.filter((e=>t.has(e))):[]}class C extends i.VerificationBase{static get NAME(){return"m.sas.v1"}get events(){return l}async _doVerification(){await r.g.Olm.init(),u=u||new r.g.Olm.Utility,await this._baseApis.downloadKeys([this.userId]);let e=!1;do{try{return this.initiatedByMe?await this._doSendVerification():await this._doRespondVerification()}catch(t){if(!(t instanceof i.SwitchStartEventError))throw t;this.startEvent=t.startEvent,e=!0}}while(e)}canSwitchStartEvent(e){if(e.getType()!==c)return!1;const t=e.getContent();return t&&t.method===C.NAME&&this._waitingForAccept}async _sendStart(){const e=this._channel.completeContent(c,{method:C.NAME,from_device:this._baseApis.deviceId,key_agreement_protocols:_,hashes:b,message_authentication_codes:w,short_authentication_string:S});return await this._channel.sendCompleted(c,e),e}async _doSendVerification(){let e,t;if(this._waitingForAccept=!0,e=this.startEvent?this._channel.completedContentFromEvent(this.startEvent):await this._sendStart(),!this.initiatedByMe)throw new i.SwitchStartEventError(this.startEvent);try{t=await this._waitForEvent("m.key.verification.accept")}finally{this._waitingForAccept=!1}let n=t.getContent();const a=T(n.short_authentication_string,A);if(!(k.has(n.key_agreement_protocol)&&E.has(n.hash)&&x.has(n.message_authentication_code)&&a.length))throw(0,o.newUnknownMethodError)();if("string"!=typeof n.commitment)throw(0,o.newInvalidMessageError)();const c=n.key_agreement_protocol,l=n.message_authentication_code,p=n.commitment,f=new r.g.Olm.SAS;try{this.ourSASPubKey=f.get_pubkey(),await this._send("m.key.verification.key",{key:this.ourSASPubKey}),t=await this._waitForEvent("m.key.verification.key"),n=t.getContent();const r=n.key+s.default.stringify(e);if(u.sha256(r)!==p)throw d();this.theirSASPubKey=n.key,f.set_their_key(n.key);const i=v[c](this,f,6),m=new Promise(((e,t)=>{this.sasEvent={sas:g(i,a),confirm:async()=>{try{await this._sendMAC(f,l),e()}catch(e){t(e)}},cancel:()=>t((0,o.newUserCancelledError)()),mismatch:()=>t(h())},this.emit("show_sas",this.sasEvent)}));[t]=await Promise.all([this._waitForEvent("m.key.verification.mac").then((e=>(this._expectedEvent="m.key.verification.done",e))),m]),n=t.getContent(),await this._checkMAC(f,n,l)}finally{f.free()}}async _doRespondVerification(){let e=this._channel.completedContentFromEvent(this.startEvent);const t=T(_,new Set(e.key_agreement_protocols))[0],n=T(b,new Set(e.hashes))[0],i=T(w,new Set(e.message_authentication_codes))[0],a=T(e.short_authentication_string,A);if(void 0===t||void 0===n||void 0===i||!a.length)throw(0,o.newUnknownMethodError)();const c=new r.g.Olm.SAS;try{const r=c.get_pubkey()+s.default.stringify(e);await this._send("m.key.verification.accept",{key_agreement_protocol:t,hash:n,message_authentication_code:i,short_authentication_string:a,commitment:u.sha256(r)});let l=await this._waitForEvent("m.key.verification.key");e=l.getContent(),this.theirSASPubKey=e.key,c.set_their_key(e.key),this.ourSASPubKey=c.get_pubkey(),await this._send("m.key.verification.key",{key:this.ourSASPubKey});const d=v[t](this,c,6),p=new Promise(((e,t)=>{this.sasEvent={sas:g(d,a),confirm:async()=>{try{await this._sendMAC(c,i),e()}catch(e){t(e)}},cancel:()=>t((0,o.newUserCancelledError)()),mismatch:()=>t(h())},this.emit("show_sas",this.sasEvent)}));[l]=await Promise.all([this._waitForEvent("m.key.verification.mac").then((e=>(this._expectedEvent="m.key.verification.done",e))),p]),e=l.getContent(),await this._checkMAC(c,e,i)}finally{c.free()}}_sendMAC(e,t){const r={},n=[],i="MATRIX_KEY_VERIFICATION_MAC"+this._baseApis.getUserId()+this._baseApis.deviceId+this.userId+this.deviceId+this._channel.transactionId,s=`ed25519:${this._baseApis.deviceId}`;r[s]=y(e,t)(this._baseApis.getDeviceEd25519Key(),i+s),n.push(s);const o=this._baseApis.getCrossSigningId();if(o){const s=`ed25519:${o}`;r[s]=y(e,t)(o,i+s),n.push(s)}const a=y(e,t)(n.sort().join(","),i+"KEY_IDS");return this._send("m.key.verification.mac",{mac:r,keys:a})}async _checkMAC(e,t,r){const n="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this._baseApis.getUserId()+this._baseApis.deviceId+this._channel.transactionId;if(t.keys!==y(e,r)(Object.keys(t.mac).sort().join(","),n+"KEY_IDS"))throw(0,o.newKeyMismatchError)();await this._verifyKeys(this.userId,t.mac,((t,i,s)=>{if(s!==y(e,r)(i.keys[t],n+t))throw(0,o.newKeyMismatchError)()}))}}t.SAS=C},2842:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InRoomRequests=t.InRoomChannel=void 0;var n=r(5279),i=r(7434);const s="m.room.message",o="m.reference",a="m.relates_to";class c{constructor(e,t,r=null){this._client=e,this._roomId=t,this.userId=r,this._requestEventId=null}get receiveStartFromOtherDevices(){return!0}get roomId(){return this._roomId}get transactionId(){return this._requestEventId}static getOtherPartyUserId(e,t){if(c.getEventType(e)!==n.REQUEST_TYPE)return;const r=t.getUserId(),i=e.getSender(),s=e.getContent().to;return i===r?s:s===r?i:void 0}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===n.REQUEST_TYPE}static getTransactionId(e){if(c.getEventType(e)===n.REQUEST_TYPE)return e.getId();{const t=e.getRelation();if(t&&t.rel_type===o)return t.event_id}}static validateEvent(e,t){const r=c.getTransactionId(e);if("string"!=typeof r||0===r.length)return!1;const s=c.getEventType(e),o=e.getContent();if(s===n.REQUEST_TYPE){if(!o||"string"!=typeof o.to||!o.to.length)return i.logger.log("InRoomChannel: validateEvent: no valid to "+(o&&o.to)),!1;if(!c.getOtherPartyUserId(e,t))return i.logger.log(`InRoomChannel: validateEvent: not directed to or sent by me: ${e.getSender()}, ${o&&o.to}`),!1}return n.VerificationRequest.validateEvent(s,e,t)}static getEventType(e){const t=e.getType();if(t===s){const t=e.getContent();if(t){const{msgtype:e}=t;if(e===n.REQUEST_TYPE)return n.REQUEST_TYPE}}return t&&t!==n.REQUEST_TYPE?t:""}async handleEvent(e,t,r){if(t.hasEventId(e.getId()))return;const n=c.getEventType(e);if(e.getRoomId()!==this._roomId)return;if(null===this.userId){const t=c.getOtherPartyUserId(e,this._client);t&&(this.userId=t)}const s=this._client.getUserId(),o=e.getSender();if(null!==this.userId&&o!==s&&o!==this.userId)return void i.logger.log(`InRoomChannel: ignoring verification event from non-participating sender ${o}`);null===this._requestEventId&&(this._requestEventId=c.getTransactionId(e));const a=!!e.getUnsigned().transaction_id,l=e.getSender()===this._client.getUserId();return await t.handleEvent(n,e,r,a,l)}completedContentFromEvent(e){const t=Object.assign({},e.getContent());return t[a]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==n.REQUEST_TYPE&&e!==n.READY_TYPE&&e!==n.START_TYPE||(t.from_device=this._client.getDeviceId()),e===n.REQUEST_TYPE?t={body:this._client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:n.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t[a]={rel_type:o,event_id:this.transactionId},t}send(e,t){const r=this.completeContent(e,t);return this.sendCompleted(e,r)}async sendCompleted(e,t){let r=e;e===n.REQUEST_TYPE&&(r=s);const i=await this._client.sendEvent(this._roomId,r,t);e===n.REQUEST_TYPE&&(this._requestEventId=i.event_id)}}t.InRoomChannel=c,t.InRoomRequests=class{constructor(){this._requestsByRoomId=new Map}getRequest(e){const t=e.getRoomId(),r=c.getTransactionId(e);return this._getRequestByTxnId(t,r)}getRequestByChannel(e){return this._getRequestByTxnId(e.roomId,e.transactionId)}_getRequestByTxnId(e,t){const r=this._requestsByRoomId.get(e);if(r)return r.get(t)}setRequest(e,t){this._setRequest(e.getRoomId(),c.getTransactionId(e),t)}setRequestByChannel(e,t){this._setRequest(e.roomId,e.transactionId,t)}_setRequest(e,t,r){let n=this._requestsByRoomId.get(e);n||(n=new Map,this._requestsByRoomId.set(e,n)),n.set(t,r)}removeRequest(e){const t=e.getRoomId(),r=this._requestsByRoomId.get(t);r&&(r.delete(c.getTransactionId(e)),0===r.size&&this._requestsByRoomId.delete(t))}findRequestInProgress(e){const t=this._requestsByRoomId.get(e);if(t)for(const e of t.values())if(e.pending)return e}}},9588:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceRequests=t.ToDeviceChannel=void 0;var n=r(8401),i=r(7434),s=r(5279),o=r(6702),a=r(4369);class c{constructor(e,t,r,n=null,i=null){this._client=e,this.userId=t,this._devices=r,this.transactionId=n,this._deviceId=i}isToDevices(e){if(e.length===this._devices.length){for(const t of e)if(!this._devices.find((e=>e.deviceId===t.deviceId)))return!1;return!0}return!1}get deviceId(){return this._deviceId}static getEventType(e){return e.getType()}static getTransactionId(e){const t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===s.REQUEST_TYPE||e===s.START_TYPE}static validateEvent(e,t){if(e.isCancelled())return i.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;const r=e.getContent();if(!r)return i.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!r.transaction_id)return i.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const n=e.getType();if(n===s.REQUEST_TYPE){if(!Number.isFinite(r.timestamp))return i.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&r.from_device==t.getDeviceId())return i.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return s.VerificationRequest.validateEvent(n,e,t)}getTimestamp(e){const t=e.getContent();return t&&t.timestamp}async handleEvent(e,t,r){const n=e.getType(),i=e.getContent();if(n===s.REQUEST_TYPE||n===s.READY_TYPE||n===s.START_TYPE){this.transactionId||(this.transactionId=i.transaction_id);const e=i.from_device;if(!this._deviceId&&this._devices.includes(e)&&(this._deviceId=e),!this._deviceId||this._deviceId!==e){const t=this.completeContent((0,o.errorFromEvent)((0,o.newUnexpectedMessageError)()));return this._sendToDevices(s.CANCEL_TYPE,t,[e])}}const a=t.phase===s.PHASE_STARTED||t.phase===s.PHASE_READY;await t.handleEvent(e.getType(),e,r,!1,!1);const c=t.phase===s.PHASE_STARTED||t.phase===s.PHASE_READY;if((n===s.START_TYPE||n===s.READY_TYPE)&&!a&&c&&this._deviceId){const e=this._devices.filter((e=>e!==this._deviceId));if(e.length){const t=this.completeContent({code:"m.accepted",reason:"Verification request accepted by another device"});await this._sendToDevices(s.CANCEL_TYPE,t,e)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==s.REQUEST_TYPE&&e!==s.READY_TYPE&&e!==s.START_TYPE||(t.from_device=this._client.getDeviceId()),e===s.REQUEST_TYPE&&(t.timestamp=Date.now()),t}send(e,t={}){e!==s.REQUEST_TYPE&&e!==s.START_TYPE||this.transactionId||(this.transactionId=c.makeTransactionId());const r=this.completeContent(e,t);return this.sendCompleted(e,r)}async sendCompleted(e,t){let r;r=e===s.REQUEST_TYPE?await this._sendToDevices(e,t,this._devices):await this._sendToDevices(e,t,[this._deviceId]);const n=new a.MatrixEvent({sender:this._client.getUserId(),content:t,type:e});return await this._request.handleEvent(e,n,!0,!0,!0),r}_sendToDevices(e,t,r){if(r.length){const n={};for(const e of r)n[e]=t;return this._client.sendToDevice(e,{[this.userId]:n})}return Promise.resolve()}static makeTransactionId(){return(0,n.randomString)(32)}}t.ToDeviceChannel=c,t.ToDeviceRequests=class{constructor(){this._requestsByUserId=new Map}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),c.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,t){const r=this._requestsByUserId.get(e);if(r)return r.get(t)}setRequest(e,t){this.setRequestBySenderAndTxnId(e.getSender(),c.getTransactionId(e),t)}setRequestByChannel(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}setRequestBySenderAndTxnId(e,t,r){let n=this._requestsByUserId.get(e);n||(n=new Map,this._requestsByUserId.set(e,n)),n.set(t,r)}removeRequest(e){const t=e.getSender(),r=this._requestsByUserId.get(t);r&&(r.delete(c.getTransactionId(e)),0===r.size&&this._requestsByUserId.delete(t))}findRequestInProgress(e,t){const r=this._requestsByUserId.get(e);if(r)for(const e of r.values())if(e.pending&&e.channel.isToDevices(t))return e}getRequestsInProgress(e){const t=this._requestsByUserId.get(e);return t?Array.from(t.values()).filter((e=>e.pending)):[]}}},5279:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationRequest=t.PHASE_DONE=t.PHASE_CANCELLED=t.PHASE_STARTED=t.PHASE_READY=t.PHASE_REQUESTED=t.PHASE_UNSENT=t.READY_TYPE=t.DONE_TYPE=t.CANCEL_TYPE=t.START_TYPE=t.REQUEST_TYPE=t.EVENT_PREFIX=void 0;var i=n(r(9713)),s=r(7434),o=r(7187),a=r(6702),c=r(1696);const l="m.key.verification.";t.EVENT_PREFIX=l;const u=l+"request";t.REQUEST_TYPE=u;const h=l+"start";t.START_TYPE=h;const d=l+"cancel";t.CANCEL_TYPE=d;const p=l+"done";t.DONE_TYPE=p;const f=l+"ready";t.READY_TYPE=f,t.PHASE_UNSENT=1,t.PHASE_REQUESTED=2,t.PHASE_READY=3,t.PHASE_STARTED=4,t.PHASE_CANCELLED=5,t.PHASE_DONE=6;class g extends o.EventEmitter{constructor(e,t,r){super(),(0,i.default)(this,"_cancelOnTimeout",(()=>{try{this.initiatedByMe?this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){s.logger.error("Error while cancelling verification request",e)}})),this.channel=e,this.channel._request=this,this._verificationMethods=t,this._client=r,this._commonMethods=[],this._setPhase(1,!1),this._eventsByUs=new Map,this._eventsByThem=new Map,this._observeOnly=!1,this._timeoutTimer=null,this._accepting=!1,this._declining=!1,this._verifierHasFinished=!1,this._cancelled=!1,this._chosenMethod=null,this._qrCodeData=null,this._requestReceivedAt=null}static validateEvent(e,t,r){const n=t.getContent();return!(!e||!e.startsWith(l))&&(n?e!==u&&e!==f||Array.isArray(n.methods)?e!==u&&e!==f&&e!==h||"string"==typeof n.from_device&&0!==n.from_device.length||(s.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(s.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(s.logger.log("VerificationRequest: validateEvent: no content"),!1))}get invalid(){return 1===this.phase}get requested(){return 2===this.phase}get cancelled(){return 5===this.phase}get ready(){return 3===this.phase}get started(){return 4===this.phase}get done(){return 6===this.phase}get methods(){return this._commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){let t=this.channel.getTimestamp(e)+6e5;if(this._requestReceivedAt&&!this.initiatedByMe&&this.phase<=2){const e=this._requestReceivedAt+12e4;t=Math.min(t,e)}return Math.max(0,t-Date.now())}get timeout(){const e=this._getEventByEither(u);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this._getEventByEither(u)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return this.phase<3&&!this._accepting&&!this._declining}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&6!==this._phase&&5!==this._phase}get qrCodeData(){return this._qrCodeData}otherPartySupportsMethod(e,t=!1){if(!t&&!this.ready&&!this.started)return!1;const r=this._eventsByThem.get(u)||this._eventsByThem.get(f);if(!r){if(this.started&&this.initiatedByMe){const t=this._eventsByUs.get(h),r=t&&t.getContent();return e==(r&&r.method)}return!1}const n=r.getContent();if(!n)return!1;const{methods:i}=n;return!!Array.isArray(i)&&i.includes(e)}get initiatedByMe(){const e=this._eventsByUs.size+this._eventsByThem.size===0;if(1===this._phase&&e)return!0;const t=this._eventsByUs.has(u),r=this._eventsByThem.has(u);if(t&&!r)return!0;if(!t&&r)return!1;const n=this._eventsByUs.has(h),i=this._eventsByThem.has(h);return!(!n||i)}get requestingUserId(){return this.initiatedByMe?this._client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this._client.getUserId()}get otherUserId(){return this.channel.userId}get isSelfVerification(){return this._client.getUserId()===this.otherUserId}get cancellingUserId(){const e=this._eventsByUs.get(d),t=this._eventsByThem.get(d);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}get cancellationCode(){const e=this._getEventByEither(d);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const e=(this._eventsByThem.get(u)||this._eventsByThem.get(f)||this._eventsByThem.get(h)).getContent().from_device;return{userId:this.otherUserId,deviceId:e}}beginKeyVerification(e,t=null){if(!this.observeOnly&&!this._verifier&&(2===this.phase||3===this.phase||1===this.phase&&this.channel.constructor.canCreateRequest(h))){if(this._commonMethods.length&&!this._commonMethods.includes(e))throw(0,a.newUnknownMethodError)();if(this._verifier=this._createVerifier(e,null,t),!this._verifier)throw(0,a.newUnknownMethodError)();this._chosenMethod=e}return this._verifier}async sendRequest(){if(!this.observeOnly&&1===this._phase){const e=[...this._verificationMethods.keys()];await this.channel.send(u,{methods:e})}}async cancel({reason:e="User declined",code:t="m.user"}={}){if(!this.observeOnly&&5!==this._phase){if(this._declining=!0,this.emit("change"),this._verifier)return this._verifier.cancel((0,a.errorFactory)(t,e)());this._cancellingUserId=this._client.getUserId(),await this.channel.send(d,{code:t,reason:e})}}async accept(){if(!this.observeOnly&&2===this.phase&&!this.initiatedByMe){const e=[...this._verificationMethods.keys()];this._accepting=!0,this.emit("change"),await this.channel.send(f,{methods:e})}}waitFor(e){return new Promise(((t,r)=>{const n=()=>{let i=!1;return e(this)?(t(this),i=!0):this.cancelled&&(r(new Error("cancelled")),i=!0),i&&this.off("change",n),i};n()||this.on("change",n)}))}_setPhase(e,t=!0){this._phase=e,t&&this.emit("change")}_getEventByEither(e){return this._eventsByThem.get(e)||this._eventsByUs.get(e)}_getEventBy(e,t){return t?this._eventsByThem.get(e):this._eventsByUs.get(e)}_calculatePhaseTransitions(){const e=[{phase:1}],t=()=>e[e.length-1].phase,r=this._eventsByThem.has(u),n=this._getEventBy(u,r);n&&e.push({phase:2,event:n});const i=n&&this._getEventBy(f,!r);let s;if(i&&2===t()&&e.push({phase:3,event:i}),i||!n){const e=this._eventsByThem.get(h),t=this._eventsByUs.get(h);s=e&&t?e.getSender()<t.getSender()?e:t:e||t}else s=this._getEventBy(h,!r);if(s){const r=2===t()&&n.getSender()!==s.getSender(),i=1===t()&&this.channel.constructor.canCreateRequest(h);(r||3===t()||i)&&e.push({phase:4,event:s})}const o=this._eventsByUs.get(p);(this._verifierHasFinished||o&&4===t())&&e.push({phase:6});const a=this._getEventByEither(d);return(this._cancelled||a)&&6!==t()?(e.push({phase:5,event:a}),e):e}_transitionToPhase(e){const{phase:t,event:r}=e;if((2===t||3===t)&&!this._wasSentByOwnDevice(r)){const e=r.getContent();this._commonMethods=e.methods.filter((e=>this._verificationMethods.has(e)))}if(this.observeOnly||2!==t&&4!==t&&3!==t||this.channel.receiveStartFromOtherDevices&&this._wasSentByOwnUser(r)&&!this._wasSentByOwnDevice(r)&&(this._observeOnly=!0),4===t){const{method:e}=r.getContent();this._verifier||this.observeOnly||(this._verifier=this._createVerifier(e,r),this._verifier?this._chosenMethod=e:this.cancel({code:"m.unknown_method",reason:`Unknown method: ${e}`}))}}_applyPhaseTransitions(){const e=this._calculatePhaseTransitions(),t=e.findIndex((e=>e.phase===this.phase)),r=e.slice(t+1);for(const e of r)this._transitionToPhase(e);return r}_isWinningStartRace(e){if(e.getType()!==h)return!1;const t=this._verifier.startEvent;let r,n;if(this.isSelfVerification)if(t){const e=t.getContent();r=e&&e.from_device}else r=this._client.getDeviceId();else r=t?t.getSender():this._client.getUserId();if(this.isSelfVerification){const t=e.getContent();n=t&&t.from_device}else n=e.getSender();return n<r}hasEventId(e){for(const t of this._eventsByUs.values())if(t.getId()===e)return!0;for(const t of this._eventsByThem.values())if(t.getId()===e)return!0;return!1}async handleEvent(e,t,r,n,i){if(this.done||this.cancelled)return;const o=this._observeOnly;if(this._adjustObserveOnly(t,r),!this.observeOnly&&!n&&await this._cancelOnError(e,t))return;if(i?this._eventsByUs.has(e):this._eventsByThem.has(e))return;const a=this.phase;this._addEvent(e,t,i);const l=this._applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const r=this._isWinningStartRace(t);this._verifier.canSwitchStartEvent(t)&&r?this._verifier.switchStartEvent(t):n||(e===d||this._verifier.events&&this._verifier.events.includes(e))&&this._verifier.handleEvent(t)}if(l.length){r&&l.some((e=>3===e.phase))&&this.otherPartySupportsMethod(c.SCAN_QR_CODE_METHOD,!0)&&(this._qrCodeData=await c.QRCodeData.create(this,this._client));const e=l[l.length-1],{phase:t}=e;this._setupTimeout(t),this._setPhase(t)}else this._observeOnly!==o&&this.emit("change")}finally{s.logger.log(`Verification request ${this.channel.transactionId}: ${e} event with id:${t.getId()}, content:${JSON.stringify(t.getContent())} deviceId:${this.channel.deviceId}, sender:${t.getSender()}, isSentByUs:${i}, isLiveEvent:${r}, isRemoteEcho:${n}, phase:${a}=>${this.phase}, observeOnly:${o}=>${this._observeOnly}`)}}_setupTimeout(e){!this._timeoutTimer&&!this.observeOnly&&2===e&&(this._timeoutTimer=setTimeout(this._cancelOnTimeout,this.timeout)),this._timeoutTimer&&(4===e||3===e||6===e||5===e)&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=null)}async _cancelOnError(e,t){if(e===h){const e=t.getContent().method;if(!this._verificationMethods.has(e))return await this.cancel((0,a.errorFromEvent)((0,a.newUnknownMethodError)())),!0}const r=e===u&&1!==this.phase,n=e===f&&2!==this.phase;if(1!==this.phase&&(r||n)){s.logger.warn(`Cancelling, unexpected ${e} verification event from ${t.getSender()}`);const r=`Unexpected ${e} event in phase ${this.phase}`;return await this.cancel((0,a.errorFromEvent)((0,a.newUnexpectedMessageError)({reason:r}))),!0}return!1}_adjustObserveOnly(e,t){t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}_addEvent(e,t,r){if(r?this._eventsByUs.set(e,t):this._eventsByThem.set(e,t),e===u){for(const[e,t]of this._eventsByThem.entries())t.getSender()!==this.otherUserId&&this._eventsByThem.delete(e);this._requestReceivedAt=Date.now()}}_createVerifier(e,t=null,r=null){r||(r=this.targetDevice);const{userId:n,deviceId:i}=r,o=this._verificationMethods.get(e);if(o)return new o(this.channel,this._client,n,i,t,this);s.logger.warn("could not find verifier constructor for method",e)}_wasSentByOwnUser(e){return e.getSender()===this._client.getUserId()}_wasSentByOwnDevice(e){if(!this._wasSentByOwnUser(e))return!1;const t=e.getContent();return!(!t||t.from_device!==this._client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send("m.key.verification.done",{}),this._verifierHasFinished=!0;const e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this._eventsByThem.get(e)}}t.VerificationRequest=g},9489:(e,t)=>{"use strict";function r(e,t){const r=`Store is invalid because ${e}, please stop the client, delete all data and start the client again`,n=Reflect.construct(Error,[r]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.value=t,n}function n(e){const t=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`,r=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(r,Reflect.getPrototypeOf(this)),r.reason=e,r.name="InvalidCryptoStoreError",r}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStoreError=r,t.InvalidCryptoStoreError=n,t.KeySignatureUploadError=void 0,r.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",r.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(r,Error),n.TOO_NEW="TOO_NEW",n.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(n,Error);class i extends Error{constructor(e,t){super(e),this.value=t}}t.KeySignatureUploadError=i},3564:(e,t)=>{"use strict";function r(e){this.filter_json=e,this.types=e.types||null,this.not_types=e.not_types||[],this.rooms=e.rooms||null,this.not_rooms=e.not_rooms||[],this.senders=e.senders||null,this.not_senders=e.not_senders||[],this.contains_url=e.contains_url||null}Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=r,r.prototype.check=function(e){return this._checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url)},r.prototype._checkFields=function(e,t,r,n){const i={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){const r=t.slice(0,-1);return e.substr(0,r.length)===r}return e===t}(r,e)}},s=this;for(let e=0;e<Object.keys(i).length;e++){const t=Object.keys(i)[e],r=i[t];if(s["not_"+t].filter(r).length>0)return!1;const n=s[t];if(n&&n.length>0&&!n.some(r))return!1}const o=this.filter_json.contains_url;return void 0===o||o===n},r.prototype.filter=function(e){return e.filter(this.check,this)},r.prototype.limit=function(){return void 0!==this.filter_json.limit?this.filter_json.limit:10}},7906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=s;var n=r(3564);function i(e,t,r){const n=t.split(".");let i=e;for(let e=0;e<n.length-1;e++)i[n[e]]||(i[n[e]]={}),i=i[n[e]];i[n[n.length-1]]=r}function s(e,t){this.userId=e,this.filterId=t,this.definition={}}s.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0},s.prototype.getFilterId=function(){return this.filterId},s.prototype.getDefinition=function(){return this.definition},s.prototype.setDefinition=function(e){this.definition=e;const t=e.room,r={};t&&(t.rooms&&(r.rooms=t.rooms),t.rooms&&(r.not_rooms=t.not_rooms),this._include_leave=t.include_leave||!1),this._room_filter=new n.FilterComponent(r),this._room_timeline_filter=new n.FilterComponent(t&&t.timeline||{})},s.prototype.getRoomTimelineFilterComponent=function(){return this._room_timeline_filter},s.prototype.filterRoomTimeline=function(e){return this._room_timeline_filter.filter(this._room_filter.filter(e))},s.prototype.setTimelineLimit=function(e){i(this.definition,"room.timeline.limit",e)},s.prototype.setLazyLoadMembers=function(e){i(this.definition,"room.state.lazy_load_members",!!e)},s.prototype.setIncludeLeaveRooms=function(e){i(this.definition,"room.include_leave",e)},s.fromJson=function(e,t,r){const n=new s(e,t);return n.setDefinition(r),n}},7715:(e,t,r)=>{"use strict";var n=r(862),i=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixHttpApi=d,t.retryNetworkOperation=async function(e,t){let r=0,n=null;for(;r<e;)try{if(r>0){const e=1e3*Math.pow(2,r);c.logger.log(`network operation failed ${r} times, retrying in ${e}ms...`),await new Promise((t=>setTimeout(t,e)))}return await t()}catch(e){if(!(e instanceof g))throw e;r+=1,n=e}throw n},t.AbortError=t.ConnectionError=t.MatrixError=t.PREFIX_MEDIA_R0=t.PREFIX_IDENTITY_V2=t.PREFIX_IDENTITY_V1=t.PREFIX_UNSTABLE=t.PREFIX_R0=void 0;var s=i(r(9713)),o=r(7811),a=n(r(3102)),c=r(7434),l=n(r(2731));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t){a.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=t.onlyData||!1,this.event_emitter=e,this.opts=t,this.useAuthorizationHeader=Boolean(t.useAuthorizationHeader),this.uploads=[]}t.PREFIX_R0="/_matrix/client/r0",t.PREFIX_UNSTABLE="/_matrix/client/unstable",t.PREFIX_IDENTITY_V1="/_matrix/identity/api/v1",t.PREFIX_IDENTITY_V2="/_matrix/identity/v2",t.PREFIX_MEDIA_R0="/_matrix/media/r0",d.prototype={setIdBaseUrl:function(e){this.opts.idBaseUrl=e},getContentUri:function(){const e={access_token:this.opts.accessToken};return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:e}},uploadContent:function(e,t){a.isFunction(t)?t={callback:t}:void 0===t&&(t={});const n=!1!==t.includeFilename,i=t.type||e.type||"application/octet-stream",s=t.name||e.name;let o=e;o.stream&&"function"!=typeof o.stream&&(c.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),o=o.stream);let u=t.rawResponse;void 0===u&&(r.g.XMLHttpRequest?u=!1:(c.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),u=!0));let h=t.onlyContentUri;u||void 0!==h||(r.g.XMLHttpRequest?(c.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),h=!0):h=!1);const d={loaded:0,total:0};let f,g=null;if(u||(g=function(e){let t=JSON.parse(e);if(h&&(t=t.content_uri,void 0===t))throw Error("Bad response");return t}),r.g.XMLHttpRequest){const e=a.defer(),c=new r.g.XMLHttpRequest;d.xhr=c;const u=p(e,t.callback,this.opts.onlyData),h=function(){c.abort(),u(new Error("Timeout"))};c.timeout_timer=l.setTimeout(h,3e4),c.onreadystatechange=function(){switch(c.readyState){case r.g.XMLHttpRequest.DONE:var e;l.clearTimeout(c.timeout_timer);try{if(0===c.status)throw new m;if(!c.responseText)throw new Error("No response body.");e=c.responseText,g&&(e=g(e))}catch(e){return e.http_status=c.status,void u(e)}u(void 0,c,e)}},c.upload.addEventListener("progress",(function(e){l.clearTimeout(c.timeout_timer),d.loaded=e.loaded,d.total=e.total,c.timeout_timer=l.setTimeout(h,3e4),t.progressHandler&&t.progressHandler({loaded:e.loaded,total:e.total})}));let y=this.opts.baseUrl+"/_matrix/media/r0/upload";const v=[];n&&s&&v.push("filename="+encodeURIComponent(s)),this.useAuthorizationHeader||v.push("access_token="+encodeURIComponent(this.opts.accessToken)),v.length>0&&(y+="?"+v.join("&")),c.open("POST",y),this.useAuthorizationHeader&&c.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),c.setRequestHeader("Content-Type",i),c.send(o),f=e.promise,f.abort=c.abort.bind(c)}else{const e={};n&&s&&(e.filename=s),f=this.authedRequest(t.callback,"POST","/upload",e,o,{prefix:"/_matrix/media/r0",headers:{"Content-Type":i},json:!1,bodyParser:g})}const y=this,v=f.finally((function(){for(let e=0;e<y.uploads.length;++e)if(y.uploads[e]===d)return void y.uploads.splice(e,1)}));return v.abort=f.abort,d.promise=v,this.uploads.push(d),v},cancelUpload:function(e){return!!e.abort&&(e.abort(),!0)},getCurrentUploads:function(){return this.uploads},idServerRequest:function(e,t,r,n,i,s){if(!this.opts.idBaseUrl)throw new Error("No Identity Server base URL set");const o=this.opts.idBaseUrl+i+r;if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);const c={uri:o,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};"GET"===t?c.qs=n:"object"==typeof n&&(c.json=n),s&&(c.headers.Authorization=`Bearer ${s}`);const l=a.defer();return this.opts.request(c,p(l,e,this.opts.onlyData)),l.promise},authedRequest:function(e,t,r,n,i,s){n||(n={}),this.useAuthorizationHeader?(isFinite(s)&&(s={localTimeoutMs:s}),s||(s={}),s.headers||(s.headers={}),s.headers.Authorization||(s.headers.Authorization="Bearer "+this.opts.accessToken),n.access_token&&delete n.access_token):n.access_token||(n.access_token=this.opts.accessToken);const o=this.request(e,t,r,n,i,s),a=this;return o.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?a.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&a.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),o},request:function(e,t,r,n,i,s){const o=void 0!==(s=s||{}).prefix?s.prefix:this.opts.prefix,a=this.opts.baseUrl+o+r;return this.requestOtherUrl(e,t,a,n,i,s)},requestOtherUrl:function(e,t,r,n,i,s){return null==s?s={}:isFinite(s)&&(s={localTimeoutMs:s}),this._request(e,t,r,n,i,s)},getUrl:function(e,t,r){let n="";return t&&(n="?"+a.encodeParams(t)),this.opts.baseUrl+r+e+n},_request:function(e,t,r,n,i,s){if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);s=s||{};const o=this;this.opts.extraParams&&(n=h(h({},n),this.opts.extraParams));const c=a.extend({},s.headers||{}),u=void 0===s.json||s.json;let d=s.bodyParser;u&&(i&&(i=JSON.stringify(i),c["content-type"]="application/json"),c.accept||(c.accept="application/json"),void 0===d&&(d=function(e){return JSON.parse(e)}));const g=a.defer();let m,y,v=!1;const _=s.localTimeoutMs||this.opts.localTimeoutMs,b=()=>{_&&(m&&l.clearTimeout(m),m=l.setTimeout((function(){v=!0,y&&y.abort&&y.abort(),g.reject(new f({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:_}))}),_))};b();const w=g.promise;try{y=this.opts.request({uri:r,method:t,withCredentials:!1,qs:n,qsStringifyOptions:s.qsStringifyOptions,useQuerystring:!0,body:i,json:!1,timeout:_,headers:c||{},_matrix_opts:this.opts},(function(t,r,n){_&&(l.clearTimeout(m),v)||p(g,e,o.opts.onlyData,d)(t,r,n)})),y&&("onprogress"in y&&(y.onprogress=e=>{b()}),y.abort&&(w.abort=y.abort.bind(y)))}catch(t){g.reject(t),e&&e(t)}return w}};const p=function(e,t,r,n){return t=t||function(){},function(i,s,a){if(i&&("AbortError"===i.name||"aborted"===i||i instanceof f||(i=new g("request failed",i))),!i)try{s.statusCode>=400?i=function(e,t){const r=e.statusCode,n=function(e){let t;if(e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null),!t)return null;try{return(0,o.parse)(t)}catch(e){throw new Error(`Error parsing Content-Type '${t}': ${e}`)}}(e);let i;if(n)if("application/json"===n.type){const e="object"==typeof t?t:JSON.parse(t);i=new f(e)}else"text/plain"===n.type&&(i=new Error(`Server returned ${r} error: ${t}`));return i||(i=new Error(`Server returned ${r} error`)),i.httpStatus=r,i}(s,a):n&&(a=n(a))}catch(e){i=new Error(`Error parsing server response: ${e}`)}if(i)e.reject(i),t(i);else{const n={code:s.statusCode,headers:s.headers,data:a};e.resolve(r?a:n),t(null,r?a:n)}}};class f extends Error{constructor(e){super(`MatrixError: ${(e=e||{}).errcode}`),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.message=e.error||"Unknown message",this.data=e}}t.MatrixError=f;class g extends Error{constructor(e,t){super(e+(t?`: ${t.message}`:"")),this._cause=t}get name(){return"ConnectionError"}get cause(){return this._cause}}t.ConnectionError=g;class m extends Error{constructor(){super("Operation aborted")}get name(){return"AbortError"}}t.AbortError=m},3415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exists=function(e,t){return new Promise(((r,n)=>{let i=!0;const s=e.open(t);s.onupgradeneeded=()=>{i=!1},s.onblocked=()=>n(),s.onsuccess=()=>{s.result.close(),i||e.deleteDatabase(t),r(i)},s.onerror=e=>n(e.target.error)}))}},8670:(e,t,r)=>{"use strict";var n=r(862),i=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveAuth=u;var s=i(r(8575)),o=n(r(3102)),a=r(7434);const c="m.login.email.identity",l="m.login.msisdn";function u(e){this._matrixClient=e.matrixClient,this._data=e.authData||{},this._requestCallback=e.doRequest,this._busyChangedCallback=e.busyChanged,this._stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this._resolveFunc=null,this._rejectFunc=null,this._inputs=e.inputs||{},this._requestEmailTokenCallback=e.requestEmailToken,e.sessionId&&(this._data.session=e.sessionId),this._clientSecret=e.clientSecret||this._matrixClient.generateClientSecret(),this._emailSid=e.emailSid,void 0===this._emailSid&&(this._emailSid=null),this._requestingEmailToken=!1,this._chosenFlow=null,this._currentStage=null,this._submitPromise=null}u.prototype={attemptAuth:function(){return new Promise(((e,t)=>{if(this._resolveFunc=e,this._rejectFunc=t,this._data&&this._data.flows)this._startNextAuthStage();else{this._busyChangedCallback&&this._busyChangedCallback(!0);let e=null;this._data.session&&(e={session:this._data.session}),this._doRequest(e).finally((()=>{this._busyChangedCallback&&this._busyChangedCallback(!1)}))}}))},poll:async function(){if(!this._data.session)return;if(!this._resolveFunc)return;if(this._submitPromise)return;let e={};if(this._currentStage==c&&this._emailSid){const t={sid:this._emailSid,client_secret:this._clientSecret};if(await this._matrixClient.doesServerRequireIdServerParam()){const e=s.default.parse(this._matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:c,threepid_creds:t,threepidCreds:t}}this.submitAuthDict(e,!0)},getSessionId:function(){return this._data?this._data.session:void 0},getClientSecret:function(){return this._clientSecret},getStageParams:function(e){let t={};return this._data&&this._data.params&&(t=this._data.params),t[e]},getChosenFlow(){return this._chosenFlow},submitAuthDict:async function(e,t){if(!this._resolveFunc)throw new Error("submitAuthDict() called before attemptAuth()");for(!t&&this._busyChangedCallback&&this._busyChangedCallback(!0);this._submitPromise;)try{await this._submitPromise}catch(e){}let r;this._data.session?(r={session:this._data.session},o.extend(r,e)):r=e;try{this._submitPromise=this._doRequest(r,t),await this._submitPromise}finally{this._submitPromise=null,!t&&this._busyChangedCallback&&this._busyChangedCallback(!1)}},getEmailSid:function(){return this._emailSid},setEmailSid:function(e){this._emailSid=e},_doRequest:async function(e,t){try{const r=await this._requestCallback(e,t);this._resolveFunc(r),this._resolveFunc=null,this._rejectFunc=null}catch(e){const r=e.data?e.data.flows:null,n=this._data.flows||Boolean(r);401===e.httpStatus&&e.data&&n||(t?a.logger.log("Background poll request failed doing UI auth: ignoring",e):this._rejectFunc(e)),e.data.flows||e.data.completed||e.data.session||(e.data.flows=this._data.flows,e.data.completed=this._data.completed,e.data.session=this._data.session),this._data=e.data;try{this._startNextAuthStage()}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}if(!this._emailSid&&!this._requestingEmailToken&&this._chosenFlow.stages.includes("m.login.email.identity")){this._requestingEmailToken=!0;try{const e=await this._requestEmailTokenCallback(this._inputs.emailAddress,this._clientSecret,1,this._data.session);this._emailSid=e.sid}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}finally{this._requestingEmailToken=!1}}}},_startNextAuthStage:function(){const e=this._chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this._currentStage=e,"m.login.dummy"===e)return void this.submitAuthDict({type:"m.login.dummy"});if(this._data&&this._data.errcode||this._data.error)return void this._stateUpdatedCallback(e,{errcode:this._data.errcode||"",error:this._data.error||""});const t={};e==c&&(t.emailSid=this._emailSid),this._stateUpdatedCallback(e,t)},_chooseStage:function(){null===this._chosenFlow&&(this._chosenFlow=this._chooseFlow()),a.logger.log("Active flow => %s",JSON.stringify(this._chosenFlow));const e=this._firstUncompletedStage(this._chosenFlow);return a.logger.log("Next stage: %s",e),e},_chooseFlow:function(){const e=this._data.flows||[],t=Boolean(this._inputs.emailAddress)||Boolean(this._emailSid),r=Boolean(this._inputs.phoneCountry)&&Boolean(this._inputs.phoneNumber);for(const n of e){let e=!1,i=!1;for(const t of n.stages)t===c?e=!0:t==l&&(i=!0);if(e==t&&i==r)return n}const n=new Error("No appropriate authentication flow found");throw n.name="NoAuthFlowFoundError",n.required_stages=[],t&&n.required_stages.push(c),r&&n.required_stages.push(l),n.available_flows=e,n},_firstUncompletedStage:function(e){const t=(this._data||{}).completed||[];for(let r=0;r<e.stages.length;++r){const n=e.stages[r];if(-1===t.indexOf(n))return n}}}},7434:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var i=n(r(2043));i.default.methodFactory=function(e,t,r){return function(...t){return this.prefix&&t.unshift(this.prefix),"error"===e||"warn"===e||"trace"===e||"info"===e?console[e](...t):console.log(...t)}};const s=i.default.getLogger("matrix");t.logger=s,s.setLevel(i.default.levels.DEBUG),function e(t){t.withPrefix=function(t){return function(t){const r=i.default.getLogger(`matrix-${t}`);return r.prefix!==t&&(e(r),r.prefix=t,r.setLevel(i.default.levels.DEBUG)),r}((this.prefix||"")+t)}}(s)},8070:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0});var i={request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,ContentHelpers:!0,createNewMatrixCall:!0,setMatrixCallAudioOutput:!0,setMatrixCallAudioInput:!0,setMatrixCallVideoInput:!0};t.request=function(e){O=e},t.getRequest=function(){return O},t.wrapRequest=function(e){const t=O;O=function(r,n){return e(t,r,n)}},t.setCryptoStoreFactory=function(e){P=e},t.createClient=function(e){return"string"==typeof e&&(e={baseUrl:e}),e.request=e.request||O,e.store=e.store||new o.MemoryStore({localStorage:r.g.localStorage}),e.scheduler=e.scheduler||new a.MatrixScheduler,e.cryptoStore=e.cryptoStore||P(),new c.MatrixClient(e)},Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return R.createNewMatrixCall}}),Object.defineProperty(t,"setMatrixCallAudioOutput",{enumerable:!0,get:function(){return R.setAudioOutput}}),Object.defineProperty(t,"setMatrixCallAudioInput",{enumerable:!0,get:function(){return R.setAudioInput}}),Object.defineProperty(t,"setMatrixCallVideoInput",{enumerable:!0,get:function(){return R.setVideoInput}}),t.ContentHelpers=void 0;var s=r(1045);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var o=r(1703);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=r(9443);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var c=r(2168);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var l=r(7715);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var u=r(9118);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var h=r(2741);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var d=r(9489);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var p=r(4369);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var f=r(7366);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var g=r(142);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var m=r(8910);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var y=r(3705);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var v=r(2848);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var _=r(6860);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var b=r(3998);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var w=r(7906);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var S=r(4969);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var k=r(8670);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var E=r(1415);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var x=r(9789);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===x[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}}))}));var A=r(5837);Object.keys(A).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===A[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}}))}));var T=r(7585);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var C=r(3667);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var I=n(r(4656));t.ContentHelpers=I;var R=r(9679);let O,P=()=>new s.MemoryCryptoStore},3558:(e,t)=>{"use strict";function r(e){this._timeline=[e],this._ourEventIndex=0,this._paginateTokens={b:null,f:null},this._paginateRequests={b:null,f:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=r,r.prototype.getEvent=function(){return this._timeline[this._ourEventIndex]},r.prototype.getTimeline=function(){return this._timeline},r.prototype.getOurEventIndex=function(){return this._ourEventIndex},r.prototype.getPaginateToken=function(e){return this._paginateTokens[e?"b":"f"]},r.prototype.setPaginateToken=function(e,t){this._paginateTokens[t?"b":"f"]=e},r.prototype.addEvents=function(e,t){t?(this._timeline=e.concat(this._timeline),this._ourEventIndex+=e.length):this._timeline=this._timeline.concat(e)}},3705:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=h;var i=r(7187),s=r(8910),o=r(4369),a=n(r(3102)),c=r(7434),l=r(9690);let u;function h(e,t){this.room=e,this._timelineSupport=Boolean(t.timelineSupport),this._liveTimeline=new s.EventTimeline(this),this._unstableClientRelationAggregation=!!t.unstableClientRelationAggregation,this._timelines=[this._liveTimeline],this._eventIdToTimeline={},this._filter=t.filter||null,this._unstableClientRelationAggregation&&(this._relations={})}u=c.logger.log.bind(c.logger),a.inherits(h,i.EventEmitter),h.prototype.getTimelines=function(){return this._timelines},h.prototype.getFilter=function(){return this._filter},h.prototype.setFilter=function(e){this._filter=e},h.prototype.getPendingEvents=function(){return this.room?this._filter?this._filter.filterRoomTimeline(this.room.getPendingEvents()):this.room.getPendingEvents():[]},h.prototype.getLiveTimeline=function(){return this._liveTimeline},h.prototype.eventIdToTimeline=function(e){return this._eventIdToTimeline[e]},h.prototype.replaceEventId=function(e,t){const r=this._eventIdToTimeline[e];r&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=r)},h.prototype.resetLiveTimeline=function(e,t){const r=!this._timelineSupport||!t,n=this._liveTimeline,i=r?n.forkLive(s.EventTimeline.FORWARDS):n.fork(s.EventTimeline.FORWARDS);r?(this._timelines=[i],this._eventIdToTimeline={}):this._timelines.push(i),t&&n.setPaginationToken(t,s.EventTimeline.FORWARDS),i.setPaginationToken(e,s.EventTimeline.BACKWARDS),this._liveTimeline=i,this.emit("Room.timelineReset",this.room,this,r)},h.prototype.getTimelineForEvent=function(e){const t=this._eventIdToTimeline[e];return void 0===t?null:t},h.prototype.findEventById=function(e){const t=this.getTimelineForEvent(e);if(t)return a.findElement(t.getEvents(),(function(t){return t.getId()==e}))},h.prototype.addTimeline=function(){if(!this._timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new s.EventTimeline(this);return this._timelines.push(e),e},h.prototype.addEventsToTimeline=function(e,t,r,n){if(!r)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&r==this._liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this._filter&&!(e=this._filter.filterRoomTimeline(e)).length)return;const i=t?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS,o=t?s.EventTimeline.FORWARDS:s.EventTimeline.BACKWARDS;let a=!1,l=!1;for(let n=0;n<e.length;n++){const h=e[n],d=h.getId(),p=this._eventIdToTimeline[d];if(!p){this.addEventToTimeline(h,r,t),l=!0,a=!0;continue}if(l=!1,p==r){u("Event "+d+" already in timeline "+r);continue}const f=r.getNeighbouringTimeline(i);if(f){u(p==f?"Event "+d+" in neighbouring timeline - switching to "+p:"Event "+d+" already in a different timeline "+p),r=p;continue}c.logger.info("Already have timeline for "+d+" - joining timeline "+r+" to "+p);const g=p===this._liveTimeline,m=r===this._liveTimeline,y=i===s.EventTimeline.BACKWARDS&&g,v=i===s.EventTimeline.FORWARDS&&m;y||v?(y&&c.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+p+")"),v&&c.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+r+")")):(r.setNeighbouringTimeline(p,i),p.setNeighbouringTimeline(r,o),r=p,a=!0)}if(l||!a){if(i===s.EventTimeline.FORWARDS&&r===this._liveTimeline)return c.logger.warn({lastEventWasNew:l,didUpdate:a}),void c.logger.warn(`Refusing to set forwards pagination token of live timeline ${r} to ${n}`);r.setPaginationToken(n,i)}},h.prototype.addLiveEvent=function(e,t,r){if(this._filter&&!this._filter.filterRoomTimeline([e]).length)return;const n=this._eventIdToTimeline[e.getId()];if(n)if("replace"===t){u("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=n.getEvents();for(let r=0;r<t.length;r++)if(t[r].getId()===e.getId()){s.EventTimeline.setEventMetadata(e,n.getState(s.EventTimeline.FORWARDS),!1),t[r].encryptedType||(t[r]=e);break}}else u("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this._liveTimeline,!1,r)},h.prototype.addEventToTimeline=function(e,t,r,n){const i=e.getId();t.addEvent(e,r),this._eventIdToTimeline[i]=t,this.setRelationsTarget(e),this.aggregateRelations(e);const s={timeline:t,liveEvent:!r&&t==this._liveTimeline&&!n};this.emit("Room.timeline",e,this.room,Boolean(r),!1,s)},h.prototype.handleRemoteEcho=function(e,t,r){const n=this._eventIdToTimeline[t];n?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[r]=n):this._filter?this._filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this._liveTimeline,!1):this.addEventToTimeline(e,this._liveTimeline,!1)},h.prototype.removeEvent=function(e){const t=this._eventIdToTimeline[e];if(!t)return null;const r=t.removeEvent(e);if(r){delete this._eventIdToTimeline[e];const n={timeline:t};this.emit("Room.timeline",r,this.room,void 0,!0,n)}return r},h.prototype.compareEventOrdering=function(e,t){if(e==t)return 0;const r=this._eventIdToTimeline[e],n=this._eventIdToTimeline[t];if(void 0===r)return null;if(void 0===n)return null;if(r===n){let n,i;const s=r.getEvents();for(let r=0;r<s.length&&(void 0===n||void 0===i);r++){const o=s[r].getId();o==e&&(n=r),o==t&&(i=r)}return n-i}let i=r;for(;i;){if(i===n)return-1;i=i.getNeighbouringTimeline(s.EventTimeline.FORWARDS)}for(i=r;i;){if(i===n)return 1;i=i.getNeighbouringTimeline(s.EventTimeline.BACKWARDS)}return null},h.prototype.getRelationsForEvent=function(e,t,r){if(!this._unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!r)throw new Error("Invalid arguments for `getRelationsForEvent`");return((this._relations[e]||{})[t]||{})[r]},h.prototype.setRelationsTarget=function(e){if(!this._unstableClientRelationAggregation)return;const t=this._relations[e.getId()];if(!t)return;const r=t["m.replace"];if(!r)return;const n=r["m.room.message"];n&&n.setTargetEvent(e)},h.prototype.aggregateRelations=function(e){if(!this._unstableClientRelationAggregation)return;if(e.isRedacted()||e.status===o.EventStatus.CANCELLED)return;if(e.isBeingDecrypted())return void e.once("Event.decrypted",(()=>{this.aggregateRelations(e)}));const t=e.getRelation();if(!t)return;const r=t.event_id,n=t.rel_type,i=e.getType();let s=this._relations[r];s||(s=this._relations[r]={});let a=s[n];a||(a=s[n]={});let c,u=a[i],h=!1;u||(u=a[i]=new l.Relations(n,i,this.room),h=!0,c=this.findEventById(r)||this.room.getPendingEvent(r),c&&u.setTargetEvent(c)),u.addEvent(e),h&&c&&c.emit("Event.relationsCreated",n,i)}},8910:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=i;var n=r(6860);function i(e){this._eventTimelineSet=e,this._roomId=e.room?e.room.roomId:null,this._events=[],this._baseIndex=0,this._startState=new n.RoomState(this._roomId),this._startState.paginationToken=null,this._endState=new n.RoomState(this._roomId),this._endState.paginationToken=null,this._prevTimeline=null,this._nextTimeline=null,this._paginationRequests={b:null,f:null},this._name=this._roomId+":"+(new Date).toISOString()}i.BACKWARDS="b",i.FORWARDS="f",i.prototype.initialiseState=function(e){if(this._events.length>0)throw new Error("Cannot initialise state after events are added");for(const t of e)Object.freeze(t);this._startState.setStateEvents(e),this._endState.setStateEvents(e)},i.prototype.forkLive=function(e){const t=this.getState(e),r=new i(this._eventTimelineSet);return r._startState=t.clone(),r._endState=t,this._endState=t.clone(),r},i.prototype.fork=function(e){const t=this.getState(e),r=new i(this._eventTimelineSet);return r._startState=t.clone(),r._endState=t.clone(),r},i.prototype.getRoomId=function(){return this._roomId},i.prototype.getFilter=function(){return this._eventTimelineSet.getFilter()},i.prototype.getTimelineSet=function(){return this._eventTimelineSet},i.prototype.getBaseIndex=function(){return this._baseIndex},i.prototype.getEvents=function(){return this._events},i.prototype.getState=function(e){if(e==i.BACKWARDS)return this._startState;if(e==i.FORWARDS)return this._endState;throw new Error("Invalid direction '"+e+"'")},i.prototype.getPaginationToken=function(e){return this.getState(e).paginationToken},i.prototype.setPaginationToken=function(e,t){this.getState(t).paginationToken=e},i.prototype.getNeighbouringTimeline=function(e){if(e==i.BACKWARDS)return this._prevTimeline;if(e==i.FORWARDS)return this._nextTimeline;throw new Error("Invalid direction '"+e+"'")},i.prototype.setNeighbouringTimeline=function(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==i.BACKWARDS)this._prevTimeline=e;else{if(t!=i.FORWARDS)throw new Error("Invalid direction '"+t+"'");this._nextTimeline=e}this.setPaginationToken(null,t)},i.prototype.addEvent=function(e,t){const r=t?this._startState:this._endState,n=this.getTimelineSet();let s;n.room&&n.room.getUnfilteredTimelineSet()===n&&(i.setEventMetadata(e,r,t),e.isState()&&(r.setStateEvents([e]),e.sender&&("m.room.member"!==e.getType()||t)||i.setEventMetadata(e,r,t))),s=t?0:this._events.length,this._events.splice(s,0,e),t&&this._baseIndex++},i.setEventMetadata=function(e,t,r){e.sender=t.getSentinelMember(e.getSender()),"m.room.member"===e.getType()&&(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&r&&(e.forwardLooking=!1)},i.prototype.removeEvent=function(e){for(let t=this._events.length-1;t>=0;t--){const r=this._events[t];if(r.getId()==e)return this._events.splice(t,1),t<this._baseIndex&&this._baseIndex--,r}return null},i.prototype.toString=function(){return this._name}},4369:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixEvent=t.EventStatus=void 0;var i=r(7187),s=n(r(3102)),o=r(7434);t.EventStatus={NOT_SENT:"not_sent",ENCRYPTING:"encrypting",SENDING:"sending",QUEUED:"queued",SENT:"sent",CANCELLED:"cancelled"};const a={};function c(e){return a[e]||(a[e]=e),a[e]}const l=function(e){["state_key","type","sender","room_id","membership"].forEach((t=>{e[t]&&(e[t]=c(e[t]))})),["membership","avatar_url","displayname"].forEach((t=>{e.content&&e.content[t]&&(e.content[t]=c(e.content[t]))})),["rel_type"].forEach((t=>{e.content&&e.content["m.relates_to"]&&e.content["m.relates_to"][t]&&(e.content["m.relates_to"][t]=c(e.content["m.relates_to"][t]))})),this.event=e||{},this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,this._pushActions=null,this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this._clearEvent={},this._senderCurve25519Key=null,this._claimedEd25519Key=null,this._forwardingCurve25519KeyChain=[],this._untrusted=null,this._decryptionPromise=null,this._retryDecryption=!1,this.verificationRequest=null,this._txnId=null,this._localTimestamp=Date.now()-this.getAge()};t.MatrixEvent=l,s.inherits(l,i.EventEmitter),s.extend(l.prototype,{getId:function(){return this.event.event_id},getSender:function(){return this.event.sender||this.event.user_id},getType:function(){return this._clearEvent.type||this.event.type},getWireType:function(){return this.event.type},getRoomId:function(){return this.event.room_id},getTs:function(){return this.event.origin_server_ts},getDate:function(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null},getOriginalContent:function(){return this._localRedactionEvent?{}:this._clearEvent.content||this.event.content||{}},getContent:function(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()},getWireContent:function(){return this.event.content||{}},getPrevContent:function(){return this.getUnsigned().prev_content||this.event.prev_content||{}},getDirectionalContent:function(){return this.forwardLooking?this.getContent():this.getPrevContent()},getAge:function(){return this.getUnsigned().age||this.event.age},getLocalAge:function(){return Date.now()-this._localTimestamp},getStateKey:function(){return this.event.state_key},isState:function(){return void 0!==this.event.state_key},makeEncrypted:function(e,t,r,n){this._clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this._senderCurve25519Key=r,this._claimedEd25519Key=n},isBeingDecrypted:function(){return null!=this._decryptionPromise},isDecryptionFailure:function(){return this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"===this._clearEvent.content.msgtype},attemptDecryption:async function(e,t){if(!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");if(this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"!==this._clearEvent.content.msgtype)throw new Error("Attempt to decrypt event which has already been decrypted");return this._decryptionPromise?(o.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this._retryDecryption=!0,this._decryptionPromise):(this._decryptionPromise=this._decryptionLoop(e,t),this._decryptionPromise)},cancelAndResendKeyRequest:function(e,t){const r=this.getWireContent();return e.requestRoomKey({algorithm:r.algorithm,room_id:this.getRoomId(),session_id:r.session_id,sender_key:r.sender_key},this.getKeyRequestRecipients(t),!0)},getKeyRequestRecipients:function(e){const t=this.getWireContent(),r=[{userId:e,deviceId:"*"}],n=this.getSender();return n!==e&&r.push({userId:n,deviceId:t.device_id}),r},_decryptionLoop:async function(e,t){for(await Promise.resolve();;){let r,n;this._retryDecryption=!1;try{e?(r=await e.decryptEvent(this),t&&o.logger.info(`Decrypted event on retry (id=${this.getId()})`)):r=this._badEncryptedMessage("Encryption not enabled")}catch(e){if("DecryptionError"!==e.name){const r=t?"re":"";return o.logger.error(`Error ${r}decrypting event (id=${this.getId()}): ${e.stack||e}`),this._decryptionPromise=null,void(this._retryDecryption=!1)}if(n=e,this._retryDecryption){o.logger.log(`Got error decrypting event (id=${this.getId()}: ${e}), but retrying`);continue}o.logger.warn(`Error decrypting event (id=${this.getId()}): ${e.detailedString}`),r=this._badEncryptedMessage(e.message)}return this._decryptionPromise=null,this._retryDecryption=!1,this._setClearData(r),this.setPushActions(null),void this.emit("Event.decrypted",this,n)}},_badEncryptedMessage:function(e){return{clearEvent:{type:"m.room.message",content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}},_setClearData:function(e){this._clearEvent=e.clearEvent,this._senderCurve25519Key=e.senderCurve25519Key||null,this._claimedEd25519Key=e.claimedEd25519Key||null,this._forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this._untrusted=e.untrusted||!1},getClearContent:function(){const e=this._clearEvent;return e&&e.content?e.content:null},isEncrypted:function(){return!this.isState()&&"m.room.encrypted"===this.event.type},getSenderKey:function(){return this._senderCurve25519Key},getKeysClaimed:function(){return{ed25519:this._claimedEd25519Key}},getClaimedEd25519Key:function(){return this._claimedEd25519Key},getForwardingCurve25519KeyChain:function(){return this._forwardingCurve25519KeyChain},isKeySourceUntrusted:function(){return this._untrusted},getUnsigned:function(){return this.event.unsigned||{}},unmarkLocallyRedacted:function(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e},markLocallyRedacted:function(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)},makeRedacted:function(e){if(!e.event)throw new Error("invalid redaction_event in makeRedacted");let t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(u[t]||delete this.event[t]);const r=h[this.getType()]||{},n=this.getContent();for(t in n)n.hasOwnProperty(t)&&(r[t]||delete n[t])},isRedacted:function(){return Boolean(this.getUnsigned().redacted_because)},isRedaction:function(){return"m.room.redaction"===this.getType()},getRedactionEvent:function(){return this.isRedacted()?this._clearEvent.unsigned?this._clearEvent.unsigned.redacted_because:this.event.unsigned.redacted_because?this.event.unsigned.redacted_because:{}:null},getPushActions:function(){return this._pushActions},setPushActions:function(e){this._pushActions=e},handleRemoteEcho:function(e){const t=this.getUnsigned(),r=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit("Event.localEventIdReplaced",this)},isSending(){return!!this.status},setStatus(e){this.status=e,this.emit("Event.status",this,e)},replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)},isRelation(e){const t=this.getWireContent(),r=t&&t["m.relates_to"];return r&&r.rel_type&&r.event_id&&(e&&r.rel_type===e||!e)},getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null},makeReplaced(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this))},getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status},getServerAggregatedRelation(e){const t=this.getUnsigned()["m.relations"];if(t)return t[e]},replacingEventId(){const e=this.getServerAggregatedRelation("m.replace");return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0},replacingEvent(){return this._replacingEvent},replacingEventDate(){const e=this.getServerAggregatedRelation("m.replace");if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()},localRedactionEvent(){return this._localRedactionEvent},getAssociatedId(){const e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0},hasAssocation(){return!!this.getAssociatedId()},updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)},flagCancelled(e=!0){this._isCancelled=e},isCancelled(){return this._isCancelled},toJSON(){const e={type:this.getType(),sender:this.getSender(),content:this.getContent(),event_id:this.getId(),origin_server_ts:this.getTs(),unsigned:this.getUnsigned(),room_id:this.getRoomId()};return this.isRedaction()&&(e.redacts=this.event.redacts),this.isEncrypted()?{decrypted:e,encrypted:this.event}:e},setVerificationRequest:function(e){this.verificationRequest=e},setTxnId(e){this._txnId=e},getTxnId(){return this._txnId}});const u=["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"].reduce((function(e,t){return e[t]=1,e}),{}),h={"m.room.member":{membership:1},"m.room.create":{creator:1},"m.room.join_rules":{join_rule:1},"m.room.power_levels":{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},"m.room.aliases":{aliases:1}}},142:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.Group=o;var i=n(r(3102)),s=r(7187);function o(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}i.inherits(o,s.EventEmitter),o.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},o.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},o.prototype.setInviter=function(e){this.inviter=e}},9690:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.Relations=void 0;var i=n(r(9713)),s=r(7187),o=r(4369),a=r(7434);class c extends s.EventEmitter{constructor(e,t,r){super(),(0,i.default)(this,"_onEventStatus",((e,t)=>{e.isSending()?t===o.EventStatus.CANCELLED&&(e.removeListener("Event.status",this._onEventStatus),this._removeEvent(e)):e.removeListener("Event.status",this._onEventStatus)})),(0,i.default)(this,"_onBeforeRedaction",(e=>{this._relations.has(e)&&(this._relations.delete(e),"m.annotation"===this.relationType?this._removeAnnotationFromAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),e.removeListener("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.redaction",e))})),this.relationType=e,this.eventType=t,this._relations=new Set,this._annotationsByKey={},this._annotationsBySender={},this._sortedAnnotationsByKey=[],this._targetEvent=null}addEvent(e){if(this._relations.has(e))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const r=t.rel_type,n=e.getType();this.relationType===r&&this.eventType===n?(e.isSending()&&e.on("Event.status",this._onEventStatus),this._relations.add(e),"m.annotation"===this.relationType?this._addAnnotationToAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),e.on("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.add",e)):a.logger.error("Event relation info doesn't match this container")}_removeEvent(e){if(!this._relations.has(e))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const r=t.rel_type,n=e.getType();this.relationType===r&&this.eventType===n?(this._relations.delete(e),"m.annotation"===this.relationType?this._removeAnnotationFromAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),this.emit("Relations.remove",e)):a.logger.error("Event relation info doesn't match this container")}getRelations(){return[...this._relations]}_addAnnotationToAggregation(e){const{key:t}=e.getRelation();if(!t)return;let r=this._annotationsByKey[t];r||(r=this._annotationsByKey[t]=new Set,this._sortedAnnotationsByKey.push([t,r])),r.add(e),this._sortedAnnotationsByKey.sort(((e,t)=>{const r=e[1];return t[1].size-r.size}));const n=e.getSender();let i=this._annotationsBySender[n];i||(i=this._annotationsBySender[n]=new Set),i.add(e)}_removeAnnotationFromAggregation(e){const{key:t}=e.getRelation();if(!t)return;const r=this._annotationsByKey[t];r&&(r.delete(e),this._sortedAnnotationsByKey.sort(((e,t)=>{const r=e[1];return t[1].size-r.size})));const n=e.getSender(),i=this._annotationsBySender[n];i&&i.delete(e)}getSortedAnnotationsByKey(){return"m.annotation"!==this.relationType?null:this._sortedAnnotationsByKey}getAnnotationsBySender(){return"m.annotation"!==this.relationType?null:this._annotationsBySender}getLastReplacement(){if("m.replace"!==this.relationType)return null;if(!this._targetEvent)return null;const e=this._targetEvent.getServerAggregatedRelation("m.replace"),t=e&&e.origin_server_ts;return this.getRelations().reduce(((e,r)=>r.getSender()!==this._targetEvent.getSender()||t&&t>r.getTs()||e&&e.getTs()>r.getTs()?e:r),null)}setTargetEvent(e){if(!this._targetEvent&&(this._targetEvent=e,"m.replace"===this.relationType)){const e=this.getLastReplacement();e&&this._targetEvent.makeReplaced(e)}}}t.Relations=c},2848:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMember=a;var i=r(7187),s=r(3667),o=n(r(3102));function a(e,t){this.roomId=e,this.userId=t,this.typing=!1,this.name=t,this.rawDisplayName=t,this.powerLevel=0,this.powerLevelNorm=0,this.user=null,this.membership=null,this.events={member:null},this._isOutOfBand=!1,this._updateModifiedTime()}o.inherits(a,i.EventEmitter),a.prototype.markOutOfBand=function(){this._isOutOfBand=!0},a.prototype.isOutOfBand=function(){return this._isOutOfBand},a.prototype.setMembershipEvent=function(e,t){if("m.room.member"!==e.getType())return;this._isOutOfBand=!1,this.events.member=e;const r=this.membership;this.membership=e.getDirectionalContent().membership;const n=this.name;this.name=function(e,t,r){if(!t||t===e)return e;if(!o.removeHiddenChars(t))return e;if(!r)return t;let n=c.test(t);return n||(n=l.test(t)),n||(n=r.getUserIdsWithDisplayName(t).some((t=>t!==e))),n?t+" ("+e+")":t}(this.userId,e.getDirectionalContent().displayname,t),this.rawDisplayName=e.getDirectionalContent().displayname||this.userId,r!==this.membership&&(this._updateModifiedTime(),this.emit("RoomMember.membership",e,this,r)),n!==this.name&&(this._updateModifiedTime(),this.emit("RoomMember.name",e,this,n))},a.prototype.setPowerLevelEvent=function(e){if("m.room.power_levels"!==e.getType())return;const t=e.getDirectionalContent();let r=t.users_default||0;o.forEach(o.values(t.users),(function(e){r=Math.max(r,e)}));const n=this.powerLevel,i=this.powerLevelNorm;t.users&&void 0!==t.users[this.userId]?this.powerLevel=t.users[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,r>0&&(this.powerLevelNorm=100*this.powerLevel/r),n===this.powerLevel&&i===this.powerLevelNorm||(this._updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))},a.prototype.setTypingEvent=function(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const r=e.getContent().user_ids;o.isArray(r)&&(-1!==r.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this._updateModifiedTime(),this.emit("RoomMember.typing",e,this)))},a.prototype._updateModifiedTime=function(){this._modified=Date.now()},a.prototype.getLastModifiedTime=function(){return this._modified},a.prototype.isKicked=function(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()},a.prototype.getDMInviter=function(){if(this.events.member){const e=this.events.member;let t=e.getContent(),r=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),r=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return r}},a.prototype.getAvatarUrl=function(e,t,r,n,i,o){void 0===i&&(i=!0);const a=this.getMxcAvatarUrl();if(!a&&!i)return null;return(0,s.getHttpUriForMxc)(e,a,t,r,n,o)||null},a.prototype.getMxcAvatarUrl=function(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null};const c=/@.+:.+/,l=/[\u200E\u200F\u202A-\u202F]/},6860:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomState=l;var i=r(7187),s=r(2848),o=r(7434),a=n(r(3102)),c=r(2481);function l(e,t){this.roomId=e,this.members={},this.events=new Map,this.paginationToken=null,this._sentinels={},this._updateModifiedTime(),this._displayNameToUserIds={},this._userIdsToDisplayNames={},this._tokenToInvite={},this._joinedMemberCount=null,this._summaryJoinedMemberCount=null,this._invitedMemberCount=null,this._summaryInvitedMemberCount=null,t||(t={status:1}),this._oobMemberFlags=t}function u(e,t,r){const n=e._userIdsToDisplayNames[t];if(delete e._userIdsToDisplayNames[t],n){const r=a.removeHiddenChars(n),i=e._displayNameToUserIds[r];if(i){const n=i.filter((e=>e!==t));e._displayNameToUserIds[r]=n}}e._userIdsToDisplayNames[t]=r;const i=r&&a.removeHiddenChars(r);i&&(e._displayNameToUserIds[i]||(e._displayNameToUserIds[i]=[]),e._displayNameToUserIds[i].push(t))}a.inherits(l,i.EventEmitter),l.prototype.getJoinedMemberCount=function(){return null!==this._summaryJoinedMemberCount?this._summaryJoinedMemberCount:(null===this._joinedMemberCount&&(this._joinedMemberCount=this.getMembers().reduce(((e,t)=>"join"===t.membership?e+1:e),0)),this._joinedMemberCount)},l.prototype.setJoinedMemberCount=function(e){this._summaryJoinedMemberCount=e},l.prototype.getInvitedMemberCount=function(){return null!==this._summaryInvitedMemberCount?this._summaryInvitedMemberCount:(null===this._invitedMemberCount&&(this._invitedMemberCount=this.getMembers().reduce(((e,t)=>"invite"===t.membership?e+1:e),0)),this._invitedMemberCount)},l.prototype.setInvitedMemberCount=function(e){this._summaryInvitedMemberCount=e},l.prototype.getMembers=function(){return a.values(this.members)},l.prototype.getMembersExcept=function(e){return a.values(this.members).filter((t=>!e.includes(t.userId)))},l.prototype.getMember=function(e){return this.members[e]||null},l.prototype.getSentinelMember=function(e){if(!e)return null;let t=this._sentinels[e];if(void 0===t){t=new s.RoomMember(this.roomId,e);const r=this.members[e];r&&t.setMembershipEvent(r.events.member,this),this._sentinels[e]=t}return t},l.prototype.getStateEvents=function(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());return this.events.get(e).get(t)||null},l.prototype.clone=function(){const e=new l(this.roomId,this._oobMemberFlags),t=this._oobMemberFlags.status;return this._oobMemberFlags.status=1,Array.from(this.events.values()).forEach((t=>{e.setStateEvents(Array.from(t.values()))})),this._oobMemberFlags.status=t,null!==this._summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this._summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),3==this._oobMemberFlags.status&&this.getMembers().forEach((t=>{t.isOutOfBand()&&e.getMember(t.userId).markOutOfBand()})),e},l.prototype.setUnknownStateEvents=function(e){const t=e.filter((e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey())));this.setStateEvents(t)},l.prototype.setStateEvents=function(e){const t=this;this._updateModifiedTime(),a.forEach(e,(function(e){if(e.getRoomId()!==t.roomId)return;if(!e.isState())return;const r=t._getStateEventMatching(e);t._setStateEvent(e),"m.room.member"===e.getType()&&(u(t,e.getStateKey(),e.getContent().displayname),function(e,t){if(!t.getContent().third_party_invite)return;const r=(t.getContent().third_party_invite.signed||{}).token;r&&e.getStateEvents("m.room.third_party_invite",r)&&(e._tokenToInvite[r]=t)}(t,e)),t.emit("RoomState.events",e,t,r)})),a.forEach(e,(function(e){if(e.getRoomId()===t.roomId&&e.isState())if("m.room.member"===e.getType()){const r=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const n=t._getOrCreateMember(r,e);n.setMembershipEvent(e,t),t._updateMember(n),t.emit("RoomState.members",e,t,n)}else if("m.room.power_levels"===e.getType()){const r=a.values(t.members);a.forEach(r,(function(r){r.setPowerLevelEvent(e),t.emit("RoomState.members",e,t,r)})),t._sentinels={}}}))},l.prototype._getOrCreateMember=function(e,t){let r=this.members[e];return r||(r=new s.RoomMember(this.roomId,e),this.members[e]=r,this.emit("RoomState.newMember",t,this,r)),r},l.prototype._setStateEvent=function(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)},l.prototype._getStateEventMatching=function(e){return this.events.has(e.getType())?this.events.get(e.getType()).get(e.getStateKey()):null},l.prototype._updateMember=function(e){const t=this.getStateEvents("m.room.power_levels","");t&&e.setPowerLevelEvent(t),delete this._sentinels[e.userId],this.members[e.userId]=e,this._joinedMemberCount=null,this._invitedMemberCount=null},l.prototype.needsOutOfBandMembers=function(){return 1===this._oobMemberFlags.status},l.prototype.markOutOfBandMembersStarted=function(){1===this._oobMemberFlags.status&&(this._oobMemberFlags.status=2)},l.prototype.markOutOfBandMembersFailed=function(){2===this._oobMemberFlags.status&&(this._oobMemberFlags.status=1)},l.prototype.clearOutOfBandMembers=function(){let e=0;Object.keys(this.members).forEach((t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])})),o.logger.log(`LL: RoomState removed ${e} members...`),this._oobMemberFlags.status=1},l.prototype.setOutOfBandMembers=function(e){o.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),2===this._oobMemberFlags.status&&(o.logger.log("LL: RoomState put in OOB_STATUS_FINISHED state ..."),this._oobMemberFlags.status=3,e.forEach((e=>this._setOutOfBandMember(e))))},l.prototype._setOutOfBandMember=function(e){if("m.room.member"!==e.getType())return;const t=e.getStateKey(),r=this.getMember(t);if(r&&!r.isOutOfBand())return;const n=this._getOrCreateMember(t,e);n.setMembershipEvent(e,this),n.markOutOfBand(),u(this,n.userId,n.name),this._setStateEvent(e),this._updateMember(n),this.emit("RoomState.members",e,this,n)},l.prototype.setTypingEvent=function(e){a.forEach(a.values(this.members),(function(t){t.setTypingEvent(e)}))},l.prototype.getInviteForThreePidToken=function(e){return this._tokenToInvite[e]||null},l.prototype._updateModifiedTime=function(){this._modified=Date.now()},l.prototype.getLastModifiedTime=function(){return this._modified},l.prototype.getUserIdsWithDisplayName=function(e){return this._displayNameToUserIds[a.removeHiddenChars(e)]||[]},l.prototype.maySendRedactionForEvent=function(e,t){const r=this.getMember(t);if(!r||"leave"===r.membership)return!1;if(e.status||e.isRedacted())return!1;const n=this.maySendEvent("m.room.redaction",t);return e.getSender()===t?n:this._hasSufficientPowerLevelFor("redact",r.powerLevel)},l.prototype._hasSufficientPowerLevelFor=function(e,t){const r=this.getStateEvents("m.room.power_levels","");let n={};r&&(n=r.getContent());let i=50;return a.isNumber(n[e])&&(i=n[e]),t>=i},l.prototype.maySendMessage=function(e){return this._maySendEventOfType("m.room.message",e,!1)},l.prototype.maySendEvent=function(e,t){return this._maySendEventOfType(e,t,!1)},l.prototype.mayClientSendStateEvent=function(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)},l.prototype.maySendStateEvent=function(e,t){return this._maySendEventOfType(e,t,!0)},l.prototype._maySendEventOfType=function(e,t,r){const n=this.getStateEvents("m.room.power_levels","");let i,s={},o=0,a=0,c=0;if(n){i=n.getContent(),s=i.events||{},o=Number.isFinite(i.state_default)?i.state_default:50;const e=i.users&&i.users[t];Number.isFinite(e)?c=e:Number.isFinite(i.users_default)&&(c=i.users_default),Number.isFinite(i.events_default)&&(a=i.events_default)}let l=r?o:a;return Number.isFinite(s[e])&&(l=s[e]),c>=l},l.prototype.mayTriggerNotifOfType=function(e,t){const r=this.getMember(t);if(!r)return!1;const n=this.getStateEvents("m.room.power_levels","");let i=50;return n&&n.getContent()&&n.getContent().notifications&&a.isNumber(n.getContent().notifications[e])&&(i=n.getContent().notifications[e]),r.powerLevel>=i},l.prototype.getJoinRule=function(){const e=this.getStateEvents(c.EventType.RoomJoinRules,"");return(e?e.getContent():{}).join_rule||"invite"}},5205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=function(e,t){this.roomId=e,this.info=t}},7366:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.Room=y;var i=r(7187),s=r(3705),o=r(8910),a=r(3667),c=n(r(3102)),l=r(4369),u=r(2848),h=r(5205),d=r(7434),p=r(771),f=r(2481);const g=["1","2","3","4","5","6"];function m(e,t,r){const n={content:{},type:"m.receipt",room_id:t.getRoomId()};return n.content[t.getId()]={},n.content[t.getId()][r]={},n.content[t.getId()][r][e]={ts:t.getTs()},new l.MatrixEvent(n)}function y(e,t,r,n){if((n=n||{}).pendingEventOrdering=n.pendingEventOrdering||"chronological",this.setMaxListeners(100),this.reEmitter=new p.ReEmitter(this),-1===["chronological","detached"].indexOf(n.pendingEventOrdering))throw new Error("opts.pendingEventOrdering MUST be either 'chronological' or 'detached'. Got: '"+n.pendingEventOrdering+"'");this.myUserId=r,this.roomId=e,this.name=e,this.tags={},this.accountData={},this.summary=null,this.storageToken=n.storageToken,this._opts=n,this._txnToEvent={},this._receipts={},this._receiptCacheByEventId={},this._realReceipts={},this._notificationCounts={},this._timelineSets=[new s.EventTimelineSet(this,n)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this._fixUpLegacyTimelineFields(),this._filteredTimelineSets={},"detached"==this._opts.pendingEventOrdering&&(this._pendingEventList=[]),this._blacklistUnverifiedDevices=null,this._selfMembership=null,this._summaryHeroes=null,this._client=t,this._opts.lazyLoadMembers?this._membersPromise=null:this._membersPromise=Promise.resolve()}c.inherits(y,i.EventEmitter),y.prototype.getVersion=function(){const e=this.currentState.getStateEvents("m.room.create","");if(!e)return d.logger.warn("Room "+this.roomId+" does not have an m.room.create event"),"1";const t=e.getContent().room_version;return void 0===t?"1":t},y.prototype.shouldUpgradeToVersion=function(){return g.includes(this.getVersion())?null:"6"},y.prototype.getRecommendedVersion=async function(){let e=(await this._client.getCapabilities())["m.room_versions"];if(!e){e={default:"6",available:{}};for(const t of g)e.available[t]="stable"}let t=this._checkVersionAgainstCapability(e);if(t.urgent&&t.needsUpgrade){if(d.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),e=(await this._client.getCapabilities(!0))["m.room_versions"],!e)return d.logger.warn("No room version capability - assuming upgrade required."),t;t=this._checkVersionAgainstCapability(e)}return t},y.prototype._checkVersionAgainstCapability=function(e){const t=this.getVersion();d.logger.log(`[${this.roomId}] Current version: ${t}`),d.logger.log(`[${this.roomId}] Version capability: `,e);const r={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((t=>"stable"===e.available[t])).includes(t)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?d.logger.warn(`URGENT upgrade required on ${this.roomId}`):d.logger.warn(`Non-urgent upgrade required on ${this.roomId}`)),r},y.prototype.userMayUpgradeRoom=function(e){return this.currentState.maySendStateEvent("m.room.tombstone",e)},y.prototype.getPendingEvents=function(){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this._opts.pendingEventOrdering);return this._pendingEventList},y.prototype.hasPendingEvent=function(e){return"detached"===this._opts.pendingEventOrdering&&this._pendingEventList.some((t=>t.getId()===e))},y.prototype.getPendingEvent=function(e){return"detached"!==this._opts.pendingEventOrdering?null:this._pendingEventList.find((t=>t.getId()===e))},y.prototype.getLiveTimeline=function(){return this.getUnfilteredTimelineSet().getLiveTimeline()},y.prototype.getLastActiveTimestamp=function(){const e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER},y.prototype.getMyMembership=function(){return this._selfMembership},y.prototype.getDMInviter=function(){if(this.myUserId){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this._selfMembership&&2==this.getInvitedAndJoinedMemberCount()&&this._summaryHeroes.length)return this._summaryHeroes[0]},y.prototype.guessDMUserId=function(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}if(Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length)return this._summaryHeroes[0];const t=this.currentState.getMembers().find((e=>e.userId!==this.myUserId));return t?t.userId:this.myUserId},y.prototype.getAvatarFallbackMember=function(){if(this.getInvitedAndJoinedMemberCount()>2)return;const e=Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length;if(e){const e=this._summaryHeroes.map((e=>this.getMember(e))).find((e=>!!e));if(e)return e}const t=this.currentState.getMembers();if(t.length<=2){const e=t.find((e=>e.userId!==this.myUserId));if(e)return e}if(e){const e=this._summaryHeroes.map((e=>this._client.getUser(e))).find((e=>!!e));if(e){const t=new u.RoomMember(this.roomId,e.userId);return t.user=e,t}}},y.prototype.updateMyMembership=function(e){const t=this._selfMembership;this._selfMembership=e,t!==e&&("leave"===e&&this._cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))},y.prototype._loadMembersFromServer=async function(){const e=this._client.store.getSyncToken(),t=c.encodeParams({not_membership:"leave",at:e}),r=c.encodeUri("/rooms/$roomId/members?"+t,{$roomId:this.roomId}),n=this._client._http;return(await n.authedRequest(void 0,"GET",r)).chunk},y.prototype._loadMembers=async function(){let e=!1,t=await this._client.store.getOutOfBandMembers(this.roomId);return null===t&&(e=!0,t=await this._loadMembersFromServer(),d.logger.log(`LL: got ${t.length} members from server for room ${this.roomId}`)),{memberEvents:t.map(this._client.getEventMapper()),fromServer:e}},y.prototype.loadMembersIfNeeded=function(){if(this._membersPromise)return this._membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this._loadMembers().then((e=>(this.currentState.setOutOfBandMembers(e.memberEvents),this._client.isCryptoEnabled()&&this._client.isRoomEncrypted(this.roomId)&&this._client._crypto.trackRoomDevices(this.roomId),e.fromServer))).catch((e=>{throw this._membersPromise=null,this.currentState.markOutOfBandMembersFailed(),e}));return e.then((e=>{if(e){const e=this.currentState.getMembers().filter((e=>e.isOutOfBand())).map((e=>e.events.member.event));return d.logger.log(`LL: telling store to write ${e.length} members for room ${this.roomId}`),this._client.store.setOutOfBandMembers(this.roomId,e).catch((e=>{d.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((e=>{d.logger.error(e)})),this._membersPromise=e,this._membersPromise},y.prototype.clearLoadedMembersIfNeeded=async function(){this._opts.lazyLoadMembers&&this._membersPromise&&(await this.loadMembersIfNeeded(),await this._client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this._membersPromise=null)},y.prototype._cleanupAfterLeaving=function(){this.clearLoadedMembersIfNeeded().catch((e=>{d.logger.error(`error after clearing loaded members from room ${this.roomId} after leaving`),d.logger.log(e)}))},y.prototype.resetLiveTimeline=function(e,t){for(let r=0;r<this._timelineSets.length;r++)this._timelineSets[r].resetLiveTimeline(e,t);this._fixUpLegacyTimelineFields()},y.prototype._fixUpLegacyTimelineFields=function(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(o.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(o.EventTimeline.FORWARDS)},y.prototype.hasUnverifiedDevices=async function(){if(!this._client.isRoomEncrypted(this.roomId))return!1;const e=await this.getEncryptionTargetMembers();for(const t of e)if(this._client.getStoredDevicesForUser(t.userId).some((e=>e.isUnverified())))return!0;return!1},y.prototype.getTimelineSets=function(){return this._timelineSets},y.prototype.getUnfilteredTimelineSet=function(){return this._timelineSets[0]},y.prototype.getTimelineForEvent=function(e){return this.getUnfilteredTimelineSet().getTimelineForEvent(e)},y.prototype.addTimeline=function(){return this.getUnfilteredTimelineSet().addTimeline()},y.prototype.findEventById=function(e){return this.getUnfilteredTimelineSet().findEventById(e)},y.prototype.getUnreadNotificationCount=function(e){return e=e||"total",this._notificationCounts[e]},y.prototype.setUnreadNotificationCount=function(e,t){this._notificationCounts[e]=t},y.prototype.setSummary=function(e){const t=e["m.heroes"],r=e["m.joined_member_count"],n=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(n)&&this.currentState.setInvitedMemberCount(n),Array.isArray(t)&&(this._summaryHeroes=t.filter((e=>e!==this.myUserId)))},y.prototype.setBlacklistUnverifiedDevices=function(e){this._blacklistUnverifiedDevices=e},y.prototype.getBlacklistUnverifiedDevices=function(){return this._blacklistUnverifiedDevices},y.prototype.getAvatarUrl=function(e,t,r,n,i){const s=this.currentState.getStateEvents(f.EventType.RoomAvatar,"");if(void 0===i&&(i=!0),!s&&!i)return null;const o=s?s.getContent().url:null;return o?(0,a.getHttpUriForMxc)(e,o,t,r,n):null},y.prototype.getMxcAvatarUrl=function(){const e=this.currentState.getStateEvents(f.EventType.RoomAvatar,"");return e?e.getContent().url:null},y.prototype.getAliases=function(){const e=[],t=this.currentState.getStateEvents("m.room.aliases");if(t)for(let r=0;r<t.length;++r){const n=t[r];if(c.isArray(n.getContent().aliases)){const t=n.getContent().aliases.filter((e=>"string"==typeof e&&"#"===e[0]&&!!e.endsWith(`:${n.getStateKey()}`)));Array.prototype.push.apply(e,t)}}return e},y.prototype.getCanonicalAlias=function(){const e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alias||null},y.prototype.getAltAliases=function(){const e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alt_aliases||[]},y.prototype.addEventsToTimeline=function(e,t,r,n){r.getTimelineSet().addEventsToTimeline(e,t,r,n)},y.prototype.getMember=function(e){return this.currentState.getMember(e)},y.prototype.getJoinedMembers=function(){return this.getMembersWithMembership("join")},y.prototype.getJoinedMemberCount=function(){return this.currentState.getJoinedMemberCount()},y.prototype.getInvitedMemberCount=function(){return this.currentState.getInvitedMemberCount()},y.prototype.getInvitedAndJoinedMemberCount=function(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()},y.prototype.getMembersWithMembership=function(e){return c.filter(this.currentState.getMembers(),(function(t){return t.membership===e}))},y.prototype.getEncryptionTargetMembers=async function(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e},y.prototype.shouldEncryptForInvitedMembers=function(){const e=this.currentState.getStateEvents("m.room.history_visibility","");return e&&e.getContent()&&"joined"!==e.getContent().history_visibility},y.prototype.getDefaultRoomName=function(e){return _(this,e,!0)},y.prototype.hasMembershipState=function(e,t){const r=this.getMember(e);return!!r&&r.membership===t},y.prototype.getOrCreateFilteredTimelineSet=function(e){if(this._filteredTimelineSets[e.filterId])return this._filteredTimelineSets[e.filterId];const t=Object.assign({filter:e},this._opts),r=new s.EventTimelineSet(this,t);this.reEmitter.reEmit(r,["Room.timeline","Room.timelineReset"]),this._filteredTimelineSets[e.filterId]=r,this._timelineSets.push(r);const n=this.getLiveTimeline();n.getEvents().forEach((function(e){r.addLiveEvent(e)}));let i=n;for(;i.getNeighbouringTimeline(o.EventTimeline.BACKWARDS);)i=i.getNeighbouringTimeline(o.EventTimeline.BACKWARDS);return r.getLiveTimeline().setPaginationToken(i.getPaginationToken(o.EventTimeline.BACKWARDS),o.EventTimeline.BACKWARDS),r},y.prototype.removeFilteredTimelineSet=function(e){const t=this._filteredTimelineSets[e.filterId];delete this._filteredTimelineSets[e.filterId];const r=this._timelineSets.indexOf(t);r>-1&&this._timelineSets.splice(r,1)},y.prototype._addLiveEvent=function(e,t,r){if(e.isRedaction()){const t=e.event.redacts,r=this.getUnfilteredTimelineSet().findEventById(t);r&&(r.makeRedacted(e),r.getStateKey()&&this.currentState.getStateEvents(r.getType(),r.getStateKey()).getId()===r.getId()&&this.currentState.setStateEvents([r]),this.emit("Room.redaction",e,this))}if(e.getUnsigned().transaction_id){const t=this._txnToEvent[e.getUnsigned().transaction_id];if(t)return void this._handleRemoteEcho(e,t)}for(let n=0;n<this._timelineSets.length;n++)this._timelineSets[n].addLiveEvent(e,t,r);e.sender&&"m.room.redaction"!==e.getType()&&this.addReceipt(m(e.sender.userId,e,"m.read"),!0)},y.prototype.addPendingEvent=function(e,t){if(e.status!==l.EventStatus.SENDING)throw new Error("addPendingEvent called on an event with status "+e.status);if(this._txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(o.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(o.EventTimeline.FORWARDS),!1),this._txnToEvent[t]=e,"detached"==this._opts.pendingEventOrdering){if(this._pendingEventList.some((e=>e.status===l.EventStatus.NOT_SENT))&&(d.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(l.EventStatus.NOT_SENT)),this._pendingEventList.push(e),e.isRelation()&&this._aggregateNonLiveRelation(e),e.isRedaction()){const t=e.event.redacts;let r=this._pendingEventList&&this._pendingEventList.find((e=>e.getId()===t));r||(r=this.getUnfilteredTimelineSet().findEventById(t)),r&&(r.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}}else for(let t=0;t<this._timelineSets.length;t++){const r=this._timelineSets[t];r.getFilter()?r.getFilter().filterRoomTimeline([e]).length&&r.addEventToTimeline(e,r.getLiveTimeline(),!1):r.addEventToTimeline(e,r.getLiveTimeline(),!1)}this.emit("Room.localEchoUpdated",e,this,null,null)},y.prototype._aggregateNonLiveRelation=function(e){for(let t=0;t<this._timelineSets.length;t++){const r=this._timelineSets[t];r.getFilter()?r.getFilter().filterRoomTimeline([e]).length&&r.aggregateRelations(e):r.aggregateRelations(e)}},y.prototype._handleRemoteEcho=function(e,t){const r=t.getId(),n=e.getId(),i=t.status;d.logger.debug(`Got remote echo for event ${r} -> ${n} old status ${i}`),delete this._txnToEvent[e.getUnsigned().transaction_id],this._pendingEventList&&c.removeElement(this._pendingEventList,(function(e){return e.getId()==r}),!1),t.handleRemoteEcho(e.event);for(let e=0;e<this._timelineSets.length;e++)this._timelineSets[e].handleRemoteEcho(t,r,n);this.emit("Room.localEchoUpdated",t,this,r,i)};const v={};function _(e,t,r){if(!r){const t=e.currentState.getStateEvents("m.room.name","");if(t&&t.getContent()&&t.getContent().name)return t.getContent().name}let n=e.getCanonicalAlias();if(!n){const t=e.getAltAliases();t.length&&(n=t[0])}if(n)return n;const i=e.currentState.getJoinedMemberCount()+e.currentState.getInvitedMemberCount()-1;let s=null;if(e._summaryHeroes)s=e._summaryHeroes.map((t=>{const r=e.getMember(t);return r?r.name:t}));else{let r=e.currentState.getMembers().filter((e=>e.userId!==t&&("invite"===e.membership||"join"===e.membership)));r.sort(((e,t)=>e.userId.localeCompare(t.userId))),r=r.slice(0,5),s=r.map((e=>e.name))}if(i)return b(s,i);if("join"==e.getMyMembership()){const t=e.currentState.getStateEvents("m.room.third_party_invite");if(t&&t.length)return`Inviting ${b(t.map((e=>e.getContent().display_name)))}`}let o=s;return o.length||(o=e.currentState.getMembers().filter((e=>e.userId!==t&&"invite"!==e.membership&&"join"!==e.membership)).map((e=>e.name))),o.length?`Empty room (was ${b(o)})`:"Empty room"}function b(e,t=e.length+1){const r=t-1;return e.length?1===e.length&&r<=1?e[0]:2===e.length&&r<=2?`${e[0]} and ${e[1]}`:r>1?`${e[0]} and ${r} others`:`${e[0]} and 1 other`:"Empty room"}v[l.EventStatus.ENCRYPTING]=[l.EventStatus.SENDING,l.EventStatus.NOT_SENT],v[l.EventStatus.SENDING]=[l.EventStatus.ENCRYPTING,l.EventStatus.QUEUED,l.EventStatus.NOT_SENT,l.EventStatus.SENT],v[l.EventStatus.QUEUED]=[l.EventStatus.SENDING,l.EventStatus.CANCELLED],v[l.EventStatus.SENT]=[],v[l.EventStatus.NOT_SENT]=[l.EventStatus.SENDING,l.EventStatus.QUEUED,l.EventStatus.CANCELLED],v[l.EventStatus.CANCELLED]=[],y.prototype.updatePendingEvent=function(e,t,r){if(d.logger.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${r}`),t==l.EventStatus.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==l.EventStatus.SENT&&this.getUnfilteredTimelineSet().eventIdToTimeline(r))return;const n=e.status,i=e.getId();if(!n)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const s=v[n];if(!s||s.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+n+"->"+t);if(e.setStatus(t),t==l.EventStatus.SENT){e.replaceLocalEventId(r);for(let e=0;e<this._timelineSets.length;e++)this._timelineSets[e].replaceEventId(i,r)}else if(t==l.EventStatus.CANCELLED){if(this._pendingEventList){const e=this._pendingEventList.findIndex((e=>e.getId()===i));if(-1!==e){const[t]=this._pendingEventList.splice(e,1);t.isRedaction()&&this._revertRedactionLocalEcho(t)}}this.removeEvent(i)}this.emit("Room.localEchoUpdated",e,this,i,n)},y.prototype._revertRedactionLocalEcho=function(e){const t=e.event.redacts;if(!t)return;const r=this.getUnfilteredTimelineSet().findEventById(t);r&&(r.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),r.isRelation()&&this._aggregateNonLiveRelation(r))},y.prototype.addLiveEvents=function(e,t,r){let n;if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(n=0;n<this._timelineSets.length;n++){const e=this._timelineSets[n].getLiveTimeline();if(e.getPaginationToken(o.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a pagination token ("+e.getPaginationToken(o.EventTimeline.FORWARDS)+")");if(e.getNeighbouringTimeline(o.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a neighbouring timeline")}for(n=0;n<e.length;n++)this._addLiveEvent(e[n],t,r)},y.prototype.addEphemeralEvents=function(e){for(const t of e)"m.typing"===t.getType()?this.currentState.setTypingEvent(t):"m.receipt"===t.getType()&&this.addReceipt(t)},y.prototype.removeEvents=function(e){for(let t=0;t<e.length;++t)this.removeEvent(e[t])},y.prototype.removeEvent=function(e){let t=!1;for(let r=0;r<this._timelineSets.length;r++){const n=this._timelineSets[r].removeEvent(e);n&&(n.isRedaction()&&this._revertRedactionLocalEcho(n),t=!0)}return t},y.prototype.recalculate=function(){const e=this,t=this.currentState.getStateEvents("m.room.member",this.myUserId);if(t&&"invite"===t.getContent().membership){const r=t.event.invite_room_state||[];c.forEach(r,(function(t){e.currentState.getStateEvents(t.type,t.state_key)||e.currentState.setStateEvents([new l.MatrixEvent({type:t.type,state_key:t.state_key,content:t.content,event_id:"$fake"+Date.now(),room_id:e.roomId,user_id:e.myUserId})])}))}const r=this.name;this.name=_(this,this.myUserId),this.summary=new h.RoomSummary(this.roomId,{title:this.name}),r!==this.name&&this.emit("Room.name",this)},y.prototype.getUsersReadUpTo=function(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))},y.prototype.getEventReadUpTo=function(e,t){let r=this._receipts;return t&&(r=this._realReceipts),void 0===r["m.read"]||void 0===r["m.read"][e]?null:r["m.read"][e].eventId},y.prototype.hasUserReadEvent=function(e,t){const r=this.getEventReadUpTo(e,!1);if(r===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let e=this.timeline.length-1;e>=0;--e){const n=this.timeline[e];if(n.getId()===t)return!1;if(n.getId()===r)return!0}return!1},y.prototype.getReceiptsForEvent=function(e){return this._receiptCacheByEventId[e.getId()]||[]},y.prototype.addReceipt=function(e,t){void 0===t&&(t=!1),t||this._addReceiptsToStructure(e,this._realReceipts),this._addReceiptsToStructure(e,this._receipts),this._receiptCacheByEventId=this._buildReceiptCache(this._receipts),this.emit("Room.receipt",e,this)},y.prototype._addReceiptsToStructure=function(e,t){const r=this;c.keys(e.getContent()).forEach((function(n){c.keys(e.getContent()[n]).forEach((function(i){c.keys(e.getContent()[n][i]).forEach((function(s){const o=e.getContent()[n][i][s];t[i]||(t[i]={});const a=t[i][s];if(a){const e=r.getUnfilteredTimelineSet().compareEventOrdering(a.eventId,n);if(null!==e&&e>=0)return}else t[i][s]={};t[i][s]={eventId:n,data:o}}))}))}))},y.prototype._buildReceiptCache=function(e){const t={};return c.keys(e).forEach((function(r){c.keys(e[r]).forEach((function(n){const i=e[r][n];t[i.eventId]||(t[i.eventId]=[]),t[i.eventId].push({userId:n,type:r,data:i.data})}))})),t},y.prototype._addLocalEchoReceipt=function(e,t,r){this.addReceipt(m(e,t,r),!0)},y.prototype.addTags=function(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)},y.prototype.addAccountData=function(e){for(let t=0;t<e.length;t++){const r=e[t];"m.tag"===r.getType()&&this.addTags(r);const n=this.accountData[r.getType()];this.accountData[r.getType()]=r,this.emit("Room.accountData",r,this,n)}},y.prototype.getAccountData=function(e){return this.accountData[e]},y.prototype.maySendMessage=function(){return"join"===this.getMyMembership()&&this.currentState.maySendEvent("m.room.message",this.myUserId)},y.prototype.canInvite=function(e){let t="join"===this.getMyMembership();const r=this.currentState.getStateEvents(f.EventType.RoomPowerLevels,""),n=r&&r.getContent(),i=this.getMember(e);return n&&i&&n.invite>i.powerLevel&&(t=!1),t},y.prototype.getJoinRule=function(){return this.currentState.getJoinRule()},y.prototype.getType=function(){const e=this.currentState.getStateEvents("m.room.create","");if(e)return e.getContent()[f.RoomCreateTypeField];d.logger.warn("Room "+this.roomId+" does not have an m.room.create event")},y.prototype.isSpaceRoom=function(){return this.getType()===f.RoomType.Space}},1398:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=o;var i=n(r(3102)),s=r(3558);function o(e,t){this.rank=e,this.context=t}o.fromJson=function(e,t){const r=e.context||{},n=r.events_before||[],a=r.events_after||[],c=new s.EventContext(t(e.result));return c.setPaginateToken(r.start,!0),c.addEvents(i.map(n,t),!0),c.addEvents(i.map(a,t),!1),c.setPaginateToken(r.end,!1),new o(e.rank,c)}},3998:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.User=o;var i=n(r(3102)),s=r(7187);function o(e){this.userId=e,this.presence="offline",this.presenceStatusMsg=null,this._unstable_statusMessage="",this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={presence:null,profile:null},this._updateModifiedTime()}i.inherits(o,s.EventEmitter),o.prototype.setPresenceEvent=function(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const r=[];(e.getContent().presence!==this.presence||t)&&r.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&r.push("User.currentlyActive"),this.presence=e.getContent().presence,r.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this._updateModifiedTime();for(let t=0;t<r.length;t++)this.emit(r[t],e,this)},o.prototype.setDisplayName=function(e){const t=this.displayName;this.displayName="string"==typeof e?e:void 0,e!==t&&this._updateModifiedTime()},o.prototype.setRawDisplayName=function(e){this.rawDisplayName="string"==typeof e?e:void 0},o.prototype.setAvatarUrl=function(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this._updateModifiedTime()},o.prototype._updateModifiedTime=function(){this._modified=Date.now()},o.prototype.getLastModifiedTime=function(){return this._modified},o.prototype.getLastActiveTs=function(){return this.lastPresenceTs-this.lastActiveAgo},o.prototype._unstable_updateStatusMessage=function(e){e.getContent()?this._unstable_statusMessage=e.getContent().status:this._unstable_statusMessage="",this._updateModifiedTime(),this.emit("User._unstable_statusMessage",this)}},1707:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=a;var n=r(3102),i=r(7434);const s=["override","content","room","sender","underride"],o=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.room.tombstone"},{kind:"event_match",key:"state_key",pattern:""}],actions:["notify",{set_tweak:"highlight",value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.reaction"}],actions:["dont_notify"]}];function a(e){const t={},r=(e,t)=>{for(let r=0;r<s.length;++r){const n=s[r],o=t[n];if(o)for(let t=0;t<o.length;++t){const r=o[t];if(!r.enabled)continue;const s=i(n,r);if(s&&this.ruleMatchesEvent(s,e))return r.kind=n,r}}return null},i=function(e,t){const r={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case"underride":case"override":r.conditions=t.conditions;break;case"room":if(!t.rule_id)return null;r.conditions.push({kind:"event_match",key:"room_id",value:t.rule_id});break;case"sender":if(!t.rule_id)return null;r.conditions.push({kind:"event_match",key:"user_id",value:t.rule_id});break;case"content":if(!t.pattern)return null;r.conditions.push({kind:"event_match",key:"content.body",pattern:t.pattern})}return r},o=function(e,t){const r={event_match:h,contains_display_name:u,room_member_count:l,sender_notification_permission:c};return!!r[e.kind]&&r[e.kind](e,t)},c=function(t,r){const n=t.key;if(!n)return!1;const i=e.getRoom(r.getRoomId());return!(!i||!i.currentState)&&i.currentState.mayTriggerNotifOfType(n,r.getSender())},l=function(t,r){if(!t.is)return!1;const n=e.getRoom(r.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;const i=n.currentState.getJoinedMemberCount(),s=t.is.match(/^([=<>]*)([0-9]*)$/);if(!s)return!1;const o=s[1],a=parseInt(s[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return i==a;case"<":return i<a;case">":return i>a;case"<=":return i<=a;case">=":return i>=a;default:return!1}},u=function(t,r){let i=r.getContent();if(r.isEncrypted()&&r.getClearContent()&&(i=r.getClearContent()),!i||!i.body||"string"!=typeof i.body)return!1;const s=e.getRoom(r.getRoomId());if(!(s&&s.currentState&&s.currentState.members&&s.currentState.getMember(e.credentials.userId)))return!1;const o=s.currentState.getMember(e.credentials.userId).name,a=new RegExp("(^|\\W)"+(0,n.escapeRegExp)(o)+"(\\W|$)","i");return i.body.search(a)>-1},h=function(e,t){if(!e.key)return!1;const r=p(e.key,t);if("string"!=typeof r)return!1;if(e.value)return e.value===r;let n;return n="content.body"==e.key?d("(^|\\W)",e.pattern,"(\\W|$)"):d("^",e.pattern,"$"),!!r.match(n)},d=function(e,r,i){return t[r]||(t[r]=new RegExp(e+(0,n.globToRegexp)(r)+i,"i")),t[r]},p=function(e,t){const r=e.split(".");let i;const s=r[0];for("content"===s?(i=t.getContent(),r.shift()):"type"===s?(i=t.getType(),r.shift()):i=t.event;r.length>0;){const e=r.shift();if((0,n.isNullOrUndefined)(i[e]))return null;i=i[e]}return i};this.ruleMatchesEvent=function(e,t){let r=!0;for(let n=0;n<e.conditions.length;++n){const i=e.conditions[n];r&=o(i,t)}return r},this.actionsForEvent=function(t){return function(t,n){const i=function(t,n){return n?t.getSender()===e.credentials.userId?null:r(t,n.global):null}(t,n);if(!i)return{};const s=a.actionListToActionsObject(i.actions);return void 0===s.tweaks.highlight&&(s.tweaks.highlight="content"==i.kind),s}(t,e.pushRules)},this.getPushRuleById=function(t){for(const r of["global"])if(void 0!==e.pushRules[r])for(const n of s)if(void 0!==e.pushRules[r][n])for(const i of e.pushRules[r][n])if(i.rule_id===t)return i;return null}}a.actionListToActionsObject=function(e){const t={notify:!1,tweaks:{}};for(let r=0;r<e.length;++r){const n=e[r];"notify"===n?t.notify=!0:"object"==typeof n&&(void 0===n.value&&(n.value=!0),t.tweaks[n.set_tweak]=n.value)}return t},a.rewriteDefaultRules=function(e){let t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);const r=t.global.override;for(const e of o){const t=r.find((t=>t.rule_id===e.rule_id));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{const t=e.rule_id;i.logger.warn(`Adding default global override for ${t}`),r.push(e)}}return t}},8401:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(e){return i(e,n+r+"0123456789")},t.randomLowercaseString=function(e){return i(e,r)},t.randomUppercaseString=function(e){return i(e,n)};const r="abcdefghijklmnopqrstuvwxyz",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function i(e,t){let r="";for(let n=0;n<e;++n)r+=t.charAt(Math.floor(Math.random()*t.length));return r}},2731:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setNow=function(e){a=e||Date.now},t.setTimeout=function(e,t){(t=t||0)<0&&(t=0);const r=Array.prototype.slice.call(arguments,2),n=a()+t,i=s++,l={runAt:n,func:e,params:r,key:i},h=u(o,(function(e){return e.runAt-n}));return o.splice(h,0,l),c(),i},t.clearTimeout=function(e){if(0===o.length)return;let t;for(t=0;t<o.length;t++)if(o[t].key==e){o.splice(t,1);break}0===t&&c()};var n=r(7434);let i,s=0;const o=[];let a=Date.now;function c(){i&&r.g.clearTimeout(i);const e=o[0];if(!e)return;const t=a(),n=Math.min(e.runAt-t,1e3);i=r.g.setTimeout(l,n)}function l(){let e;const t=a(),i=[];for(;;){const r=o[0];if(!r||r.runAt>t)break;e=o.shift(),e.key,i.push(e)}c();for(let t=0;t<i.length;t++){e=i[t];try{e.func.apply(r.g,e.params)}catch(e){n.logger.error("Uncaught exception in callback function",e.stack||e)}}}function u(e,t){let r=0,n=e.length;for(;r<n;){const i=r+n>>1;t(e[i])>0?n=i:r=i+1}return r}},9443:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=s;var i=n(r(3102));function s(e,t){this.retryAlgorithm=e||s.RETRY_BACKOFF_RATELIMIT,this.queueAlgorithm=t||s.QUEUE_MESSAGES,this._queues={},this._activeQueues=[],this._procFn=null}function o(e){e._procFn&&i.forEach(i.filter(i.keys(e._queues),(function(t){return-1===e._activeQueues.indexOf(t)&&e._queues[t].length>0})),(function(t){e._activeQueues.push(t),l(),a(e,t)}))}function a(e,t){const r=function(e,t){const r=e._queues[t];return i.isArray(r)?r[0]:null}(e,t);if(!r){const r=e._activeQueues.indexOf(t);return r>=0&&e._activeQueues.splice(r,1),void l()}l(e._queues[t].length),Promise.resolve().then((()=>e._procFn(r.event))).then((function(n){c(e,t),l(r.event.getId()),r.defer.resolve(n),a(e,t)}),(function(n){r.attempts+=1;const i=e.retryAlgorithm(r.event,r.attempts,n);l(r.attempts,r.event.getId()),-1===i?(l(r.event.getId()),c(e,t),r.defer.reject(n),a(e,t)):setTimeout((function(){a(e,t)}),i)}))}function c(e,t){const r=e._queues[t];return i.isArray(r)?r.shift():null}function l(){}r(7434),s.prototype.getQueueForEvent=function(e){const t=this.queueAlgorithm(e);return t&&this._queues[t]?i.map(this._queues[t],(function(e){return e.event})):null},s.prototype.removeEventFromQueue=function(e){const t=this.queueAlgorithm(e);if(!t||!this._queues[t])return!1;let r=!1;return i.removeElement(this._queues[t],(function(t){if(t.event.getId()===e.getId())return r=!0,!0})),r},s.prototype.setProcessFunction=function(e){this._procFn=e,o(this)},s.prototype.queueEvent=function(e){const t=this.queueAlgorithm(e);if(!t)return null;this._queues[t]||(this._queues[t]=[]);const r=i.defer();return this._queues[t].push({event:e,defer:r,attempts:0}),e.getId(),o(this),r.promise},s.RETRY_BACKOFF_RATELIMIT=function(e,t,r){if(400===r.httpStatus||403===r.httpStatus||401===r.httpStatus)return-1;if("rejected"===r.cors)return-1;if("M_TOO_LARGE"===r.name)return-1;if("M_LIMIT_EXCEEDED"===r.name){const e=r.data.retry_after_ms;if(e>0)return e}return t>4?-1:1e3*Math.pow(2,t)},s.QUEUE_MESSAGES=function(e){return"m.room.message"===e.getType()||e.hasAssocation()?"message":null}},1415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0;const r=Object.freeze({IS:"SERVICE_TYPE_IS",IM:"SERVICE_TYPE_IM"});t.SERVICE_TYPES=r},3861:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=d;var i=r(2741),s=n(r(3102)),o=n(r(3415)),a=r(7434);function c(e,t,r){const n=e.openCursor(t);return new Promise(((e,t)=>{const i=[];n.onerror=e=>{t(new Error("Query failed: "+e.target.errorCode))},n.onsuccess=t=>{const n=t.target.result;n?(i.push(r(n)),n.continue()):e(i)}}))}function l(e){return new Promise(((t,r)=>{e.oncomplete=function(e){t(e)},e.onerror=function(e){r(e.target.error)}}))}function u(e){return new Promise(((t,r)=>{e.onsuccess=function(e){t(e)},e.onerror=function(e){r(e.target.error)}}))}function h(e){return u(e).then((e=>e.target.result))}function d(e,t){this.indexedDB=e,this._dbName="matrix-js-sdk:"+(t||"default"),this.db=null,this._disconnected=!0,this._syncAccumulator=new i.SyncAccumulator,this._isNewlyCreated=!1}d.exists=function(e,t){return t="matrix-js-sdk:"+(t||"default"),o.exists(e,t)},d.prototype={connect:function(){if(!this._disconnected)return a.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this._disconnected=!1,a.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this._dbName,3);return e.onupgradeneeded=e=>{const t=e.target.result,r=e.oldVersion;a.logger.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${r}`),r<1&&(this._isNewlyCreated=!0,function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}(t)),r<2&&function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")}(t),r<3&&function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}(t)},e.onblocked=()=>{a.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},a.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),u(e).then((e=>(a.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.target.result,this.db.onversionchange=()=>{this.db.close()},this._init())))},isNewlyCreated:function(){return Promise.resolve(this._isNewlyCreated)},_init:function(){return Promise.all([this._loadAccountData(),this._loadSyncData()]).then((([e,t])=>{a.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this._syncAccumulator.accumulate({next_batch:t.nextBatch,rooms:t.roomsData,groups:t.groupsData,account_data:{events:e}},!0)}))},getOutOfBandMembers:function(e){return new Promise(((t,r)=>{const n=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),i=IDBKeyRange.only(e),s=n.openCursor(i),o=[];let a=!1;s.onsuccess=e=>{const r=e.target.result;if(!r)return o.length||a?t(o):t(null);const n=r.value;n.oob_written?a=!0:o.push(n),r.continue()},s.onerror=e=>{r(e)}})).then((t=>(a.logger.log(`LL: got ${t&&t.length} membershipEvents from storage for room ${e} ...`),t)))},setOutOfBandMembers:async function(e,t){a.logger.log(`LL: backend about to store ${t.length} members for ${e}`);const r=this.db.transaction(["oob_membership_events"],"readwrite"),n=r.objectStore("oob_membership_events");t.forEach((e=>{n.put(e)}));const i={room_id:e,oob_written:!0,state_key:0};n.put(i),await l(r),a.logger.log(`LL: backend done storing for ${e}!`)},clearOutOfBandMembers:async function(e){const t=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),r=IDBKeyRange.only(e),n=h(t.openKeyCursor(r,"next")).then((e=>e&&e.primaryKey[1])),i=h(t.openKeyCursor(r,"prev")).then((e=>e&&e.primaryKey[1])),[s,o]=await Promise.all([n,i]),c=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),l=IDBKeyRange.bound([e,s],[e,o]);var u;a.logger.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,s],[e,o]),await(u=c.delete(l),new Promise(((e,t)=>{u.onsuccess=()=>e(u),u.onerror=e=>t(e)})))},clearDatabase:function(){return new Promise(((e,t)=>{a.logger.log(`Removing indexeddb instance: ${this._dbName}`);const r=this.indexedDB.deleteDatabase(this._dbName);r.onblocked=()=>{a.logger.log(`can't yet delete indexeddb ${this._dbName} because it is open elsewhere`)},r.onerror=t=>{a.logger.warn(`unable to delete js-sdk store indexeddb: ${t.target.error}`),e()},r.onsuccess=()=>{a.logger.log(`Removed indexeddb instance: ${this._dbName}`),e()}}))},getSavedSync:function(e){void 0===e&&(e=!0);const t=this._syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(s.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)},getNextBatchToken:function(){return Promise.resolve(this._syncAccumulator.getNextBatchToken())},setSyncData:function(e){return Promise.resolve().then((()=>{this._syncAccumulator.accumulate(e)}))},syncToDatabase:function(e){const t=this._syncAccumulator.getJSON(!0);return Promise.all([this._persistUserPresenceEvents(e),this._persistAccountData(t.accountData),this._persistSyncData(t.nextBatch,t.roomsData,t.groupsData)])},_persistSyncData:function(e,t,r){return a.logger.log("Persisting sync data up to",e),s.promiseTry((()=>{const n=this.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t,groupsData:r}),l(n)}))},_persistAccountData:function(e){return s.promiseTry((()=>{const t=this.db.transaction(["accountData"],"readwrite"),r=t.objectStore("accountData");for(let t=0;t<e.length;t++)r.put(e[t]);return l(t)}))},_persistUserPresenceEvents:function(e){return s.promiseTry((()=>{const t=this.db.transaction(["users"],"readwrite"),r=t.objectStore("users");for(const t of e)r.put({userId:t[0],event:t[1]});return l(t)}))},getUserPresenceEvents:function(){return s.promiseTry((()=>c(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,(e=>[e.value.userId,e.value.event]))))},_loadAccountData:function(){return a.logger.log("LocalIndexedDBStoreBackend: loading account data..."),s.promiseTry((()=>c(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(e=>e.value)).then((e=>(a.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e)))))},_loadSyncData:function(){return a.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),s.promiseTry((()=>c(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(e=>e.value)).then((e=>(a.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&a.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))))},getClientOptions:function(){return Promise.resolve().then((()=>c(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(e=>{if(e.value&&e.value&&e.value.options)return e.value.options})).then((e=>e[0]))))},storeClientOptions:async function(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await l(t)}}},4215:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=s;var n=r(7434),i=r(3102);function s(e,t,r){this._workerScript=e,this._dbName=t,this._workerApi=r,this._worker=null,this._nextSeq=0,this._inFlight={},this._startPromise=null}s.prototype={connect:function(){return this._ensureStarted().then((()=>this._doCmd("connect")))},clearDatabase:function(){return this._ensureStarted().then((()=>this._doCmd("clearDatabase")))},isNewlyCreated:function(){return this._doCmd("isNewlyCreated")},getSavedSync:function(){return this._doCmd("getSavedSync")},getNextBatchToken:function(){return this._doCmd("getNextBatchToken")},setSyncData:function(e){return this._doCmd("setSyncData",[e])},syncToDatabase:function(e){return this._doCmd("syncToDatabase",[e])},getOutOfBandMembers:function(e){return this._doCmd("getOutOfBandMembers",[e])},setOutOfBandMembers:function(e,t){return this._doCmd("setOutOfBandMembers",[e,t])},clearOutOfBandMembers:function(e){return this._doCmd("clearOutOfBandMembers",[e])},getClientOptions:function(){return this._doCmd("getClientOptions")},storeClientOptions:function(e){return this._doCmd("storeClientOptions",[e])},getUserPresenceEvents:function(){return this._doCmd("getUserPresenceEvents")},_ensureStarted:function(){return null===this._startPromise&&(this._worker=new this._workerApi(this._workerScript),this._worker.onmessage=this._onWorkerMessage.bind(this),this._startPromise=this._doCmd("_setupWorker",[this._dbName]).then((()=>{n.logger.log("IndexedDB worker is ready")}))),this._startPromise},_doCmd:function(e,t){return Promise.resolve().then((()=>{const r=this._nextSeq++,n=(0,i.defer)();return this._inFlight[r]=n,this._worker.postMessage({command:e,seq:r,args:t}),n.promise}))},_onWorkerMessage:function(e){const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void n.logger.error("Got reply from worker with no seq");const e=this._inFlight[t.seq];if(void 0===e)return void n.logger.error("Got reply for unknown seq "+t.seq);if(delete this._inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const r=new Error(t.error.message);r.name=t.error.name,e.reject(r)}}else n.logger.warn("Unrecognised message from worker: "+t)}}},9789:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStore=d;var i=r(1703),s=n(r(3102)),o=r(7187),a=r(3861),c=r(4215),l=r(3998),u=r(4369),h=r(7434);function d(e){if(i.MemoryStore.call(this,e),!e.indexedDB)throw new Error("Missing required option: indexedDB");if(e.workerScript){let t=e.workerApi;t||(t=r.g.Worker),this.backend=new c.RemoteIndexedDBStoreBackend(e.workerScript,e.dbName,t)}else this.backend=new a.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName);this.startedUp=!1,this._syncTs=0,this._userModifiedMap={}}function p(e,t){return async function(...r){try{return await e.call(this,...r)}catch(e){h.logger.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emit("degraded",e);try{h.logger.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),h.logger.log("IndexedDBStore delete after degrading succeeeded")}catch(e){h.logger.warn("IndexedDBStore delete after degrading failed",e)}if(Object.setPrototypeOf(this,i.MemoryStore.prototype),t)return await i.MemoryStore.prototype[t].call(this,...r)}}}s.inherits(d,i.MemoryStore),s.extend(d.prototype,o.EventEmitter.prototype),d.exists=function(e,t){return a.LocalIndexedDBStoreBackend.exists(e,t)},d.prototype.startup=function(){return this.startedUp?(h.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(h.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((()=>(h.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents()))).then((e=>{h.logger.log("IndexedDBStore.startup: processing presence events"),e.forEach((([e,t])=>{const r=new l.User(e);t&&r.setPresenceEvent(new u.MatrixEvent(t)),this._userModifiedMap[r.userId]=r.getLastModifiedTime(),this.storeUser(r)}))})))},d.prototype.getSavedSync=p((function(){return this.backend.getSavedSync()}),"getSavedSync"),d.prototype.isNewlyCreated=p((function(){return this.backend.isNewlyCreated()}),"isNewlyCreated"),d.prototype.getSavedSyncToken=p((function(){return this.backend.getNextBatchToken()}),"getSavedSyncToken"),d.prototype.deleteAllData=p((function(){return i.MemoryStore.prototype.deleteAllData.call(this),this.backend.clearDatabase().then((()=>{h.logger.log("Deleted indexeddb data.")}),(e=>{throw h.logger.error(`Failed to delete indexeddb data: ${e}`),e}))})),d.prototype.wantsSave=function(){return Date.now()-this._syncTs>3e5},d.prototype.save=function(e){return e||this.wantsSave()?this._reallySave():Promise.resolve()},d.prototype._reallySave=p((function(){this._syncTs=Date.now();const e=[];for(const t of this.getUsers())this._userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this._userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)})),d.prototype.setSyncData=p((function(e){return this.backend.setSyncData(e)}),"setSyncData"),d.prototype.getOutOfBandMembers=p((function(e){return this.backend.getOutOfBandMembers(e)}),"getOutOfBandMembers"),d.prototype.setOutOfBandMembers=p((function(e,t){return i.MemoryStore.prototype.setOutOfBandMembers.call(this,e,t),this.backend.setOutOfBandMembers(e,t)}),"setOutOfBandMembers"),d.prototype.clearOutOfBandMembers=p((function(e){return i.MemoryStore.prototype.clearOutOfBandMembers.call(this),this.backend.clearOutOfBandMembers(e)}),"clearOutOfBandMembers"),d.prototype.getClientOptions=p((function(){return this.backend.getClientOptions()}),"getClientOptions"),d.prototype.storeClientOptions=p((function(e){return i.MemoryStore.prototype.storeClientOptions.call(this,e),this.backend.storeClientOptions(e)}),"storeClientOptions")},1703:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStore=a;var i=r(3998),s=n(r(3102));function o(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}function a(e){e=e||{},this.rooms={},this.groups={},this.users={},this.syncToken=null,this.filters={},this.accountData={},this.localStorage=e.localStorage,this._oobMembers={},this._clientOptions={}}a.prototype={getSyncToken:function(){return this.syncToken},isNewlyCreated:function(){return Promise.resolve(!0)},setSyncToken:function(e){this.syncToken=e},storeGroup:function(e){this.groups[e.groupId]=e},getGroup:function(e){return this.groups[e]||null},getGroups:function(){return s.values(this.groups)},storeRoom:function(e){this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this._onRoomMember.bind(this));const t=this;e.currentState.getMembers().forEach((function(r){t._onRoomMember(null,e.currentState,r)}))},_onRoomMember:function(e,t,r){if("invite"===r.membership)return;const n=this.users[r.userId]||new i.User(r.userId);r.name&&(n.setDisplayName(r.name),r.events.member&&n.setRawDisplayName(r.events.member.getDirectionalContent().displayname)),r.events.member&&r.events.member.getContent().avatar_url&&n.setAvatarUrl(r.events.member.getContent().avatar_url),this.users[n.userId]=n},getRoom:function(e){return this.rooms[e]||null},getRooms:function(){return s.values(this.rooms)},removeRoom:function(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this._onRoomMember),delete this.rooms[e]},getRoomSummaries:function(){return s.map(s.values(this.rooms),(function(e){return e.summary}))},storeUser:function(e){this.users[e.userId]=e},getUser:function(e){return this.users[e]||null},getUsers:function(){return s.values(this.users)},scrollback:function(e,t){return[]},storeEvents:function(e,t,r,n){},storeFilter:function(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)},getFilter:function(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null},getFilterIdByName:function(e){if(!this.localStorage)return null;const t="mxjssdk_memory_filter_"+e;try{const e=this.localStorage.getItem(t);if(o(e))return e}catch(e){}return null},setFilterIdByName:function(e,t){if(!this.localStorage)return;const r="mxjssdk_memory_filter_"+e;try{o(t)?this.localStorage.setItem(r,t):this.localStorage.removeItem(r)}catch(e){}},storeAccountDataEvents:function(e){const t=this;e.forEach((function(e){t.accountData[e.getType()]=e}))},getAccountData:function(e){return this.accountData[e]},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(e){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()},getOutOfBandMembers:function(e){return Promise.resolve(this._oobMembers[e]||null)},setOutOfBandMembers:function(e,t){return this._oobMembers[e]=t,Promise.resolve()},clearOutOfBandMembers:function(){return this._oobMembers={},Promise.resolve()},getClientOptions:function(){return Promise.resolve(this._clientOptions)},storeClientOptions:function(e){return this._clientOptions=Object.assign({},e),Promise.resolve()}}},5837:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.WebStorageSessionStore=o;var i=n(r(3102));r(7434);const s="session.e2e.";function o(e){if(this.store=e,!(i.isFunction(e.getItem)&&i.isFunction(e.setItem)&&i.isFunction(e.removeItem)&&i.isFunction(e.key)&&"number"==typeof e.length))throw new Error("Supplied webStore does not meet the WebStorage API interface")}o.prototype={removeEndToEndAccount:function(){this.store.removeItem(a)},getEndToEndAccount:function(){return this.store.getItem(a)},getAllEndToEndDevices:function(){const e=h(""),t={};for(let r=0;r<this.store.length;++r){const n=this.store.key(r),i=n.substr(e.length);n.startsWith(e)&&(t[i]=f(this.store,n))}return t},getEndToEndDeviceTrackingStatus:function(){return f(this.store,l)},getEndToEndDeviceSyncToken:function(){return f(this.store,c)},removeEndToEndDeviceData:function(){m(this.store,h("")),m(this.store,l),m(this.store,c)},getEndToEndSessions:function(e){return f(this.store,d(e))},getAllEndToEndSessions:function(){const e=g(this.store,d("")),t={};for(const r of e)t[r.substr(d("").length)]=f(this.store,r);return t},removeAllEndToEndSessions:function(){m(this.store,d(""))},getAllEndToEndInboundGroupSessionKeys:function(){const e=s+"inboundgroupsessions/",t=[];for(let r=0;r<this.store.length;r++){const n=this.store.key(r);n.startsWith(e)&&t.push({senderKey:n.substr(e.length,43),sessionId:n.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){const r=function(e,t){return s+"inboundgroupsessions/"+e+"/"+t}(e,t);return this.store.getItem(r)},removeAllEndToEndInboundGroupSessions:function(){m(this.store,s+"inboundgroupsessions/")},getAllEndToEndRooms:function(){const e=g(this.store,p("")),t={};for(const r of e)t[r.substr(p("").length)]=f(this.store,r);return t},removeAllEndToEndRooms:function(){m(this.store,p(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(u,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(u)}};const a=s+"account",c=s+"device_sync_token",l=s+"device_tracking",u=s+"trusted_backup_pubkey";function h(e){return s+"devices/"+e}function d(e){return s+"sessions/"+e}function p(e){return s+"rooms/"+e}function f(e,t){try{return JSON.parse(e.getItem(t))}catch(e){y(),y(e.stack)}return null}function g(e,t){const r=[];for(let n=0;n<e.length;++n){const i=e.key(n);i.startsWith(t)&&r.push(i)}return r}function m(e,t){const r=[];for(let n=0;n<e.length;++n){const i=e.key(n);i.startsWith(t)&&r.push(i)}for(const t of r)e.removeItem(t)}function y(){}},5641:(e,t)=>{"use strict";function r(){this.fromToken=null}Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=r,r.prototype={isNewlyCreated:function(){return Promise.resolve(!0)},getSyncToken:function(){return this.fromToken},setSyncToken:function(e){this.fromToken=e},storeGroup:function(e){},getGroup:function(e){return null},getGroups:function(){return[]},storeRoom:function(e){},getRoom:function(e){return null},getRooms:function(){return[]},removeRoom:function(e){},getRoomSummaries:function(){return[]},storeUser:function(e){},getUser:function(e){return null},getUsers:function(){return[]},scrollback:function(e,t){return[]},storeEvents:function(e,t,r,n){},storeFilter:function(e){},getFilter:function(e,t){return null},getFilterIdByName:function(e){return null},setFilterIdByName:function(e,t){},storeAccountDataEvents:function(e){},getAccountData:function(e){},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return Promise.resolve()},getOutOfBandMembers:function(){return Promise.resolve(null)},setOutOfBandMembers:function(){return Promise.resolve()},clearOutOfBandMembers:function(){return Promise.resolve()},getClientOptions:function(){return Promise.resolve()},storeClientOptions:function(){return Promise.resolve()}}},2741:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=void 0;var n=r(7434),i=r(3102);function s(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.SyncAccumulator=class{constructor(e){(e=e||{}).maxTimelineEntries=e.maxTimelineEntries||50,this.opts=e,this.accountData={},this.inviteRooms={},this.joinRooms={},this.nextBatch=null,this.groups={invite:{},join:{},leave:{}}}accumulate(e,t){this._accumulateRooms(e,t),this._accumulateGroups(e),this._accumulateAccountData(e),this.nextBatch=e.next_batch}_accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach((e=>{this.accountData[e.type]=e}))}_accumulateRooms(e,t){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((r=>{this._accumulateRoom(r,"invite",e.rooms.invite[r],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((r=>{this._accumulateRoom(r,"join",e.rooms.join[r],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((r=>{this._accumulateRoom(r,"leave",e.rooms.leave[r],t)})))}_accumulateRoom(e,t,r,i){switch(t){case"invite":this._accumulateInviteState(e,r);break;case"join":this.inviteRooms[e]&&delete this.inviteRooms[e],this._accumulateJoinState(e,r,i);break;case"leave":this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:n.logger.error("Unknown cateogory: ",t)}}_accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const r=this.inviteRooms[e];t.invite_state.events.forEach((e=>{let t=!1;for(let n=0;n<r.invite_state.events.length;n++){const i=r.invite_state.events[n];i.type===e.type&&i.state_key==e.state_key&&(r.invite_state.events[n]=e,t=!0)}t||r.invite_state.events.push(e)}))}_accumulateJoinState(e,t,r){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});const n=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((e=>{n._accountData[e.type]=e})),t.unread_notifications&&(n._unreadNotifications=t.unread_notifications),t.summary){const e="m.heroes",r="m.invited_member_count",i="m.joined_member_count",s=n._summary,o=t.summary;s[e]=o[e]||s[e],s[i]=o[i]||s[i],s[r]=o[r]||s[r]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach((e=>{"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach((t=>{e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach((r=>{n._readReceipts[r]={data:e.content[t]["m.read"][r],eventId:t}}))}))})),t.timeline&&t.timeline.limited&&(n._timeline=[]),t.state&&t.state.events&&t.state.events.forEach((e=>{s(n._currentState,e)})),t.timeline&&t.timeline.events&&t.timeline.events.forEach(((e,i)=>{let o;if(s(n._currentState,e),r)o=e;else{o=Object.assign({},e),void 0!==o.unsigned&&(o.unsigned=Object.assign({},o.unsigned));const t=e.unsigned?e.unsigned.age:e.age;void 0!==t&&(o._localTs=Date.now()-t)}n._timeline.push({event:o,token:0===i?t.timeline.prev_batch:null})})),n._timeline.length>this.opts.maxTimelineEntries)for(let e=n._timeline.length-this.opts.maxTimelineEntries;e<n._timeline.length;e++)if(n._timeline[e].token){n._timeline=n._timeline.slice(e,n._timeline.length);break}}_accumulateGroups(e){e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach((t=>{this._accumulateGroup(t,"invite",e.groups.invite[t])})),e.groups.join&&Object.keys(e.groups.join).forEach((t=>{this._accumulateGroup(t,"join",e.groups.join[t])})),e.groups.leave&&Object.keys(e.groups.leave).forEach((t=>{this._accumulateGroup(t,"leave",e.groups.leave[t])})))}_accumulateGroup(e,t,r){for(const t of["invite","join","leave"])delete this.groups[t][e];this.groups[t][e]=r}getJSON(e){const t={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((e=>{t.invite[e]=this.inviteRooms[e]})),Object.keys(this.joinRooms).forEach((r=>{const n=this.joinRooms[r],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:n._unreadNotifications,summary:n._summary};Object.keys(n._accountData).forEach((e=>{o.account_data.events.push(n._accountData[e])}));const a={type:"m.receipt",room_id:r,content:{}};Object.keys(n._readReceipts).forEach((e=>{const t=n._readReceipts[e];a.content[t.eventId]||(a.content[t.eventId]={"m.read":{}}),a.content[t.eventId]["m.read"][e]=t.data})),Object.keys(a.content).length>0&&o.ephemeral.events.push(a),n._timeline.forEach((t=>{if(!o.timeline.prev_batch){if(!t.token)return;o.timeline.prev_batch=t.token}let r;!e&&t.event._localTs?(r=Object.assign({},t.event),void 0!==r.unsigned&&(r.unsigned=Object.assign({},r.unsigned)),delete r._localTs,r.unsigned=r.unsigned||{},r.unsigned.age=Date.now()-t.event._localTs):r=t.event,o.timeline.events.push(r)}));const c=Object.create(null);for(let e=o.timeline.events.length-1;e>=0;e--){const t=o.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const r=(0,i.deepCopy)(t);r.unsigned&&(r.unsigned.prev_content&&(r.content=r.unsigned.prev_content),r.unsigned.prev_sender&&(r.sender=r.unsigned.prev_sender)),s(c,r)}Object.keys(n._currentState).forEach((e=>{Object.keys(n._currentState[e]).forEach((t=>{let r=n._currentState[e][t];c[e]&&c[e][t]&&(r=c[e][t]),o.state.events.push(r)}))})),t.join[r]=o}));const r=[];return Object.keys(this.accountData).forEach((e=>{r.push(this.accountData[e])})),{nextBatch:this.nextBatch,roomsData:t,groupsData:this.groups,accountData:r}}getNextBatchToken(){return this.nextBatch}}},4551:(e,t,r)=>{"use strict";var n=r(862);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncApi=g;var i=r(3998),s=r(7366),o=r(142),a=n(r(3102)),c=r(7906),l=r(8910),u=r(1707),h=r(7434),d=r(9489);function p(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function f(...e){h.logger.log(...e)}function g(e,t){this.client=e,(t=t||{}).initialSyncLimit=void 0===t.initialSyncLimit?8:t.initialSyncLimit,t.resolveInvitesToProfiles=t.resolveInvitesToProfiles||!1,t.pollTimeout=t.pollTimeout||3e4,t.pendingEventOrdering=t.pendingEventOrdering||"chronological",t.canResetEntireTimeline||(t.canResetEntireTimeline=function(e){return!1}),this.opts=t,this._peekRoom=null,this._currentSyncRequest=null,this._syncState=null,this._syncStateData=null,this._catchingUp=!1,this._running=!1,this._keepAliveTimer=null,this._connectionReturnedDefer=null,this._notifEvents=[],this._failedSyncCount=0,this._storeIsInvalid=!1,e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}function m(e,t){const r=new i.User(t);return e.reEmitter.reEmit(r,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),r}g.prototype.createRoom=function(e){const t=this.client,{timelineSupport:r,unstableClientRelationAggregation:n}=t,i=new s.Room(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:r,unstableClientRelationAggregation:n});return t.reEmitter.reEmit(i,["Room.name","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent"]),this._registerStateListeners(i),i},g.prototype.createGroup=function(e){const t=this.client,r=new o.Group(e);return t.reEmitter.reEmit(r,["Group.profile","Group.myMembership"]),t.store.storeGroup(r),r},g.prototype._registerStateListeners=function(e){const t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,r,n){n.user=t.getUser(n.userId),t.reEmitter.reEmit(n,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))},g.prototype._deregisterStateListeners=function(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")},g.prototype.syncLeftRooms=function(){const e=this.client,t=this,r=new c.Filter(this.client.credentials.userId);r.setTimelineLimit(1),r.setIncludeLeaveRooms(!0);const n=this.opts.pollTimeout+8e4,i={timeout:0};return e.getOrCreateFilter(p(e.credentials.userId,"LEFT_ROOMS"),r).then((function(t){return i.filter=t,e._http.authedRequest(void 0,"GET","/sync",i,void 0,n)})).then((function(r){let n=[];r.rooms&&r.rooms.leave&&(n=t._mapSyncResponseToRoomArray(r.rooms.leave));const i=[];return n.forEach((function(r){const n=r.room;if(i.push(n),!r.isBrandNewRoom)return;r.timeline=r.timeline||{};const s=t._mapSyncEventsFormat(r.timeline,n),o=t._mapSyncEventsFormat(r.state,n);n.getLiveTimeline().setPaginationToken(r.timeline.prev_batch,l.EventTimeline.BACKWARDS),t._processRoomEvents(n,o,s),n.recalculate(),e.store.storeRoom(n),e.emit("Room",n),t._processEventsForNotifs(n,s)})),i}))},g.prototype.peek=function(e){if(this._peekRoom&&this._peekRoom.roomId===e)return Promise.resolve(this._peekRoom);const t=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then((e=>{e.messages=e.messages||{},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];const r=a.map(a.deepCopy(e.state),t.getEventMapper()),n=a.map(e.state,t.getEventMapper()),i=a.map(e.messages.chunk,t.getEventMapper());return e.presence&&a.isArray(e.presence)&&e.presence.map(t.getEventMapper()).forEach((function(e){let r=t.store.getUser(e.getContent().user_id);r?r.setPresenceEvent(e):(r=m(t,e.getContent().user_id),r.setPresenceEvent(e),t.store.storeUser(r)),t.emit("event",e)})),e.messages.start&&(this._peekRoom.oldState.paginationToken=e.messages.start),this._peekRoom.oldState.setStateEvents(r),this._peekRoom.currentState.setStateEvents(n),this._resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(i.reverse(),!0,this._peekRoom.getLiveTimeline(),e.messages.start),t.store.storeRoom(this._peekRoom),t.emit("Room",this._peekRoom),this._peekPoll(this._peekRoom),this._peekRoom}))},g.prototype.stopPeeking=function(){this._peekRoom=null},g.prototype._peekPoll=function(e,t){if(this._peekRoom!==e)return void f("Stopped peeking in room %s",e.roomId);const r=this;this.client._http.authedRequest(void 0,"GET","/events",{room_id:e.roomId,timeout:3e4,from:t},void 0,5e4).then((function(t){if(r._peekRoom!==e)return void f("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(r.client.getEventMapper()).forEach((function(e){let t=r.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=m(r.client,e.getContent().user_id),t.setPresenceEvent(e),r.client.store.storeUser(t)),r.client.emit("event",e)}));const n=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(r.client.getEventMapper());e.addLiveEvents(n),r._peekPoll(e,t.end)}),(function(n){h.logger.error("[%s] Peek poll failed: %s",e.roomId,n),setTimeout((function(){r._peekPoll(e,t)}),3e4)}))},g.prototype.getSyncState=function(){return this._syncState},g.prototype.getSyncStateData=function(){return this._syncStateData},g.prototype.recoverFromSyncStartupError=async function(e,t){await e;const r=this._startKeepAlives();this._updateSyncState("ERROR",{error:t}),await r},g.prototype._wasLazyLoadingToggled=async function(e){e=!!e;let t=!1;if(!await this.client.store.isNewlyCreated()){const r=await this.client.store.getClientOptions();return r&&(t=!!r.lazyLoadMembers),t!==e}return!1},g.prototype._shouldAbortSync=function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(h.logger.warn("Token no longer valid - assuming logout"),this.stop(),!0)},g.prototype.sync=function(){const e=this.client,t=this;this._running=!0,r.g.window&&(this._onOnlineBound=this._onOnline.bind(this),r.g.window.addEventListener("online",this._onOnlineBound,!1));let n=Promise.resolve(),i=null;function s(){const r=new c.Filter(e.credentials.userId);return r.setTimelineLimit(t.opts.initialSyncLimit),r}const o=async()=>{if(f("Checking lazy load status..."),this.opts.lazyLoadMembers&&e.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers&&(f("Checking server lazy load support..."),await e.doesServerSupportLazyLoading()?(f("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=s()),this.opts.filter.setLazyLoadMembers(!0)):(f("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1)),f("Checking whether lazy loading has changed in store..."),await this._wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this._storeIsInvalid=!0;const e=d.InvalidStoreError.TOGGLED_LAZY_LOADING,t=new d.InvalidStoreError(e,!!this.opts.lazyLoadMembers);return this._updateSyncState("ERROR",{error:t}),void h.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}this.opts.lazyLoadMembers&&this.opts.crypto&&this.opts.crypto.enableLazyLoading();try{f("Storing client options..."),await this.client._storeClientOptions(),f("Stored client options")}catch(e){throw h.logger.error("Storing client options failed",e),e}a()};async function a(){let r,o;f("Getting filter..."),r=t.opts.filter?t.opts.filter:s();try{o=await e.getOrCreateFilter(p(e.credentials.userId),r)}catch(e){if(h.logger.error("Getting filter failed",e),t._shouldAbortSync(e))return;return f("Waiting for saved sync before retrying filter..."),await t.recoverFromSyncStartupError(n,e),void a()}e.resetNotifTimelineSet(),null===t._currentSyncRequest&&(f("Sending first sync request..."),t._currentSyncRequest=t._doSyncRequest({filterId:o},i)),f("Waiting for saved sync before starting sync processing..."),await n,t._sync({filterId:o})}e.isGuest()?t._sync({}):(f("Getting saved sync token..."),n=e.store.getSavedSyncToken().then((t=>(f("Got saved sync token"),i=t,f("Getting saved sync..."),e.store.getSavedSync()))).then((e=>{if(f(`Got reply from saved sync, exists? ${!!e}`),e)return t._syncFromCache(e)})).catch((e=>{h.logger.error("Getting saved sync failed",e)})),async function r(){try{f("Getting push rules...");const t=await e.getPushRules();f("Got push rules"),e.pushRules=t}catch(e){if(h.logger.error("Getting push rules failed",e),t._shouldAbortSync(e))return;return f("Waiting for saved sync before retrying push rules..."),await t.recoverFromSyncStartupError(n,e),void r()}o()}())},g.prototype.stop=function(){f("SyncApi.stop"),r.g.window&&(r.g.window.removeEventListener("online",this._onOnlineBound,!1),this._onOnlineBound=void 0),this._running=!1,this._currentSyncRequest&&this._currentSyncRequest.abort(),this._keepAliveTimer&&(clearTimeout(this._keepAliveTimer),this._keepAliveTimer=null)},g.prototype.retryImmediately=function(){return!!this._connectionReturnedDefer&&(this._startKeepAlives(0),!0)},g.prototype._syncFromCache=async function(e){f("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const r={oldSyncToken:null,nextSyncToken:t,catchingUp:!1,fromCache:!0},n={next_batch:t,rooms:e.roomsData,groups:e.groupsData,account_data:{events:e.accountData}};try{await this._processSyncResponse(r,n)}catch(e){h.logger.error("Error processing cached sync",e.stack||e)}this._storeIsInvalid||this._updateSyncState("PREPARED",r)},g.prototype._sync=async function(e){const t=this.client;if(!this._running)return f("Sync no longer running: exiting."),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");const r=t.store.getSyncToken();let n;try{null===this._currentSyncRequest&&(this._currentSyncRequest=this._doSyncRequest(e,r)),n=await this._currentSyncRequest}catch(t){return void this._onSyncError(t,e)}finally{this._currentSyncRequest=null}t.store.setSyncToken(n.next_batch),this._failedSyncCount=0,await t.store.setSyncData(n);const i={oldSyncToken:r,nextSyncToken:n.next_batch,catchingUp:this._catchingUp};this.opts.crypto&&await this.opts.crypto.onSyncWillProcess(i);try{await this._processSyncResponse(i,n)}catch(e){h.logger.error("Caught /sync error",e.stack||e),this.client.emit("sync.unexpectedError",e)}i.catchingUp=this._catchingUp,e.hasSyncedBefore||(this._updateSyncState("PREPARED",i),e.hasSyncedBefore=!0),this.opts.crypto&&await this.opts.crypto.onSyncCompleted(i),this._updateSyncState("SYNCING",i),t.store.wantsSave()&&(this.opts.crypto&&await this.opts.crypto.saveDeviceList(0),t.store.save()),this._sync(e)},g.prototype._doSyncRequest=function(e,t){const r=this._getSyncParams(e,t);return this.client._http.authedRequest(void 0,"GET","/sync",r,void 0,r.timeout+8e4)},g.prototype._getSyncParams=function(e,t){let r=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this._catchingUp)&&(this._catchingUp=!0,r=0);let n=e.filterId;this.client.isGuest()&&!n&&(n=this._getGuestFilter());const i={filter:n,timeout:r};return this.opts.disablePresence&&(i.set_presence="offline"),t?i.since=t:i._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(i.timeout=0),i},g.prototype._onSyncError=function(e,t){if(!this._running)return f("Sync no longer running: exiting"),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");h.logger.error("/sync error %s",e),h.logger.error(e),this._shouldAbortSync(e)||(this._failedSyncCount++,h.logger.log("Number of consecutive failed sync requests:",this._failedSyncCount),f("Starting keep-alive"),this._startKeepAlives().then((e=>{e&&"ERROR"===this.getSyncState()&&this._updateSyncState("CATCHUP",{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),this._sync(t)})),this._currentSyncRequest=null,this._updateSyncState(this._failedSyncCount>=3?"ERROR":"RECONNECTING",{error:e}))},g.prototype._processSyncResponse=async function(e,t){const r=this.client,n=this;if(t.presence&&a.isArray(t.presence.events)&&t.presence.events.map(r.getEventMapper()).forEach((function(e){let t=r.store.getUser(e.getSender());t?t.setPresenceEvent(e):(t=m(r,e.getSender()),t.setPresenceEvent(e),r.store.storeUser(t)),r.emit("event",e)})),t.account_data&&a.isArray(t.account_data.events)){const e=t.account_data.events.map(r.getEventMapper()),n=e.reduce(((e,t)=>(e[t.getId()]=r.store.getAccountData(t.getType()),e)),{});r.store.storeAccountDataEvents(e),e.forEach((function(e){if("m.push_rules"===e.getType()){const t=e.getContent();r.pushRules=u.PushProcessor.rewriteDefaultRules(t)}const t=n[e.getId()];return r.emit("accountData",e,t),e}))}if(t.to_device&&a.isArray(t.to_device.events)&&t.to_device.events.length>0){const e=[];t.to_device.events.map(r.getEventMapper()).map((t=>{if("m.key.verification.cancel"===t.getType()){const r=t.getContent().transaction_id;r&&e.push(r)}return t})).forEach((function(t){const n=t.getContent();if("m.room.message"!=t.getType()||"m.bad.encrypted"!=n.msgtype){if("m.key.verification.start"===t.getType()||"m.key.verification.request"===t.getType()){const r=n.transaction_id;e.includes(r)&&t.flagCancelled()}r.emit("toDeviceEvent",t)}else h.logger.log("Ignoring undecryptable to-device event from "+t.getSender())}))}else this._catchingUp=!1;t.groups&&(t.groups.invite&&this._processGroupSyncEntry(t.groups.invite,"invite"),t.groups.join&&this._processGroupSyncEntry(t.groups.join,"join"),t.groups.leave&&this._processGroupSyncEntry(t.groups.leave,"leave"));let i=[],s=[],o=[];if(t.rooms&&(t.rooms.invite&&(i=this._mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(s=this._mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(o=this._mapSyncResponseToRoomArray(t.rooms.leave))),this._notifEvents=[],i.forEach((function(e){const t=e.room,i=n._mapSyncEventsFormat(e.invite_state,t);n._processRoomEvents(t,i),e.isBrandNewRoom&&(t.recalculate(),r.store.storeRoom(t),r.emit("Room",t)),i.forEach((function(e){r.emit("event",e)})),t.updateMyMembership("invite")})),await a.promiseMapSeries(s,(async function(t){const i=t.room,s=n._mapSyncEventsFormat(t.state,i),o=n._mapSyncEventsFormat(t.timeline,i),c=n._mapSyncEventsFormat(t.ephemeral),u=n._mapSyncEventsFormat(t.account_data);if(t.unread_notifications){i.setUnreadNotificationCount("total",t.unread_notifications.notification_count);const e=r.isRoomEncrypted(i.roomId);(!e||e&&i.getUnreadNotificationCount("highlight")<=0)&&i.setUnreadNotificationCount("highlight",t.unread_notifications.highlight_count)}if(t.timeline=t.timeline||{},t.isBrandNewRoom)i.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,l.EventTimeline.BACKWARDS);else if(t.timeline.limited){let s=!0;for(let e=o.length-1;e>=0;e--){const t=o[e].getId();if(i.getTimelineForEvent(t)){f("Already have event "+t+" in limited sync - not resetting"),s=!1,o.splice(0,e);break}}s&&(n._deregisterStateListeners(i),i.resetLiveTimeline(t.timeline.prev_batch,n.opts.canResetEntireTimeline(i.roomId)?null:e.oldSyncToken),r.resetNotifTimelineSet(),n._registerStateListeners(i))}async function h(e){if(r.emit("event",e),e.isState()&&"m.room.encryption"==e.getType()&&n.opts.crypto&&await n.opts.crypto.onCryptoEvent(e),e.isState()&&"im.vector.user_status"===e.getType()){let t=r.store.getUser(e.getStateKey());t?t._unstable_updateStatusMessage(e):(t=m(r,e.getStateKey()),t._unstable_updateStatusMessage(e),r.store.storeUser(t))}}n._processRoomEvents(i,s,o,e.fromCache),t.summary&&i.setSummary(t.summary),i.addEphemeralEvents(c),i.addAccountData(u),i.recalculate(),t.isBrandNewRoom&&(r.store.storeRoom(i),r.emit("Room",i)),n._processEventsForNotifs(i,o),await a.promiseMapSeries(s,h),await a.promiseMapSeries(o,h),c.forEach((function(e){r.emit("event",e)})),u.forEach((function(e){r.emit("event",e)})),i.updateMyMembership("join")})),o.forEach((function(e){const t=e.room,i=n._mapSyncEventsFormat(e.state,t),s=n._mapSyncEventsFormat(e.timeline,t),o=n._mapSyncEventsFormat(e.account_data);n._processRoomEvents(t,i,s),t.addAccountData(o),t.recalculate(),e.isBrandNewRoom&&(r.store.storeRoom(t),r.emit("Room",t)),n._processEventsForNotifs(t,s),i.forEach((function(e){r.emit("event",e)})),s.forEach((function(e){r.emit("event",e)})),o.forEach((function(e){r.emit("event",e)})),t.updateMyMembership("leave")})),e.oldSyncToken&&this._notifEvents.length&&(this._notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this._notifEvents.forEach((function(e){r.getNotifTimelineSet().addLiveEvent(e)}))),t.device_lists&&this.opts.crypto&&await this.opts.crypto.handleDeviceListChanges(e,t.device_lists),this.opts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.opts.crypto.updateOneTimeKeyCount(e)}if(this.opts.crypto&&t["org.matrix.msc2732.device_unused_fallback_key_types"]){const e=t["org.matrix.msc2732.device_unused_fallback_key_types"];this.opts.crypto.setNeedsNewFallback(e instanceof Array&&!e.includes("signed_curve25519"))}},g.prototype._startKeepAlives=function(e){void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this._keepAliveTimer&&clearTimeout(this._keepAliveTimer);const t=this;return e>0?t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t),e):t._pokeKeepAlive(),this._connectionReturnedDefer||(this._connectionReturnedDefer=a.defer()),this._connectionReturnedDefer.promise},g.prototype._pokeKeepAlive=function(e){void 0===e&&(e=!1);const t=this;function r(){clearTimeout(t._keepAliveTimer),t._connectionReturnedDefer&&(t._connectionReturnedDefer.resolve(e),t._connectionReturnedDefer=null)}this.client._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((function(){r()}),(function(n){400==n.httpStatus||404==n.httpStatus?t._keepAliveTimer=setTimeout(r,2e3):(e=!0,t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t,e),5e3+Math.floor(5e3*Math.random())),t._updateSyncState("ERROR",{error:n}))}))},g.prototype._processGroupSyncEntry=function(e,t){for(const r of Object.keys(e)){const n=e[r];let i=this.client.store.getGroup(r);const s=null===i;null===i&&(i=this.createGroup(r)),n.profile&&i.setProfile(n.profile.name,n.profile.avatar_url),n.inviter&&i.setInviter({userId:n.inviter}),i.setMyMembership(t),s&&this.client.emit("Group",i)}},g.prototype._mapSyncResponseToRoomArray=function(e){const t=this.client,r=this;return a.keys(e).map((function(n){const i=e[n];let s=t.store.getRoom(n),o=!1;return s||(s=r.createRoom(n),o=!0),i.room=s,i.isBrandNewRoom=o,i}))},g.prototype._mapSyncEventsFormat=function(e,t){if(!e||!a.isArray(e.events))return[];const r=this.client.getEventMapper();return e.events.map((function(e){return t&&(e.room_id=t.roomId),r(e)}))},g.prototype._resolveInvites=function(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(r){if(r._requestedProfileInfo)return;r._requestedProfileInfo=!0;const n=t.getUser(r.userId);let i;i=n?Promise.resolve({avatar_url:n.avatarUrl,displayname:n.displayName}):t.getProfileInfo(r.userId),i.then((function(t){const n=r.events.member;"invite"===n.getContent().membership&&(n.getContent().avatar_url=t.avatar_url,n.getContent().displayname=t.displayname,r.setMembershipEvent(n,e.currentState))}),(function(e){}))}))},g.prototype._processRoomEvents=function(e,t,r,n){const i=e.getLiveTimeline(),s=0==i.getEvents().length;if(s){for(const e of t)this.client.getPushActionsForEvent(e);i.initialiseState(t)}this._resolveInvites(e),e.recalculate(),s||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(r||[],null,n)},g.prototype._processEventsForNotifs=function(e,t){if(this.client.getNotifTimelineSet())for(let e=0;e<t.length;e++){const r=this.client.getPushActionsForEvent(t[e]);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this._notifEvents.push(t[e])}},g.prototype._getGuestFilter=function(){return this.client._guestRooms?JSON.stringify({room:{timeline:{limit:20}}}):"{}"},g.prototype._updateSyncState=function(e,t){const r=this._syncState;this._syncState=e,this._syncStateData=t,this.client.emit("sync",this._syncState,r,t)},g.prototype._onOnline=function(){f("Browser thinks we are back online"),this._startKeepAlives(0)}},4969:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineWindow=i,t.TimelineIndex=s;var n=r(8910);r(7434);function i(e,t,r){r=r||{},this._client=e,this._timelineSet=t,this._start=null,this._end=null,this._eventCount=0,this._windowLimit=r.windowLimit||1e3}function s(e,t){this.timeline=e,this.index=t}i.prototype.load=function(e,t){const r=this;t=t||20;const n=function(n){let i;const o=n.getEvents();if(e){for(let t=0;t<o.length;t++)if(o[t].getId()==e){i=t;break}if(void 0===i)throw new Error("getEventTimeline result didn't include requested event")}else i=o.length;const a=Math.min(o.length,i+Math.ceil(t/2)),c=Math.max(0,a-t);r._start=new s(n,c-n.getBaseIndex()),r._end=new s(n,a-n.getBaseIndex()),r._eventCount=a-c};if(e){const t=this._timelineSet.getTimelineForEvent(e);return t?(n(t),Promise.resolve(t)):this._client.getEventTimeline(this._timelineSet,e).then(n)}return n(this._timelineSet.getLiveTimeline()),Promise.resolve()},i.prototype.getTimelineIndex=function(e){if(e==n.EventTimeline.BACKWARDS)return this._start;if(e==n.EventTimeline.FORWARDS)return this._end;throw new Error("Invalid direction '"+e+"'")},i.prototype.extend=function(e,t){const r=this.getTimelineIndex(e);if(!r)return!1;const i=e==n.EventTimeline.BACKWARDS?r.retreat(t):r.advance(t);if(i){this._eventCount+=i,this._eventCount;const t=this._eventCount-this._windowLimit;return t>0&&this.unpaginate(t,e!=n.EventTimeline.BACKWARDS),!0}return!1},i.prototype.canPaginate=function(e){const t=this.getTimelineIndex(e);if(!t)return!1;if(e==n.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))},i.prototype.paginate=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=5);const s=this.getTimelineIndex(e);if(!s)return Promise.resolve(!1);if(s.pendingPaginate)return s.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!r||0===i)return Promise.resolve(!1);if(!s.timeline.getPaginationToken(e))return Promise.resolve(!1);const o=this,a=this._client.paginateEventTimeline(s.timeline,{backwards:e==n.EventTimeline.BACKWARDS,limit:t}).finally((function(){s.pendingPaginate=null})).then((function(r){return!!r&&o.paginate(e,t,!0,i-1)}));return s.pendingPaginate=a,a},i.prototype.unpaginate=function(e,t){const r=t?this._start:this._end;if(e>this._eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this._eventCount+" in the timeline");for(;e>0;){const n=t?r.advance(e):r.retreat(e);if(n<=0)throw new Error("Unable to unpaginate any further, but still have "+this._eventCount+" events");e-=n,this._eventCount-=n,this._eventCount}},i.prototype.getEvents=function(){if(!this._start)return[];const e=[];let t=this._start.timeline;for(;;){const r=t.getEvents();let i=0,s=r.length;t===this._start.timeline&&(i=this._start.index+t.getBaseIndex()),t===this._end.timeline&&(s=this._end.index+t.getBaseIndex());for(let t=i;t<s;t++)e.push(r[t]);if(t===this._end.timeline)break;t=t.getNeighbouringTimeline(n.EventTimeline.FORWARDS)}return e},s.prototype.minIndex=function(){return-1*this.timeline.getBaseIndex()},s.prototype.maxIndex=function(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()},s.prototype.advance=function(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const r=this.timeline.getNeighbouringTimeline(e<0?n.EventTimeline.BACKWARDS:n.EventTimeline.FORWARDS);return r?(this.timeline=r,this.index=e<0?this.maxIndex():this.minIndex(),this.advance(e)):0},s.prototype.retreat=function(e){return-1*this.advance(-1*e)}},3102:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeParams=function(e){let t="";for(const r in e)e.hasOwnProperty(r)&&(t+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.substring(1)},t.encodeUri=function(e,t){for(const r in t)t.hasOwnProperty(r)&&(e=e.replace(r,encodeURIComponent(t[r])));return e},t.map=function(e,t){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=t(e[n]);return r},t.filter=function(e,t){const r=[];for(let n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r},t.keys=function(e){const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(r);return t},t.values=function(e){const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t},t.forEach=function(e,t){for(let r=0;r<e.length;r++)t(e[r],r)},t.findElement=function(e,t,r){let n;if(r){for(n=e.length-1;n>=0;n--)if(t(e[n],n,e))return e[n]}else for(n=0;n<e.length;n++)if(t(e[n],n,e))return e[n]},t.removeElement=function(e,t,r){let n,i;if(r){for(n=e.length-1;n>=0;n--)if(t(e[n],n,e))return i=e[n],e.splice(n,1),i}else for(n=0;n<e.length;n++)if(t(e[n],n,e))return i=e[n],e.splice(n,1),i;return!1},t.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},t.isArray=function(e){return Array.isArray?Array.isArray(e):Boolean(e&&e.constructor===Array)},t.checkObjectHasKeys=function(e,t){for(let r=0;r<t.length;r++)if(!e.hasOwnProperty(t[r]))throw new Error("Missing required key: "+t[r])},t.checkObjectHasNoAdditionalKeys=function(e,t){for(const r in e)if(e.hasOwnProperty(r)&&-1===t.indexOf(r))throw new Error("Unknown key: "+r)},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.deepCompare=function e(t,r){if(t===r)return!0;if(typeof t!=typeof r)return!1;if("number"==typeof t&&isNaN(t)&&isNaN(r))return!0;if(null===t||null===r)return t===r;if(!(t instanceof Object))return!1;if(t.constructor!==r.constructor||t.prototype!==r.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===r.toString();if(t instanceof Array){if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1}else{let n;for(n in r)if(r.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;for(n in r){if(r.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(!e(t[n],r[n]))return!1}}return!0},t.extend=function(...e){const t=e[0]||{};for(let r=1;r<e.length;r++){const n=e[r];if(n)for(const e in n)t[e]=n[e]}return t},t.runPolyfills=function(){Array.prototype.filter||(Array.prototype.filter=function(e,...t){if(null==this)throw new TypeError;const r=Object(this),n=r.length>>>0;if("function"!=typeof e)throw new TypeError;const i=[],s=t?t[0]:void 0;for(let t=0;t<n;t++)if(t in r){const n=r[t];e.call(s,n,t,r)&&i.push(n)}return i}),Array.prototype.map||(Array.prototype.map=function(e,t){let r,n;if(null==this)throw new TypeError(" this is null or not defined");const i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");arguments.length>1&&(r=t);const o=new Array(s);for(n=0;n<s;){let t,s;n in i&&(t=i[n],s=e.call(r,t,n,i),o[n]=s),n++}return o}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){let r,n;if(null==this)throw new TypeError(" this is null or not defined");const i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(r=t),n=0;n<s;){let t;n in i&&(t=i[n],e.call(r,t,n,i)),n++}})},t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.polyfillSuper=function(e,t,...r){try{t.call(e,...r)}catch(n){const i=new t(...r);Object.assign(e,i)}},t.isNumber=function(e){return"number"==typeof e&&isFinite(e)},t.removeHiddenChars=function(e){return"string"==typeof e?(0,i.default)(e.normalize("NFD").replace(s,"")):""},t.escapeRegExp=o,t.globToRegexp=function(e,t){t="boolean"!=typeof t||t;let r=o(e);return r=r.replace(/\\\*/g,".*"),r=r.replace(/\?/g,"."),t&&(r=r.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,r,n,i){return"["+(t?"^":"")+r.replace(/\\-/,"-")+"]"}))),r},t.ensureNoTrailingSlash=function(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e},t.sleep=function(e,t){return new Promise((r=>{setTimeout(r,e,t)}))},t.isNullOrUndefined=function(e){return null==e},t.defer=function(){let e,t;const r=new Promise(((r,n)=>{e=r,t=n}));return{resolve:e,reject:t,promise:r}},t.promiseMapSeries=async function(e,t){for(const r of await e)await t(await r)},t.promiseTry=function(e){return new Promise((t=>t(e())))},t.setCrypto=function(e){a=e},t.getCrypto=function(){return a};var i=n(r(5067));const s=/[\u2000-\u200F\u202A-\u202F\u0300-\u036f\uFEFF\s]/g;function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let a},9679:(e,t,r)=>{"use strict";var n=r(862),i=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDesktopCapturerSources=function(){return window.electron.getDesktopCapturerSources({thumbnailSize:{height:176,width:312},types:["screen","window"]})},t.setAudioOutput=function(e){k=e},t.setAudioInput=function(e){E=e},t.setVideoInput=function(e){x=e},t.createNewMatrixCall=function(e,t,r){if("undefined"==typeof window||"undefined"==typeof document)return null;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return o.logger.error("WebRTC is not supported in this browser / environment"),null}catch(e){return o.logger.error("Exception thrown when trying to access WebRTC",e),null}const n=!!r&&r.forceTURN,i={client:e,roomId:t,turnServers:e.getTurnServers(),forceTURN:e._forceTURN||n},s=new b(i);return e.reEmitter.reEmit(s,Object.values(g)),s},t.MatrixCall=t.CallError=t.CallErrorCode=t.CallEvent=t.CallParty=t.CallDirection=t.CallType=t.CallState=void 0;var s=i(r(9713)),o=r(7434),a=r(7187),c=n(r(3102)),l=r(2481),u=r(8401);let h,d,p,f,g,m;var y;t.CallState=h,function(e){e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended"}(h||(t.CallState=h={})),t.CallType=d,function(e){e.Voice="voice",e.Video="video"}(d||(t.CallType=d={})),t.CallDirection=p,function(e){e.Inbound="inbound",e.Outbound="outbound"}(p||(t.CallDirection=p={})),t.CallParty=f,function(e){e.Local="local",e.Remote="remote"}(f||(t.CallParty=f={})),t.CallEvent=g,function(e){e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold"}(g||(t.CallEvent=g={})),t.CallErrorCode=m,function(e){e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout"}(m||(t.CallErrorCode=m={})),function(e){e.Audio="audio",e.Video="video"}(y||(y={}));class v extends Error{constructor(e,t,r){super(t+": "+r),(0,s.default)(this,"code",void 0),this.code=e}}function _(){return Date.now().toString()+(0,u.randomString)(16)}t.CallError=v;class b extends a.EventEmitter{constructor(e){super(),(0,s.default)(this,"roomId",void 0),(0,s.default)(this,"type",void 0),(0,s.default)(this,"callId",void 0),(0,s.default)(this,"state",void 0),(0,s.default)(this,"hangupParty",void 0),(0,s.default)(this,"hangupReason",void 0),(0,s.default)(this,"direction",void 0),(0,s.default)(this,"ourPartyId",void 0),(0,s.default)(this,"client",void 0),(0,s.default)(this,"forceTURN",void 0),(0,s.default)(this,"turnServers",void 0),(0,s.default)(this,"candidateSendQueue",void 0),(0,s.default)(this,"candidateSendTries",void 0),(0,s.default)(this,"sentEndOfCandidates",void 0),(0,s.default)(this,"peerConn",void 0),(0,s.default)(this,"localVideoElement",void 0),(0,s.default)(this,"remoteVideoElement",void 0),(0,s.default)(this,"remoteAudioElement",void 0),(0,s.default)(this,"screenSharingStream",void 0),(0,s.default)(this,"remoteStream",void 0),(0,s.default)(this,"localAVStream",void 0),(0,s.default)(this,"inviteOrAnswerSent",void 0),(0,s.default)(this,"waitForLocalAVStream",void 0),(0,s.default)(this,"config",void 0),(0,s.default)(this,"successor",void 0),(0,s.default)(this,"opponentMember",void 0),(0,s.default)(this,"opponentVersion",void 0),(0,s.default)(this,"opponentPartyId",void 0),(0,s.default)(this,"opponentCaps",void 0),(0,s.default)(this,"inviteTimeout",void 0),(0,s.default)(this,"remoteOnHold",void 0),(0,s.default)(this,"unholdingRemote",void 0),(0,s.default)(this,"micMuted",void 0),(0,s.default)(this,"vidMuted",void 0),(0,s.default)(this,"callStatsAtEnd",void 0),(0,s.default)(this,"makingOffer",void 0),(0,s.default)(this,"ignoreOffer",void 0),(0,s.default)(this,"remoteCandidateBuffer",new Map),(0,s.default)(this,"gotUserMediaForInvite",(async e=>{if(this.successor)return void this.successor.gotUserMediaForAnswer(e);if(this.callHasEnded())return void this.stopAllMedia();this.localAVStream=e,o.logger.info("Got local AV stream with id "+this.localAVStream.id),this.setState(h.CreateOffer),o.logger.debug("gotUserMediaForInvite -> "+this.type);const t=this.getLocalVideoElement();if(t&&this.type===d.Video){t.autoplay=!0,this.screenSharingStream?(o.logger.debug("Setting screen sharing stream to the local video element"),t.srcObject=this.screenSharingStream):t.srcObject=e,t.muted=!0;try{await t.play()}catch(e){o.logger.info("Failed to play local video element",e)}}w(e.getAudioTracks(),!0);for(const t of e.getAudioTracks())o.logger.info("Adding audio track with id "+t.id),this.peerConn.addTrack(t,e);for(const t of(this.screenSharingStream||e).getVideoTracks())o.logger.info("Adding video track with id "+t.id),this.peerConn.addTrack(t,e)})),(0,s.default)(this,"gotUserMediaForAnswer",(async e=>{if(this.callHasEnded())return;const t=this.getLocalVideoElement();if(t&&this.type===d.Video){t.autoplay=!0,t.srcObject=e,t.muted=!0;try{await t.play()}catch(e){o.logger.info("Failed to play local video element",e)}}this.localAVStream=e,o.logger.info("Got local AV stream with id "+this.localAVStream.id),w(e.getAudioTracks(),!0);for(const t of e.getTracks())this.peerConn.addTrack(t,e);let r;this.setState(h.CreateAnswer);try{r=await this.peerConn.createAnswer()}catch(e){return o.logger.debug("Failed to create answer: ",e),void this.terminate(f.Local,m.CreateAnswer,!0)}try{await this.peerConn.setLocalDescription(r),this.setState(h.Connecting),await new Promise((e=>{setTimeout(e,200)})),this.sendAnswer()}catch(e){return o.logger.debug("Error setting local description!",e),void this.terminate(f.Local,m.SetLocalDescription,!0)}})),(0,s.default)(this,"gotLocalIceCandidate",(e=>{if(e.candidate){if(o.logger.debug("Got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),this.callHasEnded())return;""===e.candidate.candidate&&this.sentEndOfCandidates||(this.queueCandidate(e.candidate),""===e.candidate.candidate&&(this.sentEndOfCandidates=!0))}})),(0,s.default)(this,"onIceGatheringStateChange",(e=>{if(o.logger.debug("ice gathering state changed to "+this.peerConn.iceGatheringState),"complete"===this.peerConn.iceGatheringState&&!this.sentEndOfCandidates){const e={candidate:""};this.queueCandidate(e),this.sentEndOfCandidates=!0}})),(0,s.default)(this,"gotLocalOffer",(async e=>{if(o.logger.debug("Created offer: ",e),this.callHasEnded())return void o.logger.debug("Ignoring newly created offer on call ID "+this.callId+" because the call has ended");try{await this.peerConn.setLocalDescription(e)}catch(e){return o.logger.debug("Error setting local description!",e),void this.terminate(f.Local,m.SetLocalDescription,!0)}if("gathering"===this.peerConn.iceGatheringState&&await new Promise((e=>{setTimeout(e,200)})),this.callHasEnded())return;const t=this.state===h.CreateOffer?l.EventType.CallInvite:l.EventType.CallNegotiate,r={lifetime:6e4};this.state===h.CreateOffer?r.offer=this.peerConn.localDescription:r.description=this.peerConn.localDescription,this.client._supportsCallTransfer&&(r.capabilities={"m.call.transferee":!0}),o.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in offer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(t,r)}catch(e){o.logger.error("Failed to send invite",e),e.event&&this.client.cancelPendingEvent(e.event);let t=m.SignallingFailed,r="Signalling failed";return this.state===h.CreateOffer&&(t=m.SendInvite,r="Failed to send invite"),"UnknownDeviceError"==e.name&&(t=m.UnknownDevices,r="Unknown devices present in the room"),this.emit(g.Error,new v(t,r,e)),void this.terminate(f.Local,t,!1)}this.sendCandidateQueue(),this.state===h.CreateOffer&&(this.inviteOrAnswerSent=!0,this.setState(h.InviteSent),this.inviteTimeout=setTimeout((()=>{this.inviteTimeout=null,this.state===h.InviteSent&&this.hangup(m.InviteTimeout,!1)}),6e4))})),(0,s.default)(this,"getLocalOfferFailed",(e=>{o.logger.error("Failed to get local offer",e),this.emit(g.Error,new v(m.LocalOfferFailed,"Failed to get local offer!",e)),this.terminate(f.Local,m.LocalOfferFailed,!1)})),(0,s.default)(this,"getUserMediaFailed",(e=>{this.successor?this.successor.getUserMediaFailed(e):(o.logger.warn("Failed to get user media - ending call",e),this.emit(g.Error,new v(m.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),this.terminate(f.Local,m.NoUserMedia,!1))})),(0,s.default)(this,"onIceConnectionStateChanged",(()=>{this.callHasEnded()||(o.logger.debug("Call ID "+this.callId+": ICE connection state changed to: "+this.peerConn.iceConnectionState),"connected"==this.peerConn.iceConnectionState?this.setState(h.Connected):"failed"==this.peerConn.iceConnectionState&&this.hangup(m.IceFailed,!1))})),(0,s.default)(this,"onSignallingStateChanged",(()=>{o.logger.debug("call "+this.callId+": Signalling state changed to: "+this.peerConn.signalingState)})),(0,s.default)(this,"onTrack",(e=>{0!==e.streams.length?this.remoteStream&&e.streams[0].id!==this.remoteStream.id?o.logger.warn(`Ignoring new stream ID ${e.streams[0].id}: we already have stream ID ${this.remoteStream.id}`):(this.remoteStream||o.logger.info("Got remote stream with id "+e.streams[0].id),this.remoteStream=e.streams[0],o.logger.debug(`Track id ${e.track.id} of kind ${e.track.kind} added`),"video"===e.track.kind?this.remoteVideoElement&&this.playRemoteVideo():this.remoteAudioElement&&this.playRemoteAudio()):o.logger.warn(`Streamless ${e.track.kind} found: ignoring.`)})),(0,s.default)(this,"onNegotiationNeeded",(async()=>{if(o.logger.info("Negotation is needed!"),this.state===h.CreateOffer||0!==this.opponentVersion){this.makingOffer=!0;try{const e=await this.peerConn.createOffer();await this.gotLocalOffer(e)}catch(e){return void this.getLocalOfferFailed(e)}finally{this.makingOffer=!1}}else o.logger.info("Opponent does not support renegotiation: ignoring negotiationneeded event")})),(0,s.default)(this,"onHangupReceived",(e=>{o.logger.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(e)||this.state===h.Ringing?this.terminate(f.Remote,e.reason||m.UserHangup,!0):o.logger.info(`Ignoring message from party ID ${e.party_id}: our partner is ${this.opponentPartyId}`)})),(0,s.default)(this,"onRejectReceived",(e=>{o.logger.debug("Reject received for call ID "+this.callId),[h.InviteSent,h.Ringing].includes(this.state)||this.state===h.Fledgling&&this.direction===p.Inbound?this.terminate(f.Remote,m.UserHangup,!0):o.logger.debug(`Call is in state: ${this.state}: ignoring reject`)})),(0,s.default)(this,"onAnsweredElsewhere",(e=>{o.logger.debug("Call ID "+this.callId+" answered elsewhere"),this.terminate(f.Remote,m.AnsweredElsewhere,!0)})),this.roomId=e.roomId,this.client=e.client,this.type=null,this.forceTURN=e.forceTURN,this.ourPartyId=this.client.deviceId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]});for(const e of this.turnServers)c.checkObjectHasKeys(e,["urls"]);this.callId=_(),this.state=h.Fledgling,this.candidateSendQueue=[],this.candidateSendTries=0,this.sentEndOfCandidates=!1,this.inviteOrAnswerSent=!1,this.makingOffer=!1,this.remoteOnHold=!1,this.unholdingRemote=!1,this.micMuted=!1,this.vidMuted=!1}async placeVoiceCall(){o.logger.debug("placeVoiceCall"),this.checkForErrorListener();const e=S(y.Audio);await this.placeCallWithConstraints(e),this.type=d.Voice}async placeVideoCall(e,t){o.logger.debug("placeVideoCall"),this.checkForErrorListener(),this.localVideoElement=t,this.remoteVideoElement=e;const r=S(y.Video);await this.placeCallWithConstraints(r),this.type=d.Video}async placeScreenSharingCall(e,t,r){o.logger.debug("placeScreenSharingCall"),this.checkForErrorListener(),this.localVideoElement=t,this.remoteVideoElement=e;try{var n;const e=await async function(e){var t;if(null!==(t=window.electron)&&void 0!==t&&t.getDesktopCapturerSources&&e){o.logger.debug("Electron getDesktopCapturerSources() is available...");const t=await e();return t?{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.id}}}:null}return o.logger.debug("Electron desktopCapturer is not available..."),{audio:!1,video:!0}}(r);if(!e)return;null!==(n=window.electron)&&void 0!==n&&n.getDesktopCapturerSources?(o.logger.debug("Getting screen stream using getUserMedia()..."),this.screenSharingStream=await navigator.mediaDevices.getUserMedia(e)):(o.logger.debug("Getting screen stream using getDisplayMedia()..."),this.screenSharingStream=await navigator.mediaDevices.getDisplayMedia(e)),o.logger.debug("Got screen stream, requesting audio stream...");const t=S(y.Audio);this.placeCallWithConstraints(t)}catch(e){this.emit(g.Error,new v(m.NoUserMedia,"Failed to get screen-sharing stream: ",e))}this.type=d.Video}getOpponentMember(){return this.opponentMember}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}getLocalVideoElement(){return this.localVideoElement}getRemoteVideoElement(){return this.remoteVideoElement}getRemoteAudioElement(){return this.remoteAudioElement}async setLocalVideoElement(e){if(this.localVideoElement=e,e&&this.localAVStream&&this.type===d.Video){e.autoplay=!0,e.srcObject=this.localAVStream,e.muted=!0;try{await e.play()}catch(e){o.logger.info("Failed to play local video element",e)}}}setRemoteVideoElement(e){e!==this.remoteVideoElement&&(e.autoplay=!0,this.remoteAudioElement&&(e.muted=!0),this.remoteVideoElement=e,this.remoteStream&&this.playRemoteVideo())}async setRemoteAudioElement(e){e!==this.remoteAudioElement&&(this.remoteAudioElement=e,this.remoteStream&&this.playRemoteAudio())}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),t=[];for(const r of e)t.push(r[1]);return t}async initWithInvite(e){const t=e.getContent();this.direction=p.Inbound,await this.client._checkTurnServers()||o.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection(),this.chooseOpponent(e);try{await this.peerConn.setRemoteDescription(t.offer)}catch(e){return o.logger.debug("Failed to set remote description",e),void this.terminate(f.Local,m.SetRemoteDescription,!1)}if(!this.remoteStream||0===this.remoteStream.getTracks().length)return o.logger.error("No remote stream or no tracks after setting remote description!"),void this.terminate(f.Local,m.SetRemoteDescription,!1);this.type=this.remoteStream.getTracks().some((e=>"video"===e.kind))?d.Video:d.Voice,this.setState(h.Ringing),e.getLocalAge()&&setTimeout((()=>{this.state==h.Ringing&&(o.logger.debug("Call invite has expired. Hanging up."),this.hangupParty=f.Remote,this.setState(h.Ended),this.stopAllMedia(),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit(g.Hangup))}),t.lifetime-e.getLocalAge())}initWithHangup(e){this.setState(h.Ended)}async answer(){if(!this.inviteOrAnswerSent)if(o.logger.debug(`Answering call ${this.callId} of type ${this.type}`),this.localAVStream||this.waitForLocalAVStream)this.localAVStream?this.gotUserMediaForAnswer(this.localAVStream):this.waitForLocalAVStream&&this.setState(h.WaitLocalMedia);else{const e=S(this.type==d.Video?y.Video:y.Audio);o.logger.log("Getting user media with constraints",e),this.setState(h.WaitLocalMedia),this.waitForLocalAVStream=!0;try{const t=await navigator.mediaDevices.getUserMedia(e);this.waitForLocalAVStream=!1,this.gotUserMediaForAnswer(t)}catch(e){return void this.getUserMediaFailed(e)}}}replacedBy(e){o.logger.debug(this.callId+" being replaced by "+e.callId),this.state===h.WaitLocalMedia?(o.logger.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):(this.state===h.CreateOffer||this.state===h.InviteSent)&&(o.logger.debug("Handing local stream to new call"),e.gotUserMediaForAnswer(this.localAVStream),delete this.localAVStream),e.localVideoElement=this.localVideoElement,e.remoteVideoElement=this.remoteVideoElement,e.remoteAudioElement=this.remoteAudioElement,this.successor=e,this.emit(g.Replaced,e),this.hangup(m.Replaced,!0)}hangup(e,t){this.callHasEnded()||(o.logger.debug("Ending call "+this.callId),this.terminate(f.Local,e,!t),m.UserHangup,this.sendVoipEvent(l.EventType.CallHangup,{}))}reject(){if(this.state!==h.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion<1)return o.logger.info(`Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(m.UserHangup,!0);o.logger.debug("Rejecting call: "+this.callId),this.terminate(f.Local,m.UserHangup,!0),this.sendVoipEvent(l.EventType.CallReject,{})}setLocalVideoMuted(e){this.vidMuted=e,this.updateMuteStatus()}isLocalVideoMuted(){return this.vidMuted}setMicrophoneMuted(e){this.micMuted=e,this.updateMuteStatus()}isMicrophoneMuted(){return this.micMuted}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e,e||(this.unholdingRemote=!0);for(const t of this.peerConn.getTransceivers())t.direction=e?"inactive":"sendrecv";this.updateMuteStatus(),e||this.playRemoteAudio(),this.emit(g.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==h.Connected)return!1;if(this.unholdingRemote)return!1;let e=!0;for(const t of this.peerConn.getTransceivers())["inactive","recvonly"].includes(t.currentDirection)||(e=!1);return e}sendDtmfDigit(e){for(const t of this.peerConn.getSenders())if("audio"===t.track.kind&&t.dtmf)return void t.dtmf.insertDTMF(e);throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){if(!this.localAVStream)return;const e=this.micMuted||this.remoteOnHold;w(this.localAVStream.getAudioTracks(),!e);const t=this.vidMuted||this.remoteOnHold;w(this.localAVStream.getVideoTracks(),!t),this.remoteOnHold?this.remoteAudioElement&&this.remoteAudioElement.srcObject===this.remoteStream?this.remoteAudioElement.muted=!0:this.remoteVideoElement&&this.remoteVideoElement.srcObject===this.remoteStream&&(this.remoteVideoElement.muted=!0):this.playRemoteAudio()}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type}};this.client._supportsCallTransfer&&(e.capabilities={"m.call.transferee":!0}),o.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in answer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(l.EventType.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(e){this.setState(h.Ringing),this.client.cancelPendingEvent(e.event);let t=m.SendAnswer,r="Failed to send answer";throw"UnknownDeviceError"==e.name&&(t=m.UnknownDevices,r="Unknown devices present in the room"),this.emit(g.Error,new v(t,r,e)),e}this.sendCandidateQueue()}onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const t=e.getContent().candidates;if(!t)return void o.logger.info("Ignoring candidates event with no candidates!");const r=0===e.getContent().version?null:e.getContent().party_id||null;if(void 0===this.opponentPartyId){o.logger.info(`Bufferring ${t.length} candidates until we pick an opponent`);const e=this.remoteCandidateBuffer.get(r)||[];return e.push(...t),void this.remoteCandidateBuffer.set(r,e)}this.partyIdMatches(e.getContent())?this.addIceCandidates(t):o.logger.info(`Ignoring candidates from party ID ${e.getContent().party_id}: we have chosen party ID ${this.opponentPartyId}`)}async onAnswerReceived(e){if(!this.callHasEnded())if(void 0===this.opponentPartyId){this.chooseOpponent(e),this.setState(h.Connecting);try{await this.peerConn.setRemoteDescription(e.getContent().answer)}catch(e){return o.logger.debug("Failed to set remote description",e),void this.terminate(f.Local,m.SetRemoteDescription,!1)}if(null!==this.opponentPartyId)try{await this.sendVoipEvent(l.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(e){o.logger.warn("Failed to send select_answer event",e)}}else o.logger.info(`Ignoring answer from party ID ${e.getContent().party_id}: we already have an answer/reject from ${this.opponentPartyId}`)}async onSelectAnswerReceived(e){if(this.direction!==p.Inbound)return void o.logger.warn("Got select_answer for an outbound call: ignoring");const t=e.getContent().selected_party_id;null!=t?t!==this.ourPartyId&&(o.logger.info(`Got select_answer for party ID ${t}: we are party ID ${this.ourPartyId}.`),this.terminate(f.Remote,m.AnsweredElsewhere,!0)):o.logger.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring")}async onNegotiateReceived(e){const t=e.getContent().description;if(!t||!t.sdp||!t.type)return void o.logger.info("Ignoring invalid m.call.negotiate event");const r=this.direction===p.Inbound,n="offer"===t.type&&(this.makingOffer||"stable"!=this.peerConn.signalingState);if(this.ignoreOffer=!r&&n,this.ignoreOffer)return void o.logger.info("Ignoring colliding negotiate event because we're impolite");const i=this.isLocalOnHold();"answer"===t.type&&(this.unholdingRemote=!1);try{if(await this.peerConn.setRemoteDescription(t),"offer"===t.type){for(const e of this.peerConn.getTransceivers())e.direction=this.isRemoteOnHold()?"inactive":"sendrecv";const e=await this.peerConn.createAnswer();await this.peerConn.setLocalDescription(e);for(const e of this.peerConn.getTransceivers())e.direction=e.currentDirection;this.sendVoipEvent(l.EventType.CallNegotiate,{description:this.peerConn.localDescription})}}catch(e){o.logger.warn("Failed to complete negotiation",e)}const s=this.isLocalOnHold();i!==s&&(this.emit(g.LocalHoldUnhold,s),this.emit(g.HoldUnhold,s))}callHasEnded(){return this.state===h.Ended}async playRemoteAudio(){this.remoteVideoElement&&(this.remoteVideoElement.muted=!0),this.remoteAudioElement.muted=!1,this.remoteAudioElement.srcObject=this.remoteStream;try{k&&(o.logger.info("Setting audio sink to "+k+", was "+this.remoteAudioElement.sinkId),await this.remoteAudioElement.setSinkId(k))}catch(e){o.logger.warn("Couldn't set requested audio output device: using default",e)}try{await this.remoteAudioElement.play()}catch(e){o.logger.error("Failed to play remote audio element",e)}}async playRemoteVideo(){this.remoteVideoElement.srcObject=this.remoteStream,o.logger.info("playing remote video. stream active? "+this.remoteStream.active);try{await this.remoteVideoElement.play()}catch(e){o.logger.info("Failed to play remote video element",e)}}setState(e){const t=this.state;this.state=e,this.emit(g.State,e,t)}sendVoipEvent(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:1,call_id:this.callId,party_id:this.ourPartyId}))}queueCandidate(e){if(this.candidateSendQueue.push(e),this.state===h.Ringing||!this.inviteOrAnswerSent)return;const t=this.direction===p.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((()=>{this.sendCandidateQueue()}),t)}async transfer(e,t){const r=await this.client.getProfileInfo(e),n=_(),i={replacement_id:_(),target_user:{id:e,display_name:r.display_name,avatar_url:r.avatar_url},create_call:n};return t&&(i.target_room=t),this.sendVoipEvent(l.EventType.CallReplaces,i)}async terminate(e,t,r){if(this.callHasEnded())return;this.callStatsAtEnd=await this.collectCallStats(),this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=null);const n=this.getRemoteVideoElement(),i=this.getRemoteAudioElement(),s=this.getLocalVideoElement();if(n&&(n.pause(),n.srcObject=null),i){i.pause(),i.srcObject=null;try{await this.remoteAudioElement.setSinkId("")}catch(e){o.logger.warn("Failed to set sink ID back to default")}}s&&(s.pause(),s.srcObject=null),this.hangupParty=e,this.hangupReason=t,this.setState(h.Ended),this.stopAllMedia(),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),r&&this.emit(g.Hangup,this)}stopAllMedia(){if(o.logger.debug(`stopAllMedia (stream=${this.localAVStream})`),this.localAVStream)for(const e of this.localAVStream.getTracks())e.stop();if(this.screenSharingStream)for(const e of this.screenSharingStream.getTracks())e.stop();if(this.remoteStream)for(const e of this.remoteStream.getTracks())e.stop()}checkForErrorListener(){if(0===this.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(0===this.candidateSendQueue.length)return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const t={candidates:e};o.logger.debug("Attempting to send "+e.length+" candidates");try{await this.sendVoipEvent(l.EventType.CallCandidates,t)}catch(t){if(t.event&&this.client.cancelPendingEvent(t.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){o.logger.debug("Failed to send candidates on attempt "+this.candidateSendTries+". Giving up on this call.",t);const e=m.SignallingFailed,r="Signalling failed";return this.emit(g.Error,new v(e,r,t)),void this.hangup(e,!1)}const r=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,o.logger.debug("Failed to send candidates. Retrying in "+r+"ms",t),setTimeout((()=>{this.sendCandidateQueue()}),r)}}async placeCallWithConstraints(e){o.logger.log("Getting user media with constraints",e),this.client._callEventHandler.calls.set(this.callId,this),this.setState(h.WaitLocalMedia),this.direction=p.Outbound,this.config=e,await this.client._checkTurnServers()||o.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection();try{const t=await navigator.mediaDevices.getUserMedia(e);this.gotUserMediaForInvite(t)}catch(e){return void this.getUserMediaFailed(e)}}createPeerConnection(){const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client._iceCandidatePoolSize});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){const t=e.getContent();this.opponentVersion=t.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=e.sender;const r=this.remoteCandidateBuffer.get(this.opponentPartyId);r&&(o.logger.info(`Adding ${r.length} buffered candidates for opponent ${this.opponentPartyId}`),this.addIceCandidates(r)),this.remoteCandidateBuffer=null}addIceCandidates(e){for(const t of e){if(!(null!==t.sdpMid&&void 0!==t.sdpMid||null!==t.sdpMLineIndex&&void 0!==t.sdpMLineIndex))return void o.logger.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex");o.logger.debug("Got remote ICE "+t.sdpMid+" candidate: "+t.candidate);try{this.peerConn.addIceCandidate(t)}catch(e){this.ignoreOffer||o.logger.info("Failed to add remore ICE candidate",e)}}}}function w(e,t){for(let r=0;r<e.length;r++)e[r].enabled=t}function S(e){const t=!!navigator.webkitGetUserMedia;switch(e){case y.Audio:return{audio:{deviceId:E?{ideal:E}:void 0},video:!1};case y.Video:return{audio:{deviceId:E?{ideal:E}:void 0},video:{deviceId:x?{ideal:x}:void 0,width:t?{exact:640}:{ideal:640},height:t?{exact:360}:{ideal:360}}}}}let k,E,x;t.MatrixCall=b},2931:(e,t,r)=>{"use strict";var n=r(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventHandler=void 0;var i=n(r(9713)),s=r(7434),o=r(9679),a=r(2481);t.CallEventHandler=class{constructor(e){(0,i.default)(this,"client",void 0),(0,i.default)(this,"calls",void 0),(0,i.default)(this,"callEventBuffer",void 0),(0,i.default)(this,"candidateEventsByCall",void 0),(0,i.default)(this,"evaluateEventBuffer",(()=>{if("SYNCING"===this.client.getSyncState()){if(this.callEventBuffer.some((e=>e.isBeingDecrypted())))return;const e=new Set;for(const t of this.callEventBuffer)t.getType()!==a.EventType.CallAnswer&&t.getType()!==a.EventType.CallHangup||e.add(t.getContent().call_id);for(const t of this.callEventBuffer)if(t.getType()!==a.EventType.CallInvite||!e.has(t.getContent().call_id))try{this.handleCallEvent(t)}catch(e){s.logger.error("Caught exception handling call event",e)}this.callEventBuffer=[]}})),(0,i.default)(this,"onEvent",(e=>{(0===e.getType().indexOf("m.call.")||e.isBeingDecrypted())&&this.callEventBuffer.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once("Event.decrypted",(()=>{if(-1!==e.getType().indexOf("m.call."))if(this.callEventBuffer.includes(e))this.evaluateEventBuffer();else try{this.handleCallEvent(e)}catch(e){s.logger.error("Caught exception handling call event",e)}}))})),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map,this.client.on("sync",this.evaluateEventBuffer),this.client.on("event",this.onEvent)}stop(){this.client.removeListener("sync",this.evaluateEventBuffer),this.client.removeListener("event",this.onEvent)}handleCallEvent(e){const t=e.getContent();let r=t.call_id?this.calls.get(t.call_id):void 0;if(e.getType()===a.EventType.CallInvite){if(e.getSender()===this.client.credentials.userId)return;if(e.getLocalAge()>t.lifetime-3e3)return;if(r&&r.state===o.CallState.Ended)return;r&&s.logger.log(`WARN: Already have a MatrixCall with id ${t.call_id} but got an invite. Clobbering.`);const n=this.client.getTurnServersExpiry()-Date.now();if(s.logger.info("Current turn creds expire in "+n+" ms"),r=(0,o.createNewMatrixCall)(this.client,e.getRoomId(),{forceTURN:this.client._forceTURN}),!r)return void s.logger.log("Incoming call ID "+t.call_id+" but this client doesn't support WebRTC");if(r.callId=t.call_id,r.initWithInvite(e),this.calls.set(r.callId,r),this.candidateEventsByCall.get(r.callId))for(const e of this.candidateEventsByCall.get(r.callId))r.onRemoteIceCandidatesReceived(e);let i;for(const e of this.calls.values()){const t=[o.CallState.WaitLocalMedia,o.CallState.CreateOffer,o.CallState.InviteSent].includes(e.state);if(r.roomId===e.roomId&&e.direction===o.CallDirection.Outbound&&t){i=e;break}}i?i.state===o.CallState.WaitLocalMedia||i.state===o.CallState.CreateOffer||i.callId>r.callId?(s.logger.log("Glare detected: answering incoming call "+r.callId+" and canceling outgoing call "+i.callId),i.replacedBy(r),r.answer()):(s.logger.log("Glare detected: rejecting incoming call "+r.callId+" and keeping outgoing call "+i.callId),r.hangup(o.CallErrorCode.Replaced,!0)):this.client.emit("Call.incoming",r)}else if(e.getType()===a.EventType.CallAnswer){if(!r)return;e.getSender()===this.client.credentials.userId?r.state===o.CallState.Ringing&&r.onAnsweredElsewhere(t):r.onAnswerReceived(e)}else if(e.getType()===a.EventType.CallCandidates){if(e.getSender()===this.client.credentials.userId)return;r?r.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e))}else if([a.EventType.CallHangup,a.EventType.CallReject].includes(e.getType()))r?r.state!==o.CallState.Ended&&(e.getType()===a.EventType.CallHangup?r.onHangupReceived(t):r.onRejectReceived(t),this.calls.delete(t.call_id)):(r=(0,o.createNewMatrixCall)(this.client,e.getRoomId()),r&&(r.callId=t.call_id,r.initWithHangup(e),this.calls.set(t.call_id,r)));else if(e.getType()===a.EventType.CallSelectAnswer){if(!r)return;if(e.getContent().party_id===r.ourPartyId)return;r.onSelectAnswerReceived(e)}else if(e.getType()===a.EventType.CallNegotiate){if(!r)return;if(e.getContent().party_id===r.ourPartyId)return;r.onNegotiateReceived(e)}}}},729:e=>{"use strict";var t={};function r(e,n,i){var s,o,a,c,l,u="";for("string"!=typeof n&&(i=n,n=r.defaultChars),void 0===i&&(i=!0),l=function(e){var r,n,i=t[e];if(i)return i;for(i=t[e]=[],r=0;r<128;r++)n=String.fromCharCode(r),/^[0-9a-z]$/i.test(n)?i.push(n):i.push("%"+("0"+r.toString(16).toUpperCase()).slice(-2));for(r=0;r<e.length;r++)i[e.charCodeAt(r)]=e[r];return i}(n),s=0,o=e.length;s<o;s++)if(a=e.charCodeAt(s),i&&37===a&&s+2<o&&/^[0-9a-f]{2}$/i.test(e.slice(s+1,s+3)))u+=e.slice(s,s+3),s+=2;else if(a<128)u+=l[a];else if(a>=55296&&a<=57343){if(a>=55296&&a<=56319&&s+1<o&&(c=e.charCodeAt(s+1))>=56320&&c<=57343){u+=encodeURIComponent(e[s]+e[s+1]),s++;continue}u+="%EF%BF%BD"}else u+=encodeURIComponent(e[s]);return u}r.defaultChars=";/?:@&=+$,-_.!~*'()#",r.componentChars="-_.!~*'()",e.exports=r},6394:e=>{e.exports={nanoid:(e=21)=>{let t="",r=e;for(;r--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t},customAlphabet:(e,t)=>()=>{let r="",n=t;for(;n--;)r+=e[Math.random()*e.length|0];return r}}},631:(e,t,r)=>{var n="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=n&&i&&"function"==typeof i.get?i.get:null,o=n&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&c&&"function"==typeof c.get?c.get:null,u=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p=Boolean.prototype.valueOf,f=Object.prototype.toString,g=Function.prototype.toString,m=String.prototype.match,y="function"==typeof BigInt?BigInt.prototype.valueOf:null,v=Object.getOwnPropertySymbols,_="function"==typeof Symbol?Symbol.prototype.toString:null,b=Object.prototype.propertyIsEnumerable,w=r(4654).custom,S=w&&A(w)?w:null;function k(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function E(e){return String(e).replace(/"/g,"&quot;")}function x(e){return"[object Array]"===I(e)}function A(e){return"[object Symbol]"===I(e)}e.exports=function e(t,r,n,i){var a=r||{};if(C(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(C(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=!C(a,"customInspect")||a.customInspect;if("boolean"!=typeof c)throw new TypeError('option "customInspect", if provided, must be `true` or `false`');if(C(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('options "indent" must be "\\t", an integer > 0, or `null`');if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return O(t,a);if("number"==typeof t)return 0===t?1/0/t>0?"0":"-0":String(t);if("bigint"==typeof t)return String(t)+"n";var f=void 0===a.depth?5:a.depth;if(void 0===n&&(n=0),n>=f&&f>0&&"object"==typeof t)return x(t)?"[Array]":"[Object]";var v,b=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=Array(e.indent+1).join(" ")}return{base:r,prev:Array(t+1).join(r)}}(a,n);if(void 0===i)i=[];else if(R(i,t)>=0)return"[Circular]";function w(t,r,s){if(r&&(i=i.slice()).push(r),s){var o={depth:a.depth};return C(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),e(t,o,n+1,i)}return e(t,a,n+1,i)}if("function"==typeof t){var T=function(e){if(e.name)return e.name;var t=m.call(g.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),P=F(t,w);return"[Function"+(T?": "+T:" (anonymous)")+"]"+(P.length>0?" { "+P.join(", ")+" }":"")}if(A(t)){var B=_.call(t);return"object"==typeof t?D(B):B}if((v=t)&&"object"==typeof v&&("undefined"!=typeof HTMLElement&&v instanceof HTMLElement||"string"==typeof v.nodeName&&"function"==typeof v.getAttribute)){for(var U="<"+String(t.nodeName).toLowerCase(),q=t.attributes||[],j=0;j<q.length;j++)U+=" "+q[j].name+"="+k(E(q[j].value),"double",a);return U+=">",t.childNodes&&t.childNodes.length&&(U+="..."),U+"</"+String(t.nodeName).toLowerCase()+">"}if(x(t)){if(0===t.length)return"[]";var K=F(t,w);return b&&!function(e){for(var t=0;t<e.length;t++)if(R(e[t],"\n")>=0)return!1;return!0}(K)?"["+N(K,b)+"]":"[ "+K.join(", ")+" ]"}if(function(e){return"[object Error]"===I(e)}(t)){var z=F(t,w);return 0===z.length?"["+String(t)+"]":"{ ["+String(t)+"] "+z.join(", ")+" }"}if("object"==typeof t&&c){if(S&&"function"==typeof t[S])return t[S]();if("function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{l.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var $=[];return o.call(t,(function(e,r){$.push(w(r,t,!0)+" => "+w(e,t))})),L("Map",s.call(t),$,b)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var G=[];return u.call(t,(function(e){G.push(w(e,t))})),L("Set",l.call(t),G,b)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return M("WeakMap");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return M("WeakSet");if(function(e){return"[object Number]"===I(e)}(t))return D(w(Number(t)));if(function(e){return"[object BigInt]"===I(e)}(t))return D(w(y.call(t)));if(function(e){return"[object Boolean]"===I(e)}(t))return D(p.call(t));if(function(e){return"[object String]"===I(e)}(t))return D(w(String(t)));if(!function(e){return"[object Date]"===I(e)}(t)&&!function(e){return"[object RegExp]"===I(e)}(t)){var V=F(t,w);return 0===V.length?"{}":b?"{"+N(V,b)+"}":"{ "+V.join(", ")+" }"}return String(t)};var T=Object.prototype.hasOwnProperty||function(e){return e in this};function C(e,t){return T.call(e,t)}function I(e){return f.call(e)}function R(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function O(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return O(e.slice(0,t.maxStringLength),t)+n}return k(e.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,P),"single",t)}function P(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+t.toString(16).toUpperCase()}function D(e){return"Object("+e+")"}function M(e){return e+" { ? }"}function L(e,t,r,n){return e+" ("+t+") {"+(n?N(r,n):r.join(", "))+"}"}function N(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+e.join(","+r)+"\n"+t.prev}function F(e,t){var r=x(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=C(e,i)?t(e[i],e):""}for(var s in e)C(e,s)&&(r&&String(Number(s))===s&&s<e.length||(/[^\w$]/.test(s)?n.push(t(s,e)+": "+t(e[s],e)):n.push(s+": "+t(e[s],e))));if("function"==typeof v)for(var o=v(e),a=0;a<o.length;a++)b.call(e,o[a])&&n.push("["+t(o[a])+"]: "+t(e[o[a]],e));return n}},9430:function(e,t){var r,n;void 0===(n="function"==typeof(r=function(){return function(e){function t(e){return" "===e||"\t"===e||"\n"===e||"\f"===e||"\r"===e}function r(t){var r,n=t.exec(e.substring(g));if(n)return r=n[0],g+=r.length,r}for(var n,i,s,o,a,c=e.length,l=/^[ \t\n\r\u000c]+/,u=/^[, \t\n\r\u000c]+/,h=/^[^ \t\n\r\u000c]+/,d=/[,]+$/,p=/^\d+$/,f=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,g=0,m=[];;){if(r(u),g>=c)return m;n=r(h),i=[],","===n.slice(-1)?(n=n.replace(d,""),v()):y()}function y(){for(r(l),s="",o="in descriptor";;){if(a=e.charAt(g),"in descriptor"===o)if(t(a))s&&(i.push(s),s="",o="after descriptor");else{if(","===a)return g+=1,s&&i.push(s),void v();if("("===a)s+=a,o="in parens";else{if(""===a)return s&&i.push(s),void v();s+=a}}else if("in parens"===o)if(")"===a)s+=a,o="in descriptor";else{if(""===a)return i.push(s),void v();s+=a}else if("after descriptor"===o)if(t(a));else{if(""===a)return void v();o="in descriptor",g-=1}g+=1}}function v(){var t,r,s,o,a,c,l,u,h,d=!1,g={};for(o=0;o<i.length;o++)c=(a=i[o])[a.length-1],l=a.substring(0,a.length-1),u=parseInt(l,10),h=parseFloat(l),p.test(l)&&"w"===c?((t||r)&&(d=!0),0===u?d=!0:t=u):f.test(l)&&"x"===c?((t||r||s)&&(d=!0),h<0?d=!0:r=h):p.test(l)&&"h"===c?((s||r)&&(d=!0),0===u?d=!0:s=u):d=!0;d?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+a+"'."):(g.url=n,t&&(g.w=t),r&&(g.d=r),s&&(g.h=s),m.push(g))}}})?r.apply(t,[]):r)||(e.exports=n)},9299:function(module,__unused_webpack_exports,__webpack_require__){var factory;factory=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addLinkAttributes",{enumerable:!0,get:function(){return n.addLinkAttributes}}),Object.defineProperty(t,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(t,"LinkTarget",{enumerable:!0,get:function(){return n.LinkTarget}}),Object.defineProperty(t,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(t,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(t,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(t,"build",{enumerable:!0,get:function(){return i.build}}),Object.defineProperty(t,"getDocument",{enumerable:!0,get:function(){return i.getDocument}}),Object.defineProperty(t,"LoopbackPort",{enumerable:!0,get:function(){return i.LoopbackPort}}),Object.defineProperty(t,"PDFDataRangeTransport",{enumerable:!0,get:function(){return i.PDFDataRangeTransport}}),Object.defineProperty(t,"PDFWorker",{enumerable:!0,get:function(){return i.PDFWorker}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return i.version}}),Object.defineProperty(t,"CMapCompressionType",{enumerable:!0,get:function(){return s.CMapCompressionType}}),Object.defineProperty(t,"createObjectURL",{enumerable:!0,get:function(){return s.createObjectURL}}),Object.defineProperty(t,"createPromiseCapability",{enumerable:!0,get:function(){return s.createPromiseCapability}}),Object.defineProperty(t,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return s.createValidAbsoluteUrl}}),Object.defineProperty(t,"InvalidPDFException",{enumerable:!0,get:function(){return s.InvalidPDFException}}),Object.defineProperty(t,"MissingPDFException",{enumerable:!0,get:function(){return s.MissingPDFException}}),Object.defineProperty(t,"OPS",{enumerable:!0,get:function(){return s.OPS}}),Object.defineProperty(t,"PasswordResponses",{enumerable:!0,get:function(){return s.PasswordResponses}}),Object.defineProperty(t,"PermissionFlag",{enumerable:!0,get:function(){return s.PermissionFlag}}),Object.defineProperty(t,"removeNullCharacters",{enumerable:!0,get:function(){return s.removeNullCharacters}}),Object.defineProperty(t,"shadow",{enumerable:!0,get:function(){return s.shadow}}),Object.defineProperty(t,"UnexpectedResponseException",{enumerable:!0,get:function(){return s.UnexpectedResponseException}}),Object.defineProperty(t,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return s.UNSUPPORTED_FEATURES}}),Object.defineProperty(t,"Util",{enumerable:!0,get:function(){return s.Util}}),Object.defineProperty(t,"VerbosityLevel",{enumerable:!0,get:function(){return s.VerbosityLevel}}),Object.defineProperty(t,"AnnotationLayer",{enumerable:!0,get:function(){return o.AnnotationLayer}}),Object.defineProperty(t,"apiCompatibilityParams",{enumerable:!0,get:function(){return a.apiCompatibilityParams}}),Object.defineProperty(t,"GlobalWorkerOptions",{enumerable:!0,get:function(){return c.GlobalWorkerOptions}}),Object.defineProperty(t,"renderTextLayer",{enumerable:!0,get:function(){return l.renderTextLayer}}),Object.defineProperty(t,"SVGGraphics",{enumerable:!0,get:function(){return u.SVGGraphics}});var n=r(1),i=r(5),s=r(2),o=r(19),a=r(9),c=r(12),l=r(20),u=r(21);{const{isNodeJS:e}=r(4);if(e){const e=r(22).PDFNodeStream;(0,i.setPDFNetworkStreamFactory)((t=>new e(t)))}else{const e=r(25).PDFNetworkStream;let t;(0,n.isFetchSupported)()&&(t=r(26).PDFFetchStream),(0,i.setPDFNetworkStreamFactory)((r=>t&&(0,n.isValidFetchUrl)(r.url)?new t(r):new e(r)))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLinkAttributes=function(e,{url:t,target:r,rel:s,enabled:o=!0}={}){(0,n.assert)(t&&"string"==typeof t,'addLinkAttributes: A valid "url" parameter must provided.');const a=(0,n.removeNullCharacters)(t);o?e.href=e.title=a:(e.href="",e.title=`Disabled: ${a}`,e.onclick=()=>!1);let c="";switch(r){case u.NONE:break;case u.SELF:c="_self";break;case u.BLANK:c="_blank";break;case u.PARENT:c="_parent";break;case u.TOP:c="_top"}e.target=c,e.rel="string"==typeof s?s:i},t.getFilenameFromUrl=function(e){const t=e.indexOf("#"),r=e.indexOf("?"),n=Math.min(t>0?t:e.length,r>0?r:e.length);return e.substring(e.lastIndexOf("/",n)+1,n)},t.isFetchSupported=h,t.isValidFetchUrl=d,t.loadScript=function(e){return new Promise(((t,r)=>{const n=document.createElement("script");n.src=e,n.onload=t,n.onerror=function(){r(new Error(`Cannot load script at: ${n.src}`))},(document.head||document.documentElement).appendChild(n)}))},t.deprecated=function(e){console.log("Deprecated API usage: "+e)},t.PDFDateString=t.StatTimer=t.DOMSVGFactory=t.DOMCMapReaderFactory=t.BaseCMapReaderFactory=t.DOMCanvasFactory=t.BaseCanvasFactory=t.DEFAULT_LINK_REL=t.LinkTarget=t.RenderingCancelledException=t.PageViewport=void 0;var n=r(2);const i="noopener noreferrer nofollow";t.DEFAULT_LINK_REL=i;const s="http://www.w3.org/2000/svg";class o{constructor(){this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){(0,n.unreachable)("Abstract method `create` called.")}reset(e,t,r){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||r<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=r}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}}t.BaseCanvasFactory=o,t.DOMCanvasFactory=class extends o{constructor({ownerDocument:e=globalThis.document}={}){super(),this._document=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const r=this._document.createElement("canvas"),n=r.getContext("2d");return r.width=e,r.height=t,{canvas:r,context:n}}};class a{constructor({baseUrl:e=null,isCompressed:t=!1}){this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":""),r=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(t,r).catch((e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)}))}_fetchData(e,t){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=a,t.DOMCMapReaderFactory=class extends a{_fetchData(e,t){return h()&&d(e,document.baseURI)?fetch(e).then((async e=>{if(!e.ok)throw new Error(e.statusText);let r;return r=this.isCompressed?new Uint8Array(await e.arrayBuffer()):(0,n.stringToBytes)(await e.text()),{cMapData:r,compressionType:t}})):new Promise(((r,i)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),this.isCompressed&&(s.responseType="arraybuffer"),s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(200===s.status||0===s.status){let e;if(this.isCompressed&&s.response?e=new Uint8Array(s.response):!this.isCompressed&&s.responseText&&(e=(0,n.stringToBytes)(s.responseText)),e)return void r({cMapData:e,compressionType:t})}i(new Error(s.statusText))}},s.send(null)}))}},t.DOMSVGFactory=class{create(e,t){(0,n.assert)(e>0&&t>0,"Invalid SVG dimensions");const r=document.createElementNS(s,"svg:svg");return r.setAttribute("version","1.1"),r.setAttribute("width",e+"px"),r.setAttribute("height",t+"px"),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox","0 0 "+e+" "+t),r}createElement(e){return(0,n.assert)("string"==typeof e,"Invalid SVG element type"),document.createElementNS(s,e)}};class c{constructor({viewBox:e,scale:t,rotation:r,offsetX:n=0,offsetY:i=0,dontFlip:s=!1}){this.viewBox=e,this.scale=t,this.rotation=r,this.offsetX=n,this.offsetY=i;const o=(e[2]+e[0])/2,a=(e[3]+e[1])/2;let c,l,u,h,d,p,f,g;switch(r=(r%=360)<0?r+360:r){case 180:c=-1,l=0,u=0,h=1;break;case 90:c=0,l=1,u=1,h=0;break;case 270:c=0,l=-1,u=-1,h=0;break;case 0:c=1,l=0,u=0,h=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}s&&(u=-u,h=-h),0===c?(d=Math.abs(a-e[1])*t+n,p=Math.abs(o-e[0])*t+i,f=Math.abs(e[3]-e[1])*t,g=Math.abs(e[2]-e[0])*t):(d=Math.abs(o-e[0])*t+n,p=Math.abs(a-e[1])*t+i,f=Math.abs(e[2]-e[0])*t,g=Math.abs(e[3]-e[1])*t),this.transform=[c*t,l*t,u*t,h*t,d-c*t*o-u*t*a,p-l*t*o-h*t*a],this.width=f,this.height=g}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:r=this.offsetX,offsetY:n=this.offsetY,dontFlip:i=!1}={}){return new c({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:r,offsetY:n,dontFlip:i})}convertToViewportPoint(e,t){return n.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=n.Util.applyTransform([e[0],e[1]],this.transform),r=n.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],r[0],r[1]]}convertToPdfPoint(e,t){return n.Util.applyInverseTransform([e,t],this.transform)}}t.PageViewport=c;class l extends n.BaseException{constructor(e,t){super(e),this.type=t}}t.RenderingCancelledException=l;const u={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};function h(){return"undefined"!=typeof fetch&&"undefined"!=typeof Response&&"body"in Response.prototype&&"undefined"!=typeof ReadableStream}function d(e,t){try{const{protocol:r}=t?new URL(e,t):new URL(e);return"http:"===r||"https:"===r}catch(e){return!1}}let p;t.LinkTarget=u,t.StatTimer=class{constructor(){this.started=Object.create(null),this.times=[]}time(e){e in this.started&&(0,n.warn)(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,n.warn)(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const e of this.times){const r=e.name;r.length>t&&(t=r.length)}for(const r of this.times){const n=r.end-r.start;e.push(`${r.name.padEnd(t)} ${n}ms\n`)}return e.join("")}},t.PDFDateString=class{static toDateObject(e){if(!e||!(0,n.isString)(e))return null;p||(p=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=p.exec(e);if(!t)return null;const r=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const l=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,"-"===l?(o+=u,a+=h):"+"===l&&(o-=u,a-=h),new Date(Date.UTC(r,i,s,o,a,c))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayByteLength=d,t.arraysToBytes=function(e){const t=e.length;if(1===t&&e[0]instanceof Uint8Array)return e[0];let r=0;for(let n=0;n<t;n++)r+=d(e[n]);let n=0;const i=new Uint8Array(r);for(let r=0;r<t;r++){let t=e[r];t instanceof Uint8Array||(t="string"==typeof t?h(t):new Uint8Array(t));const s=t.byteLength;i.set(t,n),n+=s}return i},t.assert=a,t.bytesToString=function(e){a(null!==e&&"object"==typeof e&&void 0!==e.length,"Invalid argument for bytesToString");const t=e.length,r=8192;if(t<r)return String.fromCharCode.apply(null,e);const n=[];for(let i=0;i<t;i+=r){const s=Math.min(i+r,t),o=e.subarray(i,s);n.push(String.fromCharCode.apply(null,o))}return n.join("")},t.createPromiseCapability=function(){const e=Object.create(null);let t=!1;return Object.defineProperty(e,"settled",{get:()=>t}),e.promise=new Promise((function(r,n){e.resolve=function(e){t=!0,r(e)},e.reject=function(e){t=!0,n(e)}})),e},t.escapeString=function(e){return e.replace(/([\(\)\\])/g,"\\$1")},t.getModificationDate=function(e=new Date(Date.now())){return[e.getUTCFullYear().toString(),(e.getUTCMonth()+1).toString().padStart(2,"0"),(e.getUTCDate()+1).toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")},t.getVerbosityLevel=function(){return i},t.info=function(e){i>=n.INFOS&&console.log(`Info: ${e}`)},t.isArrayBuffer=function(e){return"object"==typeof e&&null!==e&&void 0!==e.byteLength},t.isArrayEqual=function(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))},t.isBool=function(e){return"boolean"==typeof e},t.isNum=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSameOrigin=function(e,t){let r;try{if(r=new URL(e),!r.origin||"null"===r.origin)return!1}catch(e){return!1}const n=new URL(t,r);return r.origin===n.origin},t.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{const r=t?new URL(e,t):new URL(e);if(function(e){if(!e)return!1;switch(e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(r))return r}catch(e){}return null},t.removeNullCharacters=function(e){return"string"!=typeof e?(s("The argument for removeNullCharacters must be a string."),e):e.replace(u,"")},t.setVerbosityLevel=function(e){Number.isInteger(e)&&(i=e)},t.shadow=c,t.string32=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},t.stringToBytes=h,t.stringToPDFString=function(e){const t=e.length,r=[];if(""===e[0]&&""===e[1])for(let n=2;n<t;n+=2)r.push(String.fromCharCode(e.charCodeAt(n)<<8|e.charCodeAt(n+1)));else if(""===e[0]&&""===e[1])for(let n=2;n<t;n+=2)r.push(String.fromCharCode(e.charCodeAt(n+1)<<8|e.charCodeAt(n)));else for(let n=0;n<t;++n){const t=y[e.charCodeAt(n)];r.push(t?String.fromCharCode(t):e.charAt(n))}return r.join("")},t.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=s,t.unreachable=o,t.IsEvalSupportedCached=t.IsLittleEndianCached=t.createObjectURL=t.FormatError=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.TextRenderingMode=t.StreamType=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.MissingPDFException=t.InvalidPDFException=t.AbortException=t.CMapCompressionType=t.ImageKind=t.FontType=t.AnnotationType=t.AnnotationStateModelType=t.AnnotationReviewState=t.AnnotationReplyType=t.AnnotationMarkedState=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationBorderStyleType=t.UNSUPPORTED_FEATURES=t.VerbosityLevel=t.OPS=t.IDENTITY_MATRIX=t.FONT_IDENTITY_MATRIX=t.BaseException=void 0,r(3),t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.AnnotationStateModelType={MARKED:"Marked",REVIEW:"Review"},t.AnnotationMarkedState={MARKED:"Marked",UNMARKED:"Unmarked"},t.AnnotationReviewState={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"},t.AnnotationReplyType={GROUP:"Group",REPLY:"R"},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.StreamType={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"},t.FontType={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};const n={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=n,t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent"},t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let i=n.WARNINGS;function s(e){i>=n.WARNINGS&&console.log(`Warning: ${e}`)}function o(e){throw new Error(e)}function a(e,t){e||o(t)}function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!1}),r}const l=function(){function e(t){this.constructor===e&&o("Cannot initialize BaseException."),this.message=t,this.name=this.constructor.name}return e.prototype=new Error,e.constructor=e,e}();t.BaseException=l,t.PasswordException=class extends l{constructor(e,t){super(e),this.code=t}},t.UnknownErrorException=class extends l{constructor(e,t){super(e),this.details=t}},t.InvalidPDFException=class extends l{},t.MissingPDFException=class extends l{},t.UnexpectedResponseException=class extends l{constructor(e,t){super(e),this.status=t}},t.FormatError=class extends l{},t.AbortException=class extends l{};const u=/\x00/g;function h(e){a("string"==typeof e,"Invalid argument for stringToBytes");const t=e.length,r=new Uint8Array(t);for(let n=0;n<t;++n)r[n]=255&e.charCodeAt(n);return r}function d(e){return void 0!==e.length?e.length:(a(void 0!==e.byteLength,"arrayByteLength - invalid argument."),e.byteLength)}const p={get value(){return c(this,"value",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}};t.IsLittleEndianCached=p;const f={get value(){return c(this,"value",function(){try{return new Function(""),!0}catch(e){return!1}}())}};t.IsEvalSupportedCached=f;const g=["rgb(",0,",",0,",",0,")"];class m{static makeCssRgb(e,t,r){return g[1]=e,g[3]=t,g[5]=r,g.join("")}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){const r=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/r,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/r]}static getAxialAlignedBoundingBox(e,t){const r=m.applyTransform(e,t),n=m.applyTransform(e.slice(2,4),t),i=m.applyTransform([e[0],e[3]],t),s=m.applyTransform([e[2],e[1]],t);return[Math.min(r[0],n[0],i[0],s[0]),Math.min(r[1],n[1],i[1],s[1]),Math.max(r[0],n[0],i[0],s[0]),Math.max(r[1],n[1],i[1],s[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static apply3dTransform(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],r=e[0]*t[0]+e[1]*t[2],n=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],s=e[2]*t[1]+e[3]*t[3],o=(r+s)/2,a=Math.sqrt((r+s)*(r+s)-4*(r*s-i*n))/2,c=o+a||1,l=o-a||1;return[Math.sqrt(c),Math.sqrt(l)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){function r(e,t){return e-t}const n=[e[0],e[2],t[0],t[2]].sort(r),i=[e[1],e[3],t[1],t[3]].sort(r),s=[];return e=m.normalizeRect(e),t=m.normalizeRect(t),n[0]===e[0]&&n[1]===t[0]||n[0]===t[0]&&n[1]===e[0]?(s[0]=n[1],s[2]=n[2],i[0]===e[1]&&i[1]===t[1]||i[0]===t[1]&&i[1]===e[1]?(s[1]=i[1],s[3]=i[2],s):null):null}}t.Util=m;const y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],v=function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(t,r,n=!1){if(!n&&URL.createObjectURL){const e=new Blob([t],{type:r});return URL.createObjectURL(e)}let i=`data:${r};base64,`;for(let r=0,n=t.length;r<n;r+=3){const s=255&t[r],o=255&t[r+1],a=255&t[r+2];i+=e[s>>2]+e[(3&s)<<4|o>>4]+e[r+1<n?(15&o)<<2|a>>6:64]+e[r+2<n?63&a:64]}return i}}();t.createObjectURL=v},function(e,t,r){"use strict";r(4)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;const n=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type);t.isNodeJS=n},function(module,exports,__w_pdfjs_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.build=exports.version=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFWorker=exports.PDFDataRangeTransport=exports.LoopbackPort=void 0;var _util=__w_pdfjs_require__(2),_display_utils=__w_pdfjs_require__(1),_font_loader=__w_pdfjs_require__(6),_node_utils=__w_pdfjs_require__(7),_annotation_storage=__w_pdfjs_require__(8),_api_compatibility=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(10),_worker_options=__w_pdfjs_require__(12),_is_node=__w_pdfjs_require__(4),_message_handler=__w_pdfjs_require__(13),_metadata=__w_pdfjs_require__(14),_optional_content_config=__w_pdfjs_require__(16),_transport_stream=__w_pdfjs_require__(17),_webgl=__w_pdfjs_require__(18);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_is_node.isNodeJS?_node_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory,DefaultCMapReaderFactory=_is_node.isNodeJS?_node_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;let createPDFNetworkStream;function setPDFNetworkStreamFactory(e){createPDFNetworkStream=e}function getDocument(e){const t=new PDFDocumentLoadingTask;let r;if("string"==typeof e)r={url:e};else if((0,_util.isArrayBuffer)(e))r={data:e};else if(e instanceof PDFDataRangeTransport)r={range:e};else{if("object"!=typeof e)throw new Error("Invalid parameter in getDocument, need either Uint8Array, string or a parameter object");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");r=e}const n=Object.create(null);let i=null,s=null;for(const e in r)if("url"!==e||"undefined"==typeof window)if("range"!==e)if("worker"!==e)if("data"!==e||r[e]instanceof Uint8Array)n[e]=r[e];else{const t=r[e];if("string"==typeof t)n[e]=(0,_util.stringToBytes)(t);else if("object"!=typeof t||null===t||isNaN(t.length)){if(!(0,_util.isArrayBuffer)(t))throw new Error("Invalid PDF binary data: either typed array, string or array-like object is expected in the data property.");n[e]=new Uint8Array(t)}else n[e]=new Uint8Array(t)}else s=r[e];else i=r[e];else n[e]=new URL(r[e],window.location).href;if(n.rangeChunkSize=n.rangeChunkSize||DEFAULT_RANGE_CHUNK_SIZE,n.CMapReaderFactory=n.CMapReaderFactory||DefaultCMapReaderFactory,n.ignoreErrors=!0!==n.stopAtErrors,n.fontExtraProperties=!0===n.fontExtraProperties,n.pdfBug=!0===n.pdfBug,Number.isInteger(n.maxImageSize)||(n.maxImageSize=-1),"boolean"!=typeof n.isEvalSupported&&(n.isEvalSupported=!0),"boolean"!=typeof n.disableFontFace&&(n.disableFontFace=_api_compatibility.apiCompatibilityParams.disableFontFace||!1),void 0===n.ownerDocument&&(n.ownerDocument=globalThis.document),"boolean"!=typeof n.disableRange&&(n.disableRange=!1),"boolean"!=typeof n.disableStream&&(n.disableStream=!1),"boolean"!=typeof n.disableAutoFetch&&(n.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(n.verbosity),!s){const e={verbosity:n.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};s=e.port?PDFWorker.fromPort(e):new PDFWorker(e),t._worker=s}const o=t.docId;return s.promise.then((function(){if(t.destroyed)throw new Error("Loading aborted");const e=_fetchDocument(s,n,i,o),r=new Promise((function(e){let t;i?t=new _transport_stream.PDFDataTransportStream({length:n.length,initialData:n.initialData,progressiveDone:n.progressiveDone,disableRange:n.disableRange,disableStream:n.disableStream},i):n.data||(t=createPDFNetworkStream({url:n.url,length:n.length,httpHeaders:n.httpHeaders,withCredentials:n.withCredentials,rangeChunkSize:n.rangeChunkSize,disableRange:n.disableRange,disableStream:n.disableStream})),e(t)}));return Promise.all([e,r]).then((function([e,r]){if(t.destroyed)throw new Error("Loading aborted");const i=new _message_handler.MessageHandler(o,e,s.port);i.postMessageTransfers=s.postMessageTransfers;const a=new WorkerTransport(i,t,r,n);t._transport=a,i.send("Ready",null)}))})).catch(t._capability.reject),t}function _fetchDocument(e,t,r,n){return e.destroyed?Promise.reject(new Error("Worker was destroyed")):(r&&(t.length=r.length,t.initialData=r.initialData,t.progressiveDone=r.progressiveDone),e.messageHandler.sendWithPromise("GetDocRequest",{docId:n,apiVersion:"2.6.347",source:{data:t.data,url:t.url,password:t.password,disableAutoFetch:t.disableAutoFetch,rangeChunkSize:t.rangeChunkSize,length:t.length},maxImageSize:t.maxImageSize,disableFontFace:t.disableFontFace,postMessageTransfers:e.postMessageTransfers,docBaseUrl:t.docBaseUrl,ignoreErrors:t.ignoreErrors,isEvalSupported:t.isEvalSupported,fontExtraProperties:t.fontExtraProperties}).then((function(t){if(e.destroyed)throw new Error("Worker was destroyed");return t})))}const PDFDocumentLoadingTask=function(){let e=0;return class{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId="d"+e++,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}destroy(){return this.destroyed=!0,(this._transport?this._transport.destroy():Promise.resolve()).then((()=>{this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}))}}}();class PDFDataRangeTransport{constructor(e,t,r=!1){this.length=e,this.initialData=t,this.progressiveDone=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const r of this._rangeListeners)r(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(const r of this._progressListeners)r(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(const t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get numPages(){return this._pdfInfo.numPages}get fingerprint(){return this._pdfInfo.fingerprint}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}getStats(){return this._transport.getStats()}cleanup(){return this._transport.startCleanup()}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(e){return this._transport.saveDocument(e)}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,r,n,i=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=n,this._transport=r,this._stats=i?new _display_utils.StatTimer:null,this._pdfBug=i,this.commonObjs=r.commonObjs,this.objs=new PDFObjects,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:r=0,offsetY:n=0,dontFlip:i=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:r,offsetY:n,dontFlip:i})}getAnnotations({intent:e=null}={}){return this.annotationsPromise&&this.annotationsIntent===e||(this.annotationsPromise=this._transport.getAnnotations(this._pageIndex,e),this.annotationsIntent=e),this.annotationsPromise}render({canvasContext:e,viewport:t,intent:r="display",enableWebGL:n=!1,renderInteractiveForms:i=!1,transform:s=null,imageLayer:o=null,canvasFactory:a=null,background:c=null,annotationStorage:l=null,optionalContentConfigPromise:u=null}){this._stats&&this._stats.time("Overall");const h="print"===r?"print":"display";this.pendingCleanup=!1,u||(u=this._transport.getOptionalContentConfig());let d=this._intentStates.get(h);d||(d=Object.create(null),this._intentStates.set(h,d)),d.streamReaderCancelTimeout&&(clearTimeout(d.streamReaderCancelTimeout),d.streamReaderCancelTimeout=null);const p=a||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),f=new _webgl.WebGLContext({enable:n});d.displayReadyCapability||(d.displayReadyCapability=(0,_util.createPromiseCapability)(),d.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:h,renderInteractiveForms:!0===i,annotationStorage:l&&l.getAll()||null}));const g=e=>{const t=d.renderTasks.indexOf(m);t>=0&&d.renderTasks.splice(t,1),(this.cleanupAfterRender||"print"===h)&&(this.pendingCleanup=!0),this._tryCleanup(),e?(m.capability.reject(e),this._abortOperatorList({intentState:d,reason:e})):m.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},m=new InternalRenderTask({callback:g,params:{canvasContext:e,viewport:t,transform:s,imageLayer:o,background:c},objs:this.objs,commonObjs:this.commonObjs,operatorList:d.operatorList,pageIndex:this._pageIndex,canvasFactory:p,webGLContext:f,useRequestAnimationFrame:"print"!==h,pdfBug:this._pdfBug});d.renderTasks||(d.renderTasks=[]),d.renderTasks.push(m);const y=m.task;return Promise.all([d.displayReadyCapability.promise,u]).then((([e,t])=>{this.pendingCleanup?g():(this._stats&&this._stats.time("Rendering"),m.initializeGraphics({transparency:e,optionalContentConfig:t}),m.operatorListChanged())})).catch(g),y}getOperatorList(){const e="oplist";let t,r=this._intentStates.get(e);return r||(r=Object.create(null),this._intentStates.set(e,r)),r.opListReadCapability||(t=Object.create(null),t.operatorListChanged=function(){if(r.operatorList.lastChunk){r.opListReadCapability.resolve(r.operatorList);const e=r.renderTasks.indexOf(t);e>=0&&r.renderTasks.splice(e,1)}},r.opListReadCapability=(0,_util.createPromiseCapability)(),r.renderTasks=[],r.renderTasks.push(t),r.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:e})),r.opListReadCapability.promise}streamTextContent({normalizeWhitespace:e=!1,disableCombineTextItems:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,normalizeWhitespace:!0===e,combineTextItems:!0!==t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){const t=this.streamTextContent(e);return new Promise((function(e,r){const n=t.getReader(),i={items:[],styles:Object.create(null)};!function t(){n.read().then((function({value:r,done:n}){n?e(i):(Object.assign(i.styles,r.styles),i.items.push(...r.items),t())}),r)}()}))}_destroy(){this.destroyed=!0,this._transport.pageCache[this._pageIndex]=null;const e=[];for(const[t,r]of this._intentStates)if(this._abortOperatorList({intentState:r,reason:new Error("Page was destroyed."),force:!0}),"oplist"!==t)for(const t of r.renderTasks)e.push(t.completed),t.cancel();return this.objs.clear(),this.annotationsPromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(0!==e.length||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.annotationsPromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer),this.pendingCleanup=!1,!0}_startRenderPage(e,t){const r=this._intentStates.get(t);r&&(this._stats&&this._stats.timeEnd("Page Request"),r.displayReadyCapability&&r.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let r=0,n=e.length;r<n;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk;for(let e=0;e<t.renderTasks.length;e++)t.renderTasks[e].operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList(e){(0,_util.assert)(e.intent,'PDFPageProxy._pumpOperatorList: Expected "intent" argument.');const t=this._transport.messageHandler.sendWithStream("GetOperatorList",e).getReader(),r=this._intentStates.get(e.intent);r.streamReader=t;const n=()=>{t.read().then((({value:e,done:t})=>{t?r.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,r),n())}),(e=>{if(r.streamReader=null,!this._transport.destroyed){if(r.operatorList){r.operatorList.lastChunk=!0;for(let e=0;e<r.renderTasks.length;e++)r.renderTasks[e].operatorListChanged();this._tryCleanup()}if(r.displayReadyCapability)r.displayReadyCapability.reject(e);else{if(!r.opListReadCapability)throw e;r.opListReadCapability.reject(e)}}}))};n()}_abortOperatorList({intentState:e,reason:t,force:r=!1}){if((0,_util.assert)(t instanceof Error||"object"==typeof t&&null!==t,'PDFPageProxy._abortOperatorList: Expected "reason" argument.'),e.streamReader){if(!r){if(0!==e.renderTasks.length)return;if(t instanceof _display_utils.RenderingCancelledException)return void(e.streamReaderCancelTimeout=setTimeout((()=>{this._abortOperatorList({intentState:e,reason:t,force:!0}),e.streamReaderCancelTimeout=null}),RENDERING_CANCELLED_TIMEOUT))}if(e.streamReader.cancel(new _util.AbortException(t&&t.message)),e.streamReader=null,!this._transport.destroyed){for(const[t,r]of this._intentStates)if(r===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(e=!0){this._listeners=[],this._defer=e,this._deferred=Promise.resolve(void 0)}postMessage(e,t){if(!this._defer)return void this._listeners.forEach((t=>{t.call(this,{data:e})}));const r=new WeakMap,n={data:function e(n){if("object"!=typeof n||null===n)return n;if(r.has(n))return r.get(n);let i,s;if((i=n.buffer)&&(0,_util.isArrayBuffer)(i))return s=t&&t.includes(i)?new n.constructor(i,n.byteOffset,n.byteLength):new n.constructor(n),r.set(n,s),s;s=Array.isArray(n)?[]:{},r.set(n,s);for(const t in n){let r,i=n;for(;!(r=Object.getOwnPropertyDescriptor(i,t));)i=Object.getPrototypeOf(i);if(void 0!==r.value)if("function"!=typeof r.value)s[t]=e(r.value);else if(n.hasOwnProperty&&n.hasOwnProperty(t))throw new Error(`LoopbackPort.postMessage - cannot clone: ${n[t]}`)}return s}(e)};this._deferred.then((()=>{this._listeners.forEach((e=>{e.call(this,n)}))}))}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){const r=this._listeners.indexOf(t);this._listeners.splice(r,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorker=function PDFWorkerClosure(){const pdfWorkerPorts=new WeakMap;let isWorkerDisabled=!1,fallbackWorkerSrc,nextFakeWorkerId=0,fakeWorkerCapability;if(_is_node.isNodeJS)isWorkerDisabled=!0,fallbackWorkerSrc="./pdf.worker.js";else if("object"==typeof document&&"currentScript"in document){const e=document.currentScript&&document.currentScript.src;e&&(fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}function getWorkerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(void 0!==fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}function getMainThreadWorkerMessageHandler(){let e;try{e=globalThis.pdfjsWorker&&globalThis.pdfjsWorker.WorkerMessageHandler}catch(e){}return e||null}function setupFakeWorkerGlobal(){if(fakeWorkerCapability)return fakeWorkerCapability.promise;fakeWorkerCapability=(0,_util.createPromiseCapability)();const loader=async function(){const mainWorkerMessageHandler=getMainThreadWorkerMessageHandler();if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS){const worker=eval("require")(getWorkerSrc());return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(getWorkerSrc()),window.pdfjsWorker.WorkerMessageHandler};return loader().then(fakeWorkerCapability.resolve,fakeWorkerCapability.reject),fakeWorkerCapability.promise}function createCDNWrapper(e){const t="importScripts('"+e+"');";return URL.createObjectURL(new Blob([t]))}class PDFWorker{constructor({name:e=null,port:t=null,verbosity:r=(0,_util.getVerbosityLevel)()}={}){if(t&&pdfWorkerPorts.has(t))throw new Error("Cannot use more than one PDFWorker per port");if(this.name=e,this.destroyed=!1,this.postMessageTransfers=!0,this.verbosity=r,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,t)return pdfWorkerPorts.set(t,this),void this._initializeFromPort(t);this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve()}_initialize(){if("undefined"!=typeof Worker&&!isWorkerDisabled&&!getMainThreadWorkerMessageHandler()){let e=getWorkerSrc();try{(0,_util.isSameOrigin)(window.location.href,e)||(e=createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e),r=new _message_handler.MessageHandler("main","worker",t),n=()=>{t.removeEventListener("error",i),r.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=()=>{this._webWorker||n()};t.addEventListener("error",i),r.on("test",(e=>{t.removeEventListener("error",i),this.destroyed?n():e?(this._messageHandler=r,this._port=t,this._webWorker=t,e.supportTransfers||(this.postMessageTransfers=!1),this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),r.destroy(),t.terminate())})),r.on("ready",(e=>{if(t.removeEventListener("error",i),this.destroyed)n();else try{s()}catch(e){this._setupFakeWorker()}}));const s=()=>{const e=new Uint8Array([this.postMessageTransfers?255:0]);try{r.send("test",e,[e.buffer])}catch(t){(0,_util.warn)("Cannot use postMessage transfers."),e[0]=0,r.send("test",e)}};return void s()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),isWorkerDisabled=!0),setupFakeWorkerGlobal().then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new LoopbackPort;this._port=t;const r="fake"+nextFakeWorkerId++,n=new _message_handler.MessageHandler(r+"_worker",r,t);e.setup(n,t);const i=new _message_handler.MessageHandler(r,r+"_worker",t);this._messageHandler=i,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})})).catch((e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),pdfWorkerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(!e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return pdfWorkerPorts.has(e.port)?pdfWorkerPorts.get(e.port):new PDFWorker(e)}static getWorkerSrc(){return getWorkerSrc()}}return PDFWorker}();exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(e,t,r,n){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:n.ownerDocument}),this._params=n,this.CMapReaderFactory=new n.CMapReaderFactory({baseUrl:n.cMapUrl,isCompressed:n.cMapPacked}),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.pageCache=[],this.pagePromises=[],this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];this.pageCache.forEach((function(t){t&&e.push(t._destroy())})),this.pageCache.length=0,this.pagePromises.length=0;const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.fontLoader.clear(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function({value:e,done:r}){r?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{const r=(0,_util.createPromiseCapability)(),n=this._fullReader;return n.headersReady.then((()=>{n.isStreamingSupported&&n.isRangeSupported||(this._lastProgress&&t.onProgress&&t.onProgress(this._lastProgress),n.onProgress=e=>{t.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})}),r.resolve({isStreamingSupported:n.isStreamingSupported,isRangeSupported:n.isRangeSupported,contentLength:n.contentLength})}),r.reject),r.promise})),e.on("GetRangeReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(e.begin,e.end);r?(t.onPull=()=>{r.read().then((function({value:e,done:r}){r?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{r.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(({pdfInfo:e})=>{this._numPages=e.numPages,t._capability.resolve(new PDFDocumentProxy(e,this))})),e.on("DocException",(function(e){let r;switch(e.name){case"PasswordException":r=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":r=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":r=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":r=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":r=new _util.UnknownErrorException(e.message,e.details)}if(!(r instanceof Error)){const e="DocException - expected a valid Error.";(0,_util.warn)(e)}t._capability.reject(r)})),e.on("PasswordRequest",(e=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){const r=e=>{this._passwordCapability.resolve({password:e})};try{t.onPassword(r,e.code)}catch(e){this._passwordCapability.reject(e)}}else this._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return this._passwordCapability.promise})),e.on("DataLoaded",(e=>{t.onProgress&&t.onProgress({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{this.destroyed||this.pageCache[e.pageIndex]._startRenderPage(e.transparency,e.intent)})),e.on("commonobj",(t=>{if(this.destroyed)return;const[r,n,i]=t;if(!this.commonObjs.has(r))switch(n){case"Font":const t=this._params;if("error"in i){const e=i.error;(0,_util.warn)(`Error during font loading: ${e}`),this.commonObjs.resolve(r,e);break}let s=null;t.pdfBug&&globalThis.FontInspector&&globalThis.FontInspector.enabled&&(s={registerFont(e,t){globalThis.FontInspector.fontAdded(e,t)}});const o=new _font_loader.FontFaceObject(i,{isEvalSupported:t.isEvalSupported,disableFontFace:t.disableFontFace,ignoreErrors:t.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:s});this.fontLoader.bind(o).catch((t=>e.sendWithPromise("FontFallback",{id:r}))).finally((()=>{!t.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(r,o)}));break;case"FontPath":case"Image":this.commonObjs.resolve(r,i);break;default:throw new Error(`Got unknown common object type ${n}`)}})),e.on("obj",(e=>{if(this.destroyed)return;const[t,r,n,i]=e,s=this.pageCache[r];if(!s.objs.has(t))switch(n){case"Image":s.objs.resolve(t,i);const e=8e6;i&&"data"in i&&i.data.length>e&&(s.cleanupAfterRender=!0);break;default:throw new Error(`Got unknown object type ${n}`)}})),e.on("DocProgress",(e=>{this.destroyed||t.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})})),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",((e,t)=>{if(this.destroyed)return void t.error(new Error("Worker was destroyed"));let r=!1;t.onPull=()=>{r?t.close():(r=!0,this.CMapReaderFactory.fetch(e).then((function(e){t.enqueue(e,1,[e.cMapData.buffer])})).catch((function(e){t.error(e)})))}}))}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature&&this.loadingTask.onUnsupportedFeature(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request"));const t=e-1;if(t in this.pagePromises)return this.pagePromises[t];const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((e=>{if(this.destroyed)throw new Error("Transport destroyed");const r=new PDFPageProxy(t,e,this,this._params.ownerDocument,this._params.pdfBug);return this.pageCache[t]=r,r}));return this.pagePromises[t]=r,r}getPageIndex(e){return this.messageHandler.sendWithPromise("GetPageIndex",{ref:e}).catch((function(e){return Promise.reject(new Error(e))}))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(e){return this.messageHandler.sendWithPromise("SaveDocument",{numPages:this._numPages,annotationStorage:e&&e.getAll()||null,filename:this._fullReader?this._fullReader.filename:null}).finally((()=>{e&&e.resetModified()}))}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then((e=>new _optional_content_config.OptionalContentConfig(e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.messageHandler.sendWithPromise("GetMetadata",null).then((e=>({info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:this._fullReader?this._fullReader.filename:null})))}getStats(){return this.messageHandler.sendWithPromise("GetStats",null)}startCleanup(){return this.messageHandler.sendWithPromise("Cleanup",null).then((()=>{for(let e=0,t=this.pageCache.length;e<t;e++){const t=this.pageCache[e];if(t&&!t.cleanup())throw new Error(`startCleanup: Page ${e+1} is currently rendering.`)}this.commonObjs.clear(),this.fontLoader.clear()}))}get loadingParams(){const e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,disableFontFace:e.disableFontFace})}}class PDFObjects{constructor(){this._objs=Object.create(null)}_ensureObj(e){return this._objs[e]?this._objs[e]:this._objs[e]={capability:(0,_util.createPromiseCapability)(),data:null,resolved:!1}}get(e,t=null){if(t)return this._ensureObj(e).capability.promise.then(t),null;const r=this._objs[e];if(!r||!r.resolved)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){const t=this._objs[e];return!!t&&t.resolved}resolve(e,t){const r=this._ensureObj(e);r.resolved=!0,r.data=t,r.capability.resolve(t)}clear(){this._objs=Object.create(null)}}class RenderTask{constructor(e){this._internalRenderTask=e,this.onContinue=null}get promise(){return this._internalRenderTask.capability.promise}cancel(){this._internalRenderTask.cancel()}}const InternalRenderTask=function(){const e=new WeakSet;return class{constructor({callback:e,params:t,objs:r,commonObjs:n,operatorList:i,pageIndex:s,canvasFactory:o,webGLContext:a,useRequestAnimationFrame:c=!1,pdfBug:l=!1}){this.callback=e,this.params=t,this.objs=r,this.commonObjs=n,this.operatorListIdx=null,this.operatorList=i,this._pageIndex=s,this.canvasFactory=o,this.webGLContext=a,this._pdfBug=l,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===c&&"undefined"!=typeof window,this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:t=!1,optionalContentConfig:r}){if(this.cancelled)return;if(this._canvas){if(e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager&&globalThis.StepperManager.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:i,transform:s,imageLayer:o,background:a}=this.params;this.gfx=new _canvas.CanvasGraphics(n,this.commonObjs,this.objs,this.canvasFactory,this.webGLContext,o,r),this.gfx.beginDrawing({transform:s,viewport:i,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(t=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&e.delete(this._canvas),this.callback(t||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){this.graphicsReady?(this.stepper&&this.stepper.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this.cancel.bind(this))})):Promise.resolve().then(this._nextBound).catch(this.cancel.bind(this))}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&e.delete(this._canvas),this.callback())))}}}(),version="2.6.347";exports.version=version;const build="3be9c65f";exports.build=build},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var n=r(2);class i{constructor({docId:e,onUnsupportedFeature:t,ownerDocument:r=globalThis.document}){this.constructor===i&&(0,n.unreachable)("Cannot initialize BaseFontLoader."),this.docId=e,this._onUnsupportedFeature=t,this._document=r,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(e){this.nativeFontFaces.push(e),this._document.fonts.add(e)}insertRule(e){let t=this.styleElement;t||(t=this.styleElement=this._document.createElement("style"),t.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].appendChild(t));const r=t.sheet;r.insertRule(e,r.cssRules.length)}clear(){this.nativeFontFaces.forEach((e=>{this._document.fonts.delete(e)})),this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(e){if(e.attached||e.missingFile)return;if(e.attached=!0,this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(r){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)(`Failed to load font '${t.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise((r=>{const n=this._queueLoadingCallback(r);this._prepareFontLoadEvent([t],[e],n)}))}}_queueLoadingCallback(e){(0,n.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){const e=void 0!==this._document&&!!this._document.fonts;return(0,n.shadow)(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){(0,n.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,n.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(e,t,r){(0,n.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let s;t.FontLoader=s,t.FontLoader=s=class extends i{constructor(e){super(e),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let e=!1;if("undefined"==typeof navigator)e=!0;else{const t=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);t&&t[1]>=14&&(e=!0)}return(0,n.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){const t=this.loadingContext,r={id:"pdfjs-font-loading-"+t.nextRequestId++,done:!1,complete:function(){for((0,n.assert)(!r.done,"completeRequest() cannot be called twice."),r.done=!0;t.requests.length>0&&t.requests[0].done;){const e=t.requests.shift();setTimeout(e.callback,0)}},callback:e};return t.requests.push(r),r}get _loadTestFont(){return(0,n.shadow)(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t,r){function i(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function s(e,t,r,n){return e.substring(0,t)+n+e.substring(t+r)}let o,a;const c=this._document.createElement("canvas");c.width=1,c.height=1;const l=c.getContext("2d");let u=0;const h=`lt${Date.now()}${this.loadTestFontId++}`;let d=this._loadTestFont;d=s(d,976,h.length,h);const p=1482184792;let f=i(d,16);for(o=0,a=h.length-3;o<a;o+=4)f=f-p+i(h,o)|0;o<h.length&&(f=f-p+i(h+"XXX",o)|0),d=s(d,16,4,(0,n.string32)(f));const g=`@font-face {font-family:"${h}";src:url(data:font/opentype;base64,${btoa(d)});}`;this.insertRule(g);const m=[];for(o=0,a=t.length;o<a;o++)m.push(t[o].loadedName);m.push(h);const y=this._document.createElement("div");for(y.style.visibility="hidden",y.style.width=y.style.height="10px",y.style.position="absolute",y.style.top=y.style.left="0px",o=0,a=m.length;o<a;++o){const e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=m[o],y.appendChild(e)}this._document.body.appendChild(y),function e(t,r){if(u++,u>30)return(0,n.warn)("Load test font never loaded."),void r();l.font="30px "+t,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?r():setTimeout(e.bind(null,t,r))}(h,(()=>{this._document.body.removeChild(y),r.complete()}))}},t.FontFaceObject=class{constructor(e,{isEvalSupported:t=!0,disableFontFace:r=!1,ignoreErrors:n=!1,onUnsupportedFeature:i=null,fontRegistry:s=null}){this.compiledGlyphs=Object.create(null);for(const t in e)this[t]=e[t];this.isEvalSupported=!1!==t,this.disableFontFace=!0===r,this.ignoreErrors=!0===n,this._onUnsupportedFeature=i,this.fontRegistry=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;const e=new FontFace(this.loadedName,this.data,{});return this.fontRegistry&&this.fontRegistry.registerFont(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=(0,n.bytesToString)(new Uint8Array(this.data)),t=`url(data:${this.mimetype};base64,${btoa(e)});`,r=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this.fontRegistry&&this.fontRegistry.registerFont(this,t),r}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let r,i;try{r=e.get(this.loadedName+"_path_"+t)}catch(e){if(!this.ignoreErrors)throw e;return this._onUnsupportedFeature&&this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)(`getPathGenerator - ignoring character: "${e}".`),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&n.IsEvalSupportedCached.value){let e,n="";for(let t=0,s=r.length;t<s;t++)i=r[t],e=void 0!==i.args?i.args.join(","):"",n+="c."+i.cmd+"("+e+");\n";return this.compiledGlyphs[t]=new Function("c","size",n)}return this.compiledGlyphs[t]=function(e,t){for(let n=0,s=r.length;n<s;n++)i=r[n],"scale"===i.cmd&&(i.args=[t,-t]),e[i.cmd].apply(e,i.args)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeCMapReaderFactory=t.NodeCanvasFactory=void 0;var n=r(1),i=r(4),s=r(2);let o=class{constructor(){(0,s.unreachable)("Not implemented: NodeCanvasFactory")}};t.NodeCanvasFactory=o;let a=class{constructor(){(0,s.unreachable)("Not implemented: NodeCMapReaderFactory")}};t.NodeCMapReaderFactory=a,i.isNodeJS&&(t.NodeCanvasFactory=o=class extends n.BaseCanvasFactory{create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const r=__webpack_require__(3414).createCanvas(e,t);return{canvas:r,context:r.getContext("2d")}}},t.NodeCMapReaderFactory=a=class extends n.BaseCMapReaderFactory{_fetchData(e,t){return new Promise(((r,n)=>{__webpack_require__(172).readFile(e,((e,i)=>{!e&&i?r({cMapData:new Uint8Array(i),compressionType:t}):n(new Error(e))}))}))}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationStorage=void 0,t.AnnotationStorage=class{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null}getOrCreateValue(e,t){return this._storage.has(e)?this._storage.get(e):(this._storage.set(e,t),t)}setValue(e,t){this._storage.get(e)!==t&&this._setModified(),this._storage.set(e,t)}getAll(){return 0===this._storage.size?null:Object.fromEntries(this._storage)}get size(){return this._storage.size}_setModified(){this._modified||(this._modified=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,"function"==typeof this.onResetModified&&this.onResetModified())}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiCompatibilityParams=void 0;var n=r(4);const i=Object.create(null);n.isNodeJS&&(i.disableFontFace=!0);const s=Object.freeze(i);t.apiCompatibilityParams=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var n=r(2),i=r(11),s=4096,o=.65,a=16;function c(e){e.mozCurrentTransform||(e._originalSave=e.save,e._originalRestore=e.restore,e._originalRotate=e.rotate,e._originalScale=e.scale,e._originalTranslate=e.translate,e._originalTransform=e.transform,e._originalSetTransform=e.setTransform,e._transformMatrix=e._transformMatrix||[1,0,0,1,0,0],e._transformStack=[],Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){var e=this._transformMatrix,t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],o=e[5],a=t*i-r*n,c=r*n-t*i;return[i/a,r/c,n/c,t/a,(i*s-n*o)/c,(r*s-t*o)/a]}}),e.save=function(){var e=this._transformMatrix;this._transformStack.push(e),this._transformMatrix=e.slice(0,6),this._originalSave()},e.restore=function(){var e=this._transformStack.pop();e&&(this._transformMatrix=e,this._originalRestore())},e.translate=function(e,t){var r=this._transformMatrix;r[4]=r[0]*e+r[2]*t+r[4],r[5]=r[1]*e+r[3]*t+r[5],this._originalTranslate(e,t)},e.scale=function(e,t){var r=this._transformMatrix;r[0]=r[0]*e,r[1]=r[1]*e,r[2]=r[2]*t,r[3]=r[3]*t,this._originalScale(e,t)},e.transform=function(t,r,n,i,s,o){var a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*r,a[1]*t+a[3]*r,a[0]*n+a[2]*i,a[1]*n+a[3]*i,a[0]*s+a[2]*o+a[4],a[1]*s+a[3]*o+a[5]],e._originalTransform(t,r,n,i,s,o)},e.setTransform=function(t,r,n,i,s,o){this._transformMatrix=[t,r,n,i,s,o],e._originalSetTransform(t,r,n,i,s,o)},e.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),n=this._transformMatrix;this._transformMatrix=[n[0]*t+n[2]*r,n[1]*t+n[3]*r,n[0]*-r+n[2]*t,n[1]*-r+n[3]*t,n[4],n[5]],this._originalRotate(e)})}var l=function(){function e(e){this.canvasFactory=e,this.cache=Object.create(null)}return e.prototype={getCanvas:function(e,t,r,n){var i;return void 0!==this.cache[e]?(i=this.cache[e],this.canvasFactory.reset(i,t,r),i.context.setTransform(1,0,0,1,0,0)):(i=this.canvasFactory.create(t,r),this.cache[e]=i),n&&c(i.context),i},clear(){for(var e in this.cache){var t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}},e}(),u=function(){function e(){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.resumeSMaskCtx=null,this.transferMaps=null}return e.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(e,t){this.x=e,this.y=t}},e}(),h=function(){function e(e,t,r,n,i,s,o){this.ctx=e,this.current=new u,this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=r,this.canvasFactory=n,this.webGLContext=i,this.imageLayer=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=o,this.cachedCanvases=new l(this.canvasFactory),e&&c(e),this._cachedGetSinglePixelWidth=null}function t(e,t,r=null){if("undefined"!=typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);var i,s,o,c,l,u=t.height,h=t.width,d=u%a,p=(u-d)/a,f=0===d?p:p+1,g=e.createImageData(h,a),m=0,y=t.data,v=g.data;let _,b,w,S;if(r)switch(r.length){case 1:_=r[0],b=r[0],w=r[0],S=r[0];break;case 4:_=r[0],b=r[1],w=r[2],S=r[3]}if(t.kind===n.ImageKind.GRAYSCALE_1BPP){var k=y.byteLength,E=new Uint32Array(v.buffer,0,v.byteLength>>2),x=E.length,A=h+7>>3,T=4294967295,C=n.IsLittleEndianCached.value?4278190080:255;for(S&&255===S[0]&&0===S[255]&&([T,C]=[C,T]),s=0;s<f;s++){for(c=s<p?a:d,i=0,o=0;o<c;o++){var I=k-m;let e=0;for(var R=I>A?h:8*I-7,O=-8&R,P=0,D=0;e<O;e+=8)D=y[m++],E[i++]=128&D?T:C,E[i++]=64&D?T:C,E[i++]=32&D?T:C,E[i++]=16&D?T:C,E[i++]=8&D?T:C,E[i++]=4&D?T:C,E[i++]=2&D?T:C,E[i++]=1&D?T:C;for(;e<R;e++)0===P&&(D=y[m++],P=128),E[i++]=D&P?T:C,P>>=1}for(;i<x;)E[i++]=0;e.putImageData(g,0,s*a)}}else if(t.kind===n.ImageKind.RGBA_32BPP){const t=!!(_||b||w);for(o=0,l=h*a*4,s=0;s<p;s++){if(v.set(y.subarray(m,m+l)),m+=l,t)for(let e=0;e<l;e+=4)_&&(v[e+0]=_[v[e+0]]),b&&(v[e+1]=b[v[e+1]]),w&&(v[e+2]=w[v[e+2]]);e.putImageData(g,0,o),o+=a}if(s<f){if(l=h*d*4,v.set(y.subarray(m,m+l)),t)for(let e=0;e<l;e+=4)_&&(v[e+0]=_[v[e+0]]),b&&(v[e+1]=b[v[e+1]]),w&&(v[e+2]=w[v[e+2]]);e.putImageData(g,0,o)}}else{if(t.kind!==n.ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);{const t=!!(_||b||w);for(l=h*(c=a),s=0;s<f;s++){for(s>=p&&(l=h*(c=d)),i=0,o=l;o--;)v[i++]=y[m++],v[i++]=y[m++],v[i++]=y[m++],v[i++]=255;if(t)for(let e=0;e<i;e+=4)_&&(v[e+0]=_[v[e+0]]),b&&(v[e+1]=b[v[e+1]]),w&&(v[e+2]=w[v[e+2]]);e.putImageData(g,0,s*a)}}}}function r(e,t){for(var r=t.height,n=t.width,i=r%a,s=(r-i)/a,o=0===i?s:s+1,c=e.createImageData(n,a),l=0,u=t.data,h=c.data,d=0;d<o;d++){for(var p=d<s?a:i,f=3,g=0;g<p;g++)for(var m=0,y=0;y<n;y++){if(!m){var v=u[l++];m=128}h[f]=v&m?0:255,f+=4,m>>=1}e.putImageData(c,0,d*a)}}function h(e,t){for(var r=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"],n=0,i=r.length;n<i;n++){var s=r[n];void 0!==e[s]&&(t[s]=e[s])}void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function d(e){e.strokeStyle="#000000",e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0)}function p(e,t,r,n){for(var i=e.length,s=3;s<i;s+=4){var o=e[s];if(0===o)e[s-3]=t,e[s-2]=r,e[s-1]=n;else if(o<255){var a=255-o;e[s-3]=e[s-3]*o+t*a>>8,e[s-2]=e[s-2]*o+r*a>>8,e[s-1]=e[s-1]*o+n*a>>8}}}function f(e,t,r){for(var n=e.length,i=3;i<n;i+=4){var s=r?r[e[i]]:e[i];t[i]=t[i]*s*.00392156862745098|0}}function g(e,t,r){for(var n=e.length,i=3;i<n;i+=4){var s=77*e[i-3]+152*e[i-2]+28*e[i-1];t[i]=r?t[i]*r[s>>8]>>8:t[i]*s>>16}}function m(e,t,r,n){var i=t.canvas,s=t.context;e.setTransform(t.scaleX,0,0,t.scaleY,t.offsetX,t.offsetY);var o=t.backdrop||null;if(!t.transferMap&&n.isEnabled){const s=n.composeSMask({layer:r.canvas,mask:i,properties:{subtype:t.subtype,backdrop:o}});return e.setTransform(1,0,0,1,0,0),void e.drawImage(s,t.offsetX,t.offsetY)}!function(e,t,r,n,i,s,o){var a,c=!!s,l=c?s[0]:0,u=c?s[1]:0,h=c?s[2]:0;a="Luminosity"===i?g:f;for(var d=Math.min(n,Math.ceil(1048576/r)),m=0;m<n;m+=d){var y=Math.min(d,n-m),v=e.getImageData(0,m,r,y),_=t.getImageData(0,m,r,y);c&&p(v.data,l,u,h),a(v.data,_.data,o),e.putImageData(_,0,m)}}(s,r,i.width,i.height,t.subtype,o,t.transferMap),e.drawImage(i,0,0)}var y=["butt","round","square"],v=["miter","round","bevel"],_={},b={};for(var w in e.prototype={beginDrawing({transform:e,viewport:t,transparency:r=!1,background:n=null}){var i=this.ctx.canvas.width,s=this.ctx.canvas.height;if(this.ctx.save(),this.ctx.fillStyle=n||"rgb(255, 255, 255)",this.ctx.fillRect(0,0,i,s),this.ctx.restore(),r){var o=this.cachedCanvases.getCanvas("transparent",i,s,!0);this.compositeCtx=this.ctx,this.transparentCanvas=o.canvas,this.ctx=o.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform)}this.ctx.save(),d(this.ctx),e&&this.ctx.transform.apply(this.ctx,e),this.ctx.transform.apply(this.ctx,t.transform),this.baseTransform=this.ctx.mozCurrentTransform.slice(),this.imageLayer&&this.imageLayer.beginLayout()},executeOperatorList:function(e,t,r,i){var s=e.argsArray,o=e.fnArray,a=t||0,c=s.length;if(c===a)return a;for(var l,u=c-a>10&&"function"==typeof r,h=u?Date.now()+15:0,d=0,p=this.commonObjs,f=this.objs;;){if(void 0!==i&&a===i.nextBreakPoint)return i.breakIt(a,r),a;if((l=o[a])!==n.OPS.dependency)this[l].apply(this,s[a]);else for(const e of s[a]){const t=e.startsWith("g_")?p:f;if(!t.has(e))return t.get(e,r),a}if(++a===c)return a;if(u&&++d>10){if(Date.now()>h)return r(),a;d=0}}},endDrawing:function(){null!==this.current.activeSMask&&this.endSMaskGroup(),this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null),this.cachedCanvases.clear(),this.webGLContext.clear(),this.imageLayer&&this.imageLayer.endLayout()},setLineWidth:function(e){this.current.lineWidth=e,this.ctx.lineWidth=e},setLineCap:function(e){this.ctx.lineCap=y[e]},setLineJoin:function(e){this.ctx.lineJoin=v[e]},setMiterLimit:function(e){this.ctx.miterLimit=e},setDash:function(e,t){var r=this.ctx;void 0!==r.setLineDash&&(r.setLineDash(e),r.lineDashOffset=t)},setRenderingIntent(e){},setFlatness(e){},setGState:function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t],i=n[0],s=n[1];switch(i){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=n[1];break;case"ca":this.current.fillAlpha=n[1],this.ctx.globalAlpha=n[1];break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask&&(this.stateStack.length>0&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask?this.suspendSMaskGroup():this.endSMaskGroup()),this.current.activeSMask=s?this.tempSMask:null,this.current.activeSMask&&this.beginSMaskGroup(),this.tempSMask=null;break;case"TR":this.current.transferMaps=s}}},beginSMaskGroup:function(){var e=this.current.activeSMask,t=e.canvas.width,r=e.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,t,r,!0),s=this.ctx,o=s.mozCurrentTransform;this.ctx.save();var a=i.context;a.scale(1/e.scaleX,1/e.scaleY),a.translate(-e.offsetX,-e.offsetY),a.transform.apply(a,o),e.startTransformInverse=a.mozCurrentTransformInverse,h(s,a),this.ctx=a,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++},suspendSMaskGroup:function(){var e=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),m(this.ctx,this.current.activeSMask,e,this.webGLContext),this.ctx.restore(),this.ctx.save(),h(e,this.ctx),this.current.resumeSMaskCtx=e;var t=n.Util.transform(this.current.activeSMask.startTransformInverse,e.mozCurrentTransform);this.ctx.transform.apply(this.ctx,t),e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()},resumeSMaskGroup:function(){var e=this.current.resumeSMaskCtx,t=this.ctx;this.ctx=e,this.groupStack.push(t),this.groupLevel++},endSMaskGroup:function(){var e=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),m(this.ctx,this.current.activeSMask,e,this.webGLContext),this.ctx.restore(),h(e,this.ctx);var t=n.Util.transform(this.current.activeSMask.startTransformInverse,e.mozCurrentTransform);this.ctx.transform.apply(this.ctx,t)},save:function(){this.ctx.save();var e=this.current;this.stateStack.push(e),this.current=e.clone(),this.current.resumeSMaskCtx=null},restore:function(){this.current.resumeSMaskCtx&&this.resumeSMaskGroup(),null===this.current.activeSMask||0!==this.stateStack.length&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask||this.endSMaskGroup(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.ctx.restore(),this.pendingClip=null,this._cachedGetSinglePixelWidth=null)},transform:function(e,t,r,n,i,s){this.ctx.transform(e,t,r,n,i,s),this._cachedGetSinglePixelWidth=null},constructPath:function(e,t){for(var r=this.ctx,i=this.current,s=i.x,o=i.y,a=0,c=0,l=e.length;a<l;a++)switch(0|e[a]){case n.OPS.rectangle:s=t[c++],o=t[c++];var u=t[c++],h=t[c++];0===u&&r.lineWidth<this.getSinglePixelWidth()&&(u=this.getSinglePixelWidth()),0===h&&r.lineWidth<this.getSinglePixelWidth()&&(h=this.getSinglePixelWidth());var d=s+u,p=o+h;r.moveTo(s,o),r.lineTo(d,o),r.lineTo(d,p),r.lineTo(s,p),r.lineTo(s,o),r.closePath();break;case n.OPS.moveTo:s=t[c++],o=t[c++],r.moveTo(s,o);break;case n.OPS.lineTo:s=t[c++],o=t[c++],r.lineTo(s,o);break;case n.OPS.curveTo:s=t[c+4],o=t[c+5],r.bezierCurveTo(t[c],t[c+1],t[c+2],t[c+3],s,o),c+=6;break;case n.OPS.curveTo2:r.bezierCurveTo(s,o,t[c],t[c+1],t[c+2],t[c+3]),s=t[c+2],o=t[c+3],c+=4;break;case n.OPS.curveTo3:s=t[c+2],o=t[c+3],r.bezierCurveTo(t[c],t[c+1],s,o,s,o),c+=4;break;case n.OPS.closePath:r.closePath()}i.setCurrentPoint(s,o)},closePath:function(){this.ctx.closePath()},stroke:function(e){e=void 0===e||e;var t=this.ctx,r=this.current.strokeColor;if(t.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(r&&r.hasOwnProperty("type")&&"Pattern"===r.type){t.save();const e=t.mozCurrentTransform,i=n.Util.singularValueDecompose2dScale(e)[0];t.strokeStyle=r.getPattern(t,this),t.lineWidth=Math.max(this.getSinglePixelWidth()*o,this.current.lineWidth*i),t.stroke(),t.restore()}else t.lineWidth=Math.max(this.getSinglePixelWidth()*o,this.current.lineWidth),t.stroke();e&&this.consumePath(),t.globalAlpha=this.current.fillAlpha},closeStroke:function(){this.closePath(),this.stroke()},fill:function(e){e=void 0===e||e;var t=this.ctx,r=this.current.fillColor,n=!1;this.current.patternFill&&(t.save(),this.baseTransform&&t.setTransform.apply(t,this.baseTransform),t.fillStyle=r.getPattern(t,this),n=!0),this.contentVisible&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),n&&t.restore(),e&&this.consumePath()},eoFill:function(){this.pendingEOFill=!0,this.fill()},fillStroke:function(){this.fill(!1),this.stroke(!1),this.consumePath()},eoFillStroke:function(){this.pendingEOFill=!0,this.fillStroke()},closeFillStroke:function(){this.closePath(),this.fillStroke()},closeEOFillStroke:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()},endPath:function(){this.consumePath()},clip:function(){this.pendingClip=_},eoClip:function(){this.pendingClip=b},beginText:function(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},endText:function(){var e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(var r=0;r<e.length;r++){var n=e[r];t.setTransform.apply(t,n.transform),t.translate(n.x,n.y),n.addToPath(t,n.fontSize)}t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()},setCharSpacing:function(e){this.current.charSpacing=e},setWordSpacing:function(e){this.current.wordSpacing=e},setHScale:function(e){this.current.textHScale=e/100},setLeading:function(e){this.current.leading=-e},setFont:function(e,t){var r=this.commonObjs.get(e),i=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=r.fontMatrix?r.fontMatrix:n.FONT_IDENTITY_MATRIX,0!==i.fontMatrix[0]&&0!==i.fontMatrix[3]||(0,n.warn)("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=t,r.isType3Font)return;var s=r.loadedName||"sans-serif";let o="normal";r.black?o="900":r.bold&&(o="bold");var a=r.italic?"italic":"normal",c=`"${s}", ${r.fallbackName}`;let l=t;t<16?l=16:t>100&&(l=100),this.current.fontSizeScale=t/l,this.ctx.font=`${a} ${o} ${l}px ${c}`},setTextRenderingMode:function(e){this.current.textRenderingMode=e},setTextRise:function(e){this.current.textRise=e},moveText:function(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t},setLeadingMoveText:function(e,t){this.setLeading(-t),this.moveText(e,t)},setTextMatrix:function(e,t,r,n,i,s){this.current.textMatrix=[e,t,r,n,i,s],this.current.textMatrixScale=Math.sqrt(e*e+t*t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},nextLine:function(){this.moveText(0,this.current.leading)},paintChar(e,t,r,i){var s=this.ctx,o=this.current,a=o.font,c=o.textRenderingMode,l=o.fontSize/o.fontSizeScale,u=c&n.TextRenderingMode.FILL_STROKE_MASK,h=!!(c&n.TextRenderingMode.ADD_TO_PATH_FLAG);const d=o.patternFill&&!a.missingFile;var p;(a.disableFontFace||h||d)&&(p=a.getPathGenerator(this.commonObjs,e)),a.disableFontFace||d?(s.save(),s.translate(t,r),s.beginPath(),p(s,l),i&&s.setTransform.apply(s,i),u!==n.TextRenderingMode.FILL&&u!==n.TextRenderingMode.FILL_STROKE||s.fill(),u!==n.TextRenderingMode.STROKE&&u!==n.TextRenderingMode.FILL_STROKE||s.stroke(),s.restore()):(u!==n.TextRenderingMode.FILL&&u!==n.TextRenderingMode.FILL_STROKE||s.fillText(e,t,r),u!==n.TextRenderingMode.STROKE&&u!==n.TextRenderingMode.FILL_STROKE||s.strokeText(e,t,r)),h&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:s.mozCurrentTransform,x:t,y:r,fontSize:l,addToPath:p})},get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);for(var t=e.getImageData(0,0,10,10).data,r=!1,i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){r=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",r)},showText:function(e){var t=this.current,r=t.font;if(r.isType3Font)return this.showType3Text(e);var i=t.fontSize;if(0===i)return;var s=this.ctx,a=t.fontSizeScale,c=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,h=t.textHScale*u,d=e.length,p=r.vertical,f=p?1:-1,g=r.defaultVMetrics,m=i*t.fontMatrix[0],y=t.textRenderingMode===n.TextRenderingMode.FILL&&!r.disableFontFace&&!t.patternFill;let v;if(s.save(),t.patternFill){s.save();const e=t.fillColor.getPattern(s,this);v=s.mozCurrentTransform,s.restore(),s.fillStyle=e}s.transform.apply(s,t.textMatrix),s.translate(t.x,t.y+t.textRise),u>0?s.scale(h,-1):s.scale(h,1);var _=t.lineWidth,b=t.textMatrixScale;if(0===b||0===_){var w=t.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;w!==n.TextRenderingMode.STROKE&&w!==n.TextRenderingMode.FILL_STROKE||(this._cachedGetSinglePixelWidth=null,_=this.getSinglePixelWidth()*o)}else _/=b;1!==a&&(s.scale(a,a),_/=a),s.lineWidth=_;var S,k=0;for(S=0;S<d;++S){var E=e[S];if((0,n.isNum)(E))k+=f*E*i/1e3;else{var x,A,T,C,I,R,O,P=!1,D=(E.isSpace?l:0)+c,M=E.fontChar,L=E.accent,N=E.width;if(p?(I=E.vmetric||g,R=-(R=E.vmetric?I[1]:.5*N)*m,O=I[2]*m,N=I?-I[0]:N,x=R/a,A=(k+O)/a):(x=k/a,A=0),r.remeasure&&N>0){var F=1e3*s.measureText(M).width/i*a;if(N<F&&this.isFontSubpixelAAEnabled){var B=N/F;P=!0,s.save(),s.scale(B,1),x/=B}else N!==F&&(x+=(N-F)/2e3*i/a)}this.contentVisible&&(E.isInFont||r.missingFile)&&(y&&!L?s.fillText(M,x,A):(this.paintChar(M,x,A,v),L&&(T=x+i*L.offset.x/a,C=A-i*L.offset.y/a,this.paintChar(L.fontChar,T,C,v)))),k+=p?N*m-D*u:N*m+D*u,P&&s.restore()}}p?t.y-=k:t.x+=k*h,s.restore()},showType3Text:function(e){var t,r,i,s,o=this.ctx,a=this.current,c=a.font,l=a.fontSize,u=a.fontDirection,h=c.vertical?1:-1,d=a.charSpacing,p=a.wordSpacing,f=a.textHScale*u,g=a.fontMatrix||n.FONT_IDENTITY_MATRIX,m=e.length;if(a.textRenderingMode!==n.TextRenderingMode.INVISIBLE&&0!==l){for(this._cachedGetSinglePixelWidth=null,o.save(),o.transform.apply(o,a.textMatrix),o.translate(a.x,a.y),o.scale(f,u),t=0;t<m;++t)if(r=e[t],(0,n.isNum)(r))s=h*r*l/1e3,this.ctx.translate(s,0),a.x+=s*f;else{var y=(r.isSpace?p:0)+d,v=c.charProcOperatorList[r.operatorListId];v?(this.contentVisible&&(this.processingType3=r,this.save(),o.scale(l,l),o.transform.apply(o,g),this.executeOperatorList(v),this.restore()),i=n.Util.applyTransform([r.width,0],g)[0]*l+y,o.translate(i,0),a.x+=i*f):(0,n.warn)(`Type3 character "${r.operatorListId}" is not available.`)}o.restore(),this.processingType3=null}},setCharWidth:function(e,t){},setCharWidthAndBounds:function(e,t,r,n,i,s){this.ctx.rect(r,n,i-r,s-n),this.clip(),this.endPath()},getColorN_Pattern:function(t){var r;if("TilingPattern"===t[0]){var n=t[1],s=this.baseTransform||this.ctx.mozCurrentTransform.slice(),o={createCanvasGraphics:t=>new e(t,this.commonObjs,this.objs,this.canvasFactory,this.webGLContext)};r=new i.TilingPattern(t,n,this.ctx,o,s)}else r=(0,i.getShadingPatternFromIR)(t);return r},setStrokeColorN:function(){this.current.strokeColor=this.getColorN_Pattern(arguments)},setFillColorN:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0},setStrokeRGBColor:function(e,t,r){var i=n.Util.makeCssRgb(e,t,r);this.ctx.strokeStyle=i,this.current.strokeColor=i},setFillRGBColor:function(e,t,r){var i=n.Util.makeCssRgb(e,t,r);this.ctx.fillStyle=i,this.current.fillColor=i,this.current.patternFill=!1},shadingFill:function(e){if(this.contentVisible){var t=this.ctx;this.save();var r=(0,i.getShadingPatternFromIR)(e);t.fillStyle=r.getPattern(t,this,!0);var s=t.mozCurrentTransformInverse;if(s){var o=t.canvas,a=o.width,c=o.height,l=n.Util.applyTransform([0,0],s),u=n.Util.applyTransform([0,c],s),h=n.Util.applyTransform([a,0],s),d=n.Util.applyTransform([a,c],s),p=Math.min(l[0],u[0],h[0],d[0]),f=Math.min(l[1],u[1],h[1],d[1]),g=Math.max(l[0],u[0],h[0],d[0]),m=Math.max(l[1],u[1],h[1],d[1]);this.ctx.fillRect(p,f,g-p,m-f)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.restore()}},beginInlineImage:function(){(0,n.unreachable)("Should not call beginInlineImage")},beginImageData:function(){(0,n.unreachable)("Should not call beginImageData")},paintFormXObjectBegin:function(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform.apply(this,e),this.baseTransform=this.ctx.mozCurrentTransform,t)){var r=t[2]-t[0],n=t[3]-t[1];this.ctx.rect(t[0],t[1],r,n),this.clip(),this.endPath()}},paintFormXObjectEnd:function(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())},beginGroup:function(e){if(this.contentVisible){this.save();var t=this.ctx;e.isolated||(0,n.info)("TODO: Support non-isolated groups."),e.knockout&&(0,n.warn)("Knockout groups not supported.");var r=t.mozCurrentTransform;if(e.matrix&&t.transform.apply(t,e.matrix),!e.bbox)throw new Error("Bounding box is required.");var i=n.Util.getAxialAlignedBoundingBox(e.bbox,t.mozCurrentTransform),o=[0,0,t.canvas.width,t.canvas.height];i=n.Util.intersect(i,o)||[0,0,0,0];var a=Math.floor(i[0]),c=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-a,1),u=Math.max(Math.ceil(i[3])-c,1),d=1,p=1;l>s&&(d=l/s,l=s),u>s&&(p=u/s,u=s);var f="groupAt"+this.groupLevel;e.smask&&(f+="_smask_"+this.smaskCounter++%2);var g=this.cachedCanvases.getCanvas(f,l,u,!0),m=g.context;m.scale(1/d,1/p),m.translate(-a,-c),m.transform.apply(m,r),e.smask?this.smaskStack.push({canvas:g.canvas,context:m,offsetX:a,offsetY:c,scaleX:d,scaleY:p,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,c),t.scale(d,p)),h(t,m),this.ctx=m,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++,this.current.activeSMask=null}},endGroup:function(e){if(this.contentVisible){this.groupLevel--;var t=this.ctx;this.ctx=this.groupStack.pop(),void 0!==this.ctx.imageSmoothingEnabled?this.ctx.imageSmoothingEnabled=!1:this.ctx.mozImageSmoothingEnabled=!1,e.smask?this.tempSMask=this.smaskStack.pop():this.ctx.drawImage(t.canvas,0,0),this.restore()}},beginAnnotations:function(){this.save(),this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform)},endAnnotations:function(){this.restore()},beginAnnotation:function(e,t,r){if(this.save(),d(this.ctx),this.current=new u,Array.isArray(e)&&4===e.length){var n=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],n,i),this.clip(),this.endPath()}this.transform.apply(this,t),this.transform.apply(this,r)},endAnnotation:function(){this.restore()},paintImageMaskXObject:function(e){if(this.contentVisible){var t=this.ctx,n=e.width,i=e.height,s=this.current.fillColor,o=this.current.patternFill,a=this.processingType3;if(a&&void 0===a.compiled&&(a.compiled=n<=1e3&&i<=1e3?function(e){var t,r,n,i,s=e.width,o=e.height,a=s+1,c=new Uint8Array(a*(o+1)),l=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),u=s+7&-8,h=e.data,d=new Uint8Array(u*o),p=0;for(t=0,i=h.length;t<i;t++)for(var f=128,g=h[t];f>0;)d[p++]=g&f?0:255,f>>=1;var m=0;for(0!==d[p=0]&&(c[0]=1,++m),r=1;r<s;r++)d[p]!==d[p+1]&&(c[r]=d[p]?2:1,++m),p++;for(0!==d[p]&&(c[r]=2,++m),t=1;t<o;t++){n=t*a,d[(p=t*u)-u]!==d[p]&&(c[n]=d[p]?1:8,++m);var y=(d[p]?4:0)+(d[p-u]?8:0);for(r=1;r<s;r++)l[y=(y>>2)+(d[p+1]?4:0)+(d[p-u+1]?8:0)]&&(c[n+r]=l[y],++m),p++;if(d[p-u]!==d[p]&&(c[n+r]=d[p]?2:4,++m),m>1e3)return null}for(n=t*a,0!==d[p=u*(o-1)]&&(c[n]=8,++m),r=1;r<s;r++)d[p]!==d[p+1]&&(c[n+r]=d[p]?4:8,++m),p++;if(0!==d[p]&&(c[n+r]=4,++m),m>1e3)return null;var v=new Int32Array([0,a,-1,0,-a,0,0,0,1]),_=[];for(t=0;m&&t<=o;t++){for(var b=t*a,w=b+s;b<w&&!c[b];)b++;if(b!==w){var S,k=[b%a,t],E=c[b],x=b;do{var A=v[E];do{b+=A}while(!c[b]);5!==(S=c[b])&&10!==S?(E=S,c[b]=0):(E=S&51*E>>4,c[b]&=E>>2|E<<2),k.push(b%a),k.push(b/a|0),c[b]||--m}while(x!==b);_.push(k),--t}}return function(e){e.save(),e.scale(1/s,-1/o),e.translate(0,-o),e.beginPath();for(let r=0,n=_.length;r<n;r++){var t=_[r];e.moveTo(t[0],t[1]);for(let r=2,n=t.length;r<n;r+=2)e.lineTo(t[r],t[r+1])}e.fill(),e.beginPath(),e.restore()}}({data:e.data,width:n,height:i}):null),a&&a.compiled)a.compiled(t);else{var c=this.cachedCanvases.getCanvas("maskCanvas",n,i),l=c.context;l.save(),r(l,e),l.globalCompositeOperation="source-in",l.fillStyle=o?s.getPattern(l,this):s,l.fillRect(0,0,n,i),l.restore(),this.paintInlineImageXObject(c.canvas)}}},paintImageMaskXObjectRepeat(e,t,n=0,i=0,s,o){if(this.contentVisible){var a=e.width,c=e.height,l=this.current.fillColor,u=this.current.patternFill,h=this.cachedCanvases.getCanvas("maskCanvas",a,c),d=h.context;d.save(),r(d,e),d.globalCompositeOperation="source-in",d.fillStyle=u?l.getPattern(d,this):l,d.fillRect(0,0,a,c),d.restore();for(var p=this.ctx,f=0,g=o.length;f<g;f+=2)p.save(),p.transform(t,n,i,s,o[f],o[f+1]),p.scale(1,-1),p.drawImage(h.canvas,0,0,a,c,0,-1,1,1),p.restore()}},paintImageMaskXObjectGroup:function(e){if(this.contentVisible)for(var t=this.ctx,n=this.current.fillColor,i=this.current.patternFill,s=0,o=e.length;s<o;s++){var a=e[s],c=a.width,l=a.height,u=this.cachedCanvases.getCanvas("maskCanvas",c,l),h=u.context;h.save(),r(h,a),h.globalCompositeOperation="source-in",h.fillStyle=i?n.getPattern(h,this):n,h.fillRect(0,0,c,l),h.restore(),t.save(),t.transform.apply(t,a.transform),t.scale(1,-1),t.drawImage(u.canvas,0,0,c,l,0,-1,1,1),t.restore()}},paintImageXObject:function(e){if(!this.contentVisible)return;const t=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);t?this.paintInlineImageXObject(t):(0,n.warn)("Dependent image isn't ready yet")},paintImageXObjectRepeat:function(e,t,r,i){if(!this.contentVisible)return;const s=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);if(s){for(var o=s.width,a=s.height,c=[],l=0,u=i.length;l<u;l+=2)c.push({transform:[t,0,0,r,i[l],i[l+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(s,c)}else(0,n.warn)("Dependent image isn't ready yet")},paintInlineImageXObject:function(e){if(this.contentVisible){var r=e.width,n=e.height,i=this.ctx;this.save(),i.scale(1/r,-1/n);var s,o,a=i.mozCurrentTransformInverse,c=a[0],l=a[1],u=Math.max(Math.sqrt(c*c+l*l),1),h=a[2],d=a[3],p=Math.max(Math.sqrt(h*h+d*d),1);if("function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)s=e;else{var f=(o=this.cachedCanvases.getCanvas("inlineImage",r,n)).context;t(f,e,this.current.transferMaps),s=o.canvas}for(var g=r,m=n,y="prescale1";u>2&&g>1||p>2&&m>1;){var v=g,_=m;u>2&&g>1&&(u/=g/(v=Math.ceil(g/2))),p>2&&m>1&&(p/=m/(_=Math.ceil(m/2))),(f=(o=this.cachedCanvases.getCanvas(y,v,_)).context).clearRect(0,0,v,_),f.drawImage(s,0,0,g,m,0,0,v,_),s=o.canvas,g=v,m=_,y="prescale1"===y?"prescale2":"prescale1"}if(i.drawImage(s,0,0,g,m,0,-n,r,n),this.imageLayer){var b=this.getCanvasPosition(0,-n);this.imageLayer.appendImage({imgData:e,left:b[0],top:b[1],width:r/a[0],height:n/a[3]})}this.restore()}},paintInlineImageXObjectGroup:function(e,r){if(this.contentVisible){var n=this.ctx,i=e.width,s=e.height,o=this.cachedCanvases.getCanvas("inlineImage",i,s);t(o.context,e,this.current.transferMaps);for(var a=0,c=r.length;a<c;a++){var l=r[a];if(n.save(),n.transform.apply(n,l.transform),n.scale(1,-1),n.drawImage(o.canvas,l.x,l.y,l.w,l.h,0,-1,1,1),this.imageLayer){var u=this.getCanvasPosition(l.x,l.y);this.imageLayer.appendImage({imgData:e,left:u[0],top:u[1],width:i,height:s})}n.restore()}}},paintSolidColorImageMask:function(){this.contentVisible&&this.ctx.fillRect(0,0,1,1)},markPoint:function(e){},markPointProps:function(e,t){},beginMarkedContent:function(e){this.markedContentStack.push({visible:!0})},beginMarkedContentProps:function(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()},endMarkedContent:function(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()},beginCompat:function(){},endCompat:function(){},consumePath:function(){var e=this.ctx;this.pendingClip&&(this.pendingClip===b?e.clip("evenodd"):e.clip(),this.pendingClip=null),e.beginPath()},getSinglePixelWidth(e){if(null===this._cachedGetSinglePixelWidth){const e=this.ctx.mozCurrentTransformInverse;this._cachedGetSinglePixelWidth=Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1],e[2]*e[2]+e[3]*e[3]))}return this._cachedGetSinglePixelWidth},getCanvasPosition:function(e,t){var r=this.ctx.mozCurrentTransform;return[r[0]*e+r[2]*t+r[4],r[1]*e+r[3]*t+r[5]]},isContentVisible:function(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}},n.OPS)e.prototype[n.OPS[w]]=e.prototype[w];return e}();t.CanvasGraphics=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShadingPatternFromIR=function(e){var t=i[e[0]];if(!t)throw new Error(`Unknown IR type: ${e[0]}`);return t.fromIR(e)},t.TilingPattern=void 0;var n=r(2),i={};function s(e,t){if(!t||"undefined"==typeof Path2D)return;const r=t[2]-t[0],n=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],r,n),e.clip(i)}i.RadialAxial={fromIR:function(e){var t=e[1],r=e[2],n=e[3],i=e[4],o=e[5],a=e[6],c=e[7];return{type:"Pattern",getPattern:function(e){var l;s(e,r),"axial"===t?l=e.createLinearGradient(i[0],i[1],o[0],o[1]):"radial"===t&&(l=e.createRadialGradient(i[0],i[1],a,o[0],o[1],c));for(var u=0,h=n.length;u<h;++u){var d=n[u];l.addColorStop(d[0],d[1])}return l}}}};var o=function(){function e(e,t,r,n,i,s,o,a){var c,l=t.coords,u=t.colors,h=e.data,d=4*e.width;l[r+1]>l[n+1]&&(c=r,r=n,n=c,c=s,s=o,o=c),l[n+1]>l[i+1]&&(c=n,n=i,i=c,c=o,o=a,a=c),l[r+1]>l[n+1]&&(c=r,r=n,n=c,c=s,s=o,o=c);var p=(l[r]+t.offsetX)*t.scaleX,f=(l[r+1]+t.offsetY)*t.scaleY,g=(l[n]+t.offsetX)*t.scaleX,m=(l[n+1]+t.offsetY)*t.scaleY,y=(l[i]+t.offsetX)*t.scaleX,v=(l[i+1]+t.offsetY)*t.scaleY;if(!(f>=v))for(var _,b,w,S,k,E,x,A,T=u[s],C=u[s+1],I=u[s+2],R=u[o],O=u[o+1],P=u[o+2],D=u[a],M=u[a+1],L=u[a+2],N=Math.round(f),F=Math.round(v),B=N;B<=F;B++){if(B<m){let e;e=B<f?0:f===m?1:(f-B)/(f-m),_=p-(p-g)*e,b=T-(T-R)*e,w=C-(C-O)*e,S=I-(I-P)*e}else{let e;e=B>v?1:m===v?0:(m-B)/(m-v),_=g-(g-y)*e,b=R-(R-D)*e,w=O-(O-M)*e,S=P-(P-L)*e}let e;e=B<f?0:B>v?1:(f-B)/(f-v),k=p-(p-y)*e,E=T-(T-D)*e,x=C-(C-M)*e,A=I-(I-L)*e;for(var U=Math.round(Math.min(_,k)),q=Math.round(Math.max(_,k)),j=d*B+4*U,K=U;K<=q;K++)e=(_-K)/(_-k),e<0?e=0:e>1&&(e=1),h[j++]=b-(b-E)*e|0,h[j++]=w-(w-x)*e|0,h[j++]=S-(S-A)*e|0,h[j++]=255}}function t(t,r,n){var i,s,o=r.coords,a=r.colors;switch(r.type){case"lattice":var c=r.verticesPerRow,l=Math.floor(o.length/c)-1,u=c-1;for(i=0;i<l;i++)for(var h=i*c,d=0;d<u;d++,h++)e(t,n,o[h],o[h+1],o[h+c],a[h],a[h+1],a[h+c]),e(t,n,o[h+c+1],o[h+1],o[h+c],a[h+c+1],a[h+1],a[h+c]);break;case"triangles":for(i=0,s=o.length;i<s;i+=3)e(t,n,o[i],o[i+1],o[i+2],a[i],a[i+1],a[i+2]);break;default:throw new Error("illegal figure")}}return function(e,r,n,i,s,o,a,c){var l,u,h,d,p=Math.floor(e[0]),f=Math.floor(e[1]),g=Math.ceil(e[2])-p,m=Math.ceil(e[3])-f,y=Math.min(Math.ceil(Math.abs(g*r[0]*1.1)),3e3),v=Math.min(Math.ceil(Math.abs(m*r[1]*1.1)),3e3),_=g/y,b=m/v,w={coords:n,colors:i,offsetX:-p,offsetY:-f,scaleX:1/_,scaleY:1/b},S=y+4,k=v+4;if(c.isEnabled)l=c.drawFigures({width:y,height:v,backgroundColor:o,figures:s,context:w}),(u=a.getCanvas("mesh",S,k,!1)).context.drawImage(l,2,2),l=u.canvas;else{var E=(u=a.getCanvas("mesh",S,k,!1)).context,x=E.createImageData(y,v);if(o){var A=x.data;for(h=0,d=A.length;h<d;h+=4)A[h]=o[0],A[h+1]=o[1],A[h+2]=o[2],A[h+3]=255}for(h=0;h<s.length;h++)t(x,s[h],w);E.putImageData(x,2,2),l=u.canvas}return{canvas:l,offsetX:p-2*_,offsetY:f-2*b,scaleX:_,scaleY:b}}}();i.Mesh={fromIR:function(e){var t=e[2],r=e[3],i=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return{type:"Pattern",getPattern:function(e,h,d){var p;if(s(e,l),d)p=n.Util.singularValueDecompose2dScale(e.mozCurrentTransform);else if(p=n.Util.singularValueDecompose2dScale(h.baseTransform),c){var f=n.Util.singularValueDecompose2dScale(c);p=[p[0]*f[0],p[1]*f[1]]}var g=o(a,p,t,r,i,d?null:u,h.cachedCanvases,h.webGLContext);return d||(e.setTransform.apply(e,h.baseTransform),c&&e.transform.apply(e,c)),e.translate(g.offsetX,g.offsetY),e.scale(g.scaleX,g.scaleY),e.createPattern(g.canvas,"no-repeat")}}}},i.Dummy={fromIR:function(){return{type:"Pattern",getPattern:function(){return"hotpink"}}}};var a=function(){function e(e,t,r,n,i){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.canvasGraphicsFactory=n,this.baseTransform=i,this.type="Pattern",this.ctx=r}return e.prototype={createPatternCanvas:function(e){var t=this.operatorList,r=this.bbox,i=this.xstep,s=this.ystep,o=this.paintType,a=this.tilingType,c=this.color,l=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+a);var u=r[0],h=r[1],d=r[2],p=r[3],f=n.Util.singularValueDecompose2dScale(this.matrix),g=n.Util.singularValueDecompose2dScale(this.baseTransform),m=[f[0]*g[0],f[1]*g[1]],y=this.getSizeAndScale(i,this.ctx.canvas.width,m[0]),v=this.getSizeAndScale(s,this.ctx.canvas.height,m[1]),_=e.cachedCanvases.getCanvas("pattern",y.size,v.size,!0),b=_.context,w=l.createCanvasGraphics(b);return w.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(w,o,c),w.transform(y.scale,0,0,v.scale,0,0),w.transform(1,0,0,1,-u,-h),this.clipBbox(w,r,u,h,d,p),w.executeOperatorList(t),this.ctx.transform(1,0,0,1,u,h),this.ctx.scale(1/y.scale,1/v.scale),_.canvas},getSizeAndScale:function(e,t,r){e=Math.abs(e);var n=Math.max(3e3,t),i=Math.ceil(e*r);return i>=n?i=n:r=i/e,{scale:r,size:i}},clipBbox:function(e,t,r,n,i,s){if(Array.isArray(t)&&4===t.length){var o=i-r,a=s-n;e.ctx.rect(r,n,o,a),e.clip(),e.endPath()}},setFillAndStrokeStyleToContext:function(e,t,r){const i=e.ctx,s=e.current;switch(t){case 1:var o=this.ctx;i.fillStyle=o.fillStyle,i.strokeStyle=o.strokeStyle,s.fillColor=o.fillStyle,s.strokeColor=o.strokeStyle;break;case 2:var a=n.Util.makeCssRgb(r[0],r[1],r[2]);i.fillStyle=a,i.strokeStyle=a,s.fillColor=a,s.strokeColor=a;break;default:throw new n.FormatError(`Unsupported paint type: ${t}`)}},getPattern:function(e,t){(e=this.ctx).setTransform.apply(e,this.baseTransform),e.transform.apply(e,this.matrix);var r=this.createPatternCanvas(t);return e.createPattern(r,"repeat")}},e}();t.TilingPattern=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;const n=Object.create(null);t.GlobalWorkerOptions=n,n.workerPort=void 0===n.workerPort?null:n.workerPort,n.workerSrc=void 0===n.workerSrc?"":n.workerSrc},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var n=r(2);function i(e){if("object"!=typeof e||null===e)return e;switch(e.name){case"AbortException":return new n.AbortException(e.message);case"MissingPDFException":return new n.MissingPDFException(e.message);case"UnexpectedResponseException":return new n.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new n.UnknownErrorException(e.message,e.details);default:return new n.UnknownErrorException(e.message,e.toString())}}t.MessageHandler=class{constructor(e,t,r){this.sourceName=e,this.targetName=t,this.comObj=r,this.callbackId=1,this.streamId=1,this.postMessageTransfers=!0,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{const t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void this._processStreamMessage(t);if(t.callback){const e=t.callbackId,r=this.callbackCapabilities[e];if(!r)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],1===t.callback)r.resolve(t.data);else{if(2!==t.callback)throw new Error("Unexpected callback case");r.reject(i(t.reason))}return}const n=this.actionHandler[t.action];if(!n)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const e=this.sourceName,s=t.sourceName;new Promise((function(e){e(n(t.data))})).then((function(n){r.postMessage({sourceName:e,targetName:s,callback:1,callbackId:t.callbackId,data:n})}),(function(n){r.postMessage({sourceName:e,targetName:s,callback:2,callbackId:t.callbackId,reason:i(n)})}))}else t.streamId?this._createStreamSink(t):n(t.data)},r.addEventListener("message",this._onComObjOnMessage)}on(e,t){const r=this.actionHandler;if(r[e])throw new Error(`There is already an actionName called "${e}"`);r[e]=t}send(e,t,r){this._postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},r)}sendWithPromise(e,t,r){const i=this.callbackId++,s=(0,n.createPromiseCapability)();this.callbackCapabilities[i]=s;try{this._postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},r)}catch(e){s.reject(e)}return s.promise}sendWithStream(e,t,r,s){const o=this.streamId++,a=this.sourceName,c=this.targetName,l=this.comObj;return new ReadableStream({start:r=>{const i=(0,n.createPromiseCapability)();return this.streamControllers[o]={controller:r,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},this._postMessage({sourceName:a,targetName:c,action:e,streamId:o,data:t,desiredSize:r.desiredSize},s),i.promise},pull:e=>{const t=(0,n.createPromiseCapability)();return this.streamControllers[o].pullCall=t,l.postMessage({sourceName:a,targetName:c,stream:6,streamId:o,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,n.assert)(e instanceof Error,"cancel must have a valid reason");const t=(0,n.createPromiseCapability)();return this.streamControllers[o].cancelCall=t,this.streamControllers[o].isClosed=!0,l.postMessage({sourceName:a,targetName:c,stream:1,streamId:o,reason:i(e)}),t.promise}},r)}_createStreamSink(e){const t=this,r=this.actionHandler[e.action],s=e.streamId,o=this.sourceName,a=e.sourceName,c=this.comObj,l={enqueue(e,r=1,i){if(this.isCancelled)return;const c=this.desiredSize;this.desiredSize-=r,c>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),t._postMessage({sourceName:o,targetName:a,stream:4,streamId:s,chunk:e},i)},close(){this.isCancelled||(this.isCancelled=!0,c.postMessage({sourceName:o,targetName:a,stream:3,streamId:s}),delete t.streamSinks[s])},error(e){(0,n.assert)(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,c.postMessage({sourceName:o,targetName:a,stream:5,streamId:s,reason:i(e)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[s]=l,new Promise((function(t){t(r(e.data,l))})).then((function(){c.postMessage({sourceName:o,targetName:a,stream:8,streamId:s,success:!0})}),(function(e){c.postMessage({sourceName:o,targetName:a,stream:8,streamId:s,reason:i(e)})}))}_processStreamMessage(e){const t=e.streamId,r=this.sourceName,s=e.sourceName,o=this.comObj;switch(e.stream){case 8:e.success?this.streamControllers[t].startCall.resolve():this.streamControllers[t].startCall.reject(i(e.reason));break;case 7:e.success?this.streamControllers[t].pullCall.resolve():this.streamControllers[t].pullCall.reject(i(e.reason));break;case 6:if(!this.streamSinks[t]){o.postMessage({sourceName:r,targetName:s,stream:7,streamId:t,success:!0});break}this.streamSinks[t].desiredSize<=0&&e.desiredSize>0&&this.streamSinks[t].sinkCapability.resolve(),this.streamSinks[t].desiredSize=e.desiredSize;const{onPull:a}=this.streamSinks[e.streamId];new Promise((function(e){e(a&&a())})).then((function(){o.postMessage({sourceName:r,targetName:s,stream:7,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:r,targetName:s,stream:7,streamId:t,reason:i(e)})}));break;case 4:if((0,n.assert)(this.streamControllers[t],"enqueue should have stream controller"),this.streamControllers[t].isClosed)break;this.streamControllers[t].controller.enqueue(e.chunk);break;case 3:if((0,n.assert)(this.streamControllers[t],"close should have stream controller"),this.streamControllers[t].isClosed)break;this.streamControllers[t].isClosed=!0,this.streamControllers[t].controller.close(),this._deleteStreamController(t);break;case 5:(0,n.assert)(this.streamControllers[t],"error should have stream controller"),this.streamControllers[t].controller.error(i(e.reason)),this._deleteStreamController(t);break;case 2:e.success?this.streamControllers[t].cancelCall.resolve():this.streamControllers[t].cancelCall.reject(i(e.reason)),this._deleteStreamController(t);break;case 1:if(!this.streamSinks[t])break;const{onCancel:c}=this.streamSinks[e.streamId];new Promise((function(t){t(c&&c(i(e.reason)))})).then((function(){o.postMessage({sourceName:r,targetName:s,stream:2,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:r,targetName:s,stream:2,streamId:t,reason:i(e)})})),this.streamSinks[t].sinkCapability.reject(i(e.reason)),this.streamSinks[t].isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(e){await Promise.allSettled([this.streamControllers[e].startCall,this.streamControllers[e].pullCall,this.streamControllers[e].cancelCall].map((function(e){return e&&e.promise}))),delete this.streamControllers[e]}_postMessage(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=r(2),i=r(15);t.Metadata=class{constructor(e){(0,n.assert)("string"==typeof e,"Metadata: input is not a string"),e=this._repair(e);const t=(new i.SimpleXMLParser).parseFromString(e);this._metadataMap=new Map,t&&this._parse(t)}_repair(e){return e.replace(/^[^<]+/,"").replace(/>\\376\\377([^<]+)/g,(function(e,t){const r=t.replace(/\\([0-3])([0-7])([0-7])/g,(function(e,t,r,n){return String.fromCharCode(64*t+8*r+1*n)})).replace(/&(amp|apos|gt|lt|quot);/g,(function(e,t){switch(t){case"amp":return"&";case"apos":return"'";case"gt":return">";case"lt":return"<";case"quot":return'"'}throw new Error(`_repair: ${t} isn't defined.`)}));let n="";for(let e=0,t=r.length;e<t;e+=2){const t=256*r.charCodeAt(e)+r.charCodeAt(e+1);n+=t>=32&&t<127&&60!==t&&62!==t&&38!==t?String.fromCharCode(t):"&#x"+(65536+t).toString(16).substring(1)+";"}return">"+n}))}_parse(e){let t=e.documentElement;if("rdf:rdf"!==t.nodeName.toLowerCase())for(t=t.firstChild;t&&"rdf:rdf"!==t.nodeName.toLowerCase();)t=t.nextSibling;const r=t?t.nodeName.toLowerCase():null;if(!t||"rdf:rdf"!==r||!t.hasChildNodes())return;const n=t.childNodes;for(let e=0,t=n.length;e<t;e++){const t=n[e];if("rdf:description"===t.nodeName.toLowerCase())for(let e=0,r=t.childNodes.length;e<r;e++)if("#text"!==t.childNodes[e].nodeName.toLowerCase()){const r=t.childNodes[e],n=r.nodeName.toLowerCase();this._metadataMap.set(n,r.textContent.trim())}}}get(e){return this._metadataMap.has(e)?this._metadataMap.get(e):null}getAll(){return Object.fromEntries(this._metadataMap)}has(e){return this._metadataMap.has(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleXMLParser=void 0;function n(e,t){const r=e[t];return" "===r||"\n"===r||"\r"===r||"\t"===r}class i{constructor(e,t){this.nodeName=e,this.nodeValue=t,Object.defineProperty(this,"parentNode",{value:null,writable:!0})}get firstChild(){return this.childNodes&&this.childNodes[0]}get nextSibling(){const e=this.parentNode.childNodes;if(!e)return;const t=e.indexOf(this);return-1!==t?e[t+1]:void 0}get textContent(){return this.childNodes?this.childNodes.map((function(e){return e.textContent})).join(""):this.nodeValue||""}hasChildNodes(){return this.childNodes&&this.childNodes.length>0}}t.SimpleXMLParser=class extends class{_resolveEntities(e){return e.replace(/&([^;]+);/g,((e,t)=>{if("#x"===t.substring(0,2))return String.fromCharCode(parseInt(t.substring(2),16));if("#"===t.substring(0,1))return String.fromCharCode(parseInt(t.substring(1),10));switch(t){case"lt":return"<";case"gt":return">";case"amp":return"&";case"quot":return'"'}return this.onResolveEntity(t)}))}_parseContent(e,t){const r=[];let i=t;function s(){for(;i<e.length&&n(e,i);)++i}for(;i<e.length&&!n(e,i)&&">"!==e[i]&&"/"!==e[i];)++i;const o=e.substring(t,i);for(s();i<e.length&&">"!==e[i]&&"/"!==e[i]&&"?"!==e[i];){s();let t="",o="";for(;i<e.length&&!n(e,i)&&"="!==e[i];)t+=e[i],++i;if(s(),"="!==e[i])return null;++i,s();const a=e[i];if('"'!==a&&"'"!==a)return null;const c=e.indexOf(a,++i);if(c<0)return null;o=e.substring(i,c),r.push({name:t,value:this._resolveEntities(o)}),i=c+1,s()}return{name:o,attributes:r,parsed:i-t}}_parseProcessingInstruction(e,t){let r=t;for(;r<e.length&&!n(e,r)&&">"!==e[r]&&"/"!==e[r];)++r;const i=e.substring(t,r);!function(){for(;r<e.length&&n(e,r);)++r}();const s=r;for(;r<e.length&&("?"!==e[r]||">"!==e[r+1]);)++r;return{name:i,value:e.substring(s,r),parsed:r-t}}parseXml(e){let t=0;for(;t<e.length;){let r=t;if("<"===e[t]){let t;switch(++r,e[r]){case"/":if(++r,t=e.indexOf(">",r),t<0)return void this.onError(-9);this.onEndElement(e.substring(r,t)),r=t+1;break;case"?":++r;const n=this._parseProcessingInstruction(e,r);if("?>"!==e.substring(r+n.parsed,r+n.parsed+2))return void this.onError(-3);this.onPi(n.name,n.value),r+=n.parsed+2;break;case"!":if("--"===e.substring(r+1,r+3)){if(t=e.indexOf("--\x3e",r+3),t<0)return void this.onError(-5);this.onComment(e.substring(r+3,t)),r=t+3}else if("[CDATA["===e.substring(r+1,r+8)){if(t=e.indexOf("]]>",r+8),t<0)return void this.onError(-2);this.onCdata(e.substring(r+8,t)),r=t+3}else{if("DOCTYPE"!==e.substring(r+1,r+8))return void this.onError(-6);{const n=e.indexOf("[",r+8);let i=!1;if(t=e.indexOf(">",r+8),t<0)return void this.onError(-4);if(n>0&&t>n){if(t=e.indexOf("]>",r+8),t<0)return void this.onError(-4);i=!0}const s=e.substring(r+8,t+(i?1:0));this.onDoctype(s),r=t+(i?2:1)}}break;default:const i=this._parseContent(e,r);if(null===i)return void this.onError(-6);let s=!1;if("/>"===e.substring(r+i.parsed,r+i.parsed+2))s=!0;else if(">"!==e.substring(r+i.parsed,r+i.parsed+1))return void this.onError(-9);this.onBeginElement(i.name,i.attributes,s),r+=i.parsed+(s?2:1)}}else{for(;r<e.length&&"<"!==e[r];)r++;const n=e.substring(t,r);this.onText(this._resolveEntities(n))}t=r}}onResolveEntity(e){return`&${e};`}onPi(e,t){}onComment(e){}onCdata(e){}onDoctype(e){}onText(e){}onBeginElement(e,t,r){}onEndElement(e){}onError(e){}}{constructor(){super(),this._currentFragment=null,this._stack=null,this._errorCode=0}parseFromString(e){if(this._currentFragment=[],this._stack=[],this._errorCode=0,this.parseXml(e),0!==this._errorCode)return;const[t]=this._currentFragment;return t?{documentElement:t}:void 0}onResolveEntity(e){switch(e){case"apos":return"'"}return super.onResolveEntity(e)}onText(e){if(function(e){for(let t=0,r=e.length;t<r;t++)if(!n(e,t))return!1;return!0}(e))return;const t=new i("#text",e);this._currentFragment.push(t)}onCdata(e){const t=new i("#text",e);this._currentFragment.push(t)}onBeginElement(e,t,r){const n=new i(e);n.childNodes=[],this._currentFragment.push(n),r||(this._stack.push(this._currentFragment),this._currentFragment=n.childNodes)}onEndElement(e){this._currentFragment=this._stack.pop()||[];const t=this._currentFragment[this._currentFragment.length-1];if(t)for(let e=0,r=t.childNodes.length;e<r;e++)t.childNodes[e].parentNode=t}onError(e){this._errorCode=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var n=r(2);class i{constructor(e,t){this.visible=!0,this.name=e,this.intent=t}}t.OptionalContentConfig=class{constructor(e){if(this.name=null,this.creator=null,this._order=null,this._groups=new Map,null!==e){this.name=e.name,this.creator=e.creator,this._order=e.order;for(const t of e.groups)this._groups.set(t.id,new i(t.name,t.intent));if("OFF"===e.baseState)for(const e of this._groups)e.visible=!1;for(const t of e.on)this._groups.get(t).visible=!0;for(const t of e.off)this._groups.get(t).visible=!1}}isVisible(e){if("OCG"===e.type)return this._groups.has(e.id)?this._groups.get(e.id).visible:((0,n.warn)(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression&&(0,n.warn)("Visibility expression not supported yet."),!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(this._groups.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(!this._groups.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(!this._groups.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(this._groups.get(t).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${e.policy}.`),!0}return(0,n.warn)(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){this._groups.has(e)?this._groups.get(e).visible=!!t:(0,n.warn)(`Optional content group not found: ${e}`)}getOrder(){return this._groups.size?this._order?this._order.slice():Array.from(this._groups.keys()):null}getGroups(){return this._groups.size?Object.fromEntries(this._groups):null}getGroup(e){return this._groups.get(e)||null}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var n=r(2);t.PDFDataTransportStream=class{constructor(e,t){(0,n.assert)(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=e.progressiveDone||!1;const r=e.initialData;if(r&&r.length>0){const e=new Uint8Array(r).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._contentLength=e.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),this._pdfDataRangeTransport.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),this._pdfDataRangeTransport.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),this._pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),this._pdfDataRangeTransport.transportReady()}_onReceiveData(e){const t=new Uint8Array(e.chunk).buffer;if(void 0===e.begin)this._fullRequestReader?this._fullRequestReader._enqueue(t):this._queuedChunks.push(t);else{const r=this._rangeReaders.some((function(r){return r._begin===e.begin&&(r._enqueue(t),!0)}));(0,n.assert)(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?this._fullRequestReader._loaded:0}_onProgress(e){if(void 0===e.total){const t=this._rangeReaders[0];t&&t.onProgress&&t.onProgress({loaded:e.loaded})}else{const t=this._fullRequestReader;t&&t.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new i(this,e,this._progressiveDone)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new s(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e),this._rangeReaders.slice(0).forEach((function(t){t.cancel(e)})),this._pdfDataRangeTransport.abort()}};class i{constructor(e,t,r=!1){this._stream=e,this._done=r||!1,this._filename=null,this._queuedChunks=t||[],this._loaded=0;for(const e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._requests.forEach((function(e){e.resolve({value:void 0,done:!0})})),this._requests=[]}progressiveDone(){this._done||(this._done=!0)}}class s{constructor(e,t,r){this._stream=e,this._begin=t,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){this._done||(0===this._requests.length?this._queuedChunk=e:(this._requests.shift().resolve({value:e,done:!1}),this._requests.forEach((function(e){e.resolve({value:void 0,done:!0})})),this._requests=[]),this._done=!0,this._stream._removeRangeReader(this))}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._requests.forEach((function(e){e.resolve({value:void 0,done:!0})})),this._requests=[],this._stream._removeRangeReader(this)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLContext=void 0;var n=r(2);t.WebGLContext=class{constructor({enable:e=!1}){this._enabled=!0===e}get isEnabled(){let e=this._enabled;return e&&(e=i.tryInitGL()),(0,n.shadow)(this,"isEnabled",e)}composeSMask({layer:e,mask:t,properties:r}){return i.composeSMask(e,t,r)}drawFigures({width:e,height:t,backgroundColor:r,figures:n,context:s}){return i.drawFigures(e,t,r,n,s)}clear(){i.cleanup()}};var i=function(){function e(e,t,r){var n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(n);throw new Error("Error during shader compilation: "+i)}return n}function t(t,r){return e(t,r,t.VERTEX_SHADER)}function r(t,r){return e(t,r,t.FRAGMENT_SHADER)}function n(e,t){for(var r=e.createProgram(),n=0,i=t.length;n<i;++n)e.attachShader(r,t[n]);if(e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS)){var s=e.getProgramInfoLog(r);throw new Error("Error during program linking: "+s)}return r}function i(e,t,r){e.activeTexture(r);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),n}var s,o;function a(){s||(o=document.createElement("canvas"),s=o.getContext("webgl",{premultipliedalpha:!1}))}var c=null,l=null;return{tryInitGL(){try{return a(),!!s}catch(e){}return!1},composeSMask:function(e,l,u){var h=e.width,d=e.height;c||function(){var e,i;a(),e=o,o=null,i=s,s=null;var l=n(i,[t(i,"  attribute vec2 a_position;                                      attribute vec2 a_texCoord;                                                                                                      uniform vec2 u_resolution;                                                                                                      varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;       gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_texCoord = a_texCoord;                                      }                                                             "),r(i,"  precision mediump float;                                                                                                        uniform vec4 u_backdrop;                                        uniform int u_subtype;                                          uniform sampler2D u_image;                                      uniform sampler2D u_mask;                                                                                                       varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec4 imageColor = texture2D(u_image, v_texCoord);               vec4 maskColor = texture2D(u_mask, v_texCoord);                 if (u_backdrop.a > 0.0) {                                         maskColor.rgb = maskColor.rgb * maskColor.a +                                   u_backdrop.rgb * (1.0 - maskColor.a);         }                                                               float lum;                                                      if (u_subtype == 0) {                                             lum = maskColor.a;                                            } else {                                                          lum = maskColor.r * 0.3 + maskColor.g * 0.59 +                        maskColor.b * 0.11;                                     }                                                               imageColor.a *= lum;                                            imageColor.rgb *= imageColor.a;                                 gl_FragColor = imageColor;                                    }                                                             ")]);i.useProgram(l);var u={};u.gl=i,u.canvas=e,u.resolutionLocation=i.getUniformLocation(l,"u_resolution"),u.positionLocation=i.getAttribLocation(l,"a_position"),u.backdropLocation=i.getUniformLocation(l,"u_backdrop"),u.subtypeLocation=i.getUniformLocation(l,"u_subtype");var h=i.getAttribLocation(l,"a_texCoord"),d=i.getUniformLocation(l,"u_image"),p=i.getUniformLocation(l,"u_mask"),f=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,f),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),i.enableVertexAttribArray(h),i.vertexAttribPointer(h,2,i.FLOAT,!1,0,0),i.uniform1i(d,0),i.uniform1i(p,1),c=u}();var p=c,f=p.canvas,g=p.gl;f.width=h,f.height=d,g.viewport(0,0,g.drawingBufferWidth,g.drawingBufferHeight),g.uniform2f(p.resolutionLocation,h,d),u.backdrop?g.uniform4f(p.resolutionLocation,u.backdrop[0],u.backdrop[1],u.backdrop[2],1):g.uniform4f(p.resolutionLocation,0,0,0,0),g.uniform1i(p.subtypeLocation,"Luminosity"===u.subtype?1:0);var m=i(g,e,g.TEXTURE0),y=i(g,l,g.TEXTURE1),v=g.createBuffer();return g.bindBuffer(g.ARRAY_BUFFER,v),g.bufferData(g.ARRAY_BUFFER,new Float32Array([0,0,h,0,0,d,0,d,h,0,h,d]),g.STATIC_DRAW),g.enableVertexAttribArray(p.positionLocation),g.vertexAttribPointer(p.positionLocation,2,g.FLOAT,!1,0,0),g.clearColor(0,0,0,0),g.enable(g.BLEND),g.blendFunc(g.ONE,g.ONE_MINUS_SRC_ALPHA),g.clear(g.COLOR_BUFFER_BIT),g.drawArrays(g.TRIANGLES,0,6),g.flush(),g.deleteTexture(m),g.deleteTexture(y),g.deleteBuffer(v),f},drawFigures:function(e,i,c,u,h){l||function(){var e,i;a(),e=o,o=null,i=s,s=null;var c=n(i,[t(i,"  attribute vec2 a_position;                                      attribute vec3 a_color;                                                                                                         uniform vec2 u_resolution;                                      uniform vec2 u_scale;                                           uniform vec2 u_offset;                                                                                                          varying vec4 v_color;                                                                                                           void main() {                                                     vec2 position = (a_position + u_offset) * u_scale;              vec2 clipSpace = (position / u_resolution) * 2.0 - 1.0;         gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_color = vec4(a_color / 255.0, 1.0);                         }                                                             "),r(i,"  precision mediump float;                                                                                                        varying vec4 v_color;                                                                                                           void main() {                                                     gl_FragColor = v_color;                                       }                                                             ")]);i.useProgram(c);var u={};u.gl=i,u.canvas=e,u.resolutionLocation=i.getUniformLocation(c,"u_resolution"),u.scaleLocation=i.getUniformLocation(c,"u_scale"),u.offsetLocation=i.getUniformLocation(c,"u_offset"),u.positionLocation=i.getAttribLocation(c,"a_position"),u.colorLocation=i.getAttribLocation(c,"a_color"),l=u}();var d=l,p=d.canvas,f=d.gl;p.width=e,p.height=i,f.viewport(0,0,f.drawingBufferWidth,f.drawingBufferHeight),f.uniform2f(d.resolutionLocation,e,i);var g,m,y,v=0;for(g=0,m=u.length;g<m;g++)switch(u[g].type){case"lattice":v+=((y=u[g].coords.length/u[g].verticesPerRow|0)-1)*(u[g].verticesPerRow-1)*6;break;case"triangles":v+=u[g].coords.length}var _=new Float32Array(2*v),b=new Uint8Array(3*v),w=h.coords,S=h.colors,k=0,E=0;for(g=0,m=u.length;g<m;g++){var x=u[g],A=x.coords,T=x.colors;switch(x.type){case"lattice":var C=x.verticesPerRow;y=A.length/C|0;for(var I=1;I<y;I++)for(var R=I*C+1,O=1;O<C;O++,R++)_[k]=w[A[R-C-1]],_[k+1]=w[A[R-C-1]+1],_[k+2]=w[A[R-C]],_[k+3]=w[A[R-C]+1],_[k+4]=w[A[R-1]],_[k+5]=w[A[R-1]+1],b[E]=S[T[R-C-1]],b[E+1]=S[T[R-C-1]+1],b[E+2]=S[T[R-C-1]+2],b[E+3]=S[T[R-C]],b[E+4]=S[T[R-C]+1],b[E+5]=S[T[R-C]+2],b[E+6]=S[T[R-1]],b[E+7]=S[T[R-1]+1],b[E+8]=S[T[R-1]+2],_[k+6]=_[k+2],_[k+7]=_[k+3],_[k+8]=_[k+4],_[k+9]=_[k+5],_[k+10]=w[A[R]],_[k+11]=w[A[R]+1],b[E+9]=b[E+3],b[E+10]=b[E+4],b[E+11]=b[E+5],b[E+12]=b[E+6],b[E+13]=b[E+7],b[E+14]=b[E+8],b[E+15]=S[T[R]],b[E+16]=S[T[R]+1],b[E+17]=S[T[R]+2],k+=12,E+=18;break;case"triangles":for(var P=0,D=A.length;P<D;P++)_[k]=w[A[P]],_[k+1]=w[A[P]+1],b[E]=S[T[P]],b[E+1]=S[T[P]+1],b[E+2]=S[T[P]+2],k+=2,E+=3}}c?f.clearColor(c[0]/255,c[1]/255,c[2]/255,1):f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT);var M=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,M),f.bufferData(f.ARRAY_BUFFER,_,f.STATIC_DRAW),f.enableVertexAttribArray(d.positionLocation),f.vertexAttribPointer(d.positionLocation,2,f.FLOAT,!1,0,0);var L=f.createBuffer();return f.bindBuffer(f.ARRAY_BUFFER,L),f.bufferData(f.ARRAY_BUFFER,b,f.STATIC_DRAW),f.enableVertexAttribArray(d.colorLocation),f.vertexAttribPointer(d.colorLocation,3,f.UNSIGNED_BYTE,!1,0,0),f.uniform2f(d.scaleLocation,h.scaleX,h.scaleY),f.uniform2f(d.offsetLocation,h.offsetX,h.offsetY),f.drawArrays(f.TRIANGLES,0,v),f.flush(),f.deleteBuffer(M),f.deleteBuffer(L),p},cleanup(){c&&c.canvas&&(c.canvas.width=0,c.canvas.height=0),l&&l.canvas&&(l.canvas.width=0,l.canvas.height=0),c=null,l=null}}}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationLayer=void 0;var n=r(1),i=r(2),s=r(8);class o{static create(e){switch(e.data.annotationType){case i.AnnotationType.LINK:return new c(e);case i.AnnotationType.TEXT:return new l(e);case i.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new h(e);case"Btn":return e.data.radioButton?new p(e):e.data.checkBox?new d(e):new f(e);case"Ch":return new g(e)}return new u(e);case i.AnnotationType.POPUP:return new m(e);case i.AnnotationType.FREETEXT:return new v(e);case i.AnnotationType.LINE:return new _(e);case i.AnnotationType.SQUARE:return new b(e);case i.AnnotationType.CIRCLE:return new w(e);case i.AnnotationType.POLYLINE:return new S(e);case i.AnnotationType.CARET:return new E(e);case i.AnnotationType.INK:return new x(e);case i.AnnotationType.POLYGON:return new k(e);case i.AnnotationType.HIGHLIGHT:return new A(e);case i.AnnotationType.UNDERLINE:return new T(e);case i.AnnotationType.SQUIGGLY:return new C(e);case i.AnnotationType.STRIKEOUT:return new I(e);case i.AnnotationType.STAMP:return new R(e);case i.AnnotationType.FILEATTACHMENT:return new O(e);default:return new a(e)}}}class a{constructor(e,t=!1,r=!1){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderInteractiveForms=e.renderInteractiveForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,t&&(this.container=this._createContainer(r))}_createContainer(e=!1){const t=this.data,r=this.page,n=this.viewport,s=document.createElement("section");let o=t.rect[2]-t.rect[0],a=t.rect[3]-t.rect[1];s.setAttribute("data-annotation-id",t.id);const c=i.Util.normalizeRect([t.rect[0],r.view[3]-t.rect[1]+r.view[1],t.rect[2],r.view[3]-t.rect[3]+r.view[1]]);if(s.style.transform=`matrix(${n.transform.join(",")})`,s.style.transformOrigin=`-${c[0]}px -${c[1]}px`,!e&&t.borderStyle.width>0){s.style.borderWidth=`${t.borderStyle.width}px`,t.borderStyle.style!==i.AnnotationBorderStyleType.UNDERLINE&&(o-=2*t.borderStyle.width,a-=2*t.borderStyle.width);const e=t.borderStyle.horizontalCornerRadius,r=t.borderStyle.verticalCornerRadius;if(e>0||r>0){const t=`${e}px / ${r}px`;s.style.borderRadius=t}switch(t.borderStyle.style){case i.AnnotationBorderStyleType.SOLID:s.style.borderStyle="solid";break;case i.AnnotationBorderStyleType.DASHED:s.style.borderStyle="dashed";break;case i.AnnotationBorderStyleType.BEVELED:(0,i.warn)("Unimplemented border style: beveled");break;case i.AnnotationBorderStyleType.INSET:(0,i.warn)("Unimplemented border style: inset");break;case i.AnnotationBorderStyleType.UNDERLINE:s.style.borderBottomStyle="solid"}t.color?s.style.borderColor=i.Util.makeCssRgb(0|t.color[0],0|t.color[1],0|t.color[2]):s.style.borderWidth=0}return s.style.left=`${c[0]}px`,s.style.top=`${c[1]}px`,s.style.width=`${o}px`,s.style.height=`${a}px`,s}_createPopup(e,t,r){t||((t=document.createElement("div")).style.height=e.style.height,t.style.width=e.style.width,e.appendChild(t));const n=new y({container:e,trigger:t,color:r.color,title:r.title,modificationDate:r.modificationDate,contents:r.contents,hideWrapper:!0}).render();n.style.left=e.style.width,e.appendChild(n)}render(){(0,i.unreachable)("Abstract method `AnnotationElement.render` called")}}class c extends a{constructor(e){super(e,!!(e.data.url||e.data.dest||e.data.action))}render(){this.container.className="linkAnnotation";const{data:e,linkService:t}=this,r=document.createElement("a");return e.url?(0,n.addLinkAttributes)(r,{url:e.url,target:e.newWindow?n.LinkTarget.BLANK:t.externalLinkTarget,rel:t.externalLinkRel,enabled:t.externalLinkEnabled}):e.action?this._bindNamedAction(r,e.action):this._bindLink(r,e.dest),this.container.appendChild(r),this.container}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.navigateTo(t),!1),t&&(e.className="internalLink")}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),e.className="internalLink"}}class l extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents))}render(){this.container.className="textAnnotation";const e=document.createElement("img");return e.style.height=this.container.style.height,e.style.width=this.container.style.width,e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(this.container,e,this.data),this.container.appendChild(e),this.container}}class u extends a{render(){return this.container}}class h extends u{constructor(e){super(e,e.renderInteractiveForms||!e.data.hasAppearance&&!!e.data.fieldValue)}render(){const e=this.annotationStorage,t=this.data.id;this.container.className="textWidgetAnnotation";let r=null;if(this.renderInteractiveForms){const n=e.getOrCreateValue(t,this.data.fieldValue);if(this.data.multiLine?(r=document.createElement("textarea"),r.textContent=n):(r=document.createElement("input"),r.type="text",r.setAttribute("value",n)),r.addEventListener("input",(function(r){e.setValue(t,r.target.value)})),r.disabled=this.data.readOnly,r.name=this.data.fieldName,null!==this.data.maxLen&&(r.maxLength=this.data.maxLen),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/this.data.maxLen;r.classList.add("comb"),r.style.letterSpacing=`calc(${e}px - 1ch)`}}else{r=document.createElement("div"),r.textContent=this.data.fieldValue,r.style.verticalAlign="middle",r.style.display="table-cell";let e=null;this.data.fontRefName&&this.page.commonObjs.has(this.data.fontRefName)&&(e=this.page.commonObjs.get(this.data.fontRefName)),this._setTextStyle(r,e)}return null!==this.data.textAlignment&&(r.style.textAlign=["left","center","right"][this.data.textAlignment]),this.container.appendChild(r),this.container}_setTextStyle(e,t){const r=e.style;if(r.fontSize=`${this.data.fontSize}px`,r.direction=this.data.fontDirection<0?"rtl":"ltr",!t)return;let n="normal";t.black?n="900":t.bold&&(n="bold"),r.fontWeight=n,r.fontStyle=t.italic?"italic":"normal";const i=t.loadedName?`"${t.loadedName}", `:"",s=t.fallbackName||"Helvetica, sans-serif";r.fontFamily=i+s}}class d extends u{constructor(e){super(e,e.renderInteractiveForms)}render(){const e=this.annotationStorage,t=this.data,r=t.id,n=e.getOrCreateValue(r,t.fieldValue&&"Off"!==t.fieldValue);this.container.className="buttonWidgetAnnotation checkBox";const i=document.createElement("input");return i.disabled=t.readOnly,i.type="checkbox",i.name=this.data.fieldName,n&&i.setAttribute("checked",!0),i.addEventListener("change",(function(t){e.setValue(r,t.target.checked)})),this.container.appendChild(i),this.container}}class p extends u{constructor(e){super(e,e.renderInteractiveForms)}render(){this.container.className="buttonWidgetAnnotation radioButton";const e=this.annotationStorage,t=this.data,r=t.id,n=e.getOrCreateValue(r,t.fieldValue===t.buttonValue),i=document.createElement("input");return i.disabled=t.readOnly,i.type="radio",i.name=t.fieldName,n&&i.setAttribute("checked",!0),i.addEventListener("change",(function(t){const n=t.target.name;for(const r of document.getElementsByName(n))r!==t.target&&e.setValue(r.parentNode.getAttribute("data-annotation-id"),!1);e.setValue(r,t.target.checked)})),this.container.appendChild(i),this.container}}class f extends c{render(){const e=super.render();return e.className="buttonWidgetAnnotation pushButton",e}}class g extends u{constructor(e){super(e,e.renderInteractiveForms)}render(){this.container.className="choiceWidgetAnnotation";const e=this.annotationStorage,t=this.data.id;e.getOrCreateValue(t,this.data.fieldValue.length>0?this.data.fieldValue[0]:null);const r=document.createElement("select");r.disabled=this.data.readOnly,r.name=this.data.fieldName,this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0));for(const e of this.data.options){const t=document.createElement("option");t.textContent=e.displayValue,t.value=e.exportValue,this.data.fieldValue.includes(e.exportValue)&&t.setAttribute("selected",!0),r.appendChild(t)}return r.addEventListener("input",(function(r){const n=r.target.options,i=n[n.selectedIndex].value;e.setValue(t,i)})),this.container.appendChild(r),this.container}}class m extends a{constructor(e){super(e,!(!e.data.title&&!e.data.contents))}render(){if(this.container.className="popupAnnotation",["Line","Square","Circle","PolyLine","Polygon","Ink"].includes(this.data.parentType))return this.container;const e=`[data-annotation-id="${this.data.parentId}"]`,t=this.layer.querySelector(e);if(!t)return this.container;const r=new y({container:this.container,trigger:t,color:this.data.color,title:this.data.title,modificationDate:this.data.modificationDate,contents:this.data.contents}),n=parseFloat(t.style.left),i=parseFloat(t.style.width);return this.container.style.transformOrigin=`-${n+i}px -${t.style.top}`,this.container.style.left=`${n+i}px`,this.container.appendChild(r.render()),this.container}}class y{constructor(e){this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.title=e.title,this.modificationDate=e.modificationDate,this.contents=e.contents,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}render(){const e=document.createElement("div");e.className="popupWrapper",this.hideElement=this.hideWrapper?e:this.container,this.hideElement.setAttribute("hidden",!0);const t=document.createElement("div");t.className="popup";const r=this.color;if(r){const e=.7*(255-r[0])+r[0],n=.7*(255-r[1])+r[1],s=.7*(255-r[2])+r[2];t.style.backgroundColor=i.Util.makeCssRgb(0|e,0|n,0|s)}const s=document.createElement("h1");s.textContent=this.title,t.appendChild(s);const o=n.PDFDateString.toDateObject(this.modificationDate);if(o){const e=document.createElement("span");e.textContent="{{date}}, {{time}}",e.dataset.l10nId="annotation_date_string",e.dataset.l10nArgs=JSON.stringify({date:o.toLocaleDateString(),time:o.toLocaleTimeString()}),t.appendChild(e)}const a=this._formatContents(this.contents);return t.appendChild(a),this.trigger.addEventListener("click",this._toggle.bind(this)),this.trigger.addEventListener("mouseover",this._show.bind(this,!1)),this.trigger.addEventListener("mouseout",this._hide.bind(this,!1)),t.addEventListener("click",this._hide.bind(this,!0)),e.appendChild(t),e}_formatContents(e){const t=document.createElement("p"),r=e.split(/(?:\r\n?|\n)/);for(let e=0,n=r.length;e<n;++e){const i=r[e];t.appendChild(document.createTextNode(i)),e<n-1&&t.appendChild(document.createElement("br"))}return t}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(e=!1){e&&(this.pinned=!0),this.hideElement.hasAttribute("hidden")&&(this.hideElement.removeAttribute("hidden"),this.container.style.zIndex+=1)}_hide(e=!0){e&&(this.pinned=!1),this.hideElement.hasAttribute("hidden")||this.pinned||(this.hideElement.setAttribute("hidden",!0),this.container.style.zIndex-=1)}}class v extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){return this.container.className="freeTextAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}class _ extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){this.container.className="lineAnnotation";const e=this.data,t=e.rect[2]-e.rect[0],r=e.rect[3]-e.rect[1],n=this.svgFactory.create(t,r),i=this.svgFactory.createElement("svg:line");return i.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),i.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),i.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),i.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),n.appendChild(i),this.container.append(n),this._createPopup(this.container,i,e),this.container}}class b extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){this.container.className="squareAnnotation";const e=this.data,t=e.rect[2]-e.rect[0],r=e.rect[3]-e.rect[1],n=this.svgFactory.create(t,r),i=e.borderStyle.width,s=this.svgFactory.createElement("svg:rect");return s.setAttribute("x",i/2),s.setAttribute("y",i/2),s.setAttribute("width",t-i),s.setAttribute("height",r-i),s.setAttribute("stroke-width",i||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","none"),n.appendChild(s),this.container.append(n),this._createPopup(this.container,s,e),this.container}}class w extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){this.container.className="circleAnnotation";const e=this.data,t=e.rect[2]-e.rect[0],r=e.rect[3]-e.rect[1],n=this.svgFactory.create(t,r),i=e.borderStyle.width,s=this.svgFactory.createElement("svg:ellipse");return s.setAttribute("cx",t/2),s.setAttribute("cy",r/2),s.setAttribute("rx",t/2-i/2),s.setAttribute("ry",r/2-i/2),s.setAttribute("stroke-width",i||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","none"),n.appendChild(s),this.container.append(n),this._createPopup(this.container,s,e),this.container}}class S extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,t=e.rect[2]-e.rect[0],r=e.rect[3]-e.rect[1],n=this.svgFactory.create(t,r);let i=[];for(const t of e.vertices){const r=t.x-e.rect[0],n=e.rect[3]-t.y;i.push(r+","+n)}i=i.join(" ");const s=this.svgFactory.createElement(this.svgElementName);return s.setAttribute("points",i),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","none"),n.appendChild(s),this.container.append(n),this._createPopup(this.container,s,e),this.container}}class k extends S{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class E extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}class x extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,t=e.rect[2]-e.rect[0],r=e.rect[3]-e.rect[1],n=this.svgFactory.create(t,r);for(const t of e.inkLists){let r=[];for(const n of t){const t=n.x-e.rect[0],i=e.rect[3]-n.y;r.push(`${t},${i}`)}r=r.join(" ");const i=this.svgFactory.createElement(this.svgElementName);i.setAttribute("points",r),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","none"),this._createPopup(this.container,i,e),n.appendChild(i)}return this.container.append(n),this.container}}class A extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){return this.container.className="highlightAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}class T extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){return this.container.className="underlineAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}class C extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){return this.container.className="squigglyAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}class I extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){return this.container.className="strikeoutAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}class R extends a{constructor(e){super(e,!!(e.data.hasPopup||e.data.title||e.data.contents),!0)}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}class O extends a{constructor(e){super(e,!0);const{filename:t,content:r}=this.data.file;this.filename=(0,n.getFilenameFromUrl)(t),this.content=r,this.linkService.eventBus&&this.linkService.eventBus.dispatch("fileattachmentannotation",{source:this,id:(0,i.stringToPDFString)(t),filename:t,content:r})}render(){this.container.className="fileAttachmentAnnotation";const e=document.createElement("div");return e.style.height=this.container.style.height,e.style.width=this.container.style.width,e.addEventListener("dblclick",this._download.bind(this)),this.data.hasPopup||!this.data.title&&!this.data.contents||this._createPopup(this.container,e,this.data),this.container.appendChild(e),this.container}_download(){this.downloadManager?this.downloadManager.downloadData(this.content,this.filename,""):(0,i.warn)("Download cannot be started due to unavailable download manager")}}t.AnnotationLayer=class{static render(e){const t=[],r=[];for(const n of e.annotations)n&&(n.annotationType!==i.AnnotationType.POPUP?t.push(n):r.push(n));r.length&&t.push(...r);for(const r of t){const t=o.create({data:r,layer:e.div,page:e.page,viewport:e.viewport,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderInteractiveForms:"boolean"!=typeof e.renderInteractiveForms||e.renderInteractiveForms,svgFactory:new n.DOMSVGFactory,annotationStorage:e.annotationStorage||new s.AnnotationStorage});t.isRenderable&&e.div.appendChild(t.render())}}static update(e){for(const t of e.annotations){const r=e.div.querySelector(`[data-annotation-id="${t.id}"]`);r&&(r.style.transform=`matrix(${e.viewport.transform.join(",")})`)}e.div.removeAttribute("hidden")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderTextLayer=void 0;var n=r(2),i=function(){var e=/\S/;function t(t,r,i){var s,o=document.createElement("span"),a={angle:0,canvasWidth:0,isWhitespace:!1,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1};if(t._textDivs.push(o),s=r.str,!e.test(s))return a.isWhitespace=!0,void t._textDivProperties.set(o,a);var c=n.Util.transform(t._viewport.transform,r.transform),l=Math.atan2(c[1],c[0]),u=i[r.fontName];u.vertical&&(l+=Math.PI/2);var h=Math.sqrt(c[2]*c[2]+c[3]*c[3]),d=h;let p,f;u.ascent?d=u.ascent*d:u.descent&&(d=(1+u.descent)*d),0===l?(p=c[4],f=c[5]-d):(p=c[4]+d*Math.sin(l),f=c[5]-d*Math.cos(l)),o.style.left=`${p}px`,o.style.top=`${f}px`,o.style.fontSize=`${h}px`,o.style.fontFamily=u.fontFamily,o.textContent=r.str,t._fontInspectorEnabled&&(o.dataset.fontName=r.fontName),0!==l&&(a.angle=l*(180/Math.PI));let g=!1;if(r.str.length>1)g=!0;else if(r.transform[0]!==r.transform[3]){const e=Math.abs(r.transform[0]),t=Math.abs(r.transform[3]);e!==t&&Math.max(e,t)/Math.min(e,t)>1.5&&(g=!0)}if(g&&(u.vertical?a.canvasWidth=r.height*t._viewport.scale:a.canvasWidth=r.width*t._viewport.scale),t._textDivProperties.set(o,a),t._textContentStream&&t._layoutText(o),t._enhanceTextSelection){var m=1,y=0;0!==l&&(m=Math.cos(l),y=Math.sin(l));var v,_,b=(u.vertical?r.height:r.width)*t._viewport.scale,w=h;0!==l?(v=[m,y,-y,m,p,f],_=n.Util.getAxialAlignedBoundingBox([0,0,b,w],v)):_=[p,f,p+b,f+w],t._bounds.push({left:_[0],top:_[1],right:_[2],bottom:_[3],div:o,size:[b,w],m:v})}}function r(e){if(!e._canceled){var t=e._textDivs,r=e._capability,n=t.length;if(n>1e5)return e._renderingDone=!0,void r.resolve();if(!e._textContentStream)for(var i=0;i<n;i++)e._layoutText(t[i]);e._renderingDone=!0,r.resolve()}}function i(e,t,r){let n=0;for(let i=0;i<r;i++){const r=e[t++];r>0&&(n=n?Math.min(r,n):r)}return n}function s(e,t){t.sort((function(e,t){return e.x1-t.x1||e.index-t.index}));var r=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];t.forEach((function(e){for(var t=0;t<r.length&&r[t].end<=e.y1;)t++;for(var n,i,s=r.length-1;s>=0&&r[s].start>=e.y2;)s--;var o,a,c=-1/0;for(o=t;o<=s;o++){var l;(l=(i=(n=r[o]).boundary).x2>e.x1?i.index>e.index?i.x1New:e.x1:void 0===i.x2New?(i.x2+e.x1)/2:i.x2New)>c&&(c=l)}for(e.x1New=c,o=t;o<=s;o++)void 0===(i=(n=r[o]).boundary).x2New?i.x2>e.x1?i.index>e.index&&(i.x2New=i.x2):i.x2New=c:i.x2New>c&&(i.x2New=Math.max(c,i.x2));var u=[],h=null;for(o=t;o<=s;o++){var d=(i=(n=r[o]).boundary).x2>e.x2?i:e;h===d?u[u.length-1].end=n.end:(u.push({start:n.start,end:n.end,boundary:d}),h=d)}for(r[t].start<e.y1&&(u[0].start=e.y1,u.unshift({start:r[t].start,end:e.y1,boundary:r[t].boundary})),e.y2<r[s].end&&(u[u.length-1].end=e.y2,u.push({start:e.y2,end:r[s].end,boundary:r[s].boundary})),o=t;o<=s;o++)if(void 0===(i=(n=r[o]).boundary).x2New){var p=!1;for(a=t-1;!p&&a>=0&&r[a].start>=i.y1;a--)p=r[a].boundary===i;for(a=s+1;!p&&a<r.length&&r[a].end<=i.y2;a++)p=r[a].boundary===i;for(a=0;!p&&a<u.length;a++)p=u[a].boundary===i;p||(i.x2New=c)}Array.prototype.splice.apply(r,[t,s-t+1].concat(u))})),r.forEach((function(t){var r=t.boundary;void 0===r.x2New&&(r.x2New=Math.max(e,r.x2))}))}function o({textContent:e,textContentStream:t,container:r,viewport:i,textDivs:s,textContentItemsStr:o,enhanceTextSelection:a}){this._textContent=e,this._textContentStream=t,this._container=r,this._document=r.ownerDocument,this._viewport=i,this._textDivs=s||[],this._textContentItemsStr=o||[],this._enhanceTextSelection=!!a,this._fontInspectorEnabled=!(!globalThis.FontInspector||!globalThis.FontInspector.enabled),this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._capability.promise.finally((()=>{this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)})).catch((()=>{}))}return o.prototype={get promise(){return this._capability.promise},cancel:function(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")),this._reader=null),null!==this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))},_processItems(e,r){for(let n=0,i=e.length;n<i;n++)this._textContentItemsStr.push(e[n].str),t(this,e[n],r)},_layoutText(e){const t=this._textDivProperties.get(e);if(t.isWhitespace)return;let r="";if(0!==t.canvasWidth){const{fontSize:n,fontFamily:i}=e.style;n===this._layoutTextLastFontSize&&i===this._layoutTextLastFontFamily||(this._layoutTextCtx.font=`${n} ${i}`,this._layoutTextLastFontSize=n,this._layoutTextLastFontFamily=i);const{width:s}=this._layoutTextCtx.measureText(e.textContent);s>0&&(t.scale=t.canvasWidth/s,r=`scaleX(${t.scale})`)}0!==t.angle&&(r=`rotate(${t.angle}deg) ${r}`),r.length>0&&(this._enhanceTextSelection&&(t.originalTransform=r),e.style.transform=r),this._textDivProperties.set(e,t),this._container.appendChild(e)},_render:function(e){const t=(0,n.createPromiseCapability)();let i=Object.create(null);const s=this._document.createElement("canvas");if(s.mozOpaque=!0,this._layoutTextCtx=s.getContext("2d",{alpha:!1}),this._textContent){const e=this._textContent.items,r=this._textContent.styles;this._processItems(e,r),t.resolve()}else{if(!this._textContentStream)throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');{const e=()=>{this._reader.read().then((({value:r,done:n})=>{n?t.resolve():(Object.assign(i,r.styles),this._processItems(r.items,i),e())}),t.reject)};this._reader=this._textContentStream.getReader(),e()}}t.promise.then((()=>{i=null,e?this._renderTimer=setTimeout((()=>{r(this),this._renderTimer=null}),e):r(this)}),this._capability.reject)},expandTextDivs:function(e){if(!this._enhanceTextSelection||!this._renderingDone)return;null!==this._bounds&&(function(e){for(var t=e._bounds,r=e._viewport,o=function(e,t,r){var n=r.map((function(e,t){return{x1:e.left,y1:e.top,x2:e.right,y2:e.bottom,index:t,x1New:void 0,x2New:void 0}}));s(e,n);var i=new Array(r.length);return n.forEach((function(e){var t=e.index;i[t]={left:e.x1New,top:0,right:e.x2New,bottom:0}})),r.map((function(t,r){var s=i[r],o=n[r];o.x1=t.top,o.y1=e-s.right,o.x2=t.bottom,o.y2=e-s.left,o.index=r,o.x1New=void 0,o.x2New=void 0})),s(t,n),n.forEach((function(e){var t=e.index;i[t].top=e.x1New,i[t].bottom=e.x2New})),i}(r.width,r.height,t),a=0;a<o.length;a++){var c=t[a].div,l=e._textDivProperties.get(c);if(0!==l.angle){var u=o[a],h=t[a],d=h.m,p=d[0],f=d[1],g=[[0,0],[0,h.size[1]],[h.size[0],0],h.size],m=new Float64Array(64);g.forEach((function(e,t){var r=n.Util.applyTransform(e,d);m[t+0]=p&&(u.left-r[0])/p,m[t+4]=f&&(u.top-r[1])/f,m[t+8]=p&&(u.right-r[0])/p,m[t+12]=f&&(u.bottom-r[1])/f,m[t+16]=f&&(u.left-r[0])/-f,m[t+20]=p&&(u.top-r[1])/p,m[t+24]=f&&(u.right-r[0])/-f,m[t+28]=p&&(u.bottom-r[1])/p,m[t+32]=p&&(u.left-r[0])/-p,m[t+36]=f&&(u.top-r[1])/-f,m[t+40]=p&&(u.right-r[0])/-p,m[t+44]=f&&(u.bottom-r[1])/-f,m[t+48]=f&&(u.left-r[0])/f,m[t+52]=p&&(u.top-r[1])/-p,m[t+56]=f&&(u.right-r[0])/f,m[t+60]=p&&(u.bottom-r[1])/-p}));var y=1+Math.min(Math.abs(p),Math.abs(f));l.paddingLeft=i(m,32,16)/y,l.paddingTop=i(m,48,16)/y,l.paddingRight=i(m,0,16)/y,l.paddingBottom=i(m,16,16)/y,e._textDivProperties.set(c,l)}else l.paddingLeft=t[a].left-o[a].left,l.paddingTop=t[a].top-o[a].top,l.paddingRight=o[a].right-t[a].right,l.paddingBottom=o[a].bottom-t[a].bottom,e._textDivProperties.set(c,l)}}(this),this._bounds=null);const t=[],r=[];for(var o=0,a=this._textDivs.length;o<a;o++){const n=this._textDivs[o],i=this._textDivProperties.get(n);i.isWhitespace||(e?(t.length=0,r.length=0,i.originalTransform&&t.push(i.originalTransform),i.paddingTop>0?(r.push(`${i.paddingTop}px`),t.push(`translateY(${-i.paddingTop}px)`)):r.push(0),i.paddingRight>0?r.push(i.paddingRight/i.scale+"px"):r.push(0),i.paddingBottom>0?r.push(`${i.paddingBottom}px`):r.push(0),i.paddingLeft>0?(r.push(i.paddingLeft/i.scale+"px"),t.push(`translateX(${-i.paddingLeft/i.scale}px)`)):r.push(0),n.style.padding=r.join(" "),t.length&&(n.style.transform=t.join(" "))):(n.style.padding=null,n.style.transform=i.originalTransform))}}},function(e){var t=new o({textContent:e.textContent,textContentStream:e.textContentStream,container:e.container,viewport:e.viewport,textDivs:e.textDivs,textContentItemsStr:e.textContentItemsStr,enhanceTextSelection:e.enhanceTextSelection});return t._render(e.timeout),t}}();t.renderTextLayer=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var n=r(2),i=r(1),s=r(4);let o=function(){throw new Error("Not implemented: SVGGraphics")};t.SVGGraphics=o;{const e={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},r="http://www.w3.org/XML/1998/namespace",l="http://www.w3.org/1999/xlink",u=["butt","round","square"],h=["miter","round","bevel"],d=function(){const e=new Uint8Array([137,80,78,71,13,10,26,10]),t=new Int32Array(256);for(let e=0;e<256;e++){let r=e;for(let e=0;e<8;e++)r=1&r?3988292384^r>>1&2147483647:r>>1&2147483647;t[e]=r}function r(e,r,n,i){let s=i;const o=r.length;n[s]=o>>24&255,n[s+1]=o>>16&255,n[s+2]=o>>8&255,n[s+3]=255&o,s+=4,n[s]=255&e.charCodeAt(0),n[s+1]=255&e.charCodeAt(1),n[s+2]=255&e.charCodeAt(2),n[s+3]=255&e.charCodeAt(3),s+=4,n.set(r,s),s+=r.length;const a=function(e,r,n){let i=-1;for(let s=r;s<n;s++){const r=255&(i^e[s]);i=i>>>8^t[r]}return-1^i}(n,i+4,s);n[s]=a>>24&255,n[s+1]=a>>16&255,n[s+2]=a>>8&255,n[s+3]=255&a}function i(e){let t=e.length;const r=65535,n=Math.ceil(t/r),i=new Uint8Array(2+t+5*n+4);let s=0;i[s++]=120,i[s++]=156;let o=0;for(;t>r;)i[s++]=0,i[s++]=255,i[s++]=255,i[s++]=0,i[s++]=0,i.set(e.subarray(o,o+r),s),s+=r,o+=r,t-=r;i[s++]=1,i[s++]=255&t,i[s++]=t>>8&255,i[s++]=255&~t,i[s++]=(65535&~t)>>8&255,i.set(e.subarray(o),s),s+=e.length-o;const a=function(e,t,r){let n=1,i=0;for(let t=0;t<r;++t)n=(n+(255&e[t]))%65521,i=(i+n)%65521;return i<<16|n}(e,0,e.length);return i[s++]=a>>24&255,i[s++]=a>>16&255,i[s++]=a>>8&255,i[s++]=255&a,i}return function(t,o,a){return function(t,o,a,c){const l=t.width,u=t.height;let h,d,p;const f=t.data;switch(o){case n.ImageKind.GRAYSCALE_1BPP:d=0,h=1,p=l+7>>3;break;case n.ImageKind.RGB_24BPP:d=2,h=8,p=3*l;break;case n.ImageKind.RGBA_32BPP:d=6,h=8,p=4*l;break;default:throw new Error("invalid format")}const g=new Uint8Array((1+p)*u);let m=0,y=0;for(let e=0;e<u;++e)g[m++]=0,g.set(f.subarray(y,y+p),m),y+=p,m+=p;if(o===n.ImageKind.GRAYSCALE_1BPP&&c){m=0;for(let e=0;e<u;e++){m++;for(let e=0;e<p;e++)g[m++]^=255}}const v=new Uint8Array([l>>24&255,l>>16&255,l>>8&255,255&l,u>>24&255,u>>16&255,u>>8&255,255&u,h,d,0,0,0]),_=function(e){if(!s.isNodeJS)return i(e);try{let t;t=parseInt(process.versions.node)>=8?e:Buffer.from(e);const r=__webpack_require__(2258).deflateSync(t,{level:9});return r instanceof Uint8Array?r:new Uint8Array(r)}catch(e){(0,n.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+e)}return i(e)}(g),b=e.length+36+v.length+_.length,w=new Uint8Array(b);let S=0;return w.set(e,S),S+=e.length,r("IHDR",v,w,S),S+=12+v.length,r("IDATA",_,w,S),S+=12+_.length,r("IEND",new Uint8Array(0),w,S),(0,n.createObjectURL)(w,"image/png",a)}(t,void 0===t.kind?n.ImageKind.GRAYSCALE_1BPP:t.kind,o,a)}}();class p{constructor(){this.fontSizeScale=1,this.fontWeight=e.fontWeight,this.fontSize=0,this.textMatrix=n.IDENTITY_MATRIX,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=n.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=e.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}}function a(e){if(Number.isInteger(e))return e.toString();const t=e.toFixed(10);let r=t.length-1;if("0"!==t[r])return t;do{r--}while("0"===t[r]);return t.substring(0,"."===t[r]?r:r+1)}function c(e){if(0===e[4]&&0===e[5]){if(0===e[1]&&0===e[2])return 1===e[0]&&1===e[3]?"":`scale(${a(e[0])} ${a(e[3])})`;if(e[0]===e[3]&&e[1]===-e[2])return`rotate(${a(180*Math.acos(e[0])/Math.PI)})`}else if(1===e[0]&&0===e[1]&&0===e[2]&&1===e[3])return`translate(${a(e[4])} ${a(e[5])})`;return`matrix(${a(e[0])} ${a(e[1])} ${a(e[2])} ${a(e[3])} ${a(e[4])} ${a(e[5])})`}let f=0,g=0,m=0;t.SVGGraphics=o=class{constructor(e,t,r=!1){this.svgFactory=new i.DOMSVGFactory,this.current=new p,this.transformMatrix=n.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!r,this._operatorIdMapping=[];for(const e in n.OPS)this._operatorIdMapping[n.OPS[e]]=e}save(){this.transformStack.push(this.transformMatrix);const e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){const t=e.fnArray,r=e.argsArray;for(let e=0,i=t.length;e<i;e++)if(t[e]===n.OPS.dependency)for(const t of r[e]){const e=t.startsWith("g_")?this.commonObjs:this.objs,r=new Promise((r=>{e.get(t,r)}));this.current.dependencies.push(r)}return Promise.all(this.current.dependencies)}transform(e,t,r,i,s,o){const a=[e,t,r,i,s,o];this.transformMatrix=n.Util.transform(this.transformMatrix,a),this.tgrp=null}getSVG(e,t){this.viewport=t;const r=this._initialize(t);return this.loadDependencies(e).then((()=>(this.transformMatrix=n.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),r)))}convertOpList(e){const t=this._operatorIdMapping,r=e.argsArray,n=e.fnArray,i=[];for(let e=0,s=n.length;e<s;e++){const s=n[e];i.push({fnId:s,fn:t[s],args:r[e]})}return function(e){let t=[];const r=[];for(const n of e)"save"!==n.fn?"restore"===n.fn?t=r.pop():t.push(n):(t.push({fnId:92,fn:"group",items:[]}),r.push(t),t=t[t.length-1].items);return t}(i)}executeOpTree(e){for(const t of e){const e=t.fn,r=t.fnId,i=t.args;switch(0|r){case n.OPS.beginText:this.beginText();break;case n.OPS.dependency:break;case n.OPS.setLeading:this.setLeading(i);break;case n.OPS.setLeadingMoveText:this.setLeadingMoveText(i[0],i[1]);break;case n.OPS.setFont:this.setFont(i);break;case n.OPS.showText:case n.OPS.showSpacedText:this.showText(i[0]);break;case n.OPS.endText:this.endText();break;case n.OPS.moveText:this.moveText(i[0],i[1]);break;case n.OPS.setCharSpacing:this.setCharSpacing(i[0]);break;case n.OPS.setWordSpacing:this.setWordSpacing(i[0]);break;case n.OPS.setHScale:this.setHScale(i[0]);break;case n.OPS.setTextMatrix:this.setTextMatrix(i[0],i[1],i[2],i[3],i[4],i[5]);break;case n.OPS.setTextRise:this.setTextRise(i[0]);break;case n.OPS.setTextRenderingMode:this.setTextRenderingMode(i[0]);break;case n.OPS.setLineWidth:this.setLineWidth(i[0]);break;case n.OPS.setLineJoin:this.setLineJoin(i[0]);break;case n.OPS.setLineCap:this.setLineCap(i[0]);break;case n.OPS.setMiterLimit:this.setMiterLimit(i[0]);break;case n.OPS.setFillRGBColor:this.setFillRGBColor(i[0],i[1],i[2]);break;case n.OPS.setStrokeRGBColor:this.setStrokeRGBColor(i[0],i[1],i[2]);break;case n.OPS.setStrokeColorN:this.setStrokeColorN(i);break;case n.OPS.setFillColorN:this.setFillColorN(i);break;case n.OPS.shadingFill:this.shadingFill(i[0]);break;case n.OPS.setDash:this.setDash(i[0],i[1]);break;case n.OPS.setRenderingIntent:this.setRenderingIntent(i[0]);break;case n.OPS.setFlatness:this.setFlatness(i[0]);break;case n.OPS.setGState:this.setGState(i[0]);break;case n.OPS.fill:this.fill();break;case n.OPS.eoFill:this.eoFill();break;case n.OPS.stroke:this.stroke();break;case n.OPS.fillStroke:this.fillStroke();break;case n.OPS.eoFillStroke:this.eoFillStroke();break;case n.OPS.clip:this.clip("nonzero");break;case n.OPS.eoClip:this.clip("evenodd");break;case n.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case n.OPS.paintImageXObject:this.paintImageXObject(i[0]);break;case n.OPS.paintInlineImageXObject:this.paintInlineImageXObject(i[0]);break;case n.OPS.paintImageMaskXObject:this.paintImageMaskXObject(i[0]);break;case n.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(i[0],i[1]);break;case n.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case n.OPS.closePath:this.closePath();break;case n.OPS.closeStroke:this.closeStroke();break;case n.OPS.closeFillStroke:this.closeFillStroke();break;case n.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case n.OPS.nextLine:this.nextLine();break;case n.OPS.transform:this.transform(i[0],i[1],i[2],i[3],i[4],i[5]);break;case n.OPS.constructPath:this.constructPath(i[0],i[1]);break;case n.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,n.warn)(`Unimplemented operator ${e}`)}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,t,r,n,i,s){const o=this.current;o.textMatrix=o.lineMatrix=[e,t,r,n,i,s],o.textMatrixScale=Math.sqrt(e*e+t*t),o.x=o.lineX=0,o.y=o.lineY=0,o.xcoords=[],o.ycoords=[],o.tspan=this.svgFactory.createElement("svg:tspan"),o.tspan.setAttributeNS(null,"font-family",o.fontFamily),o.tspan.setAttributeNS(null,"font-size",`${a(o.fontSize)}px`),o.tspan.setAttributeNS(null,"y",a(-o.y)),o.txtElement=this.svgFactory.createElement("svg:text"),o.txtElement.appendChild(o.tspan)}beginText(){const e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=n.IDENTITY_MATRIX,e.lineMatrix=n.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,t){const r=this.current;r.x=r.lineX+=e,r.y=r.lineY+=t,r.xcoords=[],r.ycoords=[],r.tspan=this.svgFactory.createElement("svg:tspan"),r.tspan.setAttributeNS(null,"font-family",r.fontFamily),r.tspan.setAttributeNS(null,"font-size",`${a(r.fontSize)}px`),r.tspan.setAttributeNS(null,"y",a(-r.y))}showText(t){const i=this.current,s=i.font,o=i.fontSize;if(0===o)return;const l=i.fontSizeScale,u=i.charSpacing,h=i.wordSpacing,d=i.fontDirection,p=i.textHScale*d,f=s.vertical,g=f?1:-1,m=s.defaultVMetrics,y=o*i.fontMatrix[0];let v=0;for(const e of t){if(null===e){v+=d*h;continue}if((0,n.isNum)(e)){v+=g*e*o/1e3;continue}const t=(e.isSpace?h:0)+u,r=e.fontChar;let a,c,p,_=e.width;if(f){let t;const r=e.vmetric||m;t=e.vmetric?r[1]:.5*_,t=-t*y;const n=r[2]*y;_=r?-r[0]:_,a=t/l,c=(v+n)/l}else a=v/l,c=0;(e.isInFont||s.missingFile)&&(i.xcoords.push(i.x+a),f&&i.ycoords.push(-i.y+c),i.tspan.textContent+=r),p=f?_*y-t*d:_*y+t*d,v+=p}i.tspan.setAttributeNS(null,"x",i.xcoords.map(a).join(" ")),f?i.tspan.setAttributeNS(null,"y",i.ycoords.map(a).join(" ")):i.tspan.setAttributeNS(null,"y",a(-i.y)),f?i.y-=v:i.x+=v*p,i.tspan.setAttributeNS(null,"font-family",i.fontFamily),i.tspan.setAttributeNS(null,"font-size",`${a(i.fontSize)}px`),i.fontStyle!==e.fontStyle&&i.tspan.setAttributeNS(null,"font-style",i.fontStyle),i.fontWeight!==e.fontWeight&&i.tspan.setAttributeNS(null,"font-weight",i.fontWeight);const _=i.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;if(_===n.TextRenderingMode.FILL||_===n.TextRenderingMode.FILL_STROKE?(i.fillColor!==e.fillColor&&i.tspan.setAttributeNS(null,"fill",i.fillColor),i.fillAlpha<1&&i.tspan.setAttributeNS(null,"fill-opacity",i.fillAlpha)):i.textRenderingMode===n.TextRenderingMode.ADD_TO_PATH?i.tspan.setAttributeNS(null,"fill","transparent"):i.tspan.setAttributeNS(null,"fill","none"),_===n.TextRenderingMode.STROKE||_===n.TextRenderingMode.FILL_STROKE){const e=1/(i.textMatrixScale||1);this._setStrokeAttributes(i.tspan,e)}let b=i.textMatrix;0!==i.textRise&&(b=b.slice(),b[5]+=i.textRise),i.txtElement.setAttributeNS(null,"transform",`${c(b)} scale(${a(p)}, -1)`),i.txtElement.setAttributeNS(r,"xml:space","preserve"),i.txtElement.appendChild(i.tspan),i.txtgrp.appendChild(i.txtElement),this._ensureTransformGroup().appendChild(i.txtElement)}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));const t=(0,n.createObjectURL)(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${e.loadedName}"; src: url(${t}); }\n`}setFont(e){const t=this.current,r=this.commonObjs.get(e[0]);let i=e[1];t.font=r,!this.embedFonts||r.missingFile||this.embeddedFonts[r.loadedName]||(this.addFontStyle(r),this.embeddedFonts[r.loadedName]=r),t.fontMatrix=r.fontMatrix?r.fontMatrix:n.FONT_IDENTITY_MATRIX;let s="normal";r.black?s="900":r.bold&&(s="bold");const o=r.italic?"italic":"normal";i<0?(i=-i,t.fontDirection=-1):t.fontDirection=1,t.fontSize=i,t.fontFamily=r.loadedName,t.fontWeight=s,t.fontStyle=o,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",a(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){const e=this.current;e.textRenderingMode&n.TextRenderingMode.ADD_TO_PATH_FLAG&&e.txtElement&&e.txtElement.hasChildNodes()&&(e.element=e.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=u[e]}setLineJoin(e){this.current.lineJoin=h[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,t,r){this.current.strokeColor=n.Util.makeCssRgb(e,t,r)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,t,r){this.current.fillColor=n.Util.makeCssRgb(e,t,r),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){const t=this.viewport.width,r=this.viewport.height,i=n.Util.inverseTransform(this.transformMatrix),s=n.Util.applyTransform([0,0],i),o=n.Util.applyTransform([0,r],i),a=n.Util.applyTransform([t,0],i),c=n.Util.applyTransform([t,r],i),l=Math.min(s[0],o[0],a[0],c[0]),u=Math.min(s[1],o[1],a[1],c[1]),h=Math.max(s[0],o[0],a[0],c[0]),d=Math.max(s[1],o[1],a[1],c[1]),p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",l),p.setAttributeNS(null,"y",u),p.setAttributeNS(null,"width",h-l),p.setAttributeNS(null,"height",d-u),p.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&p.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().appendChild(p)}_makeColorN_Pattern(e){return"TilingPattern"===e[0]?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){const t=e[1],r=e[2],i=e[3]||n.IDENTITY_MATRIX,[s,o,a,c]=e[4],l=e[5],u=e[6],h=e[7],d="shading"+m++,[p,f]=n.Util.applyTransform([s,o],i),[g,y]=n.Util.applyTransform([a,c],i),[v,_]=n.Util.singularValueDecompose2dScale(i),b=l*v,w=u*_,S=this.svgFactory.createElement("svg:pattern");S.setAttributeNS(null,"id",d),S.setAttributeNS(null,"patternUnits","userSpaceOnUse"),S.setAttributeNS(null,"width",b),S.setAttributeNS(null,"height",w),S.setAttributeNS(null,"x",`${p}`),S.setAttributeNS(null,"y",`${f}`);const k=this.svg,E=this.transformMatrix,x=this.current.fillColor,A=this.current.strokeColor,T=this.svgFactory.create(g-p,y-f);if(this.svg=T,this.transformMatrix=i,2===h){const e=n.Util.makeCssRgb(...t);this.current.fillColor=e,this.current.strokeColor=e}return this.executeOpTree(this.convertOpList(r)),this.svg=k,this.transformMatrix=E,this.current.fillColor=x,this.current.strokeColor=A,S.appendChild(T.childNodes[0]),this.defs.appendChild(S),`url(#${d})`}_makeShadingPattern(e){switch(e[0]){case"RadialAxial":const t="shading"+m++,r=e[3];let i;switch(e[1]){case"axial":const r=e[4],n=e[5];i=this.svgFactory.createElement("svg:linearGradient"),i.setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"x1",r[0]),i.setAttributeNS(null,"y1",r[1]),i.setAttributeNS(null,"x2",n[0]),i.setAttributeNS(null,"y2",n[1]);break;case"radial":const s=e[4],o=e[5],a=e[6],c=e[7];i=this.svgFactory.createElement("svg:radialGradient"),i.setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"cx",o[0]),i.setAttributeNS(null,"cy",o[1]),i.setAttributeNS(null,"r",c),i.setAttributeNS(null,"fx",s[0]),i.setAttributeNS(null,"fy",s[1]),i.setAttributeNS(null,"fr",a);break;default:throw new Error(`Unknown RadialAxial type: ${e[1]}`)}for(const e of r){const t=this.svgFactory.createElement("svg:stop");t.setAttributeNS(null,"offset",e[0]),t.setAttributeNS(null,"stop-color",e[1]),i.appendChild(t)}return this.defs.appendChild(i),`url(#${t})`;case"Mesh":return(0,n.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${e[0]}`)}}setDash(e,t){this.current.dashArray=e,this.current.dashPhase=t}constructPath(e,t){const r=this.current;let i=r.x,s=r.y,o=[],c=0;for(const r of e)switch(0|r){case n.OPS.rectangle:i=t[c++],s=t[c++];const e=i+t[c++],r=s+t[c++];o.push("M",a(i),a(s),"L",a(e),a(s),"L",a(e),a(r),"L",a(i),a(r),"Z");break;case n.OPS.moveTo:i=t[c++],s=t[c++],o.push("M",a(i),a(s));break;case n.OPS.lineTo:i=t[c++],s=t[c++],o.push("L",a(i),a(s));break;case n.OPS.curveTo:i=t[c+4],s=t[c+5],o.push("C",a(t[c]),a(t[c+1]),a(t[c+2]),a(t[c+3]),a(i),a(s)),c+=6;break;case n.OPS.curveTo2:o.push("C",a(i),a(s),a(t[c]),a(t[c+1]),a(t[c+2]),a(t[c+3])),i=t[c+2],s=t[c+3],c+=4;break;case n.OPS.curveTo3:i=t[c+2],s=t[c+3],o.push("C",a(t[c]),a(t[c+1]),a(i),a(s),a(i),a(s)),c+=4;break;case n.OPS.closePath:o.push("Z")}o=o.join(" "),r.path&&e.length>0&&e[0]!==n.OPS.rectangle&&e[0]!==n.OPS.moveTo?o=r.path.getAttributeNS(null,"d")+o:(r.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().appendChild(r.path)),r.path.setAttributeNS(null,"d",o),r.path.setAttributeNS(null,"fill","none"),r.element=r.path,r.setCurrentPoint(i,s)}endPath(){const e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element)return void(this.pendingClip=null);const t="clippath"+f++,r=this.svgFactory.createElement("svg:clipPath");r.setAttributeNS(null,"id",t),r.setAttributeNS(null,"transform",c(this.transformMatrix));const n=e.element.cloneNode(!0);"evenodd"===this.pendingClip?n.setAttributeNS(null,"clip-rule","evenodd"):n.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,r.appendChild(n),this.defs.appendChild(r),e.activeClipUrl&&(e.clipGroup=null,this.extraStack.forEach((function(e){e.clipGroup=null})),r.setAttributeNS(null,"clip-path",e.activeClipUrl)),e.activeClipUrl=`url(#${t})`,this.tgrp=null}clip(e){this.pendingClip=e}closePath(){const e=this.current;if(e.path){const t=`${e.path.getAttributeNS(null,"d")}Z`;e.path.setAttributeNS(null,"d",t)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r);break;case"CA":this.setStrokeAlpha(r);break;case"ca":this.setFillAlpha(r);break;default:(0,n.warn)(`Unimplemented graphic state operator ${t}`)}}fill(){const e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){const e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e,t=1){const r=this.current;let n=r.dashArray;1!==t&&n.length>0&&(n=n.map((function(e){return t*e}))),e.setAttributeNS(null,"stroke",r.strokeColor),e.setAttributeNS(null,"stroke-opacity",r.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",a(r.miterLimit)),e.setAttributeNS(null,"stroke-linecap",r.lineCap),e.setAttributeNS(null,"stroke-linejoin",r.lineJoin),e.setAttributeNS(null,"stroke-width",a(t*r.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",n.map(a).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",a(t*r.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().appendChild(e)}paintImageXObject(e){const t=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);t?this.paintInlineImageXObject(t):(0,n.warn)(`Dependent image with object ID ${e} is not ready yet`)}paintInlineImageXObject(e,t){const r=e.width,n=e.height,i=d(e,this.forceDataSchema,!!t),s=this.svgFactory.createElement("svg:rect");s.setAttributeNS(null,"x","0"),s.setAttributeNS(null,"y","0"),s.setAttributeNS(null,"width",a(r)),s.setAttributeNS(null,"height",a(n)),this.current.element=s,this.clip("nonzero");const o=this.svgFactory.createElement("svg:image");o.setAttributeNS(l,"xlink:href",i),o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y",a(-n)),o.setAttributeNS(null,"width",a(r)+"px"),o.setAttributeNS(null,"height",a(n)+"px"),o.setAttributeNS(null,"transform",`scale(${a(1/r)} ${a(-1/n)})`),t?t.appendChild(o):this._ensureTransformGroup().appendChild(o)}paintImageMaskXObject(e){const t=this.current,r=e.width,n=e.height,i=t.fillColor;t.maskId="mask"+g++;const s=this.svgFactory.createElement("svg:mask");s.setAttributeNS(null,"id",t.maskId);const o=this.svgFactory.createElement("svg:rect");o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y","0"),o.setAttributeNS(null,"width",a(r)),o.setAttributeNS(null,"height",a(n)),o.setAttributeNS(null,"fill",i),o.setAttributeNS(null,"mask",`url(#${t.maskId})`),this.defs.appendChild(s),this._ensureTransformGroup().appendChild(o),this.paintInlineImageXObject(e,s)}paintFormXObjectBegin(e,t){if(Array.isArray(e)&&6===e.length&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t){const e=t[2]-t[0],r=t[3]-t[1],n=this.svgFactory.createElement("svg:rect");n.setAttributeNS(null,"x",t[0]),n.setAttributeNS(null,"y",t[1]),n.setAttributeNS(null,"width",a(e)),n.setAttributeNS(null,"height",a(r)),this.current.element=n,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){const t=this.svgFactory.create(e.width,e.height),r=this.svgFactory.createElement("svg:defs");t.appendChild(r),this.defs=r;const n=this.svgFactory.createElement("svg:g");return n.setAttributeNS(null,"transform",c(e.transform)),t.appendChild(n),this.svg=n,t}_ensureClipGroup(){if(!this.current.clipGroup){const e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",c(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var n=r(2),i=r(23);const s=__webpack_require__(172),o=__webpack_require__(2001),a=__webpack_require__(3779),c=__webpack_require__(6558),l=/^file:\/\/\/[a-zA-Z]:\//;t.PDFNodeStream=class{constructor(e){this.source=e,this.url=function(e){const t=c.parse(e);return"file:"===t.protocol||t.host?t:/^[a-z]:[/\\]/i.test(e)?c.parse(`file:///${e}`):(t.host||(t.protocol="file:"),t)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?this._fullRequestReader._loaded:0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new g(this):new p(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=this.isFsUrl?new m(this,e,t):new f(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e),this._rangeRequestReaders.slice(0).forEach((function(t){t.cancel(e)}))}};class u{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return null===e?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class h{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return null===e?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class p extends u{constructor(e){super(e);const t=t=>{if(404===t.statusCode){const e=new n.MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const r=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:s,suggestedLength:o}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=o||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(r)};this._request=null,"http:"===this._url.protocol?this._request=o.request(d(this._url,e.httpHeaders),t):this._request=a.request(d(this._url,e.httpHeaders),t),this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class f extends h{constructor(e,t,r){super(e),this._httpHeaders={};for(const t in e.httpHeaders){const r=e.httpHeaders[t];void 0!==r&&(this._httpHeaders[t]=r)}this._httpHeaders.Range=`bytes=${t}-${r-1}`;const i=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{const e=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=o.request(d(this._url,this._httpHeaders),i):this._request=a.request(d(this._url,this._httpHeaders),i),this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class g extends u{constructor(e){super(e);let t=decodeURIComponent(this._url.path);l.test(this._url.href)&&(t=t.replace(/^\//,"")),s.lstat(t,((e,r)=>{if(e)return"ENOENT"===e.code&&(e=new n.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=r.size,this._setReadableStream(s.createReadStream(t)),this._headersCapability.resolve()}))}}class m extends h{constructor(e,t,r){super(e);let n=decodeURIComponent(this._url.path);l.test(this._url.href)&&(n=n.replace(/^\//,"")),this._setReadableStream(s.createReadStream(n,{start:t,end:r-1}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=function(e,t){return 404===e||0===e&&t.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+t+'".'):new n.UnexpectedResponseException("Unexpected server response ("+e+') while retrieving PDF "'+t+'".',e)},t.extractFilenameFromHeader=function(e){const t=e("Content-Disposition");if(t){let e=(0,i.getFilenameFromContentDispositionHeader)(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(e){}if(/\.pdf$/i.test(e))return e}return null},t.validateRangeRequestCapabilities=function({getResponseHeader:e,isHttp:t,rangeChunkSize:r,disableRange:i}){(0,n.assert)(r>0,"Range chunk size must be larger than zero");const s={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(e("Content-Length"),10);return Number.isInteger(o)?(s.suggestedLength=o,o<=2*r||i||!t||"bytes"!==e("Accept-Ranges")||"identity"!==(e("Content-Encoding")||"identity")||(s.allowRangeRequests=!0),s):s},t.validateResponseStatus=function(e){return 200===e||206===e};var n=r(2),i=r(24)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=function(e){let t=!0,r=n("filename\\*","i").exec(e);if(r){r=r[1];let e=o(r);return e=unescape(e),e=a(e),e=c(e),s(e)}if(r=function(e){const t=[];let r;const i=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(r=i.exec(e));){let[,e,n,i]=r;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[n,i]}const s=[];for(let e=0;e<t.length&&e in t;++e){let[r,n]=t[e];n=o(n),r&&(n=unescape(n),0===e&&(n=a(n))),s.push(n)}return s.join("")}(e),r)return s(c(r));if(r=n("filename","i").exec(e),r){r=r[1];let e=o(r);return e=c(e),s(e)}function n(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function i(e,r){if(e){if(!/^[\x00-\xFF]+$/.test(r))return r;try{const n=new TextDecoder(e,{fatal:!0}),i=Array.from(r,(function(e){return 255&e.charCodeAt(0)}));r=n.decode(new Uint8Array(i)),t=!1}catch(n){if(/^utf-?8$/i.test(e))try{r=decodeURIComponent(escape(r)),t=!1}catch(e){}}}return r}function s(e){return t&&/[\x80-\xff]/.test(e)&&(e=i("utf-8",e),t&&(e=i("iso-8859-1",e))),e}function o(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const r=t[e].indexOf('"');-1!==r&&(t[e]=t[e].slice(0,r),t.length=e+1),t[e]=t[e].replace(/\\(.)/g,"$1")}e=t.join('"')}return e}function a(e){const t=e.indexOf("'");return-1===t?e:i(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function c(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,r,n){if("q"===r||"Q"===r)return i(t,n=(n=n.replace(/_/g," ")).replace(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{n=atob(n)}catch(e){}return i(t,n)}))}return""}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var n=r(2),i=r(23);class s{constructor(e,t){this.url=e,t=t||{},this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||{},this.withCredentials=t.withCredentials||!1,this.getXhr=t.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,r){const n={begin:e,end:t};for(const e in r)n[e]=r[e];return this.request(n)}requestFull(e){return this.request(e)}request(e){const t=this.getXhr(),r=this.currXhrId++,n=this.pendingRequests[r]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const e in this.httpHeaders){const r=this.httpHeaders[e];void 0!==r&&t.setRequestHeader(e,r)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),n.expectedStatus=206):n.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(r){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,r),t.onprogress=this.onProgress.bind(this,r),n.onHeadersReceived=e.onHeadersReceived,n.onDone=e.onDone,n.onError=e.onError,n.onProgress=e.onProgress,t.send(null),r}onProgress(e,t){const r=this.pendingRequests[e];r&&r.onProgress&&r.onProgress(t)}onStateChange(e,t){const r=this.pendingRequests[e];if(!r)return;const i=r.xhr;if(i.readyState>=2&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),4!==i.readyState)return;if(!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===i.status&&this.isHttp)return void(r.onError&&r.onError(i.status));const s=i.status||200;if((200!==s||206!==r.expectedStatus)&&s!==r.expectedStatus)return void(r.onError&&r.onError(i.status));const o=function(e){const t=e.response;return"string"!=typeof t?t:(0,n.stringToBytes)(t).buffer}(i);if(206===s){const e=i.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);r.onDone({begin:parseInt(t[1],10),chunk:o})}else o?r.onDone({begin:0,chunk:o}):r.onError&&r.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}t.PDFNetworkStream=class{constructor(e){this._source=e,this._manager=new s(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new o(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const r=new a(this._manager,e,t);return r.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e),this._rangeRequestReaders.slice(0).forEach((function(t){t.cancel(e)}))}};class o{constructor(e,t){this._manager=e;const r={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(r),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),r=e=>t.getResponseHeader(e),{allowRangeRequests:n,suggestedLength:s}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,this._cachedChunks.length>0||(this._requests.forEach((function(e){e.resolve({value:void 0,done:!0})})),this._requests=[])}_onError(e){const t=this._url,r=(0,i.createResponseStatusError)(e,t);this._storedError=r,this._headersReceivedCapability.reject(r),this._requests.forEach((function(e){e.reject(r)})),this._requests=[],this._cachedChunks=[]}_onProgress(e){this.onProgress&&this.onProgress({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e),this._requests.forEach((function(e){e.resolve({value:void 0,done:!0})})),this._requests=[],this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class a{constructor(e,t,r){this._manager=e;const n={onDone:this._onDone.bind(this),onProgress:this._onProgress.bind(this)};this._requestId=e.requestRange(t,r,n),this._requests=[],this._queuedChunk=null,this._done=!1,this.onProgress=null,this.onClosed=null}_close(){this.onClosed&&this.onClosed(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0,this._requests.forEach((function(e){e.resolve({value:void 0,done:!0})})),this._requests=[],this._close()}_onProgress(e){!this.isStreamingSupported&&this.onProgress&&this.onProgress({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._requests.forEach((function(e){e.resolve({value:void 0,done:!0})})),this._requests=[],this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var n=r(2),i=r(23);function s(e,t,r){return{method:"GET",headers:e,signal:r&&r.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function o(e){const t=new Headers;for(const r in e){const n=e[r];void 0!==n&&t.append(r,n)}return t}t.PDFFetchStream=class{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?this._fullRequestReader._loaded:0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new a(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new c(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e),this._rangeRequestReaders.slice(0).forEach((function(t){t.cancel(e)}))}};class a{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=o(this._stream.httpHeaders);const r=t.url;fetch(r,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,i.validateResponseStatus)(e.status))throw(0,i.createResponseStatusError)(e.status,r);this._reader=e.body.getReader(),this._headersCapability.resolve();const t=t=>e.headers.get(t),{allowRangeRequests:s,suggestedLength:o}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=o||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}class c{constructor(e,t,r){this._stream=e,this._reader=null,this._loaded=0;const a=e.source;this._withCredentials=a.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!a.disableStream,"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${r-1}`);const c=a.url;fetch(c,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,i.validateResponseStatus)(e.status))throw(0,i.createResponseStatusError)(e.status,c);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch((e=>{if(!e||"AbortError"!==e.name)throw e})),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}}])},module.exports=factory()},2372:(e,t,r)=>{"use strict";var n=r(9299),i=r(2636);"undefined"!=typeof window&&"Worker"in window&&(n.GlobalWorkerOptions.workerPort=new i),e.exports=n},1353:(e,t,r)=>{"use strict";let n=r(1019);class i extends n{constructor(e){super(e),this.type="atrule"}append(...e){return this.proxyOf.nodes||(this.nodes=[]),super.append(...e)}prepend(...e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...e)}}e.exports=i,i.default=i,n.registerAtRule(i)},9932:(e,t,r)=>{"use strict";let n=r(5631);class i extends n{constructor(e){super(e),this.type="comment"}}e.exports=i,i.default=i},1019:(e,t,r)=>{"use strict";let n,i,s,o=r(4258),{isClean:a}=r(5513),c=r(9932),l=r(5631);function u(e){return e.map((e=>(e.nodes&&(e.nodes=u(e.nodes)),delete e.source,e)))}function h(e){if(e[a]=!1,e.proxyOf.nodes)for(let t of e.proxyOf.nodes)h(t)}function d(e){"atrule"===e.type?Object.setPrototypeOf(e,s.prototype):"rule"===e.type?Object.setPrototypeOf(e,i.prototype):"decl"===e.type?Object.setPrototypeOf(e,o.prototype):"comment"===e.type&&Object.setPrototypeOf(e,c.prototype),e.nodes&&e.nodes.forEach((e=>{d(e)}))}class p extends l{push(e){return e.parent=this,this.proxyOf.nodes.push(e),this}each(e){if(!this.proxyOf.nodes)return;let t,r,n=this.getIterator();for(;this.indexes[n]<this.proxyOf.nodes.length&&(t=this.indexes[n],r=e(this.proxyOf.nodes[t],t),!1!==r);)this.indexes[n]+=1;return delete this.indexes[n],r}walk(e){return this.each(((t,r)=>{let n;try{n=e(t,r)}catch(e){throw t.addToError(e)}return!1!==n&&t.walk&&(n=t.walk(e)),n}))}walkDecls(e,t){return t?e instanceof RegExp?this.walk(((r,n)=>{if("decl"===r.type&&e.test(r.prop))return t(r,n)})):this.walk(((r,n)=>{if("decl"===r.type&&r.prop===e)return t(r,n)})):(t=e,this.walk(((e,r)=>{if("decl"===e.type)return t(e,r)})))}walkRules(e,t){return t?e instanceof RegExp?this.walk(((r,n)=>{if("rule"===r.type&&e.test(r.selector))return t(r,n)})):this.walk(((r,n)=>{if("rule"===r.type&&r.selector===e)return t(r,n)})):(t=e,this.walk(((e,r)=>{if("rule"===e.type)return t(e,r)})))}walkAtRules(e,t){return t?e instanceof RegExp?this.walk(((r,n)=>{if("atrule"===r.type&&e.test(r.name))return t(r,n)})):this.walk(((r,n)=>{if("atrule"===r.type&&r.name===e)return t(r,n)})):(t=e,this.walk(((e,r)=>{if("atrule"===e.type)return t(e,r)})))}walkComments(e){return this.walk(((t,r)=>{if("comment"===t.type)return e(t,r)}))}append(...e){for(let t of e){let e=this.normalize(t,this.last);for(let t of e)this.proxyOf.nodes.push(t)}return this.markDirty(),this}prepend(...e){e=e.reverse();for(let t of e){let e=this.normalize(t,this.first,"prepend").reverse();for(let t of e)this.proxyOf.nodes.unshift(t);for(let t in this.indexes)this.indexes[t]=this.indexes[t]+e.length}return this.markDirty(),this}cleanRaws(e){if(super.cleanRaws(e),this.nodes)for(let t of this.nodes)t.cleanRaws(e)}insertBefore(e,t){let r,n=0===(e=this.index(e))&&"prepend",i=this.normalize(t,this.proxyOf.nodes[e],n).reverse();for(let t of i)this.proxyOf.nodes.splice(e,0,t);for(let t in this.indexes)r=this.indexes[t],e<=r&&(this.indexes[t]=r+i.length);return this.markDirty(),this}insertAfter(e,t){e=this.index(e);let r,n=this.normalize(t,this.proxyOf.nodes[e]).reverse();for(let t of n)this.proxyOf.nodes.splice(e+1,0,t);for(let t in this.indexes)r=this.indexes[t],e<r&&(this.indexes[t]=r+n.length);return this.markDirty(),this}removeChild(e){let t;e=this.index(e),this.proxyOf.nodes[e].parent=void 0,this.proxyOf.nodes.splice(e,1);for(let r in this.indexes)t=this.indexes[r],t>=e&&(this.indexes[r]=t-1);return this.markDirty(),this}removeAll(){for(let e of this.proxyOf.nodes)e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}replaceValues(e,t,r){return r||(r=t,t={}),this.walkDecls((n=>{t.props&&!t.props.includes(n.prop)||t.fast&&!n.value.includes(t.fast)||(n.value=n.value.replace(e,r))})),this.markDirty(),this}every(e){return this.nodes.every(e)}some(e){return this.nodes.some(e)}index(e){return"number"==typeof e?e:(e.proxyOf&&(e=e.proxyOf),this.proxyOf.nodes.indexOf(e))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}normalize(e,t){if("string"==typeof e)e=u(n(e).nodes);else if(Array.isArray(e)){e=e.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if("root"===e.type){e=e.nodes.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if(e.type)e=[e];else if(e.prop){if(void 0===e.value)throw new Error("Value field is missed in node creation");"string"!=typeof e.value&&(e.value=String(e.value)),e=[new o(e)]}else if(e.selector)e=[new i(e)];else if(e.name)e=[new s(e)];else{if(!e.text)throw new Error("Unknown node type in node creation");e=[new c(e)]}return e.map((e=>("function"!=typeof e.markDirty&&d(e),(e=e.proxyOf).parent&&e.parent.removeChild(e),e[a]&&h(e),void 0===e.raws.before&&t&&void 0!==t.raws.before&&(e.raws.before=t.raws.before.replace(/\S/g,"")),e.parent=this,e)))}getProxyProcessor(){return{set:(e,t,r)=>(e[t]===r||(e[t]=r,"name"!==t&&"params"!==t&&"selector"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:e[t]?"each"===t||"string"==typeof t&&t.startsWith("walk")?(...r)=>e[t](...r.map((e=>"function"==typeof e?(t,r)=>e(t.toProxy(),r):e))):"every"===t||"some"===t?r=>e[t](((e,...t)=>r(e.toProxy(),...t))):"root"===t?()=>e.root().toProxy():"nodes"===t?e.nodes.map((e=>e.toProxy())):"first"===t||"last"===t?e[t].toProxy():e[t]:e[t]}}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let e=this.lastEach;return this.indexes[e]=0,e}}p.registerParse=e=>{n=e},p.registerRule=e=>{i=e},p.registerAtRule=e=>{s=e},e.exports=p,p.default=p},2671:(e,t,r)=>{"use strict";let{red:n,bold:i,gray:s,options:o}=r(5574),a=r(2868);class c extends Error{constructor(e,t,r,n,i,s){super(e),this.name="CssSyntaxError",this.reason=e,i&&(this.file=i),n&&(this.source=n),s&&(this.plugin=s),void 0!==t&&void 0!==r&&(this.line=t,this.column=r),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,c)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",void 0!==this.line&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(e){if(!this.source)return"";let t=this.source;null==e&&(e=o.enabled),a&&e&&(t=a(t));let r,c,l=t.split(/\r?\n/),u=Math.max(this.line-3,0),h=Math.min(this.line+2,l.length),d=String(h).length;return e?(r=e=>i(n(e)),c=e=>s(e)):r=c=e=>e,l.slice(u,h).map(((e,t)=>{let n=u+1+t,i=" "+(" "+n).slice(-d)+" | ";if(n===this.line){let t=c(i.replace(/\d/g," "))+e.slice(0,this.column-1).replace(/[^\t]/g," ");return r(">")+c(i)+e+"\n "+t+r("^")}return" "+c(i)+e})).join("\n")}toString(){let e=this.showSourceCode();return e&&(e="\n\n"+e+"\n"),this.name+": "+this.message+e}}e.exports=c,c.default=c},4258:(e,t,r)=>{"use strict";let n=r(5631);class i extends n{constructor(e){e&&void 0!==e.value&&"string"!=typeof e.value&&(e={...e,value:String(e.value)}),super(e),this.type="decl"}get variable(){return this.prop.startsWith("--")||"$"===this.prop[0]}}e.exports=i,i.default=i},250:(e,t,r)=>{"use strict";let n=r(4258),i=r(7981),s=r(9932),o=r(1353),a=r(5995),c=r(1025),l=r(1675);function u(e,t){if(Array.isArray(e))return e.map((e=>u(e)));let{inputs:r,...h}=e;if(r){t=[];for(let e of r){let r={...e,__proto__:a.prototype};r.map&&(r.map={...r.map,__proto__:i.prototype}),t.push(r)}}if(h.nodes&&(h.nodes=e.nodes.map((e=>u(e,t)))),h.source){let{inputId:e,...r}=h.source;h.source=r,null!=e&&(h.source.input=t[e])}if("root"===h.type)return new c(h);if("decl"===h.type)return new n(h);if("rule"===h.type)return new l(h);if("comment"===h.type)return new s(h);if("atrule"===h.type)return new o(h);throw new Error("Unknown node type: "+e.type)}e.exports=u,u.default=u},5995:(e,t,r)=>{"use strict";let{fileURLToPath:n,pathToFileURL:i}=r(8575),{resolve:s,isAbsolute:o}=r(9830),{nanoid:a}=r(6394),c=r(2868),l=r(2671),u=r(7981),h=Symbol("fromOffset cache"),d=Boolean(s&&o);class p{constructor(e,t={}){if(null==e||"object"==typeof e&&!e.toString)throw new Error(`PostCSS received ${e} instead of CSS string`);if(this.css=e.toString(),"\ufeff"===this.css[0]||""===this.css[0]?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,t.from&&(!d||/^\w+:\/\//.test(t.from)||o(t.from)?this.file=t.from:this.file=s(t.from)),d){let e=new u(this.css,t);if(e.text){this.map=e;let t=e.consumer().file;!this.file&&t&&(this.file=this.mapResolve(t))}}this.file||(this.id="<input css "+a(6)+">"),this.map&&(this.map.file=this.from)}fromOffset(e){let t,r;if(this[h])r=this[h];else{let e=this.css.split("\n");r=new Array(e.length);let t=0;for(let n=0,i=e.length;n<i;n++)r[n]=t,t+=e[n].length+1;this[h]=r}t=r[r.length-1];let n=0;if(e>=t)n=r.length-1;else{let t,i=r.length-2;for(;n<i;)if(t=n+(i-n>>1),e<r[t])i=t-1;else{if(!(e>=r[t+1])){n=t;break}n=t+1}}return{line:n+1,col:e-r[n]+1}}error(e,t,r,n={}){let s;if(!r){let e=this.fromOffset(t);t=e.line,r=e.col}let o=this.origin(t,r);return s=o?new l(e,o.line,o.column,o.source,o.file,n.plugin):new l(e,t,r,this.css,this.file,n.plugin),s.input={line:t,column:r,source:this.css},this.file&&(s.input.url=i(this.file).toString(),s.input.file=this.file),s}origin(e,t){if(!this.map)return!1;let r,s=this.map.consumer(),a=s.originalPositionFor({line:e,column:t});if(!a.source)return!1;r=o(a.source)?i(a.source):new URL(a.source,this.map.consumer().sourceRoot||i(this.map.mapFile));let c={url:r.toString(),line:a.line,column:a.column};"file:"===r.protocol&&(c.file=n(r));let l=s.sourceContentFor(a.source);return l&&(c.source=l),c}mapResolve(e){return/^\w+:\/\//.test(e)?e:s(this.map.consumer().sourceRoot||this.map.root||".",e)}get from(){return this.file||this.id}toJSON(){let e={};for(let t of["hasBOM","css","file","id"])null!=this[t]&&(e[t]=this[t]);return this.map&&(e.map={...this.map},e.map.consumerCache&&(e.map.consumerCache=void 0)),e}}e.exports=p,p.default=p,c&&c.registerInput&&c.registerInput(p)},1939:(e,t,r)=>{"use strict";let n=r(8505),{isClean:i}=r(5513),s=r(7088),o=(r(2448),r(3632)),a=r(6939),c=r(1025);const l={root:"Root",atrule:"AtRule",rule:"Rule",decl:"Declaration",comment:"Comment"},u={postcssPlugin:!0,prepare:!0,Once:!0,Root:!0,Declaration:!0,Rule:!0,AtRule:!0,Comment:!0,DeclarationExit:!0,RuleExit:!0,AtRuleExit:!0,CommentExit:!0,RootExit:!0,OnceExit:!0},h={postcssPlugin:!0,prepare:!0,Once:!0};function d(e){return"object"==typeof e&&"function"==typeof e.then}function p(e){let t=!1,r=l[e.type];return"decl"===e.type?t=e.prop.toLowerCase():"atrule"===e.type&&(t=e.name.toLowerCase()),t&&e.append?[r,r+"-"+t,0,r+"Exit",r+"Exit-"+t]:t?[r,r+"-"+t,r+"Exit",r+"Exit-"+t]:e.append?[r,0,r+"Exit"]:[r,r+"Exit"]}function f(e){let t;return t="root"===e.type?["Root",0,"RootExit"]:p(e),{node:e,events:t,eventIndex:0,visitors:[],visitorIndex:0,iterator:0}}function g(e){return e[i]=!1,e.nodes&&e.nodes.forEach((e=>g(e))),e}let m={};class y{constructor(e,t,r){let n;if(this.stringified=!1,this.processed=!1,"object"==typeof t&&null!==t&&"root"===t.type)n=g(t);else if(t instanceof y||t instanceof o)n=g(t.root),t.map&&(void 0===r.map&&(r.map={}),r.map.inline||(r.map.inline=!1),r.map.prev=t.map);else{let e=a;r.syntax&&(e=r.syntax.parse),r.parser&&(e=r.parser),e.parse&&(e=e.parse);try{n=e(t,r)}catch(e){this.processed=!0,this.error=e}}this.result=new o(e,n,r),this.helpers={...m,result:this.result,postcss:m},this.plugins=this.processor.plugins.map((e=>"object"==typeof e&&e.prepare?{...e,...e.prepare(this.result)}:e))}get[Symbol.toStringTag](){return"LazyResult"}get processor(){return this.result.processor}get opts(){return this.result.opts}get css(){return this.stringify().css}get content(){return this.stringify().content}get map(){return this.stringify().map}get root(){return this.sync().root}get messages(){return this.sync().messages}warnings(){return this.sync().warnings()}toString(){return this.css}then(e,t){return this.async().then(e,t)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let e of this.plugins)if(d(this.runOnRoot(e)))throw this.getAsyncError();if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[i];)e[i]=!0,this.walkSync(e);this.listeners.OnceExit&&this.visitSync(this.listeners.OnceExit,e)}return this.result}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let e=this.result.opts,t=s;e.syntax&&(t=e.syntax.stringify),e.stringifier&&(t=e.stringifier),t.stringify&&(t=t.stringify);let r=new n(t,this.result.root,this.result.opts).generate();return this.result.css=r[0],this.result.map=r[1],this.result}walkSync(e){e[i]=!0;let t=p(e);for(let r of t)if(0===r)e.nodes&&e.each((e=>{e[i]||this.walkSync(e)}));else{let t=this.listeners[r];if(t&&this.visitSync(t,e.toProxy()))return}}visitSync(e,t){for(let[r,n]of e){let e;this.result.lastPlugin=r;try{e=n(t,this.helpers)}catch(e){throw this.handleError(e,t.proxyOf)}if("root"!==t.type&&!t.parent)return!0;if(d(e))throw this.getAsyncError()}}runOnRoot(e){this.result.lastPlugin=e;try{if("object"==typeof e&&e.Once)return e.Once(this.result.root,this.helpers);if("function"==typeof e)return e(this.result.root,this.result)}catch(e){throw this.handleError(e)}}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(e,t){let r=this.result.lastPlugin;try{t&&t.addToError(e),this.error=e,"CssSyntaxError"!==e.name||e.plugin?r.postcssVersion:(e.plugin=r.postcssPlugin,e.setMessage())}catch(e){console&&console.error&&console.error(e)}return e}async runAsync(){this.plugin=0;for(let e=0;e<this.plugins.length;e++){let t=this.plugins[e],r=this.runOnRoot(t);if(d(r))try{await r}catch(e){throw this.handleError(e)}}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[i];){e[i]=!0;let t=[f(e)];for(;t.length>0;){let e=this.visitTick(t);if(d(e))try{await e}catch(e){let r=t[t.length-1].node;throw this.handleError(e,r)}}}if(this.listeners.OnceExit)for(let[t,r]of this.listeners.OnceExit){this.result.lastPlugin=t;try{await r(e,this.helpers)}catch(e){throw this.handleError(e)}}}return this.processed=!0,this.stringify()}prepareVisitors(){this.listeners={};let e=(e,t,r)=>{this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push([e,r])};for(let t of this.plugins)if("object"==typeof t)for(let r in t){if(!u[r]&&/^[A-Z]/.test(r))throw new Error(`Unknown event ${r} in ${t.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!h[r])if("object"==typeof t[r])for(let n in t[r])e(t,"*"===n?r:r+"-"+n.toLowerCase(),t[r][n]);else"function"==typeof t[r]&&e(t,r,t[r])}this.hasListener=Object.keys(this.listeners).length>0}visitTick(e){let t=e[e.length-1],{node:r,visitors:n}=t;if("root"!==r.type&&!r.parent)return void e.pop();if(n.length>0&&t.visitorIndex<n.length){let[e,i]=n[t.visitorIndex];t.visitorIndex+=1,t.visitorIndex===n.length&&(t.visitors=[],t.visitorIndex=0),this.result.lastPlugin=e;try{return i(r.toProxy(),this.helpers)}catch(e){throw this.handleError(e,r)}}if(0!==t.iterator){let n,s=t.iterator;for(;n=r.nodes[r.indexes[s]];)if(r.indexes[s]+=1,!n[i])return n[i]=!0,void e.push(f(n));t.iterator=0,delete r.indexes[s]}let s=t.events;for(;t.eventIndex<s.length;){let e=s[t.eventIndex];if(t.eventIndex+=1,0===e)return void(r.nodes&&r.nodes.length&&(r[i]=!0,t.iterator=r.getIterator()));if(this.listeners[e])return void(t.visitors=this.listeners[e])}e.pop()}}y.registerPostcss=e=>{m=e},e.exports=y,y.default=y,c.registerLazyResult(y)},4715:e=>{"use strict";let t={split(e,t,r){let n=[],i="",s=!1,o=0,a=!1,c=!1;for(let r of e)c?c=!1:"\\"===r?c=!0:a?r===a&&(a=!1):'"'===r||"'"===r?a=r:"("===r?o+=1:")"===r?o>0&&(o-=1):0===o&&t.includes(r)&&(s=!0),s?(""!==i&&n.push(i.trim()),i="",s=!1):i+=r;return(r||""!==i)&&n.push(i.trim()),n},space:e=>t.split(e,[" ","\n","\t"]),comma:e=>t.split(e,[","],!0)};e.exports=t,t.default=t},8505:(e,t,r)=>{"use strict";let{dirname:n,resolve:i,relative:s,sep:o}=r(9830),{pathToFileURL:a}=r(8575),c=r(8068),l=Boolean(n,i,s,o);e.exports=class{constructor(e,t,r){this.stringify=e,this.mapOpts=r.map||{},this.root=t,this.opts=r}isMap(){return void 0!==this.opts.map?!!this.opts.map:this.previous().length>0}previous(){return this.previousMaps||(this.previousMaps=[],this.root.walk((e=>{if(e.source&&e.source.input.map){let t=e.source.input.map;this.previousMaps.includes(t)||this.previousMaps.push(t)}}))),this.previousMaps}isInline(){if(void 0!==this.mapOpts.inline)return this.mapOpts.inline;let e=this.mapOpts.annotation;return(void 0===e||!0===e)&&(!this.previous().length||this.previous().some((e=>e.inline)))}isSourcesContent(){return void 0!==this.mapOpts.sourcesContent?this.mapOpts.sourcesContent:!this.previous().length||this.previous().some((e=>e.withContent()))}clearAnnotation(){if(!1===this.mapOpts.annotation)return;let e;for(let t=this.root.nodes.length-1;t>=0;t--)e=this.root.nodes[t],"comment"===e.type&&0===e.text.indexOf("# sourceMappingURL=")&&this.root.removeChild(t)}setSourcesContent(){let e={};this.root.walk((t=>{if(t.source){let r=t.source.input.from;r&&!e[r]&&(e[r]=!0,this.map.setSourceContent(this.toUrl(this.path(r)),t.source.input.css))}}))}applyPrevMaps(){for(let e of this.previous()){let t,r=this.toUrl(this.path(e.file)),i=e.root||n(e.file);!1===this.mapOpts.sourcesContent?(t=new c.SourceMapConsumer(e.text),t.sourcesContent&&(t.sourcesContent=t.sourcesContent.map((()=>null)))):t=e.consumer(),this.map.applySourceMap(t,r,this.toUrl(this.path(i)))}}isAnnotation(){return!!this.isInline()||(void 0!==this.mapOpts.annotation?this.mapOpts.annotation:!this.previous().length||this.previous().some((e=>e.annotation)))}toBase64(e){return Buffer?Buffer.from(e).toString("base64"):window.btoa(unescape(encodeURIComponent(e)))}addAnnotation(){let e;e=this.isInline()?"data:application/json;base64,"+this.toBase64(this.map.toString()):"string"==typeof this.mapOpts.annotation?this.mapOpts.annotation:"function"==typeof this.mapOpts.annotation?this.mapOpts.annotation(this.opts.to,this.root):this.outputFile()+".map";let t="\n";this.css.includes("\r\n")&&(t="\r\n"),this.css+=t+"/*# sourceMappingURL="+e+" */"}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}generateMap(){return this.generateString(),this.isSourcesContent()&&this.setSourcesContent(),this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}path(e){if(0===e.indexOf("<"))return e;if(/^\w+:\/\//.test(e))return e;if(this.mapOpts.absolute)return e;let t=this.opts.to?n(this.opts.to):".";return"string"==typeof this.mapOpts.annotation&&(t=n(i(t,this.mapOpts.annotation))),s(t,e)}toUrl(e){return"\\"===o&&(e=e.replace(/\\/g,"/")),encodeURI(e).replace(/[#?]/g,encodeURIComponent)}sourcePath(e){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.mapOpts.absolute?a(e.source.input.from).toString():this.toUrl(this.path(e.source.input.from))}generateString(){this.css="",this.map=new c.SourceMapGenerator({file:this.outputFile()});let e,t,r=1,n=1,i="<no source>",s={source:"",generated:{line:0,column:0},original:{line:0,column:0}};this.stringify(this.root,((o,a,c)=>{if(this.css+=o,a&&"end"!==c&&(s.generated.line=r,s.generated.column=n-1,a.source&&a.source.start?(s.source=this.sourcePath(a),s.original.line=a.source.start.line,s.original.column=a.source.start.column-1,this.map.addMapping(s)):(s.source=i,s.original.line=1,s.original.column=0,this.map.addMapping(s))),e=o.match(/\n/g),e?(r+=e.length,t=o.lastIndexOf("\n"),n=o.length-t):n+=o.length,a&&"start"!==c){let e=a.parent||{raws:{}};("decl"!==a.type||a!==e.last||e.raws.semicolon)&&(a.source&&a.source.end?(s.source=this.sourcePath(a),s.original.line=a.source.end.line,s.original.column=a.source.end.column-1,s.generated.line=r,s.generated.column=n-2,this.map.addMapping(s)):(s.source=i,s.original.line=1,s.original.column=0,s.generated.line=r,s.generated.column=n-1,this.map.addMapping(s)))}}))}generate(){if(this.clearAnnotation(),l&&this.isMap())return this.generateMap();let e="";return this.stringify(this.root,(t=>{e+=t})),[e]}}},5631:(e,t,r)=>{"use strict";let n=r(2671),i=r(1062),{isClean:s}=r(5513),o=r(7088);function a(e,t){let r=new e.constructor;for(let n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;if("proxyCache"===n)continue;let i=e[n],s=typeof i;"parent"===n&&"object"===s?t&&(r[n]=t):"source"===n?r[n]=i:Array.isArray(i)?r[n]=i.map((e=>a(e,r))):("object"===s&&null!==i&&(i=a(i)),r[n]=i)}return r}class c{constructor(e={}){this.raws={},this[s]=!1;for(let t in e)if("nodes"===t){this.nodes=[];for(let r of e[t])"function"==typeof r.clone?this.append(r.clone()):this.append(r)}else this[t]=e[t]}error(e,t={}){if(this.source){let r=this.positionBy(t);return this.source.input.error(e,r.line,r.column,t)}return new n(e)}warn(e,t,r){let n={node:this};for(let e in r)n[e]=r[e];return e.warn(t,n)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}toString(e=o){e.stringify&&(e=e.stringify);let t="";return e(this,(e=>{t+=e})),t}clone(e={}){let t=a(this);for(let r in e)t[r]=e[r];return t}cloneBefore(e={}){let t=this.clone(e);return this.parent.insertBefore(this,t),t}cloneAfter(e={}){let t=this.clone(e);return this.parent.insertAfter(this,t),t}replaceWith(...e){if(this.parent){let t=this,r=!1;for(let n of e)n===this?r=!0:r?(this.parent.insertAfter(t,n),t=n):this.parent.insertBefore(t,n);r||this.remove()}return this}next(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e+1]}prev(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e-1]}before(e){return this.parent.insertBefore(this,e),this}after(e){return this.parent.insertAfter(this,e),this}root(){let e=this;for(;e.parent;)e=e.parent;return e}raw(e,t){return(new i).raw(this,e,t)}cleanRaws(e){delete this.raws.before,delete this.raws.after,e||delete this.raws.between}toJSON(e,t){let r={},n=null==t;t=t||new Map;let i=0;for(let e in this){if(!Object.prototype.hasOwnProperty.call(this,e))continue;if("parent"===e||"proxyCache"===e)continue;let n=this[e];if(Array.isArray(n))r[e]=n.map((e=>"object"==typeof e&&e.toJSON?e.toJSON(null,t):e));else if("object"==typeof n&&n.toJSON)r[e]=n.toJSON(null,t);else if("source"===e){let s=t.get(n.input);null==s&&(s=i,t.set(n.input,i),i++),r[e]={inputId:s,start:n.start,end:n.end}}else r[e]=n}return n&&(r.inputs=[...t.keys()].map((e=>e.toJSON()))),r}positionInside(e){let t=this.toString(),r=this.source.start.column,n=this.source.start.line;for(let i=0;i<e;i++)"\n"===t[i]?(r=1,n+=1):r+=1;return{line:n,column:r}}positionBy(e){let t=this.source.start;if(e.index)t=this.positionInside(e.index);else if(e.word){let r=this.toString().indexOf(e.word);-1!==r&&(t=this.positionInside(r))}return t}getProxyProcessor(){return{set:(e,t,r)=>(e[t]===r||(e[t]=r,"prop"!==t&&"value"!==t&&"name"!==t&&"params"!==t&&"important"!==t&&"text"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:"root"===t?()=>e.root().toProxy():e[t]}}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}addToError(e){if(e.postcssNode=this,e.stack&&this.source&&/\n\s{4}at /.test(e.stack)){let t=this.source;e.stack=e.stack.replace(/\n\s{4}at /,`$&${t.input.from}:${t.start.line}:${t.start.column}$&`)}return e}markDirty(){if(this[s]){this[s]=!1;let e=this;for(;e=e.parent;)e[s]=!1}}get proxyOf(){return this}}e.exports=c,c.default=c},6939:(e,t,r)=>{"use strict";let n=r(1019),i=r(8867),s=r(5995);function o(e,t){let r=new s(e,t),n=new i(r);try{n.parse()}catch(e){throw e}return n.root}e.exports=o,o.default=o,n.registerParse(o)},8867:(e,t,r)=>{"use strict";let n=r(4258),i=r(3852),s=r(9932),o=r(1353),a=r(1025),c=r(1675);e.exports=class{constructor(e){this.input=e,this.root=new a,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:e,start:{offset:0,line:1,column:1}}}createTokenizer(){this.tokenizer=i(this.input)}parse(){let e;for(;!this.tokenizer.endOfFile();)switch(e=this.tokenizer.nextToken(),e[0]){case"space":this.spaces+=e[1];break;case";":this.freeSemicolon(e);break;case"}":this.end(e);break;case"comment":this.comment(e);break;case"at-word":this.atrule(e);break;case"{":this.emptyRule(e);break;default:this.other(e)}this.endFile()}comment(e){let t=new s;this.init(t,e[2]),t.source.end=this.getPosition(e[3]||e[2]);let r=e[1].slice(2,-2);if(/^\s*$/.test(r))t.text="",t.raws.left=r,t.raws.right="";else{let e=r.match(/^(\s*)([^]*\S)(\s*)$/);t.text=e[2],t.raws.left=e[1],t.raws.right=e[3]}}emptyRule(e){let t=new c;this.init(t,e[2]),t.selector="",t.raws.between="",this.current=t}other(e){let t=!1,r=null,n=!1,i=null,s=[],o=e[1].startsWith("--"),a=[],c=e;for(;c;){if(r=c[0],a.push(c),"("===r||"["===r)i||(i=c),s.push("("===r?")":"]");else if(o&&n&&"{"===r)i||(i=c),s.push("}");else if(0===s.length){if(";"===r){if(n)return void this.decl(a,o);break}if("{"===r)return void this.rule(a);if("}"===r){this.tokenizer.back(a.pop()),t=!0;break}":"===r&&(n=!0)}else r===s[s.length-1]&&(s.pop(),0===s.length&&(i=null));c=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(t=!0),s.length>0&&this.unclosedBracket(i),t&&n){for(;a.length&&(c=a[a.length-1][0],"space"===c||"comment"===c);)this.tokenizer.back(a.pop());this.decl(a,o)}else this.unknownWord(a)}rule(e){e.pop();let t=new c;this.init(t,e[0][2]),t.raws.between=this.spacesAndCommentsFromEnd(e),this.raw(t,"selector",e),this.current=t}decl(e,t){let r=new n;this.init(r,e[0][2]);let i,s=e[e.length-1];for(";"===s[0]&&(this.semicolon=!0,e.pop()),r.source.end=this.getPosition(s[3]||s[2]);"word"!==e[0][0];)1===e.length&&this.unknownWord(e),r.raws.before+=e.shift()[1];for(r.source.start=this.getPosition(e[0][2]),r.prop="";e.length;){let t=e[0][0];if(":"===t||"space"===t||"comment"===t)break;r.prop+=e.shift()[1]}for(r.raws.between="";e.length;){if(i=e.shift(),":"===i[0]){r.raws.between+=i[1];break}"word"===i[0]&&/\w/.test(i[1])&&this.unknownWord([i]),r.raws.between+=i[1]}"_"!==r.prop[0]&&"*"!==r.prop[0]||(r.raws.before+=r.prop[0],r.prop=r.prop.slice(1));let o=this.spacesAndCommentsFromStart(e);this.precheckMissedSemicolon(e);for(let t=e.length-1;t>=0;t--){if(i=e[t],"!important"===i[1].toLowerCase()){r.important=!0;let n=this.stringFrom(e,t);n=this.spacesFromEnd(e)+n," !important"!==n&&(r.raws.important=n);break}if("important"===i[1].toLowerCase()){let n=e.slice(0),i="";for(let e=t;e>0;e--){let t=n[e][0];if(0===i.trim().indexOf("!")&&"space"!==t)break;i=n.pop()[1]+i}0===i.trim().indexOf("!")&&(r.important=!0,r.raws.important=i,e=n)}if("space"!==i[0]&&"comment"!==i[0])break}let a=e.some((e=>"space"!==e[0]&&"comment"!==e[0]));this.raw(r,"value",e),a?r.raws.between+=o:r.value=o+r.value,r.value.includes(":")&&!t&&this.checkMissedSemicolon(e)}atrule(e){let t,r,n,i=new o;i.name=e[1].slice(1),""===i.name&&this.unnamedAtrule(i,e),this.init(i,e[2]);let s=!1,a=!1,c=[],l=[];for(;!this.tokenizer.endOfFile();){if(t=(e=this.tokenizer.nextToken())[0],"("===t||"["===t?l.push("("===t?")":"]"):"{"===t&&l.length>0?l.push("}"):t===l[l.length-1]&&l.pop(),0===l.length){if(";"===t){i.source.end=this.getPosition(e[2]),this.semicolon=!0;break}if("{"===t){a=!0;break}if("}"===t){if(c.length>0){for(n=c.length-1,r=c[n];r&&"space"===r[0];)r=c[--n];r&&(i.source.end=this.getPosition(r[3]||r[2]))}this.end(e);break}c.push(e)}else c.push(e);if(this.tokenizer.endOfFile()){s=!0;break}}i.raws.between=this.spacesAndCommentsFromEnd(c),c.length?(i.raws.afterName=this.spacesAndCommentsFromStart(c),this.raw(i,"params",c),s&&(e=c[c.length-1],i.source.end=this.getPosition(e[3]||e[2]),this.spaces=i.raws.between,i.raws.between="")):(i.raws.afterName="",i.params=""),a&&(i.nodes=[],this.current=i)}end(e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(e[2]),this.current=this.current.parent):this.unexpectedClose(e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces}freeSemicolon(e){if(this.spaces+=e[1],this.current.nodes){let e=this.current.nodes[this.current.nodes.length-1];e&&"rule"===e.type&&!e.raws.ownSemicolon&&(e.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(e){let t=this.input.fromOffset(e);return{offset:e,line:t.line,column:t.col}}init(e,t){this.current.push(e),e.source={start:this.getPosition(t),input:this.input},e.raws.before=this.spaces,this.spaces="","comment"!==e.type&&(this.semicolon=!1)}raw(e,t,r){let n,i,s,o,a=r.length,c="",l=!0,u=/^([#.|])?(\w)+/i;for(let t=0;t<a;t+=1)n=r[t],i=n[0],"comment"!==i||"rule"!==e.type?"comment"===i||"space"===i&&t===a-1?l=!1:c+=n[1]:(o=r[t-1],s=r[t+1],"space"!==o[0]&&"space"!==s[0]&&u.test(o[1])&&u.test(s[1])?c+=n[1]:l=!1);if(!l){let n=r.reduce(((e,t)=>e+t[1]),"");e.raws[t]={value:c,raw:n}}e[t]=c}spacesAndCommentsFromEnd(e){let t,r="";for(;e.length&&(t=e[e.length-1][0],"space"===t||"comment"===t);)r=e.pop()[1]+r;return r}spacesAndCommentsFromStart(e){let t,r="";for(;e.length&&(t=e[0][0],"space"===t||"comment"===t);)r+=e.shift()[1];return r}spacesFromEnd(e){let t,r="";for(;e.length&&(t=e[e.length-1][0],"space"===t);)r=e.pop()[1]+r;return r}stringFrom(e,t){let r="";for(let n=t;n<e.length;n++)r+=e[n][1];return e.splice(t,e.length-t),r}colon(e){let t,r,n,i=0;for(let[s,o]of e.entries()){if(t=o,r=t[0],"("===r&&(i+=1),")"===r&&(i-=1),0===i&&":"===r){if(n){if("word"===n[0]&&"progid"===n[1])continue;return s}this.doubleColon(t)}n=t}return!1}unclosedBracket(e){throw this.input.error("Unclosed bracket",e[2])}unknownWord(e){throw this.input.error("Unknown word",e[0][2])}unexpectedClose(e){throw this.input.error("Unexpected }",e[2])}unclosedBlock(){let e=this.current.source.start;throw this.input.error("Unclosed block",e.line,e.column)}doubleColon(e){throw this.input.error("Double colon",e[2])}unnamedAtrule(e,t){throw this.input.error("At-rule without name",t[2])}precheckMissedSemicolon(){}checkMissedSemicolon(e){let t=this.colon(e);if(!1===t)return;let r,n=0;for(let i=t-1;i>=0&&(r=e[i],"space"===r[0]||(n+=1,2!==n));i--);throw this.input.error("Missed semicolon",r[2])}}},20:(e,t,r)=>{"use strict";let n=r(2671),i=r(4258),s=r(1939),o=r(1019),a=r(1723),c=r(7088),l=r(250),u=r(1728),h=r(9932),d=r(1353),p=r(3632),f=r(5995),g=r(6939),m=r(4715),y=r(1675),v=r(1025),_=r(5631);function b(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),new a(e)}b.plugin=function(e,t){function r(...r){let n=t(...r);return n.postcssPlugin=e,n.postcssVersion=(new a).version,n}let n;return console&&console.warn&&(console.warn(e+": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration"),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(e+":  postcss.plugin . :\nhttps://www.w3ctech.com/topic/2226")),Object.defineProperty(r,"postcss",{get:()=>(n||(n=r()),n)}),r.process=function(e,t,n){return b([r(n)]).process(e,t)},r},b.stringify=c,b.parse=g,b.fromJSON=l,b.list=m,b.comment=e=>new h(e),b.atRule=e=>new d(e),b.decl=e=>new i(e),b.rule=e=>new y(e),b.root=e=>new v(e),b.CssSyntaxError=n,b.Declaration=i,b.Container=o,b.Comment=h,b.Warning=u,b.AtRule=d,b.Result=p,b.Input=f,b.Rule=y,b.Root=v,b.Node=_,s.registerPostcss(b),e.exports=b,b.default=b},7981:(e,t,r)=>{"use strict";let{existsSync:n,readFileSync:i}=r(4777),{dirname:s,join:o}=r(9830),a=r(8068);class c{constructor(e,t){if(!1===t.map)return;this.loadAnnotation(e),this.inline=this.startWith(this.annotation,"data:");let r=t.map?t.map.prev:void 0,n=this.loadMap(t.from,r);!this.mapFile&&t.from&&(this.mapFile=t.from),this.mapFile&&(this.root=s(this.mapFile)),n&&(this.text=n)}consumer(){return this.consumerCache||(this.consumerCache=new a.SourceMapConsumer(this.text)),this.consumerCache}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}startWith(e,t){return!!e&&e.substr(0,t.length)===t}getAnnotationURL(e){return e.match(/\/\*\s*# sourceMappingURL=(.*)\s*\*\//)[1].trim()}loadAnnotation(e){let t=e.match(/\/\*\s*# sourceMappingURL=.*\s*\*\//gm);if(t&&t.length>0){let e=t[t.length-1];e&&(this.annotation=this.getAnnotationURL(e))}}decodeInline(e){if(/^data:application\/json;charset=utf-?8,/.test(e)||/^data:application\/json,/.test(e))return decodeURIComponent(e.substr(RegExp.lastMatch.length));if(/^data:application\/json;charset=utf-?8;base64,/.test(e)||/^data:application\/json;base64,/.test(e))return t=e.substr(RegExp.lastMatch.length),Buffer?Buffer.from(t,"base64").toString():window.atob(t);var t;let r=e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+r)}loadFile(e){if(this.root=s(e),n(e))return this.mapFile=e,i(e,"utf-8").toString().trim()}loadMap(e,t){if(!1===t)return!1;if(t){if("string"==typeof t)return t;if("function"!=typeof t){if(t instanceof a.SourceMapConsumer)return a.SourceMapGenerator.fromSourceMap(t).toString();if(t instanceof a.SourceMapGenerator)return t.toString();if(this.isMap(t))return JSON.stringify(t);throw new Error("Unsupported previous source map format: "+t.toString())}{let r=t(e);if(r){let e=this.loadFile(r);if(!e)throw new Error("Unable to load previous source map: "+r.toString());return e}}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let t=this.annotation;return e&&(t=o(s(e),t)),this.loadFile(t)}}}isMap(e){return"object"==typeof e&&("string"==typeof e.mappings||"string"==typeof e._mappings||Array.isArray(e.sections))}}e.exports=c,c.default=c},1723:(e,t,r)=>{"use strict";let n=r(1939),i=r(1025);class s{constructor(e=[]){this.version="8.2.9",this.plugins=this.normalize(e)}use(e){return this.plugins=this.plugins.concat(this.normalize([e])),this}process(e,t={}){return 0!==this.plugins.length||t.parser!==t.stringifier||t.hideNothingWarning,new n(this,e,t)}normalize(e){let t=[];for(let r of e)if(!0===r.postcss?r=r():r.postcss&&(r=r.postcss),"object"==typeof r&&Array.isArray(r.plugins))t=t.concat(r.plugins);else if("object"==typeof r&&r.postcssPlugin)t.push(r);else if("function"==typeof r)t.push(r);else if("object"!=typeof r||!r.parse&&!r.stringify)throw new Error(r+" is not a PostCSS plugin");return t}}e.exports=s,s.default=s,i.registerProcessor(s)},3632:(e,t,r)=>{"use strict";let n=r(1728);class i{constructor(e,t,r){this.processor=e,this.messages=[],this.root=t,this.opts=r,this.css=void 0,this.map=void 0}toString(){return this.css}warn(e,t={}){t.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(t.plugin=this.lastPlugin.postcssPlugin);let r=new n(e,t);return this.messages.push(r),r}warnings(){return this.messages.filter((e=>"warning"===e.type))}get content(){return this.css}}e.exports=i,i.default=i},1025:(e,t,r)=>{"use strict";let n,i,s=r(1019);class o extends s{constructor(e){super(e),this.type="root",this.nodes||(this.nodes=[])}removeChild(e,t){let r=this.index(e);return!t&&0===r&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[r].raws.before),super.removeChild(e)}normalize(e,t,r){let n=super.normalize(e);if(t)if("prepend"===r)this.nodes.length>1?t.raws.before=this.nodes[1].raws.before:delete t.raws.before;else if(this.first!==t)for(let e of n)e.raws.before=t.raws.before;return n}toResult(e={}){return new n(new i,this,e).stringify()}}o.registerLazyResult=e=>{n=e},o.registerProcessor=e=>{i=e},e.exports=o,o.default=o},1675:(e,t,r)=>{"use strict";let n=r(1019),i=r(4715);class s extends n{constructor(e){super(e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return i.comma(this.selector)}set selectors(e){let t=this.selector?this.selector.match(/,\s*/):null,r=t?t[0]:","+this.raw("between","beforeOpen");this.selector=e.join(r)}}e.exports=s,s.default=s,n.registerRule(s)},1062:e=>{"use strict";const t={colon:": ",indent:"    ",beforeDecl:"\n",beforeRule:"\n",beforeOpen:" ",beforeClose:"\n",beforeComment:"\n",after:"\n",emptyBody:"",commentLeft:" ",commentRight:" ",semicolon:!1};e.exports=class{constructor(e){this.builder=e}stringify(e,t){if(!this[e.type])throw new Error("Unknown AST node type "+e.type+". Maybe you need to change PostCSS stringifier.");this[e.type](e,t)}root(e){this.body(e),e.raws.after&&this.builder(e.raws.after)}comment(e){let t=this.raw(e,"left","commentLeft"),r=this.raw(e,"right","commentRight");this.builder("/*"+t+e.text+r+"*/",e)}decl(e,t){let r=this.raw(e,"between","colon"),n=e.prop+r+this.rawValue(e,"value");e.important&&(n+=e.raws.important||" !important"),t&&(n+=";"),this.builder(n,e)}rule(e){this.block(e,this.rawValue(e,"selector")),e.raws.ownSemicolon&&this.builder(e.raws.ownSemicolon,e,"end")}atrule(e,t){let r="@"+e.name,n=e.params?this.rawValue(e,"params"):"";if(void 0!==e.raws.afterName?r+=e.raws.afterName:n&&(r+=" "),e.nodes)this.block(e,r+n);else{let i=(e.raws.between||"")+(t?";":"");this.builder(r+n+i,e)}}body(e){let t=e.nodes.length-1;for(;t>0&&"comment"===e.nodes[t].type;)t-=1;let r=this.raw(e,"semicolon");for(let n=0;n<e.nodes.length;n++){let i=e.nodes[n],s=this.raw(i,"before");s&&this.builder(s),this.stringify(i,t!==n||r)}}block(e,t){let r,n=this.raw(e,"between","beforeOpen");this.builder(t+n+"{",e,"start"),e.nodes&&e.nodes.length?(this.body(e),r=this.raw(e,"after")):r=this.raw(e,"after","emptyBody"),r&&this.builder(r),this.builder("}",e,"end")}raw(e,r,n){let i;if(n||(n=r),r&&(i=e.raws[r],void 0!==i))return i;let s=e.parent;if("before"===n&&(!s||"root"===s.type&&s.first===e))return"";if(!s)return t[n];let o=e.root();if(o.rawCache||(o.rawCache={}),void 0!==o.rawCache[n])return o.rawCache[n];if("before"===n||"after"===n)return this.beforeAfter(e,n);{let t="raw"+((a=n)[0].toUpperCase()+a.slice(1));this[t]?i=this[t](o,e):o.walk((e=>{if(i=e.raws[r],void 0!==i)return!1}))}var a;return void 0===i&&(i=t[n]),o.rawCache[n]=i,i}rawSemicolon(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length&&"decl"===e.last.type&&(t=e.raws.semicolon,void 0!==t))return!1})),t}rawEmptyBody(e){let t;return e.walk((e=>{if(e.nodes&&0===e.nodes.length&&(t=e.raws.after,void 0!==t))return!1})),t}rawIndent(e){if(e.raws.indent)return e.raws.indent;let t;return e.walk((r=>{let n=r.parent;if(n&&n!==e&&n.parent&&n.parent===e&&void 0!==r.raws.before){let e=r.raws.before.split("\n");return t=e[e.length-1],t=t.replace(/\S/g,""),!1}})),t}rawBeforeComment(e,t){let r;return e.walkComments((e=>{if(void 0!==e.raws.before)return r=e.raws.before,r.includes("\n")&&(r=r.replace(/[^\n]+$/,"")),!1})),void 0===r?r=this.raw(t,null,"beforeDecl"):r&&(r=r.replace(/\S/g,"")),r}rawBeforeDecl(e,t){let r;return e.walkDecls((e=>{if(void 0!==e.raws.before)return r=e.raws.before,r.includes("\n")&&(r=r.replace(/[^\n]+$/,"")),!1})),void 0===r?r=this.raw(t,null,"beforeRule"):r&&(r=r.replace(/\S/g,"")),r}rawBeforeRule(e){let t;return e.walk((r=>{if(r.nodes&&(r.parent!==e||e.first!==r)&&void 0!==r.raws.before)return t=r.raws.before,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeClose(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length>0&&void 0!==e.raws.after)return t=e.raws.after,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeOpen(e){let t;return e.walk((e=>{if("decl"!==e.type&&(t=e.raws.between,void 0!==t))return!1})),t}rawColon(e){let t;return e.walkDecls((e=>{if(void 0!==e.raws.between)return t=e.raws.between.replace(/[^\s:]/g,""),!1})),t}beforeAfter(e,t){let r;r="decl"===e.type?this.raw(e,null,"beforeDecl"):"comment"===e.type?this.raw(e,null,"beforeComment"):"before"===t?this.raw(e,null,"beforeRule"):this.raw(e,null,"beforeClose");let n=e.parent,i=0;for(;n&&"root"!==n.type;)i+=1,n=n.parent;if(r.includes("\n")){let t=this.raw(e,null,"indent");if(t.length)for(let e=0;e<i;e++)r+=t}return r}rawValue(e,t){let r=e[t],n=e.raws[t];return n&&n.value===r?n.raw:r}}},7088:(e,t,r)=>{"use strict";let n=r(1062);function i(e,t){new n(t).stringify(e)}e.exports=i,i.default=i},5513:e=>{"use strict";e.exports.isClean=Symbol("isClean")},3852:e=>{"use strict";const t="'".charCodeAt(0),r='"'.charCodeAt(0),n="\\".charCodeAt(0),i="/".charCodeAt(0),s="\n".charCodeAt(0),o=" ".charCodeAt(0),a="\f".charCodeAt(0),c="\t".charCodeAt(0),l="\r".charCodeAt(0),u="[".charCodeAt(0),h="]".charCodeAt(0),d="(".charCodeAt(0),p=")".charCodeAt(0),f="{".charCodeAt(0),g="}".charCodeAt(0),m=";".charCodeAt(0),y="*".charCodeAt(0),v=":".charCodeAt(0),_="@".charCodeAt(0),b=/[\t\n\f\r "#'()/;[\\\]{}]/g,w=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,S=/.[\n"'(/\\]/,k=/[\da-f]/i;e.exports=function(e,E={}){let x,A,T,C,I,R,O,P,D,M,L=e.css.valueOf(),N=E.ignoreErrors,F=L.length,B=0,U=[],q=[];function j(t){throw e.error("Unclosed "+t,B)}return{back:function(e){q.push(e)},nextToken:function(e){if(q.length)return q.pop();if(B>=F)return;let E=!!e&&e.ignoreUnclosed;switch(x=L.charCodeAt(B),x){case s:case o:case c:case l:case a:A=B;do{A+=1,x=L.charCodeAt(A)}while(x===o||x===s||x===c||x===l||x===a);M=["space",L.slice(B,A)],B=A-1;break;case u:case h:case f:case g:case v:case m:case p:{let e=String.fromCharCode(x);M=[e,e,B];break}case d:if(P=U.length?U.pop()[1]:"",D=L.charCodeAt(B+1),"url"===P&&D!==t&&D!==r&&D!==o&&D!==s&&D!==c&&D!==a&&D!==l){A=B;do{if(R=!1,A=L.indexOf(")",A+1),-1===A){if(N||E){A=B;break}j("bracket")}for(O=A;L.charCodeAt(O-1)===n;)O-=1,R=!R}while(R);M=["brackets",L.slice(B,A+1),B,A],B=A}else A=L.indexOf(")",B+1),C=L.slice(B,A+1),-1===A||S.test(C)?M=["(","(",B]:(M=["brackets",C,B,A],B=A);break;case t:case r:T=x===t?"'":'"',A=B;do{if(R=!1,A=L.indexOf(T,A+1),-1===A){if(N||E){A=B+1;break}j("string")}for(O=A;L.charCodeAt(O-1)===n;)O-=1,R=!R}while(R);M=["string",L.slice(B,A+1),B,A],B=A;break;case _:b.lastIndex=B+1,b.test(L),A=0===b.lastIndex?L.length-1:b.lastIndex-2,M=["at-word",L.slice(B,A+1),B,A],B=A;break;case n:for(A=B,I=!0;L.charCodeAt(A+1)===n;)A+=1,I=!I;if(x=L.charCodeAt(A+1),I&&x!==i&&x!==o&&x!==s&&x!==c&&x!==l&&x!==a&&(A+=1,k.test(L.charAt(A)))){for(;k.test(L.charAt(A+1));)A+=1;L.charCodeAt(A+1)===o&&(A+=1)}M=["word",L.slice(B,A+1),B,A],B=A;break;default:x===i&&L.charCodeAt(B+1)===y?(A=L.indexOf("*/",B+2)+1,0===A&&(N||E?A=L.length:j("comment")),M=["comment",L.slice(B,A+1),B,A],B=A):(w.lastIndex=B+1,w.test(L),A=0===w.lastIndex?L.length-1:w.lastIndex-2,M=["word",L.slice(B,A+1),B,A],U.push(M),B=A)}return B++,M},endOfFile:function(){return 0===q.length&&B>=F},position:function(){return B}}}},2448:e=>{"use strict";let t={};e.exports=function(e){t[e]||(t[e]=!0,"undefined"!=typeof console&&console.warn&&console.warn(e))}},1728:e=>{"use strict";class t{constructor(e,t={}){if(this.type="warning",this.text=e,t.node&&t.node.source){let e=t.node.positionBy(t);this.line=e.line,this.column=e.column}for(let e in t)this[e]=t[e]}toString(){return this.node?this.node.error(this.text,{plugin:this.plugin,index:this.index,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}}e.exports=t,t.default=t},3478:(e,t,r)=>{var n=r(753),i=Object.prototype.hasOwnProperty,s="undefined"!=typeof Map;function o(){this._array=[],this._set=s?new Map:Object.create(null)}o.fromArray=function(e,t){for(var r=new o,n=0,i=e.length;n<i;n++)r.add(e[n],t);return r},o.prototype.size=function(){return s?this._set.size:Object.getOwnPropertyNames(this._set).length},o.prototype.add=function(e,t){var r=s?e:n.toSetString(e),o=s?this.has(e):i.call(this._set,r),a=this._array.length;o&&!t||this._array.push(e),o||(s?this._set.set(e,a):this._set[r]=a)},o.prototype.has=function(e){if(s)return this._set.has(e);var t=n.toSetString(e);return i.call(this._set,t)},o.prototype.indexOf=function(e){if(s){var t=this._set.get(e);if(t>=0)return t}else{var r=n.toSetString(e);if(i.call(this._set,r))return this._set[r]}throw new Error('"'+e+'" is not in the set.')},o.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},o.prototype.toArray=function(){return this._array.slice()},t.I=o},6965:(e,t,r)=>{var n=r(6274);t.encode=function(e){var t,r="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&i,(i>>>=5)>0&&(t|=32),r+=n.encode(t)}while(i>0);return r},t.decode=function(e,t,r){var i,s,o,a,c=e.length,l=0,u=0;do{if(t>=c)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(s=n.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));i=!!(32&s),l+=(s&=31)<<u,u+=5}while(i);r.value=(a=(o=l)>>1,1==(1&o)?-a:a),r.rest=t}},6274:(e,t)=>{var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<r.length)return r[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},4633:(e,t)=>{function r(e,n,i,s,o,a){var c=Math.floor((n-e)/2)+e,l=o(i,s[c],!0);return 0===l?c:l>0?n-c>1?r(c,n,i,s,o,a):a==t.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-e>1?r(e,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:e<0?-1:e}t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,n,i,s){if(0===n.length)return-1;var o=r(-1,n.length,e,n,i,s||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===i(n[o],n[o-1],!0);)--o;return o}},725:(e,t,r)=>{var n=r(753);function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){var t,r,i,s,o,a;r=e,i=(t=this._last).generatedLine,s=r.generatedLine,o=t.generatedColumn,a=r.generatedColumn,s>i||s==i&&a>=o||n.compareByGeneratedPositionsInflated(t,r)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(n.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.H=i},800:(e,t)=>{function r(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function n(e,t,i,s){if(i<s){var o=i-1;r(e,(u=i,h=s,Math.round(u+Math.random()*(h-u))),s);for(var a=e[s],c=i;c<s;c++)t(e[c],a)<=0&&r(e,o+=1,c);r(e,o+1,c);var l=o+1;n(e,t,i,l-1),n(e,t,l+1,s)}var u,h}t.U=function(e,t){n(e,t,0,e.length-1)}},9793:(e,t,r)=>{var n=r(753),i=r(4633),s=r(3478).I,o=r(6965),a=r(800).U;function c(e,t){var r=e;return"string"==typeof e&&(r=n.parseSourceMapInput(e)),null!=r.sections?new h(r,t):new l(r,t)}function l(e,t){var r=e;"string"==typeof e&&(r=n.parseSourceMapInput(e));var i=n.getArg(r,"version"),o=n.getArg(r,"sources"),a=n.getArg(r,"names",[]),c=n.getArg(r,"sourceRoot",null),l=n.getArg(r,"sourcesContent",null),u=n.getArg(r,"mappings"),h=n.getArg(r,"file",null);if(i!=this._version)throw new Error("Unsupported version: "+i);c&&(c=n.normalize(c)),o=o.map(String).map(n.normalize).map((function(e){return c&&n.isAbsolute(c)&&n.isAbsolute(e)?n.relative(c,e):e})),this._names=s.fromArray(a.map(String),!0),this._sources=s.fromArray(o,!0),this._absoluteSources=this._sources.toArray().map((function(e){return n.computeSourceURL(c,e,t)})),this.sourceRoot=c,this.sourcesContent=l,this._mappings=u,this._sourceMapURL=t,this.file=h}function u(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function h(e,t){var r=e;"string"==typeof e&&(r=n.parseSourceMapInput(e));var i=n.getArg(r,"version"),o=n.getArg(r,"sections");if(i!=this._version)throw new Error("Unsupported version: "+i);this._sources=new s,this._names=new s;var a={line:-1,column:0};this._sections=o.map((function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var r=n.getArg(e,"offset"),i=n.getArg(r,"line"),s=n.getArg(r,"column");if(i<a.line||i===a.line&&s<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=r,{generatedOffset:{generatedLine:i+1,generatedColumn:s+1},consumer:new c(n.getArg(e,"map"),t)}}))}c.fromSourceMap=function(e,t){return l.fromSourceMap(e,t)},c.prototype._version=3,c.prototype.__generatedMappings=null,Object.defineProperty(c.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),c.prototype.__originalMappings=null,Object.defineProperty(c.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),c.prototype._charIsMappingSeparator=function(e,t){var r=e.charAt(t);return";"===r||","===r},c.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},c.GENERATED_ORDER=1,c.ORIGINAL_ORDER=2,c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.prototype.eachMapping=function(e,t,r){var i,s=t||null;switch(r||c.GENERATED_ORDER){case c.GENERATED_ORDER:i=this._generatedMappings;break;case c.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var o=this.sourceRoot;i.map((function(e){var t=null===e.source?null:this._sources.at(e.source);return{source:t=n.computeSourceURL(o,t,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}}),this).forEach(e,s)},c.prototype.allGeneratedPositionsFor=function(e){var t=n.getArg(e,"line"),r={source:n.getArg(e,"source"),originalLine:t,originalColumn:n.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];var s=[],o=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(o>=0){var a=this._originalMappings[o];if(void 0===e.column)for(var c=a.originalLine;a&&a.originalLine===c;)s.push({line:n.getArg(a,"generatedLine",null),column:n.getArg(a,"generatedColumn",null),lastColumn:n.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++o];else for(var l=a.originalColumn;a&&a.originalLine===t&&a.originalColumn==l;)s.push({line:n.getArg(a,"generatedLine",null),column:n.getArg(a,"generatedColumn",null),lastColumn:n.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++o]}return s},t.SourceMapConsumer=c,l.prototype=Object.create(c.prototype),l.prototype.consumer=c,l.prototype._findSourceIndex=function(e){var t,r=e;if(null!=this.sourceRoot&&(r=n.relative(this.sourceRoot,r)),this._sources.has(r))return this._sources.indexOf(r);for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==e)return t;return-1},l.fromSourceMap=function(e,t){var r=Object.create(l.prototype),i=r._names=s.fromArray(e._names.toArray(),!0),o=r._sources=s.fromArray(e._sources.toArray(),!0);r.sourceRoot=e._sourceRoot,r.sourcesContent=e._generateSourcesContent(r._sources.toArray(),r.sourceRoot),r.file=e._file,r._sourceMapURL=t,r._absoluteSources=r._sources.toArray().map((function(e){return n.computeSourceURL(r.sourceRoot,e,t)}));for(var c=e._mappings.toArray().slice(),h=r.__generatedMappings=[],d=r.__originalMappings=[],p=0,f=c.length;p<f;p++){var g=c[p],m=new u;m.generatedLine=g.generatedLine,m.generatedColumn=g.generatedColumn,g.source&&(m.source=o.indexOf(g.source),m.originalLine=g.originalLine,m.originalColumn=g.originalColumn,g.name&&(m.name=i.indexOf(g.name)),d.push(m)),h.push(m)}return a(r.__originalMappings,n.compareByOriginalPositions),r},l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),l.prototype._parseMappings=function(e,t){for(var r,i,s,c,l,h=1,d=0,p=0,f=0,g=0,m=0,y=e.length,v=0,_={},b={},w=[],S=[];v<y;)if(";"===e.charAt(v))h++,v++,d=0;else if(","===e.charAt(v))v++;else{for((r=new u).generatedLine=h,c=v;c<y&&!this._charIsMappingSeparator(e,c);c++);if(s=_[i=e.slice(v,c)])v+=i.length;else{for(s=[];v<c;)o.decode(e,v,b),l=b.value,v=b.rest,s.push(l);if(2===s.length)throw new Error("Found a source, but no line and column");if(3===s.length)throw new Error("Found a source and line, but no column");_[i]=s}r.generatedColumn=d+s[0],d=r.generatedColumn,s.length>1&&(r.source=g+s[1],g+=s[1],r.originalLine=p+s[2],p=r.originalLine,r.originalLine+=1,r.originalColumn=f+s[3],f=r.originalColumn,s.length>4&&(r.name=m+s[4],m+=s[4])),S.push(r),"number"==typeof r.originalLine&&w.push(r)}a(S,n.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,a(w,n.compareByOriginalPositions),this.__originalMappings=w},l.prototype._findMapping=function(e,t,r,n,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[n]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[n]);return i.search(e,t,s,o)},l.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},l.prototype.originalPositionFor=function(e){var t={generatedLine:n.getArg(e,"line"),generatedColumn:n.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",n.compareByGeneratedPositionsDeflated,n.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(r>=0){var i=this._generatedMappings[r];if(i.generatedLine===t.generatedLine){var s=n.getArg(i,"source",null);null!==s&&(s=this._sources.at(s),s=n.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));var o=n.getArg(i,"name",null);return null!==o&&(o=this._names.at(o)),{source:s,line:n.getArg(i,"originalLine",null),column:n.getArg(i,"originalColumn",null),name:o}}}return{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))},l.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];var i,s=e;if(null!=this.sourceRoot&&(s=n.relative(this.sourceRoot,s)),null!=this.sourceRoot&&(i=n.urlParse(this.sourceRoot))){var o=s.replace(/^file:\/\//,"");if("file"==i.scheme&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||"/"==i.path)&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(t)return null;throw new Error('"'+s+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(e){var t=n.getArg(e,"source");if((t=this._findSourceIndex(t))<0)return{line:null,column:null,lastColumn:null};var r={source:t,originalLine:n.getArg(e,"line"),originalColumn:n.getArg(e,"column")},i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,n.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(i>=0){var s=this._originalMappings[i];if(s.source===r.source)return{line:n.getArg(s,"generatedLine",null),column:n.getArg(s,"generatedColumn",null),lastColumn:n.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},h.prototype=Object.create(c.prototype),h.prototype.constructor=c,h.prototype._version=3,Object.defineProperty(h.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),h.prototype.originalPositionFor=function(e){var t={generatedLine:n.getArg(e,"line"),generatedColumn:n.getArg(e,"column")},r=i.search(t,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),s=this._sections[r];return s?s.consumer.originalPositionFor({line:t.generatedLine-(s.generatedOffset.generatedLine-1),column:t.generatedColumn-(s.generatedOffset.generatedLine===t.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},h.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},h.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var n=this._sections[r].consumer.sourceContentFor(e,!0);if(n)return n}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},h.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer._findSourceIndex(n.getArg(e,"source"))){var i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},h.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var i=this._sections[r],s=i.consumer._generatedMappings,o=0;o<s.length;o++){var c=s[o],l=i.consumer._sources.at(c.source);l=n.computeSourceURL(i.consumer.sourceRoot,l,this._sourceMapURL),this._sources.add(l),l=this._sources.indexOf(l);var u=null;c.name&&(u=i.consumer._names.at(c.name),this._names.add(u),u=this._names.indexOf(u));var h={source:l,generatedLine:c.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:c.generatedColumn+(i.generatedOffset.generatedLine===c.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:c.originalLine,originalColumn:c.originalColumn,name:u};this.__generatedMappings.push(h),"number"==typeof h.originalLine&&this.__originalMappings.push(h)}a(this.__generatedMappings,n.compareByGeneratedPositionsDeflated),a(this.__originalMappings,n.compareByOriginalPositions)}},8715:(e,t,r)=>{var n=r(6965),i=r(753),s=r(3478).I,o=r(725).H;function a(e){e||(e={}),this._file=i.getArg(e,"file",null),this._sourceRoot=i.getArg(e,"sourceRoot",null),this._skipValidation=i.getArg(e,"skipValidation",!1),this._sources=new s,this._names=new s,this._mappings=new o,this._sourcesContents=null}a.prototype._version=3,a.fromSourceMap=function(e){var t=e.sourceRoot,r=new a({file:e.file,sourceRoot:t});return e.eachMapping((function(e){var n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=t&&(n.source=i.relative(t,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),r.addMapping(n)})),e.sources.forEach((function(n){var s=n;null!==t&&(s=i.relative(t,n)),r._sources.has(s)||r._sources.add(s);var o=e.sourceContentFor(n);null!=o&&r.setSourceContent(n,o)})),r},a.prototype.addMapping=function(e){var t=i.getArg(e,"generated"),r=i.getArg(e,"original",null),n=i.getArg(e,"source",null),s=i.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,n,s),null!=n&&(n=String(n),this._sources.has(n)||this._sources.add(n)),null!=s&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:n,name:s})},a.prototype.setSourceContent=function(e,t){var r=e;null!=this._sourceRoot&&(r=i.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[i.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[i.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},a.prototype.applySourceMap=function(e,t,r){var n=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');n=e.file}var o=this._sourceRoot;null!=o&&(n=i.relative(o,n));var a=new s,c=new s;this._mappings.unsortedForEach((function(t){if(t.source===n&&null!=t.originalLine){var s=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=s.source&&(t.source=s.source,null!=r&&(t.source=i.join(r,t.source)),null!=o&&(t.source=i.relative(o,t.source)),t.originalLine=s.line,t.originalColumn=s.column,null!=s.name&&(t.name=s.name))}var l=t.source;null==l||a.has(l)||a.add(l);var u=t.name;null==u||c.has(u)||c.add(u)}),this),this._sources=a,this._names=c,e.sources.forEach((function(t){var n=e.sourceContentFor(t);null!=n&&(null!=r&&(t=i.join(r,t)),null!=o&&(t=i.relative(o,t)),this.setSourceContent(t,n))}),this)},a.prototype._validateMapping=function(e,t,r,n){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||r||n)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:n}))},a.prototype._serializeMappings=function(){for(var e,t,r,s,o=0,a=1,c=0,l=0,u=0,h=0,d="",p=this._mappings.toArray(),f=0,g=p.length;f<g;f++){if(e="",(t=p[f]).generatedLine!==a)for(o=0;t.generatedLine!==a;)e+=";",a++;else if(f>0){if(!i.compareByGeneratedPositionsInflated(t,p[f-1]))continue;e+=","}e+=n.encode(t.generatedColumn-o),o=t.generatedColumn,null!=t.source&&(s=this._sources.indexOf(t.source),e+=n.encode(s-h),h=s,e+=n.encode(t.originalLine-1-l),l=t.originalLine-1,e+=n.encode(t.originalColumn-c),c=t.originalColumn,null!=t.name&&(r=this._names.indexOf(t.name),e+=n.encode(r-u),u=r)),d+=e}return d},a.prototype._generateSourcesContent=function(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=i.relative(t,e));var r=i.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null}),this)},a.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},a.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=a},4044:(e,t,r)=>{var n=r(8715).SourceMapGenerator,i=r(753),s=/(\r?\n)/,o="$$$isSourceNode$$$";function a(e,t,r,n,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==i?null:i,this[o]=!0,null!=n&&this.add(n)}a.fromStringWithSourceMap=function(e,t,r){var n=new a,o=e.split(s),c=0,l=function(){return e()+(e()||"");function e(){return c<o.length?o[c++]:void 0}},u=1,h=0,d=null;return t.eachMapping((function(e){if(null!==d){if(!(u<e.generatedLine)){var t=(r=o[c]||"").substr(0,e.generatedColumn-h);return o[c]=r.substr(e.generatedColumn-h),h=e.generatedColumn,p(d,t),void(d=e)}p(d,l()),u++,h=0}for(;u<e.generatedLine;)n.add(l()),u++;if(h<e.generatedColumn){var r=o[c]||"";n.add(r.substr(0,e.generatedColumn)),o[c]=r.substr(e.generatedColumn),h=e.generatedColumn}d=e}),this),c<o.length&&(d&&p(d,l()),n.add(o.splice(c).join(""))),t.sources.forEach((function(e){var s=t.sourceContentFor(e);null!=s&&(null!=r&&(e=i.join(r,e)),n.setSourceContent(e,s))})),n;function p(e,t){if(null===e||void 0===e.source)n.add(t);else{var s=r?i.join(r,e.source):e.source;n.add(new a(e.originalLine,e.originalColumn,s,t,e.name))}}},a.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[o]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},a.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[o]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},a.prototype.walk=function(e){for(var t,r=0,n=this.children.length;r<n;r++)(t=this.children[r])[o]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},a.prototype.join=function(e){var t,r,n=this.children.length;if(n>0){for(t=[],r=0;r<n-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},a.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[o]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},a.prototype.setSourceContent=function(e,t){this.sourceContents[i.toSetString(e)]=t},a.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;t<r;t++)this.children[t][o]&&this.children[t].walkSourceContents(e);var n=Object.keys(this.sourceContents);for(t=0,r=n.length;t<r;t++)e(i.fromSetString(n[t]),this.sourceContents[n[t]])},a.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},a.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new n(e),i=!1,s=null,o=null,a=null,c=null;return this.walk((function(e,n){t.code+=e,null!==n.source&&null!==n.line&&null!==n.column?(s===n.source&&o===n.line&&a===n.column&&c===n.name||r.addMapping({source:n.source,original:{line:n.line,column:n.column},generated:{line:t.line,column:t.column},name:n.name}),s=n.source,o=n.line,a=n.column,c=n.name,i=!0):i&&(r.addMapping({generated:{line:t.line,column:t.column}}),s=null,i=!1);for(var l=0,u=e.length;l<u;l++)10===e.charCodeAt(l)?(t.line++,t.column=0,l+1===u?(s=null,i=!1):i&&r.addMapping({source:n.source,original:{line:n.line,column:n.column},generated:{line:t.line,column:t.column},name:n.name})):t.column++})),this.walkSourceContents((function(e,t){r.setSourceContent(e,t)})),{code:t.code,map:r}},t.SourceNode=a},753:(e,t)=>{t.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,n=/^data:.+\,.+$/;function i(e){var t=e.match(r);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function s(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e){var r=e,n=i(e);if(n){if(!n.path)return e;r=n.path}for(var o,a=t.isAbsolute(r),c=r.split(/\/+/),l=0,u=c.length-1;u>=0;u--)"."===(o=c[u])?c.splice(u,1):".."===o?l++:l>0&&(""===o?(c.splice(u+1,l),l=0):(c.splice(u,2),l--));return""===(r=c.join("/"))&&(r=a?"/":"."),n?(n.path=r,s(n)):r}function a(e,t){""===e&&(e="."),""===t&&(t=".");var r=i(t),a=i(e);if(a&&(e=a.path||"/"),r&&!r.scheme)return a&&(r.scheme=a.scheme),s(r);if(r||t.match(n))return t;if(a&&!a.host&&!a.path)return a.host=t,s(a);var c="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=c,s(a)):c}t.urlParse=i,t.urlGenerate=s,t.normalize=o,t.join=a,t.isAbsolute=function(e){return"/"===e.charAt(0)||r.test(e)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var r=0;0!==t.indexOf(e+"/");){var n=e.lastIndexOf("/");if(n<0)return t;if((e=e.slice(0,n)).match(/^([^\/]+:\/)?\/*$/))return t;++r}return Array(r+1).join("../")+t.substr(e.length+1)};var c=!("__proto__"in Object.create(null));function l(e){return e}function u(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function h(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}t.toSetString=c?l:function(e){return u(e)?"$"+e:e},t.fromSetString=c?l:function(e){return u(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,r){var n=h(e.source,t.source);return 0!==n||0!=(n=e.originalLine-t.originalLine)||0!=(n=e.originalColumn-t.originalColumn)||r||0!=(n=e.generatedColumn-t.generatedColumn)||0!=(n=e.generatedLine-t.generatedLine)?n:h(e.name,t.name)},t.compareByGeneratedPositionsDeflated=function(e,t,r){var n=e.generatedLine-t.generatedLine;return 0!==n||0!=(n=e.generatedColumn-t.generatedColumn)||r||0!==(n=h(e.source,t.source))||0!=(n=e.originalLine-t.originalLine)||0!=(n=e.originalColumn-t.originalColumn)?n:h(e.name,t.name)},t.compareByGeneratedPositionsInflated=function(e,t){var r=e.generatedLine-t.generatedLine;return 0!==r||0!=(r=e.generatedColumn-t.generatedColumn)||0!==(r=h(e.source,t.source))||0!=(r=e.originalLine-t.originalLine)||0!=(r=e.originalColumn-t.originalColumn)?r:h(e.name,t.name)},t.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(e,t,r){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),r){var n=i(r);if(!n)throw new Error("sourceMapURL could not be parsed");if(n.path){var c=n.path.lastIndexOf("/");c>=0&&(n.path=n.path.substring(0,c+1))}t=a(s(n),t)}return o(t)}},8068:(e,t,r)=>{t.SourceMapGenerator=r(8715).SourceMapGenerator,t.SourceMapConsumer=r(9793).SourceMapConsumer,t.SourceNode=r(4044).SourceNode},5798:e=>{"use strict";var t=String.prototype.replace,r=/%20/g,n="RFC3986";e.exports={default:n,formatters:{RFC1738:function(e){return t.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:n}},129:(e,t,r)=>{"use strict";var n=r(8261),i=r(5235),s=r(5798);e.exports={formats:s,parse:i,stringify:n}},5235:(e,t,r)=>{"use strict";var n=r(2769),i=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t,r,n){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=r.depth>0&&/(\[[^[\]]*])/.exec(s),l=a?s.slice(0,a.index):s,u=[];if(l){if(!r.plainObjects&&i.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var h=0;r.depth>0&&null!==(a=o.exec(s))&&h<r.depth;){if(h+=1,!r.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+s.slice(a.index)+"]"),function(e,t,r,n){for(var i=n?t:c(t,r),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&r.parseArrays)o=[].concat(i);else{o=r.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(l,10);r.parseArrays||""!==l?!isNaN(u)&&a!==l&&String(u)===l&&u>=0&&r.parseArrays&&u<=r.arrayLimit?(o=[])[u]=i:o[l]=i:o={0:i}}i=o}return i}(u,t,r,n)}};e.exports=function(e,t){var r=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var r,l={},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,h=t.parameterLimit===1/0?void 0:t.parameterLimit,d=u.split(t.delimiter,h),p=-1,f=t.charset;if(t.charsetSentinel)for(r=0;r<d.length;++r)0===d[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[r]?f="utf-8":"utf8=%26%2310003%3B"===d[r]&&(f="iso-8859-1"),p=r,r=d.length);for(r=0;r<d.length;++r)if(r!==p){var g,m,y=d[r],v=y.indexOf("]="),_=-1===v?y.indexOf("="):v+1;-1===_?(g=t.decoder(y,o.decoder,f,"key"),m=t.strictNullHandling?null:""):(g=t.decoder(y.slice(0,_),o.decoder,f,"key"),m=n.maybeMap(c(y.slice(_+1),t),(function(e){return t.decoder(e,o.decoder,f,"value")}))),m&&t.interpretNumericEntities&&"iso-8859-1"===f&&(m=a(m)),y.indexOf("[]=")>-1&&(m=s(m)?[m]:m),i.call(l,g)?l[g]=n.combine(l[g],m):l[g]=m}return l}(e,r):e,h=r.plainObjects?Object.create(null):{},d=Object.keys(u),p=0;p<d.length;++p){var f=d[p],g=l(f,u[f],r,"string"==typeof e);h=n.merge(h,g,r)}return!0===r.allowSparse?h:n.compact(h)}},8261:(e,t,r)=>{"use strict";var n=r(7478),i=r(2769),s=r(5798),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,l=Array.prototype.push,u=function(e,t){l.apply(e,c(t)?t:[t])},h=Date.prototype.toISOString,d=s.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(e){return h.call(e)},skipNulls:!1,strictNullHandling:!1},f=function e(t,r,s,o,a,l,h,d,f,g,m,y,v,_,b){var w,S=t;if(b.has(t))throw new RangeError("Cyclic object value");if("function"==typeof h?S=h(r,S):S instanceof Date?S=g(S):"comma"===s&&c(S)&&(S=i.maybeMap(S,(function(e){return e instanceof Date?g(e):e}))),null===S){if(o)return l&&!v?l(r,p.encoder,_,"key",m):r;S=""}if("string"==typeof(w=S)||"number"==typeof w||"boolean"==typeof w||"symbol"==typeof w||"bigint"==typeof w||i.isBuffer(S))return l?[y(v?r:l(r,p.encoder,_,"key",m))+"="+y(l(S,p.encoder,_,"value",m))]:[y(r)+"="+y(String(S))];var k,E=[];if(void 0===S)return E;if("comma"===s&&c(S))k=[{value:S.length>0?S.join(",")||null:void 0}];else if(c(h))k=h;else{var x=Object.keys(S);k=d?x.sort(d):x}for(var A=0;A<k.length;++A){var T=k[A],C="object"==typeof T&&void 0!==T.value?T.value:S[T];if(!a||null!==C){var I=c(S)?"function"==typeof s?s(r,T):r:r+(f?"."+T:"["+T+"]");b.set(t,!0);var R=n();u(E,e(C,I,s,o,a,l,h,d,f,g,m,y,v,_,R))}}return E};e.exports=function(e,t){var r,i=e,l=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=s.default;if(void 0!==e.format){if(!o.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=s.formatters[r],i=p.filter;return("function"==typeof e.filter||c(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof l.filter?i=(0,l.filter)("",i):c(l.filter)&&(r=l.filter);var h,d=[];if("object"!=typeof i||null===i)return"";h=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var g=a[h];r||(r=Object.keys(i)),l.sort&&r.sort(l.sort);for(var m=n(),y=0;y<r.length;++y){var v=r[y];l.skipNulls&&null===i[v]||u(d,f(i[v],v,g,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,m))}var _=d.join(l.delimiter),b=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),_.length>0?b+_:""}},2769:(e,t,r)=>{"use strict";var n=r(5798),i=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var i=t[n],o=i.obj[i.prop],a=Object.keys(o),c=0;c<a.length;++c){var l=a[c],u=o[l];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:o,prop:l}),r.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(s(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r,i,s){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",l=0;l<a.length;++l){var u=a.charCodeAt(l);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===n.RFC1738&&(40===u||41===u)?c+=a.charAt(l):u<128?c+=o[u]:u<2048?c+=o[192|u>>6]+o[128|63&u]:u<55296||u>=57344?c+=o[224|u>>12]+o[128|u>>6&63]+o[128|63&u]:(l+=1,u=65536+((1023&u)<<10|1023&a.charCodeAt(l)),c+=o[240|u>>18]+o[128|u>>12&63]+o[128|u>>6&63]+o[128|63&u])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(s(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!i.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return s(t)&&!s(r)&&(o=a(t,n)),s(t)&&s(r)?(r.forEach((function(r,s){if(i.call(t,s)){var o=t[s];o&&"object"==typeof o&&r&&"object"==typeof r?t[s]=e(o,r,n):t.push(r)}else t[s]=r})),t):Object.keys(r).reduce((function(t,s){var o=r[s];return i.call(t,s)?t[s]=e(t[s],o,n):t[s]=o,t}),o)}}},2587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,r,n,i){r=r||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var o=/\+/g;e=e.split(r);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var l=0;l<c;++l){var u,h,d,p,f=e[l].replace(o,"%20"),g=f.indexOf(n);g>=0?(u=f.substr(0,g),h=f.substr(g+1)):(u=f,h=""),d=decodeURIComponent(u),p=decodeURIComponent(h),t(s,d)?Array.isArray(s[d])?s[d].push(p):s[d]=[s[d],p]:s[d]=p}return s}},2361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,r,n,i){return r=r||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(i){var s=encodeURIComponent(t(i))+n;return Array.isArray(e[i])?e[i].map((function(e){return s+encodeURIComponent(t(e))})).join(r):s+encodeURIComponent(t(e[i]))})).join(r):i?encodeURIComponent(t(i))+n+encodeURIComponent(t(e)):""}},7673:(e,t,r)=>{"use strict";t.decode=t.parse=r(2587),t.encode=t.stringify=r(2361)},9509:(e,t,r)=>{var n=r(8764),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),s(i,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},1036:(e,t,r)=>{const n=r(3719),i=r(2997),{klona:s}=r(3059),{isPlainObject:o}=r(977),a=r(9996),c=r(9430),{parse:l}=r(20),u=["img","audio","video","picture","svg","object","map","iframe","embed"],h=["script","style"];function d(e,t){e&&Object.keys(e).forEach((function(r){t(e[r],r)}))}function p(e,t){return{}.hasOwnProperty.call(e,t)}function f(e,t){const r=[];return d(e,(function(e){t(e)&&r.push(e)})),r}e.exports=m;const g=/^[^\0\t\n\f\r /<=>]+$/;function m(e,t,r){let v="",_="";function b(e,t){const r=this;this.tag=e,this.attribs=t||{},this.tagPosition=v.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){C.length&&(C[C.length-1].text+=r.text)},this.updateParentNodeMediaChildren=function(){C.length&&u.includes(this.tag)&&C[C.length-1].mediaChildren.push(this.tag)}}(t=Object.assign({},m.defaults,t)).parser=Object.assign({},y,t.parser),h.forEach((function(e){t.allowedTags&&t.allowedTags.indexOf(e)>-1&&!t.allowVulnerableTags&&console.warn(`\n\n Your \`allowedTags\` option includes, \`${e}\`, which is inherently\nvulnerable to XSS attacks. Please remove it from \`allowedTags\`.\nOr, to disable this warning, add the \`allowVulnerableTags\` option\nand ensure you are accounting for this risk.\n\n`)}));const w=t.nonTextTags||["script","style","textarea","option"];let S,k;t.allowedAttributes&&(S={},k={},d(t.allowedAttributes,(function(e,t){S[t]=[];const r=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?r.push(i(e).replace(/\\\*/g,".*")):S[t].push(e)})),k[t]=new RegExp("^("+r.join("|")+")$")})));const E={};d(t.allowedClasses,(function(e,t){S&&(p(S,t)||(S[t]=[]),S[t].push("class")),E[t]=e}));const x={};let A,T,C,I,R,O,P;d(t.transformTags,(function(e,t){let r;"function"==typeof e?r=e:"string"==typeof e&&(r=m.simpleTransform(e)),"*"===t?A=r:x[t]=r}));let D=!1;L();const M=new n.Parser({onopentag:function(e,r){if(t.enforceHtmlBoundary&&"html"===e&&L(),O)return void P++;const n=new b(e,r);C.push(n);let i=!1;const u=!!n.text;let h;if(p(x,e)&&(h=x[e](e,r),n.attribs=r=h.attribs,void 0!==h.text&&(n.innerText=h.text),e!==h.tagName&&(n.name=e=h.tagName,R[T]=h.tagName)),A&&(h=A(e,r),n.attribs=r=h.attribs,e!==h.tagName&&(n.name=e=h.tagName,R[T]=h.tagName)),(t.allowedTags&&-1===t.allowedTags.indexOf(e)||"recursiveEscape"===t.disallowedTagsMode&&!function(e){for(const t in e)if(p(e,t))return!1;return!0}(I)||null!=t.nestingLimit&&T>=t.nestingLimit)&&(i=!0,I[T]=!0,"discard"===t.disallowedTagsMode&&-1!==w.indexOf(e)&&(O=!0,P=1),I[T]=!0),T++,i){if("discard"===t.disallowedTagsMode)return;_=v,v=""}v+="<"+e,(!S||p(S,e)||S["*"])&&d(r,(function(r,i){if(!g.test(i))return void delete n.attribs[i];let u,h=!1;if(!S||p(S,e)&&-1!==S[e].indexOf(i)||S["*"]&&-1!==S["*"].indexOf(i)||p(k,e)&&k[e].test(i)||k["*"]&&k["*"].test(i))h=!0;else if(S&&S[e])for(const t of S[e])if(o(t)&&t.name&&t.name===i){h=!0;let e="";if(!0===t.multiple){const n=r.split(" ");for(const r of n)-1!==t.values.indexOf(r)&&(""===e?e=r:e+=" "+r)}else t.values.indexOf(r)>=0&&(e=r);r=e}if(h){if(-1!==t.allowedSchemesAppliedToAttributes.indexOf(i)&&F(e,r))return void delete n.attribs[i];if("iframe"===e&&"src"===i){let e=!0;try{if((r=r.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//")).startsWith("relative:"))throw new Error("relative: exploit attempt");let n="relative://relative-site";for(let e=0;e<100;e++)n+=`/${e}`;const i=new URL(r,n);if(i&&"relative-site"===i.hostname&&"relative:"===i.protocol)e=p(t,"allowIframeRelativeUrls")?t.allowIframeRelativeUrls:!t.allowedIframeHostnames&&!t.allowedIframeDomains;else if(t.allowedIframeHostnames||t.allowedIframeDomains){const r=(t.allowedIframeHostnames||[]).find((function(e){return e===i.hostname})),n=(t.allowedIframeDomains||[]).find((function(e){return i.hostname===e||i.hostname.endsWith(`.${e}`)}));e=r||n}}catch(t){e=!1}if(!e)return void delete n.attribs[i]}if("srcset"===i)try{if(u=c(r),u.forEach((function(e){F("srcset",e.url)&&(e.evil=!0)})),u=f(u,(function(e){return!e.evil})),!u.length)return void delete n.attribs[i];r=f(u,(function(e){return!e.evil})).map((function(e){if(!e.url)throw new Error("URL missing");return e.url+(e.w?` ${e.w}w`:"")+(e.h?` ${e.h}h`:"")+(e.d?` ${e.d}x`:"")})).join(", "),n.attribs[i]=r}catch(e){return void delete n.attribs[i]}if("class"===i){const t=E[e],s=E["*"];if(!(m=r,y=t&&s?a(t,s):t||s,r=y?(m=m.split(/\s+/)).filter((function(e){return-1!==y.indexOf(e)})).join(" "):m).length)return void delete n.attribs[i]}if("style"===i)try{const o=l(e+" {"+r+"}");if(0===(d=function(e,t){if(!t)return e;const r=s(e),n=e.nodes[0];let i;return i=t[n.selector]&&t["*"]?a(t[n.selector],t["*"]):t[n.selector]||t["*"],i&&(r.nodes[0].nodes=n.nodes.reduce(function(e){return function(t,r){return p(e,r.prop)&&e[r.prop].some((function(e){return e.test(r.value)}))&&t.push(r),t}}(i),[])),r}(o,t.allowedStyles),r=d.nodes[0].nodes.reduce((function(e,t){return e.push(t.prop+":"+t.value),e}),[]).join(";")).length)return void delete n.attribs[i]}catch(e){return void delete n.attribs[i]}v+=" "+i,r&&r.length&&(v+='="'+N(r,!0)+'"')}else delete n.attribs[i];var d,m,y})),-1!==t.selfClosing.indexOf(e)?v+=" />":(v+=">",!n.innerText||u||t.textFilter||(v+=N(n.innerText),D=!0)),i&&(v=_+N(v),_="")},ontext:function(e){if(O)return;const r=C[C.length-1];let n;if(r&&(n=r.tag,e=void 0!==r.innerText?r.innerText:e),"discard"!==t.disallowedTagsMode||"script"!==n&&"style"!==n){const r=N(e,!1);t.textFilter&&!D?v+=t.textFilter(r,n):D||(v+=r)}else v+=e;C.length&&(C[C.length-1].text+=e)},onclosetag:function(e){if(O){if(P--,P)return;O=!1}const r=C.pop();if(!r)return;O=!!t.enforceHtmlBoundary&&"html"===e,T--;const n=I[T];if(n){if(delete I[T],"discard"===t.disallowedTagsMode)return void r.updateParentNodeText();_=v,v=""}R[T]&&(e=R[T],delete R[T]),t.exclusiveFilter&&t.exclusiveFilter(r)?v=v.substr(0,r.tagPosition):(r.updateParentNodeMediaChildren(),r.updateParentNodeText(),-1===t.selfClosing.indexOf(e)?(v+="</"+e+">",n&&(v=_+N(v),_="")):n&&(v=_,_=""))}},t.parser);return M.write(e),M.end(),v;function L(){v="",T=0,C=[],I={},R={},O=!1,P=0}function N(e,r){return"string"!=typeof e&&(e+=""),t.parser.decodeEntities&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r&&(e=e.replace(/"/g,"&quot;"))),e=e.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r&&(e=e.replace(/"/g,"&quot;")),e}function F(e,r){const n=(r=(r=r.replace(/[\x00-\x20]+/g,"")).replace(/<!--.*?-->/g,"")).match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!n)return!!r.match(/^[/\\]{2}/)&&!t.allowProtocolRelative;const i=n[1].toLowerCase();return p(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(i):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(i)}}const y={decodeEntities:!0};m.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1},m.simpleTransform=function(e,t,r){return r=void 0===r||r,t=t||{},function(n,i){let s;if(r)for(s in t)i[s]=t[s];else i=t;return{tagName:e,attribs:i}}}},2997:e=>{"use strict";e.exports=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}},977:(e,t)=>{"use strict";function r(e){return"[object Object]"===Object.prototype.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPlainObject=function(e){var t,n;return!1!==r(e)&&(void 0===(t=e.constructor)||!1!==r(n=t.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf"))}},7478:(e,t,r)=>{"use strict";var n=r(210),i=r(1924),s=r(631),o=n("%TypeError%"),a=n("%WeakMap%",!0),c=n("%Map%",!0),l=i("WeakMap.prototype.get",!0),u=i("WeakMap.prototype.set",!0),h=i("WeakMap.prototype.has",!0),d=i("Map.prototype.get",!0),p=i("Map.prototype.set",!0),f=i("Map.prototype.has",!0),g=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};e.exports=function(){var e,t,r,n={assert:function(e){if(!n.has(e))throw new o("Side channel does not contain "+s(e))},get:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(e)return l(e,n)}else if(c){if(t)return d(t,n)}else if(r)return function(e,t){var r=g(e,t);return r&&r.value}(r,n)},has:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(e)return h(e,n)}else if(c){if(t)return f(t,n)}else if(r)return function(e,t){return!!g(e,t)}(r,n);return!1},set:function(n,i){a&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new a),u(e,n,i)):c?(t||(t=new c),p(t,n,i)):(r||(r={key:{},next:null}),function(e,t,r){var n=g(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(r,n,i))}};return n}},8822:()=>{String.prototype.repeat||function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),t=function(e){if(null==this)throw TypeError();var t=String(this),r=e?Number(e):0;if(r!=r&&(r=0),r<0||r==1/0)throw RangeError();for(var n="";r;)r%2==1&&(n+=t),r>1&&(t+=t),r>>=1;return n};e?e(String.prototype,"repeat",{value:t,configurable:!0,writable:!0}):String.prototype.repeat=t}()},3379:(e,t,r)=>{"use strict";var n,i=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),s=[];function o(e){for(var t=-1,r=0;r<s.length;r++)if(s[r].identifier===e){t=r;break}return t}function a(e,t){for(var r={},n=[],i=0;i<e.length;i++){var a=e[i],c=t.base?a[0]+t.base:a[0],l=r[c]||0,u="".concat(c," ").concat(l);r[c]=l+1;var h=o(u),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==h?(s[h].references++,s[h].updater(d)):s.push({identifier:u,updater:g(d,t),references:1}),n.push(u)}return n}function c(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var s=r.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var o=i(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var l,u=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function h(e,t,r,n){var i=r?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=u(t,i);else{var s=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function d(e,t,r){var n=r.css,i=r.media,s=r.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var p=null,f=0;function g(e,t){var r,n,i;if(t.singleton){var s=f++;r=p||(p=c(t)),n=h.bind(null,r,s,!1),i=h.bind(null,r,s,!0)}else r=c(t),n=d.bind(null,r,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var r=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<r.length;n++){var i=o(r[n]);s[i].references--}for(var c=a(e,t),l=0;l<r.length;l++){var u=o(r[l]);0===s[u].references&&(s[u].updater(),s.splice(u,1))}r=c}}}},5547:e=>{"use strict";e.exports=JSON.parse('{"0":"O","1":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","\\u2028":" ","\\u2029":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":"_","":"_","":"_","":"_","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-.","":"","":",","":",","":",","":",","":",","":"","":"","":";","":"","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":"::=","":":","":"!","":"!","":"!","":"!!","":"!?","":"?","":"?","":"?","":"?","":"?","":"?!","":"??","":"","":".","":".","":".","":".","":".","":".","":".","":".","":".","":".,","":"..","":"..","":"...","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":">","":">","":">","":"4","":"b","":"b","":"d","":"J","":"L","":"P","":"U","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","`":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'\'","\\"":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'\'","":"\'\'\'","":"\'\'\'\'","":"\'B","":"\'D","":"\'n","":"\'P","":"\'T","":"\'Y","":"(","":"(","":"(","":"(","":"(","":"((","":"()","":"(2)","":"(2O)","":"(3)","":"(4)","":"(5)","":"(6)","":"(7)","":"(8)","":"(9)","":"(a)","":"(A)","":"(b)","":"(B)","":"(c)","":"(C)","":"(d)","":"(D)","":"(e)","":"(E)","":"(f)","":"(F)","":"(g)","":"(G)","":"(h)","":"(H)","":"(i)","":"(j)","":"(J)","":"(k)","":"(K)","":"(l)","":"(l)","":"(l)","":"(L)","":"(l2)","":"(l3)","":"(l4)","":"(l5)","":"(l6)","":"(l7)","":"(l8)","":"(l9)","":"(ll)","":"(lO)","":"(M)","":"(n)","":"(N)","":"(o)","":"(O)","":"(p)","":"(P)","":"(q)","":"(Q)","":"(r)","":"(R)","":"(rn)","":"(s)","":"(S)","":"(S)","":"(t)","":"(T)","":"(u)","":"(U)","":"(v)","":"(V)","":"(w)","":"(W)","":"(x)","":"(X)","":"(y)","":"(Y)","":"(z)","":"(Z)","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":")","":")","":")","":")","":")","":"))","":"{","":"{","":"}","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"*","":"*","":"*","":"*","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"//","":"///","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\\\\\","":"\\\\\\\\","":"\\\\","":"&","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"^","":"^","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"bi","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"C","":"F","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<<","":"<<<","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"==","":"===","":"=","":">","":">","":">","":">","":">","":">","":">","":"><","":">>","":">>","":">>>","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"$","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"","":"","":"","":"","":"","":"","":"2","":"2,","":"2.","":"22","":"22","":"23","":"23","":"24","":"24","":"25","":"26","":"27","":"28","":"29","":"2l","":"2l","":"2O.","":"2O","":"2O","":"","":"","":"2","":"2","":"2","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"","":"","":"","":"","":"3","":"3,","":"3.","":"3l","":"3O","":"3","":"3","":"3","":"4","":"4","":"4","":"4","":"4","":"4","":"4","":"4","":"","":"","":"","":"4,","":"4.","":"4","":"4","":"4","":"4","":"5","":"5","":"5","":"5","":"5","":"5","":"5","":"5","":"","":"5,","":"5.","":"5","":"5","":"5","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"","":"","":"","":"6,","":"6.","":"6","":"6","":"6","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"","":"7,","":"7.","":"7","":"7","":"7","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"","":"","":"8,","":"8.","":"8","":"8","":"8","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"","":"","":"","":"","":"","":"9,","":"9.","":"9","":"9","":"9","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"","":"","":"","":"","":"","":"a/c","":"a/s","":"aa","":"AA","":"ae","":"ae","":"AE","":"AE","":"ao","":"AO","":"AR","":"au","":"AU","":"av","":"av","":"AV","":"AV","":"ay","":"AY","":"","":"","":"","":"","":"","":"","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b\'","":"bl","":"","":"","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"c","":"c","":"C","":"C","":"c","":"c","":"C","":"C","":"C\'","":"c/o","":"c/u","":"\\t","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"d","":"","":"d","":"d\'","":"d","":"dz","":"dz","":"Dz","":"DZ","":"d","":"D","":"D","":"d","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"","":"","":"e","":"E","":"e","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"f","":"F","":"f","":"FAX","":"ff","":"ffi","":"ffl","":"fi","":"fl","":"f","":"","":"","":"","":"","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"","":"g","":"","":"","":"","":"g","":"G","":"G\'","":"","":"","":"","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"","":"h","":"h","":"h","":"H","":"H","":"h","":"h","":"h","":"H","":"H","":"H","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"","":"i","":"","":"","":"i","":"i","":"i","":"ii","":"iii","":"ij","":"iv","":"ix","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"j","":"J","":"J","":"","":"","":"","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"k","":"K","":"K","":"K","":"K","":"K","":"K\'","":"l","|":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","I":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"L","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l,","":"l.","":"l\'","":"l2.","":"l2","":"l2","":"l2","":"l3.","":"l3","":"l3","":"l4.","":"l4","":"l4","":"l5.","":"l5","":"l5","":"l6.","":"l6","":"l6","":"l7.","":"l7","":"l7","":"l8.","":"l8","":"l8","":"l9.","":"l9","":"l9","":"lj","":"lJ","":"Lj","":"LJ","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll.","":"lll","":"llS","":"ll","":"ll","":"ll","":"lO","":"lO.","":"lO","":"lO","":"lO","":"ls","":"lt","":"lV","":"lX","":"l","":"lz","":"l","":"l","":"l","":"l","":"l","":"l","":"lo","":"l","":"l","":"l","":"","":"","":"","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"MB","":"","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"n","":"nj","":"Nj","":"NJ","":"No","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"","":"","":"","":"","":"o","":"","":"o","":"o","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"O,","":"O.","":"o\'","":"O\'","":"O\'","%":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"oe","":"OE","":"o","":"oo","":"oo","":"oo","":"OO","":"OO","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oo","":"o","":"O","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"p","":"p","":"p","":"P\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"q","":"QE","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"r","":"r","":"r","":"r","":"r","":"r\'","":"rn","m":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"Rs","":"","":"","":"","":"","":"","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"s","":"s","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"sss","":"st","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"t","":"T","":"T","":"","":"T","":"T","":"T","":"t","":"T","":"t","":"","":"T3","":"t","":"TEL","":"tf","":"ts","":"t","":"t","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"","":"","":"u","":"u","":"U","":"U","":"U","":"U\'","":"ue","":"uo","":"","":"","":"","":"","":"","":"","":"","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VB","":"vi","":"vii","":"viii","":"Vl","":"Vll","":"Vlll","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"w","":"w","":"W","":"w","":"","":"","":"","":"","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"x","":"X","":"X","":"xi","":"xii","":"Xl","":"Xll","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"","":"","":"","":"","":"","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"z","":"z","":"Z","":"z","":"Z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo o ","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"l","":"l","":"l","":"l","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"l","":"l","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"/","":"","":"","":"","":"","":"","":"\'","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":"b","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"b","":"d","":"P","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}')},5067:(e,t,r)=>{"use strict";var n=r(5547),i=RegExp(Object.keys(n).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function s(e){return n[e]}e.exports=function(e){return e.replace(i,s)}},2511:function(e,t,r){var n;e=r.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof r.g&&r.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,c=36,l=/^xn--/,u=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function g(e){throw RangeError(d[e])}function m(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function y(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+m((e=e.replace(h,".")).split("."),t).join(".")}function v(e){for(var t,r,n=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function _(e){return m(e,(function(e){var t="";return e>65535&&(t+=f((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+f(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,r){var n=0;for(e=r?p(e/700):e>>1,e+=p(e/t);e>455;n+=c)e=p(e/35);return p(n+36*e/(e+38))}function S(e){var t,r,n,i,s,o,l,u,h,d,f,m=[],y=e.length,v=0,b=128,S=72;for((r=e.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&g("not-basic"),m.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<y;){for(s=v,o=1,l=c;i>=y&&g("invalid-input"),((u=(f=e.charCodeAt(i++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:c)>=c||u>p((a-v)/o))&&g("overflow"),v+=u*o,!(u<(h=l<=S?1:l>=S+26?26:l-S));l+=c)o>p(a/(d=c-h))&&g("overflow"),o*=d;S=w(v-s,t=m.length+1,0==s),p(v/t)>a-b&&g("overflow"),b+=p(v/t),v%=t,m.splice(v++,0,b)}return _(m)}function k(e){var t,r,n,i,s,o,l,u,h,d,m,y,_,S,k,E=[];for(y=(e=v(e)).length,t=128,r=0,s=72,o=0;o<y;++o)(m=e[o])<128&&E.push(f(m));for(n=i=E.length,i&&E.push("-");n<y;){for(l=a,o=0;o<y;++o)(m=e[o])>=t&&m<l&&(l=m);for(l-t>p((a-r)/(_=n+1))&&g("overflow"),r+=(l-t)*_,t=l,o=0;o<y;++o)if((m=e[o])<t&&++r>a&&g("overflow"),m==t){for(u=r,h=c;!(u<(d=h<=s?1:h>=s+26?26:h-s));h+=c)k=u-d,S=c-d,E.push(f(b(d+k%S,0))),u=p(k/S);E.push(f(b(u,0))),s=w(r,_,n==i),r=0,++n}++r,++t}return E.join("")}o={version:"1.3.2",ucs2:{decode:v,encode:_},decode:S,encode:k,toASCII:function(e){return y(e,(function(e){return u.test(e)?"xn--"+k(e):e}))},toUnicode:function(e){return y(e,(function(e){return l.test(e)?S(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return o}.call(t,r,t,e))||(e.exports=n)}()},8575:(e,t,r)=>{"use strict";var n=r(2511),i=r(2502);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=_,t.resolve=function(e,t){return _(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?_(e,!1,!0).resolveObject(t):t},t.format=function(e){return i.isString(e)&&(e=_(e)),e instanceof s?e.format():s.prototype.format.call(e)},t.Url=s;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(l),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=r(7673);function _(e,t,r){if(e&&i.isObject(e)&&e instanceof s)return e;var n=new s;return n.parse(e,t,r),n}s.prototype.parse=function(e,t,r){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),a=-1!==s&&s<e.indexOf("#")?"?":"#",l=e.split(a);l[0]=l[0].replace(/\\/g,"/");var _=e=l.join(a);if(_=_.trim(),!r&&1===e.split("#").length){var b=c.exec(_);if(b)return this.path=_,this.href=_,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=o.exec(_);if(w){var S=(w=w[0]).toLowerCase();this.protocol=S,_=_.substr(w.length)}if(r||w||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var k="//"===_.substr(0,2);!k||w&&m[w]||(_=_.substr(2),this.slashes=!0)}if(!m[w]&&(k||w&&!y[w])){for(var E,x,A=-1,T=0;T<d.length;T++)-1!==(C=_.indexOf(d[T]))&&(-1===A||C<A)&&(A=C);for(-1!==(x=-1===A?_.lastIndexOf("@"):_.lastIndexOf("@",A))&&(E=_.slice(0,x),_=_.slice(x+1),this.auth=decodeURIComponent(E)),A=-1,T=0;T<h.length;T++){var C;-1!==(C=_.indexOf(h[T]))&&(-1===A||C<A)&&(A=C)}-1===A&&(A=_.length),this.host=_.slice(0,A),_=_.slice(A),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var R=this.hostname.split(/\./),O=(T=0,R.length);T<O;T++){var P=R[T];if(P&&!P.match(p)){for(var D="",M=0,L=P.length;M<L;M++)P.charCodeAt(M)>127?D+="x":D+=P[M];if(!D.match(p)){var N=R.slice(0,T),F=R.slice(T+1),B=P.match(f);B&&(N.push(B[1]),F.unshift(B[2])),F.length&&(_="/"+F.join(".")+_),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=n.toASCII(this.hostname));var U=this.port?":"+this.port:"",q=this.hostname||"";this.host=q+U,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!g[S])for(T=0,O=u.length;T<O;T++){var j=u[T];if(-1!==_.indexOf(j)){var K=encodeURIComponent(j);K===j&&(K=escape(j)),_=_.split(j).join(K)}}var z=_.indexOf("#");-1!==z&&(this.hash=_.substr(z),_=_.slice(0,z));var $=_.indexOf("?");if(-1!==$?(this.search=_.substr($),this.query=_.substr($+1),t&&(this.query=v.parse(this.query)),_=_.slice(0,$)):t&&(this.search="",this.query={}),_&&(this.pathname=_),y[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var G=this.search||"";this.path=U+G}return this.href=this.format(),this},s.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",s=!1,o="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(o=v.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==s?(s="//"+(s||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):s||(s=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+s+(r=r.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},s.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,!1,!0),e=t}for(var r=new s,n=Object.keys(this),o=0;o<n.length;o++){var a=n[o];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),l=0;l<c.length;l++){var u=c[l];"protocol"!==u&&(r[u]=e[u])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!y[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||m[e.protocol])r.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var g=r.pathname||"",v=r.search||"";r.path=g+v}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=b||_||r.host&&e.pathname,S=w,k=r.pathname&&r.pathname.split("/")||[],E=(f=e.pathname&&e.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(E&&(r.hostname="",r.port=null,r.host&&(""===k[0]?k[0]=r.host:k.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),w=w&&(""===f[0]||""===k[0])),b)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,k=f;else if(f.length)k||(k=[]),k.pop(),k=k.concat(f),r.search=e.search,r.query=e.query;else if(!i.isNullOrUndefined(e.search))return E&&(r.hostname=r.host=k.shift(),(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift())),r.search=e.search,r.query=e.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!k.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var x=k.slice(-1)[0],A=(r.host||e.host||k.length>1)&&("."===x||".."===x)||""===x,T=0,C=k.length;C>=0;C--)"."===(x=k[C])?k.splice(C,1):".."===x?(k.splice(C,1),T++):T&&(k.splice(C,1),T--);if(!w&&!S)for(;T--;T)k.unshift("..");!w||""===k[0]||k[0]&&"/"===k[0].charAt(0)||k.unshift(""),A&&"/"!==k.join("/").substr(-1)&&k.push("");var I,R=""===k[0]||k[0]&&"/"===k[0].charAt(0);return E&&(r.hostname=r.host=R?"":k.length?k.shift():"",(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift())),(w=w||r.host&&k.length)&&!R&&k.unshift(""),k.length?r.pathname=k.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},s.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},2502:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},2636:(e,t,r)=>{e.exports=function(){return new Worker(r.p+"pdf.worker.worker.js")}},4654:()=>{},3414:()=>{},172:()=>{},2001:()=>{},3779:()=>{},6558:()=>{},2258:()=>{},2868:()=>{},5574:()=>{},4777:()=>{},9830:()=>{}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})();var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{recaptchaHandler:()=>an});var e,t,r,n,i=__webpack_require__(8743),s={},o=[],a=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(e,t){for(var r in t)e[r]=t[r];return e}function l(e){var t=e.parentNode;t&&t.removeChild(e)}function u(e,t,r){var n,i,s,o=arguments,a={};for(s in t)"key"==s?n=t[s]:"ref"==s?i=t[s]:a[s]=t[s];if(arguments.length>3)for(r=[r],s=3;s<arguments.length;s++)r.push(o[s]);if(null!=r&&(a.children=r),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===a[s]&&(a[s]=e.defaultProps[s]);return h(e,a,n,i,null)}function h(t,r,n,i,s){var o={type:t,props:r,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==s?++e.__v:s};return null!=e.vnode&&e.vnode(o),o}function d(e){return e.children}function p(e,t){this.props=e,this.context=t}function f(e,t){if(null==t)return e.__?f(e.__,e.__.__k.indexOf(e)+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?f(e):null}function g(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return g(e)}}function m(i){(!i.__d&&(i.__d=!0)&&t.push(i)&&!y.__r++||n!==e.debounceRendering)&&((n=e.debounceRendering)||r)(y)}function y(){for(var e;y.__r=t.length;)e=t.sort((function(e,t){return e.__v.__b-t.__v.__b})),t=[],e.some((function(e){var t,r,n,i,s,o;e.__d&&(s=(i=(t=e).__v).__e,(o=t.__P)&&(r=[],(n=c({},i)).__v=i.__v+1,x(o,i,n,t.__n,void 0!==o.ownerSVGElement,null!=i.__h?[s]:null,r,null==s?f(i):s,i.__h),A(r,i),i.__e!=s&&g(i)))}))}function v(e,t,r,n,i,a,c,l,u,p){var g,m,y,v,w,S,k,E=n&&n.__k||o,A=E.length;for(r.__k=[],g=0;g<t.length;g++)if(null!=(v=r.__k[g]=null==(v=t[g])||"boolean"==typeof v?null:"string"==typeof v||"number"==typeof v||"bigint"==typeof v?h(null,v,null,null,v):Array.isArray(v)?h(d,{children:v},null,null,null):v.__b>0?h(v.type,v.props,v.key,null,v.__v):v)){if(v.__=r,v.__b=r.__b+1,null===(y=E[g])||y&&v.key==y.key&&v.type===y.type)E[g]=void 0;else for(m=0;m<A;m++){if((y=E[m])&&v.key==y.key&&v.type===y.type){E[m]=void 0;break}y=null}x(e,v,y=y||s,i,a,c,l,u,p),w=v.__e,(m=v.ref)&&y.ref!=m&&(k||(k=[]),y.ref&&k.push(y.ref,null,v),k.push(m,v.__c||w,v)),null!=w?(null==S&&(S=w),"function"==typeof v.type&&null!=v.__k&&v.__k===y.__k?v.__d=u=_(v,u,e):u=b(e,v,y,E,w,u),p||"option"!==r.type?"function"==typeof r.type&&(r.__d=u):e.value=""):u&&y.__e==u&&u.parentNode!=e&&(u=f(y))}for(r.__e=S,g=A;g--;)null!=E[g]&&("function"==typeof r.type&&null!=E[g].__e&&E[g].__e==r.__d&&(r.__d=f(n,g+1)),I(E[g],E[g]));if(k)for(g=0;g<k.length;g++)C(k[g],k[++g],k[++g])}function _(e,t,r){var n,i;for(n=0;n<e.__k.length;n++)(i=e.__k[n])&&(i.__=e,t="function"==typeof i.type?_(i,t,r):b(r,i,i,e.__k,i.__e,t));return t}function b(e,t,r,n,i,s){var o,a,c;if(void 0!==t.__d)o=t.__d,t.__d=void 0;else if(null==r||i!=s||null==i.parentNode)e:if(null==s||s.parentNode!==e)e.appendChild(i),o=null;else{for(a=s,c=0;(a=a.nextSibling)&&c<n.length;c+=2)if(a==i)break e;e.insertBefore(i,s),o=s}return void 0!==o?o:i.nextSibling}function w(e,t,r){"-"===t[0]?e.setProperty(t,r):e[t]=null==r?"":"number"!=typeof r||a.test(t)?r:r+"px"}function S(e,t,r,n,i){var s;e:if("style"===t)if("string"==typeof r)e.style.cssText=r;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||w(e.style,t,"");if(r)for(t in r)n&&r[t]===n[t]||w(e.style,t,r[t])}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=r,r?n||e.addEventListener(t,s?E:k,s):e.removeEventListener(t,s?E:k,s);else if("dangerouslySetInnerHTML"!==t){if(i)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==r?"":r;break e}catch(e){}"function"==typeof r||(null!=r&&(!1!==r||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,r):e.removeAttribute(t))}}function k(t){this.l[t.type+!1](e.event?e.event(t):t)}function E(t){this.l[t.type+!0](e.event?e.event(t):t)}function x(t,r,n,i,s,o,a,l,u){var h,f,g,m,y,_,b,w,S,k,E,x=r.type;if(void 0!==r.constructor)return null;null!=n.__h&&(u=n.__h,l=r.__e=n.__e,r.__h=null,o=[l]),(h=e.__b)&&h(r);try{e:if("function"==typeof x){if(w=r.props,S=(h=x.contextType)&&i[h.__c],k=h?S?S.props.value:h.__:i,n.__c?b=(f=r.__c=n.__c).__=f.__E:("prototype"in x&&x.prototype.render?r.__c=f=new x(w,k):(r.__c=f=new p(w,k),f.constructor=x,f.render=R),S&&S.sub(f),f.props=w,f.state||(f.state={}),f.context=k,f.__n=i,g=f.__d=!0,f.__h=[]),null==f.__s&&(f.__s=f.state),null!=x.getDerivedStateFromProps&&(f.__s==f.state&&(f.__s=c({},f.__s)),c(f.__s,x.getDerivedStateFromProps(w,f.__s))),m=f.props,y=f.state,g)null==x.getDerivedStateFromProps&&null!=f.componentWillMount&&f.componentWillMount(),null!=f.componentDidMount&&f.__h.push(f.componentDidMount);else{if(null==x.getDerivedStateFromProps&&w!==m&&null!=f.componentWillReceiveProps&&f.componentWillReceiveProps(w,k),!f.__e&&null!=f.shouldComponentUpdate&&!1===f.shouldComponentUpdate(w,f.__s,k)||r.__v===n.__v){f.props=w,f.state=f.__s,r.__v!==n.__v&&(f.__d=!1),f.__v=r,r.__e=n.__e,r.__k=n.__k,r.__k.forEach((function(e){e&&(e.__=r)})),f.__h.length&&a.push(f);break e}null!=f.componentWillUpdate&&f.componentWillUpdate(w,f.__s,k),null!=f.componentDidUpdate&&f.__h.push((function(){f.componentDidUpdate(m,y,_)}))}f.context=k,f.props=w,f.state=f.__s,(h=e.__r)&&h(r),f.__d=!1,f.__v=r,f.__P=t,h=f.render(f.props,f.state,f.context),f.state=f.__s,null!=f.getChildContext&&(i=c(c({},i),f.getChildContext())),g||null==f.getSnapshotBeforeUpdate||(_=f.getSnapshotBeforeUpdate(m,y)),E=null!=h&&h.type===d&&null==h.key?h.props.children:h,v(t,Array.isArray(E)?E:[E],r,n,i,s,o,a,l,u),f.base=r.__e,r.__h=null,f.__h.length&&a.push(f),b&&(f.__E=f.__=null),f.__e=!1}else null==o&&r.__v===n.__v?(r.__k=n.__k,r.__e=n.__e):r.__e=T(n.__e,r,n,i,s,o,a,u);(h=e.diffed)&&h(r)}catch(t){r.__v=null,(u||null!=o)&&(r.__e=l,r.__h=!!u,o[o.indexOf(l)]=null),e.__e(t,r,n)}}function A(t,r){e.__c&&e.__c(r,t),t.some((function(r){try{t=r.__h,r.__h=[],t.some((function(e){e.call(r)}))}catch(t){e.__e(t,r.__v)}}))}function T(e,t,r,n,i,a,c,u){var h,d,p,f,g=r.props,m=t.props,y=t.type,_=0;if("svg"===y&&(i=!0),null!=a)for(;_<a.length;_++)if((h=a[_])&&(h===e||(y?h.localName==y:3==h.nodeType))){e=h,a[_]=null;break}if(null==e){if(null===y)return document.createTextNode(m);e=i?document.createElementNS("http://www.w3.org/2000/svg",y):document.createElement(y,m.is&&m),a=null,u=!1}if(null===y)g===m||u&&e.data===m||(e.data=m);else{if(a=a&&o.slice.call(e.childNodes),d=(g=r.props||s).dangerouslySetInnerHTML,p=m.dangerouslySetInnerHTML,!u){if(null!=a)for(g={},f=0;f<e.attributes.length;f++)g[e.attributes[f].name]=e.attributes[f].value;(p||d)&&(p&&(d&&p.__html==d.__html||p.__html===e.innerHTML)||(e.innerHTML=p&&p.__html||""))}if(function(e,t,r,n,i){var s;for(s in r)"children"===s||"key"===s||s in t||S(e,s,null,r[s],n);for(s in t)i&&"function"!=typeof t[s]||"children"===s||"key"===s||"value"===s||"checked"===s||r[s]===t[s]||S(e,s,t[s],r[s],n)}(e,m,g,i,u),p)t.__k=[];else if(_=t.props.children,v(e,Array.isArray(_)?_:[_],t,r,n,i&&"foreignObject"!==y,a,c,e.firstChild,u),null!=a)for(_=a.length;_--;)null!=a[_]&&l(a[_]);u||("value"in m&&void 0!==(_=m.value)&&(_!==e.value||"progress"===y&&!_)&&S(e,"value",_,g.value,!1),"checked"in m&&void 0!==(_=m.checked)&&_!==e.checked&&S(e,"checked",_,g.checked,!1))}return e}function C(t,r,n){try{"function"==typeof t?t(r):t.current=r}catch(t){e.__e(t,n)}}function I(t,r,n){var i,s,o;if(e.unmount&&e.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||C(i,null,r)),n||"function"==typeof t.type||(n=null!=(s=t.__e)),t.__e=t.__d=void 0,null!=(i=t.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(t){e.__e(t,r)}i.base=i.__P=null}if(i=t.__k)for(o=0;o<i.length;o++)i[o]&&I(i[o],r,n);null!=s&&l(s)}function R(e,t,r){return this.constructor(e,r)}e={__e:function(e,t){for(var r,n,i;t=t.__;)if((r=t.__c)&&!r.__)try{if((n=r.constructor)&&null!=n.getDerivedStateFromError&&(r.setState(n.getDerivedStateFromError(e)),i=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e),i=r.__d),i)return r.__E=r}catch(t){e=t}throw e},__v:0},p.prototype.setState=function(e,t){var r;r=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof e&&(e=e(c({},r),this.props)),e&&c(r,e),null!=e&&this.__v&&(t&&this.__h.push(t),m(this))},p.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),m(this))},p.prototype.render=d,t=[],r="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,y.__r=0;const O="org.populus.annotation.4",P="populus.open-tower.com",D="https://"+P;class M{constructor(e){this.hue=function(e){if(M[e])return M[e];var t,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return M[e]=r%360,M[e]}(e),this.light="hsl("+this.hue+",100%, 80%)",this.dark="hsl("+this.hue+",100%, 20%)",this.ultralight="hsl("+this.hue+",100%, 95%)",this.styleVariables={"--user_ultralight":this.ultralight,"--user_light":this.light,"--user_dark":this.dark}}}const L=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},u("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),u("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),u("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),N=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},u("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),u("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),F=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-upload"},u("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),u("polyline",{points:"17 8 12 3 7 8"}),u("line",{x1:"12",y1:"3",x2:"12",y2:"15"})),B=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-image"},u("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),u("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),u("polyline",{points:"21 15 16 10 5 21"})),U=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search"},u("circle",{cx:"11",cy:"11",r:"8"}),u("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),q=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-file-plus"},u("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),u("polyline",{points:"14 2 14 8 20 8"}),u("line",{x1:"12",y1:"18",x2:"12",y2:"12"}),u("line",{x1:"9",y1:"15",x2:"15",y2:"15"})),j=(u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-settings"},u("circle",{cx:"12",cy:"12",r:"3"}),u("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})),u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-more-horizontal"},u("circle",{cx:"12",cy:"12",r:"1"}),u("circle",{cx:"19",cy:"12",r:"1"}),u("circle",{cx:"5",cy:"12",r:"1"}))),K=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevron-left"},u("polyline",{points:"15 18 9 12 15 6"})),z=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevron-right"},u("polyline",{points:"9 18 15 12 9 6"})),$=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevrons-right"},u("polyline",{points:"13 17 18 12 13 7"}),u("polyline",{points:"6 17 11 12 6 7"})),G=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevrons-left"},u("polyline",{points:"11 17 6 12 11 7"}),u("polyline",{points:"18 17 13 12 18 7"})),V=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-edit"},u("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),u("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})),H=u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x-square"},u("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),u("line",{x1:"9",y1:"9",x2:"15",y2:"15"}),u("line",{x1:"15",y1:"9",x2:"9",y2:"15"}));var W=__webpack_require__(3379),Y=__webpack_require__.n(W),X=__webpack_require__(5188);function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Y()(X.Z,{insert:"head",singleton:!1}),X.Z.locals;class Z extends p{constructor(e){super(e),Q(this,"toggleUploadVisible",(e=>this.setState({uploadVisible:!this.state.uploadVisible}))),Q(this,"handleInputFocus",(e=>this.setState({inputFocus:!0,uploadVisible:!1}))),Q(this,"handleInputBlur",(e=>this.setState({inputFocus:!1}))),Q(this,"handleInput",(e=>{this.setState({searchFilter:e.target.value})})),this.state={uploadVisible:!1,inputFocus:!1,searchFilter:""};let t=e.client.getUserId();this.userColor=new M(t),this.initial=t.slice(1,2),console.log(this.initial)}render(e,t){return u(d,null,u("header",{id:"welcome-header"},u("div",{id:"welcome-header-content"},u("div",{id:"welcome-search"},u("input",{value:t.searchFilter,oninput:this.handleInput,onblur:this.handleInputBlur,onfocus:this.handleInputFocus,id:"welcome-search-input"}),U),!t.inputFocus&&u(d,null,u("div",{id:"welcome-upload",onclick:this.toggleUploadVisible},q),u("div",{style:this.userColor.styleVariables,id:"welcome-profile"},u("div",{id:"welcome-initial"},this.initial))))),u("div",{id:"welcome-container"},t.uploadVisible?u(d,null,u("h2",null,"Upload a new PDF"),u(oe,{client:e.client})):u(d,null,u("h2",null,"Conversations"),u(ee,J({searchFilter:t.searchFilter},e))),u(te,{logoutHandler:e.logoutHandler})))}}class ee extends p{constructor(e){super(e),this.state={rooms:e.client.getVisibleRooms()},this.roomListener=this.roomListener.bind(this)}roomListener(e){this.setState({rooms:this.props.client.getVisibleRooms()})}componentDidMount(){this.props.client.on("Room",this.roomListener),this.props.client.on("Room.name",this.roomListener),this.props.client.on("RoomState.events",this.roomListener)}componentWillUnmount(){this.props.client.off("Room",this.roomListener),this.props.client.off("Room.name",this.roomListener),this.props.client.on("RoomState.events",this.roomListener)}render(e,t){const r=t.rooms.filter((t=>t.name.toLowerCase().includes(e.searchFilter.toLowerCase()))).sort(((e,t)=>{const r=e.getLastActiveTimestamp(),n=t.getLastActiveTimestamp();return r<n?1:n<r?-1:0})).map((t=>u(re,{loadPDF:e.loadPDF,client:e.client,room:t})));return u(d,null,u("div",null,r))}}class te extends p{render(e,t){return u("footer",null,u("a",{href:"#",onclick:e.logoutHandler},"logout"))}}class re extends p{render(e,t){var r=e.room.getLiveTimeline().getState(i.EventTimeline.FORWARDS).getStateEvents("org.populus.pdf","");return r?u(ne,{loadPDF:e.loadPDF,client:e.client,room:e.room,pdfevent:r}):u(se,{room:e.room})}}class ne extends p{render(e,t){const r=new Date(e.room.getLastActiveTimestamp()),n=e.room.getJoinedMembers(),i=n.map((e=>e.userId)),s=n.map((e=>u(ie,{member:e}))),o=e.client.getUserId();var a="invited";return i.includes(o)&&(a="joined"),u("div",{key:e.room.roomId,"data-room-status":a,class:"roomListingEntry",id:e.room.roomId},u("div",null,u("a",{onclick:t=>e.loadPDF(e.room.name)},e.room.name)),u("div",null,"Members: ",s," "),u("div",null,"Last Active: ",r.toDateString(),", ",r.toTimeString()))}}class ie extends p{render(e,t){return u(d,null,u("span",{style:{background:new M(e.member.userId).light},class:"memberPill"},e.member.userId),u("wbr",null))}}class se extends p{render(e,t){return u("div",{key:e.room.roomId,class:"roomListingEntry",id:e.room.name},e.room.name)}}class oe extends p{constructor(e){super(e),Q(this,"mainForm",{current:null}),Q(this,"fileLoader",{current:null}),Q(this,"roomNameInput",{current:null}),Q(this,"roomTopicInput",{current:null}),Q(this,"uploadFile",(async e=>{e.preventDefault();const t=this.fileLoader.current.files[0],r=this.roomNameInput.current.value,n=this.roomTopicInput.current.value;if("application/pdf"==t.type){const e=await this.props.client.createRoom({room_alias_name:r,visibility:"public",name:r,topic:n,creation_content:{"org.matrix.msc1772.type":"org.matrix.msc1772.space"},initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}}],power_level_content_override:{events:{[O]:0}}});this.props.client.uploadContent(t).then((t=>{let r=t.split("/");this.props.client.sendStateEvent(e.room_id,"org.populus.pdf",{identifier:r[r.length-1]})})).then((e=>this.mainForm.current.reset()))}}))}render(e,t){return u("form",{id:"pdfUploadForm",ref:this.mainForm,onsubmit:this.uploadFile},u("label",null," Pdf to discuss"),u("input",{ref:this.fileLoader,type:"file"}),u("label",null,"Name for Discussion"),u("input",{ref:this.roomNameInput,type:"text"}),u("label",null,"Topic of Discussion"),u("textarea",{ref:this.roomTopicInput,type:"text"}),u("div",null,u("input",{value:"Create Discussion",type:"submit"})))}}var ae=__webpack_require__(2462);function ce(){return(ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Y()(ae.Z,{insert:"head",singleton:!1}),ae.Z.locals;class ue extends p{constructor(e){super(e),le(this,"switchView",(e=>{e.preventDefault(),this.setState((e=>({registering:!e.registering})))})),this.client=e.client,this.state={registering:!1}}render(e,t){return t.registering?u("div",null,u(de,ce({},e,{switchView:this.switchView}))):u("div",null,u(he,ce({},e,{switchView:this.switchView})))}}class he extends p{constructor(e){super(e),le(this,"handleSubmit",(e=>{e.preventDefault();const t=document.getElementById("loginForm"),r=new FormData(t),n=Array.from(r.entries()).map((e=>e[1]));this.client.loginWithPassword(n[0],n[1]).then((e=>this.loginHandler())).catch((e=>window.alert(e)))})),this.loginHandler=e.loginHandler,this.client=e.client}render(e,t){return u("div",{id:"loginModal"},u("h3",null,"Login To Populus"),u("form",{id:"loginForm"},u(pe,null),u("div",null,u("button",{onclick:this.handleSubmit},"Login"),u("button",{onclick:e.switchView},"Register"))))}}class de extends p{constructor(e){super(e),le(this,"recaptchaHandler",(e=>{e.preventDefault();const t=document.getElementById("registerForm"),r=new FormData(t),n=Array.from(r.entries()).map((e=>e[1]));this.client.register(n[0],n[1],void 0,{type:"m.login.recaptcha",response:e.detail}).then((e=>this.client.loginWithPassword(n[0],n[1]))).then((e=>this.loginHandler())).catch((e=>window.alert(e)))})),this.loginHandler=e.loginHandler,this.client=e.client,window.addEventListener("recaptcha",this.recaptchaHandler)}render(e,t){return u("div",{id:"registrationModal"},u("h3",null,"Register on Populus"),u("form",{id:"registerForm"},u(pe,null),u("div",{id:"theRecaptcha"},"Complete this Recaptcha to register",u("div",{class:"g-recaptcha","data-sitekey":"6Lf43YEaAAAAAAeDHR1ozhTXVqq--Wthr_MQlYam","data-callback":"recaptchaHandler"})),u("div",null,"OR, ",u("button",{onclick:e.switchView},"Login With Existing Account")),u("script",{src:"https://www.google.com/recaptcha/api.js",async:!0,defer:!0})))}}class pe extends p{render(){return u(d,null,u("label",{for:"username"},"Username"),u("input",{type:"text",id:"username",name:"username"}),u("label",{for:"password"},"Password"),u("input",{type:"password",id:"password",name:"password"}))}}var fe=__webpack_require__(2372);function ge(e,t){t.offsetParent,t.style.height=e.height+"px",t.style.width=e.width+"px"}function me(e,t,r){var n=t.offsetParent.offsetParent;t.style.left=e.left-n.offsetLeft/r+"px",t.style.top=e.top-n.offsetTop/r+"px",t.style.height=e.height+"px",t.style.width=e.width+"px"}var ye=__webpack_require__(5047);Y()(ye.Z,{insert:"head",singleton:!1}),ye.Z.locals;var ve=__webpack_require__(8046);Y()(ve.Z,{insert:"head",singleton:!1}),ve.Z.locals;var _e=__webpack_require__(145);function be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Y()(_e.Z,{insert:"head",singleton:!1}),_e.Z.locals;class we extends p{constructor(e){super(e),be(this,"handleStateChange",(e=>{e.getRoomId()==this.props.roomId&&e.getType()==O&&this.forceUpdate()})),this.handleStateChange=this.handleStateChange.bind(this)}componentDidMount(){this.props.client.on("RoomState.events",this.handleStateChange)}componentWillUnmount(){this.props.client.off("RoomState.events",this.handleStateChange)}filterAnnotations(e){return e.getContent().pageNumber==this.props.page&&"closed"!=e.getContent().activityStatus}render(e,t){const r=e.client.getRoom(e.roomId),n=e.focus?e.focus.uuid:null;var s=[];return r&&(s=r.getLiveTimeline().getState(i.EventTimeline.FORWARDS).getStateEvents(O).filter((e=>this.filterAnnotations(e))).map((t=>u(Se,{zoomFactor:e.zoomFactor,focused:n==t.getContent().uuid,setFocus:e.setFocus,event:t})))),u("div",{ref:e.annotationLayerWrapper,id:"annotation-layer"},s)}}class Se extends p{constructor(...e){super(...e),be(this,"setFocus",(e=>{this.props.setFocus(this.props.event.getContent())}))}render(e,t){const r=e.event.getContent().uuid,n=JSON.parse(e.event.getContent().clientRects).map((e=>u(ke,{zoomFactor:this.props.zoomFactor,setFocus:this.setFocus,rect:e})));return u("div",{"data-focused":e.focused,id:r},n)}}class ke extends p{constructor(...e){super(...e),be(this,"ref",{current:null})}componentDidMount(){me(this.props.rect,this.ref.current,this.props.zoomFactor)}componentDidUpdate(){me(this.props.rect,this.ref.current,this.props.zoomFactor)}render(e,t){return u("span",{onclick:e.setFocus,"data-annotation":!0,ref:this.ref})}}var Ee=__webpack_require__(5789);function xe(e){switch(e._type){case"document":case"block_quote":case"list":case"item":case"paragraph":case"heading":case"emph":case"strong":case"link":case"image":case"custom_inline":case"custom_block":return!0;default:return!1}}Y()(Ee.Z,{insert:"head",singleton:!1}),Ee.Z.locals;var Ae=function(e,t){this.current=e,this.entering=!0===t},Te=function(){var e=this.current,t=this.entering;if(null===e)return null;var r=xe(e);return t&&r?e._firstChild?(this.current=e._firstChild,this.entering=!0):this.entering=!1:e===this.root?this.current=null:null===e._next?(this.current=e._parent,this.entering=!1):(this.current=e._next,this.entering=!0),{entering:t,node:e}},Ce=function(e){return{current:e,root:e,entering:!0,next:Te,resumeAt:Ae}},Ie=function(e,t){this._type=e,this._parent=null,this._firstChild=null,this._lastChild=null,this._prev=null,this._next=null,this._sourcepos=t,this._lastLineBlank=!1,this._lastLineChecked=!1,this._open=!0,this._string_content=null,this._literal=null,this._listData={},this._info=null,this._destination=null,this._title=null,this._isFenced=!1,this._fenceChar=null,this._fenceLength=0,this._fenceOffset=null,this._level=null,this._onEnter=null,this._onExit=null},Re=Ie.prototype;Object.defineProperty(Re,"isContainer",{get:function(){return xe(this)}}),Object.defineProperty(Re,"type",{get:function(){return this._type}}),Object.defineProperty(Re,"firstChild",{get:function(){return this._firstChild}}),Object.defineProperty(Re,"lastChild",{get:function(){return this._lastChild}}),Object.defineProperty(Re,"next",{get:function(){return this._next}}),Object.defineProperty(Re,"prev",{get:function(){return this._prev}}),Object.defineProperty(Re,"parent",{get:function(){return this._parent}}),Object.defineProperty(Re,"sourcepos",{get:function(){return this._sourcepos}}),Object.defineProperty(Re,"literal",{get:function(){return this._literal},set:function(e){this._literal=e}}),Object.defineProperty(Re,"destination",{get:function(){return this._destination},set:function(e){this._destination=e}}),Object.defineProperty(Re,"title",{get:function(){return this._title},set:function(e){this._title=e}}),Object.defineProperty(Re,"info",{get:function(){return this._info},set:function(e){this._info=e}}),Object.defineProperty(Re,"level",{get:function(){return this._level},set:function(e){this._level=e}}),Object.defineProperty(Re,"listType",{get:function(){return this._listData.type},set:function(e){this._listData.type=e}}),Object.defineProperty(Re,"listTight",{get:function(){return this._listData.tight},set:function(e){this._listData.tight=e}}),Object.defineProperty(Re,"listStart",{get:function(){return this._listData.start},set:function(e){this._listData.start=e}}),Object.defineProperty(Re,"listDelimiter",{get:function(){return this._listData.delimiter},set:function(e){this._listData.delimiter=e}}),Object.defineProperty(Re,"onEnter",{get:function(){return this._onEnter},set:function(e){this._onEnter=e}}),Object.defineProperty(Re,"onExit",{get:function(){return this._onExit},set:function(e){this._onExit=e}}),Ie.prototype.appendChild=function(e){e.unlink(),e._parent=this,this._lastChild?(this._lastChild._next=e,e._prev=this._lastChild,this._lastChild=e):(this._firstChild=e,this._lastChild=e)},Ie.prototype.prependChild=function(e){e.unlink(),e._parent=this,this._firstChild?(this._firstChild._prev=e,e._next=this._firstChild,this._firstChild=e):(this._firstChild=e,this._lastChild=e)},Ie.prototype.unlink=function(){this._prev?this._prev._next=this._next:this._parent&&(this._parent._firstChild=this._next),this._next?this._next._prev=this._prev:this._parent&&(this._parent._lastChild=this._prev),this._parent=null,this._next=null,this._prev=null},Ie.prototype.insertAfter=function(e){e.unlink(),e._next=this._next,e._next&&(e._next._prev=e),e._prev=this,this._next=e,e._parent=this._parent,e._next||(e._parent._lastChild=e)},Ie.prototype.insertBefore=function(e){e.unlink(),e._prev=this._prev,e._prev&&(e._prev._next=e),e._next=this,this._prev=e,e._parent=this._parent,e._prev||(e._parent._firstChild=e)},Ie.prototype.walker=function(){return new Ce(this)};const Oe=Ie;var Pe,De=__webpack_require__(729),Me=__webpack_require__(5863),Le=new RegExp("^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>]|\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e|[<][?][\\s\\S]*?[?][>]|<![A-Z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)"),Ne=/[\\&]/,Fe="[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]",Be=new RegExp("\\\\"+Fe+"|&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});","gi"),Ue=new RegExp('[&<>"]',"g"),qe=function(e){return 92===e.charCodeAt(0)?e.charAt(1):(0,Me.decodeHTML)(e)},je=function(e){return Ne.test(e)?e.replace(Be,qe):e},Ke=function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return e}},ze=function(e){return Ue.test(e)?e.replace(Ue,Ke):e};function $e(e){return Pe(e)}if(String.fromCodePoint)Pe=function(e){try{return String.fromCodePoint(e)}catch(e){if(e instanceof RangeError)return String.fromCharCode(65533);throw e}};else{var Ge=String.fromCharCode,Ve=Math.floor;Pe=function(){var e,t,r=16384,n=[],i=-1,s=arguments.length;if(!s)return"";for(var o="";++i<s;){var a=Number(arguments[i]);if(!isFinite(a)||a<0||a>1114111||Ve(a)!==a)return String.fromCharCode(65533);a<=65535?n.push(a):(e=55296+((a-=65536)>>10),t=a%1024+56320,n.push(e,t)),(i+1===s||n.length>r)&&(o+=Ge.apply(null,n),n.length=0)}return o}}__webpack_require__(8822);var He=function(e){try{return De(e)}catch(t){return e}},We=je,Ye=39,Xe=34,Je=Fe,Qe="\\\\"+Je,Ze=Le,et=new RegExp(/[!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/),tt=new RegExp('^(?:"('+Qe+'|[^"\\x00])*"|\'('+Qe+"|[^'\\x00])*'|\\(("+Qe+"|[^()\\x00])*\\))"),rt=/^(?:<(?:[^<>\n\\\x00]|\\.)*>)/,nt=new RegExp("^"+Je),it=new RegExp("^&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});","i"),st=/`+/,ot=/^`+/,at=/\.\.\./g,ct=/--+/g,lt=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,ut=/^<[A-Za-z][A-Za-z0-9.+-]{1,31}:[^<>\x00-\x20]*>/i,ht=/^ *(?:\n *)?/,dt=/^[ \t\n\x0b\x0c\x0d]/,pt=/^\s/,ft=/ *$/,gt=/^ */,mt=/^ *(?:\n|$)/,yt=/^\[(?:[^\\\[\]]|\\.){0,1000}\]/,vt=/^[^\n`\[\]\\!<&*_'"]+/m,_t=function(e){var t=new Oe("text");return t._literal=e,t},bt=function(e){return e.slice(1,e.length-1).trim().replace(/[ \t\r\n]+/," ").toLowerCase().toUpperCase()},wt=function(e){var t=e.exec(this.subject.slice(this.pos));return null===t?null:(this.pos+=t.index+t[0].length,t[0])},St=function(){return this.pos<this.subject.length?this.subject.charCodeAt(this.pos):-1},kt=function(){return this.match(ht),!0},Et=function(e){var t=this.match(ot);if(null===t)return!1;for(var r,n,i,s=this.pos;null!==(r=this.match(st));)if(r===t)return n=new Oe("code"),(i=this.subject.slice(s,this.pos-t.length).replace(/\n/gm," ")).length>0&&null!==i.match(/[^ ]/)&&" "==i[0]&&" "==i[i.length-1]?n._literal=i.slice(1,i.length-1):n._literal=i,e.appendChild(n),!0;return this.pos=s,e.appendChild(_t(t)),!0},xt=function(e){var t,r=this.subject;return this.pos+=1,10===this.peek()?(this.pos+=1,t=new Oe("linebreak"),e.appendChild(t)):nt.test(r.charAt(this.pos))?(e.appendChild(_t(r.charAt(this.pos))),this.pos+=1):e.appendChild(_t("\\")),!0},At=function(e){var t,r,n;return(t=this.match(lt))?(r=t.slice(1,t.length-1),(n=new Oe("link"))._destination=He("mailto:"+r),n._title="",n.appendChild(_t(r)),e.appendChild(n),!0):!!(t=this.match(ut))&&(r=t.slice(1,t.length-1),(n=new Oe("link"))._destination=He(r),n._title="",n.appendChild(_t(r)),e.appendChild(n),!0)},Tt=function(e){var t=this.match(Ze);if(null===t)return!1;var r=new Oe("html_inline");return r._literal=t,e.appendChild(r),!0},Ct=function(e){var t,r,n,i,s,o,a,c,l,u,h,d=0,p=this.pos;if(e===Ye||e===Xe)d++,this.pos++;else for(;this.peek()===e;)d++,this.pos++;return 0===d?null:(t=0===p?"\n":this.subject.charAt(p-1),r=-1===(n=this.peek())?"\n":$e(n),c=pt.test(r),l=et.test(r),u=pt.test(t),h=et.test(t),i=!c&&(!l||u||h),s=!u&&(!h||c||l),95===e?(o=i&&(!s||h),a=s&&(!i||l)):e===Ye||e===Xe?(o=i&&!s,a=s):(o=i,a=s),this.pos=p,{numdelims:d,can_open:o,can_close:a})},It=function(e,t){var r=this.scanDelims(e);if(!r)return!1;var n,i=r.numdelims,s=this.pos;this.pos+=i,n=e===Ye?"":e===Xe?"":this.subject.slice(s,this.pos);var o=_t(n);return t.appendChild(o),(r.can_open||r.can_close)&&(this.options.smart||e!==Ye&&e!==Xe)&&(this.delimiters={cc:e,numdelims:i,origdelims:i,node:o,previous:this.delimiters,next:null,can_open:r.can_open,can_close:r.can_close},null!==this.delimiters.previous&&(this.delimiters.previous.next=this.delimiters)),!0},Rt=function(e){null!==e.previous&&(e.previous.next=e.next),null===e.next?this.delimiters=e.previous:e.next.previous=e.previous},Ot=function(e){for(var t,r,n,i,s,o,a,c,l,u,h,d,p=[[],[],[]],f=!1,g=0;g<3;g++)p[g][95]=e,p[g][42]=e,p[g][39]=e,p[g][34]=e;for(r=this.delimiters;null!==r&&r.previous!==e;)r=r.previous;for(;null!==r;){var m=r.cc;if(r.can_close){for(t=r.previous,u=!1;null!==t&&t!==e&&t!==p[r.origdelims%3][m];){if(f=(r.can_open||t.can_close)&&r.origdelims%3!=0&&(t.origdelims+r.origdelims)%3==0,t.cc===r.cc&&t.can_open&&!f){u=!0;break}t=t.previous}if(n=r,42===m||95===m)if(u){a=r.numdelims>=2&&t.numdelims>=2?2:1,i=t.node,s=r.node,t.numdelims-=a,r.numdelims-=a,i._literal=i._literal.slice(0,i._literal.length-a),s._literal=s._literal.slice(0,s._literal.length-a);var y=new Oe(1===a?"emph":"strong");for(c=i._next;c&&c!==s;)l=c._next,c.unlink(),y.appendChild(c),c=l;i.insertAfter(y),d=r,(h=t).next!==d&&(h.next=d,d.previous=h),0===t.numdelims&&(i.unlink(),this.removeDelimiter(t)),0===r.numdelims&&(s.unlink(),o=r.next,this.removeDelimiter(r),r=o)}else r=r.next;else m===Ye?(r.node._literal="",u&&(t.node._literal=""),r=r.next):m===Xe&&(r.node._literal="",u&&(t.node.literal=""),r=r.next);u||(p[n.origdelims%3][m]=n.previous,n.can_open||this.removeDelimiter(n))}else r=r.next}for(;null!==this.delimiters&&this.delimiters!==e;)this.removeDelimiter(this.delimiters)},Pt=function(){var e=this.match(tt);return null===e?null:We(e.substr(1,e.length-2))},Dt=function(){var e=this.match(rt);if(null===e){if(60===this.peek())return null;for(var t,r=this.pos,n=0;-1!==(t=this.peek());)if(92===t&&nt.test(this.subject.charAt(this.pos+1)))this.pos+=1,-1!==this.peek()&&(this.pos+=1);else if(40===t)this.pos+=1,n+=1;else if(41===t){if(n<1)break;this.pos+=1,n-=1}else{if(null!==dt.exec($e(t)))break;this.pos+=1}return this.pos===r&&41!==t||0!==n?null:(e=this.subject.substr(r,this.pos-r),He(We(e)))}return He(We(e.substr(1,e.length-2)))},Mt=function(){var e=this.match(yt);return null===e||e.length>1001?0:e.length},Lt=function(e){var t=this.pos;this.pos+=1;var r=_t("[");return e.appendChild(r),this.addBracket(r,t,!1),!0},Nt=function(e){var t=this.pos;if(this.pos+=1,91===this.peek()){this.pos+=1;var r=_t("![");e.appendChild(r),this.addBracket(r,t+1,!0)}else e.appendChild(_t("!"));return!0},Ft=function(e){var t,r,n,i,s,o,a=!1;if(this.pos+=1,t=this.pos,null===(o=this.brackets))return e.appendChild(_t("]")),!0;if(!o.active)return e.appendChild(_t("]")),this.removeBracket(),!0;r=o.image;var c=this.pos;if(40===this.peek()&&(this.pos++,this.spnl()&&null!==(n=this.parseLinkDestination())&&this.spnl()&&(dt.test(this.subject.charAt(this.pos-1))&&(i=this.parseLinkTitle()),1)&&this.spnl()&&41===this.peek()?(this.pos+=1,a=!0):this.pos=c),!a){var l=this.pos,u=this.parseLinkLabel();if(u>2?s=this.subject.slice(l,l+u):o.bracketAfter||(s=this.subject.slice(o.index,t)),0===u&&(this.pos=c),s){var h=this.refmap[bt(s)];h&&(n=h.destination,i=h.title,a=!0)}}if(a){var d,p,f=new Oe(r?"image":"link");for(f._destination=n,f._title=i||"",d=o.node._next;d;)p=d._next,d.unlink(),f.appendChild(d),d=p;if(e.appendChild(f),this.processEmphasis(o.previousDelimiter),this.removeBracket(),o.node.unlink(),!r)for(o=this.brackets;null!==o;)o.image||(o.active=!1),o=o.previous;return!0}return this.removeBracket(),this.pos=t,e.appendChild(_t("]")),!0},Bt=function(e,t,r){null!==this.brackets&&(this.brackets.bracketAfter=!0),this.brackets={node:e,previous:this.brackets,previousDelimiter:this.delimiters,index:t,image:r,active:!0}},Ut=function(){this.brackets=this.brackets.previous},qt=function(e){var t;return!!(t=this.match(it))&&(e.appendChild(_t((0,Me.decodeHTML)(t))),!0)},jt=function(e){var t;return!!(t=this.match(vt))&&(this.options.smart?e.appendChild(_t(t.replace(at,"").replace(ct,(function(e){var t=0,r=0;return e.length%3==0?r=e.length/3:e.length%2==0?t=e.length/2:e.length%3==2?(t=1,r=(e.length-2)/3):(t=2,r=(e.length-4)/3),"".repeat(r)+"".repeat(t)})))):e.appendChild(_t(t)),!0)},Kt=function(e){this.pos+=1;var t=e._lastChild;if(t&&"text"===t.type&&" "===t._literal[t._literal.length-1]){var r=" "===t._literal[t._literal.length-2];t._literal=t._literal.replace(ft,""),e.appendChild(new Oe(r?"linebreak":"softbreak"))}else e.appendChild(new Oe("softbreak"));return this.match(gt),!0},zt=function(e,t){var r,n,i,s;this.subject=e,this.pos=0;var o=this.pos;if(0===(s=this.parseLinkLabel()))return 0;if(r=this.subject.substr(0,s),58!==this.peek())return this.pos=o,0;if(this.pos++,this.spnl(),null===(n=this.parseLinkDestination()))return this.pos=o,0;var a=this.pos;this.spnl(),this.pos!==a&&(i=this.parseLinkTitle()),null===i&&(i="",this.pos=a);var c=!0;if(null===this.match(mt)&&(""===i?c=!1:(i="",this.pos=a,c=null!==this.match(mt))),!c)return this.pos=o,0;var l=bt(r);return""===l?(this.pos=o,0):(t[l]||(t[l]={destination:n,title:i}),this.pos-o)},$t=function(e){var t=!1,r=this.peek();if(-1===r)return!1;switch(r){case 10:t=this.parseNewline(e);break;case 92:t=this.parseBackslash(e);break;case 96:t=this.parseBackticks(e);break;case 42:case 95:t=this.handleDelim(r,e);break;case Ye:case Xe:t=this.options.smart&&this.handleDelim(r,e);break;case 91:t=this.parseOpenBracket(e);break;case 33:t=this.parseBang(e);break;case 93:t=this.parseCloseBracket(e);break;case 60:t=this.parseAutolink(e)||this.parseHtmlTag(e);break;case 38:t=this.parseEntity(e);break;default:t=this.parseString(e)}return t||(this.pos+=1,e.appendChild(_t($e(r)))),!0},Gt=function(e){for(this.subject=e._string_content.trim(),this.pos=0,this.delimiters=null,this.brackets=null;this.parseInline(e););e._string_content=null,this.processEmphasis(null)};const Vt=function(e){return{subject:"",delimiters:null,brackets:null,pos:0,refmap:{},match:wt,peek:St,spnl:kt,parseBackticks:Et,parseBackslash:xt,parseAutolink:At,parseHtmlTag:Tt,scanDelims:Ct,handleDelim:It,parseLinkTitle:Pt,parseLinkDestination:Dt,parseLinkLabel:Mt,parseOpenBracket:Lt,parseBang:Nt,parseCloseBracket:Ft,addBracket:Bt,removeBracket:Ut,parseEntity:qt,parseString:jt,parseNewline:Kt,parseReference:zt,parseInline:$t,processEmphasis:Ot,removeDelimiter:Rt,options:e||{},parse:Gt}};var Ht=[/./,/^<(?:script|pre|textarea|style)(?:\s|>|$)/i,/^<!--/,/^<[?]/,/^<![A-Z]/,/^<!\[CDATA\[/,/^<[/]?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[123456]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|[/]?[>]|$)/i,new RegExp("^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>])\\s*$","i")],Wt=[/./,/<\/(?:script|pre|textarea|style)>/i,/-->/,/\?>/,/>/,/\]\]>/],Yt=/^(?:(?:\*[ \t]*){3,}|(?:_[ \t]*){3,}|(?:-[ \t]*){3,})[ \t]*$/,Xt=/^[#`~*+_=<>0-9-]/,Jt=/[^ \t\f\v\r\n]/,Qt=/^[*+-]/,Zt=/^(\d{1,9})([.)])/,er=/^#{1,6}(?:[ \t]+|$)/,tr=/^`{3,}(?!.*`)|^~{3,}/,rr=/^(?:`{3,}|~{3,})(?= *$)/,nr=/^(?:=+|-+)[ \t]*$/,ir=/\r\n|\n|\r/,sr=function(e){return 32===e||9===e},or=function(e,t){return t<e.length?e.charCodeAt(t):-1},ar=function(e){for(;e;){if(e._lastLineBlank)return!0;var t=e.type;if(e._lastLineChecked||"list"!==t&&"item"!==t){e._lastLineChecked=!0;break}e._lastLineChecked=!0,e=e._lastChild}return!1},cr=function(){if(this.partiallyConsumedTab){this.offset+=1;var e=4-this.column%4;this.tip._string_content+=" ".repeat(e)}this.tip._string_content+=this.currentLine.slice(this.offset)+"\n"},lr=function(e,t){for(;!this.blocks[this.tip.type].canContain(e);)this.finalize(this.tip,this.lineNumber-1);var r=t+1,n=new Oe(e,[[this.lineNumber,r],[0,0]]);return n._string_content="",this.tip.appendChild(n),this.tip=n,n},ur=function(){if(!this.allClosed){for(;this.oldtip!==this.lastMatchedContainer;){var e=this.oldtip._parent;this.finalize(this.oldtip,this.lineNumber-1),this.oldtip=e}this.allClosed=!0}},hr={document:{continue:function(){return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},list:{continue:function(){return 0},finalize:function(e,t){for(var r=t._firstChild;r;){if(ar(r)&&r._next){t._listData.tight=!1;break}for(var n=r._firstChild;n;){if(ar(n)&&(r._next||n._next)){t._listData.tight=!1;break}n=n._next}r=r._next}},canContain:function(e){return"item"===e},acceptsLines:!1},block_quote:{continue:function(e){var t=e.currentLine;return e.indented||62!==or(t,e.nextNonspace)?1:(e.advanceNextNonspace(),e.advanceOffset(1,!1),sr(or(t,e.offset))&&e.advanceOffset(1,!0),0)},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},item:{continue:function(e,t){if(e.blank){if(null==t._firstChild)return 1;e.advanceNextNonspace()}else{if(!(e.indent>=t._listData.markerOffset+t._listData.padding))return 1;e.advanceOffset(t._listData.markerOffset+t._listData.padding,!0)}return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},heading:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},thematic_break:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},code_block:{continue:function(e,t){var r=e.currentLine,n=e.indent;if(t._isFenced){var i=n<=3&&r.charAt(e.nextNonspace)===t._fenceChar&&r.slice(e.nextNonspace).match(rr);if(i&&i[0].length>=t._fenceLength)return e.lastLineLength=e.offset+n+i[0].length,e.finalize(t,e.lineNumber),2;for(var s=t._fenceOffset;s>0&&sr(or(r,e.offset));)e.advanceOffset(1,!0),s--}else if(n>=4)e.advanceOffset(4,!0);else{if(!e.blank)return 1;e.advanceNextNonspace()}return 0},finalize:function(e,t){if(t._isFenced){var r=t._string_content,n=r.indexOf("\n"),i=r.slice(0,n),s=r.slice(n+1);t.info=je(i.trim()),t._literal=s}else t._literal=t._string_content.replace(/(\n *)+$/,"\n");t._string_content=null},canContain:function(){return!1},acceptsLines:!0},html_block:{continue:function(e,t){return!e.blank||6!==t._htmlBlockType&&7!==t._htmlBlockType?0:1},finalize:function(e,t){t._literal=t._string_content.replace(/(\n *)+$/,""),t._string_content=null},canContain:function(){return!1},acceptsLines:!0},paragraph:{continue:function(e){return e.blank?1:0},finalize:function(e,t){for(var r,n=!1;91===or(t._string_content,0)&&(r=e.inlineParser.parseReference(t._string_content,e.refmap));)t._string_content=t._string_content.slice(r),n=!0;n&&function(e){return!Jt.test(e)}(t._string_content)&&t.unlink()},canContain:function(){return!1},acceptsLines:!0}},dr=[function(e){return e.indented||62!==or(e.currentLine,e.nextNonspace)?0:(e.advanceNextNonspace(),e.advanceOffset(1,!1),sr(or(e.currentLine,e.offset))&&e.advanceOffset(1,!0),e.closeUnmatchedBlocks(),e.addChild("block_quote",e.nextNonspace),1)},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(er))){e.advanceNextNonspace(),e.advanceOffset(t[0].length,!1),e.closeUnmatchedBlocks();var r=e.addChild("heading",e.nextNonspace);return r.level=t[0].trim().length,r._string_content=e.currentLine.slice(e.offset).replace(/^[ \t]*#+[ \t]*$/,"").replace(/[ \t]+#+[ \t]*$/,""),e.advanceOffset(e.currentLine.length-e.offset),2}return 0},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(tr))){var r=t[0].length;e.closeUnmatchedBlocks();var n=e.addChild("code_block",e.nextNonspace);return n._isFenced=!0,n._fenceLength=r,n._fenceChar=t[0][0],n._fenceOffset=e.indent,e.advanceNextNonspace(),e.advanceOffset(r,!1),2}return 0},function(e,t){if(!e.indented&&60===or(e.currentLine,e.nextNonspace)){var r,n=e.currentLine.slice(e.nextNonspace);for(r=1;r<=7;r++)if(Ht[r].test(n)&&(r<7||"paragraph"!==t.type))return e.closeUnmatchedBlocks(),e.addChild("html_block",e.offset)._htmlBlockType=r,2}return 0},function(e,t){var r;if(!e.indented&&"paragraph"===t.type&&(r=e.currentLine.slice(e.nextNonspace).match(nr))){var n;for(e.closeUnmatchedBlocks();91===or(t._string_content,0)&&(n=e.inlineParser.parseReference(t._string_content,e.refmap));)t._string_content=t._string_content.slice(n);if(t._string_content.length>0){var i=new Oe("heading",t.sourcepos);return i.level="="===r[0][0]?1:2,i._string_content=t._string_content,t.insertAfter(i),t.unlink(),e.tip=i,e.advanceOffset(e.currentLine.length-e.offset,!1),2}return 0}return 0},function(e){return!e.indented&&Yt.test(e.currentLine.slice(e.nextNonspace))?(e.closeUnmatchedBlocks(),e.addChild("thematic_break",e.nextNonspace),e.advanceOffset(e.currentLine.length-e.offset,!1),2):0},function(e,t){var r,n,i;return e.indented&&"list"!==t.type||!(r=function(e,t){var r,n,i,s,o=e.currentLine.slice(e.nextNonspace),a={type:null,tight:!0,bulletChar:null,start:null,delimiter:null,padding:null,markerOffset:e.indent};if(e.indent>=4)return null;if(r=o.match(Qt))a.type="bullet",a.bulletChar=r[0][0];else{if(!(r=o.match(Zt))||"paragraph"===t.type&&"1"!==r[1])return null;a.type="ordered",a.start=parseInt(r[1]),a.delimiter=r[2]}if(-1!==(n=or(e.currentLine,e.nextNonspace+r[0].length))&&9!==n&&32!==n)return null;if("paragraph"===t.type&&!e.currentLine.slice(e.nextNonspace+r[0].length).match(Jt))return null;e.advanceNextNonspace(),e.advanceOffset(r[0].length,!0),i=e.column,s=e.offset;do{e.advanceOffset(1,!0),n=or(e.currentLine,e.offset)}while(e.column-i<5&&sr(n));var c=-1===or(e.currentLine,e.offset),l=e.column-i;return l>=5||l<1||c?(a.padding=r[0].length+1,e.column=i,e.offset=s,sr(or(e.currentLine,e.offset))&&e.advanceOffset(1,!0)):a.padding=r[0].length+l,a}(e,t))?0:(e.closeUnmatchedBlocks(),"list"===e.tip.type&&(i=r,(n=t._listData).type===i.type&&n.delimiter===i.delimiter&&n.bulletChar===i.bulletChar)||((t=e.addChild("list",e.nextNonspace))._listData=r),(t=e.addChild("item",e.nextNonspace))._listData=r,1)},function(e){return e.indented&&"paragraph"!==e.tip.type&&!e.blank?(e.advanceOffset(4,!0),e.closeUnmatchedBlocks(),e.addChild("code_block",e.offset),2):0}],pr=function(e,t){for(var r,n,i,s=this.currentLine;e>0&&(i=s[this.offset]);)"\t"===i?(r=4-this.column%4,t?(this.partiallyConsumedTab=r>e,n=r>e?e:r,this.column+=n,this.offset+=this.partiallyConsumedTab?0:1,e-=n):(this.partiallyConsumedTab=!1,this.column+=r,this.offset+=1,e-=1)):(this.partiallyConsumedTab=!1,this.offset+=1,this.column+=1,e-=1)},fr=function(){this.offset=this.nextNonspace,this.column=this.nextNonspaceColumn,this.partiallyConsumedTab=!1},gr=function(){for(var e,t=this.currentLine,r=this.offset,n=this.column;""!==(e=t.charAt(r));)if(" "===e)r++,n++;else{if("\t"!==e)break;r++,n+=4-n%4}this.blank="\n"===e||"\r"===e||""===e,this.nextNonspace=r,this.nextNonspaceColumn=n,this.indent=this.nextNonspaceColumn-this.column,this.indented=this.indent>=4},mr=function(e){var t,r,n=!0,i=this.doc;for(this.oldtip=this.tip,this.offset=0,this.column=0,this.blank=!1,this.partiallyConsumedTab=!1,this.lineNumber+=1,-1!==e.indexOf("\0")&&(e=e.replace(/\0/g,"")),this.currentLine=e;(r=i._lastChild)&&r._open;){switch(i=r,this.findNextNonspace(),this.blocks[i.type].continue(this,i)){case 0:break;case 1:n=!1;break;case 2:return;default:throw"continue returned illegal value, must be 0, 1, or 2"}if(!n){i=i._parent;break}}this.allClosed=i===this.oldtip,this.lastMatchedContainer=i;for(var s="paragraph"!==i.type&&hr[i.type].acceptsLines,o=this.blockStarts,a=o.length;!s;){if(this.findNextNonspace(),!this.indented&&!Xt.test(e.slice(this.nextNonspace))){this.advanceNextNonspace();break}for(var c=0;c<a;){var l=o[c](this,i);if(1===l){i=this.tip;break}if(2===l){i=this.tip,s=!0;break}c++}if(c===a){this.advanceNextNonspace();break}}if(this.allClosed||this.blank||"paragraph"!==this.tip.type){this.closeUnmatchedBlocks(),this.blank&&i.lastChild&&(i.lastChild._lastLineBlank=!0),t=i.type;for(var u=this.blank&&!("block_quote"===t||"code_block"===t&&i._isFenced||"item"===t&&!i._firstChild&&i.sourcepos[0][0]===this.lineNumber),h=i;h;)h._lastLineBlank=u,h=h._parent;this.blocks[t].acceptsLines?(this.addLine(),"html_block"===t&&i._htmlBlockType>=1&&i._htmlBlockType<=5&&Wt[i._htmlBlockType].test(this.currentLine.slice(this.offset))&&(this.lastLineLength=e.length,this.finalize(i,this.lineNumber))):this.offset<e.length&&!this.blank&&(i=this.addChild("paragraph",this.offset),this.advanceNextNonspace(),this.addLine())}else this.addLine();this.lastLineLength=e.length},yr=function(e,t){var r=e._parent;e._open=!1,e.sourcepos[1]=[t,this.lastLineLength],this.blocks[e.type].finalize(this,e),this.tip=r},vr=function(e){var t,r,n,i=e.walker();for(this.inlineParser.refmap=this.refmap,this.inlineParser.options=this.options;r=i.next();)n=(t=r.node).type,r.entering||"paragraph"!==n&&"heading"!==n||this.inlineParser.parse(t)},_r=function(){return new Oe("document",[[1,1],[0,0]])},br=function(e){this.doc=new _r,this.tip=this.doc,this.refmap={},this.lineNumber=0,this.lastLineLength=0,this.offset=0,this.column=0,this.lastMatchedContainer=this.doc,this.currentLine="",this.options.time&&console.time("preparing input");var t=e.split(ir),r=t.length;10===e.charCodeAt(e.length-1)&&(r-=1),this.options.time&&console.timeEnd("preparing input"),this.options.time&&console.time("block parsing");for(var n=0;n<r;n++)this.incorporateLine(t[n]);for(;this.tip;)this.finalize(this.tip,r);return this.options.time&&console.timeEnd("block parsing"),this.options.time&&console.time("inline parsing"),this.processInlines(this.doc),this.options.time&&console.timeEnd("inline parsing"),this.doc};const wr=function(e){return{doc:new _r,blocks:hr,blockStarts:dr,tip:this.doc,oldtip:this.doc,currentLine:"",lineNumber:0,offset:0,column:0,nextNonspace:0,nextNonspaceColumn:0,indent:0,indented:!1,blank:!1,partiallyConsumedTab:!1,allClosed:!0,lastMatchedContainer:this.doc,refmap:{},lastLineLength:0,inlineParser:new Vt(e),findNextNonspace:gr,advanceOffset:pr,advanceNextNonspace:fr,addLine:cr,addChild:lr,incorporateLine:mr,finalize:yr,processInlines:vr,closeUnmatchedBlocks:ur,parse:br,options:e||{}}};function Sr(){}Sr.prototype.render=function(e){var t,r,n=e.walker();for(this.buffer="",this.lastOut="\n";t=n.next();)this[r=t.node.type]&&this[r](t.node,t.entering);return this.buffer},Sr.prototype.out=function(e){this.lit(e)},Sr.prototype.lit=function(e){this.buffer+=e,this.lastOut=e},Sr.prototype.cr=function(){"\n"!==this.lastOut&&this.lit("\n")},Sr.prototype.esc=function(e){return e};const kr=Sr;var Er=/^javascript:|vbscript:|file:|data:/i,xr=/^data:image\/(?:png|gif|jpeg|webp)/i,Ar=function(e){return Er.test(e)&&!xr.test(e)};function Tr(e){(e=e||{}).softbreak=e.softbreak||"\n",this.disableTags=0,this.lastOut="\n",this.options=e}Tr.prototype=Object.create(kr.prototype),Tr.prototype.text=function(e){this.out(e.literal)},Tr.prototype.html_inline=function(e){this.options.safe?this.lit("\x3c!-- raw HTML omitted --\x3e"):this.lit(e.literal)},Tr.prototype.html_block=function(e){this.cr(),this.options.safe?this.lit("\x3c!-- raw HTML omitted --\x3e"):this.lit(e.literal),this.cr()},Tr.prototype.softbreak=function(){this.lit(this.options.softbreak)},Tr.prototype.linebreak=function(){this.tag("br",[],!0),this.cr()},Tr.prototype.link=function(e,t){var r=this.attrs(e);t?(this.options.safe&&Ar(e.destination)||r.push(["href",this.esc(e.destination)]),e.title&&r.push(["title",this.esc(e.title)]),this.tag("a",r)):this.tag("/a")},Tr.prototype.image=function(e,t){t?(0===this.disableTags&&(this.options.safe&&Ar(e.destination)?this.lit('<img src="" alt="'):this.lit('<img src="'+this.esc(e.destination)+'" alt="')),this.disableTags+=1):(this.disableTags-=1,0===this.disableTags&&(e.title&&this.lit('" title="'+this.esc(e.title)),this.lit('" />')))},Tr.prototype.emph=function(e,t){this.tag(t?"em":"/em")},Tr.prototype.strong=function(e,t){this.tag(t?"strong":"/strong")},Tr.prototype.paragraph=function(e,t){var r=e.parent.parent,n=this.attrs(e);null!==r&&"list"===r.type&&r.listTight||(t?(this.cr(),this.tag("p",n)):(this.tag("/p"),this.cr()))},Tr.prototype.heading=function(e,t){var r="h"+e.level,n=this.attrs(e);t?(this.cr(),this.tag(r,n)):(this.tag("/"+r),this.cr())},Tr.prototype.code=function(e){this.tag("code"),this.out(e.literal),this.tag("/code")},Tr.prototype.code_block=function(e){var t=e.info?e.info.split(/\s+/):[],r=this.attrs(e);t.length>0&&t[0].length>0&&r.push(["class","language-"+this.esc(t[0])]),this.cr(),this.tag("pre"),this.tag("code",r),this.out(e.literal),this.tag("/code"),this.tag("/pre"),this.cr()},Tr.prototype.thematic_break=function(e){var t=this.attrs(e);this.cr(),this.tag("hr",t,!0),this.cr()},Tr.prototype.block_quote=function(e,t){var r=this.attrs(e);t?(this.cr(),this.tag("blockquote",r),this.cr()):(this.cr(),this.tag("/blockquote"),this.cr())},Tr.prototype.list=function(e,t){var r="bullet"===e.listType?"ul":"ol",n=this.attrs(e);if(t){var i=e.listStart;null!==i&&1!==i&&n.push(["start",i.toString()]),this.cr(),this.tag(r,n),this.cr()}else this.cr(),this.tag("/"+r),this.cr()},Tr.prototype.item=function(e,t){var r=this.attrs(e);t?this.tag("li",r):(this.tag("/li"),this.cr())},Tr.prototype.custom_inline=function(e,t){t&&e.onEnter?this.lit(e.onEnter):!t&&e.onExit&&this.lit(e.onExit)},Tr.prototype.custom_block=function(e,t){this.cr(),t&&e.onEnter?this.lit(e.onEnter):!t&&e.onExit&&this.lit(e.onExit),this.cr()},Tr.prototype.esc=ze,Tr.prototype.out=function(e){this.lit(this.esc(e))},Tr.prototype.tag=function(e,t,r){if(!(this.disableTags>0)){if(this.buffer+="<"+e,t&&t.length>0)for(var n,i=0;void 0!==(n=t[i]);)this.buffer+=" "+n[0]+'="'+n[1]+'"',i++;r&&(this.buffer+=" /"),this.buffer+=">",this.lastOut=">"}},Tr.prototype.attrs=function(e){var t=[];if(this.options.sourcepos){var r=e.sourcepos;r&&t.push(["data-sourcepos",String(r[0][0])+":"+String(r[0][1])+"-"+String(r[1][0])+":"+String(r[1][1])])}return t};const Cr=Tr;var Ir=/\<[^>]*\>/;function Rr(e){return e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}function Or(e){e=e||{},this.disableTags=0,this.lastOut="\n",this.indentLevel=0,this.indent="  ",this.options=e}Or.prototype=Object.create(kr.prototype),Or.prototype.render=function(e){var t,r;this.buffer="";var n,i,s,o,a,c,l=e.walker(),u=this.options;for(u.time&&console.time("rendering"),this.buffer+='<?xml version="1.0" encoding="UTF-8"?>\n',this.buffer+='<!DOCTYPE document SYSTEM "CommonMark.dtd">\n';n=l.next();)if(s=n.entering,c=(i=n.node).type,o=i.isContainer,a="thematic_break"===c||"linebreak"===c||"softbreak"===c,r=Rr(c),s){switch(t=[],c){case"document":t.push(["xmlns","http://commonmark.org/xml/1.0"]);break;case"list":null!==i.listType&&t.push(["type",i.listType.toLowerCase()]),null!==i.listStart&&t.push(["start",String(i.listStart)]),null!==i.listTight&&t.push(["tight",i.listTight?"true":"false"]);var h=i.listDelimiter;if(null!==h){var d;d="."===h?"period":"paren",t.push(["delimiter",d])}break;case"code_block":i.info&&t.push(["info",i.info]);break;case"heading":t.push(["level",String(i.level)]);break;case"link":case"image":t.push(["destination",i.destination]),t.push(["title",i.title]);break;case"custom_inline":case"custom_block":t.push(["on_enter",i.onEnter]),t.push(["on_exit",i.onExit])}if(u.sourcepos){var p=i.sourcepos;p&&t.push(["sourcepos",String(p[0][0])+":"+String(p[0][1])+"-"+String(p[1][0])+":"+String(p[1][1])])}if(this.cr(),this.out(this.tag(r,t,a)),o)this.indentLevel+=1;else if(!o&&!a){var f=i.literal;f&&this.out(this.esc(f)),this.out(this.tag("/"+r))}}else this.indentLevel-=1,this.cr(),this.out(this.tag("/"+r));return u.time&&console.timeEnd("rendering"),this.buffer+="\n",this.buffer},Or.prototype.out=function(e){this.disableTags>0?this.buffer+=e.replace(Ir,""):this.buffer+=e,this.lastOut=e},Or.prototype.cr=function(){if("\n"!==this.lastOut){this.buffer+="\n",this.lastOut="\n";for(var e=this.indentLevel;e>0;e--)this.buffer+=this.indent}},Or.prototype.tag=function(e,t,r){var n="<"+e;if(t&&t.length>0)for(var i,s=0;void 0!==(i=t[s]);)n+=" "+i[0]+'="'+this.esc(i[1])+'"',s++;return r&&(n+=" /"),n+">"},Or.prototype.esc=ze;const Pr=/\$(([^$]|\\\\$)*)\$/gm,Dr=/\$\$(([^$]|\\\\$)*)\$\$/gm;function Mr(e){return e.replace(Dr,((e,t)=>function(e){var t=document.createElement("div");return t.dataset.mxMaths=e,t.innerText=e,t.outerHTML}(t))).replace(Pr,((e,t)=>function(e){var t=document.createElement("span");return t.dataset.mxMaths=e,t.innerText=e,t.outerHTML}(t)))}var Lr=__webpack_require__(1036),Nr=__webpack_require__.n(Lr),Fr=__webpack_require__(527),Br=__webpack_require__.n(Fr);function Ur(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class qr extends p{constructor(e){super(e),Ur(this,"userColor",new M(this.props.event.getSender())),Ur(this,"messageBody",{current:null}),Ur(this,"upvote",(()=>{(this.props.reactions[this.props.event.getId()]||[]).some((e=>e.getSender()==this.props.client.getUserId()))||this.props.client.sendEvent(this.props.event.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:this.props.event.getId(),key:""}})})),Ur(this,"openEditor",(()=>this.setState({editing:!0}))),Ur(this,"closeEditor",(()=>{console.log("fired"),this.setState({editing:!1})})),Ur(this,"getCurrentEdit",(()=>{const e=this.getEdits();return e.length>0?e[e.length-1].getContent()["m.new_content"]:this.props.event.getContent()})),Ur(this,"getEdits",(()=>this.props.reactions[this.props.event.getId()]?this.props.reactions[this.props.event.getId()].filter((e=>"m.replace"==e.getContent()["m.relates_to"].rel_type)):[])),Ur(this,"redactMessage",(()=>{this.props.client.redactEvent(this.props.event.getRoomId(),this.props.event.getId())})),this.state={editing:!1}}processLatex(){this.messageBody.current&&Array.from(this.messageBody.current.querySelectorAll("[data-mx-maths]")).forEach((e=>{"DIV"==e.tagName?Br().render(e.dataset.mxMaths,e,{displayMode:!0,throwOnError:!1}):Br().render(e.dataset.mxMaths,e,{throwOnError:!1})}))}componentDidMount(){this.processLatex()}componentDidUpdate(e){this.props.reactions[this.props.event.getId()]!=e.reactions[e.event.getId()]&&this.processLatex()}render(e,t){const r=e.event,n=(r.getSender().split(":")[0].slice(1),e.reactions[r.getId()]?e.reactions[r.getId()].filter((e=>"m.annotation"==e.getContent()["m.relates_to"].rel_type)).length:0),i=this.getCurrentEdit(),s="org.matrix.custom.html"==i.format&&i.formatted_body?u("div",{ref:this.messageBody,class:"body",dangerouslySetInnerHTML:{__html:Nr()(i.formatted_body,zr)}}):u("div",{class:"body"},i.body);return e.client.getUserId()==r.getSender()?u(d,null,u("div",{id:r.getId(),style:this.userColor.styleVariables,class:"message me"},s,u("div",{class:"ident"},n>0&&u("span",{class:"upvotes"},"+",n),u("div",{class:"info"},!t.editing&&u("button",{onclick:this.openEditor},"edit"),u("button",{onclick:this.redactMessage,class:"redact"},"delete")))),t.editing&&u(jr,{openEditor:this.openEditor,closeEditor:this.closeEditor,getCurrentEdit:this.getCurrentEdit,client:this.props.client,event:r})):u("div",{style:this.userColor.styleVariables,id:r.getId(),class:"message"},u("div",{class:"ident"},u("div",{class:"info"},u("button",{class:"reaction",onclick:this.upvote},"+1")),n>0&&u("span",{class:"upvotes"},"+",n)),s)}}class jr extends p{constructor(...e){super(...e),Ur(this,"sendEdit",(()=>{const e=new wr,t=new Cr,r=e.parse(Mr(this.state.edit_value)),n=t.render(r);this.props.client.sendEvent(this.props.event.getRoomId(),"m.reaction",{body:"an edit occurred",msgtype:"m.text","m.new_content":{body:this.state.edit_value,msgtype:"m.text",format:"org.matrix.custom.html",formatted_body:n},"m.relates_to":{rel_type:"m.replace",event_id:this.props.event.getId()}}).then((e=>this.props.closeEditor()))})),Ur(this,"handleKeypress",(e=>{"Enter"==e.key&&e.ctrlKey&&(e.preventDefault(),this.sendEdit())})),Ur(this,"handleInput",(e=>{this.setState({edit_value:e.target.value})}))}componentDidMount(){this.setState({edit_value:this.props.getCurrentEdit().body})}render(e,t){return u("div",{class:"messageEditor"},u("textarea",{value:t.edit_value,onkeypress:this.handleKeypress,oninput:this.handleInput}),u("button",{onclick:this.sendEdit},"Submit Changes"),u("button",{onclick:this.props.closeEditor},"Cancel"))}}const Kr=/^#[0-9a-fA-F]{6}$/,zr={allowedTags:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","nl","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre","span","img","details","summary"],allowedAttributes:{font:["color","data-mx-bg-color","data-mx-color","style"],span:["data-mx-maths","data-mx-bg-color","data-mx-color","data-mx-spoiler","style"],div:["data-mx-maths"],a:["href","name","target","rel"],img:["src","width","height","alt","title"],ol:["start"],code:["class"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","magnet"],allowProtocolRelative:!1,transformTags:{a:function(e,t){return t.href&&(t.target="_blank"),t.rel="noreferrer noopener",{tagName:e,attribs:t}},img:function(e,t){return{tagName:e,attribs:{}}},code:function(e,t){if(void 0!==t.class){const e=t.class.split(/\s/).filter((function(e){return e.startsWith("language-")&&!e.startsWith("language-_")}));t.class=e.join(" ")}return{tagName:e,attribs:t}},"*":function(e,t){delete t.style;const r={"data-mx-color":"color","data-mx-bg-color":"background-color"};let n="";return Object.keys(r).forEach((e=>{const i=r[e],s=t[e];s&&"string"==typeof s&&Kr.test(s)&&(n+=i+":"+s+";",delete t[e])})),n&&(t.style=n),{tagName:e,attribs:t}}},nestingLimit:50};function $r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Gr extends p{constructor(e){super(e),$r(this,"handleTimeline",((e,t)=>{this.props.focus&&this.props.focus.room_id==e.getRoomId()&&this.setState({events:t.getLiveTimeline().getEvents()})})),$r(this,"handleTypingNotification",((e,t)=>{if(t.roomId==this.props.focus.room_id){const t=this.props.client.getUserId(),r=e.getContent().user_ids.filter((e=>e!=t));this.setState({typing:r})}})),$r(this,"tryLoad",(e=>{var t=document.getElementById("scroll-anchor"),r=document.getElementById("chat-panel");t&&r.getBoundingClientRect().top-5<t.getBoundingClientRect().top&&(this.props.client.scrollback(e),e.getLiveTimeline().getState(i.EventTimeline.BACKWARDS).paginationToken||(this.scrolledIdents.add(this.props.focus.room_id),this.setState({fullyScrolled:!0})),setTimeout((t=>this.tryLoad(e)),100))})),$r(this,"tryLoadRoom",(async()=>{const e=await this.props.client.joinRoom(this.props.focus.room_id);this.tryLoad(e)})),this.state={typing:[],events:[],fullyScrolled:!1},this.scrolledIdents=new Set,this.handleTimeline=this.handleTimeline.bind(this),this.handleTypingNotifications=this.handleTypingNotification.bind(this)}componentDidMount(){this.props.client.on("Room.timeline",this.handleTimeline),this.props.client.on("Room.redaction",this.handleTimeline),this.props.client.on("RoomMember.typing",this.handleTypingNotification)}componentWillUnmount(){this.props.client.off("Room.timeline",this.handleTimeline),this.props.client.off("Room.redaction",this.handleTimeline),this.props.client.off("RoomMember.typing",this.handleTypingNotification)}async componentDidUpdate(e,t,r){if(this.props.focus&&e.focus!=this.props.focus){const e=await this.props.client.joinRoom(this.props.focus.room_id);this.setState({fullyScrolled:this.scrolledIdents.has(this.props.focus.room_id),events:e.getLiveTimeline().getEvents()},(t=>this.tryLoad(e)))}}render(e,t){var r={};const n=t.events.filter((e=>"m.room.message"==e.getType()&&"m.text"==e.getContent().msgtype||0==Object.keys(e.getContent()).length));var i=null;const s=n.reduce(((t,n)=>{switch(i&&i.getSender()==n.getSender()||(t.push(u(Vr,{key:n.getId()+"-userinfo",username:n.getSender(),isMe:n.getSender()==e.client.getUserId()})),i=n),n.getContent().msgtype){case"m.text":t.push(u(qr,{reactions:r,client:this.props.client,key:n.getId(),event:n}));break;case void 0:i.getSender()==n.getSender()&&t.length>1&&t[t.length-1].type==Hr?t[t.length-1].props.count=t[t.length-1].props.count+1:t.push(u(Hr,{count:1,key:n.getId(),username:n.getSender(),isMe:n.getSender()==e.client.getUserId()}))}return t}),[]);return t.events.forEach((e=>{"m.reaction"==e.getType()&&(r[e.getContent()["m.relates_to"].event_id]?r[e.getContent()["m.relates_to"].event_id].push(e):r[e.getContent()["m.relates_to"].event_id]=[e])})),u("div",{id:"chat-wrapper"},u("div",{id:"chat-panel",onscroll:this.tryLoadRoom},u(Xr,{textarea:this.messageTextarea,client:e.client,focus:e.focus}),u("div",{id:"messages"},s,u(Yr,{client:this.props.client,typing:this.state.typing})),u(Wr,{focus:e.focus,fullyScrolled:t.fullyScrolled})))}}class Vr extends p{constructor(...e){super(...e),$r(this,"userColor",new M(this.props.username))}render(e){return u("div",{class:e.isMe?"user-info-message me":"user-info-message",style:this.userColor.styleVariables},e.username)}}class Hr extends p{constructor(...e){super(...e),$r(this,"userColor",new M(this.props.username))}render(e){return e.isMe?u("div",{class:"redacted message me",style:this.userColor.styleVariables},u("div",{class:"ident"}),u("div",{class:"body"},e.count>1?e.count+" messages deleted":"message deleted")):u("div",{class:"redacted message",style:this.userColor.styleVariables},u("div",{class:"ident"}),u("div",{class:"body"},e.count>1?e.count+" messages deleted":"message deleted"))}}class Wr extends p{render(e){return e.focus?e.fullyScrolled?u("div",{id:"scroll-done"},"All events loaded"):u("div",{id:"scroll-anchor"},"loading..."):u("div",{id:"scroll-done"},"Click an annotation to discuss")}}class Yr extends p{render(e,t){const r=e.typing.map((e=>e.split(":")[0].slice(1))),n=r.length;return 0==n?u("div",{class:"typingIndicator"},""):1==n?u("div",{class:"typingIndicator"},r[0]," is typing"):2==n?u("div",{class:"typingIndicator"},r[0]," and ",r[1]," are typing"):u("div",{class:"typingIndicator"},"several people are typing")}}class Xr extends p{constructor(e){super(e),$r(this,"startTyping",(()=>{this.props.client.sendTyping(this.props.focus.room_id,!0,3e4),this.typingLock=!0,this.resetLockTimeout=setTimeout((e=>{this.typingLock=!1}),1e4)})),$r(this,"stopTyping",(()=>{this.typingLock=!1,clearTimeout(this.resetLockTimeout),clearTimeout(this.typingTimeout),this.props.client.sendTyping(this.props.focus.room_id,!1)})),$r(this,"handleInput",(e=>{""==e.target.value&&this.props.focus&&this.stopTyping(),this.setState({value:e.target.value})})),$r(this,"handleKeypress",(e=>{this.props.focus&&(clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout((e=>this.stopTyping()),5e3),"Enter"==e.key&&e.ctrlKey?(e.preventDefault(),this.sendMessage()):this.typingLock||this.startTyping())})),$r(this,"sendMessage",(()=>{if(this.props.focus.room_id){this.stopTyping();const e=this.reader.parse(Mr(this.state.value)),t=this.writer.render(e);this.props.client.sendMessage(this.props.focus.room_id,{body:this.state.value,msgtype:"m.text",format:"org.matrix.custom.html",formatted_body:t}),this.setState({value:""})}else window.alert("you need to focus an annotation to send a message")})),$r(this,"userColor",new M(this.props.client.getUserId())),this.state={value:""},this.reader=new wr,this.writer=new Cr}render(e,t){return u("div",{style:this.userColor.styleVariables,id:"messageComposer"},u("textarea",{value:t.value,onkeypress:this.handleKeypress,oninput:this.handleInput}),u("div",{id:"submit-button-wrapper"},u("button",{id:"submitButton",onclick:this.sendMessage},"Submit"),u("button",{id:"sendFileButton",onclick:e=>alert("not implemented")},F),u("button",{id:"sendImageButton",onclick:e=>alert("not implemented")},B),u("button",{id:"moreButton",onclick:e=>alert("not implemented")},j)))}}var Jr=__webpack_require__(6145);function Qr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Y()(Jr.Z,{insert:"head",singleton:!1}),Jr.Z.locals;class Zr extends p{constructor(e){super(e),Qr(this,"handleInput",(e=>this.setState({value:e.target.value}))),Qr(this,"handleFocus",(e=>this.setState({pageViewVisible:!0}))),Qr(this,"handleBlur",(e=>{setTimeout((e=>this.setState({value:this.props.page,pageViewVisible:!1})),500)})),Qr(this,"handleSubmit",(e=>{e.preventDefault(),parseInt(this.state.value)>0&&parseInt(this.state.value)<this.props.total?this.props.loadPage(parseInt(this.state.value)):alert("Out of range")})),Qr(this,"firstPage",(e=>{this.props.loadPage(1),this.setState({value:1})})),Qr(this,"prevPage",(e=>{this.props.loadPage(this.state.value-1),this.setState({value:this.state.value-1})})),Qr(this,"nextPage",(e=>{this.props.loadPage(this.state.value+1),this.setState({value:this.state.value+1})})),Qr(this,"lastPage",(e=>{this.props.loadPage(this.props.total),this.setState({value:this.props.total})})),Qr(this,"handleClick",(e=>{this.props.loadPage(parseInt(event.target.value)),this.setState({value:parseInt(event.target.value)})})),this.state={value:e.page,pageViewVisible:!1}}render(e,t){if(e.pdfWidthPx){const r={width:e.pdfWidthPx+"px"};return u("nav",{id:"page-nav"},u("div",{class:t.pageViewVisible?null:"nav-hidden",style:r,id:"nav-pages"},u(en,{total:e.total,handleClick:this.handleClick})),u("div",{style:r,id:"nav-button-wrapper"},u("button",{title:"add annotation",disabled:e.selected?null:"disabled",onclick:e.addann},V),u("button",{title:"go to first page",disabled:e.page>1?null:"disabled",onclick:this.firstPage},G),u("button",{title:"go to previous page",disabled:e.page>1?null:"disabled",onclick:this.prevPage},K),u("form",{onSubmit:this.handleSubmit},u("input",{type:"text",value:this.state.value,onfocus:this.handleFocus,onblur:this.handleBlur,onInput:this.handleInput}),u("span",null,"/"),u("span",{id:"nav-total-pages"},e.total)),u("button",{title:"go to next page",disabled:e.total>e.page?null:"disabled",onclick:this.nextPage},z),u("button",{title:"go to last page",disabled:e.total>e.page?null:"disabled",onclick:this.lastPage},$),u("button",{title:"remove annotation",disabled:this.props.focus&&!this.props.selected?null:"disabled",onclick:this.props.closeann},H)))}}}class en extends p{render(e,t){const r=Array.from({length:e.total},((e,t)=>t+1)).map((t=>u("button",{class:"pglabel",value:t,onclick:e.handleClick},t)));return u(d,null,r)}}function tn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class rn extends p{constructor(e){super(e),tn(this,"annotationLayer",{current:null}),tn(this,"annotationLayerWrapper",{current:null}),tn(this,"documentView",{current:null}),tn(this,"setId",(e=>{this.setState({roomId:e},(e=>this.props.queryParams.get("focus")?this.focusByUUID(this.props.queryParams.get("focus")):null))})),tn(this,"setPdfWidthPx",(e=>this.setState({pdfWidthPx:e}))),tn(this,"focusByUUID",(e=>{const t=this.props.client.getRoom(this.state.roomId).getLiveTimeline().getState(i.EventTimeline.FORWARDS).getStateEvents(O,e);t&&this.setState({focus:t.getContent()})})),tn(this,"setTotalPages",(e=>this.setState({totalPages:e}))),tn(this,"togglePanel",(()=>this.setState({panelVisible:!this.state.panelVisible}))),tn(this,"openAnnotation",(e=>{var t=window.getSelection();if(!t.isCollapsed){var r=t.getRangeAt(0),n=Array.from(r.getClientRects()).map((e=>function(e,t,r){var n=e.getBoundingClientRect();return console.log(e),console.log(n),new DOMRect((t.x-n.x)/r,(t.y-n.y)/r,t.width/r,t.height/r)}(this.annotationLayerWrapper.current,e,this.state.zoomFactor))),i=Math.random().toString(36).substring(2);this.props.client.createRoom({room_alias_name:"room"+i,name:"room"+i,visibility:"public",topic:"bloviating",initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}}]}).then((e=>{this.props.client.sendStateEvent(this.state.roomId,O,{room_id:e.room_id,uuid:i,clientRects:JSON.stringify(n),activityStatus:"open",pageNumber:this.props.pageFocused},i).catch((e=>alert(e))),t.removeAllRanges()}))}})),tn(this,"closeAnnotation",(e=>{this.props.client.sendStateEvent(this.state.roomId,O,{uuid:this.state.focus.uuid,room_id:this.state.focus.room_id,pageNumber:this.state.focus.pageNumber,clientRects:this.state.focus.clientRects,activityStatus:"closed"},this.state.focus.uuid),this.setState({focus:null})})),tn(this,"setFocus",(e=>{this.props.queryParams.set("focus",e.uuid),window.history.replaceState({pdfFocused:this.props.pdfFocused,pageFocused:this.props.pageFocused,annotationFocused:e.uuid},"","?"+this.props.queryParams.toString()),this.setState({focus:e})})),this.state={roomId:null,focus:null,totalPages:null,panelVisible:!1,hasSelection:!1,pdfWidthPx:null,zoomFactor:1},this.checkForSelection=this.checkForSelection.bind(this)}componentDidMount(){document.addEventListener("selectionchange",this.checkForSelection),document.addEventListener("keydown",(e=>{"+"==e.key&&this.setState({zoomFactor:this.state.zoomFactor+.1})})),document.addEventListener("keydown",(e=>{"-"==e.key&&this.setState({zoomFactor:this.state.zoomFactor-.1})}))}componentWillUnmount(){document.removeEventListener("selectionchange",this.checkForSelection)}checkForSelection(){this.selectionTimeout&&clearTimeout(this.selectionTimeout),window.getSelection();let e=!window.getSelection().isCollapsed&&this.documentView.current.contains(window.getSelection().getRangeAt(0).endContainer)&&this.documentView.current.contains(window.getSelection().getRangeAt(0).startContainer);this.selectionTimeout=setTimeout(200,this.setState({hasSelection:e}))}render(e,t){const r={transformOrigin:"top left",transform:"scale("+t.zoomFactor+")"};return u("div",{id:"content-container"},u("div",{ref:this.documentView,id:"document-view"},u("div",{style:r,id:"zoom-wrapper"},u(nn,{setPdfWidthPx:this.setPdfWidthPx,annotationLayer:this.annotationLayer,pdfFocused:e.pdfFocused,pageFocused:e.pageFocused,initFocus:this.initFocus,setId:this.setId,setTotalPages:this.setTotalPages,client:e.client}),u(we,{ref:this.annotationLayer,annotationLayer:this.annotationLayer,annotationLayerWrapper:this.annotationLayerWrapper,zoomFactor:t.zoomFactor,page:e.pageFocused,roomId:t.roomId,setFocus:this.setFocus,focus:t.focus,client:e.client}))),u("div",{style:t.panelVisible?{visibility:"visible"}:{},id:"sidepanel"},u(Gr,{client:e.client,focus:t.focus})),u(Zr,{selected:t.hasSelection,addann:this.openAnnotation,closeann:this.closeAnnotation,page:e.pageFocused,total:t.totalPages,focus:t.focus,pdfWidthPx:t.pdfWidthPx,loadPage:e.loadPage}),u("button",{id:"panelToggle",onclick:this.togglePanel},t.panelVisible?N:L))}}tn(rn,"PDFStore",{});class nn extends p{constructor(e){super(e),tn(this,"textLayer",{current:null}),tn(this,"canvas",{current:null}),this.pendingRender=null,this.hasRendered=!1;let t=(r,n,i)=>"PREPARED"==r?this.fetchPdf(e.pdfFocused):e.client.off("sync",t);e.client.isInitialSyncComplete()?this.fetchPdf(e.pdfFocused):e.client.on("sync",t)}async fetchPdf(e){var t=await this.props.client.getRoomIdForAlias("#"+e+":"+P);await this.props.client.joinRoom(t.room_id),this.props.setId(t.room_id);const r=this.props.client.getRoom(t.room_id).getLiveTimeline().getState(i.EventTimeline.FORWARDS).getStateEvents("org.populus.pdf","").getContent().identifier,n=D+"/_matrix/media/r0/download/"+P+"/"+r;this.setState({pdfIdentifier:r}),rn.PDFStore[r]||(console.log("fetched "+e),rn.PDFStore[r]=fe.getDocument(n).promise,rn.PDFStore[r].then((e=>this.props.setTotalPages(e.numPages))))}async drawPdf(){this.hasRendered=!0;const e=this.canvas.current;try{this.pendingRender._internalRenderTask.cancel()}catch{}const t=await rn.PDFStore[this.state.pdfIdentifier],r=await t.getPage(this.props.pageFocused||1);console.log("Page loaded");const n={1:3,2:6}[window.devicePixelRatio]||3,i=r.getViewport({scale:n}),s=1.5*i.width/n,o=1.5*i.height/n;this.props.setPdfWidthPx(s),e.style.height=`${o}px`,e.style.width=`${s}px`,e.height=i.height,e.width=i.width;const a={canvasContext:e.getContext("2d"),viewport:i};this.pendingRender=r.render(a),await this.pendingRender.promise,console.log("Page rendered");const c=await r.getTextContent();ge(e.getBoundingClientRect(),this.textLayer.current),ge(e.getBoundingClientRect(),this.props.annotationLayer.current.base),fe.renderTextLayer({textContent:c,container:document.getElementById("text-layer"),viewport:r.getViewport({scale:1.5}),textDivs:[]})}componentDidUpdate(e,t,r){this.hasRendered&&e.pageFocused==this.props.pageFocused||(this.textLayer.current.innerHTML="",this.drawPdf().then((e=>this.props.annotationLayer.current.forceUpdate())))}componentDidMount(){this.textLayer.current.addEventListener("click",(e=>{const t=new MouseEvent(e.type,e);document.elementsFromPoint(e.clientX,e.clientY).forEach((e=>{e.hasAttribute("data-annotation")&&e.dispatchEvent(t)}))}))}render(e,t){return u(d,null,u("canvas",{ref:this.canvas,"data-page":e.pageFocused,id:"pdf-canvas"}),u("div",{style:"z-index:3",ref:this.textLayer,id:"text-layer"}))}}var sn=__webpack_require__(5812);function on(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function an(e){window.dispatchEvent(new CustomEvent("recaptcha",{detail:e}))}Y()(sn.Z,{insert:"head",singleton:!1}),sn.Z.locals,function(t,r,n){var i,a,c;e.__&&e.__(t,r),a=(i="function"==typeof n)?null:n&&n.__k||r.__k,c=[],x(r,t=(!i&&n||r).__k=u(d,null,[t]),a||s,s,void 0!==r.ownerSVGElement,!i&&n?[n]:a?null:r.firstChild?o.slice.call(r.childNodes):null,c,!i&&n?n:a?a.__e:r.firstChild,i),A(c,t)}(u(class extends p{constructor(){super(),on(this,"logoutHandler",(e=>{localStorage.clear(),this.client.stopClient(),this.client=i.createClient({baseUrl:D,timelineSupport:!0}),this.setState({loggedIn:!1})})),on(this,"loginHandler",(e=>{localStorage.setItem("accessToken",this.client.getAccessToken()),localStorage.setItem("userId",this.client.getUserId()),this.client.startClient({initialSyncLimit:1}).then((e=>{this.setState({loggedIn:!0})}))})),on(this,"loadPDF",(e=>{this.setState({pdfFocused:e}),this.queryParams.set("title",e),window.history.pushState({pdfFocused:e},"","?"+this.queryParams.toString())})),on(this,"loadPage",(e=>{this.setState({pageFocused:e}),this.queryParams.set("page",e),window.history.pushState({pdfFocused:this.state.pdfFocused,pageFocused:e},"","?"+this.queryParams.toString())})),this.queryParams=new URLSearchParams(window.location.search),this.client=i.createClient({baseUrl:D,userId:localStorage.getItem("userId"),accessToken:localStorage.getItem("accessToken"),timelineSupport:!0,unstableClientRelationAggregation:!0}),this.state={loggedIn:!1,pdfFocused:this.queryParams.get("title")||!1,pageFocused:Number(this.queryParams.get("page"))||1},this.client.getUserId()&&this.loginHandler(),window.history.pushState({pdfFocused:this.state.pdfFocused,pageFocused:this.state.pageFocused},"","?"+this.queryParams.toString()),window.addEventListener("popstate",(e=>{this.setState({pdfFocused:e.state.pdfFocused||!1,pageFocused:e.state.pageFocused||1})}))}render(e,t){return t.loggedIn?t.pdfFocused?u(rn,{queryParams:this.queryParams,loadPage:this.loadPage,pageFocused:this.state.pageFocused,pdfFocused:this.state.pdfFocused,client:this.client}):u(Z,{loadPDF:this.loadPDF,logoutHandler:this.logoutHandler,client:this.client}):u(ue,{loginHandler:this.loginHandler,client:this.client})}},null),document.body)})(),Populus=__webpack_exports__})();